(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{Dp7t:function(I,g,C){"use strict";g.a=atob("OyhmdW5jdGlvbiAoKSB7CiAgLyoKIGh0dHBzOi8vbXRocy5iZS9mcm9tY29kZXBvaW50IHYwLjIuMSBieSBAbWF0aGlhcyAqLwogICJ1c2Ugc3RyaWN0IgogIHZhciAkanNjb21wID0gJGpzY29tcCB8fCB7fQogICRqc2NvbXAuc2NvcGUgPSB7fQogICRqc2NvbXAuYXJyYXlJdGVyYXRvckltcGwgPSBmdW5jdGlvbiAobSkgewogICAgdmFyIHAgPSAwCiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gcCA8IG0ubGVuZ3RoID8geyBkb25lOiAhMSwgdmFsdWU6IG1bcCsrXSB9IDogeyBkb25lOiAhMCB9CiAgICB9CiAgfQogICRqc2NvbXAuYXJyYXlJdGVyYXRvciA9IGZ1bmN0aW9uIChtKSB7CiAgICByZXR1cm4geyBuZXh0OiAkanNjb21wLmFycmF5SXRlcmF0b3JJbXBsKG0pIH0KICB9CiAgJGpzY29tcC5BU1NVTUVfRVM1ID0gITEKICAkanNjb21wLkFTU1VNRV9OT19OQVRJVkVfTUFQID0gITEKICAkanNjb21wLkFTU1VNRV9OT19OQVRJVkVfU0VUID0gITEKICAkanNjb21wLlNJTVBMRV9GUk9VTkRfUE9MWUZJTEwgPSAhMQogICRqc2NvbXAuZGVmaW5lUHJvcGVydHkgPQogICAgJGpzY29tcC5BU1NVTUVfRVM1IHx8ICJmdW5jdGlvbiIgPT0gdHlwZW9mIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzCiAgICAgID8gT2JqZWN0LmRlZmluZVByb3BlcnR5CiAgICAgIDogZnVuY3Rpb24gKG0sIHAsIGEpIHsKICAgICAgICAgIG0gIT0gQXJyYXkucHJvdG90eXBlICYmIG0gIT0gT2JqZWN0LnByb3RvdHlwZSAmJiAobVtwXSA9IGEudmFsdWUpCiAgICAgICAgfQogICRqc2NvbXAuZ2V0R2xvYmFsID0gZnVuY3Rpb24gKG0pIHsKICAgIHJldHVybiAidW5kZWZpbmVkIiAhPSB0eXBlb2Ygd2luZG93ICYmIHdpbmRvdyA9PT0gbQogICAgICA/IG0KICAgICAgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgZ2xvYmFsICYmIG51bGwgIT0gZ2xvYmFsCiAgICAgID8gZ2xvYmFsCiAgICAgIDogbQogIH0KICAkanNjb21wLmdsb2JhbCA9ICRqc2NvbXAuZ2V0R2xvYmFsKHRoaXMpCiAgJGpzY29tcC5TWU1CT0xfUFJFRklYID0gImpzY29tcF9zeW1ib2xfIgogICRqc2NvbXAuaW5pdFN5bWJvbCA9IGZ1bmN0aW9uICgpIHsKICAgICRqc2NvbXAuaW5pdFN5bWJvbCA9IGZ1bmN0aW9uICgpIHt9CiAgICAkanNjb21wLmdsb2JhbC5TeW1ib2wgfHwgKCRqc2NvbXAuZ2xvYmFsLlN5bWJvbCA9ICRqc2NvbXAuU3ltYm9sKQogIH0KICAkanNjb21wLlN5bWJvbENsYXNzID0gZnVuY3Rpb24gKG0sIHApIHsKICAgIHRoaXMuJGpzY29tcCRzeW1ib2wkaWRfID0gbQogICAgJGpzY29tcC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiZGVzY3JpcHRpb24iLCB7CiAgICAgIGNvbmZpZ3VyYWJsZTogITAsCiAgICAgIHdyaXRhYmxlOiAhMCwKICAgICAgdmFsdWU6IHAsCiAgICB9KQogIH0KICAkanNjb21wLlN5bWJvbENsYXNzLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLiRqc2NvbXAkc3ltYm9sJGlkXwogIH0KICAkanNjb21wLlN5bWJvbCA9IChmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBtKGEpIHsKICAgICAgaWYgKHRoaXMgaW5zdGFuY2VvZiBtKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJTeW1ib2wgaXMgbm90IGEgY29uc3RydWN0b3IiKQogICAgICByZXR1cm4gbmV3ICRqc2NvbXAuU3ltYm9sQ2xhc3MoCiAgICAgICAgJGpzY29tcC5TWU1CT0xfUFJFRklYICsgKGEgfHwgIiIpICsgIl8iICsgcCsrLAogICAgICAgIGEsCiAgICAgICkKICAgIH0KICAgIHZhciBwID0gMAogICAgcmV0dXJuIG0KICB9KSgpCiAgJGpzY29tcC5pbml0U3ltYm9sSXRlcmF0b3IgPSBmdW5jdGlvbiAoKSB7CiAgICAkanNjb21wLmluaXRTeW1ib2woKQogICAgdmFyIG0gPSAkanNjb21wLmdsb2JhbC5TeW1ib2wuaXRlcmF0b3IKICAgIG0gfHwKICAgICAgKG0gPSAkanNjb21wLmdsb2JhbC5TeW1ib2wuaXRlcmF0b3IgPSAkanNjb21wLmdsb2JhbC5TeW1ib2woCiAgICAgICAgIlN5bWJvbC5pdGVyYXRvciIsCiAgICAgICkpCiAgICAiZnVuY3Rpb24iICE9IHR5cGVvZiBBcnJheS5wcm90b3R5cGVbbV0gJiYKICAgICAgJGpzY29tcC5kZWZpbmVQcm9wZXJ0eShBcnJheS5wcm90b3R5cGUsIG0sIHsKICAgICAgICBjb25maWd1cmFibGU6ICEwLAogICAgICAgIHdyaXRhYmxlOiAhMCwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuICRqc2NvbXAuaXRlcmF0b3JQcm90b3R5cGUoJGpzY29tcC5hcnJheUl0ZXJhdG9ySW1wbCh0aGlzKSkKICAgICAgICB9LAogICAgICB9KQogICAgJGpzY29tcC5pbml0U3ltYm9sSXRlcmF0b3IgPSBmdW5jdGlvbiAoKSB7fQogIH0KICAkanNjb21wLmluaXRTeW1ib2xBc3luY0l0ZXJhdG9yID0gZnVuY3Rpb24gKCkgewogICAgJGpzY29tcC5pbml0U3ltYm9sKCkKICAgIHZhciBtID0gJGpzY29tcC5nbG9iYWwuU3ltYm9sLmFzeW5jSXRlcmF0b3IKICAgIG0gfHwKICAgICAgKG0gPSAkanNjb21wLmdsb2JhbC5TeW1ib2wuYXN5bmNJdGVyYXRvciA9ICRqc2NvbXAuZ2xvYmFsLlN5bWJvbCgKICAgICAgICAiU3ltYm9sLmFzeW5jSXRlcmF0b3IiLAogICAgICApKQogICAgJGpzY29tcC5pbml0U3ltYm9sQXN5bmNJdGVyYXRvciA9IGZ1bmN0aW9uICgpIHt9CiAgfQogICRqc2NvbXAuaXRlcmF0b3JQcm90b3R5cGUgPSBmdW5jdGlvbiAobSkgewogICAgJGpzY29tcC5pbml0U3ltYm9sSXRlcmF0b3IoKQogICAgbSA9IHsgbmV4dDogbSB9CiAgICBtWyRqc2NvbXAuZ2xvYmFsLlN5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzCiAgICB9CiAgICByZXR1cm4gbQogIH0KICAkanNjb21wLml0ZXJhdG9yRnJvbUFycmF5ID0gZnVuY3Rpb24gKG0sIHApIHsKICAgICRqc2NvbXAuaW5pdFN5bWJvbEl0ZXJhdG9yKCkKICAgIG0gaW5zdGFuY2VvZiBTdHJpbmcgJiYgKG0gKz0gIiIpCiAgICB2YXIgYSA9IDAsCiAgICAgIGIgPSB7CiAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKGEgPCBtLmxlbmd0aCkgewogICAgICAgICAgICB2YXIgYyA9IGErKwogICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogcChjLCBtW2NdKSwgZG9uZTogITEgfQogICAgICAgICAgfQogICAgICAgICAgYi5uZXh0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4geyBkb25lOiAhMCwgdmFsdWU6IHZvaWQgMCB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYi5uZXh0KCkKICAgICAgICB9LAogICAgICB9CiAgICBiW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBiCiAgICB9CiAgICByZXR1cm4gYgogIH0KICAkanNjb21wLnBvbHlmaWxsID0gZnVuY3Rpb24gKG0sIHAsIGEsIGIpIHsKICAgIGlmIChwKSB7CiAgICAgIGEgPSAkanNjb21wLmdsb2JhbAogICAgICBtID0gbS5zcGxpdCgiLiIpCiAgICAgIGZvciAoYiA9IDA7IGIgPCBtLmxlbmd0aCAtIDE7IGIrKykgewogICAgICAgIHZhciBjID0gbVtiXQogICAgICAgIGMgaW4gYSB8fCAoYVtjXSA9IHt9KQogICAgICAgIGEgPSBhW2NdCiAgICAgIH0KICAgICAgbSA9IG1bbS5sZW5ndGggLSAxXQogICAgICBiID0gYVttXQogICAgICBwID0gcChiKQogICAgICBwICE9IGIgJiYKICAgICAgICBudWxsICE9IHAgJiYKICAgICAgICAkanNjb21wLmRlZmluZVByb3BlcnR5KGEsIG0sIHsKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAsCiAgICAgICAgICB3cml0YWJsZTogITAsCiAgICAgICAgICB2YWx1ZTogcCwKICAgICAgICB9KQogICAgfQogIH0KICAkanNjb21wLnBvbHlmaWxsKAogICAgIkFycmF5LnByb3RvdHlwZS52YWx1ZXMiLAogICAgZnVuY3Rpb24gKG0pIHsKICAgICAgcmV0dXJuIG0KICAgICAgICA/IG0KICAgICAgICA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuICRqc2NvbXAuaXRlcmF0b3JGcm9tQXJyYXkodGhpcywgZnVuY3Rpb24gKG0sIGEpIHsKICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICB9KQogICAgICAgICAgfQogICAgfSwKICAgICJlczgiLAogICAgImVzMyIsCiAgKQogIDsoZnVuY3Rpb24gKG0pIHsKICAgIGZ1bmN0aW9uIHAoYikgewogICAgICBpZiAoYVtiXSkgcmV0dXJuIGFbYl0uZXhwb3J0cwogICAgICB2YXIgYyA9IChhW2JdID0geyBpOiBiLCBsOiAhMSwgZXhwb3J0czoge30gfSkKICAgICAgbVtiXS5jYWxsKGMuZXhwb3J0cywgYywgYy5leHBvcnRzLCBwKQogICAgICBjLmwgPSAhMAogICAgICByZXR1cm4gYy5leHBvcnRzCiAgICB9CiAgICB2YXIgYSA9IHt9CiAgICBwLm0gPSBtCiAgICBwLmMgPSBhCiAgICBwLmQgPSBmdW5jdGlvbiAoYSwgYywgZCkgewogICAgICBwLm8oYSwgYykgfHwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGEsIGMsIHsgZW51bWVyYWJsZTogITAsIGdldDogZCB9KQogICAgfQogICAgcC5yID0gZnVuY3Rpb24gKGEpIHsKICAgICAgInVuZGVmaW5lZCIgIT09IHR5cGVvZiBTeW1ib2wgJiYKICAgICAgICBTeW1ib2wudG9TdHJpbmdUYWcgJiYKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYSwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAiTW9kdWxlIiB9KQogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiAhMCB9KQogICAgfQogICAgcC50ID0gZnVuY3Rpb24gKGEsIGMpIHsKICAgICAgYyAmIDEgJiYgKGEgPSBwKGEpKQogICAgICBpZiAoYyAmIDgpIHJldHVybiBhCiAgICAgIGlmIChjICYgNCAmJiAib2JqZWN0IiA9PT0gdHlwZW9mIGEgJiYgYSAmJiBhLl9fZXNNb2R1bGUpIHJldHVybiBhCiAgICAgIHZhciBiID0gT2JqZWN0LmNyZWF0ZShudWxsKQogICAgICBwLnIoYikKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGIsICJkZWZhdWx0IiwgeyBlbnVtZXJhYmxlOiAhMCwgdmFsdWU6IGEgfSkKICAgICAgaWYgKGMgJiAyICYmICJzdHJpbmciICE9IHR5cGVvZiBhKQogICAgICAgIGZvciAodmFyIGUgaW4gYSkKICAgICAgICAgIHAuZCgKICAgICAgICAgICAgYiwKICAgICAgICAgICAgZSwKICAgICAgICAgICAgZnVuY3Rpb24gKGIpIHsKICAgICAgICAgICAgICByZXR1cm4gYVtiXQogICAgICAgICAgICB9LmJpbmQobnVsbCwgZSksCiAgICAgICAgICApCiAgICAgIHJldHVybiBiCiAgICB9CiAgICBwLm4gPSBmdW5jdGlvbiAoYSkgewogICAgICB2YXIgYiA9CiAgICAgICAgYSAmJiBhLl9fZXNNb2R1bGUKICAgICAgICAgID8gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBhWyJkZWZhdWx0Il0KICAgICAgICAgICAgfQogICAgICAgICAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgfQogICAgICBwLmQoYiwgImEiLCBiKQogICAgICByZXR1cm4gYgogICAgfQogICAgcC5vID0gZnVuY3Rpb24gKGEsIGMpIHsKICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChhLCBjKQogICAgfQogICAgcC5wID0gIiIKICAgIHJldHVybiBwKChwLnMgPSAxKSkKICB9KShbCiAgICBmdW5jdGlvbiAobSwgcCkgewogICAgICBwID0gKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9KSgpCiAgICAgIHRyeSB7CiAgICAgICAgcCA9IHAgfHwgbmV3IEZ1bmN0aW9uKCJyZXR1cm4gdGhpcyIpKCkKICAgICAgfSBjYXRjaCAoYSkgewogICAgICAgICJvYmplY3QiID09PSB0eXBlb2Ygd2luZG93ICYmIChwID0gd2luZG93KQogICAgICB9CiAgICAgIG0uZXhwb3J0cyA9IHAKICAgIH0sCiAgICBmdW5jdGlvbiAobSwgcCwgYSkgewogICAgICBhKDIpCiAgICAgIFNrLmdsb2JhbC5zdHJmdGltZSA9IGEoMykKICAgICAgU2suZ2xvYmFsLnN0cnB0aW1lID0gYSg0KQogICAgICBhKDUpCiAgICAgIGEoNykKICAgICAgYSg4KQogICAgICBhKDkpCiAgICAgIGEoMTApCiAgICAgIGEoMTEpCiAgICAgIGEoMTIpCiAgICAgIGEoMTMpCiAgICAgIGEoMTQpCiAgICAgIGEoMTUpCiAgICAgIGEoMTYpCiAgICAgIGEoMTcpCiAgICAgIGEoMTgpCiAgICAgIGEoMTkpCiAgICAgIGEoMjApCiAgICAgIGEoMjEpCiAgICAgIGEoMjIpCiAgICAgIGEoMjMpCiAgICAgIGEoMjQpCiAgICAgIGEoMjUpCiAgICAgIGEoMjYpCiAgICAgIGEoMjcpCiAgICAgIGEoMjgpCiAgICAgIGEoMjkpCiAgICAgIGEoMzApCiAgICAgIGEoMzEpCiAgICAgIGEoMzIpCiAgICAgIGEoMzMpCiAgICAgIGEoMzQpCiAgICAgIGEoMzUpCiAgICAgIGEoMzYpCiAgICAgIGEoMzcpCiAgICAgIGEoMzgpCiAgICAgIGEoMzkpCiAgICAgIGEoNDApCiAgICAgIGEoNDEpCiAgICAgIGEoNDIpCiAgICAgIGEoNDMpCiAgICAgIGEoNDQpCiAgICAgIGEoNDUpCiAgICAgIGEoNDYpCiAgICAgIGEoNDcpCiAgICAgIGEoNDgpCiAgICAgIGEoNDkpCiAgICAgIGEoNTApCiAgICAgIGEoNTEpCiAgICAgIGEoNTIpCiAgICAgIGEoNTMpCiAgICAgIGEoNTQpCiAgICAgIGEoNTUpCiAgICAgIGEoNTYpCiAgICAgIGEoNTcpCiAgICAgIGEoNTgpCiAgICAgIGEoNTkpCiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHAsIGEpIHsKICAgICAgOyhmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0gewogICAgICAgICAgYnVpbGQ6IHsKICAgICAgICAgICAgZ2l0aGFzaDogIjIyYzM4Y2IwM2QzN2FmNmVjMDFjMDdlMmU0ZTE3YzRhY2RjM2UwMWYiLAogICAgICAgICAgICBkYXRlOiAiMjAxOS0xMi0xMlQyMDo0OTowNi40OTBaIiwKICAgICAgICAgIH0sCiAgICAgICAgfQogICAgICAgIGIuZ2xvYmFsID0KICAgICAgICAgICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgYQogICAgICAgICAgICA/IGEKICAgICAgICAgICAgOiAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIHNlbGYKICAgICAgICAgICAgPyBzZWxmCiAgICAgICAgICAgIDogInVuZGVmaW5lZCIgIT09IHR5cGVvZiB3aW5kb3cKICAgICAgICAgICAgPyB3aW5kb3cKICAgICAgICAgICAgOiB7fQogICAgICAgIGIuZXhwb3J0U3ltYm9sID0gZnVuY3Rpb24gKGEsIGMpIHsKICAgICAgICAgIGEgPSBhLnNwbGl0KCIuIikKICAgICAgICAgIHZhciBkID0gYi5nbG9iYWwsCiAgICAgICAgICAgIGUKICAgICAgICAgIGZvciAoZSA9IDA7IGUgPCBhLmxlbmd0aCAtIDE7IGUrKykgewogICAgICAgICAgICB2YXIgaCA9IGFbZV0KICAgICAgICAgICAgZCA9IGQuaGFzT3duUHJvcGVydHkoaCkgPyBkW2hdIDogKGRbaF0gPSB7fSkKICAgICAgICAgIH0KICAgICAgICAgICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgYyAmJiAoKGggPSBhW2VdKSwgKGRbaF0gPSBjKSkKICAgICAgICB9CiAgICAgICAgYi5pc0FycmF5TGlrZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIEFycmF5IHx8CiAgICAgICAgICAgIChhICYmIGEubGVuZ3RoICYmICJudW1iZXIiID09IHR5cGVvZiBhLmxlbmd0aCkKICAgICAgICAgICAgPyAhMAogICAgICAgICAgICA6ICExCiAgICAgICAgfQogICAgICAgIGIuanNfYmVhdXRpZnkgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEKICAgICAgICB9CiAgICAgICAgYi5leHBvcnRTeW1ib2woIlNrIiwgYikKICAgICAgICBiLmV4cG9ydFN5bWJvbCgiU2suZ2xvYmFsIiwgYi5nbG9iYWwpCiAgICAgICAgYi5leHBvcnRTeW1ib2woIlNrLmJ1aWxkIiwgYi5idWlsZCkKICAgICAgICBiLmV4cG9ydFN5bWJvbCgiU2suZXhwb3J0U3ltYm9sIiwgYi5leHBvcnRTeW1ib2wpCiAgICAgICAgYi5leHBvcnRTeW1ib2woIlNrLmlzQXJyYXlMaWtlIiwgYi5pc0FycmF5TGlrZSkKICAgICAgICBiLmV4cG9ydFN5bWJvbCgiU2suanNfYmVhdXRpZnkiLCBiLmpzX2JlYXV0aWZ5KQogICAgICB9LmNhbGwodGhpcywgYSgwKSkpCiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHApIHsKICAgICAgOyhmdW5jdGlvbiAoKSB7CiAgICAgICAgZnVuY3Rpb24gYShsLCByLCBEKSB7CiAgICAgICAgICBmdW5jdGlvbiBuKGEsIGssIGwsIHIpIHsKICAgICAgICAgICAgZm9yICgKICAgICAgICAgICAgICB2YXIgaCA9ICIiLCBxID0gbnVsbCwgeCA9ICExLCBEID0gYS5sZW5ndGgsIEggPSAhMSwgcCA9IDA7CiAgICAgICAgICAgICAgcCA8IEQ7CiAgICAgICAgICAgICAgcCsrCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgIHZhciBCID0gYS5jaGFyQ29kZUF0KHApCiAgICAgICAgICAgICAgaWYgKCEwID09PSB4KQogICAgICAgICAgICAgICAgaWYgKDQ1ID09PSBCKSBxID0gIiIKICAgICAgICAgICAgICAgIGVsc2UgaWYgKDk1ID09PSBCKSBxID0gIiAiCiAgICAgICAgICAgICAgICBlbHNlIGlmICg0OCA9PT0gQikgcSA9ICIwIgogICAgICAgICAgICAgICAgZWxzZSBpZiAoNTggPT09IEIpCiAgICAgICAgICAgICAgICAgIEggJiYKICAgICAgICAgICAgICAgICAgICBnKAogICAgICAgICAgICAgICAgICAgICAgIltXQVJOSU5HXSBkZXRlY3RlZCB1c2Ugb2YgdW5zdXBwb3J0ZWQgJTo6IG9yICU6OjogbW9kaWZpZXJzIHRvIHN0cmZ0aW1lIiwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIChIID0gITApCiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgc3dpdGNoIChCKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzNzoKICAgICAgICAgICAgICAgICAgICAgIGggKz0gIiUiCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgNjU6CiAgICAgICAgICAgICAgICAgICAgICBoICs9IGwuZGF5c1trLmdldERheSgpXQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDY2OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBsLm1vbnRoc1trLmdldE1vbnRoKCldCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgNjc6CiAgICAgICAgICAgICAgICAgICAgICBoICs9IGIoTWF0aC5mbG9vcihrLmdldEZ1bGxZZWFyKCkgLyAxMDApLCBxKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDY4OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBuKGwuZm9ybWF0cy5ELCBrLCBsLCByKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDcwOgogICAgICAgICAgICAgICAgICAgICAgaCArPSBuKGwuZm9ybWF0cy5GLCBrLCBsLCByKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDcyOgogICAgICAgICAgICAgICAgICAgICAgaCArPSBiKGsuZ2V0SG91cnMoKSwgcSkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSA3MzoKICAgICAgICAgICAgICAgICAgICAgIGggKz0gYihkKGsuZ2V0SG91cnMoKSksIHEpCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgNzY6CiAgICAgICAgICAgICAgICAgICAgICBoICs9IGMoTWF0aC5mbG9vcihyICUgMWUzKSkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSA3NzoKICAgICAgICAgICAgICAgICAgICAgIGggKz0gYihrLmdldE1pbnV0ZXMoKSwgcSkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSA4MDoKICAgICAgICAgICAgICAgICAgICAgIGggKz0gMTIgPiBrLmdldEhvdXJzKCkgPyBsLmFtIDogbC5wbQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDgyOgogICAgICAgICAgICAgICAgICAgICAgaCArPSBuKGwuZm9ybWF0cy5SLCBrLCBsLCByKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDgzOgogICAgICAgICAgICAgICAgICAgICAgaCArPSBiKGsuZ2V0U2Vjb25kcygpLCBxKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDg0OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBuKGwuZm9ybWF0cy5ULCBrLCBsLCByKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDg1OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBiKGUoaywgInN1bmRheSIpLCBxKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDg3OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBiKGUoaywgIm1vbmRheSIpLCBxKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDg4OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBuKGwuZm9ybWF0cy5YLCBrLCBsLCByKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDg5OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBrLmdldEZ1bGxZZWFyKCkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSA5MDoKICAgICAgICAgICAgICAgICAgICAgIEEgJiYgMCA9PT0gbQogICAgICAgICAgICAgICAgICAgICAgICA/IChoICs9ICJHTVQiKQogICAgICAgICAgICAgICAgICAgICAgICA6ICgocSA9IGsudG9TdHJpbmcoKS5tYXRjaCgvXCgoW1x3XHNdKylcKS8pKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAoaCArPSAocSAmJiBxWzFdKSB8fCAiIikpCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgOTc6CiAgICAgICAgICAgICAgICAgICAgICBoICs9IGwuc2hvcnREYXlzW2suZ2V0RGF5KCldCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgOTg6CiAgICAgICAgICAgICAgICAgICAgICBoICs9IGwuc2hvcnRNb250aHNbay5nZXRNb250aCgpXQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDk5OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBuKGwuZm9ybWF0cy5jLCBrLCBsLCByKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwMDoKICAgICAgICAgICAgICAgICAgICAgIGggKz0gYihrLmdldERhdGUoKSwgcSkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDE6CiAgICAgICAgICAgICAgICAgICAgICBoICs9IGIoay5nZXREYXRlKCksIG51bGwgPT0gcSA/ICIgIiA6IHEpCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA0OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBsLnNob3J0TW9udGhzW2suZ2V0TW9udGgoKV0KICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDY6CiAgICAgICAgICAgICAgICAgICAgICBxID0gbmV3IERhdGUoay5nZXRGdWxsWWVhcigpLCAwLCAxKQogICAgICAgICAgICAgICAgICAgICAgcSA9IE1hdGguY2VpbCgoay5nZXRUaW1lKCkgLSBxLmdldFRpbWUoKSkgLyA4NjRlNSkKICAgICAgICAgICAgICAgICAgICAgIGggKz0gYyhxKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDEwNzoKICAgICAgICAgICAgICAgICAgICAgIGggKz0gYihrLmdldEhvdXJzKCksIG51bGwgPT0gcSA/ICIgIiA6IHEpCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgMTA4OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBiKGQoay5nZXRIb3VycygpKSwgbnVsbCA9PSBxID8gIiAiIDogcSkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDk6CiAgICAgICAgICAgICAgICAgICAgICBoICs9IGIoay5nZXRNb250aCgpICsgMSwgcSkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTA6CiAgICAgICAgICAgICAgICAgICAgICBoICs9ICJcbiIKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTE6CiAgICAgICAgICAgICAgICAgICAgICBxID0gay5nZXREYXRlKCkKICAgICAgICAgICAgICAgICAgICAgIGggPSBsLm9yZGluYWxTdWZmaXhlcwogICAgICAgICAgICAgICAgICAgICAgICA/IGggKyAoU3RyaW5nKHEpICsgKGwub3JkaW5hbFN1ZmZpeGVzW3EgLSAxXSB8fCBmKHEpKSkKICAgICAgICAgICAgICAgICAgICAgICAgOiBoICsgKFN0cmluZyhxKSArIGYocSkpCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgMTEyOgogICAgICAgICAgICAgICAgICAgICAgaCArPSAxMiA+IGsuZ2V0SG91cnMoKSA/IGwuQU0gOiBsLlBNCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgMTE0OgogICAgICAgICAgICAgICAgICAgICAgaCArPSBuKGwuZm9ybWF0cy5yLCBrLCBsLCByKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExNToKICAgICAgICAgICAgICAgICAgICAgIGggKz0gTWF0aC5mbG9vcihyIC8gMWUzKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExNjoKICAgICAgICAgICAgICAgICAgICAgIGggKz0gIlx0IgogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExNzoKICAgICAgICAgICAgICAgICAgICAgIHEgPSBrLmdldERheSgpCiAgICAgICAgICAgICAgICAgICAgICBoICs9IDAgPT09IHEgPyA3IDogcQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDExODoKICAgICAgICAgICAgICAgICAgICAgIGggKz0gbihsLmZvcm1hdHMudiwgaywgbCwgcikKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTk6CiAgICAgICAgICAgICAgICAgICAgICBoICs9IGsuZ2V0RGF5KCkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSAxMjA6CiAgICAgICAgICAgICAgICAgICAgICBoICs9IG4obC5mb3JtYXRzLngsIGssIGwsIHIpCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgMTIxOgogICAgICAgICAgICAgICAgICAgICAgaCArPSAoIiIgKyBrLmdldEZ1bGxZZWFyKCkpLnNsaWNlKDIpCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgMTIyOgogICAgICAgICAgICAgICAgICAgICAgQSAmJiAwID09PSBtCiAgICAgICAgICAgICAgICAgICAgICAgID8gKGggKz0gSCA/ICIrMDA6MDAiIDogIiswMDAwIikKICAgICAgICAgICAgICAgICAgICAgICAgOiAoKHEgPSAwICE9PSBtID8gbSAvIDZlNCA6IC1rLmdldFRpbWV6b25lT2Zmc2V0KCkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICh4ID0gSCA/ICI6IiA6ICIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAoQiA9IE1hdGguYWJzKHEgJSA2MCkpLAogICAgICAgICAgICAgICAgICAgICAgICAgIChoICs9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoMCA+IHEgPyAiLSIgOiAiKyIpICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIoTWF0aC5mbG9vcihNYXRoLmFicyhxIC8gNjApKSkgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgeCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiKEIpKSkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgIHggJiYgKGggKz0gIiUiKSwgKGggKz0gYVtwXSkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBxID0gbnVsbAogICAgICAgICAgICAgICAgICB4ID0gITEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIDM3ID09PSBCID8gKHggPSAhMCkgOiAoaCArPSBhW3BdKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBoCiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcSA9IGwgfHwgaywKICAgICAgICAgICAgbSA9IHIgfHwgMCwKICAgICAgICAgICAgQSA9IEQgfHwgITEsCiAgICAgICAgICAgIHAgPSAwLAogICAgICAgICAgICBLLAogICAgICAgICAgICBCID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICBpZiAoYikgewogICAgICAgICAgICAgICAgdmFyIGMgPSBiLmdldFRpbWUoKQogICAgICAgICAgICAgICAgaWYgKEEpIHsKICAgICAgICAgICAgICAgICAgdmFyIGQgPSA2ZTQgKiAoYi5nZXRUaW1lem9uZU9mZnNldCgpIHx8IDApCiAgICAgICAgICAgICAgICAgIGIgPSBuZXcgRGF0ZShjICsgZCArIG0pCiAgICAgICAgICAgICAgICAgIDZlNCAqIChiLmdldFRpbWV6b25lT2Zmc2V0KCkgfHwgMCkgIT09IGQgJiYKICAgICAgICAgICAgICAgICAgICAoKGIgPSA2ZTQgKiAoYi5nZXRUaW1lem9uZU9mZnNldCgpIHx8IDApKSwKICAgICAgICAgICAgICAgICAgICAoYiA9IG5ldyBEYXRlKGMgKyBiICsgbSkpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgKGMgPSBEYXRlLm5vdygpKSwKICAgICAgICAgICAgICAgICAgYyA+IHAKICAgICAgICAgICAgICAgICAgICA/ICgocCA9IGMpLAogICAgICAgICAgICAgICAgICAgICAgKEsgPSBuZXcgRGF0ZShwKSksCiAgICAgICAgICAgICAgICAgICAgICAoYyA9IHApLAogICAgICAgICAgICAgICAgICAgICAgQSAmJgogICAgICAgICAgICAgICAgICAgICAgICAoSyA9IG5ldyBEYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAgIHAgKyA2ZTQgKiAoSy5nZXRUaW1lem9uZU9mZnNldCgpIHx8IDApICsgbSwKICAgICAgICAgICAgICAgICAgICAgICAgKSkpCiAgICAgICAgICAgICAgICAgICAgOiAoYyA9IHApLAogICAgICAgICAgICAgICAgICAoYiA9IEspCiAgICAgICAgICAgICAgcmV0dXJuIG4oYSwgYiwgcSwgYykKICAgICAgICAgICAgfQogICAgICAgICAgQi5sb2NhbGl6ZSA9IGZ1bmN0aW9uIChiKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgYShiIHx8IHEsIG0sIEEpCiAgICAgICAgICB9CiAgICAgICAgICBCLmxvY2FsaXplQnlJZGVudGlmaWVyID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgdmFyIGIgPSBoW2FdCiAgICAgICAgICAgIHJldHVybiBiCiAgICAgICAgICAgICAgPyBCLmxvY2FsaXplKGIpCiAgICAgICAgICAgICAgOiAoZygnW1dBUk5JTkddIE5vIGxvY2FsZSBmb3VuZCB3aXRoIGlkZW50aWZpZXIgIicgKyBhICsgJyIuJyksIEIpCiAgICAgICAgICB9CiAgICAgICAgICBCLnRpbWV6b25lID0gZnVuY3Rpb24gKGIpIHsKICAgICAgICAgICAgdmFyIGMgPSBtLAogICAgICAgICAgICAgIGQgPSBBLAogICAgICAgICAgICAgIGUgPSB0eXBlb2YgYgogICAgICAgICAgICBpZiAoIm51bWJlciIgPT09IGUgfHwgInN0cmluZyIgPT09IGUpCiAgICAgICAgICAgICAgKGQgPSAhMCksCiAgICAgICAgICAgICAgICAic3RyaW5nIiA9PT0gZQogICAgICAgICAgICAgICAgICA/ICgoYyA9ICItIiA9PT0gYlswXSA/IC0xIDogMSksCiAgICAgICAgICAgICAgICAgICAgKGUgPSBwYXJzZUludChiLnNsaWNlKDEsIDMpLCAxMCkpLAogICAgICAgICAgICAgICAgICAgIChiID0gcGFyc2VJbnQoYi5zbGljZSgzLCA1KSwgMTApKSwKICAgICAgICAgICAgICAgICAgICAoYyA9IGMgKiAoNjAgKiBlICsgYikgKiA2ZTQpKQogICAgICAgICAgICAgICAgICA6ICJudW1iZXIiID09PSBlICYmIChjID0gNmU0ICogYikKICAgICAgICAgICAgcmV0dXJuIG5ldyBhKHEsIGMsIGQpCiAgICAgICAgICB9CiAgICAgICAgICBCLnV0YyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBhKHEsIG0sICEwKQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIEIKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYihhLCBiKSB7CiAgICAgICAgICBpZiAoIiIgPT09IGIgfHwgOSA8IGEpIHJldHVybiBhCiAgICAgICAgICBudWxsID09IGIgJiYgKGIgPSAiMCIpCiAgICAgICAgICByZXR1cm4gYiArIGEKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYyhhKSB7CiAgICAgICAgICByZXR1cm4gOTkgPCBhID8gYSA6IDkgPCBhID8gIjAiICsgYSA6ICIwMCIgKyBhCiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGQoYSkgewogICAgICAgICAgcmV0dXJuIDAgPT09IGEgPyAxMiA6IDEyIDwgYSA/IGEgLSAxMiA6IGEKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZShhLCBiKSB7CiAgICAgICAgICBiID0gYiB8fCAic3VuZGF5IgogICAgICAgICAgdmFyIGMgPSBhLmdldERheSgpCiAgICAgICAgICAibW9uZGF5IiA9PT0gYiAmJiAoMCA9PT0gYyA/IChjID0gNikgOiBjLS0pCiAgICAgICAgICBiID0gRGF0ZS5VVEMoYS5nZXRGdWxsWWVhcigpLCAwLCAxKQogICAgICAgICAgYSA9IERhdGUuVVRDKGEuZ2V0RnVsbFllYXIoKSwgYS5nZXRNb250aCgpLCBhLmdldERhdGUoKSkKICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKChNYXRoLmZsb29yKChhIC0gYikgLyA4NjRlNSkgKyA3IC0gYykgLyA3KQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBmKGEpIHsKICAgICAgICAgIHZhciBiID0gYSAlIDEwCiAgICAgICAgICBhICU9IDEwMAogICAgICAgICAgaWYgKCgxMSA8PSBhICYmIDEzID49IGEpIHx8IDAgPT09IGIgfHwgNCA8PSBiKSByZXR1cm4gInRoIgogICAgICAgICAgc3dpdGNoIChiKSB7CiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICByZXR1cm4gInN0IgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgcmV0dXJuICJuZCIKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIHJldHVybiAicmQiCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGcoYSkgewogICAgICAgICAgInVuZGVmaW5lZCIgIT09IHR5cGVvZiBjb25zb2xlICYmCiAgICAgICAgICAgICJmdW5jdGlvbiIgPT0gdHlwZW9mIGNvbnNvbGUud2FybiAmJgogICAgICAgICAgICBjb25zb2xlLndhcm4oYSkKICAgICAgICB9CiAgICAgICAgdmFyIGggPSB7CiAgICAgICAgICAgIGRlX0RFOiB7CiAgICAgICAgICAgICAgZGF5czogIlNvbm50YWcgTW9udGFnIERpZW5zdGFnIE1pdHR3b2NoIERvbm5lcnN0YWcgRnJlaXRhZyBTYW1zdGFnIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIHNob3J0RGF5czogIlNvIE1vIERpIE1pIERvIEZyIFNhIi5zcGxpdCgiICIpLAogICAgICAgICAgICAgIG1vbnRoczogIkphbnVhciBGZWJydWFyIE1cdTAwZTRyeiBBcHJpbCBNYWkgSnVuaSBKdWxpIEF1Z3VzdCBTZXB0ZW1iZXIgT2t0b2JlciBOb3ZlbWJlciBEZXplbWJlciIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBzaG9ydE1vbnRoczogIkphbiBGZWIgTVx1MDBlNHIgQXByIE1haSBKdW4gSnVsIEF1ZyBTZXAgT2t0IE5vdiBEZXoiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgQU06ICJBTSIsCiAgICAgICAgICAgICAgUE06ICJQTSIsCiAgICAgICAgICAgICAgYW06ICJhbSIsCiAgICAgICAgICAgICAgcG06ICJwbSIsCiAgICAgICAgICAgICAgZm9ybWF0czogewogICAgICAgICAgICAgICAgYzogIiVhICVkICViICVZICVYICVaIiwKICAgICAgICAgICAgICAgIEQ6ICIlZC4lbS4lWSIsCiAgICAgICAgICAgICAgICBGOiAiJVktJW0tJWQiLAogICAgICAgICAgICAgICAgUjogIiVIOiVNIiwKICAgICAgICAgICAgICAgIHI6ICIlSTolTTolUyAlcCIsCiAgICAgICAgICAgICAgICBUOiAiJUg6JU06JVMiLAogICAgICAgICAgICAgICAgdjogIiVlLSViLSVZIiwKICAgICAgICAgICAgICAgIFg6ICIlVCIsCiAgICAgICAgICAgICAgICB4OiAiJUQiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuX0NBOiB7CiAgICAgICAgICAgICAgZGF5czogIlN1bmRheSBNb25kYXkgVHVlc2RheSBXZWRuZXNkYXkgVGh1cnNkYXkgRnJpZGF5IFNhdHVyZGF5Ii5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIHNob3J0RGF5czogIlN1biBNb24gVHVlIFdlZCBUaHUgRnJpIFNhdCIuc3BsaXQoIiAiKSwKICAgICAgICAgICAgICBtb250aHM6ICJKYW51YXJ5IEZlYnJ1YXJ5IE1hcmNoIEFwcmlsIE1heSBKdW5lIEp1bHkgQXVndXN0IFNlcHRlbWJlciBPY3RvYmVyIE5vdmVtYmVyIERlY2VtYmVyIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIHNob3J0TW9udGhzOiAiSmFuIEZlYiBNYXIgQXByIE1heSBKdW4gSnVsIEF1ZyBTZXAgT2N0IE5vdiBEZWMiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgb3JkaW5hbFN1ZmZpeGVzOiAic3QgbmQgcmQgdGggdGggdGggdGggdGggdGggdGggdGggdGggdGggdGggdGggdGggdGggdGggdGggdGggc3QgbmQgcmQgdGggdGggdGggdGggdGggdGggdGggc3QiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgQU06ICJBTSIsCiAgICAgICAgICAgICAgUE06ICJQTSIsCiAgICAgICAgICAgICAgYW06ICJhbSIsCiAgICAgICAgICAgICAgcG06ICJwbSIsCiAgICAgICAgICAgICAgZm9ybWF0czogewogICAgICAgICAgICAgICAgYzogIiVhICVkICViICVZICVYICVaIiwKICAgICAgICAgICAgICAgIEQ6ICIlZC8lbS8leSIsCiAgICAgICAgICAgICAgICBGOiAiJVktJW0tJWQiLAogICAgICAgICAgICAgICAgUjogIiVIOiVNIiwKICAgICAgICAgICAgICAgIHI6ICIlSTolTTolUyAlcCIsCiAgICAgICAgICAgICAgICBUOiAiJUg6JU06JVMiLAogICAgICAgICAgICAgICAgdjogIiVlLSViLSVZIiwKICAgICAgICAgICAgICAgIFg6ICIlciIsCiAgICAgICAgICAgICAgICB4OiAiJUQiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVuX1VTOiB7CiAgICAgICAgICAgICAgZGF5czogIlN1bmRheSBNb25kYXkgVHVlc2RheSBXZWRuZXNkYXkgVGh1cnNkYXkgRnJpZGF5IFNhdHVyZGF5Ii5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIHNob3J0RGF5czogIlN1biBNb24gVHVlIFdlZCBUaHUgRnJpIFNhdCIuc3BsaXQoIiAiKSwKICAgICAgICAgICAgICBtb250aHM6ICJKYW51YXJ5IEZlYnJ1YXJ5IE1hcmNoIEFwcmlsIE1heSBKdW5lIEp1bHkgQXVndXN0IFNlcHRlbWJlciBPY3RvYmVyIE5vdmVtYmVyIERlY2VtYmVyIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIHNob3J0TW9udGhzOiAiSmFuIEZlYiBNYXIgQXByIE1heSBKdW4gSnVsIEF1ZyBTZXAgT2N0IE5vdiBEZWMiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgb3JkaW5hbFN1ZmZpeGVzOiAic3QgbmQgcmQgdGggdGggdGggdGggdGggdGggdGggdGggdGggdGggdGggdGggdGggdGggdGggdGggdGggc3QgbmQgcmQgdGggdGggdGggdGggdGggdGggdGggc3QiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgQU06ICJBTSIsCiAgICAgICAgICAgICAgUE06ICJQTSIsCiAgICAgICAgICAgICAgYW06ICJhbSIsCiAgICAgICAgICAgICAgcG06ICJwbSIsCiAgICAgICAgICAgICAgZm9ybWF0czogewogICAgICAgICAgICAgICAgYzogIiVhICVkICViICVZICVYICVaIiwKICAgICAgICAgICAgICAgIEQ6ICIlbS8lZC8leSIsCiAgICAgICAgICAgICAgICBGOiAiJVktJW0tJWQiLAogICAgICAgICAgICAgICAgUjogIiVIOiVNIiwKICAgICAgICAgICAgICAgIHI6ICIlSTolTTolUyAlcCIsCiAgICAgICAgICAgICAgICBUOiAiJUg6JU06JVMiLAogICAgICAgICAgICAgICAgdjogIiVlLSViLSVZIiwKICAgICAgICAgICAgICAgIFg6ICIlciIsCiAgICAgICAgICAgICAgICB4OiAiJUQiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVzX01YOiB7CiAgICAgICAgICAgICAgZGF5czogImRvbWluZ28gbHVuZXMgbWFydGVzIG1pXHUwMGU5cmNvbGVzIGp1ZXZlcyB2aWVybmVzIHNcdTAwZTFiYWRvIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIHNob3J0RGF5czogImRvbSBsdW4gbWFyIG1pXHUwMGU5IGp1ZSB2aWUgc1x1MDBlMWIiLnNwbGl0KCIgIiksCiAgICAgICAgICAgICAgbW9udGhzOiAiZW5lcm87ZmVicmVybzttYXJ6bzthYnJpbDttYXlvO2p1bmlvO2p1bGlvO2Fnb3N0bztzZXB0aWVtYnJlO29jdHVicmU7bm92aWVtYnJlOyBkaWNpZW1icmUiLnNwbGl0KAogICAgICAgICAgICAgICAgIjsiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgc2hvcnRNb250aHM6ICJlbmUgZmViIG1hciBhYnIgbWF5IGp1biBqdWwgYWdvIHNlcCBvY3Qgbm92IGRpYyIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBBTTogIkFNIiwKICAgICAgICAgICAgICBQTTogIlBNIiwKICAgICAgICAgICAgICBhbTogImFtIiwKICAgICAgICAgICAgICBwbTogInBtIiwKICAgICAgICAgICAgICBmb3JtYXRzOiB7CiAgICAgICAgICAgICAgICBjOiAiJWEgJWQgJWIgJVkgJVggJVoiLAogICAgICAgICAgICAgICAgRDogIiVkLyVtLyVZIiwKICAgICAgICAgICAgICAgIEY6ICIlWS0lbS0lZCIsCiAgICAgICAgICAgICAgICBSOiAiJUg6JU0iLAogICAgICAgICAgICAgICAgcjogIiVJOiVNOiVTICVwIiwKICAgICAgICAgICAgICAgIFQ6ICIlSDolTTolUyIsCiAgICAgICAgICAgICAgICB2OiAiJWUtJWItJVkiLAogICAgICAgICAgICAgICAgWDogIiVUIiwKICAgICAgICAgICAgICAgIHg6ICIlRCIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZnJfRlI6IHsKICAgICAgICAgICAgICBkYXlzOiAiZGltYW5jaGUgbHVuZGkgbWFyZGkgbWVyY3JlZGkgamV1ZGkgdmVuZHJlZGkgc2FtZWRpIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIHNob3J0RGF5czogImRpbS4gbHVuLiBtYXIuIG1lci4gamV1LiB2ZW4uIHNhbS4iLnNwbGl0KCIgIiksCiAgICAgICAgICAgICAgbW9udGhzOiAiamFudmllciBmXHUwMGU5dnJpZXIgbWFycyBhdnJpbCBtYWkganVpbiBqdWlsbGV0IGFvXHUwMGZidCBzZXB0ZW1icmUgb2N0b2JyZSBub3ZlbWJyZSBkXHUwMGU5Y2VtYnJlIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIHNob3J0TW9udGhzOiAiamFudi4gZlx1MDBlOXZyLiBtYXJzIGF2cmlsIG1haSBqdWluIGp1aWwuIGFvXHUwMGZidCBzZXB0LiBvY3QuIG5vdi4gZFx1MDBlOWMuIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIEFNOiAiQU0iLAogICAgICAgICAgICAgIFBNOiAiUE0iLAogICAgICAgICAgICAgIGFtOiAiYW0iLAogICAgICAgICAgICAgIHBtOiAicG0iLAogICAgICAgICAgICAgIGZvcm1hdHM6IHsKICAgICAgICAgICAgICAgIGM6ICIlYSAlZCAlYiAlWSAlWCAlWiIsCiAgICAgICAgICAgICAgICBEOiAiJWQvJW0vJVkiLAogICAgICAgICAgICAgICAgRjogIiVZLSVtLSVkIiwKICAgICAgICAgICAgICAgIFI6ICIlSDolTSIsCiAgICAgICAgICAgICAgICByOiAiJUk6JU06JVMgJXAiLAogICAgICAgICAgICAgICAgVDogIiVIOiVNOiVTIiwKICAgICAgICAgICAgICAgIHY6ICIlZS0lYi0lWSIsCiAgICAgICAgICAgICAgICBYOiAiJVQiLAogICAgICAgICAgICAgICAgeDogIiVEIiwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICBpdF9JVDogewogICAgICAgICAgICAgIGRheXM6ICJkb21lbmljYSBsdW5lZFx1MDBlYyBtYXJ0ZWRcdTAwZWMgbWVyY29sZWRcdTAwZWMgZ2lvdmVkXHUwMGVjIHZlbmVyZFx1MDBlYyBzYWJhdG8iLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgc2hvcnREYXlzOiAiZG9tIGx1biBtYXIgbWVyIGdpbyB2ZW4gc2FiIi5zcGxpdCgiICIpLAogICAgICAgICAgICAgIG1vbnRoczogImdlbm5haW8gZmViYnJhaW8gbWFyem8gYXByaWxlIG1hZ2dpbyBnaXVnbm8gbHVnbGlvIGFnb3N0byBzZXR0ZW1icmUgb3R0b2JyZSBub3ZlbWJyZSBkaWNlbWJyZSIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBzaG9ydE1vbnRoczogInByIG1hZyBnaXUgbHVnIGFnbyBzZXQgb3R0IG5vdiBkaWMiLnNwbGl0KCIgIiksCiAgICAgICAgICAgICAgQU06ICJBTSIsCiAgICAgICAgICAgICAgUE06ICJQTSIsCiAgICAgICAgICAgICAgYW06ICJhbSIsCiAgICAgICAgICAgICAgcG06ICJwbSIsCiAgICAgICAgICAgICAgZm9ybWF0czogewogICAgICAgICAgICAgICAgYzogIiVhICVkICViICVZICVYICVaIiwKICAgICAgICAgICAgICAgIEQ6ICIlZC8lbS8lWSIsCiAgICAgICAgICAgICAgICBGOiAiJVktJW0tJWQiLAogICAgICAgICAgICAgICAgUjogIiVIOiVNIiwKICAgICAgICAgICAgICAgIHI6ICIlSTolTTolUyAlcCIsCiAgICAgICAgICAgICAgICBUOiAiJUg6JU06JVMiLAogICAgICAgICAgICAgICAgdjogIiVlLSViLSVZIiwKICAgICAgICAgICAgICAgIFg6ICIlVCIsCiAgICAgICAgICAgICAgICB4OiAiJUQiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG5sX05MOiB7CiAgICAgICAgICAgICAgZGF5czogInpvbmRhZyBtYWFuZGFnIGRpbnNkYWcgd29lbnNkYWcgZG9uZGVyZGFnIHZyaWpkYWcgemF0ZXJkYWciLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgc2hvcnREYXlzOiAiem8gbWEgZGkgd28gZG8gdnIgemEiLnNwbGl0KCIgIiksCiAgICAgICAgICAgICAgbW9udGhzOiAiamFudWFyaSBmZWJydWFyaSBtYWFydCBhcHJpbCBtZWkganVuaSBqdWxpIGF1Z3VzdHVzIHNlcHRlbWJlciBva3RvYmVyIG5vdmVtYmVyIGRlY2VtYmVyIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIHNob3J0TW9udGhzOiAiamFuIGZlYiBtcnQgYXByIG1laSBqdW4ganVsIGF1ZyBzZXAgb2t0IG5vdiBkZWMiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgQU06ICJBTSIsCiAgICAgICAgICAgICAgUE06ICJQTSIsCiAgICAgICAgICAgICAgYW06ICJhbSIsCiAgICAgICAgICAgICAgcG06ICJwbSIsCiAgICAgICAgICAgICAgZm9ybWF0czogewogICAgICAgICAgICAgICAgYzogIiVhICVkICViICVZICVYICVaIiwKICAgICAgICAgICAgICAgIEQ6ICIlZC0lbS0leSIsCiAgICAgICAgICAgICAgICBGOiAiJVktJW0tJWQiLAogICAgICAgICAgICAgICAgUjogIiVIOiVNIiwKICAgICAgICAgICAgICAgIHI6ICIlSTolTTolUyAlcCIsCiAgICAgICAgICAgICAgICBUOiAiJUg6JU06JVMiLAogICAgICAgICAgICAgICAgdjogIiVlLSViLSVZIiwKICAgICAgICAgICAgICAgIFg6ICIlVCIsCiAgICAgICAgICAgICAgICB4OiAiJUQiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHB0X0JSOiB7CiAgICAgICAgICAgICAgZGF5czogImRvbWluZ28gc2VndW5kYSB0ZXJcdTAwZTdhIHF1YXJ0YSBxdWludGEgc2V4dGEgc1x1MDBlMWJhZG8iLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgc2hvcnREYXlzOiAiRG9tIFNlZyBUZXIgUXVhIFF1aSBTZXggU1x1MDBlMWIiLnNwbGl0KCIgIiksCiAgICAgICAgICAgICAgbW9udGhzOiAiamFuZWlybyBmZXZlcmVpcm8gbWFyXHUwMGU3byBhYnJpbCBtYWlvIGp1bmhvIGp1bGhvIGFnb3N0byBzZXRlbWJybyBvdXR1YnJvIG5vdmVtYnJvIGRlemVtYnJvIi5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIHNob3J0TW9udGhzOiAiSmFuIEZldiBNYXIgQWJyIE1haSBKdW4gSnVsIEFnbyBTZXQgT3V0IE5vdiBEZXoiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgQU06ICJBTSIsCiAgICAgICAgICAgICAgUE06ICJQTSIsCiAgICAgICAgICAgICAgYW06ICJhbSIsCiAgICAgICAgICAgICAgcG06ICJwbSIsCiAgICAgICAgICAgICAgZm9ybWF0czogewogICAgICAgICAgICAgICAgYzogIiVhICVkICViICVZICVYICVaIiwKICAgICAgICAgICAgICAgIEQ6ICIlZC0lbS0lWSIsCiAgICAgICAgICAgICAgICBGOiAiJVktJW0tJWQiLAogICAgICAgICAgICAgICAgUjogIiVIOiVNIiwKICAgICAgICAgICAgICAgIHI6ICIlSTolTTolUyAlcCIsCiAgICAgICAgICAgICAgICBUOiAiJUg6JU06JVMiLAogICAgICAgICAgICAgICAgdjogIiVlLSViLSVZIiwKICAgICAgICAgICAgICAgIFg6ICIlVCIsCiAgICAgICAgICAgICAgICB4OiAiJUQiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJ1X1JVOiB7CiAgICAgICAgICAgICAgZGF5czogIlx1MDQxMlx1MDQzZVx1MDQ0MVx1MDQzYVx1MDQ0MFx1MDQzNVx1MDQ0MVx1MDQzNVx1MDQzZFx1MDQ0Y1x1MDQzNSBcdTA0MWZcdTA0M2VcdTA0M2RcdTA0MzVcdTA0MzRcdTA0MzVcdTA0M2JcdTA0NGNcdTA0M2RcdTA0MzhcdTA0M2EgXHUwNDEyXHUwNDQyXHUwNDNlXHUwNDQwXHUwNDNkXHUwNDM4XHUwNDNhIFx1MDQyMVx1MDQ0MFx1MDQzNVx1MDQzNFx1MDQzMCBcdTA0MjdcdTA0MzVcdTA0NDJcdTA0MzJcdTA0MzVcdTA0NDBcdTA0MzMgXHUwNDFmXHUwNDRmXHUwNDQyXHUwNDNkXHUwNDM4XHUwNDQ2XHUwNDMwIFx1MDQyMVx1MDQ0M1x1MDQzMVx1MDQzMVx1MDQzZVx1MDQ0Mlx1MDQzMCIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBzaG9ydERheXM6ICJcdTA0MTJcdTA0NDEgXHUwNDFmXHUwNDNkIFx1MDQxMlx1MDQ0MiBcdTA0MjFcdTA0NDAgXHUwNDI3XHUwNDQyIFx1MDQxZlx1MDQ0MiBcdTA0MjFcdTA0MzEiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgbW9udGhzOiAiXHUwNDJmXHUwNDNkXHUwNDMyXHUwNDMwXHUwNDQwXHUwNDRjIFx1MDQyNFx1MDQzNVx1MDQzMlx1MDQ0MFx1MDQzMFx1MDQzYlx1MDQ0YyBcdTA0MWNcdTA0MzBcdTA0NDBcdTA0NDIgXHUwNDEwXHUwNDNmXHUwNDQwXHUwNDM1XHUwNDNiXHUwNDRjIFx1MDQxY1x1MDQzMFx1MDQzOSBcdTA0MThcdTA0NGVcdTA0M2RcdTA0NGMgXHUwNDE4XHUwNDRlXHUwNDNiXHUwNDRjIFx1MDQxMFx1MDQzMlx1MDQzM1x1MDQ0M1x1MDQ0MVx1MDQ0MiBcdTA0MjFcdTA0MzVcdTA0M2RcdTA0NDJcdTA0NGZcdTA0MzFcdTA0NDBcdTA0NGMgXHUwNDFlXHUwNDNhXHUwNDQyXHUwNDRmXHUwNDMxXHUwNDQwXHUwNDRjIFx1MDQxZFx1MDQzZVx1MDQ0Zlx1MDQzMVx1MDQ0MFx1MDQ0YyBcdTA0MTRcdTA0MzVcdTA0M2FcdTA0MzBcdTA0MzFcdTA0NDBcdTA0NGMiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgc2hvcnRNb250aHM6ICJcdTA0NGZcdTA0M2RcdTA0MzIgXHUwNDQ0XHUwNDM1XHUwNDMyIFx1MDQzY1x1MDQzMFx1MDQ0MCBcdTA0MzBcdTA0M2ZcdTA0NDAgXHUwNDNjXHUwNDMwXHUwNDM5IFx1MDQzOFx1MDQ0ZVx1MDQzZCBcdTA0MzhcdTA0NGVcdTA0M2IgXHUwNDMwXHUwNDMyXHUwNDMzIFx1MDQ0MVx1MDQzNVx1MDQzZCBcdTA0M2VcdTA0M2FcdTA0NDIgXHUwNDNkXHUwNDNlXHUwNDRmIFx1MDQzNFx1MDQzNVx1MDQzYSIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBBTTogIkFNIiwKICAgICAgICAgICAgICBQTTogIlBNIiwKICAgICAgICAgICAgICBhbTogImFtIiwKICAgICAgICAgICAgICBwbTogInBtIiwKICAgICAgICAgICAgICBmb3JtYXRzOiB7CiAgICAgICAgICAgICAgICBjOiAiJWEgJWQgJWIgJVkgJVgiLAogICAgICAgICAgICAgICAgRDogIiVkLiVtLiV5IiwKICAgICAgICAgICAgICAgIEY6ICIlWS0lbS0lZCIsCiAgICAgICAgICAgICAgICBSOiAiJUg6JU0iLAogICAgICAgICAgICAgICAgcjogIiVJOiVNOiVTICVwIiwKICAgICAgICAgICAgICAgIFQ6ICIlSDolTTolUyIsCiAgICAgICAgICAgICAgICB2OiAiJWUtJWItJVkiLAogICAgICAgICAgICAgICAgWDogIiVUIiwKICAgICAgICAgICAgICAgIHg6ICIlRCIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdHJfVFI6IHsKICAgICAgICAgICAgICBkYXlzOiAiUGF6YXIgUGF6YXJ0ZXNpIFNhbFx1MDEzMSBcdTAwYzdhclx1MDE1ZmFtYmEgUGVyXHUwMTVmZW1iZSBDdW1hIEN1bWFydGVzaSIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBzaG9ydERheXM6ICJQYXogUHp0IFNhbCBcdTAwYzdyXHUwMTVmIFByXHUwMTVmIEN1bSBDdHMiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgbW9udGhzOiAiT2NhayBcdTAxNWV1YmF0IE1hcnQgTmlzYW4gTWF5XHUwMTMxcyBIYXppcmFuIFRlbW11eiBBXHUwMTFmdXN0b3MgRXlsXHUwMGZjbCBFa2ltIEthc1x1MDEzMW0gQXJhbFx1MDEzMWsiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgc2hvcnRNb250aHM6ICJPY2EgXHUwMTVldWIgTWFyIE5pcyBNYXkgSGF6IFRlbSBBXHUwMTFmdSBFeWwgRWtpIEthcyBBcmEiLnNwbGl0KAogICAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgQU06ICJcdTAwZDZcdTAwZDYiLAogICAgICAgICAgICAgIFBNOiAiXHUwMGQ2UyIsCiAgICAgICAgICAgICAgYW06ICJcdTAwZDZcdTAwZDYiLAogICAgICAgICAgICAgIHBtOiAiXHUwMGQ2UyIsCiAgICAgICAgICAgICAgZm9ybWF0czogewogICAgICAgICAgICAgICAgYzogIiVhICVkICViICVZICVYICVaIiwKICAgICAgICAgICAgICAgIEQ6ICIlZC0lbS0lWSIsCiAgICAgICAgICAgICAgICBGOiAiJVktJW0tJWQiLAogICAgICAgICAgICAgICAgUjogIiVIOiVNIiwKICAgICAgICAgICAgICAgIHI6ICIlSTolTTolUyAlcCIsCiAgICAgICAgICAgICAgICBUOiAiJUg6JU06JVMiLAogICAgICAgICAgICAgICAgdjogIiVlLSViLSVZIiwKICAgICAgICAgICAgICAgIFg6ICIlVCIsCiAgICAgICAgICAgICAgICB4OiAiJUQiLAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHpoX0NOOiB7CiAgICAgICAgICAgICAgZGF5czogIlx1NjYxZlx1NjcxZlx1NjVlNSBcdTY2MWZcdTY3MWZcdTRlMDAgXHU2NjFmXHU2NzFmXHU0ZThjIFx1NjYxZlx1NjcxZlx1NGUwOSBcdTY2MWZcdTY3MWZcdTU2ZGIgXHU2NjFmXHU2NzFmXHU0ZTk0IFx1NjYxZlx1NjcxZlx1NTE2ZCIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBzaG9ydERheXM6ICJcdTY1ZTVcdTRlMDBcdTRlOGNcdTRlMDlcdTU2ZGJcdTRlOTRcdTUxNmQiLnNwbGl0KCIiKSwKICAgICAgICAgICAgICBtb250aHM6ICJcdTRlMDBcdTY3MDhcdTRlZmQgXHU0ZThjXHU2NzA4XHU0ZWZkIFx1NGUwOVx1NjcwOFx1NGVmZCBcdTU2ZGJcdTY3MDhcdTRlZmQgXHU0ZTk0XHU2NzA4XHU0ZWZkIFx1NTE2ZFx1NjcwOFx1NGVmZCBcdTRlMDNcdTY3MDhcdTRlZmQgXHU1MTZiXHU2NzA4XHU0ZWZkIFx1NGU1ZFx1NjcwOFx1NGVmZCBcdTUzNDFcdTY3MDhcdTRlZmQgXHU1MzQxXHU0ZTAwXHU2NzA4XHU0ZWZkIFx1NTM0MVx1NGU4Y1x1NjcwOFx1NGVmZCIuc3BsaXQoCiAgICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBzaG9ydE1vbnRoczogIlx1NGUwMFx1NjcwOCBcdTRlOGNcdTY3MDggXHU0ZTA5XHU2NzA4IFx1NTZkYlx1NjcwOCBcdTRlOTRcdTY3MDggXHU1MTZkXHU2NzA4IFx1NGUwM1x1NjcwOCBcdTUxNmJcdTY3MDggXHU0ZTVkXHU2NzA4IFx1NTM0MVx1NjcwOCBcdTUzNDFcdTRlMDBcdTY3MDggXHU1MzQxXHU0ZThjXHU2NzA4Ii5zcGxpdCgKICAgICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICAgIEFNOiAiXHU0ZTBhXHU1MzQ4IiwKICAgICAgICAgICAgICBQTTogIlx1NGUwYlx1NTM0OCIsCiAgICAgICAgICAgICAgYW06ICJcdTRlMGFcdTUzNDgiLAogICAgICAgICAgICAgIHBtOiAiXHU0ZTBiXHU1MzQ4IiwKICAgICAgICAgICAgICBmb3JtYXRzOiB7CiAgICAgICAgICAgICAgICBjOiAiJWEgJWQgJWIgJVkgJVggJVoiLAogICAgICAgICAgICAgICAgRDogIiVkLyVtLyV5IiwKICAgICAgICAgICAgICAgIEY6ICIlWS0lbS0lZCIsCiAgICAgICAgICAgICAgICBSOiAiJUg6JU0iLAogICAgICAgICAgICAgICAgcjogIiVJOiVNOiVTICVwIiwKICAgICAgICAgICAgICAgIFQ6ICIlSDolTTolUyIsCiAgICAgICAgICAgICAgICB2OiAiJWUtJWItJVkiLAogICAgICAgICAgICAgICAgWDogIiVyIiwKICAgICAgICAgICAgICAgIHg6ICIlRCIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0sCiAgICAgICAgICBrID0gaC5lbl9VUywKICAgICAgICAgIGwgPSBuZXcgYShrLCAwLCAhMSkKICAgICAgICBpZiAoInVuZGVmaW5lZCIgIT09IHR5cGVvZiBtKSB2YXIgciA9IChtLmV4cG9ydHMgPSBsKQogICAgICAgIGVsc2UKICAgICAgICAgIChyID0gKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMgfHwgKDAsIGV2YWwpKCJ0aGlzIikKICAgICAgICAgIH0pKCkpLAogICAgICAgICAgICAoci5zdHJmdGltZSA9IGwpCiAgICAgICAgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIERhdGUubm93ICYmCiAgICAgICAgICAoRGF0ZS5ub3cgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiArbmV3IERhdGUoKQogICAgICAgICAgfSkKICAgICAgfSkoKQogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwLCBhKSB7CiAgICAgIDsoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBhID0gZnVuY3Rpb24gKGIsIGQsIGUpIHsKICAgICAgICAgIHJldHVybiBhLnBhcnNlKGIsIGQsIGUpCiAgICAgICAgfQogICAgICAgIGEudmVyc2lvbiA9ICIwLjAuMSIKICAgICAgICA7KG0uZXhwb3J0cyA9IGEpLnN0cnB0aW1lID0gYQogICAgICAgIGEubG9jYWxlID0gewogICAgICAgICAgYTogIlN1biBNb24gVHVlIFdlZCBUaHUgRnJpIFNhdCIuc3BsaXQoIiAiKSwKICAgICAgICAgIEE6ICJTdW5kYXkgTW9uZGF5IFR1ZXNkYXkgV2VkbmVzZGF5IFRodXJzZGF5IEZyaWRheSBTYXR1cmRheSIuc3BsaXQoCiAgICAgICAgICAgICIgIiwKICAgICAgICAgICksCiAgICAgICAgICBiOiAiSmFuIEZlYiBNYXIgQXByIE1heSBKdW4gSnVsIEF1ZyBTZXAgT2N0IE5vdiBEZWMiLnNwbGl0KCIgIiksCiAgICAgICAgICBCOiAiSmFudWFyeSBGZWJydWFyeSBNYXJjaCBBcHJpbCBNYXkgSnVuZSBKdWx5IEF1Z3VzdCBTZXB0ZW1iZXIgT2N0b2JlciBOb3ZlbWJlciBEZWNlbWJlciIuc3BsaXQoCiAgICAgICAgICAgICIgIiwKICAgICAgICAgICksCiAgICAgICAgICBmOiAiSmFuLiBGZWIuIE1hci4gQXByLiBNYXkgSnVuLiBKdWwuIEF1Zy4gU2VwLiBPY3QuIE5vdi4gRGVjLiIuc3BsaXQoCiAgICAgICAgICAgICIgIiwKICAgICAgICAgICksCiAgICAgICAgICBjOiAiJVktJW0tJWQgJUg6JU06JVMiLAogICAgICAgICAgUDogWyJhbSIsICJwbSJdLAogICAgICAgICAgcjogIiVJOiVNOiVTICVwIiwKICAgICAgICAgIHg6ICIlbS8lZC8leSIsCiAgICAgICAgICBYOiAiJUg6JU06JVMiLAogICAgICAgICAgZGF5OiBbIlllc3RlcmRheSIsICJUb2RheSIsICJUb21vcnJvdyJdLAogICAgICAgICAgYmc6ICJKYW4gRmViIE1hciBBcHIgTWF5IEp1biBKdWwgQXVnIFNlcCBPY3QgTm92IERlYyIuc3BsaXQoIiAiKSwKICAgICAgICAgIEJnOiAiSmFudWFyeSBGZWJydWFyeSBNYXJjaCBBcHJpbCBNYXkgSnVuZSBKdWx5IEF1Z3VzdCBTZXB0ZW1iZXIgT2N0b2JlciBOb3ZlbWJlciBEZWNlbWJlciIuc3BsaXQoCiAgICAgICAgICAgICIgIiwKICAgICAgICAgICksCiAgICAgICAgICBmZzogIkphbi4gRmViLiBNYXIuIEFwci4gTWF5IEp1bi4gSnVsLiBBdWcuIFNlcC4gT2N0LiBOb3YuIERlYy4iLnNwbGl0KAogICAgICAgICAgICAiICIsCiAgICAgICAgICApLAogICAgICAgICAgRGF0ZV9kQllfeWVhcl9pbl9ITTogIiUjQiAlLWQsICVZIGF0ICUtSDolTSIsCiAgICAgICAgICBEYXRlX2RCWV95ZWFyOiAiJSNCICUtZCwgJVkiLAogICAgICAgICAgRGF0ZV9kQlk6ICIlI0IgJS1kLCAlWSIsCiAgICAgICAgICBEYXRlX0FkQlk6ICIlQSwgJSNCICUtZCwgJVkiLAogICAgICAgICAgRGF0ZV9kQkE6ICIlI0IgJS1kLCAlQSIsCiAgICAgICAgICBEYXRlX2RmX2luX0hNOiAiJSNmLCAlLWQgYXQgJS1IOiVNIiwKICAgICAgICAgIERhdGVfZGZZOiAiJS1kICUjZiAlWSIsCiAgICAgICAgICBEYXRlX2RCX2luX0hNOiAiJSNCICUtZCBhdCAlLUg6JU0iLAogICAgICAgICAgRGF0ZV9kZjogIiUtZCAlI2YiLAogICAgICAgIH0KICAgICAgICA7KGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICBmdW5jdGlvbiBiKGEsIGMsIGQsIGUsIGcsIGYpIHsKICAgICAgICAgICAgYyA9IFN0cmluZyhjKQogICAgICAgICAgICBkID0gU3RyaW5nKGQpCiAgICAgICAgICAgIGMgPSBjLnJlcGxhY2UoL15bI18wXF5cLSF+XSsvLCAiIikKICAgICAgICAgICAgZSA9IGhbY10KICAgICAgICAgICAgaWYgKCFlKSByZXR1cm4gYQogICAgICAgICAgICB2YXIgayA9ICExCiAgICAgICAgICAgIDstMSA9PT0gZC5pbmRleE9mKCIhIikgJiYKICAgICAgICAgICAgICAxID09PSBjLmxlbmd0aCAmJgogICAgICAgICAgICAgICgtMSA8IGQuaW5kZXhPZigifiIpIHx8CiAgICAgICAgICAgICAgICAoLTEgPCAiYkJmIi5pbmRleE9mKGMpICYmCiAgICAgICAgICAgICAgICAgIC8lWzBcLV9dP2RbXHNdKyQvLnRlc3QoZi5zdWJzdHIoMCwgZykpKSkgJiYKICAgICAgICAgICAgICAoayA9ICEwKQogICAgICAgICAgICBpZiAoKCJJIiA9PT0gYyB8fCAibCIgPT09IGMpICYmICEvJVtwUF0vLnRlc3QoZikpCiAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoIlVuZGVmaW5lZCBBTS9QTSIpCiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIGUpIHsKICAgICAgICAgICAgICBjYXNlICJmdW5jdGlvbiI6CiAgICAgICAgICAgICAgICByZXR1cm4gZSgpCiAgICAgICAgICAgICAgY2FzZSAic3RyaW5nIjoKICAgICAgICAgICAgICAgIHJldHVybiBlCiAgICAgICAgICAgICAgY2FzZSAib2JqZWN0IjoKICAgICAgICAgICAgICAgIHJldHVybiBiLm1ha2UucHVzaChbZS5tYWtlLCBkLCBrXSksICIoIiArIGUucmVnICsgIikiCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGMoYSwgYikgewogICAgICAgICAgICBhID0gU3RyaW5nKGEpCiAgICAgICAgICAgIGIgPSBTdHJpbmcoYikKICAgICAgICAgICAgcmV0dXJuIC0xICE9PSBiLmluZGV4T2YoIiMiKQogICAgICAgICAgICAgID8gYS5zdWJzdHIoMCwgMSkudG9VcHBlckNhc2UoKSArIGEuc3Vic3RyKDEpCiAgICAgICAgICAgICAgOiAtMSAhPT0gYi5pbmRleE9mKCJeIikKICAgICAgICAgICAgICA/IGEuc3Vic3RyKDAsIDEpICsgYS5zdWJzdHIoMSkudG9Mb3dlckNhc2UoKQogICAgICAgICAgICAgIDogYQogICAgICAgICAgfQogICAgICAgICAgdmFyIGYgPQogICAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5pbmRleE9mIHx8CiAgICAgICAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGIgPSB0aGlzLmxlbmd0aCwgYyA9IDA7IGMgPCBiOyApIHsKICAgICAgICAgICAgICAgICAgaWYgKGEgPT0gdGhpc1tjXSkgcmV0dXJuIGMKICAgICAgICAgICAgICAgICAgYysrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gLTEKICAgICAgICAgICAgICB9LAogICAgICAgICAgICBnID0gYS5sb2NhbGUsCiAgICAgICAgICAgIGggPSB7CiAgICAgICAgICAgICAgIiUiOiAiXFwlIiwKICAgICAgICAgICAgICBhOiAiXFxTKyIsCiAgICAgICAgICAgICAgQTogIlxcUysiLAogICAgICAgICAgICAgIGI6IHsKICAgICAgICAgICAgICAgIHJlZzogIlxcUysiLAogICAgICAgICAgICAgICAgbWFrZTogZnVuY3Rpb24gKGEsIGIsIGQsIGUpIHsKICAgICAgICAgICAgICAgICAgYiA9IGYuY2FsbChlID8gZy5iZyA6IGcuYiwgYyhiLCBkKSkKICAgICAgICAgICAgICAgICAgaWYgKC0xID09PSBiKSByZXR1cm4gITEKICAgICAgICAgICAgICAgICAgYS5zZXRVVENNb250aChiKQogICAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBoOiB7CiAgICAgICAgICAgICAgICByZWc6ICJcXFMrIiwKICAgICAgICAgICAgICAgIG1ha2U6IGZ1bmN0aW9uIChhLCBiLCBkLCBlKSB7CiAgICAgICAgICAgICAgICAgIGIgPSBmLmNhbGwoZSA/IGcuYmcgOiBnLmIsIGMoYiwgZCkpCiAgICAgICAgICAgICAgICAgIGlmICgtMSA9PT0gYikgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgIGEuc2V0VVRDTW9udGgoYikKICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgQjogewogICAgICAgICAgICAgICAgcmVnOiAiXFxTKyIsCiAgICAgICAgICAgICAgICBtYWtlOiBmdW5jdGlvbiAoYSwgYiwgZCwgZSkgewogICAgICAgICAgICAgICAgICBiID0gZi5jYWxsKGUgPyBnLkJnIDogZy5CLCBjKGIsIGQpKQogICAgICAgICAgICAgICAgICBpZiAoLTEgPT09IGIpIHJldHVybiAhMQogICAgICAgICAgICAgICAgICBhLnNldFVUQ01vbnRoKGIpCiAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGY6IHsKICAgICAgICAgICAgICAgIHJlZzogIlxcUysiLAogICAgICAgICAgICAgICAgbWFrZTogZnVuY3Rpb24gKGEsIGIsIGQsIGUpIHsKICAgICAgICAgICAgICAgICAgYiA9IGYuY2FsbChlID8gZy5mZyA6IGcuZiwgYyhiLCBkKSkKICAgICAgICAgICAgICAgICAgaWYgKC0xID09PSBiKSByZXR1cm4gITEKICAgICAgICAgICAgICAgICAgYS5zZXRVVENNb250aChiKQogICAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBnOiB7CiAgICAgICAgICAgICAgICByZWc6ICJbXFxkXFxzXT9cXGQiLAogICAgICAgICAgICAgICAgbWFrZTogZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgYiA9IHBhcnNlSW50KGIsIDEwKQogICAgICAgICAgICAgICAgICBpZiAoMCA+IGIgfHwgOTkgPCBiKSByZXR1cm4gITEKICAgICAgICAgICAgICAgICAgYiArPSAxMDAgKiBwYXJzZUludChuZXcgRGF0ZSgpLmdldFVUQ0Z1bGxZZWFyKCkgLyAxMDAsIDEwKQogICAgICAgICAgICAgICAgICBhLnNldFVUQ0Z1bGxZZWFyKGIpCiAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIEc6IHsKICAgICAgICAgICAgICAgIHJlZzogIlxcZHs0fSIsCiAgICAgICAgICAgICAgICBtYWtlOiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgICBiID0gcGFyc2VJbnQoYiwgMTApCiAgICAgICAgICAgICAgICAgIGEuc2V0VVRDRnVsbFllYXIoYikKICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZDogewogICAgICAgICAgICAgICAgcmVnOiAiW1xcZFxcc10/XFxkIiwKICAgICAgICAgICAgICAgIG1ha2U6IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICAgIGIgPSBwYXJzZUludChiLCAxMCkKICAgICAgICAgICAgICAgICAgaWYgKDEgPiBiIHx8IDMxIDwgYikgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgIGEuc2V0VVRDRGF0ZShiKQogICAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlOiB7CiAgICAgICAgICAgICAgICByZWc6ICJbXFxkXFxzXT9cXGQiLAogICAgICAgICAgICAgICAgbWFrZTogZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgYiA9IHBhcnNlSW50KGIsIDEwKQogICAgICAgICAgICAgICAgICBpZiAoMSA+IGIgfHwgMzEgPCBiKSByZXR1cm4gITEKICAgICAgICAgICAgICAgICAgYS5zZXRVVENEYXRlKGIpCiAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIEg6IHsKICAgICAgICAgICAgICAgIHJlZzogIltcXGRcXHNdP1xcZCIsCiAgICAgICAgICAgICAgICBtYWtlOiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgICBiID0gcGFyc2VJbnQoYiwgMTApCiAgICAgICAgICAgICAgICAgIGlmICgwID4gYiB8fCAyMyA8IGIpIHJldHVybiAhMQogICAgICAgICAgICAgICAgICBhLnNldFVUQ0hvdXJzKGIpCiAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIEk6IHsKICAgICAgICAgICAgICAgIHJlZzogIltcXGRcXHNdP1xcZCIsCiAgICAgICAgICAgICAgICBtYWtlOiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgICBiID0gcGFyc2VJbnQoYiwgMTApCiAgICAgICAgICAgICAgICAgIGlmICgxID4gYiB8fCAxMiA8IGIpIHJldHVybiAhMQogICAgICAgICAgICAgICAgICBhLnNldFVUQ0hvdXJzKGEuZ2V0VVRDSG91cnMoKSArIGIpCiAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIG06IHsKICAgICAgICAgICAgICAgIHJlZzogIltcXGRcXHNdP1xcZCIsCiAgICAgICAgICAgICAgICBtYWtlOiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgICBiID0gcGFyc2VJbnQoYiwgMTApCiAgICAgICAgICAgICAgICAgIGlmICgxID4gYiB8fCAxMiA8IGIpIHJldHVybiAhMQogICAgICAgICAgICAgICAgICBhLnNldFVUQ01vbnRoKGIgLSAxKQogICAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBNOiB7CiAgICAgICAgICAgICAgICByZWc6ICJbXFxkXFxzXT9cXGQiLAogICAgICAgICAgICAgICAgbWFrZTogZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgYiA9IHBhcnNlSW50KGIsIDEwKQogICAgICAgICAgICAgICAgICBpZiAoMCA+IGIgfHwgNTkgPCBiKSByZXR1cm4gITEKICAgICAgICAgICAgICAgICAgYS5zZXRVVENNaW51dGVzKGIpCiAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIG46ICJcXG4iLAogICAgICAgICAgICAgIHA6IHsKICAgICAgICAgICAgICAgIHJlZzogIlxcUysiLAogICAgICAgICAgICAgICAgbWFrZTogZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgYiA9IGYuY2FsbChnLlAsIGIudG9Mb3dlckNhc2UoKSkKICAgICAgICAgICAgICAgICAgaWYgKC0xID09PSBiKSByZXR1cm4gITEKICAgICAgICAgICAgICAgICAgMSA9PT0gYiAmJiBhLnNldFVUQ0hvdXJzKGEuZ2V0VVRDSG91cnMoKSArIDEyKQogICAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBQOiB7CiAgICAgICAgICAgICAgICByZWc6ICJcXFMrIiwKICAgICAgICAgICAgICAgIG1ha2U6IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICAgIGIgPSBmLmNhbGwoZy5QLCBiLnRvTG93ZXJDYXNlKCkpCiAgICAgICAgICAgICAgICAgIGlmICgtMSA9PT0gYikgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgIDEgPT09IGIgJiYgYS5zZXRVVENIb3VycyhhLmdldFVUQ0hvdXJzKCkgKyAxMikKICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgUzogewogICAgICAgICAgICAgICAgcmVnOiAiW1xcZFxcc10/XFxkIiwKICAgICAgICAgICAgICAgIG1ha2U6IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICAgIGIgPSBwYXJzZUludChiLCAxMCkKICAgICAgICAgICAgICAgICAgaWYgKDAgPiBiIHx8IDYwIDwgYikgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgIGEuc2V0VVRDU2Vjb25kcyhiKQogICAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB0OiAiXFx0IiwKICAgICAgICAgICAgICB1OiAiXFxkIiwKICAgICAgICAgICAgICBVOiAiW1xcZFxcc10/XFxkIiwKICAgICAgICAgICAgICB3OiAiXFxkIiwKICAgICAgICAgICAgICBXOiAiW1xcZFxcc10/XFxkIiwKICAgICAgICAgICAgICB5OiB7CiAgICAgICAgICAgICAgICByZWc6ICJbXFxkXFxzXT9cXGQiLAogICAgICAgICAgICAgICAgbWFrZTogZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgYiA9IHBhcnNlSW50KGIsIDEwKQogICAgICAgICAgICAgICAgICBpZiAoMCA+IGIgfHwgOTkgPCBiKSByZXR1cm4gITEKICAgICAgICAgICAgICAgICAgYiArPSAxMDAgKiBwYXJzZUludChuZXcgRGF0ZSgpLmdldFVUQ0Z1bGxZZWFyKCkgLyAxMDAsIDEwKQogICAgICAgICAgICAgICAgICBhLnNldFVUQ0Z1bGxZZWFyKGIpCiAgICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIFk6IHsKICAgICAgICAgICAgICAgIHJlZzogIlxcZHs0fSIsCiAgICAgICAgICAgICAgICBtYWtlOiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgICBiID0gcGFyc2VJbnQoYiwgMTApCiAgICAgICAgICAgICAgICAgIGEuc2V0VVRDRnVsbFllYXIoYikKICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgejogewogICAgICAgICAgICAgICAgcmVnOiAiWytcXC1dXFxkezR9IiwKICAgICAgICAgICAgICAgIG1ha2U6IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICAgIGIgPSBiLm1hdGNoKC9eKFsrXC1dKShcZHsyfSkoXGR7Mn0pJC8pCiAgICAgICAgICAgICAgICAgIGlmICghYikgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgIHZhciBjID0gNmU0ICogKDYwICogcGFyc2VJbnQoYlsyXSwgMTApICsgcGFyc2VJbnQoYlszXSwgMTApKQogICAgICAgICAgICAgICAgICAiKyIgPT09IGJbMV0gJiYgKGMgPSAtYykKICAgICAgICAgICAgICAgICAgYS5zZXRUaW1lKGEuZ2V0VGltZSgpICsgYykKICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgbDogewogICAgICAgICAgICAgICAgcmVnOiAiW1xcZFxcc10/XFxkIiwKICAgICAgICAgICAgICAgIG1ha2U6IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICAgIGIgPSBwYXJzZUludChiLCAxMCkKICAgICAgICAgICAgICAgICAgaWYgKDEgPiBiIHx8IDEyIDwgYikgcmV0dXJuICExCiAgICAgICAgICAgICAgICAgIGEuc2V0VVRDSG91cnMoYS5nZXRVVENIb3VycygpICsgYikKICAgICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgczogewogICAgICAgICAgICAgICAgcmVnOiAiXFxkKyIsCiAgICAgICAgICAgICAgICBtYWtlOiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgICBiID0gcGFyc2VJbnQoYiwgMTApCiAgICAgICAgICAgICAgICAgIGEuc2V0VGltZSgxZTMgKiBiKQogICAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBjOiBnLmMsCiAgICAgICAgICAgICAgcjogZy5yLAogICAgICAgICAgICAgIFI6ICIlSDolTSIsCiAgICAgICAgICAgICAgVDogIiVIOiVNOiVTIiwKICAgICAgICAgICAgICB4OiBnLngsCiAgICAgICAgICAgICAgWDogZy5YLAogICAgICAgICAgICAgIEQ6ICIlbS8lZC8leSIsCiAgICAgICAgICAgICAgRjogIiVZLSVtLSVkIiwKICAgICAgICAgICAgICBEYXRlX2lzbzogIiVZLSVtLSVkVCVIOiVNOiVTIiwKICAgICAgICAgICAgICBEYXRlX2RCWV95ZWFyX2luX0hNOiBnLkRhdGVfZEJZX3llYXJfaW5fSE0sCiAgICAgICAgICAgICAgRGF0ZV9kQllfeWVhcjogZy5EYXRlX2RCWV95ZWFyLAogICAgICAgICAgICAgIERhdGVfZEJZOiBnLkRhdGVfZEJZLAogICAgICAgICAgICAgIERhdGVfZEJBOiBnLkRhdGVfZEJBLAogICAgICAgICAgICAgIERhdGVfQWRCWTogZy5EYXRlX0FkQlksCiAgICAgICAgICAgICAgRGF0ZV9kZl9pbl9ITTogZy5EYXRlX2RmX2luX0hNLAogICAgICAgICAgICAgIERhdGVfZGZZOiBnLkRhdGVfZGZZLAogICAgICAgICAgICAgIERhdGVfZEJfaW5fSE06IGcuRGF0ZV9kQl9pbl9ITSwKICAgICAgICAgICAgICBEYXRlX2RtWV9fZG90OiAiJWQuJW0uJVkiLAogICAgICAgICAgICAgIERhdGVfZGY6IGcuRGF0ZV9kZiwKICAgICAgICAgICAgICBEYXRlX0ZUOiAiJUYgJVQiLAogICAgICAgICAgICAgIERhdGVfZG1ZX19taW51czogIiVkLSVtLSVZIiwKICAgICAgICAgICAgfQogICAgICAgICAgYS5wYXJzZSA9IGZ1bmN0aW9uIChhLCBjLCBkKSB7CiAgICAgICAgICAgIGEgPSBTdHJpbmcoYSkKICAgICAgICAgICAgYyA9IFN0cmluZyhjKQogICAgICAgICAgICBmb3IgKHZhciBlID0gNTsgLyUoRGF0ZV9bYS16QS1aMC05X10rfFtjREZyUlR4WF0pL2cudGVzdChjKSAmJiBlOyApCiAgICAgICAgICAgICAgKGMgPSBjLnJlcGxhY2UoLyUoRGF0ZV9bYS16QS1aMC05X10rfFtjREZyUlR4WF0pLywgYikpLCBlLS0KICAgICAgICAgICAgYi5tYWtlID0gW10KICAgICAgICAgICAgYyA9IGMucmVwbGFjZSgKICAgICAgICAgICAgICAvJSgoWyNcXiF+XXswLDJ9KVthQWJCZmhdfChbMFwtX10/KVtkZWdISW1NU1ZXeWxdfFtHbnBQdHVVd1l6WnMlXSkvZywKICAgICAgICAgICAgICBiLAogICAgICAgICAgICApCiAgICAgICAgICAgIGEgPSBhLm1hdGNoKG5ldyBSZWdFeHAoYykpCiAgICAgICAgICAgIGlmICghYSB8fCAhYi5tYWtlLmxlbmd0aCkgcmV0dXJuIG51bGwKICAgICAgICAgICAgYyA9IG5ldyBEYXRlKERhdGUuVVRDKDAsIDApKQogICAgICAgICAgICBlID0gMAogICAgICAgICAgICBmb3IgKHZhciBrID0gYi5tYWtlLmxlbmd0aDsgZSA8IGs7IGUrKykgewogICAgICAgICAgICAgIHZhciBnID0gYi5tYWtlW2VdCiAgICAgICAgICAgICAgaWYgKCFnWzBdKGMsIGFbZSArIDFdLCBnWzFdLCBnWzJdKSkgcmV0dXJuIG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgICBkICYmIGMuc2V0VGltZShjLmdldFRpbWUoKSArIDZlNCAqIGMuZ2V0VGltZXpvbmVPZmZzZXQoKSkKICAgICAgICAgICAgcmV0dXJuIGMKICAgICAgICAgIH0KICAgICAgICB9KShhKQogICAgICB9KSgpCiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHAsIGEpIHsKICAgICAgOyhmdW5jdGlvbiAoYSwgYykgewogICAgICAgIDsoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIGZ1bmN0aW9uIGQoYSkgewogICAgICAgICAgICBkZWxldGUgeFthXQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gZShhKSB7CiAgICAgICAgICAgIGlmIChIKSBzZXRUaW1lb3V0KGUsIDAsIGEpCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIHZhciBjID0geFthXQogICAgICAgICAgICAgIGlmIChjKSB7CiAgICAgICAgICAgICAgICBIID0gITAKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIHZhciBrID0gYy5jYWxsYmFjaywKICAgICAgICAgICAgICAgICAgICBnID0gYy5hcmdzCiAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBrKCkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgayhnWzBdKQogICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICBrKGdbMF0sIGdbMV0pCiAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgIGsoZ1swXSwgZ1sxXSwgZ1syXSkKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgIGsuYXBwbHkoYiwgZykKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgZChhKSwgKEggPSAhMSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGgoKSB7CiAgICAgICAgICAgIEEgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgIGMubmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgZShhKQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGsoKSB7CiAgICAgICAgICAgIGlmIChhLnBvc3RNZXNzYWdlICYmICFhLmltcG9ydFNjcmlwdHMpIHsKICAgICAgICAgICAgICB2YXIgYiA9ICEwLAogICAgICAgICAgICAgICAgYyA9IGEub25tZXNzYWdlCiAgICAgICAgICAgICAgYS5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBiID0gITEKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYS5wb3N0TWVzc2FnZSgiIiwgIioiKQogICAgICAgICAgICAgIGEub25tZXNzYWdlID0gYwogICAgICAgICAgICAgIHJldHVybiBiCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGwoKSB7CiAgICAgICAgICAgIHZhciBiID0gInNldEltbWVkaWF0ZSQiICsgTWF0aC5yYW5kb20oKSArICIkIiwKICAgICAgICAgICAgICBjID0gZnVuY3Rpb24gKGMpIHsKICAgICAgICAgICAgICAgIGMuc291cmNlID09PSBhICYmCiAgICAgICAgICAgICAgICAgICJzdHJpbmciID09PSB0eXBlb2YgYy5kYXRhICYmCiAgICAgICAgICAgICAgICAgIDAgPT09IGMuZGF0YS5pbmRleE9mKGIpICYmCiAgICAgICAgICAgICAgICAgIGUoK2MuZGF0YS5zbGljZShiLmxlbmd0aCkpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICBhLmFkZEV2ZW50TGlzdGVuZXIKICAgICAgICAgICAgICA/IGEuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsIGMsICExKQogICAgICAgICAgICAgIDogYS5hdHRhY2hFdmVudCgib25tZXNzYWdlIiwgYykKICAgICAgICAgICAgQSA9IGZ1bmN0aW9uIChjKSB7CiAgICAgICAgICAgICAgYS5wb3N0TWVzc2FnZShiICsgYywgIioiKQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiByKCkgewogICAgICAgICAgICB2YXIgYSA9IG5ldyBNZXNzYWdlQ2hhbm5lbCgpCiAgICAgICAgICAgIGEucG9ydDEub25tZXNzYWdlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICBlKGEuZGF0YSkKICAgICAgICAgICAgfQogICAgICAgICAgICBBID0gZnVuY3Rpb24gKGIpIHsKICAgICAgICAgICAgICBhLnBvcnQyLnBvc3RNZXNzYWdlKGIpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIG4oKSB7CiAgICAgICAgICAgIHZhciBhID0gcC5kb2N1bWVudEVsZW1lbnQKICAgICAgICAgICAgQSA9IGZ1bmN0aW9uIChiKSB7CiAgICAgICAgICAgICAgdmFyIGMgPSBwLmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpCiAgICAgICAgICAgICAgYy5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBlKGIpCiAgICAgICAgICAgICAgICBjLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG51bGwKICAgICAgICAgICAgICAgIGEucmVtb3ZlQ2hpbGQoYykKICAgICAgICAgICAgICAgIGMgPSBudWxsCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGEuYXBwZW5kQ2hpbGQoYykKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gcSgpIHsKICAgICAgICAgICAgQSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgc2V0VGltZW91dChlLCAwLCBhKQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIWEuc2V0SW1tZWRpYXRlKSB7CiAgICAgICAgICAgIHZhciBtID0gMSwKICAgICAgICAgICAgICB4ID0ge30sCiAgICAgICAgICAgICAgSCA9ICExLAogICAgICAgICAgICAgIHAgPSBhLmRvY3VtZW50LAogICAgICAgICAgICAgIEEsCiAgICAgICAgICAgICAgQyA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiAmJiBPYmplY3QuZ2V0UHJvdG90eXBlT2YoYSkKICAgICAgICAgICAgQyA9IEMgJiYgQy5zZXRUaW1lb3V0ID8gQyA6IGEKICAgICAgICAgICAgIltvYmplY3QgcHJvY2Vzc10iID09PSB7fS50b1N0cmluZy5jYWxsKGEucHJvY2VzcykKICAgICAgICAgICAgICA/IGgoKQogICAgICAgICAgICAgIDogaygpCiAgICAgICAgICAgICAgPyBsKCkKICAgICAgICAgICAgICA6IGEuTWVzc2FnZUNoYW5uZWwKICAgICAgICAgICAgICA/IHIoKQogICAgICAgICAgICAgIDogcCAmJiAib25yZWFkeXN0YXRlY2hhbmdlIiBpbiBwLmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpCiAgICAgICAgICAgICAgPyBuKCkKICAgICAgICAgICAgICA6IHEoKQogICAgICAgICAgICBDLnNldEltbWVkaWF0ZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGEgJiYgKGEgPSBuZXcgRnVuY3Rpb24oIiIgKyBhKSkKICAgICAgICAgICAgICBmb3IgKAogICAgICAgICAgICAgICAgdmFyIGIgPSBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSksIGMgPSAwOwogICAgICAgICAgICAgICAgYyA8IGIubGVuZ3RoOwogICAgICAgICAgICAgICAgYysrCiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgYltjXSA9IGFyZ3VtZW50c1tjICsgMV0KICAgICAgICAgICAgICB4W21dID0geyBjYWxsYmFjazogYSwgYXJnczogYiB9CiAgICAgICAgICAgICAgQShtKQogICAgICAgICAgICAgIHJldHVybiBtKysKICAgICAgICAgICAgfQogICAgICAgICAgICBDLmNsZWFySW1tZWRpYXRlID0gZAogICAgICAgICAgfQogICAgICAgIH0pKAogICAgICAgICAgInVuZGVmaW5lZCIgPT09IHR5cGVvZiBzZWxmCiAgICAgICAgICAgID8gInVuZGVmaW5lZCIgPT09IHR5cGVvZiBhCiAgICAgICAgICAgICAgPyB0aGlzCiAgICAgICAgICAgICAgOiBhCiAgICAgICAgICAgIDogc2VsZiwKICAgICAgICApCiAgICAgIH0uY2FsbCh0aGlzLCBhKDApLCBhKDYpKSkKICAgIH0sCiAgICBmdW5jdGlvbiAobSwgcCkgewogICAgICBmdW5jdGlvbiBhKCkgewogICAgICAgIHRocm93IEVycm9yKCJzZXRUaW1lb3V0IGhhcyBub3QgYmVlbiBkZWZpbmVkIikKICAgICAgfQogICAgICBmdW5jdGlvbiBiKCkgewogICAgICAgIHRocm93IEVycm9yKCJjbGVhclRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQiKQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGMoYikgewogICAgICAgIGlmIChrID09PSBzZXRUaW1lb3V0KSByZXR1cm4gc2V0VGltZW91dChiLCAwKQogICAgICAgIGlmICgoayA9PT0gYSB8fCAhaykgJiYgc2V0VGltZW91dCkKICAgICAgICAgIHJldHVybiAoayA9IHNldFRpbWVvdXQpLCBzZXRUaW1lb3V0KGIsIDApCiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBrKGIsIDApCiAgICAgICAgfSBjYXRjaCAoSCkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGsuY2FsbChudWxsLCBiLCAwKQogICAgICAgICAgfSBjYXRjaCAoSikgewogICAgICAgICAgICByZXR1cm4gay5jYWxsKHRoaXMsIGIsIDApCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGQoYSkgewogICAgICAgIGlmIChsID09PSBjbGVhclRpbWVvdXQpIHJldHVybiBjbGVhclRpbWVvdXQoYSkKICAgICAgICBpZiAoKGwgPT09IGIgfHwgIWwpICYmIGNsZWFyVGltZW91dCkKICAgICAgICAgIHJldHVybiAobCA9IGNsZWFyVGltZW91dCksIGNsZWFyVGltZW91dChhKQogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gbChhKQogICAgICAgIH0gY2F0Y2ggKEgpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBsLmNhbGwobnVsbCwgYSkKICAgICAgICAgIH0gY2F0Y2ggKEopIHsKICAgICAgICAgICAgcmV0dXJuIGwuY2FsbCh0aGlzLCBhKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBlKCkgewogICAgICAgIG4gJiYKICAgICAgICAgIHEgJiYKICAgICAgICAgICgobiA9ICExKSwgcS5sZW5ndGggPyAociA9IHEuY29uY2F0KHIpKSA6IChEID0gLTEpLCByLmxlbmd0aCAmJiBmKCkpCiAgICAgIH0KICAgICAgZnVuY3Rpb24gZigpIHsKICAgICAgICBpZiAoIW4pIHsKICAgICAgICAgIHZhciBhID0gYyhlKQogICAgICAgICAgbiA9ICEwCiAgICAgICAgICBmb3IgKHZhciBiID0gci5sZW5ndGg7IGI7ICkgewogICAgICAgICAgICBxID0gcgogICAgICAgICAgICBmb3IgKHIgPSBbXTsgKytEIDwgYjsgKSBxICYmIHFbRF0ucnVuKCkKICAgICAgICAgICAgRCA9IC0xCiAgICAgICAgICAgIGIgPSByLmxlbmd0aAogICAgICAgICAgfQogICAgICAgICAgcSA9IG51bGwKICAgICAgICAgIG4gPSAhMQogICAgICAgICAgZChhKQogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBnKGEsIGIpIHsKICAgICAgICB0aGlzLmZ1biA9IGEKICAgICAgICB0aGlzLmFycmF5ID0gYgogICAgICB9CiAgICAgIGZ1bmN0aW9uIGgoKSB7fQogICAgICBtID0gbS5leHBvcnRzID0ge30KICAgICAgdHJ5IHsKICAgICAgICB2YXIgayA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBzZXRUaW1lb3V0ID8gc2V0VGltZW91dCA6IGEKICAgICAgfSBjYXRjaCAoeCkgewogICAgICAgIGsgPSBhCiAgICAgIH0KICAgICAgdHJ5IHsKICAgICAgICB2YXIgbCA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBjbGVhclRpbWVvdXQgPyBjbGVhclRpbWVvdXQgOiBiCiAgICAgIH0gY2F0Y2ggKHgpIHsKICAgICAgICBsID0gYgogICAgICB9CiAgICAgIHZhciByID0gW10sCiAgICAgICAgbiA9ICExLAogICAgICAgIHEsCiAgICAgICAgRCA9IC0xCiAgICAgIG0ubmV4dFRpY2sgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0gQXJyYXkoYXJndW1lbnRzLmxlbmd0aCAtIDEpCiAgICAgICAgaWYgKDEgPCBhcmd1bWVudHMubGVuZ3RoKQogICAgICAgICAgZm9yICh2YXIgZCA9IDE7IGQgPCBhcmd1bWVudHMubGVuZ3RoOyBkKyspIGJbZCAtIDFdID0gYXJndW1lbnRzW2RdCiAgICAgICAgci5wdXNoKG5ldyBnKGEsIGIpKQogICAgICAgIDEgIT09IHIubGVuZ3RoIHx8IG4gfHwgYyhmKQogICAgICB9CiAgICAgIGcucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLmZ1bi5hcHBseShudWxsLCB0aGlzLmFycmF5KQogICAgICB9CiAgICAgIG0udGl0bGUgPSAiYnJvd3NlciIKICAgICAgbS5icm93c2VyID0gITAKICAgICAgbS5lbnYgPSB7fQogICAgICBtLmFyZ3YgPSBbXQogICAgICBtLnZlcnNpb24gPSAiIgogICAgICBtLnZlcnNpb25zID0ge30KICAgICAgbS5vbiA9IGgKICAgICAgbS5hZGRMaXN0ZW5lciA9IGgKICAgICAgbS5vbmNlID0gaAogICAgICBtLm9mZiA9IGgKICAgICAgbS5yZW1vdmVMaXN0ZW5lciA9IGgKICAgICAgbS5yZW1vdmVBbGxMaXN0ZW5lcnMgPSBoCiAgICAgIG0uZW1pdCA9IGgKICAgICAgbS5wcmVwZW5kTGlzdGVuZXIgPSBoCiAgICAgIG0ucHJlcGVuZE9uY2VMaXN0ZW5lciA9IGgKICAgICAgbS5saXN0ZW5lcnMgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBbXQogICAgICB9CiAgICAgIG0uYmluZGluZyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdGhyb3cgRXJyb3IoInByb2Nlc3MuYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkIikKICAgICAgfQogICAgICBtLmN3ZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gIi8iCiAgICAgIH0KICAgICAgbS5jaGRpciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdGhyb3cgRXJyb3IoInByb2Nlc3MuY2hkaXIgaXMgbm90IHN1cHBvcnRlZCIpCiAgICAgIH0KICAgICAgbS51bWFzayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gMAogICAgICB9CiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHApIHsKICAgICAgU2suYXNzZXJ0cyA9IHt9CiAgICAgIFNrLmFzc2VydHMuYXNzZXJ0ID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYXNzZXJ0cy5hc3NlcnQiLCBTay5hc3NlcnRzLmFzc2VydCkKICAgICAgU2suYXNzZXJ0cy5mYWlsID0gZnVuY3Rpb24gKGEpIHt9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYXNzZXJ0cy5mYWlsIiwgU2suYXNzZXJ0cy5mYWlsKQogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwKSB7CiAgICAgIFNrLmJvb2xfY2hlY2sgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEgfHwgbnVsbCA9PT0gYSB8fCAiYm9vbGVhbiIgIT09IHR5cGVvZiBhKQogICAgICAgICAgdGhyb3cgRXJyb3IoIm11c3Qgc3BlY2lmeSAiICsgYiArICIgYW5kIGl0IG11c3QgYmUgYSBib29sZWFuIikKICAgICAgfQogICAgICBTay5weXRob24yID0gewogICAgICAgIHByaW50X2Z1bmN0aW9uOiAhMSwKICAgICAgICBkaXZpc2lvbjogITEsCiAgICAgICAgYWJzb2x1dGVfaW1wb3J0OiBudWxsLAogICAgICAgIHVuaWNvZGVfbGl0ZXJhbHM6ICExLAogICAgICAgIHB5dGhvbjM6ICExLAogICAgICAgIHNldF9yZXByOiAhMSwKICAgICAgICBjbGFzc19yZXByOiAhMSwKICAgICAgICBpbmhlcml0X2Zyb21fb2JqZWN0OiAhMSwKICAgICAgICBzdXBlcl9hcmdzOiAhMSwKICAgICAgICBvY3RhbF9udW1iZXJfbGl0ZXJhbDogITEsCiAgICAgICAgYmFua2Vyc19yb3VuZGluZzogITEsCiAgICAgICAgcHl0aG9uX3ZlcnNpb246ICExLAogICAgICAgIGR1bmRlcl9uZXh0OiAhMSwKICAgICAgICBkdW5kZXJfcm91bmQ6ICExLAogICAgICAgIGxpc3RfY2xlYXI6ICExLAogICAgICAgIGV4Y2VwdGlvbnM6ICExLAogICAgICAgIG5vX2xvbmdfdHlwZTogITEsCiAgICAgICAgY2VpbF9mbG9vcl9pbnQ6ICExLAogICAgICAgIHNpbGVudF9vY3RhbF9saXRlcmFsOiAhMCwKICAgICAgfQogICAgICBTay5weXRob24zID0gewogICAgICAgIHByaW50X2Z1bmN0aW9uOiAhMCwKICAgICAgICBkaXZpc2lvbjogITAsCiAgICAgICAgYWJzb2x1dGVfaW1wb3J0OiBudWxsLAogICAgICAgIHVuaWNvZGVfbGl0ZXJhbHM6ICEwLAogICAgICAgIHB5dGhvbjM6ICEwLAogICAgICAgIHNldF9yZXByOiAhMCwKICAgICAgICBjbGFzc19yZXByOiAhMCwKICAgICAgICBpbmhlcml0X2Zyb21fb2JqZWN0OiAhMCwKICAgICAgICBzdXBlcl9hcmdzOiAhMCwKICAgICAgICBvY3RhbF9udW1iZXJfbGl0ZXJhbDogITAsCiAgICAgICAgYmFua2Vyc19yb3VuZGluZzogITAsCiAgICAgICAgcHl0aG9uX3ZlcnNpb246ICEwLAogICAgICAgIGR1bmRlcl9uZXh0OiAhMCwKICAgICAgICBkdW5kZXJfcm91bmQ6ICEwLAogICAgICAgIGxpc3RfY2xlYXI6ICEwLAogICAgICAgIGV4Y2VwdGlvbnM6ICEwLAogICAgICAgIG5vX2xvbmdfdHlwZTogITAsCiAgICAgICAgY2VpbF9mbG9vcl9pbnQ6ICEwLAogICAgICAgIHNpbGVudF9vY3RhbF9saXRlcmFsOiAhMSwKICAgICAgfQogICAgICBTay5jb25maWd1cmUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLm91dHB1dCA9IGEub3V0cHV0IHx8IFNrLm91dHB1dAogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KCJmdW5jdGlvbiIgPT09IHR5cGVvZiBTay5vdXRwdXQpCiAgICAgICAgU2suZGVidWdvdXQgPSBhLmRlYnVnb3V0IHx8IFNrLmRlYnVnb3V0CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIFNrLmRlYnVnb3V0KQogICAgICAgIFNrLnVuY2F1Z2h0RXhjZXB0aW9uID0gYS51bmNhdWdodEV4Y2VwdGlvbiB8fCBTay51bmNhdWdodEV4Y2VwdGlvbgogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KCJmdW5jdGlvbiIgPT09IHR5cGVvZiBTay51bmNhdWdodEV4Y2VwdGlvbikKICAgICAgICBTay5yZWFkID0gYS5yZWFkIHx8IFNrLnJlYWQKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgiZnVuY3Rpb24iID09PSB0eXBlb2YgU2sucmVhZCkKICAgICAgICBTay5ub25yZWFkb3BlbiA9IGEubm9ucmVhZG9wZW4gfHwgITEKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgiYm9vbGVhbiIgPT09IHR5cGVvZiBTay5ub25yZWFkb3BlbikKICAgICAgICBTay5maWxlb3BlbiA9IGEuZmlsZW9wZW4gfHwgdm9pZCAwCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoCiAgICAgICAgICAiZnVuY3Rpb24iID09PSB0eXBlb2YgU2suZmlsZW9wZW4gfHwKICAgICAgICAgICAgInVuZGVmaW5lZCIgPT09IHR5cGVvZiBTay5maWxlb3BlbiwKICAgICAgICApCiAgICAgICAgU2suZmlsZXdyaXRlID0gYS5maWxld3JpdGUgfHwgdm9pZCAwCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoCiAgICAgICAgICAiZnVuY3Rpb24iID09PSB0eXBlb2YgU2suZmlsZXdyaXRlIHx8CiAgICAgICAgICAgICJ1bmRlZmluZWQiID09PSB0eXBlb2YgU2suZmlsZXdyaXRlLAogICAgICAgICkKICAgICAgICBTay50aW1lb3V0TXNnID0gYS50aW1lb3V0TXNnIHx8IFNrLnRpbWVvdXRNc2cKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgiZnVuY3Rpb24iID09PSB0eXBlb2YgU2sudGltZW91dE1zZykKICAgICAgICBTay5leHBvcnRTeW1ib2woIlNrLnRpbWVvdXRNc2ciLCBTay50aW1lb3V0TXNnKQogICAgICAgIFNrLnN5c2FyZ3YgPSBhLnN5c2FyZ3YgfHwgU2suc3lzYXJndgogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KFNrLmlzQXJyYXlMaWtlKFNrLnN5c2FyZ3YpKQogICAgICAgIFNrLl9fZnV0dXJlX18gPSBhLl9fZnV0dXJlX18gfHwgU2sucHl0aG9uMgogICAgICAgIFNrLmJvb2xfY2hlY2soCiAgICAgICAgICBTay5fX2Z1dHVyZV9fLnByaW50X2Z1bmN0aW9uLAogICAgICAgICAgIlNrLl9fZnV0dXJlX18ucHJpbnRfZnVuY3Rpb24iLAogICAgICAgICkKICAgICAgICBTay5ib29sX2NoZWNrKFNrLl9fZnV0dXJlX18uZGl2aXNpb24sICJTay5fX2Z1dHVyZV9fLmRpdmlzaW9uIikKICAgICAgICBTay5ib29sX2NoZWNrKAogICAgICAgICAgU2suX19mdXR1cmVfXy51bmljb2RlX2xpdGVyYWxzLAogICAgICAgICAgIlNrLl9fZnV0dXJlX18udW5pY29kZV9saXRlcmFscyIsCiAgICAgICAgKQogICAgICAgIFNrLmJvb2xfY2hlY2soU2suX19mdXR1cmVfXy5zZXRfcmVwciwgIlNrLl9fZnV0dXJlX18uc2V0X3JlcHIiKQogICAgICAgIFNrLmJvb2xfY2hlY2soU2suX19mdXR1cmVfXy5jbGFzc19yZXByLCAiU2suX19mdXR1cmVfXy5jbGFzc19yZXByIikKICAgICAgICBTay5ib29sX2NoZWNrKAogICAgICAgICAgU2suX19mdXR1cmVfXy5pbmhlcml0X2Zyb21fb2JqZWN0LAogICAgICAgICAgIlNrLl9fZnV0dXJlX18uaW5oZXJpdF9mcm9tX29iamVjdCIsCiAgICAgICAgKQogICAgICAgIFNrLmJvb2xfY2hlY2soU2suX19mdXR1cmVfXy5zdXBlcl9hcmdzLCAiU2suX19mdXR1cmVfXy5zdXBlcl9hcmdzIikKICAgICAgICBTay5ib29sX2NoZWNrKAogICAgICAgICAgU2suX19mdXR1cmVfXy5vY3RhbF9udW1iZXJfbGl0ZXJhbCwKICAgICAgICAgICJTay5fX2Z1dHVyZV9fLm9jdGFsX251bWJlcl9saXRlcmFsIiwKICAgICAgICApCiAgICAgICAgU2suYm9vbF9jaGVjaygKICAgICAgICAgIFNrLl9fZnV0dXJlX18uYmFua2Vyc19yb3VuZGluZywKICAgICAgICAgICJTay5fX2Z1dHVyZV9fLmJhbmtlcnNfcm91bmRpbmciLAogICAgICAgICkKICAgICAgICBTay5ib29sX2NoZWNrKAogICAgICAgICAgU2suX19mdXR1cmVfXy5weXRob25fdmVyc2lvbiwKICAgICAgICAgICJTay5fX2Z1dHVyZV9fLnB5dGhvbl92ZXJzaW9uIiwKICAgICAgICApCiAgICAgICAgU2suYm9vbF9jaGVjayhTay5fX2Z1dHVyZV9fLmR1bmRlcl9uZXh0LCAiU2suX19mdXR1cmVfXy5kdW5kZXJfbmV4dCIpCiAgICAgICAgU2suYm9vbF9jaGVjayhTay5fX2Z1dHVyZV9fLmR1bmRlcl9yb3VuZCwgIlNrLl9fZnV0dXJlX18uZHVuZGVyX3JvdW5kIikKICAgICAgICBTay5ib29sX2NoZWNrKFNrLl9fZnV0dXJlX18ubGlzdF9jbGVhciwgIlNrLl9fZnV0dXJlX18ubGlzdF9jbGVhciIpCiAgICAgICAgU2suYm9vbF9jaGVjayhTay5fX2Z1dHVyZV9fLmV4Y2VwdGlvbnMsICJTay5fX2Z1dHVyZV9fLmV4Y2VwdGlvbnMiKQogICAgICAgIFNrLmJvb2xfY2hlY2soU2suX19mdXR1cmVfXy5ub19sb25nX3R5cGUsICJTay5fX2Z1dHVyZV9fLm5vX2xvbmdfdHlwZSIpCiAgICAgICAgU2suYm9vbF9jaGVjaygKICAgICAgICAgIFNrLl9fZnV0dXJlX18uY2VpbF9mbG9vcl9pbnQsCiAgICAgICAgICAiU2suX19mdXR1cmVfXy5jZWlsX2Zsb29yX2ludCIsCiAgICAgICAgKQogICAgICAgIFNrLmJvb2xfY2hlY2soCiAgICAgICAgICBTay5fX2Z1dHVyZV9fLnNpbGVudF9vY3RhbF9saXRlcmFsLAogICAgICAgICAgIlNrLl9fZnV0dXJlX18uc2lsZW50X29jdGFsX2xpdGVyYWwiLAogICAgICAgICkKICAgICAgICBTay5pbWFnZVByb3h5ID0gYS5pbWFnZVByb3h5IHx8ICJodHRwOi8vbG9jYWxob3N0OjgwODAvMzIweCIKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgKICAgICAgICAgICJzdHJpbmciID09PSB0eXBlb2YgU2suaW1hZ2VQcm94eSB8fAogICAgICAgICAgICAiZnVuY3Rpb24iID09PSB0eXBlb2YgU2suaW1hZ2VQcm94eSwKICAgICAgICApCiAgICAgICAgU2suaW5wdXRmdW4gPSBhLmlucHV0ZnVuIHx8IFNrLmlucHV0ZnVuCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIFNrLmlucHV0ZnVuKQogICAgICAgIFNrLmlucHV0ZnVuVGFrZXNQcm9tcHQgPSBhLmlucHV0ZnVuVGFrZXNQcm9tcHQgfHwgITEKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgiYm9vbGVhbiIgPT09IHR5cGVvZiBTay5pbnB1dGZ1blRha2VzUHJvbXB0KQogICAgICAgIFNrLnJldGFpbkdsb2JhbHMgPSBhLnJldGFpbmdsb2JhbHMgfHwgITEKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgiYm9vbGVhbiIgPT09IHR5cGVvZiBTay5yZXRhaW5HbG9iYWxzKQogICAgICAgIFNrLmRlYnVnZ2luZyA9IGEuZGVidWdnaW5nIHx8ICExCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoImJvb2xlYW4iID09PSB0eXBlb2YgU2suZGVidWdnaW5nKQogICAgICAgIFNrLmtpbGxhYmxlV2hpbGUgPSBhLmtpbGxhYmxlV2hpbGUgfHwgITEKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgiYm9vbGVhbiIgPT09IHR5cGVvZiBTay5raWxsYWJsZVdoaWxlKQogICAgICAgIFNrLmtpbGxhYmxlRm9yID0gYS5raWxsYWJsZUZvciB8fCAhMQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KCJib29sZWFuIiA9PT0gdHlwZW9mIFNrLmtpbGxhYmxlRm9yKQogICAgICAgIFNrLnNpZ25hbHMgPSBhLnNpZ25hbHMKICAgICAgICBTay5zaWduYWxzID0KICAgICAgICAgICEwID09PSBTay5zaWduYWxzCiAgICAgICAgICAgID8gewogICAgICAgICAgICAgICAgbGlzdGVuZXJzOiBbXSwKICAgICAgICAgICAgICAgIGFkZEV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgIFNrLnNpZ25hbHMubGlzdGVuZXJzLnB1c2goYSkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZW1vdmVFdmVudExpc3RlbmVyOiBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICBhID0gU2suc2lnbmFscy5saXN0ZW5lcnMuaW5kZXhPZihhKQogICAgICAgICAgICAgICAgICAwIDw9IGEgJiYgU2suc2lnbmFscy5saXN0ZW5lcnMuc3BsaWNlKGEsIDEpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgc2lnbmFsOiBmdW5jdGlvbiAoYSwgYykgewogICAgICAgICAgICAgICAgICBmb3IgKHZhciBiID0gMDsgYiA8IFNrLnNpZ25hbHMubGlzdGVuZXJzLmxlbmd0aDsgYisrKQogICAgICAgICAgICAgICAgICAgIFNrLnNpZ25hbHMubGlzdGVuZXJzW2JdLmNhbGwobnVsbCwgYSwgYykKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgfQogICAgICAgICAgICA6IG51bGwKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgib2JqZWN0IiA9PT0gdHlwZW9mIFNrLnNpZ25hbHMpCiAgICAgICAgU2suYnJlYWtwb2ludHMgPQogICAgICAgICAgYS5icmVha3BvaW50cyB8fAogICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgIH0KICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgiZnVuY3Rpb24iID09PSB0eXBlb2YgU2suYnJlYWtwb2ludHMpCiAgICAgICAgU2suc2V0VGltZW91dCA9IGEuc2V0VGltZW91dAogICAgICAgIHZvaWQgMCA9PT0gU2suc2V0VGltZW91dCAmJgogICAgICAgICAgKFNrLnNldFRpbWVvdXQgPQogICAgICAgICAgICAiZnVuY3Rpb24iID09PSB0eXBlb2Ygc2V0VGltZW91dAogICAgICAgICAgICAgID8gZnVuY3Rpb24gKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChhLCBjKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIDogZnVuY3Rpb24gKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgYSgpCiAgICAgICAgICAgICAgICB9KQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KCJmdW5jdGlvbiIgPT09IHR5cGVvZiBTay5zZXRUaW1lb3V0KQogICAgICAgICJleGVjTGltaXQiIGluIGEgJiYgKFNrLmV4ZWNMaW1pdCA9IGEuZXhlY0xpbWl0KQogICAgICAgICJ5aWVsZExpbWl0IiBpbiBhICYmIChTay55aWVsZExpbWl0ID0gYS55aWVsZExpbWl0KQogICAgICAgIGEuc3lzcGF0aCAmJgogICAgICAgICAgKChTay5zeXNwYXRoID0gYS5zeXNwYXRoKSwKICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KFNrLmlzQXJyYXlMaWtlKFNrLnN5c3BhdGgpKSwKICAgICAgICAgIChTay5yZWFsc3lzcGF0aCA9IHZvaWQgMCksCiAgICAgICAgICAoU2suc3lzbW9kdWxlcyA9IG5ldyBTay5idWlsdGluLmRpY3QoW10pKSkKICAgICAgICBTay5taXNjZXZhbC5zb2Z0c3BhY2VfID0gITEKICAgICAgICBTay5zd2l0Y2hfdmVyc2lvbigicm91bmQkIiwgU2suX19mdXR1cmVfXy5kdW5kZXJfcm91bmQpCiAgICAgICAgU2suc3dpdGNoX3ZlcnNpb24oIm5leHQkIiwgU2suX19mdXR1cmVfXy5kdW5kZXJfbmV4dCkKICAgICAgICBTay5zd2l0Y2hfdmVyc2lvbigiY2xlYXIkIiwgU2suX19mdXR1cmVfXy5saXN0X2NsZWFyKQogICAgICAgIFNrLmJ1aWx0aW4ubG5nLnRwJG5hbWUgPSBTay5fX2Z1dHVyZV9fLm5vX2xvbmdfdHlwZSA/ICJpbnQiIDogImxvbmciCiAgICAgICAgU2suc2V0dXBPcGVyYXRvcnMoU2suX19mdXR1cmVfXy5weXRob24zKQogICAgICAgIFNrLnNldHVwRHVuZGVyTWV0aG9kcyhTay5fX2Z1dHVyZV9fLnB5dGhvbjMpCiAgICAgICAgU2suc2V0dXBPYmplY3RzKFNrLl9fZnV0dXJlX18ucHl0aG9uMykKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmNvbmZpZ3VyZSIsIFNrLmNvbmZpZ3VyZSkKICAgICAgU2sudW5jYXVnaHRFeGNlcHRpb24gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay51bmNhdWdodEV4Y2VwdGlvbiA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2sudW5jYXVnaHRFeGNlcHRpb24iLCBTay51bmNhdWdodEV4Y2VwdGlvbikKICAgICAgU2sudGltZW91dE1zZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gIlByb2dyYW0gZXhjZWVkZWQgcnVuIHRpbWUgbGltaXQuIgogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2sudGltZW91dE1zZyIsIFNrLnRpbWVvdXRNc2cpCiAgICAgIFNrLmV4ZWNMaW1pdCA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWQogICAgICBTay55aWVsZExpbWl0ID0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZCiAgICAgIFNrLm91dHB1dCA9IGZ1bmN0aW9uIChhKSB7fQogICAgICBTay5yZWFkID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB0aHJvdyAiU2sucmVhZCBoYXMgbm90IGJlZW4gaW1wbGVtZW50ZWQiCiAgICAgIH0KICAgICAgU2suc3lzYXJndiA9IFtdCiAgICAgIFNrLmdldFN5c0FyZ3YgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIFNrLnN5c2FyZ3YKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmdldFN5c0FyZ3YiLCBTay5nZXRTeXNBcmd2KQogICAgICBTay5zeXNwYXRoID0gW10KICAgICAgU2suaW5Ccm93c2VyID0gdm9pZCAwICE9PSBTay5nbG9iYWwuZG9jdW1lbnQKICAgICAgU2suZGVidWdvdXQgPSBmdW5jdGlvbiAoYSkge30KICAgICAgOyhmdW5jdGlvbiAoKSB7CiAgICAgICAgdm9pZCAwICE9PSBTay5nbG9iYWwud3JpdGUKICAgICAgICAgID8gKFNrLm91dHB1dCA9IFNrLmdsb2JhbC53cml0ZSkKICAgICAgICAgIDogdm9pZCAwICE9PSBTay5nbG9iYWwuY29uc29sZSAmJiB2b2lkIDAgIT09IFNrLmdsb2JhbC5jb25zb2xlLmxvZwogICAgICAgICAgPyAoU2sub3V0cHV0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICBTay5nbG9iYWwuY29uc29sZS5sb2coYSkKICAgICAgICAgICAgfSkKICAgICAgICAgIDogdm9pZCAwICE9PSBTay5nbG9iYWwucHJpbnQgJiYgKFNrLm91dHB1dCA9IFNrLmdsb2JhbC5wcmludCkKICAgICAgICB2b2lkIDAgIT09IFNrLmdsb2JhbC5jb25zb2xlICYmIHZvaWQgMCAhPT0gU2suZ2xvYmFsLmNvbnNvbGUubG9nCiAgICAgICAgICA/IChTay5kZWJ1Z291dCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgU2suZ2xvYmFsLmNvbnNvbGUubG9nKGEpCiAgICAgICAgICAgIH0pCiAgICAgICAgICA6IHZvaWQgMCAhPT0gU2suZ2xvYmFsLnByaW50ICYmIChTay5kZWJ1Z291dCA9IFNrLmdsb2JhbC5wcmludCkKICAgICAgfSkoKQogICAgICBTay5pbnB1dGZ1biA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIHdpbmRvdy5wcm9tcHQoYSkKICAgICAgfQogICAgICBTay5zZXR1cF9tZXRob2RfbWFwcGluZ3MgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHJvdW5kJDogewogICAgICAgICAgICBjbGFzc2VzOiBbU2suYnVpbHRpbi5mbG9hdF8sIFNrLmJ1aWx0aW4uaW50XywgU2suYnVpbHRpbi5ubWJlcl0sCiAgICAgICAgICAgIDI6IG51bGwsCiAgICAgICAgICAgIDM6ICJfX3JvdW5kX18iLAogICAgICAgICAgfSwKICAgICAgICAgIGNsZWFyJDogeyBjbGFzc2VzOiBbU2suYnVpbHRpbi5saXN0XSwgMjogbnVsbCwgMzogImNsZWFyIiB9LAogICAgICAgICAgbmV4dCQ6IHsKICAgICAgICAgICAgY2xhc3NlczogWwogICAgICAgICAgICAgIFNrLmJ1aWx0aW4uZGljdF9pdGVyXywKICAgICAgICAgICAgICBTay5idWlsdGluLmxpc3RfaXRlcl8sCiAgICAgICAgICAgICAgU2suYnVpbHRpbi5zZXRfaXRlcl8sCiAgICAgICAgICAgICAgU2suYnVpbHRpbi5zdHJfaXRlcl8sCiAgICAgICAgICAgICAgU2suYnVpbHRpbi50dXBsZV9pdGVyXywKICAgICAgICAgICAgICBTay5idWlsdGluLmdlbmVyYXRvciwKICAgICAgICAgICAgICBTay5idWlsdGluLmVudW1lcmF0ZSwKICAgICAgICAgICAgICBTay5idWlsdGluLmZpbHRlcl8sCiAgICAgICAgICAgICAgU2suYnVpbHRpbi56aXBfLAogICAgICAgICAgICAgIFNrLmJ1aWx0aW4ubWFwXywKICAgICAgICAgICAgICBTay5idWlsdGluLml0ZXJhdG9yLAogICAgICAgICAgICBdLAogICAgICAgICAgICAyOiAibmV4dCIsCiAgICAgICAgICAgIDM6ICJfX25leHRfXyIsCiAgICAgICAgICB9LAogICAgICAgIH0KICAgICAgfQogICAgICBTay5zd2l0Y2hfdmVyc2lvbiA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIGMKICAgICAgICB2YXIgZCA9IFNrLnNldHVwX21ldGhvZF9tYXBwaW5ncygpW2FdCiAgICAgICAgaWYgKGIpIHsKICAgICAgICAgIGIgPSBkWzNdCiAgICAgICAgICB2YXIgZSA9IGRbMl0KICAgICAgICB9IGVsc2UgKGIgPSBkWzJdKSwgKGUgPSBkWzNdKQogICAgICAgIHZhciBmID0gZC5jbGFzc2VzCiAgICAgICAgdmFyIGcgPSBmLmxlbmd0aAogICAgICAgIGZvciAoYyA9IDA7IGMgPCBnOyBjKyspCiAgICAgICAgICAoZCA9IGZbY10pLAogICAgICAgICAgICBlICYmIGQucHJvdG90eXBlLmhhc093blByb3BlcnR5KGUpICYmIGRlbGV0ZSBkLnByb3RvdHlwZVtlXSwKICAgICAgICAgICAgYiAmJiAoZC5wcm90b3R5cGVbYl0gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGQucHJvdG90eXBlW2FdKSkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLl9fZnV0dXJlX18iLCBTay5fX2Z1dHVyZV9fKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmlucHV0ZnVuIiwgU2suaW5wdXRmdW4pCiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHApIHsKICAgICAgdm9pZCAwID09PSBTay5idWlsdGluICYmIChTay5idWlsdGluID0ge30pCiAgICAgIFNrLmR1bmRlclRvU2t1bHB0ID0gewogICAgICAgIF9fZXFfXzogIm9iJGVxIiwKICAgICAgICBfX25lX186ICJvYiRuZSIsCiAgICAgICAgX19sdF9fOiAib2IkbHQiLAogICAgICAgIF9fbGVfXzogIm9iJGxlIiwKICAgICAgICBfX2d0X186ICJvYiRndCIsCiAgICAgICAgX19nZV9fOiAib2IkZ2UiLAogICAgICAgIF9faGFzaF9fOiAidHAkaGFzaCIsCiAgICAgICAgX19hYnNfXzogIm5iJGFicyIsCiAgICAgICAgX19uZWdfXzogIm5iJG5lZ2F0aXZlIiwKICAgICAgICBfX3Bvc19fOiAibmIkcG9zaXRpdmUiLAogICAgICAgIF9faW50X186ICJuYiRpbnRfIiwKICAgICAgICBfX2xvbmdfXzogIm5iJGxuZyIsCiAgICAgICAgX19mbG9hdF9fOiAibmIkZmxvYXRfIiwKICAgICAgICBfX2FkZF9fOiAibmIkYWRkIiwKICAgICAgICBfX3JhZGRfXzogIm5iJHJlZmxlY3RlZF9hZGQiLAogICAgICAgIF9fc3ViX186ICJuYiRzdWJ0cmFjdCIsCiAgICAgICAgX19yc3ViX186ICJuYiRyZWZsZWN0ZWRfc3VidHJhY3QiLAogICAgICAgIF9fbXVsX186ICJuYiRtdWx0aXBseSIsCiAgICAgICAgX19ybXVsX186ICJuYiRyZWZsZWN0ZWRfbXVsdGlwbHkiLAogICAgICAgIF9fZGl2X186ICJuYiRkaXZpZGUiLAogICAgICAgIF9fcmRpdl9fOiAibmIkcmVmbGVjdGVkX2RpdmlkZSIsCiAgICAgICAgX19mbG9vcmRpdl9fOiAibmIkZmxvb3JfZGl2aWRlIiwKICAgICAgICBfX3JmbG9vcmRpdl9fOiAibmIkcmVmbGVjdGVkX2Zsb29yX2RpdmlkZSIsCiAgICAgICAgX19tb2RfXzogIm5iJHJlbWFpbmRlciIsCiAgICAgICAgX19ybW9kX186ICJuYiRyZWZsZWN0ZWRfcmVtYWluZGVyIiwKICAgICAgICBfX2Rpdm1vZF9fOiAibmIkZGl2bW9kIiwKICAgICAgICBfX3JkaXZtb2RfXzogIm5iJHJlZmxlY3RlZF9kaXZtb2QiLAogICAgICAgIF9fcG93X186ICJuYiRwb3dlciIsCiAgICAgICAgX19ycG93X186ICJuYiRyZWZsZWN0ZWRfcG93ZXIiLAogICAgICAgIF9fY29udGFpbnNfXzogInNxJGNvbnRhaW5zIiwKICAgICAgICBfX2xlbl9fOiBbInNxJGxlbmd0aCIsIDFdLAogICAgICAgIF9fZ2V0X186IFsidHAkZGVzY3JfZ2V0IiwgM10sCiAgICAgICAgX19zZXRfXzogWyJ0cCRkZXNjcl9zZXQiLCAzXSwKICAgICAgfQogICAgICBTay5zZXR1cER1bmRlck1ldGhvZHMgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGEKICAgICAgICAgID8gKChTay5kdW5kZXJUb1NrdWxwdC5fX21hdG11bF9fID0gInRwJG1hdG11bCIpLAogICAgICAgICAgICAoU2suZHVuZGVyVG9Ta3VscHQuX19ybWF0bXVsX18gPSAidHAkcmVmbGVjdGVkX21hdG11bCIpKQogICAgICAgICAgOiAoU2suZHVuZGVyVG9Ta3VscHQuX19tYXRtdWxfXyAmJgogICAgICAgICAgICAgIGRlbGV0ZSBTay5kdW5kZXJUb1NrdWxwdC5fX21hdG11bF9fLAogICAgICAgICAgICBTay5kdW5kZXJUb1NrdWxwdC5fX3JtYXRtdWxfXyAmJgogICAgICAgICAgICAgIGRlbGV0ZSBTay5kdW5kZXJUb1NrdWxwdC5fX3JtYXRtdWxfXykKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLnNldHVwRHVuZGVyTWV0aG9kcyIsIFNrLnNldHVwRHVuZGVyTWV0aG9kcykKICAgICAgU2suYnVpbHRpbi50eXBlID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICB2YXIgZAogICAgICAgIGlmICh2b2lkIDAgPT09IGIgJiYgdm9pZCAwID09PSBjKSByZXR1cm4gYS5vYiR0eXBlCiAgICAgICAgaWYgKCJkaWN0IiAhPT0gYy50cCRuYW1lKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAidHlwZSgpIGFyZ3VtZW50IDMgbXVzdCBiZSBkaWN0LCBub3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGMpLAogICAgICAgICAgKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja1N0cmluZyhhKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgInR5cGUoKSBhcmd1bWVudCAxIG11c3QgYmUgc3RyLCBub3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGEpLAogICAgICAgICAgKQogICAgICAgIGlmICgidHVwbGUiICE9PSBiLnRwJG5hbWUpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJ0eXBlKCkgYXJndW1lbnQgMiBtdXN0IGJlIHR1cGxlLCBub3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGIpLAogICAgICAgICAgKQogICAgICAgIHZhciBlID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHZvaWQgMCAhPT0gZS5wcm90b3R5cGUudHAkYmFzZSAmJgogICAgICAgICAgICAoZS5wcm90b3R5cGUudHAkYmFzZS5zayRrbGFzcwogICAgICAgICAgICAgID8gZS5wcm90b3R5cGUudHAkYmFzZS5jYWxsKHRoaXMsIGEsIGIpCiAgICAgICAgICAgICAgOiAoKGEgPSBhLnNsaWNlKCkpLAogICAgICAgICAgICAgICAgYS51bnNoaWZ0KGUsIHRoaXMpLAogICAgICAgICAgICAgICAgU2suYWJzdHIuc3VwZXJDb25zdHJ1Y3Rvci5hcHBseSh2b2lkIDAsIGEpKSkKICAgICAgICAgIHRoaXMuJGQgPSBuZXcgU2suYnVpbHRpbi5kaWN0KFtdKQogICAgICAgICAgdGhpcy4kZC5tcCRhc3Nfc3Vic2NyaXB0KG5ldyBTay5idWlsdGluLnN0cigiX19kaWN0X18iKSwgdGhpcy4kZCkKICAgICAgICB9CiAgICAgICAgdmFyIGYgPSBTay5mZmkucmVtYXBUb0pzKGEpLAogICAgICAgICAgZyA9ICExCiAgICAgICAgZS50cCRjYWxsID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHZhciBjID0gU2suYnVpbHRpbi50eXBlLnR5cGVMb29rdXAoZSwgU2suYnVpbHRpbi5zdHIuJG5ldykKICAgICAgICAgIGEgPSBhIHx8IFtdCiAgICAgICAgICBiID0gYiB8fCBbXQogICAgICAgICAgaWYgKHZvaWQgMCA9PT0gYyB8fCBjID09PSBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuX19uZXdfXykgewogICAgICAgICAgICB2YXIgZCA9IG5ldyBlKGEsIGIpCiAgICAgICAgICAgIGMgPSB2b2lkIDAKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBrID0gYS5zbGljZSgpCiAgICAgICAgICAgIGsudW5zaGlmdChlKQogICAgICAgICAgICBkID0gU2subWlzY2V2YWwuYXBwbHlPclN1c3BlbmQoYywgdm9pZCAwLCB2b2lkIDAsIGIsIGspCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuY2hhaW4oCiAgICAgICAgICAgIGQsCiAgICAgICAgICAgIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgdmFyIGsgPSBTay5idWlsdGluLnR5cGUudHlwZUxvb2t1cCgKICAgICAgICAgICAgICAgIGUub2IkdHlwZSwKICAgICAgICAgICAgICAgIFNrLmJ1aWx0aW4uc3RyLiRpbml0LAogICAgICAgICAgICAgICkKICAgICAgICAgICAgICBkID0gZQogICAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IGspCiAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICBhLnVuc2hpZnQoZCksCiAgICAgICAgICAgICAgICAgIFNrLm1pc2NldmFsLmFwcGx5T3JTdXNwZW5kKGssIHZvaWQgMCwgdm9pZCAwLCBiLCBhKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IGMgJiYgKDAgIT09IGEubGVuZ3RoIHx8IDAgIT09IGIubGVuZ3RoKSAmJiAhZykKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAgICAgIl9faW5pdF9fKCkgZ290IHVuZXhwZWN0ZWQgYXJndW1lbnQocykiLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB9LAogICAgICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgIGlmIChhICE9PSBTay5idWlsdGluLm5vbmUubm9uZSQgJiYgdm9pZCAwICE9PSBhKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICAgICAiX19pbml0X18oKSBzaG91bGQgcmV0dXJuIE5vbmUsIG5vdCAiICsgU2suYWJzdHIudHlwZU5hbWUoYSksCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgcmV0dXJuIGQKICAgICAgICAgICAgfSwKICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgMCA9PT0gYi52Lmxlbmd0aCAmJgogICAgICAgICAgU2suX19mdXR1cmVfXy5pbmhlcml0X2Zyb21fb2JqZWN0ICYmCiAgICAgICAgICAoYi52LnB1c2goU2suYnVpbHRpbi5vYmplY3QpLAogICAgICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZShmLCBlLCBTay5idWlsdGluLm9iamVjdCkpCiAgICAgICAgdmFyIGgsCiAgICAgICAgICBrID0gW10KICAgICAgICB2YXIgbCA9IGIudHAkaXRlcigpCiAgICAgICAgZm9yIChkID0gbC50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGQ7IGQgPSBsLnRwJGl0ZXJuZXh0KCkpIHsKICAgICAgICAgIGZvciAodm9pZCAwID09PSBoICYmIChoID0gZCk7IGQuc2ska2xhc3MgJiYgZC5wcm90b3R5cGUudHAkYmFzZTsgKQogICAgICAgICAgICBkID0gZC5wcm90b3R5cGUudHAkYmFzZQogICAgICAgICAgIWQuc2ska2xhc3MgJiYgMCA+IGsuaW5kZXhPZihkKSAmJiAoay5wdXNoKGQpLCAoZyA9ICEwKSkKICAgICAgICB9CiAgICAgICAgaWYgKDEgPCBrLmxlbmd0aCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIk11bHRpcGxlIGluaGVyaXRhbmNlIHdpdGggbW9yZSB0aGFuIG9uZSBidWlsdGluIHR5cGUgaXMgdW5zdXBwb3J0ZWQiLAogICAgICAgICAgKQogICAgICAgIHZvaWQgMCAhPT0gaCAmJgogICAgICAgICAgKFNrLmFic3RyLmluaGVyaXRzKGUsIGgpLAogICAgICAgICAgaC5wcm90b3R5cGUgaW5zdGFuY2VvZiBTay5idWlsdGluLm9iamVjdCB8fAogICAgICAgICAgICBoID09PSBTay5idWlsdGluLm9iamVjdCkgJiYKICAgICAgICAgIChlLnByb3RvdHlwZS50cCRiYXNlID0gaCkKICAgICAgICBlLnByb3RvdHlwZS50cCRuYW1lID0gZgogICAgICAgIGUucHJvdG90eXBlLm9iJHR5cGUgPSBTay5idWlsdGluLnR5cGUubWFrZUludG9UeXBlT2JqKGYsIGUpCiAgICAgICAgdmFyIHIgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fbW9kdWxlX18iKQogICAgICAgIHZvaWQgMCA9PT0gYy5tcCRsb29rdXAocikgJiYgYy5tcCRhc3Nfc3Vic2NyaXB0KHIsIFNrLmdsb2JhbHMuX19uYW1lX18pCiAgICAgICAgbCA9IGMudHAkaXRlcigpCiAgICAgICAgZm9yIChoID0gbC50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGg7IGggPSBsLnRwJGl0ZXJuZXh0KCkpCiAgICAgICAgICAoZCA9IGMubXAkc3Vic2NyaXB0KGgpKSwKICAgICAgICAgICAgdm9pZCAwID09PSBkICYmIChkID0gbnVsbCksCiAgICAgICAgICAgIChlLnByb3RvdHlwZVtoLnZdID0gZCksCiAgICAgICAgICAgIChlW2gudl0gPSBkKQogICAgICAgIGUuX19jbGFzc19fID0gZQogICAgICAgIGUuX19uYW1lX18gPSBhCiAgICAgICAgZS5zayRrbGFzcyA9ICEwCiAgICAgICAgZS5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgYSA9IHRoaXMudHAkZ2V0YXR0cihTay5idWlsdGluLnN0ci4kcmVwcikKICAgICAgICAgIGlmICgKICAgICAgICAgICAgdm9pZCAwICE9PSBhICYmCiAgICAgICAgICAgIGEuaW1fZnVuYyAhPT0gU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLl9fcmVwcl9fCiAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5hcHBseShhLCB2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBbXSkKICAgICAgICAgIGlmICgKICAgICAgICAgICAgdm9pZCAwICE9PSBlLnByb3RvdHlwZS50cCRiYXNlICYmCiAgICAgICAgICAgIGUucHJvdG90eXBlLnRwJGJhc2UgIT09IFNrLmJ1aWx0aW4ub2JqZWN0ICYmCiAgICAgICAgICAgIHZvaWQgMCAhPT0gZS5wcm90b3R5cGUudHAkYmFzZS5wcm90b3R5cGUuJHIKICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIGUucHJvdG90eXBlLnRwJGJhc2UucHJvdG90eXBlLiRyLmNhbGwodGhpcykKICAgICAgICAgIHZhciBiID0gYy5tcCRzdWJzY3JpcHQocikKICAgICAgICAgIGEgPSAiIgogICAgICAgICAgYiAmJiAoYSA9IGIudiArICIuIikKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoIjwiICsgYSArIGYgKyAiIG9iamVjdD4iKQogICAgICAgIH0KICAgICAgICBlLnByb3RvdHlwZS50cCRzZXRhdHRyID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICAgIHZhciBkID0gU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLkdlbmVyaWNHZXRBdHRyLmNhbGwoCiAgICAgICAgICAgIHRoaXMsCiAgICAgICAgICAgIFNrLmJ1aWx0aW4uc3RyLiRzZXRhdHRyLAogICAgICAgICAgKQogICAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gZAogICAgICAgICAgICA/ICgoYSA9IFNrLm1pc2NldmFsLmNhbGxzaW1PclN1c3BlbmRBcnJheShkLCBbYSwgYl0pKSwKICAgICAgICAgICAgICBjID8gYSA6IFNrLm1pc2NldmFsLnJldHJ5T3B0aW9uYWxTdXNwZW5zaW9uT3JUaHJvdyhhKSkKICAgICAgICAgICAgOiBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuR2VuZXJpY1NldEF0dHIuY2FsbCh0aGlzLCBhLCBiLCBjKQogICAgICAgIH0KICAgICAgICBlLnByb3RvdHlwZS50cCRnZXRhdHRyID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHZhciBjCiAgICAgICAgICB2YXIgZCA9IFNrLmJ1aWx0aW4udHlwZS50eXBlTG9va3VwKGUsIFNrLmJ1aWx0aW4uc3RyLiRnZXRhdHRyaWJ1dGUpCiAgICAgICAgICB2b2lkIDAgIT09IGQgJiYKICAgICAgICAgICAgbnVsbCAhPT0gZCAmJgogICAgICAgICAgICB2b2lkIDAgIT09IGQudHAkZGVzY3JfZ2V0ICYmCiAgICAgICAgICAgIChjID0gZC50cCRkZXNjcl9nZXQuY2FsbChkLCB0aGlzLCBlKSkKICAgICAgICAgIHZvaWQgMCA9PT0gYyAmJgogICAgICAgICAgICAoYyA9IFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5HZW5lcmljUHl0aG9uR2V0QXR0ci5iaW5kKAogICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgKSkKICAgICAgICAgIGQgPSBTay5taXNjZXZhbC50cnlDYXRjaCgKICAgICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kQXJyYXkoYywgW2FdKQogICAgICAgICAgICB9LAogICAgICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgIGlmICghKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yKSkgdGhyb3cgYQogICAgICAgICAgICB9LAogICAgICAgICAgKQogICAgICAgICAgcmV0dXJuIGIgPyBkIDogU2subWlzY2V2YWwucmV0cnlPcHRpb25hbFN1c3BlbnNpb25PclRocm93KGQpCiAgICAgICAgfQogICAgICAgIGUucHJvdG90eXBlLnRwJHN0ciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBhID0gdGhpcy50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiRzdHIpCiAgICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBhICYmCiAgICAgICAgICAgIGEuaW1fZnVuYyAhPT0gU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLl9fc3RyX18KICAgICAgICAgICAgPyBTay5taXNjZXZhbC5hcHBseShhLCB2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBbXSkKICAgICAgICAgICAgOiB2b2lkIDAgIT09IGUucHJvdG90eXBlLnRwJGJhc2UgJiYKICAgICAgICAgICAgICBlLnByb3RvdHlwZS50cCRiYXNlICE9PSBTay5idWlsdGluLm9iamVjdCAmJgogICAgICAgICAgICAgIHZvaWQgMCAhPT0gZS5wcm90b3R5cGUudHAkYmFzZS5wcm90b3R5cGUudHAkc3RyCiAgICAgICAgICAgID8gZS5wcm90b3R5cGUudHAkYmFzZS5wcm90b3R5cGUudHAkc3RyLmNhbGwodGhpcykKICAgICAgICAgICAgOiB0aGlzLiRyKCkKICAgICAgICB9CiAgICAgICAgZS5wcm90b3R5cGUudHAkbGVuZ3RoID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHZhciBiID0gU2subWlzY2V2YWwuY2hhaW4oCiAgICAgICAgICAgIFNrLmFic3RyLmdhdHRyKHRoaXMsIFNrLmJ1aWx0aW4uc3RyLiRsZW4sIGEpLAogICAgICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5hcHBseU9yU3VzcGVuZChhLCB2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBbXSkKICAgICAgICAgICAgfSwKICAgICAgICAgICkKICAgICAgICAgIHJldHVybiBhID8gYiA6IFNrLm1pc2NldmFsLnJldHJ5T3B0aW9uYWxTdXNwZW5zaW9uT3JUaHJvdyhiKQogICAgICAgIH0KICAgICAgICBlLnByb3RvdHlwZS50cCRjYWxsID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jaGFpbigKICAgICAgICAgICAgdGhpcy50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiRjYWxsLCAhMCksCiAgICAgICAgICAgIGZ1bmN0aW9uIChjKSB7CiAgICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gYykKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAgICAgIiciICsgU2suYWJzdHIudHlwZU5hbWUodGhpcykgKyAiJyBvYmplY3QgaXMgbm90IGNhbGxhYmxlIiwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuYXBwbHlPclN1c3BlbmQoYywgdm9pZCAwLCB2b2lkIDAsIGIsIGEpCiAgICAgICAgICAgIH0sCiAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIGUucHJvdG90eXBlLnRwJGl0ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgYSA9IHRoaXMudHAkZ2V0YXR0cihTay5idWlsdGluLnN0ci4kaXRlcikKICAgICAgICAgIGlmICh2b2lkIDAgPT09IGEpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAiJyIgKyBTay5hYnN0ci50eXBlTmFtZSh0aGlzKSArICInIG9iamVjdCBpcyBub3QgaXRlcmFibGUiLAogICAgICAgICAgICApCiAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGEpCiAgICAgICAgfQogICAgICAgIGUucHJvdG90eXBlLnRwJGl0ZXJuZXh0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHZhciBiID0gdGhpcywKICAgICAgICAgICAgYyA9IFNrLm1pc2NldmFsLmNoYWluKAogICAgICAgICAgICAgIGIudHAkZ2V0YXR0cigKICAgICAgICAgICAgICAgIFNrLl9fZnV0dXJlX18uZHVuZGVyX25leHQKICAgICAgICAgICAgICAgICAgPyBTay5idWlsdGluLnN0ci4kbmV4dDMKICAgICAgICAgICAgICAgICAgOiBTay5idWlsdGluLnN0ci4kbmV4dDIsCiAgICAgICAgICAgICAgICBhLAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IGEpCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAgICAgICAiJyIgKyBTay5hYnN0ci50eXBlTmFtZShiKSArICInIG9iamVjdCBpcyBub3QgaXRlcmFibGUiLAogICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwudHJ5Q2F0Y2goCiAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuY2FsbHNpbU9yU3VzcGVuZEFycmF5KGEpCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uU3RvcEl0ZXJhdGlvbikpIHRocm93IGEKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICB9LAogICAgICAgICAgICApCiAgICAgICAgICByZXR1cm4gYSA/IGMgOiBTay5taXNjZXZhbC5yZXRyeU9wdGlvbmFsU3VzcGVuc2lvbk9yVGhyb3coYykKICAgICAgICB9CiAgICAgICAgZS5wcm90b3R5cGUudHAkZ2V0aXRlbSA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICB2YXIgYyA9IHRoaXMudHAkZ2V0YXR0cihTay5idWlsdGluLnN0ci4kZ2V0aXRlbSwgYikKICAgICAgICAgIGlmICh2b2lkIDAgIT09IGMpCiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgKGEgPSBTay5taXNjZXZhbC5hcHBseU9yU3VzcGVuZChjLCB2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBbYV0pKSwKICAgICAgICAgICAgICBiID8gYSA6IFNrLm1pc2NldmFsLnJldHJ5T3B0aW9uYWxTdXNwZW5zaW9uT3JUaHJvdyhhKQogICAgICAgICAgICApCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICInIiArCiAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUodGhpcykgKwogICAgICAgICAgICAgICInIG9iamVjdCBkb2VzIG5vdCBzdXBwb3J0IGluZGV4aW5nIiwKICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgZS5wcm90b3R5cGUudHAkc2V0aXRlbSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgICB2YXIgZCA9IHRoaXMudHAkZ2V0YXR0cihTay5idWlsdGluLnN0ci4kc2V0aXRlbSwgYykKICAgICAgICAgIGlmICh2b2lkIDAgIT09IGQpCiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgKGEgPSBTay5taXNjZXZhbC5hcHBseU9yU3VzcGVuZChkLCB2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBbCiAgICAgICAgICAgICAgICBhLAogICAgICAgICAgICAgICAgYiwKICAgICAgICAgICAgICBdKSksCiAgICAgICAgICAgICAgYyA/IGEgOiBTay5taXNjZXZhbC5yZXRyeU9wdGlvbmFsU3VzcGVuc2lvbk9yVGhyb3coYSkKICAgICAgICAgICAgKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiJyIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKHRoaXMpICsKICAgICAgICAgICAgICAiJyBvYmplY3QgZG9lcyBub3Qgc3VwcG9ydCBpdGVtIGFzc2lnbm1lbnQiLAogICAgICAgICAgKQogICAgICAgIH0KICAgICAgICBiICYmCiAgICAgICAgICAoKGUuJGQgPSBuZXcgU2suYnVpbHRpbi5kaWN0KFtdKSksCiAgICAgICAgICBlLiRkLm1wJGFzc19zdWJzY3JpcHQoU2suYnVpbHRpbi50eXBlLmJhc2VzU3RyXywgYiksCiAgICAgICAgICAoYSA9IFNrLmJ1aWx0aW4udHlwZS5idWlsZE1STyhlKSksCiAgICAgICAgICBlLiRkLm1wJGFzc19zdWJzY3JpcHQoU2suYnVpbHRpbi50eXBlLm1yb1N0cl8sIGEpLAogICAgICAgICAgKGUudHAkbXJvID0gYSkpCiAgICAgICAgZS50cCRzZXRhdHRyID0gU2suYnVpbHRpbi50eXBlLnByb3RvdHlwZS50cCRzZXRhdHRyCiAgICAgICAgYSA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7CiAgICAgICAgICBlLnByb3RvdHlwZVthXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGEgPSAhMSwKICAgICAgICAgICAgICBiID0gYXJndW1lbnRzLmxlbmd0aCwKICAgICAgICAgICAgICBlCiAgICAgICAgICAgIHZhciBrID0gbnVsbCAhPT0gZCAmJiBkIDw9IGIgPyBBcnJheShiKSA6IEFycmF5KGIgKyAxKQogICAgICAgICAgICBrWzBdID0gdGhpcwogICAgICAgICAgICB2YXIgZyA9IDEKICAgICAgICAgICAgZm9yIChlID0gMDsgZSA8IGI7IGUrKykKICAgICAgICAgICAgICBlID09PSBkIC0gMQogICAgICAgICAgICAgICAgPyAoYSA9IGFyZ3VtZW50c1tlXSkKICAgICAgICAgICAgICAgIDogKChrW2ddID0gYXJndW1lbnRzW2VdKSwgKGcgKz0gMSkpCiAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgICAgPyBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kQXJyYXkoYywgaykKICAgICAgICAgICAgICA6IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShjLCBrKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBuIGluIFNrLmR1bmRlclRvU2t1bHB0KQogICAgICAgICAgKGIgPSBTay5kdW5kZXJUb1NrdWxwdFtuXSksCiAgICAgICAgICAgICJzdHJpbmciID09PSB0eXBlb2YgYiA/IChsID0gbnVsbCkgOiAoKGwgPSBiWzFdKSwgKGIgPSBiWzBdKSksCiAgICAgICAgICAgIGVbbl0gJiYgYShiLCBuLCBlW25dLCBsKQogICAgICAgIHJldHVybiBlCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50eXBlLm1ha2VUeXBlT2JqID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnR5cGUubWFrZUludG9UeXBlT2JqKGEsIGIpCiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5idWlsdGluLnR5cGUubWFrZUludG9UeXBlT2JqID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCh2b2lkIDAgIT09IGEpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQodm9pZCAwICE9PSBiKQogICAgICAgIGIub2IkdHlwZSA9IFNrLmJ1aWx0aW4udHlwZQogICAgICAgIGIudHAkbmFtZSA9IGEKICAgICAgICBiLiRyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIGEgPSBiLl9fbW9kdWxlX18sCiAgICAgICAgICAgIGQgPSAiIgogICAgICAgICAgYSAmJiAoZCA9IGEudiArICIuIikKICAgICAgICAgIHZhciBlID0gImNsYXNzIgogICAgICAgICAgYSB8fCBiLnNrJGtsYXNzIHx8IFNrLl9fZnV0dXJlX18uY2xhc3NfcmVwciB8fCAoZSA9ICJ0eXBlIikKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoIjwiICsgZSArICIgJyIgKyBkICsgYi50cCRuYW1lICsgIic+IikKICAgICAgICB9CiAgICAgICAgYi50cCRzdHIgPSB2b2lkIDAKICAgICAgICBiLnRwJGdldGF0dHIgPSBTay5idWlsdGluLnR5cGUucHJvdG90eXBlLnRwJGdldGF0dHIKICAgICAgICBiLnRwJHNldGF0dHIgPSBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuR2VuZXJpY1NldEF0dHIKICAgICAgICBiLnRwJHJpY2hjb21wYXJlID0gU2suYnVpbHRpbi50eXBlLnByb3RvdHlwZS50cCRyaWNoY29tcGFyZQogICAgICAgIGIuc2skdHlwZSA9ICEwCiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5idWlsdGluLnR5cGUub2IkdHlwZSA9IFNrLmJ1aWx0aW4udHlwZQogICAgICBTay5idWlsdGluLnR5cGUudHAkbmFtZSA9ICJ0eXBlIgogICAgICBTay5idWlsdGluLnR5cGUuc2skdHlwZSA9ICEwCiAgICAgIFNrLmJ1aWx0aW4udHlwZS4kciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gU2suX19mdXR1cmVfXy5jbGFzc19yZXByCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLnN0cigiPGNsYXNzICd0eXBlJz4iKQogICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5zdHIoIjx0eXBlICd0eXBlJz4iKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udHlwZS5wcm90b3R5cGUudHAkZ2V0YXR0ciA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgaWYgKHRoaXMuJGQpIHsKICAgICAgICAgIHZhciBjID0gdGhpcy4kZC5tcCRsb29rdXAoYSkKICAgICAgICAgIGlmICh2b2lkIDAgIT09IGMpIHJldHVybiBjCiAgICAgICAgfQogICAgICAgIGEgPSBTay5idWlsdGluLnR5cGUudHlwZUxvb2t1cCh0aGlzLCBhKQogICAgICAgIGlmICh2b2lkIDAgIT09IGEgJiYgbnVsbCAhPT0gYSAmJiB2b2lkIDAgIT09IGEub2IkdHlwZSkKICAgICAgICAgIHZhciBkID0gYS50cCRkZXNjcl9nZXQKICAgICAgICBpZiAoZCkgcmV0dXJuIGQuY2FsbChhLCBTay5idWlsdGluLm5vbmUubm9uZSQsIHRoaXMsIGIpCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gYSkgcmV0dXJuIGEKICAgICAgfQogICAgICBTay5idWlsdGluLnR5cGUucHJvdG90eXBlLnRwJHNldGF0dHIgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHRoaXNbYS4kanNzdHIoKV0gPSBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50eXBlLnR5cGVMb29rdXAgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjID0gYS50cCRtcm8sCiAgICAgICAgICBkLAogICAgICAgICAgZSA9IGIuJGpzc3RyKCkKICAgICAgICBpZiAoYykKICAgICAgICAgIGZvciAoZCA9IDA7IGQgPCBjLnYubGVuZ3RoOyArK2QpIHsKICAgICAgICAgICAgYSA9IGMudltkXQogICAgICAgICAgICBpZiAoYS5oYXNPd25Qcm9wZXJ0eShlKSkgcmV0dXJuIGFbZV0KICAgICAgICAgICAgdmFyIGYgPSBhLiRkLm1wJGxvb2t1cChiKQogICAgICAgICAgICBpZiAodm9pZCAwICE9PSBmKSByZXR1cm4gZgogICAgICAgICAgICBpZiAoYS5wcm90b3R5cGUgJiYgdm9pZCAwICE9PSBhLnByb3RvdHlwZVtlXSkgcmV0dXJuIGEucHJvdG90eXBlW2VdCiAgICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoYS5wcm90b3R5cGUpIHJldHVybiBhLnByb3RvdHlwZVtlXQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udHlwZS5tcm9NZXJnZV8gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGZvciAodmFyIGIsIGMsIGQsIGUsIGYsIGcsIGggPSBbXTsgOyApIHsKICAgICAgICAgIGZvciAoYyA9IDA7IGMgPCBhLmxlbmd0aCAmJiAoKGIgPSBhW2NdKSwgMCA9PT0gYi5sZW5ndGgpOyArK2MpOwogICAgICAgICAgaWYgKGMgPT09IGEubGVuZ3RoKSByZXR1cm4gaAogICAgICAgICAgZCA9IFtdCiAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgYS5sZW5ndGg7ICsrYykKICAgICAgICAgICAgaWYgKCgoYiA9IGFbY10pLCAwICE9PSBiLmxlbmd0aCkpIHsKICAgICAgICAgICAgICBnID0gYlswXQogICAgICAgICAgICAgIGYgPSAwCiAgICAgICAgICAgICAgYTogZm9yICg7IGYgPCBhLmxlbmd0aDsgKytmKQogICAgICAgICAgICAgICAgZm9yIChlID0gYVtmXSwgYiA9IDE7IGIgPCBlLmxlbmd0aDsgKytiKSBpZiAoZVtiXSA9PT0gZykgYnJlYWsgYQogICAgICAgICAgICAgIGYgPT09IGEubGVuZ3RoICYmIGQucHVzaChnKQogICAgICAgICAgICB9CiAgICAgICAgICBpZiAoMCA9PT0gZC5sZW5ndGgpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAiSW5jb25zaXN0ZW50IHByZWNlZGVuY2VzIGluIHR5cGUgaGllcmFyY2h5IiwKICAgICAgICAgICAgKQogICAgICAgICAgZCA9IGRbMF0KICAgICAgICAgIGgucHVzaChkKQogICAgICAgICAgZm9yIChjID0gMDsgYyA8IGEubGVuZ3RoOyArK2MpCiAgICAgICAgICAgIChiID0gYVtjXSksIDAgPCBiLmxlbmd0aCAmJiBiWzBdID09PSBkICYmIGIuc3BsaWNlKDAsIDEpCiAgICAgICAgfQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udHlwZS5idWlsZE1ST18gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0gW1thXV0sCiAgICAgICAgICBjID0gYS4kZC5tcCRzdWJzY3JpcHQoU2suYnVpbHRpbi50eXBlLmJhc2VzU3RyXykKICAgICAgICBmb3IgKGEgPSAwOyBhIDwgYy52Lmxlbmd0aDsgKythKQogICAgICAgICAgYi5wdXNoKFNrLmJ1aWx0aW4udHlwZS5idWlsZE1ST18oYy52W2FdKSkKICAgICAgICB2YXIgZCA9IFtdCiAgICAgICAgZm9yIChhID0gMDsgYSA8IGMudi5sZW5ndGg7ICsrYSkgZC5wdXNoKGMudlthXSkKICAgICAgICBiLnB1c2goZCkKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi50eXBlLm1yb01lcmdlXyhiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udHlwZS5idWlsZE1STyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnR1cGxlKFNrLmJ1aWx0aW4udHlwZS5idWlsZE1ST18oYSkpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50eXBlLnByb3RvdHlwZS50cCRyaWNoY29tcGFyZSA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgaWYgKGEub2IkdHlwZSA9PSBTay5idWlsdGluLnR5cGUgJiYgdGhpcy4kciAmJiBhLiRyKSB7CiAgICAgICAgICB2YXIgYyA9IHRoaXMuJHIoKQogICAgICAgICAgYSA9IGEuJHIoKQogICAgICAgICAgcmV0dXJuIGMudHAkcmljaGNvbXBhcmUoYSwgYikKICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50eXBlLnByb3RvdHlwZS5fX2Zvcm1hdF9fID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2Zvcm1hdF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMikKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50eXBlLnB5dGhvbkZ1bmN0aW9ucyA9IFsiX19mb3JtYXRfXyJdCiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHApIHsKICAgICAgU2suYWJzdHIgPSB7fQogICAgICBTay5hYnN0ci50eXBlTmFtZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gYS50cCRuYW1lID8gYS50cCRuYW1lIDogIjxpbnZhbGlkIHR5cGU+IgogICAgICB9CiAgICAgIFNrLmFic3RyLmJpbm9wX3R5cGVfZXJyb3IgPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIGEgPSBTay5hYnN0ci50eXBlTmFtZShhKQogICAgICAgIGIgPSBTay5hYnN0ci50eXBlTmFtZShiKQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICJ1bnN1cHBvcnRlZCBvcGVyYW5kIHR5cGUocykgZm9yICIgKwogICAgICAgICAgICBjICsKICAgICAgICAgICAgIjogJyIgKwogICAgICAgICAgICBhICsKICAgICAgICAgICAgIicgYW5kICciICsKICAgICAgICAgICAgYiArCiAgICAgICAgICAgICInIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYWJzdHIudW5vcF90eXBlX2Vycm9yID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBhID0gU2suYWJzdHIudHlwZU5hbWUoYSkKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAiYmFkIG9wZXJhbmQgdHlwZSBmb3IgdW5hcnkgIiArCiAgICAgICAgICAgIHsgVUFkZDogIisiLCBVU3ViOiAiLSIsIEludmVydDogIn4iIH1bYl0gKwogICAgICAgICAgICAiOiAnIiArCiAgICAgICAgICAgIGEgKwogICAgICAgICAgICAiJyIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmFic3RyLmJvTmFtZVRvU2xvdEZ1bmNMaHNfID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBpZiAobnVsbCAhPT0gYSkKICAgICAgICAgIHN3aXRjaCAoYikgewogICAgICAgICAgICBjYXNlICJBZGQiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJGFkZCA/IGEubmIkYWRkIDogYS5fX2FkZF9fCiAgICAgICAgICAgIGNhc2UgIlN1YiI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkc3VidHJhY3QgPyBhLm5iJHN1YnRyYWN0IDogYS5fX3N1Yl9fCiAgICAgICAgICAgIGNhc2UgIk11bHQiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJG11bHRpcGx5ID8gYS5uYiRtdWx0aXBseSA6IGEuX19tdWxfXwogICAgICAgICAgICBjYXNlICJNYXRNdWx0IjoKICAgICAgICAgICAgICBpZiAoU2suX19mdXR1cmVfXy5weXRob24zKQogICAgICAgICAgICAgICAgcmV0dXJuIGEudHAkbWF0bXVsID8gYS50cCRtYXRtdWwgOiBhLl9fbWF0bXVsX18KICAgICAgICAgICAgY2FzZSAiRGl2IjoKICAgICAgICAgICAgICByZXR1cm4gYS5uYiRkaXZpZGUgPyBhLm5iJGRpdmlkZSA6IGEuX19kaXZfXwogICAgICAgICAgICBjYXNlICJGbG9vckRpdiI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkZmxvb3JfZGl2aWRlID8gYS5uYiRmbG9vcl9kaXZpZGUgOiBhLl9fZmxvb3JkaXZfXwogICAgICAgICAgICBjYXNlICJNb2QiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJHJlbWFpbmRlciA/IGEubmIkcmVtYWluZGVyIDogYS5fX21vZF9fCiAgICAgICAgICAgIGNhc2UgIkRpdk1vZCI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkZGl2bW9kID8gYS5uYiRkaXZtb2QgOiBhLl9fZGl2bW9kX18KICAgICAgICAgICAgY2FzZSAiUG93IjoKICAgICAgICAgICAgICByZXR1cm4gYS5uYiRwb3dlciA/IGEubmIkcG93ZXIgOiBhLl9fcG93X18KICAgICAgICAgICAgY2FzZSAiTFNoaWZ0IjoKICAgICAgICAgICAgICByZXR1cm4gYS5uYiRsc2hpZnQgPyBhLm5iJGxzaGlmdCA6IGEuX19sc2hpZnRfXwogICAgICAgICAgICBjYXNlICJSU2hpZnQiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJHJzaGlmdCA/IGEubmIkcnNoaWZ0IDogYS5fX3JzaGlmdF9fCiAgICAgICAgICAgIGNhc2UgIkJpdEFuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkYW5kID8gYS5uYiRhbmQgOiBhLl9fYW5kX18KICAgICAgICAgICAgY2FzZSAiQml0WG9yIjoKICAgICAgICAgICAgICByZXR1cm4gYS5uYiR4b3IgPyBhLm5iJHhvciA6IGEuX194b3JfXwogICAgICAgICAgICBjYXNlICJCaXRPciI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkb3IgPyBhLm5iJG9yIDogYS5fX29yX18KICAgICAgICAgIH0KICAgICAgfQogICAgICBTay5hYnN0ci5ib05hbWVUb1Nsb3RGdW5jUmhzXyA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgaWYgKG51bGwgIT09IGEpCiAgICAgICAgICBzd2l0Y2ggKGIpIHsKICAgICAgICAgICAgY2FzZSAiQWRkIjoKICAgICAgICAgICAgICByZXR1cm4gYS5uYiRyZWZsZWN0ZWRfYWRkID8gYS5uYiRyZWZsZWN0ZWRfYWRkIDogYS5fX3JhZGRfXwogICAgICAgICAgICBjYXNlICJTdWIiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJHJlZmxlY3RlZF9zdWJ0cmFjdAogICAgICAgICAgICAgICAgPyBhLm5iJHJlZmxlY3RlZF9zdWJ0cmFjdAogICAgICAgICAgICAgICAgOiBhLl9fcnN1Yl9fCiAgICAgICAgICAgIGNhc2UgIk11bHQiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJHJlZmxlY3RlZF9tdWx0aXBseQogICAgICAgICAgICAgICAgPyBhLm5iJHJlZmxlY3RlZF9tdWx0aXBseQogICAgICAgICAgICAgICAgOiBhLl9fcm11bF9fCiAgICAgICAgICAgIGNhc2UgIk1hdE11bHQiOgogICAgICAgICAgICAgIGlmIChTay5fX2Z1dHVyZV9fLnB5dGhvbjMpCiAgICAgICAgICAgICAgICByZXR1cm4gYS50cCRyZWZsZWN0ZWRfbWF0bXVsCiAgICAgICAgICAgICAgICAgID8gYS50cCRyZWZsZWN0ZWRfbWF0bXVsCiAgICAgICAgICAgICAgICAgIDogYS5fX3JtYXRtdWxfXwogICAgICAgICAgICBjYXNlICJEaXYiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJHJlZmxlY3RlZF9kaXZpZGUgPyBhLm5iJHJlZmxlY3RlZF9kaXZpZGUgOiBhLl9fcmRpdl9fCiAgICAgICAgICAgIGNhc2UgIkZsb29yRGl2IjoKICAgICAgICAgICAgICByZXR1cm4gYS5uYiRyZWZsZWN0ZWRfZmxvb3JfZGl2aWRlCiAgICAgICAgICAgICAgICA/IGEubmIkcmVmbGVjdGVkX2Zsb29yX2RpdmlkZQogICAgICAgICAgICAgICAgOiBhLl9fcmZsb29yZGl2X18KICAgICAgICAgICAgY2FzZSAiTW9kIjoKICAgICAgICAgICAgICByZXR1cm4gYS5uYiRyZWZsZWN0ZWRfcmVtYWluZGVyCiAgICAgICAgICAgICAgICA/IGEubmIkcmVmbGVjdGVkX3JlbWFpbmRlcgogICAgICAgICAgICAgICAgOiBhLl9fcm1vZF9fCiAgICAgICAgICAgIGNhc2UgIkRpdk1vZCI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkcmVmbGVjdGVkX2Rpdm1vZAogICAgICAgICAgICAgICAgPyBhLm5iJHJlZmxlY3RlZF9kaXZtb2QKICAgICAgICAgICAgICAgIDogYS5fX3JkaXZtb2RfXwogICAgICAgICAgICBjYXNlICJQb3ciOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJHJlZmxlY3RlZF9wb3dlciA/IGEubmIkcmVmbGVjdGVkX3Bvd2VyIDogYS5fX3Jwb3dfXwogICAgICAgICAgICBjYXNlICJMU2hpZnQiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJHJlZmxlY3RlZF9sc2hpZnQKICAgICAgICAgICAgICAgID8gYS5uYiRyZWZsZWN0ZWRfbHNoaWZ0CiAgICAgICAgICAgICAgICA6IGEuX19ybHNoaWZ0X18KICAgICAgICAgICAgY2FzZSAiUlNoaWZ0IjoKICAgICAgICAgICAgICByZXR1cm4gYS5uYiRyZWZsZWN0ZWRfcnNoaWZ0CiAgICAgICAgICAgICAgICA/IGEubmIkcmVmbGVjdGVkX3JzaGlmdAogICAgICAgICAgICAgICAgOiBhLl9fcnJzaGlmdF9fCiAgICAgICAgICAgIGNhc2UgIkJpdEFuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkcmVmbGVjdGVkX2FuZCA/IGEubmIkcmVmbGVjdGVkX2FuZCA6IGEuX19yYW5kX18KICAgICAgICAgICAgY2FzZSAiQml0WG9yIjoKICAgICAgICAgICAgICByZXR1cm4gYS5uYiRyZWZsZWN0ZWRfeG9yID8gYS5uYiRyZWZsZWN0ZWRfeG9yIDogYS5fX3J4b3JfXwogICAgICAgICAgICBjYXNlICJCaXRPciI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkcmVmbGVjdGVkX29yID8gYS5uYiRyZWZsZWN0ZWRfb3IgOiBhLl9fcm9yX18KICAgICAgICAgIH0KICAgICAgfQogICAgICBTay5hYnN0ci5pYm9OYW1lVG9TbG90RnVuY18gPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHN3aXRjaCAoYikgewogICAgICAgICAgY2FzZSAiQWRkIjoKICAgICAgICAgICAgcmV0dXJuIGEubmIkaW5wbGFjZV9hZGQgPyBhLm5iJGlucGxhY2VfYWRkIDogYS5fX2lhZGRfXwogICAgICAgICAgY2FzZSAiU3ViIjoKICAgICAgICAgICAgcmV0dXJuIGEubmIkaW5wbGFjZV9zdWJ0cmFjdCA/IGEubmIkaW5wbGFjZV9zdWJ0cmFjdCA6IGEuX19pc3ViX18KICAgICAgICAgIGNhc2UgIk11bHQiOgogICAgICAgICAgICByZXR1cm4gYS5uYiRpbnBsYWNlX211bHRpcGx5ID8gYS5uYiRpbnBsYWNlX211bHRpcGx5IDogYS5fX2ltdWxfXwogICAgICAgICAgY2FzZSAiTWF0TXVsdCI6CiAgICAgICAgICAgIGlmIChTay5fX2Z1dHVyZV9fLnB5dGhvbjMpCiAgICAgICAgICAgICAgcmV0dXJuIGEudHAkaW5wbGFjZV9tYXRtdWwgPyBhLnRwJGlucGxhY2VfbWF0bXVsIDogYS5fX2ltYXRtdWxfXwogICAgICAgICAgY2FzZSAiRGl2IjoKICAgICAgICAgICAgcmV0dXJuIGEubmIkaW5wbGFjZV9kaXZpZGUgPyBhLm5iJGlucGxhY2VfZGl2aWRlIDogYS5fX2lkaXZfXwogICAgICAgICAgY2FzZSAiRmxvb3JEaXYiOgogICAgICAgICAgICByZXR1cm4gYS5uYiRpbnBsYWNlX2Zsb29yX2RpdmlkZQogICAgICAgICAgICAgID8gYS5uYiRpbnBsYWNlX2Zsb29yX2RpdmlkZQogICAgICAgICAgICAgIDogYS5fX2lmbG9vcmRpdl9fCiAgICAgICAgICBjYXNlICJNb2QiOgogICAgICAgICAgICByZXR1cm4gYS5uYiRpbnBsYWNlX3JlbWFpbmRlcgogICAgICAgICAgY2FzZSAiUG93IjoKICAgICAgICAgICAgcmV0dXJuIGEubmIkaW5wbGFjZV9wb3dlcgogICAgICAgICAgY2FzZSAiTFNoaWZ0IjoKICAgICAgICAgICAgcmV0dXJuIGEubmIkaW5wbGFjZV9sc2hpZnQgPyBhLm5iJGlucGxhY2VfbHNoaWZ0IDogYS5fX2lsc2hpZnRfXwogICAgICAgICAgY2FzZSAiUlNoaWZ0IjoKICAgICAgICAgICAgcmV0dXJuIGEubmIkaW5wbGFjZV9yc2hpZnQgPyBhLm5iJGlucGxhY2VfcnNoaWZ0IDogYS5fX2lyc2hpZnRfXwogICAgICAgICAgY2FzZSAiQml0QW5kIjoKICAgICAgICAgICAgcmV0dXJuIGEubmIkaW5wbGFjZV9hbmQKICAgICAgICAgIGNhc2UgIkJpdE9yIjoKICAgICAgICAgICAgcmV0dXJuIGEubmIkaW5wbGFjZV9vcgogICAgICAgICAgY2FzZSAiQml0WG9yIjoKICAgICAgICAgICAgcmV0dXJuIGEubmIkaW5wbGFjZV94b3IgPyBhLm5iJGlucGxhY2VfeG9yIDogYS5fX2l4b3JfXwogICAgICAgIH0KICAgICAgfQogICAgICBTay5hYnN0ci51b05hbWVUb1Nsb3RGdW5jXyA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgaWYgKG51bGwgIT09IGEpCiAgICAgICAgICBzd2l0Y2ggKGIpIHsKICAgICAgICAgICAgY2FzZSAiVVN1YiI6CiAgICAgICAgICAgICAgcmV0dXJuIGEubmIkbmVnYXRpdmUgPyBhLm5iJG5lZ2F0aXZlIDogYS5fX25lZ19fCiAgICAgICAgICAgIGNhc2UgIlVBZGQiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJHBvc2l0aXZlID8gYS5uYiRwb3NpdGl2ZSA6IGEuX19wb3NfXwogICAgICAgICAgICBjYXNlICJJbnZlcnQiOgogICAgICAgICAgICAgIHJldHVybiBhLm5iJGludmVydCA/IGEubmIkaW52ZXJ0IDogYS5fX2ludmVydF9fCiAgICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYWJzdHIuYmluYXJ5X29wXyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQgPSBiLmNvbnN0cnVjdG9yLnByb3RvdHlwZSBpbnN0YW5jZW9mIGEuY29uc3RydWN0b3IKICAgICAgICBpZiAoZCkgewogICAgICAgICAgdmFyIGUgPSBTay5hYnN0ci5ib05hbWVUb1Nsb3RGdW5jUmhzXyhiLCBjKQogICAgICAgICAgaWYgKAogICAgICAgICAgICB2b2lkIDAgIT09IGUgJiYKICAgICAgICAgICAgKChlID0gZS5jYWxsID8gZS5jYWxsKGIsIGEpIDogU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGUsIFtiLCBhXSkpLAogICAgICAgICAgICB2b2lkIDAgIT09IGUgJiYgZSAhPT0gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQpCiAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiBlCiAgICAgICAgfQogICAgICAgIGUgPSBTay5hYnN0ci5ib05hbWVUb1Nsb3RGdW5jTGhzXyhhLCBjKQogICAgICAgIGlmICgKICAgICAgICAgICh2b2lkIDAgIT09IGUgJiYKICAgICAgICAgICAgKChlID0gZS5jYWxsID8gZS5jYWxsKGEsIGIpIDogU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGUsIFthLCBiXSkpLAogICAgICAgICAgICB2b2lkIDAgIT09IGUgJiYgZSAhPT0gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQpKSB8fAogICAgICAgICAgKCFkICYmCiAgICAgICAgICAgICgoZSA9IFNrLmFic3RyLmJvTmFtZVRvU2xvdEZ1bmNSaHNfKGIsIGMpKSwKICAgICAgICAgICAgdm9pZCAwICE9PSBlICYmCiAgICAgICAgICAgICAgKChlID0gZS5jYWxsCiAgICAgICAgICAgICAgICA/IGUuY2FsbChiLCBhKQogICAgICAgICAgICAgICAgOiBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoZSwgW2IsIGFdKSksCiAgICAgICAgICAgICAgdm9pZCAwICE9PSBlICYmIGUgIT09IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkKSkpCiAgICAgICAgKQogICAgICAgICAgcmV0dXJuIGUKICAgICAgICBTay5hYnN0ci5iaW5vcF90eXBlX2Vycm9yKGEsIGIsIGMpCiAgICAgIH0KICAgICAgU2suYWJzdHIuYmluYXJ5X2lvcF8gPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIHZhciBkID0gU2suYWJzdHIuaWJvTmFtZVRvU2xvdEZ1bmNfKGEsIGMpCiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gZCAmJgogICAgICAgICAgKChkID0gZC5jYWxsID8gZC5jYWxsKGEsIGIpIDogU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGQsIFthLCBiXSkpLAogICAgICAgICAgdm9pZCAwICE9PSBkICYmIGQgIT09IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkKQogICAgICAgICAgPyBkCiAgICAgICAgICA6IFNrLmFic3RyLmJpbmFyeV9vcF8oYSwgYiwgYykKICAgICAgfQogICAgICBTay5hYnN0ci51bmFyeV9vcF8gPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjID0gU2suYWJzdHIudW9OYW1lVG9TbG90RnVuY18oYSwgYikKICAgICAgICBpZiAoCiAgICAgICAgICB2b2lkIDAgIT09IGMgJiYKICAgICAgICAgICgoYyA9IGMuY2FsbCA/IGMuY2FsbChhKSA6IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShjLCBbYV0pKSwKICAgICAgICAgIHZvaWQgMCAhPT0gYykKICAgICAgICApCiAgICAgICAgICByZXR1cm4gYwogICAgICAgIFNrLmFic3RyLnVub3BfdHlwZV9lcnJvcihhLCBiKQogICAgICB9CiAgICAgIFNrLmFic3RyLm51bU9wQW5kUHJvbW90ZSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgaWYgKG51bGwgIT09IGEgJiYgbnVsbCAhPT0gYikgewogICAgICAgICAgaWYgKCJudW1iZXIiID09PSB0eXBlb2YgYSAmJiAibnVtYmVyIiA9PT0gdHlwZW9mIGIpCiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgKGMgPSBjKGEsIGIpKSwKICAgICAgICAgICAgICAoYyA+IFNrLmJ1aWx0aW4uaW50Xy50aHJlc2hvbGQkIHx8CiAgICAgICAgICAgICAgICBjIDwgLVNrLmJ1aWx0aW4uaW50Xy50aHJlc2hvbGQkKSAmJgogICAgICAgICAgICAgIE1hdGguZmxvb3IoYykgPT09IGMKICAgICAgICAgICAgICAgID8gW1NrLmJ1aWx0aW4ubG5nLmZyb21JbnQkKGEpLCBTay5idWlsdGluLmxuZy5mcm9tSW50JChiKV0KICAgICAgICAgICAgICAgIDogYwogICAgICAgICAgICApCiAgICAgICAgICBpZiAodm9pZCAwID09PSBhIHx8IHZvaWQgMCA9PT0gYikKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTmFtZUVycm9yKCJVbmRlZmluZWQgdmFyaWFibGUgaW4gZXhwcmVzc2lvbiIpCiAgICAgICAgICBpZiAoYS5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5sbmcpIHJldHVybiBbYSwgYl0KICAgICAgICAgIGlmICgKICAgICAgICAgICAgKGEuY29uc3RydWN0b3IgIT09IFNrLmJ1aWx0aW4uaW50XyAmJgogICAgICAgICAgICAgIGEuY29uc3RydWN0b3IgIT09IFNrLmJ1aWx0aW4uZmxvYXRfKSB8fAogICAgICAgICAgICBiLmNvbnN0cnVjdG9yICE9PSBTay5idWlsdGluLmNvbXBsZXgKICAgICAgICAgICkgewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgYS5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICAgICAgYS5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgICAgKQogICAgICAgICAgICAgIHJldHVybiBbYSwgYl0KICAgICAgICAgICAgaWYgKCJudW1iZXIiID09PSB0eXBlb2YgYSkgcmV0dXJuIChhID0gU2suYnVpbHRpbi5hc3NrJChhKSksIFthLCBiXQogICAgICAgICAgfSBlbHNlIHJldHVybiAoYSA9IG5ldyBTay5idWlsdGluLmNvbXBsZXgoYSkpLCBbYSwgYl0KICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYWJzdHIuYm9OdW1Qcm9tb3RlXyA9IHsKICAgICAgICBBZGQ6IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICByZXR1cm4gYSArIGIKICAgICAgICB9LAogICAgICAgIFN1YjogZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBhIC0gYgogICAgICAgIH0sCiAgICAgICAgTXVsdDogZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHJldHVybiBhICogYgogICAgICAgIH0sCiAgICAgICAgTW9kOiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgaWYgKDAgPT09IGIpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlplcm9EaXZpc2lvbkVycm9yKCJkaXZpc2lvbiBvciBtb2R1bG8gYnkgemVybyIpCiAgICAgICAgICBhICU9IGIKICAgICAgICAgIHJldHVybiAwID4gYSAqIGIgPyBhICsgYiA6IGEKICAgICAgICB9LAogICAgICAgIERpdjogZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIGlmICgwID09PSBiKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5aZXJvRGl2aXNpb25FcnJvcigiZGl2aXNpb24gb3IgbW9kdWxvIGJ5IHplcm8iKQogICAgICAgICAgcmV0dXJuIGEgLyBiCiAgICAgICAgfSwKICAgICAgICBGbG9vckRpdjogZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIGlmICgwID09PSBiKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5aZXJvRGl2aXNpb25FcnJvcigiZGl2aXNpb24gb3IgbW9kdWxvIGJ5IHplcm8iKQogICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoYSAvIGIpCiAgICAgICAgfSwKICAgICAgICBQb3c6IE1hdGgucG93LAogICAgICAgIEJpdEFuZDogZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIGEgJj0gYgogICAgICAgICAgMCA+IGEgJiYgKGEgKz0gNDI5NDk2NzI5NikKICAgICAgICAgIHJldHVybiBhCiAgICAgICAgfSwKICAgICAgICBCaXRPcjogZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIGEgfD0gYgogICAgICAgICAgMCA+IGEgJiYgKGEgKz0gNDI5NDk2NzI5NikKICAgICAgICAgIHJldHVybiBhCiAgICAgICAgfSwKICAgICAgICBCaXRYb3I6IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICBhIF49IGIKICAgICAgICAgIDAgPiBhICYmIChhICs9IDQyOTQ5NjcyOTYpCiAgICAgICAgICByZXR1cm4gYQogICAgICAgIH0sCiAgICAgICAgTFNoaWZ0OiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgaWYgKDAgPiBiKSB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJuZWdhdGl2ZSBzaGlmdCBjb3VudCIpCiAgICAgICAgICB2YXIgYyA9IGEgPDwgYgogICAgICAgICAgcmV0dXJuIGMgPiBhID8gYyA6IGEgKiBNYXRoLnBvdygyLCBiKQogICAgICAgIH0sCiAgICAgICAgUlNoaWZ0OiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgaWYgKDAgPiBiKSB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJuZWdhdGl2ZSBzaGlmdCBjb3VudCIpCiAgICAgICAgICB2YXIgYyA9IGEgPj4gYgogICAgICAgICAgMCA8IGEgJiYgMCA+IGMgJiYgKGMgJj0gTWF0aC5wb3coMiwgMzIgLSBiKSAtIDEpCiAgICAgICAgICByZXR1cm4gYwogICAgICAgIH0sCiAgICAgIH0KICAgICAgU2suYWJzdHIubnVtYmVyQmluT3AgPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIHZhciBkID0gU2suYWJzdHIuYm9OdW1Qcm9tb3RlX1tjXQogICAgICAgIGlmICh2b2lkIDAgIT09IGQpIHsKICAgICAgICAgIGQgPSBTay5hYnN0ci5udW1PcEFuZFByb21vdGUoYSwgYiwgZCkKICAgICAgICAgIGlmICgibnVtYmVyIiA9PT0gdHlwZW9mIGQpIHJldHVybiBkCiAgICAgICAgICBpZiAoCiAgICAgICAgICAgICh2b2lkIDAgIT09IGQgJiYgZC5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5pbnRfKSB8fAogICAgICAgICAgICAodm9pZCAwICE9PSBkICYmIGQuY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4uZmxvYXRfKSB8fAogICAgICAgICAgICAodm9pZCAwICE9PSBkICYmIGQuY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4ubG5nKQogICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4gZAogICAgICAgICAgdm9pZCAwICE9PSBkICYmICgoYSA9IGRbMF0pLCAoYiA9IGRbMV0pKQogICAgICAgIH0KICAgICAgICByZXR1cm4gU2suYWJzdHIuYmluYXJ5X29wXyhhLCBiLCBjKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYWJzdHIubnVtYmVyQmluT3AiLCBTay5hYnN0ci5udW1iZXJCaW5PcCkKICAgICAgU2suYWJzdHIubnVtYmVySW5wbGFjZUJpbk9wID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICB2YXIgZCA9IFNrLmFic3RyLmJvTnVtUHJvbW90ZV9bY10KICAgICAgICBpZiAodm9pZCAwICE9PSBkKSB7CiAgICAgICAgICBkID0gU2suYWJzdHIubnVtT3BBbmRQcm9tb3RlKGEsIGIsIGQpCiAgICAgICAgICBpZiAoIm51bWJlciIgPT09IHR5cGVvZiBkKSByZXR1cm4gZAogICAgICAgICAgaWYgKAogICAgICAgICAgICAodm9pZCAwICE9PSBkICYmIGQuY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4uaW50XykgfHwKICAgICAgICAgICAgKHZvaWQgMCAhPT0gZCAmJiBkLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLmZsb2F0XykgfHwKICAgICAgICAgICAgKHZvaWQgMCAhPT0gZCAmJiBkLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLmxuZykKICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIGQKICAgICAgICAgIHZvaWQgMCAhPT0gZCAmJiAoKGEgPSBkWzBdKSwgKGIgPSBkWzFdKSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFNrLmFic3RyLmJpbmFyeV9pb3BfKGEsIGIsIGMpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKAogICAgICAgICJTay5hYnN0ci5udW1iZXJJbnBsYWNlQmluT3AiLAogICAgICAgIFNrLmFic3RyLm51bWJlcklucGxhY2VCaW5PcCwKICAgICAgKQogICAgICBTay5hYnN0ci5udW1iZXJVbmFyeU9wID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBpZiAoIk5vdCIgPT09IGIpCiAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuaXNUcnVlKGEpCiAgICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgICAgICA6IFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5ib29sKSB7CiAgICAgICAgICB2YXIgYyA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgICBpZiAoIlVTdWIiID09PSBiKSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XygtYykKICAgICAgICAgIGlmICgiVUFkZCIgPT09IGIpIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKGMpCiAgICAgICAgICBpZiAoIkludmVydCIgPT09IGIpIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKH5jKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoIlVTdWIiID09PSBiICYmIGEubmIkbmVnYXRpdmUpIHJldHVybiBhLm5iJG5lZ2F0aXZlKCkKICAgICAgICAgIGlmICgiVUFkZCIgPT09IGIgJiYgYS5uYiRwb3NpdGl2ZSkgcmV0dXJuIGEubmIkcG9zaXRpdmUoKQogICAgICAgICAgaWYgKCJJbnZlcnQiID09PSBiICYmIGEubmIkaW52ZXJ0KSByZXR1cm4gYS5uYiRpbnZlcnQoKQogICAgICAgIH0KICAgICAgICByZXR1cm4gU2suYWJzdHIudW5hcnlfb3BfKGEsIGIpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5hYnN0ci5udW1iZXJVbmFyeU9wIiwgU2suYWJzdHIubnVtYmVyVW5hcnlPcCkKICAgICAgU2suYWJzdHIuZml4U2VxSW5kZXhfID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBiID0gU2suYnVpbHRpbi5hc251bSQoYikKICAgICAgICAwID4gYiAmJiBhLnNxJGxlbmd0aCAmJiAoYiArPSBhLnNxJGxlbmd0aCgpKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2VxdWVuY2VDb250YWlucyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgaWYgKGEuc3EkY29udGFpbnMpIHJldHVybiBhLnNxJGNvbnRhaW5zKGIpCiAgICAgICAgdmFyIGQgPSBTay5hYnN0ci5sb29rdXBTcGVjaWFsKGEsIFNrLmJ1aWx0aW4uc3RyLiRjb250YWlucykKICAgICAgICBpZiAobnVsbCAhPSBkKQogICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmlzVHJ1ZShTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoZCwgW2EsIGJdKSkKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZShhKSkKICAgICAgICAgIHRocm93ICgKICAgICAgICAgICAgKChjID0gU2suYWJzdHIudHlwZU5hbWUoYSkpLAogICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgImFyZ3VtZW50IG9mIHR5cGUgJyIgKyBjICsgIicgaXMgbm90IGl0ZXJhYmxlIiwKICAgICAgICAgICAgKSkKICAgICAgICAgICkKICAgICAgICBhID0gU2subWlzY2V2YWwuaXRlckZvcigKICAgICAgICAgIFNrLmFic3RyLml0ZXIoYSksCiAgICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGEsIGIsICJFcSIpCiAgICAgICAgICAgICAgPyBuZXcgU2subWlzY2V2YWwuQnJlYWsoITApCiAgICAgICAgICAgICAgOiAhMQogICAgICAgICAgfSwKICAgICAgICAgICExLAogICAgICAgICkKICAgICAgICByZXR1cm4gYyA/IGEgOiBTay5taXNjZXZhbC5yZXRyeU9wdGlvbmFsU3VzcGVuc2lvbk9yVGhyb3coYSkKICAgICAgfQogICAgICBTay5hYnN0ci5zZXF1ZW5jZUNvbmNhdCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgaWYgKGEuc3EkY29uY2F0KSByZXR1cm4gYS5zcSRjb25jYXQoYikKICAgICAgICBhID0gU2suYWJzdHIudHlwZU5hbWUoYSkKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAiJyIgKyBhICsgIicgb2JqZWN0IGNhbid0IGJlIGNvbmNhdGVuYXRlZCIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNlcXVlbmNlR2V0SW5kZXhPZiA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgaWYgKGEuaW5kZXgpIHJldHVybiBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYS5pbmRleCwgW2EsIGJdKQogICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrSXRlcmFibGUoYSkpIHsKICAgICAgICAgIHZhciBjID0gMAogICAgICAgICAgdmFyIGQgPSBTay5hYnN0ci5pdGVyKGEpCiAgICAgICAgICBmb3IgKGEgPSBkLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gYTsgYSA9IGQudHAkaXRlcm5leHQoKSkgewogICAgICAgICAgICBpZiAoU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGIsIGEsICJFcSIpKQogICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKGMpCiAgICAgICAgICAgIGMgKz0gMQogICAgICAgICAgfQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigKICAgICAgICAgICAgInNlcXVlbmNlLmluZGV4KHgpOiB4IG5vdCBpbiBzZXF1ZW5jZSIsCiAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIGIgPSBTay5hYnN0ci50eXBlTmFtZShhKQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICJhcmd1bWVudCBvZiB0eXBlICciICsgYiArICInIGlzIG5vdCBpdGVyYWJsZSIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNlcXVlbmNlR2V0Q291bnRPZiA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgaWYgKGEuY291bnQpIHJldHVybiBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYS5jb3VudCwgW2EsIGJdKQogICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrSXRlcmFibGUoYSkpIHsKICAgICAgICAgIHZhciBjID0gMAogICAgICAgICAgdmFyIGQgPSBTay5hYnN0ci5pdGVyKGEpCiAgICAgICAgICBmb3IgKGEgPSBkLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gYTsgYSA9IGQudHAkaXRlcm5leHQoKSkKICAgICAgICAgICAgU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGIsIGEsICJFcSIpICYmIChjICs9IDEpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhjKQogICAgICAgIH0KICAgICAgICBiID0gU2suYWJzdHIudHlwZU5hbWUoYSkKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAiYXJndW1lbnQgb2YgdHlwZSAnIiArIGIgKyAiJyBpcyBub3QgaXRlcmFibGUiLAogICAgICAgICkKICAgICAgfQogICAgICBTay5hYnN0ci5zZXF1ZW5jZUdldEl0ZW0gPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIGlmIChhLm1wJHN1YnNjcmlwdCkgcmV0dXJuIGEubXAkc3Vic2NyaXB0KGIpCiAgICAgICAgYSA9IFNrLmFic3RyLnR5cGVOYW1lKGEpCiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCInIiArIGEgKyAiJyBvYmplY3QgaXMgdW5zdWJzY3JpcHRhYmxlIikKICAgICAgfQogICAgICBTay5hYnN0ci5zZXF1ZW5jZVNldEl0ZW0gPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgewogICAgICAgIGlmIChhLm1wJGFzc19zdWJzY3JpcHQpIHJldHVybiBhLm1wJGFzc19zdWJzY3JpcHQoYiwgYykKICAgICAgICBhID0gU2suYWJzdHIudHlwZU5hbWUoYSkKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAiJyIgKyBhICsgIicgb2JqZWN0IGRvZXMgbm90IHN1cHBvcnQgaXRlbSBhc3NpZ25tZW50IiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2VxdWVuY2VEZWxJdGVtID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBpZiAoYS5zcSRkZWxfaXRlbSkgKGIgPSBTay5hYnN0ci5maXhTZXFJbmRleF8oYSwgYikpLCBhLnNxJGRlbF9pdGVtKGIpCiAgICAgICAgZWxzZQogICAgICAgICAgdGhyb3cgKAogICAgICAgICAgICAoKGEgPSBTay5hYnN0ci50eXBlTmFtZShhKSksCiAgICAgICAgICAgIG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAiJyIgKyBhICsgIicgb2JqZWN0IGRvZXMgbm90IHN1cHBvcnQgaXRlbSBkZWxldGlvbiIsCiAgICAgICAgICAgICkpCiAgICAgICAgICApCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2VxdWVuY2VSZXBlYXQgPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIGMgPSBTay5idWlsdGluLmFzbnVtJChjKQogICAgICAgIGlmICh2b2lkIDAgPT09IFNrLm1pc2NldmFsLmFzSW5kZXgoYykpCiAgICAgICAgICB0aHJvdyAoCiAgICAgICAgICAgICgoYSA9IFNrLmFic3RyLnR5cGVOYW1lKGMpKSwKICAgICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICJjYW4ndCBtdWx0aXBseSBzZXF1ZW5jZSBieSBub24taW50IG9mIHR5cGUgJyIgKyBhICsgIiciLAogICAgICAgICAgICApKQogICAgICAgICAgKQogICAgICAgIHJldHVybiBhLmNhbGwoYiwgYykKICAgICAgfQogICAgICBTay5hYnN0ci5zZXF1ZW5jZUdldFNsaWNlID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICBpZiAoYS5zcSRzbGljZSkKICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIChiID0gU2suYWJzdHIuZml4U2VxSW5kZXhfKGEsIGIpKSwKICAgICAgICAgICAgKGMgPSBTay5hYnN0ci5maXhTZXFJbmRleF8oYSwgYykpLAogICAgICAgICAgICBhLnNxJHNsaWNlKGIsIGMpCiAgICAgICAgICApCiAgICAgICAgaWYgKGEubXAkc3Vic2NyaXB0KSByZXR1cm4gYS5tcCRzdWJzY3JpcHQobmV3IFNrLmJ1aWx0aW4uc2xpY2UoYiwgYykpCiAgICAgICAgYSA9IFNrLmFic3RyLnR5cGVOYW1lKGEpCiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCInIiArIGEgKyAiJyBvYmplY3QgaXMgdW5zbGljZWFibGUiKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNlcXVlbmNlRGVsU2xpY2UgPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIGlmIChhLnNxJGRlbF9zbGljZSkKICAgICAgICAgIChiID0gU2suYWJzdHIuZml4U2VxSW5kZXhfKGEsIGIpKSwKICAgICAgICAgICAgKGMgPSBTay5hYnN0ci5maXhTZXFJbmRleF8oYSwgYykpLAogICAgICAgICAgICBhLnNxJGRlbF9zbGljZShiLCBjKQogICAgICAgIGVsc2UKICAgICAgICAgIHRocm93ICgKICAgICAgICAgICAgKChhID0gU2suYWJzdHIudHlwZU5hbWUoYSkpLAogICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgIiciICsgYSArICInIGRvZXNuJ3Qgc3VwcG9ydCBzbGljZSBkZWxldGlvbiIsCiAgICAgICAgICAgICkpCiAgICAgICAgICApCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2VxdWVuY2VTZXRTbGljZSA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7CiAgICAgICAgaWYgKGEuc3EkYXNzX3NsaWNlKQogICAgICAgICAgKGIgPSBTay5hYnN0ci5maXhTZXFJbmRleF8oYSwgYikpLAogICAgICAgICAgICAoYyA9IFNrLmFic3RyLmZpeFNlcUluZGV4XyhhLCBjKSksCiAgICAgICAgICAgIGEuc3EkYXNzX3NsaWNlKGIsIGMsIGQpCiAgICAgICAgZWxzZSBpZiAoYS5tcCRhc3Nfc3Vic2NyaXB0KQogICAgICAgICAgYS5tcCRhc3Nfc3Vic2NyaXB0KG5ldyBTay5idWlsdGluLnNsaWNlKGIsIGMpLCBkKQogICAgICAgIGVsc2UKICAgICAgICAgIHRocm93ICgKICAgICAgICAgICAgKChhID0gU2suYWJzdHIudHlwZU5hbWUoYSkpLAogICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgIiciICsgYSArICInIG9iamVjdCBkb2Vzbid0IHN1cHBvcnQgc2xpY2UgYXNzaWdubWVudCIsCiAgICAgICAgICAgICkpCiAgICAgICAgICApCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2VxdWVuY2VVbnBhY2sgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjID0gW10sCiAgICAgICAgICBkCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrSXRlcmFibGUoYSkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICInIiArIFNrLmFic3RyLnR5cGVOYW1lKGEpICsgIicgb2JqZWN0IGlzIG5vdCBpdGVyYWJsZSIsCiAgICAgICAgICApCiAgICAgICAgYSA9IFNrLmFic3RyLml0ZXIoYSkKICAgICAgICBmb3IgKAogICAgICAgICAgZCA9IGEudHAkaXRlcm5leHQoKTsKICAgICAgICAgIHZvaWQgMCAhPT0gZCAmJiBjLmxlbmd0aCA8IGI7CiAgICAgICAgICBkID0gYS50cCRpdGVybmV4dCgpCiAgICAgICAgKQogICAgICAgICAgYy5wdXNoKGQpCiAgICAgICAgaWYgKGMubGVuZ3RoIDwgYikKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoCiAgICAgICAgICAgICJuZWVkIG1vcmUgdGhhbiAiICsgYy5sZW5ndGggKyAiIHZhbHVlcyB0byB1bnBhY2siLAogICAgICAgICAgKQogICAgICAgIGlmICh2b2lkIDAgIT09IGQpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJ0b28gbWFueSB2YWx1ZXMgdG8gdW5wYWNrIikKICAgICAgICByZXR1cm4gYwogICAgICB9CiAgICAgIFNrLmFic3RyLm1hcHBpbmdVbnBhY2tJbnRvS2V5d29yZEFycmF5ID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuY2hhaW4oCiAgICAgICAgICBiLnRwJGdldGF0dHIobmV3IFNrLmJ1aWx0aW4uc3RyKCJpdGVtcyIpKSwKICAgICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgIGlmICghYSkgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJPYmplY3QgaXMgbm90IGEgbWFwcGluZyIpCiAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kKGEpCiAgICAgICAgICB9LAogICAgICAgICAgZnVuY3Rpb24gKGIpIHsKICAgICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLml0ZXJGb3IoU2suYWJzdHIuaXRlcihiKSwgZnVuY3Rpb24gKGIpIHsKICAgICAgICAgICAgICBpZiAoIWIgfHwgIWIudikKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAgICAgIk9iamVjdCBpcyBub3QgYSBtYXBwaW5nOyBpdGVtcygpIGRvZXMgbm90IHJldHVybiB0dXBsZXMiLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIGlmICghKGIudlswXSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uc3RyKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAgICAgKGMudHAkbmFtZSA/IGMudHAkbmFtZSArICI6IiA6ICIiKSArCiAgICAgICAgICAgICAgICAgICAgImtleXdvcmRzIG11c3QgYmUgc3RyaW5ncyIsCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgYS5wdXNoKGIudlswXS52LCBiLnZbMV0pCiAgICAgICAgICAgIH0pCiAgICAgICAgICB9LAogICAgICAgICkKICAgICAgfQogICAgICBTay5hYnN0ci5vYmplY3RGb3JtYXQgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjID0gU2suYWJzdHIubG9va3VwU3BlY2lhbChhLCBTay5idWlsdGluLnN0ci4kZm9ybWF0KQogICAgICAgIGlmIChudWxsID09IGMpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJUeXBlICIgKyBTay5hYnN0ci50eXBlTmFtZShhKSArICIgZG9lc24ndCBkZWZpbmUgX19mb3JtYXRfXyIsCiAgICAgICAgICApCiAgICAgICAgYSA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShjLCBbYSwgYl0pCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrU3RyaW5nKGEpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiX19mb3JtYXRfXyBtdXN0IHJldHVybiBhIHN0ciwgbm90ICIgKyBTay5hYnN0ci50eXBlTmFtZShhKSwKICAgICAgICAgICkKICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICAgIFNrLmFic3RyLm9iamVjdEFkZCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgaWYgKGEubmIkYWRkKSByZXR1cm4gYS5uYiRhZGQoYikKICAgICAgICBhID0gU2suYWJzdHIudHlwZU5hbWUoYSkKICAgICAgICBiID0gU2suYWJzdHIudHlwZU5hbWUoYikKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAidW5zdXBwb3J0ZWQgb3BlcmFuZCB0eXBlKHMpIGZvciArOiAnIiArIGEgKyAiJyBhbmQgJyIgKyBiICsgIiciLAogICAgICAgICkKICAgICAgfQogICAgICBTay5hYnN0ci5vYmplY3ROZWdhdGl2ZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIgPSBTay5idWlsdGluLmFzbnVtJChhKQogICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmJvb2wgJiYgKGEgPSBuZXcgU2suYnVpbHRpbi5pbnRfKGIpKQogICAgICAgIGlmIChhLm5iJG5lZ2F0aXZlKSByZXR1cm4gYS5uYiRuZWdhdGl2ZSgpCiAgICAgICAgYSA9IFNrLmFic3RyLnR5cGVOYW1lKGEpCiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgImJhZCBvcGVyYW5kIHR5cGUgZm9yIHVuYXJ5IC06ICciICsgYSArICInIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYWJzdHIub2JqZWN0UG9zaXRpdmUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0gU2suYWJzdHIudHlwZU5hbWUoYSksCiAgICAgICAgICBjID0gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5ib29sICYmIChhID0gbmV3IFNrLmJ1aWx0aW4uaW50XyhjKSkKICAgICAgICBpZiAoYS5uYiRuZWdhdGl2ZSkgcmV0dXJuIGEubmIkcG9zaXRpdmUoKQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICJiYWQgb3BlcmFuZCB0eXBlIGZvciB1bmFyeSArOiAnIiArIGIgKyAiJyIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmFic3RyLm9iamVjdERlbEl0ZW0gPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGlmIChudWxsICE9PSBhKSB7CiAgICAgICAgICBpZiAoYS5tcCRkZWxfc3Vic2NyaXB0KSB7CiAgICAgICAgICAgIGEubXAkZGVsX3N1YnNjcmlwdChiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgIH0KICAgICAgICAgIGlmIChhLnNxJGFzc19pdGVtKSB7CiAgICAgICAgICAgIHZhciBjID0gU2subWlzY2V2YWwuYXNJbmRleChiKQogICAgICAgICAgICBpZiAodm9pZCAwID09PSBjKQogICAgICAgICAgICAgIHRocm93ICgKICAgICAgICAgICAgICAgICgoYSA9IFNrLmFic3RyLnR5cGVOYW1lKGIpKSwKICAgICAgICAgICAgICAgIG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAgICAgInNlcXVlbmNlIGluZGV4IG11c3QgYmUgaW50ZWdlciwgbm90ICciICsgYSArICInIiwKICAgICAgICAgICAgICAgICkpCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBTay5hYnN0ci5zZXF1ZW5jZURlbEl0ZW0oYSwgYykKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGEgPSBTay5hYnN0ci50eXBlTmFtZShhKQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICInIiArIGEgKyAiJyBvYmplY3QgZG9lcyBub3Qgc3VwcG9ydCBpdGVtIGRlbGV0aW9uIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5hYnN0ci5vYmplY3REZWxJdGVtIiwgU2suYWJzdHIub2JqZWN0RGVsSXRlbSkKICAgICAgU2suYWJzdHIub2JqZWN0R2V0SXRlbSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgaWYgKG51bGwgIT09IGEpIHsKICAgICAgICAgIGlmIChhLnRwJGdldGl0ZW0pIHJldHVybiBhLnRwJGdldGl0ZW0oYiwgYykKICAgICAgICAgIGlmIChhLm1wJHN1YnNjcmlwdCkgcmV0dXJuIGEubXAkc3Vic2NyaXB0KGIsIGMpCiAgICAgICAgICBpZiAoU2subWlzY2V2YWwuaXNJbmRleChiKSAmJiBhLnNxJGl0ZW0pCiAgICAgICAgICAgIHJldHVybiBTay5hYnN0ci5zZXF1ZW5jZUdldEl0ZW0oYSwgU2subWlzY2V2YWwuYXNJbmRleChiKSwgYykKICAgICAgICB9CiAgICAgICAgYSA9IFNrLmFic3RyLnR5cGVOYW1lKGEpCiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCInIiArIGEgKyAiJyBkb2VzIG5vdCBzdXBwb3J0IGluZGV4aW5nIikKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmFic3RyLm9iamVjdEdldEl0ZW0iLCBTay5hYnN0ci5vYmplY3RHZXRJdGVtKQogICAgICBTay5hYnN0ci5vYmplY3RTZXRJdGVtID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsKICAgICAgICBpZiAobnVsbCAhPT0gYSkgewogICAgICAgICAgaWYgKGEudHAkc2V0aXRlbSkgcmV0dXJuIGEudHAkc2V0aXRlbShiLCBjLCBkKQogICAgICAgICAgaWYgKGEubXAkYXNzX3N1YnNjcmlwdCkgcmV0dXJuIGEubXAkYXNzX3N1YnNjcmlwdChiLCBjLCBkKQogICAgICAgICAgaWYgKFNrLm1pc2NldmFsLmlzSW5kZXgoYikgJiYgYS5zcSRhc3NfaXRlbSkKICAgICAgICAgICAgcmV0dXJuIFNrLmFic3RyLnNlcXVlbmNlU2V0SXRlbShhLCBTay5taXNjZXZhbC5hc0luZGV4KGIpLCBjLCBkKQogICAgICAgIH0KICAgICAgICBhID0gU2suYWJzdHIudHlwZU5hbWUoYSkKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAiJyIgKyBhICsgIicgZG9lcyBub3Qgc3VwcG9ydCBpdGVtIGFzc2lnbm1lbnQiLAogICAgICAgICkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmFic3RyLm9iamVjdFNldEl0ZW0iLCBTay5hYnN0ci5vYmplY3RTZXRJdGVtKQogICAgICBTay5hYnN0ci5nYXR0ciA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQsCiAgICAgICAgICBlID0gU2suYWJzdHIudHlwZU5hbWUoYSksCiAgICAgICAgICBmID0gYi4kanNzdHIoKQogICAgICAgIGlmIChudWxsID09PSBhKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uQXR0cmlidXRlRXJyb3IoCiAgICAgICAgICAgICInIiArIGUgKyAiJyBvYmplY3QgaGFzIG5vIGF0dHJpYnV0ZSAnIiArIGYgKyAiJyIsCiAgICAgICAgICApCiAgICAgICAgdm9pZCAwICE9PSBhLnRwJGdldGF0dHIgJiYgKGQgPSBhLnRwJGdldGF0dHIoYiwgYykpCiAgICAgICAgZCA9IFNrLm1pc2NldmFsLmNoYWluKGQsIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICBpZiAodm9pZCAwID09PSBhKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5BdHRyaWJ1dGVFcnJvcigKICAgICAgICAgICAgICAiJyIgKyBlICsgIicgb2JqZWN0IGhhcyBubyBhdHRyaWJ1dGUgJyIgKyBmICsgIiciLAogICAgICAgICAgICApCiAgICAgICAgICByZXR1cm4gYQogICAgICAgIH0pCiAgICAgICAgcmV0dXJuIGMgPyBkIDogU2subWlzY2V2YWwucmV0cnlPcHRpb25hbFN1c3BlbnNpb25PclRocm93KGQpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5hYnN0ci5nYXR0ciIsIFNrLmFic3RyLmdhdHRyKQogICAgICBTay5hYnN0ci5zYXR0ciA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7CiAgICAgICAgdmFyIGUgPSBTay5hYnN0ci50eXBlTmFtZShhKSwKICAgICAgICAgIGYgPSBiLiRqc3N0cigpCiAgICAgICAgaWYgKG51bGwgPT09IGEpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5BdHRyaWJ1dGVFcnJvcigKICAgICAgICAgICAgIiciICsgZSArICInIG9iamVjdCBoYXMgbm8gYXR0cmlidXRlICciICsgZiArICInIiwKICAgICAgICAgICkKICAgICAgICBpZiAodm9pZCAwICE9PSBhLnRwJHNldGF0dHIpIHJldHVybiBhLnRwJHNldGF0dHIoYiwgYywgZCkKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5BdHRyaWJ1dGVFcnJvcigKICAgICAgICAgICInIiArIGUgKyAiJyBvYmplY3QgaGFzIG5vIGF0dHJpYnV0ZSAnIiArIGYgKyAiJyIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYWJzdHIuc2F0dHIiLCBTay5hYnN0ci5zYXR0cikKICAgICAgU2suYWJzdHIuaXRlcm5leHQgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBhLnRwJGl0ZXJuZXh0KGIpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5hYnN0ci5pdGVybmV4dCIsIFNrLmFic3RyLml0ZXJuZXh0KQogICAgICBTay5hYnN0ci5pdGVyID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiwKICAgICAgICAgIGMgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICB0aGlzLmlkeCA9IDAKICAgICAgICAgICAgdGhpcy5teW9iaiA9IGEKICAgICAgICAgICAgdGhpcy5nZXRpdGVtID0gU2suYWJzdHIubG9va3VwU3BlY2lhbChhLCBTay5idWlsdGluLnN0ci4kZ2V0aXRlbSkKICAgICAgICAgICAgdGhpcy50cCRpdGVybmV4dCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIGEgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkodGhpcy5nZXRpdGVtLCBbCiAgICAgICAgICAgICAgICAgIHRoaXMubXlvYmosCiAgICAgICAgICAgICAgICAgIFNrLmZmaS5yZW1hcFRvUHkodGhpcy5pZHgpLAogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICB9IGNhdGNoIChnKSB7CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgIGcgaW5zdGFuY2VvZiBTay5idWlsdGluLkluZGV4RXJyb3IgfHwKICAgICAgICAgICAgICAgICAgZyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uU3RvcEl0ZXJhdGlvbgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIHRocm93IGcKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy5pZHgrKwogICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICBpZiAoCiAgICAgICAgICBhLnRwJGdldGF0dHIgJiYKICAgICAgICAgIChiID0gU2suYWJzdHIubG9va3VwU3BlY2lhbChhLCBTay5idWlsdGluLnN0ci4kaXRlcikpCiAgICAgICAgKSB7CiAgICAgICAgICB2YXIgZCA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShiLCBbYV0pCiAgICAgICAgICBpZiAoZC50cCRpdGVybmV4dCkgcmV0dXJuIGQKICAgICAgICB9CiAgICAgICAgaWYgKGEudHAkaXRlcikKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgoKGQgPSBhLnRwJGl0ZXIoKSksIGQudHAkaXRlcm5leHQpKSByZXR1cm4gZAogICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICBpZiAoU2suYWJzdHIubG9va3VwU3BlY2lhbChhLCBTay5idWlsdGluLnN0ci4kZ2V0aXRlbSkpIHJldHVybiBuZXcgYyhhKQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICInIiArIFNrLmFic3RyLnR5cGVOYW1lKGEpICsgIicgb2JqZWN0IGlzIG5vdCBpdGVyYWJsZSIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYWJzdHIuaXRlciIsIFNrLmFic3RyLml0ZXIpCiAgICAgIFNrLmFic3RyLmxvb2t1cFNwZWNpYWwgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGlmIChhLm9iJHR5cGUpIGEgPSBhLm9iJHR5cGUKICAgICAgICBlbHNlIHJldHVybiBudWxsCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4udHlwZS50eXBlTG9va3VwKGEsIGIpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5hYnN0ci5sb29rdXBTcGVjaWFsIiwgU2suYWJzdHIubG9va3VwU3BlY2lhbCkKICAgICAgU2suYWJzdHIubWFya1VuaGFzaGFibGUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGEgPSBhLnByb3RvdHlwZQogICAgICAgIGEuX19oYXNoX18gPSBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgICBhLnRwJGhhc2ggPSBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgfQogICAgICBTay5hYnN0ci5pbmhlcml0cyA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgZnVuY3Rpb24gYygpIHt9CiAgICAgICAgYy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZQogICAgICAgIGEuc3VwZXJDbGFzc18gPSBiLnByb3RvdHlwZQogICAgICAgIGEucHJvdG90eXBlID0gbmV3IGMoKQogICAgICAgIGEucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gYQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UgPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIFNrLmFic3RyLmluaGVyaXRzKGIsIGMpCiAgICAgICAgYi5wcm90b3R5cGUudHAkYmFzZSA9IGMKICAgICAgICBiLnByb3RvdHlwZS50cCRuYW1lID0gYQogICAgICAgIGIucHJvdG90eXBlLm9iJHR5cGUgPSBTay5idWlsdGluLnR5cGUubWFrZUludG9UeXBlT2JqKGEsIGIpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc3VwZXJDb25zdHJ1Y3RvciA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpCiAgICAgICAgYS5wcm90b3R5cGUudHAkYmFzZS5hcHBseShiLCBkKQogICAgICB9CiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHApIHsKICAgICAgU2suYnVpbHRpbi5vYmplY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLm9iamVjdAogICAgICAgICAgPyB0aGlzCiAgICAgICAgICA6IG5ldyBTay5idWlsdGluLm9iamVjdCgpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLl9faW5pdF9fID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuX19pbml0X18uY29fa3dhcmdzID0gMQogICAgICBTay5idWlsdGluLl90cnlHZXRTdWJzY3JpcHQgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gYS5tcCRzdWJzY3JpcHQoYikKICAgICAgICB9IGNhdGNoIChjKSB7fQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgKICAgICAgICAiU2suYnVpbHRpbi5fdHJ5R2V0U3Vic2NyaXB0IiwKICAgICAgICBTay5idWlsdGluLl90cnlHZXRTdWJzY3JpcHQsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLkdlbmVyaWNHZXRBdHRyID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB2YXIgYywKICAgICAgICAgIGQsCiAgICAgICAgICBlID0gYS4kanNzdHIoKQogICAgICAgIHZhciBmID0gdGhpcy5vYiR0eXBlCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQodm9pZCAwICE9PSBmLCAib2JqZWN0IGhhcyBubyBvYiR0eXBlISIpCiAgICAgICAgaWYgKChkID0gdGhpcy4kZCB8fCB0aGlzLmNvbnN0cnVjdG9yLiRkKSkKICAgICAgICAgIGlmICgKICAgICAgICAgICAgKGQubXAkbG9va3VwCiAgICAgICAgICAgICAgPyAoYyA9IGQubXAkbG9va3VwKGEpKQogICAgICAgICAgICAgIDogZC5tcCRzdWJzY3JpcHQKICAgICAgICAgICAgICA/IChjID0gU2suYnVpbHRpbi5fdHJ5R2V0U3Vic2NyaXB0KGQsIGEpKQogICAgICAgICAgICAgIDogIm9iamVjdCIgPT09IHR5cGVvZiBkICYmIChjID0gZFtlXSksCiAgICAgICAgICAgIHZvaWQgMCAhPT0gYykKICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIGMKICAgICAgICBkID0gU2suYnVpbHRpbi50eXBlLnR5cGVMb29rdXAoZiwgYSkKICAgICAgICBpZiAodm9pZCAwICE9PSBkICYmIG51bGwgIT09IGQgJiYgKGMgPSBkLnRwJGRlc2NyX2dldCkpCiAgICAgICAgICByZXR1cm4gYy5jYWxsKGQsIHRoaXMsIHRoaXMub2IkdHlwZSwgYikKICAgICAgICBpZiAodm9pZCAwICE9PSBkKSByZXR1cm4gZAogICAgICAgIGQgPSBTay5idWlsdGluLnR5cGUudHlwZUxvb2t1cChmLCBTay5idWlsdGluLnN0ci4kZ2V0YXR0cikKICAgICAgICBpZiAodm9pZCAwICE9PSBkICYmIG51bGwgIT09IGQpIHsKICAgICAgICAgIHZhciBnID0gKGMgPSBkLnRwJGRlc2NyX2dldCkgPyBjLmNhbGwoZCwgdGhpcywgdGhpcy5vYiR0eXBlKSA6IGQKICAgICAgICAgIGMgPSBTay5taXNjZXZhbC50cnlDYXRjaCgKICAgICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kQXJyYXkoZywgW2FdKQogICAgICAgICAgICB9LAogICAgICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgIGlmICghKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yKSkgdGhyb3cgYQogICAgICAgICAgICB9LAogICAgICAgICAgKQogICAgICAgICAgcmV0dXJuIGIgPyBjIDogU2subWlzY2V2YWwucmV0cnlPcHRpb25hbFN1c3BlbnNpb25PclRocm93KGMpCiAgICAgICAgfQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgKICAgICAgICAiU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLkdlbmVyaWNHZXRBdHRyIiwKICAgICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuR2VuZXJpY0dldEF0dHIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLkdlbmVyaWNQeXRob25HZXRBdHRyID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBhID0gU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLkdlbmVyaWNHZXRBdHRyLmNhbGwoYSwgYiwgITApCiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYSkgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uQXR0cmlidXRlRXJyb3IoYikKICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgKICAgICAgICAiU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLkdlbmVyaWNQeXRob25HZXRBdHRyIiwKICAgICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuR2VuZXJpY1B5dGhvbkdldEF0dHIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLkdlbmVyaWNTZXRBdHRyID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICB2YXIgZCA9IFNrLmFic3RyLnR5cGVOYW1lKHRoaXMpLAogICAgICAgICAgZSA9IGEuJGpzc3RyKCksCiAgICAgICAgICBmID0gdGhpcy5vYiR0eXBlLAogICAgICAgICAgZwogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KHZvaWQgMCAhPT0gZiwgIm9iamVjdCBoYXMgbm8gb2IkdHlwZSEiKQogICAgICAgIHZhciBoID0gdGhpcy4kZCB8fCB0aGlzLmNvbnN0cnVjdG9yLiRkCiAgICAgICAgaWYgKCJfX2NsYXNzX18iID09IGUpIHsKICAgICAgICAgIGlmICh2b2lkIDAgPT09IGIudHAkbXJvIHx8IHZvaWQgMCA9PT0gYi50cCRuYW1lKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgImF0dGVtcHRlZCB0byBhc3NpZ24gbm9uLWNsYXNzIHRvIF9fY2xhc3NfXyIsCiAgICAgICAgICAgICkKICAgICAgICAgIHRoaXMub2IkdHlwZSA9IGIKICAgICAgICAgIHRoaXMudHAkbmFtZSA9IGIudHAkbmFtZQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmID0gU2suYnVpbHRpbi50eXBlLnR5cGVMb29rdXAoZiwgYSkKICAgICAgICAgIGlmICh2b2lkIDAgIT09IGYgJiYgbnVsbCAhPT0gZiAmJiAoZyA9IGYudHAkZGVzY3Jfc2V0KSkKICAgICAgICAgICAgcmV0dXJuIGcuY2FsbChmLCB0aGlzLCBiLCBjKQogICAgICAgICAgaWYgKGgubXAkYXNzX3N1YnNjcmlwdCkgewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgdGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ub2JqZWN0ICYmCiAgICAgICAgICAgICAgIXRoaXMub2IkdHlwZS5zayRrbGFzcyAmJgogICAgICAgICAgICAgIHZvaWQgMCA9PT0gaC5tcCRsb29rdXAoYSkKICAgICAgICAgICAgKQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yKAogICAgICAgICAgICAgICAgIiciICsKICAgICAgICAgICAgICAgICAgZCArCiAgICAgICAgICAgICAgICAgICInIG9iamVjdCBoYXMgbm8gYXR0cmlidXRlICciICsKICAgICAgICAgICAgICAgICAgU2sudW5maXhSZXNlcnZlZChlKSArCiAgICAgICAgICAgICAgICAgICInIiwKICAgICAgICAgICAgICApCiAgICAgICAgICAgIGgubXAkYXNzX3N1YnNjcmlwdChhLCBiKQogICAgICAgICAgfSBlbHNlICJvYmplY3QiID09PSB0eXBlb2YgaCAmJiAoaFtlXSA9IGIpCiAgICAgICAgfQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgKICAgICAgICAiU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLkdlbmVyaWNTZXRBdHRyIiwKICAgICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuR2VuZXJpY1NldEF0dHIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLkdlbmVyaWNQeXRob25TZXRBdHRyID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLkdlbmVyaWNTZXRBdHRyLmNhbGwoYSwgYiwgYywgITApCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKAogICAgICAgICJTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuR2VuZXJpY1B5dGhvblNldEF0dHIiLAogICAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5HZW5lcmljUHl0aG9uU2V0QXR0ciwKICAgICAgKQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuSGFzaE5vdEltcGxlbWVudGVkID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICJ1bmhhc2hhYmxlIHR5cGU6ICciICsgU2suYWJzdHIudHlwZU5hbWUodGhpcykgKyAiJyIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS50cCRnZXRhdHRyID0KICAgICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuR2VuZXJpY0dldEF0dHIKICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLnRwJHNldGF0dHIgPQogICAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5HZW5lcmljU2V0QXR0cgogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuX19nZXRhdHRyaWJ1dGVfXyA9CiAgICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLkdlbmVyaWNQeXRob25HZXRBdHRyCiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5fX3NldGF0dHJfXyA9CiAgICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLkdlbmVyaWNQeXRob25TZXRBdHRyCiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS50cCRuYW1lID0gIm9iamVjdCIKICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLm9iJHR5cGUgPSBTay5idWlsdGluLnR5cGUubWFrZUludG9UeXBlT2JqKAogICAgICAgICJvYmplY3QiLAogICAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5vYiR0eXBlLnNrJGtsYXNzID0gdm9pZCAwCiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS50cCRkZXNjcl9zZXQgPSB2b2lkIDAKICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLl9fbmV3X18gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fbmV3X18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITEpCiAgICAgICAgcmV0dXJuIG5ldyBhKFtdLCBbXSkKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuX19yZXByX18gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fcmVwcl9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITEsICEwKQogICAgICAgIHJldHVybiBhLiRyKCkKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuX19mb3JtYXRfXyA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19mb3JtYXRfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDIpCiAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYikpIHsKICAgICAgICAgIHZhciBjID0gU2suZmZpLnJlbWFwVG9KcyhiKQogICAgICAgICAgaWYgKCIiICE9PSBjKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAgICJmb3JtYXQgc3BlYyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICAgKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoU2suX19mdXR1cmVfXy5leGNlcHRpb25zKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgImZvcm1hdCgpIGFyZ3VtZW50IDIgbXVzdCBiZSBzdHIsIG5vdCAiICsgU2suYWJzdHIudHlwZU5hbWUoYiksCiAgICAgICAgICAgICkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgImZvcm1hdCBleHBlY3RzIGFyZyAyIHRvIGJlIHN0cmluZyBvciB1bmljb2RlLCBub3QgIiArCiAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYiksCiAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoYSkKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuX19zdHJfXyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19zdHJfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICExLCAhMCkKICAgICAgICByZXR1cm4gYS4kcigpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLl9faGFzaF9fID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2hhc2hfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICExLCAhMCkKICAgICAgICByZXR1cm4gYS50cCRoYXNoKCkKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuX19lcV9fID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2VxX18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEub2IkZXEoYikKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuX19uZV9fID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX25lX18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEub2IkbmUoYikKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuX19sdF9fID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2x0X18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEub2IkbHQoYikKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuX19sZV9fID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2xlX18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEub2IkbGUoYikKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuX19ndF9fID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2d0X18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEub2IkZ3QoYikKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuX19nZV9fID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2dlX18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEub2IkZ2UoYikKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigiPG9iamVjdD4iKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaGFzaENvdW50ID0gMQogICAgICBTay5idWlsdGluLmlkQ291bnQgPSAxCiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS50cCRoYXNoID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuJHNhdmVkSGFzaF8gfHwKICAgICAgICAgICh0aGlzLiRzYXZlZEhhc2hfID0gbmV3IFNrLmJ1aWx0aW4uaW50XyhTay5idWlsdGluLmhhc2hDb3VudCsrKSkKICAgICAgICByZXR1cm4gdGhpcy4kc2F2ZWRIYXNoXwogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5vYiRlcSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMgPT09IGEKICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLnRydWUkCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLm9iJG5lID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gdGhpcyA9PT0gYQogICAgICAgICAgPyBTay5idWlsdGluLmJvb2wuZmFsc2UkCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLm9iJGx0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUub2IkbGUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5vYiRndCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLm9iJGdlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm9iamVjdC5weXRob25GdW5jdGlvbnMgPSAiX19yZXByX18gX19zdHJfXyBfX2hhc2hfXyBfX2VxX18gX19uZV9fIF9fbHRfXyBfX2xlX18gX19ndF9fIF9fZ2VfXyBfX2dldGF0dHJpYnV0ZV9fIF9fc2V0YXR0cl9fIF9fZm9ybWF0X18iLnNwbGl0KAogICAgICAgICIgIiwKICAgICAgKQogICAgICBTay5idWlsdGluLm5vbmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy52ID0gbnVsbAogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoIk5vbmVUeXBlIiwgU2suYnVpbHRpbi5ub25lLCBTay5idWlsdGluLm9iamVjdCkKICAgICAgU2suYnVpbHRpbi5ub25lLnByb3RvdHlwZS4kciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKCJOb25lIikKICAgICAgfQogICAgICBTay5idWlsdGluLm5vbmUucHJvdG90eXBlLnRwJGhhc2ggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oMCkKICAgICAgfQogICAgICBTay5idWlsdGluLm5vbmUubm9uZSQgPSBuZXcgU2suYnVpbHRpbi5ub25lKCkKICAgICAgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZCA9IGZ1bmN0aW9uICgpIHt9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIk5vdEltcGxlbWVudGVkVHlwZSIsCiAgICAgICAgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZCwKICAgICAgICBTay5idWlsdGluLm9iamVjdCwKICAgICAgKQogICAgICBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLnByb3RvdHlwZS4kciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKCJOb3RJbXBsZW1lbnRlZCIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQgPSBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZCgpCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5ub25lIiwgU2suYnVpbHRpbi5ub25lKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQiLCBTay5idWlsdGluLk5vdEltcGxlbWVudGVkKQogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3MgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSwgZikgewogICAgICAgIGIgPSBiLmxlbmd0aAogICAgICAgIHZvaWQgMCA9PT0gZCAmJiAoZCA9IEluZmluaXR5KQogICAgICAgIGUgJiYgLS1iCiAgICAgICAgZiAmJiAtLWIKICAgICAgICBpZiAoYiA8IGMgfHwgYiA+IGQpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgIChjID09PSBkCiAgICAgICAgICAgICAgPyBhICsgIigpIHRha2VzIGV4YWN0bHkgIiArIGMgKyAiIGFyZ3VtZW50cyIKICAgICAgICAgICAgICA6IGIgPCBjCiAgICAgICAgICAgICAgPyBhICsgIigpIHRha2VzIGF0IGxlYXN0ICIgKyBjICsgIiBhcmd1bWVudHMiCiAgICAgICAgICAgICAgOiBhICsgIigpIHRha2VzIGF0IG1vc3QgIiArIGQgKyAiIGFyZ3VtZW50cyIpICsKICAgICAgICAgICAgICAoIiAoIiArIGIgKyAiIGdpdmVuKSIpLAogICAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5weUNoZWNrQXJncyIsIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3MpCiAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4gPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSwgZikgewogICAgICAgIHZvaWQgMCA9PT0gZCAmJiAoZCA9IEluZmluaXR5KQogICAgICAgIGUgJiYgLS1iCiAgICAgICAgZiAmJiAtLWIKICAgICAgICBpZiAoYiA8IGMgfHwgYiA+IGQpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgIChjID09PSBkCiAgICAgICAgICAgICAgPyBhICsgIigpIHRha2VzIGV4YWN0bHkgIiArIGMgKyAiIGFyZ3VtZW50cyIKICAgICAgICAgICAgICA6IGIgPCBjCiAgICAgICAgICAgICAgPyBhICsgIigpIHRha2VzIGF0IGxlYXN0ICIgKyBjICsgIiBhcmd1bWVudHMiCiAgICAgICAgICAgICAgOiBhICsgIigpIHRha2VzIGF0IG1vc3QgIiArIGQgKyAiIGFyZ3VtZW50cyIpICsKICAgICAgICAgICAgICAoIiAoIiArIGIgKyAiIGdpdmVuKSIpLAogICAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja1R5cGUgPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIGlmICghYykgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKGEgKyAiIG11c3QgYmUgYSAiICsgYikKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4ucHlDaGVja1R5cGUiLCBTay5idWlsdGluLnB5Q2hlY2tUeXBlKQogICAgICBTay5idWlsdGluLmNoZWNrU2VxdWVuY2UgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBudWxsICE9PSBhICYmIHZvaWQgMCAhPT0gYS5tcCRzdWJzY3JpcHQKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uY2hlY2tTZXF1ZW5jZSIsIFNrLmJ1aWx0aW4uY2hlY2tTZXF1ZW5jZSkKICAgICAgU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiA9ICExCiAgICAgICAgaWYgKG51bGwgIT09IGEpCiAgICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gKGIgPSBTay5hYnN0ci5pdGVyKGEpKSA/ICEwIDogITEKICAgICAgICAgIH0gY2F0Y2ggKGMpIHsKICAgICAgICAgICAgaWYgKGMgaW5zdGFuY2VvZiBTay5idWlsdGluLlR5cGVFcnJvcikgcmV0dXJuICExCiAgICAgICAgICAgIHRocm93IGMKICAgICAgICAgIH0KICAgICAgICByZXR1cm4gYgogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlIiwgU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKQogICAgICBTay5idWlsdGluLmNoZWNrQ2FsbGFibGUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYSB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZnVuYyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubWV0aG9kIHx8CiAgICAgICAgICB2b2lkIDAgIT09IFNrLmFic3RyLmxvb2t1cFNwZWNpYWwoYSwgU2suYnVpbHRpbi5zdHIuJGNhbGwpCiAgICAgICAgICA/ICEwCiAgICAgICAgICA6ICExCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jaGVja051bWJlciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgIG51bGwgIT09IGEgJiYKICAgICAgICAgICgibnVtYmVyIiA9PT0gdHlwZW9mIGEgfHwKICAgICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fAogICAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8gfHwKICAgICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nKQogICAgICAgICkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uY2hlY2tOdW1iZXIiLCBTay5idWlsdGluLmNoZWNrTnVtYmVyKQogICAgICBTay5idWlsdGluLmNoZWNrQ29tcGxleCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uY29tcGxleC5fY29tcGxleF9jaGVjayhhKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5jaGVja0NvbXBsZXgiLCBTay5idWlsdGluLmNoZWNrQ29tcGxleCkKICAgICAgU2suYnVpbHRpbi5jaGVja0ludCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgIG51bGwgIT09IGEgJiYKICAgICAgICAgICgoIm51bWJlciIgPT09IHR5cGVvZiBhICYmIGEgPT09IChhIHwgMCkpIHx8CiAgICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nKQogICAgICAgICkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uY2hlY2tJbnQiLCBTay5idWlsdGluLmNoZWNrSW50KQogICAgICBTay5idWlsdGluLmNoZWNrRmxvYXQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBudWxsICE9PSBhICYmIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5jaGVja0Zsb2F0IiwgU2suYnVpbHRpbi5jaGVja0Zsb2F0KQogICAgICBTay5idWlsdGluLmNoZWNrU3RyaW5nID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gbnVsbCAhPT0gYSAmJiBhLl9fY2xhc3NfXyA9PSBTay5idWlsdGluLnN0cgogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5jaGVja1N0cmluZyIsIFNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcpCiAgICAgIFNrLmJ1aWx0aW4uY2hlY2tDbGFzcyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIG51bGwgIT09IGEgJiYgYS5zayR0eXBlCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLmNoZWNrQ2xhc3MiLCBTay5idWlsdGluLmNoZWNrQ2xhc3MpCiAgICAgIFNrLmJ1aWx0aW4uY2hlY2tCb29sID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYm9vbAogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5jaGVja0Jvb2wiLCBTay5idWlsdGluLmNoZWNrQm9vbCkKICAgICAgU2suYnVpbHRpbi5jaGVja05vbmUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5ub25lCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLmNoZWNrTm9uZSIsIFNrLmJ1aWx0aW4uY2hlY2tOb25lKQogICAgICBTay5idWlsdGluLmNoZWNrRnVuY3Rpb24gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBudWxsICE9PSBhICYmIHZvaWQgMCAhPT0gYS50cCRjYWxsCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLmNoZWNrRnVuY3Rpb24iLCBTay5idWlsdGluLmNoZWNrRnVuY3Rpb24pCiAgICAgIFNrLmJ1aWx0aW4uZnVuYyA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7CiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZnVuYykpCiAgICAgICAgICB0aHJvdyBFcnJvcigiYnVpbHRpbiBmdW5jIHNob3VsZCBiZSBjYWxsZWQgYXMgYSBjbGFzcyB3aXRoIGBuZXdgIikKICAgICAgICB2YXIgZQogICAgICAgIHRoaXMuZnVuY19jb2RlID0gYQogICAgICAgIHRoaXMuZnVuY19nbG9iYWxzID0gYiB8fCBudWxsCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gZCkgZm9yIChlIGluIGQpIGNbZV0gPSBkW2VdCiAgICAgICAgdGhpcy4kZCA9IHsgX19uYW1lX186IGEuY29fbmFtZSwgX19jbGFzc19fOiBTay5idWlsdGluLmZ1bmMgfQogICAgICAgIHRoaXMuZnVuY19jbG9zdXJlID0gYwogICAgICAgIHRoaXMudHAkbmFtZSA9CiAgICAgICAgICAodGhpcy5mdW5jX2NvZGUgJiYKICAgICAgICAgICAgdGhpcy5mdW5jX2NvZGUuY29fbmFtZSAmJgogICAgICAgICAgICB0aGlzLmZ1bmNfY29kZS5jb19uYW1lLnYpIHx8CiAgICAgICAgICB0aGlzLmZ1bmNfY29kZS5uYW1lIHx8CiAgICAgICAgICAiPG5hdGl2ZSBKUz4iCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKCJmdW5jdGlvbiIsIFNrLmJ1aWx0aW4uZnVuYywgU2suYnVpbHRpbi5vYmplY3QpCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5mdW5jIiwgU2suYnVpbHRpbi5mdW5jKQogICAgICBTay5idWlsdGluLmZ1bmMucHJvdG90eXBlLnRwJG5hbWUgPSAiZnVuY3Rpb24iCiAgICAgIFNrLmJ1aWx0aW4uZnVuYy5wcm90b3R5cGUudHAkZGVzY3JfZ2V0ID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCghKHZvaWQgMCA9PT0gYSAmJiB2b2lkIDAgPT09IGIpKQogICAgICAgIHJldHVybiBiICYmIGIudHAkbmFtZSBpbiBTay5idWlsdGluICYmIFNrLmJ1aWx0aW5bYi50cCRuYW1lXSA9PT0gYgogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5tZXRob2QodGhpcywgYSwgYiwgITApCiAgICAgICAgICA6IG5ldyBTay5idWlsdGluLm1ldGhvZCh0aGlzLCBhLCBiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZnVuYy5weXRob25GdW5jdGlvbnMgPSBbIl9fZ2V0X18iXQogICAgICBTay5idWlsdGluLmZ1bmMucHJvdG90eXBlLl9fZ2V0X18gPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fZ2V0X18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyLCAhMSwgITApCiAgICAgICAgaWYgKGIgPT09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCAmJiBjID09PSBTay5idWlsdGluLm5vbmUubm9uZSQpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoIl9fZ2V0X18oTm9uZSwgTm9uZSkgaXMgaW52YWxpZCIpCiAgICAgICAgcmV0dXJuIGEudHAkZGVzY3JfZ2V0KGIsIGMpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mdW5jLnByb3RvdHlwZS50cCRnZXRuYW1lID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAoCiAgICAgICAgICAodGhpcy5mdW5jX2NvZGUgJiYKICAgICAgICAgICAgdGhpcy5mdW5jX2NvZGUuY29fbmFtZSAmJgogICAgICAgICAgICB0aGlzLmZ1bmNfY29kZS5jb19uYW1lLnYpIHx8CiAgICAgICAgICB0aGlzLmZ1bmNfY29kZS5uYW1lIHx8CiAgICAgICAgICAiPG5hdGl2ZSBKUz4iCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZnVuYy5wcm90b3R5cGUudHAkY2FsbCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIGMgPSB0aGlzLmZ1bmNfY29kZS5jb19hcmdjb3VudAogICAgICAgIHZvaWQgMCA9PT0gYyAmJgogICAgICAgICAgKGMgPSB0aGlzLmZ1bmNfY29kZS5jb192YXJuYW1lcwogICAgICAgICAgICA/IHRoaXMuZnVuY19jb2RlLmNvX3Zhcm5hbWVzLmxlbmd0aAogICAgICAgICAgICA6IGEubGVuZ3RoKQogICAgICAgIGxldCBkID0gdGhpcy5mdW5jX2NvZGUuY29fdmFybmFtZXMgfHwgW10KICAgICAgICB2YXIgZSA9IHRoaXMuZnVuY19jb2RlLmNvX2t3b25seWFyZ2NvdW50IHx8IDAKICAgICAgICBsZXQgZiA9IGMgKyBlLAogICAgICAgICAgZwogICAgICAgIHRoaXMuZnVuY19jb2RlLmNvX2t3YXJncyAmJiAoZyA9IFtdKQogICAgICAgIHZhciBoID0gYS5sZW5ndGgKICAgICAgICBsZXQgayA9IGEubGVuZ3RoIDw9IGMgPyBhIDogYS5zbGljZSgwLCBjKQogICAgICAgIGlmICh0aGlzLmZ1bmNfY29kZS5jb192YXJhcmdzKQogICAgICAgICAgKGEgPSBhLmxlbmd0aCA+IGsubGVuZ3RoID8gYS5zbGljZShrLmxlbmd0aCkgOiBbXSksCiAgICAgICAgICAgIChrW2ZdID0gbmV3IFNrLmJ1aWx0aW4udHVwbGUoYSkpCiAgICAgICAgZWxzZSBpZiAoaCA+IGMpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgIHRoaXMudHAkZ2V0bmFtZSgpICsKICAgICAgICAgICAgICAiKCkgdGFrZXMgIiArCiAgICAgICAgICAgICAgYyArCiAgICAgICAgICAgICAgIiBwb3NpdGlvbmFsIGFyZ3VtZW50IiArCiAgICAgICAgICAgICAgKDEgPT0gYyA/ICIiIDogInMiKSArCiAgICAgICAgICAgICAgIiBidXQgIiArCiAgICAgICAgICAgICAgaCArCiAgICAgICAgICAgICAgKDEgPT0gaCA/ICIgd2FzICIgOiAiIHdlcmUgIikgKwogICAgICAgICAgICAgICIgZ2l2ZW4iLAogICAgICAgICAgKQogICAgICAgIGlmIChiKSB7CiAgICAgICAgICBpZiAodGhpcy5mdW5jX2NvZGUubm9fa3cpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICB0aGlzLnRwJGdldG5hbWUoKSArICIoKSB0YWtlcyBubyBrZXl3b3JkIGFyZ3VtZW50cyIsCiAgICAgICAgICAgICkKICAgICAgICAgIGZvciAoYSA9IDA7IGEgPCBiLmxlbmd0aDsgYSArPSAyKSB7CiAgICAgICAgICAgIGggPSBiW2FdCiAgICAgICAgICAgIHZhciBsID0gYlthICsgMV0sCiAgICAgICAgICAgICAgciA9IGQuaW5kZXhPZihoKQogICAgICAgICAgICBpZiAoMCA8PSByKSB7CiAgICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0ga1tyXSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAgICAgdGhpcy50cCRnZXRuYW1lKCkgKwogICAgICAgICAgICAgICAgICAgICIoKSBnb3QgbXVsdGlwbGUgdmFsdWVzIGZvciBhcmd1bWVudCAnIiArCiAgICAgICAgICAgICAgICAgICAgaCArCiAgICAgICAgICAgICAgICAgICAgIiciLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIGtbcl0gPSBsCiAgICAgICAgICAgIH0gZWxzZSBpZiAoZykgZy5wdXNoKG5ldyBTay5idWlsdGluLnN0cihoKSwgbCkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAgIHRoaXMudHAkZ2V0bmFtZSgpICsKICAgICAgICAgICAgICAgICAgIigpIGdvdCBhbiB1bmV4cGVjdGVkIGtleXdvcmQgYXJndW1lbnQgJyIgKwogICAgICAgICAgICAgICAgICBoICsKICAgICAgICAgICAgICAgICAgIiciLAogICAgICAgICAgICAgICkKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYiA9IHRoaXMuZnVuY19jb2RlLiRkZWZhdWx0cyB8fCBbXQogICAgICAgIGEgPSAwCiAgICAgICAgaCA9IFtdCiAgICAgICAgbCA9ICExCiAgICAgICAgZm9yIChyID0gYyAtIGIubGVuZ3RoOyBhIDwgcjsgYSsrKQogICAgICAgICAgdm9pZCAwID09PSBrW2FdICYmIChoLnB1c2goZFthXSksIHZvaWQgMCA9PT0gZFthXSAmJiAobCA9ICEwKSkKICAgICAgICBpZiAoCiAgICAgICAgICAwICE9IGgubGVuZ3RoICYmCiAgICAgICAgICAodGhpcy5mdW5jX2NvZGUuY29fYXJnY291bnQgfHwgdGhpcy5mdW5jX2NvZGUuY29fdmFybmFtZXMpCiAgICAgICAgKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICB0aGlzLnRwJGdldG5hbWUoKSArCiAgICAgICAgICAgICAgIigpIG1pc3NpbmcgIiArCiAgICAgICAgICAgICAgaC5sZW5ndGggKwogICAgICAgICAgICAgICIgcmVxdWlyZWQgYXJndW1lbnQiICsKICAgICAgICAgICAgICAoMSA9PSBoLmxlbmd0aCA/ICIiIDogInMiKSArCiAgICAgICAgICAgICAgKGwgPyAiIiA6ICI6ICIgKyBoLmpvaW4oIiwgIikpLAogICAgICAgICAgKQogICAgICAgIGZvciAoOyBhIDwgYzsgYSsrKSB2b2lkIDAgPT09IGtbYV0gJiYgKGtbYV0gPSBiW2EgLSByXSkKICAgICAgICBpZiAoMCA8IGUpIHsKICAgICAgICAgIGUgPSBbXQogICAgICAgICAgYiA9IHRoaXMuZnVuY19jb2RlLiRrd2RlZnMKICAgICAgICAgIGZvciAoYSA9IGM7IGEgPCBmOyBhKyspCiAgICAgICAgICAgIHZvaWQgMCA9PT0ga1thXSAmJgogICAgICAgICAgICAgICh2b2lkIDAgIT09IGJbYSAtIGNdID8gKGtbYV0gPSBiW2EgLSBjXSkgOiBlLnB1c2goZFthXSkpCiAgICAgICAgICBpZiAoMCAhPT0gZS5sZW5ndGgpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICB0aGlzLnRwJGdldG5hbWUoKSArCiAgICAgICAgICAgICAgICAiKCkgbWlzc2luZyAiICsKICAgICAgICAgICAgICAgIGUubGVuZ3RoICsKICAgICAgICAgICAgICAgICIgcmVxdWlyZWQga2V5d29yZCBhcmd1bWVudCIgKwogICAgICAgICAgICAgICAgKDEgPT0gZS5sZW5ndGggPyAiIiA6ICJzIikgKwogICAgICAgICAgICAgICAgIjogIiArCiAgICAgICAgICAgICAgICBlLmpvaW4oIiwgIiksCiAgICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuZnVuY19jbG9zdXJlKSB7CiAgICAgICAgICBpZiAoZCkgZm9yIChjID0gay5sZW5ndGg7IGMgPCBkLmxlbmd0aDsgYysrKSBrLnB1c2godm9pZCAwKQogICAgICAgICAgay5wdXNoKHRoaXMuZnVuY19jbG9zdXJlKQogICAgICAgIH0KICAgICAgICBnICYmIGsudW5zaGlmdChnKQogICAgICAgIHJldHVybiB0aGlzLmZ1bmNfY29kZS5hcHBseSh0aGlzLmZ1bmNfZ2xvYmFscywgaykKICAgICAgfQogICAgICBTay5idWlsdGluLmZ1bmMucHJvdG90eXBlLiRyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBhID0gdGhpcy50cCRnZXRuYW1lKCkKICAgICAgICByZXR1cm4gYSBpbiBTay5idWlsdGlucyAmJiB0aGlzID09PSBTay5idWlsdGluc1thXQogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5zdHIoIjxidWlsdC1pbiBmdW5jdGlvbiAiICsgYSArICI+IikKICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uc3RyKCI8ZnVuY3Rpb24gIiArIGEgKyAiPiIpCiAgICAgIH0KICAgIH0sCiAgICBmdW5jdGlvbiAobSwgcCkgewogICAgICBTay5idWlsdGluLnJhbmdlID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICB2YXIgZCA9IFtdLAogICAgICAgICAgZQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInJhbmdlIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMykKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tUeXBlKCJzdGFydCIsICJpbnRlZ2VyIiwgU2suYnVpbHRpbi5jaGVja0ludChhKSkKICAgICAgICB2b2lkIDAgIT09IGIgJiYKICAgICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja1R5cGUoInN0b3AiLCAiaW50ZWdlciIsIFNrLmJ1aWx0aW4uY2hlY2tJbnQoYikpCiAgICAgICAgdm9pZCAwICE9PSBjICYmCiAgICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tUeXBlKCJzdGVwIiwgImludGVnZXIiLCBTay5idWlsdGluLmNoZWNrSW50KGMpKQogICAgICAgIGEgPSBTay5idWlsdGluLmFzbnVtJChhKQogICAgICAgIGIgPSBTay5idWlsdGluLmFzbnVtJChiKQogICAgICAgIGMgPSBTay5idWlsdGluLmFzbnVtJChjKQogICAgICAgIHZvaWQgMCA9PT0gYiAmJiB2b2lkIDAgPT09IGMKICAgICAgICAgID8gKChiID0gYSksIChhID0gMCksIChjID0gMSkpCiAgICAgICAgICA6IHZvaWQgMCA9PT0gYyAmJiAoYyA9IDEpCiAgICAgICAgaWYgKDAgPT09IGMpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKAogICAgICAgICAgICAicmFuZ2UoKSBzdGVwIGFyZ3VtZW50IG11c3Qgbm90IGJlIHplcm8iLAogICAgICAgICAgKQogICAgICAgIGlmICgwIDwgYykgZm9yIChlID0gYTsgZSA8IGI7IGUgKz0gYykgZC5wdXNoKG5ldyBTay5idWlsdGluLmludF8oZSkpCiAgICAgICAgZWxzZSBmb3IgKGUgPSBhOyBlID4gYjsgZSArPSBjKSBkLnB1c2gobmV3IFNrLmJ1aWx0aW4uaW50XyhlKSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubGlzdChkKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYXNudW0kID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gdm9pZCAwID09PSBhIHx8IG51bGwgPT09IGEKICAgICAgICAgID8gYQogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5ub25lCiAgICAgICAgICA/IG51bGwKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYm9vbAogICAgICAgICAgPyBhLnYKICAgICAgICAgICAgPyAxCiAgICAgICAgICAgIDogMAogICAgICAgICAgOiAibnVtYmVyIiA9PT0gdHlwZW9mIGEKICAgICAgICAgID8gYQogICAgICAgICAgOiAic3RyaW5nIiA9PT0gdHlwZW9mIGEKICAgICAgICAgID8gYQogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfCiAgICAgICAgICA/IGEudgogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gYS52CiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZwogICAgICAgICAgPyBhLmNhbnRCZUludCgpCiAgICAgICAgICAgID8gYS5zdHIkKDEwLCAhMCkKICAgICAgICAgICAgOiBhLnRvSW50JCgpCiAgICAgICAgICA6IGEuY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4uYmlnaW50ZWdlcgogICAgICAgICAgPyAwIDwKICAgICAgICAgICAgICBhLnRydWVDb21wYXJlKAogICAgICAgICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uYmlnaW50ZWdlcihTay5idWlsdGluLmludF8udGhyZXNob2xkJCksCiAgICAgICAgICAgICAgKSB8fAogICAgICAgICAgICAwID4KICAgICAgICAgICAgICBhLnRydWVDb21wYXJlKAogICAgICAgICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uYmlnaW50ZWdlcigtU2suYnVpbHRpbi5pbnRfLnRocmVzaG9sZCQpLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgPyBhLnRvU3RyaW5nKCkKICAgICAgICAgICAgOiBhLmludFZhbHVlKCkKICAgICAgICAgIDogYQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5hc251bSQiLCBTay5idWlsdGluLmFzbnVtJCkKICAgICAgU2suYnVpbHRpbi5hc3NrJCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIDAgPT09IGEgJSAxID8gbmV3IFNrLmJ1aWx0aW4uaW50XyhhKSA6IG5ldyBTay5idWlsdGluLmZsb2F0XyhhKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5hc3NrJCIsIFNrLmJ1aWx0aW4uYXNzayQpCiAgICAgIFNrLmJ1aWx0aW4uYXNudW0kbm9mbG9hdCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYSB8fCBudWxsID09PSBhKSByZXR1cm4gYQogICAgICAgIGlmIChhLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLm5vbmUpIHJldHVybiBudWxsCiAgICAgICAgaWYgKGEuY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4uYm9vbCkgcmV0dXJuIGEudiA/IDEgOiAwCiAgICAgICAgIm51bWJlciIgPT09IHR5cGVvZiBhICYmIChhID0gYS50b1N0cmluZygpKQogICAgICAgIGEuY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4uaW50XyAmJiAoYSA9IGEudi50b1N0cmluZygpKQogICAgICAgIGEuY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4uZmxvYXRfICYmIChhID0gYS52LnRvU3RyaW5nKCkpCiAgICAgICAgYS5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5sbmcgJiYgKGEgPSBhLnN0ciQoMTAsICEwKSkKICAgICAgICBhLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLmJpZ2ludGVnZXIgJiYgKGEgPSBhLnRvU3RyaW5nKCkpCiAgICAgICAgaWYgKDAgPiBhLmluZGV4T2YoIi4iKSAmJiAwID4gYS5pbmRleE9mKCJlIikgJiYgMCA+IGEuaW5kZXhPZigiRSIpKQogICAgICAgICAgcmV0dXJuIGEKICAgICAgICB2YXIgYiA9IDAKICAgICAgICBpZiAoMCA8PSBhLmluZGV4T2YoImUiKSkgewogICAgICAgICAgdmFyIGMgPSBhLnN1YnN0cigwLCBhLmluZGV4T2YoImUiKSkKICAgICAgICAgIGIgPSBhLnN1YnN0cihhLmluZGV4T2YoImUiKSArIDEpCiAgICAgICAgfSBlbHNlCiAgICAgICAgICAwIDw9IGEuaW5kZXhPZigiRSIpCiAgICAgICAgICAgID8gKChjID0gYS5zdWJzdHIoMCwgYS5pbmRleE9mKCJlIikpKSwKICAgICAgICAgICAgICAoYiA9IGEuc3Vic3RyKGEuaW5kZXhPZigiRSIpICsgMSkpKQogICAgICAgICAgICA6IChjID0gYSkKICAgICAgICBiID0gcGFyc2VJbnQoYiwgMTApCiAgICAgICAgYSA9IGMuaW5kZXhPZigiLiIpCiAgICAgICAgaWYgKDAgPiBhKSB7CiAgICAgICAgICBpZiAoMCA8PSBiKSB7CiAgICAgICAgICAgIGZvciAoOyAwIDwgYi0tOyApIGMgKz0gIjAiCiAgICAgICAgICAgIHJldHVybiBjCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYy5sZW5ndGggPiAtYiA/IGMuc3Vic3RyKDAsIGMubGVuZ3RoICsgYikgOiAwCiAgICAgICAgfQogICAgICAgIGMgPQogICAgICAgICAgMCA9PT0gYQogICAgICAgICAgICA/IGMuc3Vic3RyKDEpCiAgICAgICAgICAgIDogYSA8IGMubGVuZ3RoCiAgICAgICAgICAgID8gYy5zdWJzdHIoMCwgYSkgKyBjLnN1YnN0cihhICsgMSkKICAgICAgICAgICAgOiBjLnN1YnN0cigwLCBhKQogICAgICAgIGZvciAoYSArPSBiOyBhID4gYy5sZW5ndGg7ICkgYyArPSAiMCIKICAgICAgICByZXR1cm4gKGMgPSAwID49IGEgPyAwIDogYy5zdWJzdHIoMCwgYSkpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLmFzbnVtJG5vZmxvYXQiLCBTay5idWlsdGluLmFzbnVtJG5vZmxvYXQpCiAgICAgIFNrLmJ1aWx0aW4ucm91bmQgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInJvdW5kIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMikKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tOdW1iZXIoYSkpIHsKICAgICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0Z1bmN0aW9uKGEpKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImEgZmxvYXQgaXMgcmVxdWlyZWQiKQogICAgICAgICAgaWYgKCFTay5fX2Z1dHVyZV9fLmV4Y2VwdGlvbnMpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yKAogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGEpICsgIiBpbnN0YW5jZSBoYXMgbm8gYXR0cmlidXRlICdfX2Zsb2F0X18nIiwKICAgICAgICAgICAgKQogICAgICAgIH0KICAgICAgICBpZiAodm9pZCAwICE9PSBiICYmICFTay5taXNjZXZhbC5pc0luZGV4KGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiJyIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGIpICsKICAgICAgICAgICAgICAiJyBvYmplY3QgY2Fubm90IGJlIGludGVycHJldGVkIGFzIGFuIGluZGV4IiwKICAgICAgICAgICkKICAgICAgICBpZiAoIVNrLl9fZnV0dXJlX18uZHVuZGVyX3JvdW5kICYmIGEucm91bmQkKSByZXR1cm4gYS5yb3VuZCQoYSwgYikKICAgICAgICB2YXIgYyA9IFNrLmFic3RyLmxvb2t1cFNwZWNpYWwoYSwgU2suYnVpbHRpbi5zdHIuJHJvdW5kKQogICAgICAgIGlmIChudWxsICE9IGMpCiAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5jaGVja0Z1bmN0aW9uKGEpCiAgICAgICAgICAgID8gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGMsIFthXSkKICAgICAgICAgICAgOiBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYywgW2EsIGJdKQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiYSBmbG9hdCBpcyByZXF1aXJlZCIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sZW4gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImxlbiIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgdmFyIGIgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oYSkKICAgICAgICB9CiAgICAgICAgdmFyIGMgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tJbnQoYSkpIHJldHVybiBiKGEpCiAgICAgICAgICBpZiAoU2suX19mdXR1cmVfXy5leGNlcHRpb25zKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgIiciICsKICAgICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGEpICsKICAgICAgICAgICAgICAgICInIG9iamVjdCBjYW5ub3QgYmUgaW50ZXJwcmV0ZWQgYXMgYW4gaW50ZWdlciIsCiAgICAgICAgICAgICkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiX19sZW5fXygpIHNob3VsZCByZXR1cm4gYW4gaW50IikKICAgICAgICB9CiAgICAgICAgaWYgKGEuc3EkbGVuZ3RoKSByZXR1cm4gU2subWlzY2V2YWwuY2hhaW4oYS5zcSRsZW5ndGgoITApLCBjKQogICAgICAgIGlmIChhLm1wJGxlbmd0aCkgcmV0dXJuIFNrLm1pc2NldmFsLmNoYWluKGEubXAkbGVuZ3RoKCksIGIpCiAgICAgICAgaWYgKGEudHAkbGVuZ3RoKQogICAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tGdW5jdGlvbihhKSkgewogICAgICAgICAgICBjID0gU2suYWJzdHIubG9va3VwU3BlY2lhbChhLCBTay5idWlsdGluLnN0ci4kbGVuKQogICAgICAgICAgICBpZiAobnVsbCAhPSBjKSByZXR1cm4gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGMsIFthXSkKICAgICAgICAgICAgaWYgKCFTay5fX2Z1dHVyZV9fLmV4Y2VwdGlvbnMpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uQXR0cmlidXRlRXJyb3IoCiAgICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShhKSArICIgaW5zdGFuY2UgaGFzIG5vIGF0dHJpYnV0ZSAnX19sZW5fXyciLAogICAgICAgICAgICAgICkKICAgICAgICAgIH0gZWxzZSByZXR1cm4gU2subWlzY2V2YWwuY2hhaW4oYS50cCRsZW5ndGgoITApLCBjKQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICJvYmplY3Qgb2YgdHlwZSAnIiArIFNrLmFic3RyLnR5cGVOYW1lKGEpICsgIicgaGFzIG5vIGxlbigpIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5taW4gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGEKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJtaW4iLCBhcmd1bWVudHMubGVuZ3RoLCAxKQogICAgICAgIHZhciBiID0gU2subWlzY2V2YWwuYXJyYXlGcm9tQXJndW1lbnRzKGFyZ3VtZW50cykKICAgICAgICB2YXIgYyA9IGJbMF0KICAgICAgICBpZiAodm9pZCAwID09PSBjKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigibWluKCkgYXJnIGlzIGFuIGVtcHR5IHNlcXVlbmNlIikKICAgICAgICBmb3IgKGEgPSAxOyBhIDwgYi5sZW5ndGg7ICsrYSkKICAgICAgICAgIFNrLm1pc2NldmFsLnJpY2hDb21wYXJlQm9vbChiW2FdLCBjLCAiTHQiKSAmJiAoYyA9IGJbYV0pCiAgICAgICAgcmV0dXJuIGMKICAgICAgfQogICAgICBTay5idWlsdGluLm1heCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgYQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIm1heCIsIGFyZ3VtZW50cy5sZW5ndGgsIDEpCiAgICAgICAgdmFyIGIgPSBTay5taXNjZXZhbC5hcnJheUZyb21Bcmd1bWVudHMoYXJndW1lbnRzKQogICAgICAgIHZhciBjID0gYlswXQogICAgICAgIGlmICh2b2lkIDAgPT09IGMpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJtYXgoKSBhcmcgaXMgYW4gZW1wdHkgc2VxdWVuY2UiKQogICAgICAgIGZvciAoYSA9IDE7IGEgPCBiLmxlbmd0aDsgKythKQogICAgICAgICAgU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGJbYV0sIGMsICJHdCIpICYmIChjID0gYlthXSkKICAgICAgICByZXR1cm4gYwogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYW55ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImFueSIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrSXRlcmFibGUoYSkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICInIiArIFNrLmFic3RyLnR5cGVOYW1lKGEpICsgIicgb2JqZWN0IGlzIG5vdCBpdGVyYWJsZSIsCiAgICAgICAgICApCiAgICAgICAgdmFyIGMgPSBTay5hYnN0ci5pdGVyKGEpCiAgICAgICAgZm9yIChiID0gYy50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGI7IGIgPSBjLnRwJGl0ZXJuZXh0KCkpCiAgICAgICAgICBpZiAoU2subWlzY2V2YWwuaXNUcnVlKGIpKSByZXR1cm4gU2suYnVpbHRpbi5ib29sLnRydWUkCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQKICAgICAgfQogICAgICBTay5idWlsdGluLmFsbCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJhbGwiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGEpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiJyIgKyBTay5hYnN0ci50eXBlTmFtZShhKSArICInIG9iamVjdCBpcyBub3QgaXRlcmFibGUiLAogICAgICAgICAgKQogICAgICAgIHZhciBjID0gU2suYWJzdHIuaXRlcihhKQogICAgICAgIGZvciAoYiA9IGMudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBiOyBiID0gYy50cCRpdGVybmV4dCgpKQogICAgICAgICAgaWYgKCFTay5taXNjZXZhbC5pc1RydWUoYikpIHJldHVybiBTay5idWlsdGluLmJvb2wuZmFsc2UkCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc3VtID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB2YXIgYwogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInN1bSIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDIpCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrVHlwZSgiaXRlciIsICJpdGVyYWJsZSIsIFNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZShhKSkKICAgICAgICBpZiAodm9pZCAwICE9PSBiICYmIFNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJzdW0oKSBjYW4ndCBzdW0gc3RyaW5ncyBbdXNlICcnLmpvaW4oc2VxKSBpbnN0ZWFkXSIsCiAgICAgICAgICApCiAgICAgICAgdmFyIGQgPSB2b2lkIDAgPT09IGIgPyBuZXcgU2suYnVpbHRpbi5pbnRfKDApIDogYgogICAgICAgIHZhciBlID0gU2suYWJzdHIuaXRlcihhKQogICAgICAgIGZvciAoYyA9IGUudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBjOyBjID0gZS50cCRpdGVybmV4dCgpKSB7CiAgICAgICAgICBpZiAoYyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfKSB7CiAgICAgICAgICAgIHZhciBmID0gITAKICAgICAgICAgICAgZCBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfIHx8CiAgICAgICAgICAgICAgKGQgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8oU2suYnVpbHRpbi5hc251bSQoZCkpKQogICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIGMgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyAmJgogICAgICAgICAgICAgIChmIHx8IGQgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyB8fCAoZCA9IG5ldyBTay5idWlsdGluLmxuZyhkKSkpCiAgICAgICAgICBpZiAodm9pZCAwICE9PSBkLm5iJGFkZCkgewogICAgICAgICAgICB2YXIgZyA9IGQubmIkYWRkKGMpCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICB2b2lkIDAgIT09IGcgJiYKICAgICAgICAgICAgICBnICE9PSBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICAgICAgICApIHsKICAgICAgICAgICAgICBkID0gZC5uYiRhZGQoYykKICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJ1bnN1cHBvcnRlZCBvcGVyYW5kIHR5cGUocykgZm9yICs6ICciICsKICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShkKSArCiAgICAgICAgICAgICAgIicgYW5kICciICsKICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShjKSArCiAgICAgICAgICAgICAgIiciLAogICAgICAgICAgKQogICAgICAgIH0KICAgICAgICByZXR1cm4gZAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uemlwID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBhLCBiCiAgICAgICAgaWYgKDAgPT09IGFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBuZXcgU2suYnVpbHRpbi5saXN0KFtdKQogICAgICAgIHZhciBjID0gW10KICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYXJndW1lbnRzLmxlbmd0aDsgYisrKQogICAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZShhcmd1bWVudHNbYl0pKQogICAgICAgICAgICBjLnB1c2goU2suYWJzdHIuaXRlcihhcmd1bWVudHNbYl0pKQogICAgICAgICAgZWxzZQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgImFyZ3VtZW50ICIgKyBiICsgIiBtdXN0IHN1cHBvcnQgaXRlcmF0aW9uIiwKICAgICAgICAgICAgKQogICAgICAgIHZhciBkID0gW10KICAgICAgICBmb3IgKGEgPSAhMTsgIWE7ICkgewogICAgICAgICAgdmFyIGUgPSBbXQogICAgICAgICAgZm9yIChiID0gMDsgYiA8IGFyZ3VtZW50cy5sZW5ndGg7IGIrKykgewogICAgICAgICAgICB2YXIgZiA9IGNbYl0udHAkaXRlcm5leHQoKQogICAgICAgICAgICBpZiAodm9pZCAwID09PSBmKSB7CiAgICAgICAgICAgICAgYSA9ICEwCiAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgICAgICBlLnB1c2goZikKICAgICAgICAgIH0KICAgICAgICAgIGEgfHwgZC5wdXNoKG5ldyBTay5idWlsdGluLnR1cGxlKGUpKQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubGlzdChkKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYWJzID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJhYnMiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxKQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oTWF0aC5hYnMoYS52KSkKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmZsb2F0XyhNYXRoLmFicyhhLnYpKQogICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrTnVtYmVyKGEpKQogICAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uYXNzayQoTWF0aC5hYnMoU2suYnVpbHRpbi5hc251bSQoYSkpKQogICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrQ29tcGxleChhKSkKICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYS5fX2Fic19fLCBbYV0pCiAgICAgICAgaWYgKGEudHAkZ2V0YXR0cikgewogICAgICAgICAgdmFyIGIgPSBhLnRwJGdldGF0dHIoU2suYnVpbHRpbi5zdHIuJGFicykKICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYikKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigKICAgICAgICAgICJiYWQgb3BlcmFuZCB0eXBlIGZvciBhYnMoKTogJyIgKyBTay5hYnN0ci50eXBlTmFtZShhKSArICInIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mYWJzID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5hYnMoYSkKICAgICAgfQogICAgICBTay5idWlsdGluLm9yZCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigib3JkIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYSkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJvcmQoKSBleHBlY3RlZCBhIHN0cmluZyBvZiBsZW5ndGggMSwgYnV0ICIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGEpICsKICAgICAgICAgICAgICAiIGZvdW5kIiwKICAgICAgICAgICkKICAgICAgICBpZiAoMSAhPT0gYS52Lmxlbmd0aCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIm9yZCgpIGV4cGVjdGVkIGEgY2hhcmFjdGVyLCBidXQgc3RyaW5nIG9mIGxlbmd0aCAiICsKICAgICAgICAgICAgICBhLnYubGVuZ3RoICsKICAgICAgICAgICAgICAiIGZvdW5kIiwKICAgICAgICAgICkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhhLnYuY2hhckNvZGVBdCgwKSkKICAgICAgfQogICAgICBTay5idWlsdGluLmNociA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiY2hyIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tJbnQoYSkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImFuIGludGVnZXIgaXMgcmVxdWlyZWQiKQogICAgICAgIGEgPSBTay5idWlsdGluLmFzbnVtJChhKQogICAgICAgIGlmICgwID4gYSB8fCAyNTUgPCBhKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigiY2hyKCkgYXJnIG5vdCBpbiByYW5nZSgyNTYpIikKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKFN0cmluZy5mcm9tQ2hhckNvZGUoYSkpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi51bmljaHIgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImNociIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrSW50KGEpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJhbiBpbnRlZ2VyIGlzIHJlcXVpcmVkIikKICAgICAgICBhID0gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICB0cnkgewogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihTdHJpbmcuZnJvbUNvZGVQb2ludChhKSkKICAgICAgICB9IGNhdGNoIChiKSB7CiAgICAgICAgICBpZiAoYiBpbnN0YW5jZW9mIFJhbmdlRXJyb3IpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoYi5tZXNzYWdlKQogICAgICAgICAgdGhyb3cgYgogICAgICAgIH0KICAgICAgfQogICAgICBTay5idWlsdGluLmludDJzdHJfID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nKSB7CiAgICAgICAgICB2YXIgZCA9ICIiCiAgICAgICAgICAyID09PSBiIHx8IFNrLl9fZnV0dXJlX18ucHl0aG9uMyB8fCAoZCA9ICJMIikKICAgICAgICAgIGIgPSBhLnN0ciQoYiwgITEpCiAgICAgICAgICByZXR1cm4gYS5uYiRpc25lZ2F0aXZlKCkKICAgICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5zdHIoIi0iICsgYyArIGIgKyBkKQogICAgICAgICAgICA6IG5ldyBTay5idWlsdGluLnN0cihjICsgYiArIGQpCiAgICAgICAgfQogICAgICAgIGEgPSBTay5taXNjZXZhbC5hc0luZGV4KGEpCiAgICAgICAgYiA9IGEudG9TdHJpbmcoYikKICAgICAgICByZXR1cm4gMCA+IGEKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uc3RyKCItIiArIGMgKyBiLnNsaWNlKDEpKQogICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5zdHIoYyArIGIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5oZXggPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImhleCIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgaWYgKCFTay5taXNjZXZhbC5pc0luZGV4KGEpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiaGV4KCkgYXJndW1lbnQgY2FuJ3QgYmUgY29udmVydGVkIHRvIGhleCIsCiAgICAgICAgICApCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uaW50MnN0cl8oYSwgMTYsICIweCIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5vY3QgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIm9jdCIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgaWYgKCFTay5taXNjZXZhbC5pc0luZGV4KGEpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAib2N0KCkgYXJndW1lbnQgY2FuJ3QgYmUgY29udmVydGVkIHRvIGhleCIsCiAgICAgICAgICApCiAgICAgICAgcmV0dXJuIFNrLl9fZnV0dXJlX18ub2N0YWxfbnVtYmVyX2xpdGVyYWwKICAgICAgICAgID8gU2suYnVpbHRpbi5pbnQyc3RyXyhhLCA4LCAiMG8iKQogICAgICAgICAgOiBTay5idWlsdGluLmludDJzdHJfKGEsIDgsICIwIikKICAgICAgfQogICAgICBTay5idWlsdGluLmJpbiA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiYmluIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICBpZiAoIVNrLm1pc2NldmFsLmlzSW5kZXgoYSkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICInIiArCiAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYSkgKwogICAgICAgICAgICAgICInIG9iamVjdCBjYW4ndCBiZSBpbnRlcnByZXRlZCBhcyBhbiBpbmRleCIsCiAgICAgICAgICApCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uaW50MnN0cl8oYSwgMiwgIjBiIikKICAgICAgfQogICAgICBTay5idWlsdGluLmRpciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIsIGMKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJkaXIiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxKQogICAgICAgIHZhciBkID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHZhciBiID0gbnVsbAogICAgICAgICAgaWYgKAogICAgICAgICAgICAtMSAhPT0KICAgICAgICAgICAgIl9fYmFzZXNfXyBfX21yb19fIF9fY2xhc3NfXyBfX25hbWVfXyBHZW5lcmljR2V0QXR0ciBHZW5lcmljU2V0QXR0ciBHZW5lcmljUHl0aG9uR2V0QXR0ciBHZW5lcmljUHl0aG9uU2V0QXR0ciBweXRob25GdW5jdGlvbnMgSGFzaE5vdEltcGxlbWVudGVkIGNvbnN0cnVjdG9yIF9fZGljdF9fIgogICAgICAgICAgICAgIC5zcGxpdCgiICIpCiAgICAgICAgICAgICAgLmluZGV4T2YoYSkKICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICAgIDstMSAhPT0gYS5pbmRleE9mKCIkIikKICAgICAgICAgICAgPyAoYiA9IFNrLmJ1aWx0aW4uZGlyLnNsb3ROYW1lVG9SaWNoTmFtZShhKSkKICAgICAgICAgICAgOiAiXyIgIT09IGEuY2hhckF0KGEubGVuZ3RoIC0gMSkKICAgICAgICAgICAgPyAoYiA9IGEpCiAgICAgICAgICAgIDogIl8iID09PSBhLmNoYXJBdCgwKSAmJiAoYiA9IGEpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICB2YXIgZSA9IFtdCiAgICAgICAgdmFyIGYgPSBTay5hYnN0ci5sb29rdXBTcGVjaWFsKGEsIFNrLmJ1aWx0aW4uc3RyLiRkaXIpCiAgICAgICAgaWYgKG51bGwgIT0gZikgewogICAgICAgICAgdmFyIGcgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoZiwgW2FdKQogICAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrU2VxdWVuY2UoZykpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiX19kaXJfXyBtdXN0IHJldHVybiBzZXF1ZW5jZS4iKQogICAgICAgICAgZyA9IFNrLmZmaS5yZW1hcFRvSnMoZykKICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCBnLmxlbmd0aDsgKytiKSBlLnB1c2gobmV3IFNrLmJ1aWx0aW4uc3RyKGdbYl0pKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmb3IgKGIgaW4gYS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUpCiAgICAgICAgICAgIChjID0gZChiKSkgJiYgZS5wdXNoKG5ldyBTay5idWlsdGluLnN0cihjKSkKICAgICAgICAgIGlmIChhLiRkKQogICAgICAgICAgICBpZiAoYS4kZC50cCRpdGVyKQogICAgICAgICAgICAgIGZvciAoCiAgICAgICAgICAgICAgICBmID0gYS4kZC50cCRpdGVyKCksIGIgPSBmLnRwJGl0ZXJuZXh0KCk7CiAgICAgICAgICAgICAgICB2b2lkIDAgIT09IGI7CiAgICAgICAgICAgICAgICBiID0gZi50cCRpdGVybmV4dCgpCiAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKGMgPSBuZXcgU2suYnVpbHRpbi5zdHIoYikpLAogICAgICAgICAgICAgICAgICAoYyA9IGQoYy52KSkgJiYgZS5wdXNoKG5ldyBTay5idWlsdGluLnN0cihjKSkKICAgICAgICAgICAgZWxzZSBmb3IgKGMgaW4gYS4kZCkgZS5wdXNoKG5ldyBTay5idWlsdGluLnN0cihjKSkKICAgICAgICAgIHZhciBoID0gYS50cCRtcm8KICAgICAgICAgICFoICYmIGEub2IkdHlwZSAmJiAoaCA9IGEub2IkdHlwZS50cCRtcm8pCiAgICAgICAgICBpZiAoaCkKICAgICAgICAgICAgZm9yIChiID0gMDsgYiA8IGgudi5sZW5ndGg7ICsrYikKICAgICAgICAgICAgICBmb3IgKGcgaW4gKChmID0gaC52W2JdKSwgZikpCiAgICAgICAgICAgICAgICBmLmhhc093blByb3BlcnR5KGcpICYmCiAgICAgICAgICAgICAgICAgIChjID0gZChnKSkgJiYKICAgICAgICAgICAgICAgICAgZS5wdXNoKG5ldyBTay5idWlsdGluLnN0cihjKSkKICAgICAgICB9CiAgICAgICAgZS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICByZXR1cm4gKGEudiA+IGIudikgLSAoYS52IDwgYi52KQogICAgICAgIH0pCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxpc3QoCiAgICAgICAgICBlLmZpbHRlcihmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgICAgICByZXR1cm4gYSAhPT0gY1tiICsgMV0KICAgICAgICAgIH0pLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmRpci5zbG90TmFtZVRvUmljaE5hbWUgPSBmdW5jdGlvbiAoYSkge30KICAgICAgU2suYnVpbHRpbi5yZXByID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJyZXByIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICByZXR1cm4gU2subWlzY2V2YWwub2JqZWN0UmVwcihhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ub3BlbiA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigib3BlbiIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDMpCiAgICAgICAgdm9pZCAwID09PSBiICYmIChiID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJyIikpCiAgICAgICAgaWYgKC9cKy8udGVzdChiLnYpKSB0aHJvdyAidG9kbzsgaGF2ZW4ndCBpbXBsZW1lbnRlZCByZWFkL3dyaXRlIG1vZGUiCiAgICAgICAgaWYgKAogICAgICAgICAgKCJ3IiA9PT0gYi52IHx8ICJ3YiIgPT09IGIudiB8fCAiYSIgPT09IGIudiB8fCAiYWIiID09PSBiLnYpICYmCiAgICAgICAgICAhU2subm9ucmVhZG9wZW4KICAgICAgICApCiAgICAgICAgICB0aHJvdyAidG9kbzsgaGF2ZW4ndCBpbXBsZW1lbnRlZCBub24tcmVhZCBvcGVucyIKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZmlsZShhLCBiLCBjKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaXNpbnN0YW5jZSA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIGMKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJpc2luc3RhbmNlIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMikKICAgICAgICBpZiAoIShTay5idWlsdGluLmNoZWNrQ2xhc3MoYikgfHwgYiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4udHVwbGUpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiaXNpbnN0YW5jZSgpIGFyZyAyIG11c3QgYmUgYSBjbGFzcywgdHlwZSwgb3IgdHVwbGUgb2YgY2xhc3NlcyBhbmQgdHlwZXMiLAogICAgICAgICAgKQogICAgICAgIGlmIChiID09PSBTay5idWlsdGluLm5vbmUucHJvdG90eXBlLm9iJHR5cGUpCiAgICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubm9uZQogICAgICAgICAgICA/IFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICAgICAgICA6IFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQKICAgICAgICBpZiAoYS5vYiR0eXBlID09PSBiKSByZXR1cm4gU2suYnVpbHRpbi5ib29sLnRydWUkCiAgICAgICAgaWYgKGIgaW5zdGFuY2VvZiBTay5idWlsdGluLnR1cGxlKSB7CiAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgYi52Lmxlbmd0aDsgKytjKQogICAgICAgICAgICBpZiAoU2subWlzY2V2YWwuaXNUcnVlKFNrLmJ1aWx0aW4uaXNpbnN0YW5jZShhLCBiLnZbY10pKSkKICAgICAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ib29sLnRydWUkCiAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgIH0KICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIGIpIHJldHVybiBTay5idWlsdGluLmJvb2wudHJ1ZSQKICAgICAgICB2YXIgZCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICBpZiAoYSA9PT0gYikgcmV0dXJuIFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICAgICAgaWYgKHZvaWQgMCA9PT0gYS4kZCkgcmV0dXJuIFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQKICAgICAgICAgIHZhciBjID0gYS4kZC5tcCRzdWJzY3JpcHQoU2suYnVpbHRpbi50eXBlLmJhc2VzU3RyXykKICAgICAgICAgIGZvciAoYSA9IDA7IGEgPCBjLnYubGVuZ3RoOyArK2EpCiAgICAgICAgICAgIGlmIChTay5taXNjZXZhbC5pc1RydWUoZChjLnZbYV0sIGIpKSkgcmV0dXJuIFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGQoYS5vYiR0eXBlLCBiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaGFzaCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaGFzaCIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBPYmplY3QpIHsKICAgICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrTm9uZShhLnRwJGhhc2gpKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICAgICAgICAgInVuaGFzaGFibGUgdHlwZTogJyIgKyBTay5hYnN0ci50eXBlTmFtZShhKSArICInIiwKICAgICAgICAgICAgICApLAogICAgICAgICAgICApCiAgICAgICAgICBpZiAodm9pZCAwICE9PSBhLnRwJGhhc2gpIHsKICAgICAgICAgICAgaWYgKGEuJHNhdmVkSGFzaF8pIHJldHVybiBhLiRzYXZlZEhhc2hfCiAgICAgICAgICAgIGEuJHNhdmVkSGFzaF8gPSBhLnRwJGhhc2goKQogICAgICAgICAgICByZXR1cm4gYS4kc2F2ZWRIYXNoXwogICAgICAgICAgfQogICAgICAgICAgdm9pZCAwID09PSBhLl9faGFzaCAmJgogICAgICAgICAgICAoKFNrLmJ1aWx0aW4uaGFzaENvdW50ICs9IDEpLCAoYS5fX2hhc2ggPSBTay5idWlsdGluLmhhc2hDb3VudCkpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhhLl9faGFzaCkKICAgICAgICB9CiAgICAgICAgaWYgKCJudW1iZXIiID09PSB0eXBlb2YgYSB8fCBudWxsID09PSBhIHx8ICEwID09PSBhIHx8ICExID09PSBhKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJ1bnN1cHBvcnRlZCBKYXZhc2NyaXB0IHR5cGUiKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIodHlwZW9mIGEgKyAiICIgKyBTdHJpbmcoYSkpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5nZXRhdHRyID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJnZXRhdHRyIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMykKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImF0dHJpYnV0ZSBuYW1lIG11c3QgYmUgc3RyaW5nIikKICAgICAgICB2YXIgZCA9IGIuJGpzc3RyKCkKICAgICAgICB2YXIgZSA9IG5ldyBTay5idWlsdGluLnN0cihTay5maXhSZXNlcnZlZFdvcmRzKGQpKQogICAgICAgIGUgPSBhLnRwJGdldGF0dHIoZSkKICAgICAgICBpZiAodm9pZCAwID09PSBlKSB7CiAgICAgICAgICBpZiAodm9pZCAwICE9PSBjKSByZXR1cm4gYwogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uQXR0cmlidXRlRXJyb3IoCiAgICAgICAgICAgICInIiArCiAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYSkgKwogICAgICAgICAgICAgICInIG9iamVjdCBoYXMgbm8gYXR0cmlidXRlICciICsKICAgICAgICAgICAgICBkICsKICAgICAgICAgICAgICAiJyIsCiAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIHJldHVybiBlCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zZXRhdHRyID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJzZXRhdHRyIiwgYXJndW1lbnRzLmxlbmd0aCwgMywgMykKICAgICAgICBpZiAoCiAgICAgICAgICB2b2lkIDAgPT09IGEgfHwKICAgICAgICAgIHZvaWQgMCA9PT0gYS4kciB8fAogICAgICAgICAgInR5cGUiICE9PSBhLiRyKCkudi5zbGljZSgxLCA1KQogICAgICAgICkgewogICAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrU3RyaW5nKGIpKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImF0dHJpYnV0ZSBuYW1lIG11c3QgYmUgc3RyaW5nIikKICAgICAgICAgIHZhciBkID0gYi4kanNzdHIoKQogICAgICAgICAgaWYgKGEudHAkc2V0YXR0cikKICAgICAgICAgICAgYS50cCRzZXRhdHRyKG5ldyBTay5idWlsdGluLnN0cihTay5maXhSZXNlcnZlZFdvcmRzKGQpKSwgYykKICAgICAgICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uQXR0cmlidXRlRXJyb3IoIm9iamVjdCBoYXMgbm8gYXR0cmlidXRlICIgKyBkKQogICAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAiY2FuJ3Qgc2V0IGF0dHJpYnV0ZXMgb2YgYnVpbHQtaW4vZXh0ZW5zaW9uIHR5cGUgJyIgKyBhLnRwJG5hbWUgKyAiJyIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ucmF3X2lucHV0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiA9IGEgPyBhIDogIiIKICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuY2hhaW4oU2suaW1wb3J0TW9kdWxlKCJzeXMiLCAhMSwgITApLCBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIFNrLmlucHV0ZnVuVGFrZXNQcm9tcHQKICAgICAgICAgICAgPyBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kQXJyYXkoU2suYnVpbHRpbi5maWxlLiRyZWFkbGluZSwgWwogICAgICAgICAgICAgICAgYS4kZC5zdGRpbiwKICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICBiLAogICAgICAgICAgICAgIF0pCiAgICAgICAgICAgIDogU2subWlzY2V2YWwuY2hhaW4oCiAgICAgICAgICAgICAgICB2b2lkIDAsCiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kQXJyYXkoYS4kZC5zdGRvdXQud3JpdGUsIFsKICAgICAgICAgICAgICAgICAgICBhLiRkLnN0ZG91dCwKICAgICAgICAgICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5zdHIoYiksCiAgICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuY2FsbHNpbU9yU3VzcGVuZEFycmF5KAogICAgICAgICAgICAgICAgICAgIGEuJGQuc3RkaW4ucmVhZGxpbmUsCiAgICAgICAgICAgICAgICAgICAgW2EuJGQuc3RkaW5dLAogICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICkKICAgICAgICB9KQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW5wdXQgPSBTay5idWlsdGluLnJhd19pbnB1dAogICAgICBTay5idWlsdGluLmpzZXZhbCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgYSA9IFNrLmdsb2JhbC5ldmFsKFNrLmZmaS5yZW1hcFRvSnMoYSkpCiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJldHVybiBTay5mZmkucmVtYXBUb1B5KGEpCiAgICAgICAgfSBjYXRjaCAoYikgewogICAgICAgICAgaWYgKGIuY29uc3RydWN0b3IgPT09IFNrLmFzc2VydHMuQXNzZXJ0aW9uRXJyb3IpCiAgICAgICAgICAgIHJldHVybiBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgICAgIHRocm93IGIKICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5qc21pbGxpcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3IERhdGUoKS52YWx1ZU9mKCkKICAgICAgfQogICAgICBTay5idWlsdGluLmV2YWxfID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoImV2YWwgaXMgbm90IHlldCBpbXBsZW1lbnRlZCIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5tYXAgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjID0gW10sCiAgICAgICAgICBkLAogICAgICAgICAgZQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIm1hcCIsIGFyZ3VtZW50cy5sZW5ndGgsIDIpCiAgICAgICAgaWYgKDIgPCBhcmd1bWVudHMubGVuZ3RoKSB7CiAgICAgICAgICB2YXIgZiA9IFtdCiAgICAgICAgICB2YXIgZyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5hcHBseShhcmd1bWVudHMpLnNsaWNlKDEpCiAgICAgICAgICBmb3IgKGUgPSAwOyBlIDwgZy5sZW5ndGg7IGUrKykgewogICAgICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZShnW2VdKSkgewogICAgICAgICAgICAgIHZhciBoID0gcGFyc2VJbnQoZSwgMTApICsgMgogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAgICJhcmd1bWVudCAiICsgaCArICIgdG8gbWFwKCkgbXVzdCBzdXBwb3J0IGl0ZXJhdGlvbiIsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdbZV0gPSBTay5hYnN0ci5pdGVyKGdbZV0pCiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKDs7KSB7CiAgICAgICAgICAgIHZhciBrID0gW10KICAgICAgICAgICAgZm9yIChlID0gZCA9IDA7IGUgPCBnLmxlbmd0aDsgZSsrKQogICAgICAgICAgICAgIChoID0gZ1tlXS50cCRpdGVybmV4dCgpKSwKICAgICAgICAgICAgICAgIHZvaWQgMCA9PT0gaCA/IChrLnB1c2goU2suYnVpbHRpbi5ub25lLm5vbmUkKSwgZCsrKSA6IGsucHVzaChoKQogICAgICAgICAgICBpZiAoZCAhPT0gZy5sZW5ndGgpIGYucHVzaChrKQogICAgICAgICAgICBlbHNlIGJyZWFrCiAgICAgICAgICB9CiAgICAgICAgICBiID0gbmV3IFNrLmJ1aWx0aW4ubGlzdChmKQogICAgICAgIH0KICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZShiKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIiciICsgU2suYWJzdHIudHlwZU5hbWUoYikgKyAiJyBvYmplY3QgaXMgbm90IGl0ZXJhYmxlIiwKICAgICAgICAgICkKICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuY2hhaW4oCiAgICAgICAgICBTay5taXNjZXZhbC5pdGVyRm9yKFNrLmFic3RyLml0ZXIoYiksIGZ1bmN0aW9uIChiKSB7CiAgICAgICAgICAgIGlmIChhID09PSBTay5idWlsdGluLm5vbmUubm9uZSQpCiAgICAgICAgICAgICAgYiBpbnN0YW5jZW9mIEFycmF5ICYmIChiID0gbmV3IFNrLmJ1aWx0aW4udHVwbGUoYikpLCBjLnB1c2goYikKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICBiIGluc3RhbmNlb2YgQXJyYXkgfHwgKGIgPSBbYl0pLAogICAgICAgICAgICAgICAgU2subWlzY2V2YWwuY2hhaW4oCiAgICAgICAgICAgICAgICAgIFNrLm1pc2NldmFsLmFwcGx5T3JTdXNwZW5kKGEsIHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGIpLAogICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgICAgICAgIGMucHVzaChhKQogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICkKICAgICAgICAgIH0pLAogICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubGlzdChjKQogICAgICAgICAgfSwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5yZWR1Y2UgPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIHZhciBkCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigicmVkdWNlIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMykKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZShiKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIiciICsgU2suYWJzdHIudHlwZU5hbWUoYikgKyAiJyBvYmplY3QgaXMgbm90IGl0ZXJhYmxlIiwKICAgICAgICAgICkKICAgICAgICB2YXIgZSA9IFNrLmFic3RyLml0ZXIoYikKICAgICAgICBpZiAodm9pZCAwID09PSBjICYmICgoYyA9IGUudHAkaXRlcm5leHQoKSksIHZvaWQgMCA9PT0gYykpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJyZWR1Y2UoKSBvZiBlbXB0eSBzZXF1ZW5jZSB3aXRoIG5vIGluaXRpYWwgdmFsdWUiLAogICAgICAgICAgKQogICAgICAgIHZhciBmID0gYwogICAgICAgIGZvciAoZCA9IGUudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBkOyBkID0gZS50cCRpdGVybmV4dCgpKQogICAgICAgICAgZiA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShhLCBbZiwgZF0pCiAgICAgICAgcmV0dXJuIGYKICAgICAgfQogICAgICBTay5idWlsdGluLmZpbHRlciA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIGMKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJmaWx0ZXIiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiJyIgKyBTay5hYnN0ci50eXBlTmFtZShiKSArICInIG9iamVjdCBpcyBub3QgaXRlcmFibGUiLAogICAgICAgICAgKQogICAgICAgIHZhciBkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIFtdCiAgICAgICAgfQogICAgICAgIHZhciBlID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIGEucHVzaChiKQogICAgICAgICAgcmV0dXJuIGEKICAgICAgICB9CiAgICAgICAgdmFyIGYgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxpc3QoYSkKICAgICAgICB9CiAgICAgICAgYi5fX2NsYXNzX18gPT09IFNrLmJ1aWx0aW4uc3RyCiAgICAgICAgICA/ICgoZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKCIiKQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGUgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgIHJldHVybiBhLnNxJGNvbmNhdChiKQogICAgICAgICAgICB9KSwKICAgICAgICAgICAgKGYgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgIH0pKQogICAgICAgICAgOiBiLl9fY2xhc3NfXyA9PT0gU2suYnVpbHRpbi50dXBsZSAmJgogICAgICAgICAgICAoZiA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnR1cGxlKGEpCiAgICAgICAgICAgIH0pCiAgICAgICAgdmFyIGcgPSBkKCkKICAgICAgICB2YXIgaCA9IFNrLmFic3RyLml0ZXIoYikKICAgICAgICBmb3IgKGMgPSBoLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gYzsgYyA9IGgudHAkaXRlcm5leHQoKSkKICAgICAgICAgIChkID0KICAgICAgICAgICAgYSA9PT0gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5ib29sKGMpCiAgICAgICAgICAgICAgOiBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYSwgW2NdKSksCiAgICAgICAgICAgIFNrLm1pc2NldmFsLmlzVHJ1ZShkKSAmJiAoZyA9IGUoZywgYykpCiAgICAgICAgcmV0dXJuIGYoZykKICAgICAgfQogICAgICBTay5idWlsdGluLmhhc2F0dHIgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImhhc2F0dHIiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja1N0cmluZyhiKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgImhhc2F0dHIoKTogYXR0cmlidXRlIG5hbWUgbXVzdCBiZSBzdHJpbmciLAogICAgICAgICAgKQogICAgICAgIGlmIChhLnRwJGdldGF0dHIpCiAgICAgICAgICByZXR1cm4gYS50cCRnZXRhdHRyKGIpCiAgICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLnRydWUkCiAgICAgICAgICAgIDogU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yKCJPYmplY3QgaGFzIG5vIHRwJGdldGF0dHIgbWV0aG9kIikKICAgICAgfQogICAgICBTay5idWlsdGluLnBvdyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigicG93IiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMykKICAgICAgICBjIGluc3RhbmNlb2YgU2suYnVpbHRpbi5ub25lICYmIChjID0gdm9pZCAwKQogICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrQ29tcGxleChhKSkgcmV0dXJuIGEubmIkcG93ZXIoYiwgYykKICAgICAgICB2YXIgZCA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgdmFyIGUgPSBTay5idWlsdGluLmFzbnVtJChiKQogICAgICAgIHZhciBmID0gU2suYnVpbHRpbi5hc251bSQoYykKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tOdW1iZXIoYSkgfHwgIVNrLmJ1aWx0aW4uY2hlY2tOdW1iZXIoYikpIHsKICAgICAgICAgIGlmICh2b2lkIDAgPT09IGMpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAidW5zdXBwb3J0ZWQgb3BlcmFuZCB0eXBlKHMpIGZvciBwb3coKTogJyIgKwogICAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYSkgKwogICAgICAgICAgICAgICAgIicgYW5kICciICsKICAgICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGIpICsKICAgICAgICAgICAgICAgICInIiwKICAgICAgICAgICAgKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAidW5zdXBwb3J0ZWQgb3BlcmFuZCB0eXBlKHMpIGZvciBwb3coKTogJyIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGEpICsKICAgICAgICAgICAgICAiJywgJyIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGIpICsKICAgICAgICAgICAgICAiJywgJyIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGMpICsKICAgICAgICAgICAgICAiJyIsCiAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIGlmICgwID4gZCAmJiBiIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8pCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKAogICAgICAgICAgICAibmVnYXRpdmUgbnVtYmVyIGNhbm5vdCBiZSByYWlzZWQgdG8gYSBmcmFjdGlvbmFsIHBvd2VyIiwKICAgICAgICAgICkKICAgICAgICBpZiAodm9pZCAwID09PSBjKSB7CiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XyB8fAogICAgICAgICAgICBiIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8gfHwKICAgICAgICAgICAgMCA+IGUKICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmZsb2F0XyhNYXRoLnBvdyhkLCBlKSkKICAgICAgICAgIGYgPSBuZXcgU2suYnVpbHRpbi5pbnRfKGQpCiAgICAgICAgICBlID0gbmV3IFNrLmJ1aWx0aW4uaW50XyhlKQogICAgICAgICAgZSA9IGYubmIkcG93ZXIoZSkKICAgICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgfHwgYiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4ubG5nKGUpCiAgICAgICAgICAgIDogZQogICAgICAgIH0KICAgICAgICBpZiAoCiAgICAgICAgICAhU2suYnVpbHRpbi5jaGVja0ludChhKSB8fAogICAgICAgICAgIVNrLmJ1aWx0aW4uY2hlY2tJbnQoYikgfHwKICAgICAgICAgICFTay5idWlsdGluLmNoZWNrSW50KGMpCiAgICAgICAgKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAicG93KCkgM3JkIGFyZ3VtZW50IG5vdCBhbGxvd2VkIHVubGVzcyBhbGwgYXJndW1lbnRzIGFyZSBpbnRlZ2VycyIsCiAgICAgICAgICApCiAgICAgICAgaWYgKDAgPiBlKSB7CiAgICAgICAgICBpZiAoU2suX19mdXR1cmVfXy5leGNlcHRpb25zKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKAogICAgICAgICAgICAgICJwb3coKSAybmQgYXJndW1lbnQgY2Fubm90IGJlIG5lZ2F0aXZlIHdoZW4gM3JkIGFyZ3VtZW50IHNwZWNpZmllZCIsCiAgICAgICAgICAgICkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgInBvdygpIDJuZCBhcmd1bWVudCBjYW5ub3QgYmUgbmVnYXRpdmUgd2hlbiAzcmQgYXJndW1lbnQgc3BlY2lmaWVkIiwKICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgaWYgKDAgPT09IGYpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJwb3coKSAzcmQgYXJndW1lbnQgY2Fubm90IGJlIDAiKQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgfHwKICAgICAgICAgIGIgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyB8fAogICAgICAgICAgYyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nIHx8CiAgICAgICAgICBJbmZpbml0eSA9PT0gTWF0aC5wb3coZCwgZSkKICAgICAgICAgID8gKChhID0gbmV3IFNrLmJ1aWx0aW4ubG5nKGEpKSwgYS5uYiRwb3dlcihiLCBjKSkKICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uaW50XyhNYXRoLnBvdyhkLCBlKSkubmIkcmVtYWluZGVyKGMpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5xdWl0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBhID0gbmV3IFNrLmJ1aWx0aW4uc3RyKGEpLnYKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeXN0ZW1FeGl0KGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pc3N1YmNsYXNzID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB2YXIgYwogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImlzc3ViY2xhc3MiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0NsYXNzKGEpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJpc3N1YmNsYXNzKCkgYXJnIDEgbXVzdCBiZSBhIGNsYXNzIikKICAgICAgICBpZiAoIShTay5idWlsdGluLmNoZWNrQ2xhc3MoYikgfHwgYiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4udHVwbGUpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiaXNzdWJjbGFzcygpIGFyZyAyIG11c3QgYmUgYSBjbGFzcyBvciB0dXBsZSBvZiBjbGFzc2VzIiwKICAgICAgICAgICkKICAgICAgICB2YXIgZCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICBpZiAoYSA9PT0gYikgcmV0dXJuICEwCiAgICAgICAgICBpZiAodm9pZCAwICE9PSBhLiRkICYmIGEuJGQubXAkc3Vic2NyaXB0KQogICAgICAgICAgICBpZiAoYS4kZC5zcSRjb250YWlucyhTay5idWlsdGluLnR5cGUuYmFzZXNTdHJfKSkKICAgICAgICAgICAgICB2YXIgYyA9IGEuJGQubXAkc3Vic2NyaXB0KFNrLmJ1aWx0aW4udHlwZS5iYXNlc1N0cl8pCiAgICAgICAgICAgIGVsc2UgcmV0dXJuICExCiAgICAgICAgICBlbHNlIHJldHVybiAhMQogICAgICAgICAgZm9yIChhID0gMDsgYSA8IGMudi5sZW5ndGg7ICsrYSkgaWYgKGQoYy52W2FdLCBiKSkgcmV0dXJuICEwCiAgICAgICAgICByZXR1cm4gITEKICAgICAgICB9CiAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tDbGFzcyhiKSkgcmV0dXJuIGEgPT09IGIgPyAhMCA6IGQoYSwgYikKICAgICAgICBpZiAoYiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4udHVwbGUpIHsKICAgICAgICAgIGZvciAoYyA9IDA7IGMgPCBiLnYubGVuZ3RoOyArK2MpCiAgICAgICAgICAgIGlmIChTay5idWlsdGluLmlzc3ViY2xhc3MoYSwgYi52W2NdKSkgcmV0dXJuICEwCiAgICAgICAgICByZXR1cm4gITEKICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5nbG9iYWxzID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBhLAogICAgICAgICAgYiA9IG5ldyBTay5idWlsdGluLmRpY3QoW10pCiAgICAgICAgZm9yIChhIGluIFNrLmdsb2JhbHMpCiAgICAgICAgICBiLm1wJGFzc19zdWJzY3JpcHQobmV3IFNrLmJ1aWx0aW4uc3RyKGEpLCBTay5nbG9iYWxzW2FdKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5kaXZtb2QgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBTay5hYnN0ci5udW1iZXJCaW5PcChhLCBiLCAiRGl2TW9kIikKICAgICAgfQogICAgICBTay5idWlsdGluLmZvcm1hdCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiZm9ybWF0IiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMikKICAgICAgICB2b2lkIDAgPT09IGIgJiYgKGIgPSBTay5idWlsdGluLnN0ci4kZW1wdHlzdHIpCiAgICAgICAgcmV0dXJuIFNrLmFic3RyLm9iamVjdEZvcm1hdChhLCBiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ucmV2ZXJzZWQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInJldmVyc2VkIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICB2YXIgYiA9IFNrLmFic3RyLmxvb2t1cFNwZWNpYWwoYSwgU2suYnVpbHRpbi5zdHIuJHJldmVyc2VkKQogICAgICAgIGlmIChudWxsICE9IGIpIHJldHVybiBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYiwgW2FdKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja1NlcXVlbmNlKGEpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiJyIgKyBTay5hYnN0ci50eXBlTmFtZShhKSArICInIG9iamVjdCBpcyBub3QgYSBzZXF1ZW5jZSIsCiAgICAgICAgICApCiAgICAgICAgcmV0dXJuIG5ldyAoZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHRoaXMuaWR4ID0gYS5zcSRsZW5ndGgoKSAtIDEKICAgICAgICAgIHRoaXMubXlvYmogPSBhCiAgICAgICAgICB0aGlzLmdldGl0ZW0gPSBTay5hYnN0ci5sb29rdXBTcGVjaWFsKGEsIFNrLmJ1aWx0aW4uc3RyLiRnZXRpdGVtKQogICAgICAgICAgdGhpcy50cCRpdGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgICAgfQogICAgICAgICAgdGhpcy50cCRpdGVybmV4dCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKCEoMCA+IHRoaXMuaWR4KSkgewogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB2YXIgYSA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheSh0aGlzLmdldGl0ZW0sIFsKICAgICAgICAgICAgICAgICAgdGhpcy5teW9iaiwKICAgICAgICAgICAgICAgICAgU2suZmZpLnJlbWFwVG9QeSh0aGlzLmlkeCksCiAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgU2suYnVpbHRpbi5JbmRleEVycm9yKSByZXR1cm4KICAgICAgICAgICAgICAgIHRocm93IGUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy5pZHgtLQogICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KShhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaWQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImlkIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICB2b2lkIDAgPT09IGEuX19pZCAmJgogICAgICAgICAgKChTay5idWlsdGluLmlkQ291bnQgKz0gMSksIChhLl9faWQgPSBTay5idWlsdGluLmlkQ291bnQpKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKGEuX19pZCkKICAgICAgfQogICAgICBTay5idWlsdGluLmJ5dGVhcnJheSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgImJ5dGVhcnJheSBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jYWxsYWJsZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiY2FsbGFibGUiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxKQogICAgICAgIHJldHVybiBTay5idWlsdGluLmNoZWNrQ2FsbGFibGUoYSkKICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLnRydWUkCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQKICAgICAgfQogICAgICBTay5idWlsdGluLmRlbGF0dHIgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImRlbGF0dHIiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIGlmICh2b2lkIDAgIT09IGEuJGRbYi52XSkKICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC50cnlDYXRjaCgKICAgICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBTay5idWlsdGluLnNldGF0dHIoYSwgYiwgdm9pZCAwKQogICAgICAgICAgICB9LAogICAgICAgICAgICBmdW5jdGlvbiAoYykgewogICAgICAgICAgICAgIFNrLm1pc2NldmFsLnRyeUNhdGNoKAogICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5zZXRhdHRyKGEuJGQsIGIsIHZvaWQgMCkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoYykgewogICAgICAgICAgICAgICAgICBpZiAoYyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uQXR0cmlidXRlRXJyb3IpCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uQXR0cmlidXRlRXJyb3IoCiAgICAgICAgICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShhKSArCiAgICAgICAgICAgICAgICAgICAgICAgICIgaW5zdGFuY2UgaGFzIG5vIGF0dHJpYnV0ZSAnIiArCiAgICAgICAgICAgICAgICAgICAgICAgIGIudiArCiAgICAgICAgICAgICAgICAgICAgICAgICInIiwKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgIHRocm93IGMKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgKQogICAgICAgICAgICB9LAogICAgICAgICAgKQogICAgICAgIGlmICgidHlwZSIgIT09IGEuJHIoKS52LnNsaWNlKDEsIDUpKSB7CiAgICAgICAgICBpZiAoYS5vYiR0eXBlID09PSBTay5idWlsdGluLnR5cGUgJiYgdm9pZCAwICE9PSBhW2Iudl0pCiAgICAgICAgICAgIHJldHVybiAoYVtiLnZdID0gdm9pZCAwKSwgU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5BdHRyaWJ1dGVFcnJvcigKICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYSkgKyAiIGluc3RhbmNlIGhhcyBubyBhdHRyaWJ1dGUgJyIgKyBiLnYgKyAiJyIsCiAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICJjYW4ndCBzZXQgYXR0cmlidXRlcyBvZiBidWlsdC1pbi9leHRlbnNpb24gdHlwZSAnIiArIGEudHAkbmFtZSArICInIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5leGVjZmlsZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgImV4ZWNmaWxlIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQiLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmZyb3plbnNldCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgImZyb3plbnNldCBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5oZWxwID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoImhlbHAgaXMgbm90IHlldCBpbXBsZW1lbnRlZCIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pdGVyID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJpdGVyIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMikKICAgICAgICBpZiAoMSA9PT0gYXJndW1lbnRzLmxlbmd0aCkgewogICAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZShhKSkgcmV0dXJuIG5ldyBTay5idWlsdGluLml0ZXJhdG9yKGEpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICInIiArIFNrLmFic3RyLnR5cGVOYW1lKGEpICsgIicgb2JqZWN0IGlzIG5vdCBpdGVyYWJsZSIsCiAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrQ2FsbGFibGUoYSkpIHJldHVybiBuZXcgU2suYnVpbHRpbi5pdGVyYXRvcihhLCBiKQogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIml0ZXIodiwgdyk6IHYgbXVzdCBiZSBjYWxsYWJsZSIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sb2NhbHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICJsb2NhbHMgaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubWVtb3J5dmlldyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgIm1lbW9yeXZpZXcgaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubmV4dF8gPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIm5leHQiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyKQogICAgICAgIGlmICghYS50cCRpdGVybmV4dCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIiciICsgU2suYWJzdHIudHlwZU5hbWUoYSkgKyAiJyBvYmplY3QgaXMgbm90IGFuIGl0ZXJhdG9yIiwKICAgICAgICAgICkKICAgICAgICB2YXIgYyA9IGEudHAkaXRlcm5leHQoKQogICAgICAgIGlmICh2b2lkIDAgPT09IGMpIHsKICAgICAgICAgIGlmIChiKSByZXR1cm4gYgogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3RvcEl0ZXJhdGlvbigpCiAgICAgICAgfQogICAgICAgIHJldHVybiBjCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5yZWxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICJyZWxvYWQgaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udmFycyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKCJ2YXJzIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ueHJhbmdlID0gU2suYnVpbHRpbi5yYW5nZQogICAgICBTay5idWlsdGluLmFwcGx5XyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKCJhcHBseSBpcyBub3QgeWV0IGltcGxlbWVudGVkIikKICAgICAgfQogICAgICBTay5idWlsdGluLmJ1ZmZlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgImJ1ZmZlciBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb2VyY2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICJjb2VyY2UgaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50ZXJuID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAiaW50ZXJuIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQiLAogICAgICAgICkKICAgICAgfQogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwKSB7CiAgICAgIFN0cmluZy5mcm9tQ29kZVBvaW50IHx8CiAgICAgICAgKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBhID0gKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIGEgPSB7fSwKICAgICAgICAgICAgICAgICAgYiA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eQogICAgICAgICAgICAgICAgdmFyIGMgPSBiKGEsICJmb28iLCBhKSAmJiBiCiAgICAgICAgICAgICAgfSBjYXRjaCAoaCkge30KICAgICAgICAgICAgICByZXR1cm4gYwogICAgICAgICAgICB9KSgpLAogICAgICAgICAgICBiID0gU3RyaW5nLmZyb21DaGFyQ29kZSwKICAgICAgICAgICAgYyA9IE1hdGguZmxvb3IsCiAgICAgICAgICAgIGQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgIHZhciBkID0gW10sCiAgICAgICAgICAgICAgICBlID0gLTEsCiAgICAgICAgICAgICAgICBoID0gYXJndW1lbnRzLmxlbmd0aAogICAgICAgICAgICAgIGlmICghaCkgcmV0dXJuICIiCiAgICAgICAgICAgICAgZm9yICh2YXIgayA9ICIiOyArK2UgPCBoOyApIHsKICAgICAgICAgICAgICAgIHZhciBsID0gTnVtYmVyKGFyZ3VtZW50c1tlXSkKICAgICAgICAgICAgICAgIGlmICghaXNGaW5pdGUobCkgfHwgMCA+IGwgfHwgMTExNDExMSA8IGwgfHwgYyhsKSAhPSBsKQogICAgICAgICAgICAgICAgICB0aHJvdyBSYW5nZUVycm9yKCJJbnZhbGlkIGNvZGUgcG9pbnQ6ICIgKyBsKQogICAgICAgICAgICAgICAgaWYgKDY1NTM1ID49IGwpIGQucHVzaChsKQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgIGwgLT0gNjU1MzYKICAgICAgICAgICAgICAgICAgdmFyIHIgPSAobCA+PiAxMCkgKyA1NTI5NgogICAgICAgICAgICAgICAgICBsID0gKGwgJSAxMDI0KSArIDU2MzIwCiAgICAgICAgICAgICAgICAgIGQucHVzaChyLCBsKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGUgKyAxID09IGggfHwgMTYzODQgPCBkLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgKGsgKz0gYi5hcHBseShudWxsLCBkKSksIChkLmxlbmd0aCA9IDApCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBrCiAgICAgICAgICAgIH0KICAgICAgICAgIGEKICAgICAgICAgICAgPyBhKFN0cmluZywgImZyb21Db2RlUG9pbnQiLCB7CiAgICAgICAgICAgICAgICB2YWx1ZTogZCwKICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAsCiAgICAgICAgICAgICAgICB3cml0YWJsZTogITAsCiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgOiAoU3RyaW5nLmZyb21Db2RlUG9pbnQgPSBkKQogICAgICAgIH0pKCkKICAgIH0sCiAgICBmdW5jdGlvbiAobSwgcCkgewogICAgICBTay5idWlsdGluLkJhc2VFeGNlcHRpb24gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLkJhc2VFeGNlcHRpb24pKSB7CiAgICAgICAgICB2YXIgYiA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5CYXNlRXhjZXB0aW9uLnByb3RvdHlwZSkKICAgICAgICAgIGIuY29uc3RydWN0b3IuYXBwbHkoYiwgYXJndW1lbnRzKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICAgICAgYSA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cykKICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYS5sZW5ndGg7ICsrYikKICAgICAgICAgICJzdHJpbmciID09PSB0eXBlb2YgYVtiXSAmJiAoYVtiXSA9IG5ldyBTay5idWlsdGluLnN0cihhW2JdKSkKICAgICAgICB0aGlzLmFyZ3MgPSBuZXcgU2suYnVpbHRpbi50dXBsZShhKQogICAgICAgIHRoaXMudHJhY2ViYWNrID0gW10KICAgICAgICAzIDw9IHRoaXMuYXJncy5zcSRsZW5ndGgoKSAmJgogICAgICAgICAgdGhpcy50cmFjZWJhY2sucHVzaCh7CiAgICAgICAgICAgIGxpbmVubzogdGhpcy5hcmdzLnZbMl0sCiAgICAgICAgICAgIGZpbGVuYW1lOiB0aGlzLmFyZ3MudlsxXS52IHx8ICI8dW5rbm93bj4iLAogICAgICAgICAgfSkKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJCYXNlRXhjZXB0aW9uIiwKICAgICAgICBTay5idWlsdGluLkJhc2VFeGNlcHRpb24sCiAgICAgICAgU2suYnVpbHRpbi5vYmplY3QsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5CYXNlRXhjZXB0aW9uLnByb3RvdHlwZS50cCRzdHIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGEKICAgICAgICB2YXIgYiA9ICIiICsgdGhpcy50cCRuYW1lCiAgICAgICAgdGhpcy5hcmdzICYmCiAgICAgICAgICAoYiArPSAiOiAiICsgKDAgPCB0aGlzLmFyZ3Mudi5sZW5ndGggPyB0aGlzLmFyZ3MudlswXS52IDogIiIpKQogICAgICAgIGIgPQogICAgICAgICAgMCAhPT0gdGhpcy50cmFjZWJhY2subGVuZ3RoCiAgICAgICAgICAgID8gYiArICgiIG9uIGxpbmUgIiArIHRoaXMudHJhY2ViYWNrWzBdLmxpbmVubykKICAgICAgICAgICAgOiBiICsgIiBhdCA8dW5rbm93bj4iCiAgICAgICAgaWYgKDQgPCB0aGlzLmFyZ3Mudi5sZW5ndGgpIHsKICAgICAgICAgIGIgKz0gIlxuIiArIHRoaXMuYXJncy52WzRdLnYgKyAiXG4iCiAgICAgICAgICBmb3IgKGEgPSAwOyBhIDwgdGhpcy5hcmdzLnZbM107ICsrYSkgYiArPSAiICIKICAgICAgICAgIGIgKz0gIl5cbiIKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uQmFzZUV4Y2VwdGlvbi5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudHAkc3RyKCkudgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uQmFzZUV4Y2VwdGlvbi5wcm90b3R5cGUuYXJncyA9IHsKICAgICAgICB0cCRkZXNjcl9nZXQ6IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICByZXR1cm4gYS5hcmdzCiAgICAgICAgfSwKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uQmFzZUV4Y2VwdGlvbiIsIFNrLmJ1aWx0aW4uQmFzZUV4Y2VwdGlvbikKICAgICAgU2suYnVpbHRpbi5FeGNlcHRpb24gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLkV4Y2VwdGlvbikpIHsKICAgICAgICAgIHZhciBiID0gT2JqZWN0LmNyZWF0ZShTay5idWlsdGluLkV4Y2VwdGlvbi5wcm90b3R5cGUpCiAgICAgICAgICBiLmNvbnN0cnVjdG9yLmFwcGx5KGIsIGFyZ3VtZW50cykKICAgICAgICAgIHJldHVybiBiCiAgICAgICAgfQogICAgICAgIFNrLmJ1aWx0aW4uQmFzZUV4Y2VwdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiRXhjZXB0aW9uIiwKICAgICAgICBTay5idWlsdGluLkV4Y2VwdGlvbiwKICAgICAgICBTay5idWlsdGluLkJhc2VFeGNlcHRpb24sCiAgICAgICkKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLkV4Y2VwdGlvbiIsIFNrLmJ1aWx0aW4uRXhjZXB0aW9uKQogICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IpKSB7CiAgICAgICAgICB2YXIgYiA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLnByb3RvdHlwZSkKICAgICAgICAgIGIuY29uc3RydWN0b3IuYXBwbHkoYiwgYXJndW1lbnRzKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICAgICAgU2suYnVpbHRpbi5FeGNlcHRpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIlN0YW5kYXJkRXJyb3IiLAogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgICBTay5idWlsdGluLkV4Y2VwdGlvbiwKICAgICAgKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciIsIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvcikKICAgICAgU2suYnVpbHRpbi5Bc3NlcnRpb25FcnJvciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uQXNzZXJ0aW9uRXJyb3IpKSB7CiAgICAgICAgICB2YXIgYiA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5Bc3NlcnRpb25FcnJvci5wcm90b3R5cGUpCiAgICAgICAgICBiLmNvbnN0cnVjdG9yLmFwcGx5KGIsIGFyZ3VtZW50cykKICAgICAgICAgIHJldHVybiBiCiAgICAgICAgfQogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiQXNzZXJ0aW9uRXJyb3IiLAogICAgICAgIFNrLmJ1aWx0aW4uQXNzZXJ0aW9uRXJyb3IsCiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLAogICAgICApCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5Bc3NlcnRpb25FcnJvciIsIFNrLmJ1aWx0aW4uQXNzZXJ0aW9uRXJyb3IpCiAgICAgIFNrLmJ1aWx0aW4uQXR0cmlidXRlRXJyb3IgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yKSkgewogICAgICAgICAgdmFyIGIgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uQXR0cmlidXRlRXJyb3IucHJvdG90eXBlKQogICAgICAgICAgYi5jb25zdHJ1Y3Rvci5hcHBseShiLCBhcmd1bWVudHMpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIkF0dHJpYnV0ZUVycm9yIiwKICAgICAgICBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yLAogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgKQogICAgICBTay5idWlsdGluLkltcG9ydEVycm9yID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5JbXBvcnRFcnJvcikpIHsKICAgICAgICAgIHZhciBiID0gT2JqZWN0LmNyZWF0ZShTay5idWlsdGluLkltcG9ydEVycm9yLnByb3RvdHlwZSkKICAgICAgICAgIGIuY29uc3RydWN0b3IuYXBwbHkoYiwgYXJndW1lbnRzKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJJbXBvcnRFcnJvciIsCiAgICAgICAgU2suYnVpbHRpbi5JbXBvcnRFcnJvciwKICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5JbmRlbnRhdGlvbkVycm9yID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5JbmRlbnRhdGlvbkVycm9yKSkgewogICAgICAgICAgdmFyIGIgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uSW5kZW50YXRpb25FcnJvci5wcm90b3R5cGUpCiAgICAgICAgICBiLmNvbnN0cnVjdG9yLmFwcGx5KGIsIGFyZ3VtZW50cykKICAgICAgICAgIHJldHVybiBiCiAgICAgICAgfQogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiSW5kZW50YXRpb25FcnJvciIsCiAgICAgICAgU2suYnVpbHRpbi5JbmRlbnRhdGlvbkVycm9yLAogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgKQogICAgICBTay5idWlsdGluLkluZGV4RXJyb3IgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLkluZGV4RXJyb3IpKSB7CiAgICAgICAgICB2YXIgYiA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5JbmRleEVycm9yLnByb3RvdHlwZSkKICAgICAgICAgIGIuY29uc3RydWN0b3IuYXBwbHkoYiwgYXJndW1lbnRzKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJJbmRleEVycm9yIiwKICAgICAgICBTay5idWlsdGluLkluZGV4RXJyb3IsCiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uS2V5RXJyb3IgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLktleUVycm9yKSkgewogICAgICAgICAgdmFyIGIgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uS2V5RXJyb3IucHJvdG90eXBlKQogICAgICAgICAgYi5jb25zdHJ1Y3Rvci5hcHBseShiLCBhcmd1bWVudHMpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIktleUVycm9yIiwKICAgICAgICBTay5idWlsdGluLktleUVycm9yLAogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgKQogICAgICBTay5idWlsdGluLk5hbWVFcnJvciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uTmFtZUVycm9yKSkgewogICAgICAgICAgdmFyIGIgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uTmFtZUVycm9yLnByb3RvdHlwZSkKICAgICAgICAgIGIuY29uc3RydWN0b3IuYXBwbHkoYiwgYXJndW1lbnRzKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJOYW1lRXJyb3IiLAogICAgICAgIFNrLmJ1aWx0aW4uTmFtZUVycm9yLAogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgKQogICAgICBTay5idWlsdGluLlVuYm91bmRMb2NhbEVycm9yID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5VbmJvdW5kTG9jYWxFcnJvcikpIHsKICAgICAgICAgIHZhciBiID0gT2JqZWN0LmNyZWF0ZShTay5idWlsdGluLlVuYm91bmRMb2NhbEVycm9yLnByb3RvdHlwZSkKICAgICAgICAgIGIuY29uc3RydWN0b3IuYXBwbHkoYiwgYXJndW1lbnRzKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJVbmJvdW5kTG9jYWxFcnJvciIsCiAgICAgICAgU2suYnVpbHRpbi5VbmJvdW5kTG9jYWxFcnJvciwKICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5PdmVyZmxvd0Vycm9yID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5PdmVyZmxvd0Vycm9yKSkgewogICAgICAgICAgdmFyIGIgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uT3ZlcmZsb3dFcnJvci5wcm90b3R5cGUpCiAgICAgICAgICBiLmNvbnN0cnVjdG9yLmFwcGx5KGIsIGFyZ3VtZW50cykKICAgICAgICAgIHJldHVybiBiCiAgICAgICAgfQogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiT3ZlcmZsb3dFcnJvciIsCiAgICAgICAgU2suYnVpbHRpbi5PdmVyZmxvd0Vycm9yLAogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgKQogICAgICBTay5idWlsdGluLlN5bnRheEVycm9yID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5TeW50YXhFcnJvcikpIHsKICAgICAgICAgIHZhciBiID0gT2JqZWN0LmNyZWF0ZShTay5idWlsdGluLlN5bnRheEVycm9yLnByb3RvdHlwZSkKICAgICAgICAgIGIuY29uc3RydWN0b3IuYXBwbHkoYiwgYXJndW1lbnRzKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJTeW50YXhFcnJvciIsCiAgICAgICAgU2suYnVpbHRpbi5TeW50YXhFcnJvciwKICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5SdW50aW1lRXJyb3IgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLlJ1bnRpbWVFcnJvcikpIHsKICAgICAgICAgIHZhciBiID0gT2JqZWN0LmNyZWF0ZShTay5idWlsdGluLlJ1bnRpbWVFcnJvci5wcm90b3R5cGUpCiAgICAgICAgICBiLmNvbnN0cnVjdG9yLmFwcGx5KGIsIGFyZ3VtZW50cykKICAgICAgICAgIHJldHVybiBiCiAgICAgICAgfQogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiUnVudGltZUVycm9yIiwKICAgICAgICBTay5idWlsdGluLlJ1bnRpbWVFcnJvciwKICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IsCiAgICAgICkKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLlJ1bnRpbWVFcnJvciIsIFNrLmJ1aWx0aW4uUnVudGltZUVycm9yKQogICAgICBTay5idWlsdGluLlN1c3BlbnNpb25FcnJvciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uU3VzcGVuc2lvbkVycm9yKSkgewogICAgICAgICAgdmFyIGIgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uU3VzcGVuc2lvbkVycm9yLnByb3RvdHlwZSkKICAgICAgICAgIGIuY29uc3RydWN0b3IuYXBwbHkoYiwgYXJndW1lbnRzKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJTdXNwZW5zaW9uRXJyb3IiLAogICAgICAgIFNrLmJ1aWx0aW4uU3VzcGVuc2lvbkVycm9yLAogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uU3VzcGVuc2lvbkVycm9yIiwgU2suYnVpbHRpbi5TdXNwZW5zaW9uRXJyb3IpCiAgICAgIFNrLmJ1aWx0aW4uU3lzdGVtRXhpdCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uU3lzdGVtRXhpdCkpIHsKICAgICAgICAgIHZhciBiID0gT2JqZWN0LmNyZWF0ZShTay5idWlsdGluLlN5c3RlbUV4aXQucHJvdG90eXBlKQogICAgICAgICAgYi5jb25zdHJ1Y3Rvci5hcHBseShiLCBhcmd1bWVudHMpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBTay5idWlsdGluLkJhc2VFeGNlcHRpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIlN5c3RlbUV4aXQiLAogICAgICAgIFNrLmJ1aWx0aW4uU3lzdGVtRXhpdCwKICAgICAgICBTay5idWlsdGluLkJhc2VFeGNlcHRpb24sCiAgICAgICkKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLlN5c3RlbUV4aXQiLCBTay5idWlsdGluLlN5c3RlbUV4aXQpCiAgICAgIFNrLmJ1aWx0aW4uVHlwZUVycm9yID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5UeXBlRXJyb3IpKSB7CiAgICAgICAgICB2YXIgYiA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5UeXBlRXJyb3IucHJvdG90eXBlKQogICAgICAgICAgYi5jb25zdHJ1Y3Rvci5hcHBseShiLCBhcmd1bWVudHMpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIlR5cGVFcnJvciIsCiAgICAgICAgU2suYnVpbHRpbi5UeXBlRXJyb3IsCiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLAogICAgICApCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5UeXBlRXJyb3IiLCBTay5idWlsdGluLlR5cGVFcnJvcikKICAgICAgU2suYnVpbHRpbi5WYWx1ZUVycm9yID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5WYWx1ZUVycm9yKSkgewogICAgICAgICAgdmFyIGIgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uVmFsdWVFcnJvci5wcm90b3R5cGUpCiAgICAgICAgICBiLmNvbnN0cnVjdG9yLmFwcGx5KGIsIGFyZ3VtZW50cykKICAgICAgICAgIHJldHVybiBiCiAgICAgICAgfQogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiVmFsdWVFcnJvciIsCiAgICAgICAgU2suYnVpbHRpbi5WYWx1ZUVycm9yLAogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uVmFsdWVFcnJvciIsIFNrLmJ1aWx0aW4uVmFsdWVFcnJvcikKICAgICAgU2suYnVpbHRpbi5aZXJvRGl2aXNpb25FcnJvciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uWmVyb0RpdmlzaW9uRXJyb3IpKSB7CiAgICAgICAgICB2YXIgYiA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5aZXJvRGl2aXNpb25FcnJvci5wcm90b3R5cGUpCiAgICAgICAgICBiLmNvbnN0cnVjdG9yLmFwcGx5KGIsIGFyZ3VtZW50cykKICAgICAgICAgIHJldHVybiBiCiAgICAgICAgfQogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiWmVyb0RpdmlzaW9uRXJyb3IiLAogICAgICAgIFNrLmJ1aWx0aW4uWmVyb0RpdmlzaW9uRXJyb3IsCiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uVGltZUxpbWl0RXJyb3IgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLlRpbWVMaW1pdEVycm9yKSkgewogICAgICAgICAgdmFyIGIgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uVGltZUxpbWl0RXJyb3IucHJvdG90eXBlKQogICAgICAgICAgYi5jb25zdHJ1Y3Rvci5hcHBseShiLCBhcmd1bWVudHMpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIlRpbWVMaW1pdEVycm9yIiwKICAgICAgICBTay5idWlsdGluLlRpbWVMaW1pdEVycm9yLAogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uVGltZUxpbWl0RXJyb3IiLCBTay5idWlsdGluLlRpbWVMaW1pdEVycm9yKQogICAgICBTay5idWlsdGluLklPRXJyb3IgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLklPRXJyb3IpKSB7CiAgICAgICAgICB2YXIgYiA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5JT0Vycm9yLnByb3RvdHlwZSkKICAgICAgICAgIGIuY29uc3RydWN0b3IuYXBwbHkoYiwgYXJndW1lbnRzKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJJT0Vycm9yIiwKICAgICAgICBTay5idWlsdGluLklPRXJyb3IsCiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLAogICAgICApCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5JT0Vycm9yIiwgU2suYnVpbHRpbi5JT0Vycm9yKQogICAgICBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IpKSB7CiAgICAgICAgICB2YXIgYiA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yLnByb3RvdHlwZSkKICAgICAgICAgIGIuY29uc3RydWN0b3IuYXBwbHkoYiwgYXJndW1lbnRzKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJOb3RJbXBsZW1lbnRlZEVycm9yIiwKICAgICAgICBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IsCiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLAogICAgICApCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgKICAgICAgICAiU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yIiwKICAgICAgICBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5OZWdhdGl2ZVBvd2VyRXJyb3IgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLk5lZ2F0aXZlUG93ZXJFcnJvcikpIHsKICAgICAgICAgIHZhciBiID0gT2JqZWN0LmNyZWF0ZShTay5idWlsdGluLk5lZ2F0aXZlUG93ZXJFcnJvci5wcm90b3R5cGUpCiAgICAgICAgICBiLmNvbnN0cnVjdG9yLmFwcGx5KGIsIGFyZ3VtZW50cykKICAgICAgICAgIHJldHVybiBiCiAgICAgICAgfQogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiTmVnYXRpdmVQb3dlckVycm9yIiwKICAgICAgICBTay5idWlsdGluLk5lZ2F0aXZlUG93ZXJFcnJvciwKICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IsCiAgICAgICkKICAgICAgU2suZXhwb3J0U3ltYm9sKAogICAgICAgICJTay5idWlsdGluLk5lZ2F0aXZlUG93ZXJFcnJvciIsCiAgICAgICAgU2suYnVpbHRpbi5OZWdhdGl2ZVBvd2VyRXJyb3IsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5FeHRlcm5hbEVycm9yID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5FeHRlcm5hbEVycm9yKSkgewogICAgICAgICAgdmFyIGMgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uRXh0ZXJuYWxFcnJvci5wcm90b3R5cGUpCiAgICAgICAgICBjLmNvbnN0cnVjdG9yLmFwcGx5KGMsIGFyZ3VtZW50cykKICAgICAgICAgIHJldHVybiBjCiAgICAgICAgfQogICAgICAgIGIgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpCiAgICAgICAgdGhpcy5uYXRpdmVFcnJvciA9IGJbMF0KICAgICAgICBiWzBdIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zdHIgfHwgKGJbMF0gPSAiIiArIGJbMF0pCiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLmFwcGx5KHRoaXMsIGIpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiRXh0ZXJuYWxFcnJvciIsCiAgICAgICAgU2suYnVpbHRpbi5FeHRlcm5hbEVycm9yLAogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uRXh0ZXJuYWxFcnJvciIsIFNrLmJ1aWx0aW4uRXh0ZXJuYWxFcnJvcikKICAgICAgU2suYnVpbHRpbi5PcGVyYXRpb25FcnJvciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uT3BlcmF0aW9uRXJyb3IpKSB7CiAgICAgICAgICB2YXIgYiA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5PcGVyYXRpb25FcnJvci5wcm90b3R5cGUpCiAgICAgICAgICBiLmNvbnN0cnVjdG9yLmFwcGx5KGIsIGFyZ3VtZW50cykKICAgICAgICAgIHJldHVybiBiCiAgICAgICAgfQogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiT3BlcmF0aW9uRXJyb3IiLAogICAgICAgIFNrLmJ1aWx0aW4uT3BlcmF0aW9uRXJyb3IsCiAgICAgICAgU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yLAogICAgICApCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5PcGVyYXRpb25FcnJvciIsIFNrLmJ1aWx0aW4uT3BlcmF0aW9uRXJyb3IpCiAgICAgIFNrLmJ1aWx0aW4uU3lzdGVtRXJyb3IgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLlN5c3RlbUVycm9yKSkgewogICAgICAgICAgdmFyIGIgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uU3lzdGVtRXJyb3IucHJvdG90eXBlKQogICAgICAgICAgYi5jb25zdHJ1Y3Rvci5hcHBseShiLCBhcmd1bWVudHMpCiAgICAgICAgICByZXR1cm4gYgogICAgICAgIH0KICAgICAgICBTay5idWlsdGluLlN0YW5kYXJkRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIlN5c3RlbUVycm9yIiwKICAgICAgICBTay5idWlsdGluLlN5c3RlbUVycm9yLAogICAgICAgIFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uU3lzdGVtRXJyb3IiLCBTay5idWlsdGluLlN5c3RlbUVycm9yKQogICAgICBTay5idWlsdGluLlN0b3BJdGVyYXRpb24gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLlN0b3BJdGVyYXRpb24pKSB7CiAgICAgICAgICB2YXIgYiA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5TdG9wSXRlcmF0aW9uLnByb3RvdHlwZSkKICAgICAgICAgIGIuY29uc3RydWN0b3IuYXBwbHkoYiwgYXJndW1lbnRzKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICAgICAgU2suYnVpbHRpbi5FeGNlcHRpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIlN0b3BJdGVyYXRpb24iLAogICAgICAgIFNrLmJ1aWx0aW4uU3RvcEl0ZXJhdGlvbiwKICAgICAgICBTay5idWlsdGluLkV4Y2VwdGlvbiwKICAgICAgKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uU3RvcEl0ZXJhdGlvbiIsIFNrLmJ1aWx0aW4uU3RvcEl0ZXJhdGlvbikKICAgICAgU2suYnVpbHRpbi5nZXRFeGNJbmZvID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4udHVwbGUoWwogICAgICAgICAgYS5vYiR0eXBlIHx8IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCwKICAgICAgICAgIGEsCiAgICAgICAgICBTay5idWlsdGluLm5vbmUubm9uZSQsCiAgICAgICAgXSkKICAgICAgfQogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4ubWV0aG9kID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5tZXRob2QpKSB7CiAgICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJtZXRob2QiLCBhcmd1bWVudHMubGVuZ3RoLCAzLCAzKQogICAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrQ2FsbGFibGUoYSkpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiRmlyc3QgYXJndW1lbnQgbXVzdCBiZSBjYWxsYWJsZSIpCiAgICAgICAgICBpZiAodm9pZCAwID09PSBiLm9iJHR5cGUpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAiU2Vjb25kIGFyZ3VtZW50IG11c3QgYmUgb2JqZWN0IG9mIGtub3duIHR5cGUiLAogICAgICAgICAgICApCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubWV0aG9kKGEsIGIsIGMpCiAgICAgICAgfQogICAgICAgIHRoaXMudHAkbmFtZSA9IGEudHAkbmFtZQogICAgICAgIHRoaXMuaW1fZnVuYyA9IGEKICAgICAgICB0aGlzLmltX3NlbGYgPSBiIHx8IFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICAgIHRoaXMuaW1fY2xhc3MgPSBjIHx8IFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICAgIHRoaXMuaW1fYnVpbHRpbiA9IGQKICAgICAgICB0aGlzLiRkID0geyBpbV9mdW5jOiBhLCBpbV9zZWxmOiBiLCBpbV9jbGFzczogYyB9CiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLm1ldGhvZCIsIFNrLmJ1aWx0aW4ubWV0aG9kKQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJpbnN0YW5jZW1ldGhvZCIsCiAgICAgICAgU2suYnVpbHRpbi5tZXRob2QsCiAgICAgICAgU2suYnVpbHRpbi5vYmplY3QsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5tZXRob2QucHJvdG90eXBlLnRwJG5hbWUgPSAibWV0aG9kIgogICAgICBTay5idWlsdGluLm1ldGhvZC5wcm90b3R5cGUub2IkZXEgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICgKICAgICAgICAgICh0aGlzLmltX3NlbGYgPT0gU2suYnVpbHRpbi5ub25lLm5vbmUkICYmCiAgICAgICAgICAgIGEuaW1fc2VsZiAhPSBTay5idWlsdGluLm5vbmUubm9uZSQpIHx8CiAgICAgICAgICAoYS5pbV9zZWxmID09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCAmJgogICAgICAgICAgICB0aGlzLmltX3NlbGYgIT0gU2suYnVpbHRpbi5ub25lLm5vbmUkKQogICAgICAgICkKICAgICAgICAgIHJldHVybiAhMQogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2wodGhpcy5pbV9zZWxmLCBhLmltX3NlbGYsICJFcSIsICExKSAmJgogICAgICAgICAgICB0aGlzLmltX2Z1bmMgPT0gYS5pbV9mdW5jCiAgICAgICAgICApCiAgICAgICAgfSBjYXRjaCAoYikgewogICAgICAgICAgcmV0dXJuICExCiAgICAgICAgfQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubWV0aG9kLnByb3RvdHlwZS5vYiRuZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuICF0aGlzLm9iJGVxKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5tZXRob2QucHJvdG90eXBlLnRwJGhhc2ggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGEgPQogICAgICAgICAgdGhpcy5pbV9zZWxmID09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICAgICAgICA/IDAKICAgICAgICAgICAgOiBTay5idWlsdGluLmFzbnVtJChTay5idWlsdGluLmhhc2godGhpcy5pbV9zZWxmKSkKICAgICAgICB2YXIgYiA9IFNrLmJ1aWx0aW4uYXNudW0kKFNrLmJ1aWx0aW4uaGFzaCh0aGlzLmltX2Z1bmMpKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKGEgKyBiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubWV0aG9kLnByb3RvdHlwZS50cCRjYWxsID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB0aGlzLmltX3NlbGYgIT09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCAmJiBhLnVuc2hpZnQodGhpcy5pbV9zZWxmKQogICAgICAgIGlmICh0aGlzLmltX3NlbGYgPT09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCkgewogICAgICAgICAgdmFyIGMgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICJ1bmJvdW5kIG1ldGhvZCAiICsKICAgICAgICAgICAgICB0aGlzLnRwJG5hbWUgKwogICAgICAgICAgICAgICIoKSBtdXN0IGJlIGNhbGxlZCB3aXRoICIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKHRoaXMuaW1fY2xhc3MpICsKICAgICAgICAgICAgICAiIGluc3RhbmNlIGFzIGZpcnN0IGFyZ3VtZW50IChnb3QgIiArCiAgICAgICAgICAgICAgYSArCiAgICAgICAgICAgICAgIiBpbnN0ZWFkKSIKICAgICAgICAgICAgKQogICAgICAgICAgfS5iaW5kKHRoaXMpCiAgICAgICAgICBpZiAoMCA8IGEubGVuZ3RoKSB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICB0aGlzLmltX2NsYXNzICE9IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCAmJgogICAgICAgICAgICAgICFTay5idWlsdGluLmlzc3ViY2xhc3MoYVswXS5vYiR0eXBlLCB0aGlzLmltX2NsYXNzKSAmJgogICAgICAgICAgICAgICF0aGlzLmltX2J1aWx0aW4KICAgICAgICAgICAgKQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAgIGMoU2suYWJzdHIudHlwZU5hbWUoYVswXS5vYiR0eXBlKSArICIgaW5zdGFuY2UiKSwKICAgICAgICAgICAgICApCiAgICAgICAgICB9IGVsc2UgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKGMoIm5vdGhpbmciKSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuaW1fZnVuYy50cCRjYWxsKGEsIGIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5tZXRob2QucHJvdG90eXBlLnRwJGRlc2NyX2dldCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQodm9pZCAwICE9PSBhICYmIHZvaWQgMCAhPT0gYikKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubWV0aG9kKHRoaXMsIGEsIGIsIHRoaXMuaW1fYnVpbHRpbikKICAgICAgfQogICAgICBTay5idWlsdGluLm1ldGhvZC5weXRob25GdW5jdGlvbnMgPSBbIl9fZ2V0X18iXQogICAgICBTay5idWlsdGluLm1ldGhvZC5wcm90b3R5cGUuX19nZXRfXyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19nZXRfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDIsICExLCAhMCkKICAgICAgICBpZiAoYiA9PT0gU2suYnVpbHRpbi5ub25lLm5vbmUkICYmIGMgPT09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiX19nZXRfXyhOb25lLCBOb25lKSBpcyBpbnZhbGlkIikKICAgICAgICByZXR1cm4gYyAmJiBjICE9PSBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgICAgID8gU2suYnVpbHRpbi5pc3N1YmNsYXNzKGMsIGEuaW1fY2xhc3MpCiAgICAgICAgICAgID8gYS50cCRkZXNjcl9nZXQoYiwgYykKICAgICAgICAgICAgOiBhCiAgICAgICAgICA6IGEudHAkZGVzY3JfZ2V0KGIsIFNrLmJ1aWx0aW4ubm9uZS5ub25lJCkKICAgICAgfQogICAgICBTay5idWlsdGluLm1ldGhvZC5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHRoaXMuaW1fYnVpbHRpbikKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgICAgICI8YnVpbHQtaW4gbWV0aG9kICIgKyB0aGlzLnRwJG5hbWUgKyAiIG9mIHR5cGUgb2JqZWN0PiIsCiAgICAgICAgICApCiAgICAgICAgaWYgKHRoaXMuaW1fc2VsZiA9PT0gU2suYnVpbHRpbi5ub25lLm5vbmUkKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigKICAgICAgICAgICAgIjx1bmJvdW5kIG1ldGhvZCAiICsKICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZSh0aGlzLmltX2NsYXNzKSArCiAgICAgICAgICAgICAgIi4iICsKICAgICAgICAgICAgICB0aGlzLnRwJG5hbWUgKwogICAgICAgICAgICAgICI+IiwKICAgICAgICAgICkKICAgICAgICB2YXIgYSA9CiAgICAgICAgICB0aGlzLmltX2NsYXNzICE9PSBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgICAgICAgPyBTay5hYnN0ci50eXBlTmFtZSh0aGlzLmltX2NsYXNzKQogICAgICAgICAgICA6ICI/IgogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgICAiPGJvdW5kIG1ldGhvZCAiICsKICAgICAgICAgICAgYSArCiAgICAgICAgICAgICIuIiArCiAgICAgICAgICAgIHRoaXMudHAkbmFtZSArCiAgICAgICAgICAgICIgb2YgIiArCiAgICAgICAgICAgIFNrLmZmaS5yZW1hcFRvSnMoU2subWlzY2V2YWwub2JqZWN0UmVwcih0aGlzLmltX3NlbGYpKSArCiAgICAgICAgICAgICI+IiwKICAgICAgICApCiAgICAgIH0KICAgIH0sCiAgICBmdW5jdGlvbiAobSwgcCkgewogICAgICBTay5taXNjZXZhbCA9IHt9CiAgICAgIFNrLm1pc2NldmFsLlN1c3BlbnNpb24gPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIHRoaXMuJGlzU3VzcGVuc2lvbiA9ICEwCiAgICAgICAgdm9pZCAwICE9PSBhICYmCiAgICAgICAgICB2b2lkIDAgIT09IGIgJiYKICAgICAgICAgICh0aGlzLnJlc3VtZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGEoYi5yZXN1bWUoKSkKICAgICAgICAgIH0pCiAgICAgICAgdGhpcy5jaGlsZCA9IGIKICAgICAgICB0aGlzLm9wdGlvbmFsID0gdm9pZCAwICE9PSBiICYmIGIub3B0aW9uYWwKICAgICAgICB0aGlzLmRhdGEgPSB2b2lkIDAgPT09IGMgJiYgdm9pZCAwICE9PSBiID8gYi5kYXRhIDogYwogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2subWlzY2V2YWwuU3VzcGVuc2lvbiIsIFNrLm1pc2NldmFsLlN1c3BlbnNpb24pCiAgICAgIFNrLm1pc2NldmFsLnJldHJ5T3B0aW9uYWxTdXNwZW5zaW9uT3JUaHJvdyA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgZm9yICg7IGEgaW5zdGFuY2VvZiBTay5taXNjZXZhbC5TdXNwZW5zaW9uOyApIHsKICAgICAgICAgIGlmICghYS5vcHRpb25hbCkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3VzcGVuc2lvbkVycm9yKAogICAgICAgICAgICAgIGIgfHwgIkNhbm5vdCBjYWxsIGEgZnVuY3Rpb24gdGhhdCBibG9ja3Mgb3Igc3VzcGVuZHMgaGVyZSIsCiAgICAgICAgICAgICkKICAgICAgICAgIGEgPSBhLnJlc3VtZSgpCiAgICAgICAgfQogICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKAogICAgICAgICJTay5taXNjZXZhbC5yZXRyeU9wdGlvbmFsU3VzcGVuc2lvbk9yVGhyb3ciLAogICAgICAgIFNrLm1pc2NldmFsLnJldHJ5T3B0aW9uYWxTdXNwZW5zaW9uT3JUaHJvdywKICAgICAgKQogICAgICBTay5taXNjZXZhbC5pc0luZGV4ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5jaGVja0ludChhKSB8fAogICAgICAgICAgU2suYWJzdHIubG9va3VwU3BlY2lhbChhLCBTay5idWlsdGluLnN0ci4kaW5kZXgpCiAgICAgICAgICA/ICEwCiAgICAgICAgICA6ICExCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5taXNjZXZhbC5pc0luZGV4IiwgU2subWlzY2V2YWwuaXNJbmRleCkKICAgICAgU2subWlzY2V2YWwuYXNJbmRleCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBpZiAoU2subWlzY2V2YWwuaXNJbmRleChhKSAmJiBudWxsICE9PSBhKSB7CiAgICAgICAgICBpZiAoITAgPT09IGEpIHJldHVybiAxCiAgICAgICAgICBpZiAoITEgPT09IGEpIHJldHVybiAwCiAgICAgICAgICBpZiAoIm51bWJlciIgPT09IHR5cGVvZiBhKSByZXR1cm4gYQogICAgICAgICAgaWYgKGEuY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4uaW50XykgcmV0dXJuIGEudgogICAgICAgICAgaWYgKGEuY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4ubG5nKSByZXR1cm4gYS50cCRpbmRleCgpCiAgICAgICAgICBpZiAoYS5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5ib29sKSByZXR1cm4gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICAgIGlmICgoYiA9IFNrLmFic3RyLmxvb2t1cFNwZWNpYWwoYSwgU2suYnVpbHRpbi5zdHIuJGluZGV4KSkpIHsKICAgICAgICAgICAgYSA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShiLCBbYV0pCiAgICAgICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0ludChhKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgICAiX19pbmRleF9fIHJldHVybmVkIG5vbi0oaW50LGxvbmcpICh0eXBlICIgKwogICAgICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShhKSArCiAgICAgICAgICAgICAgICAgICIpIiwKICAgICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiBTay5idWlsdGluLmFzbnVtJChhKQogICAgICAgICAgfQogICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJ0b2RvIGFzSW5kZXg7IikKICAgICAgICB9CiAgICAgIH0KICAgICAgU2subWlzY2V2YWwuYXBwbHlTbGljZSA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7CiAgICAgICAgcmV0dXJuIGEuc3Ekc2xpY2UgJiYgU2subWlzY2V2YWwuaXNJbmRleChiKSAmJiBTay5taXNjZXZhbC5pc0luZGV4KGMpCiAgICAgICAgICA/ICgoYiA9IFNrLm1pc2NldmFsLmFzSW5kZXgoYikpLAogICAgICAgICAgICB2b2lkIDAgPT09IGIgJiYgKGIgPSAwKSwKICAgICAgICAgICAgKGMgPSBTay5taXNjZXZhbC5hc0luZGV4KGMpKSwKICAgICAgICAgICAgdm9pZCAwID09PSBjICYmIChjID0gMWUxMDApLAogICAgICAgICAgICBTay5hYnN0ci5zZXF1ZW5jZUdldFNsaWNlKGEsIGIsIGMpKQogICAgICAgICAgOiBTay5hYnN0ci5vYmplY3RHZXRJdGVtKGEsIG5ldyBTay5idWlsdGluLnNsaWNlKGIsIGMsIG51bGwpLCBkKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2subWlzY2V2YWwuYXBwbHlTbGljZSIsIFNrLm1pc2NldmFsLmFwcGx5U2xpY2UpCiAgICAgIFNrLm1pc2NldmFsLmFzc2lnblNsaWNlID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICBpZiAoYS5zcSRhc3Nfc2xpY2UgJiYgU2subWlzY2V2YWwuaXNJbmRleChiKSAmJiBTay5taXNjZXZhbC5pc0luZGV4KGMpKQogICAgICAgICAgKGUgPSBTay5taXNjZXZhbC5hc0luZGV4KGIpIHx8IDApLAogICAgICAgICAgICAoYyA9IFNrLm1pc2NldmFsLmFzSW5kZXgoYykgfHwgMWUxMDApLAogICAgICAgICAgICBudWxsID09PSBkCiAgICAgICAgICAgICAgPyBTay5hYnN0ci5zZXF1ZW5jZURlbFNsaWNlKGEsIGUsIGMpCiAgICAgICAgICAgICAgOiBTay5hYnN0ci5zZXF1ZW5jZVNldFNsaWNlKGEsIGUsIGMsIGQpCiAgICAgICAgZWxzZQogICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgKGMgPSBuZXcgU2suYnVpbHRpbi5zbGljZShiLCBjKSksCiAgICAgICAgICAgIG51bGwgPT09IGQKICAgICAgICAgICAgICA/IFNrLmFic3RyLm9iamVjdERlbEl0ZW0oYSwgYykKICAgICAgICAgICAgICA6IFNrLmFic3RyLm9iamVjdFNldEl0ZW0oYSwgYywgZCwgZSkKICAgICAgICAgICkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLm1pc2NldmFsLmFzc2lnblNsaWNlIiwgU2subWlzY2V2YWwuYXNzaWduU2xpY2UpCiAgICAgIFNrLm1pc2NldmFsLmFycmF5RnJvbUFyZ3VtZW50cyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBpZiAoMSAhPSBhLmxlbmd0aCkgcmV0dXJuIGEKICAgICAgICB2YXIgYyA9IGFbMF0KICAgICAgICBjIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zZXQKICAgICAgICAgID8gKGMgPSBjLnRwJGl0ZXIoKS4kb2JqKQogICAgICAgICAgOiBjIGluc3RhbmNlb2YgU2suYnVpbHRpbi5kaWN0ICYmCiAgICAgICAgICAgIChjID0gU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5rZXlzLmZ1bmNfY29kZShjKSkKICAgICAgICBpZiAoYyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubGlzdCB8fCBjIGluc3RhbmNlb2YgU2suYnVpbHRpbi50dXBsZSkKICAgICAgICAgIHJldHVybiBjLnYKICAgICAgICBpZiAoU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGMpKSB7CiAgICAgICAgICBhID0gW10KICAgICAgICAgIGMgPSBTay5hYnN0ci5pdGVyKGMpCiAgICAgICAgICBmb3IgKGIgPSBjLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gYjsgYiA9IGMudHAkaXRlcm5leHQoKSkgYS5wdXNoKGIpCiAgICAgICAgICByZXR1cm4gYQogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAiJyIgKyBTay5hYnN0ci50eXBlTmFtZShjKSArICInIG9iamVjdCBpcyBub3QgaXRlcmFibGUiLAogICAgICAgICkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woCiAgICAgICAgIlNrLm1pc2NldmFsLmFycmF5RnJvbUFyZ3VtZW50cyIsCiAgICAgICAgU2subWlzY2V2YWwuYXJyYXlGcm9tQXJndW1lbnRzLAogICAgICApCiAgICAgIFNrLm1pc2NldmFsLnN3YXBwZWRPcF8gPSB7CiAgICAgICAgRXE6ICJFcSIsCiAgICAgICAgTm90RXE6ICJOb3RFcSIsCiAgICAgICAgTHQ6ICJHdEUiLAogICAgICAgIEx0RTogIkd0IiwKICAgICAgICBHdDogIkx0RSIsCiAgICAgICAgR3RFOiAiTHQiLAogICAgICAgIElzOiAiSXNOb3QiLAogICAgICAgIElzTm90OiAiSXMiLAogICAgICAgIEluXzogIk5vdEluIiwKICAgICAgICBOb3RJbjogIkluXyIsCiAgICAgIH0KICAgICAgU2subWlzY2V2YWwub3BTeW1ib2xzID0gewogICAgICAgIEVxOiAiPT0iLAogICAgICAgIE5vdEVxOiAiIT0iLAogICAgICAgIEx0OiAiPCIsCiAgICAgICAgTHRFOiAiPD0iLAogICAgICAgIEd0OiAiPiIsCiAgICAgICAgR3RFOiAiPj0iLAogICAgICAgIElzOiAiaXMiLAogICAgICAgIElzTm90OiAiaXMgbm90IiwKICAgICAgICBJbl86ICJpbiIsCiAgICAgICAgTm90SW46ICJub3QgaW4iLAogICAgICB9CiAgICAgIFNrLm1pc2NldmFsLnJpY2hDb21wYXJlQm9vbCA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7CiAgICAgICAgdmFyIGUKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgKICAgICAgICAgIG51bGwgIT09IGEgJiYgdm9pZCAwICE9PSBhLAogICAgICAgICAgInBhc3NlZCBudWxsIG9yIHVuZGVmaW5lZCBwYXJhbWV0ZXIgdG8gU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sIiwKICAgICAgICApCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoCiAgICAgICAgICBudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYiwKICAgICAgICAgICJwYXNzZWQgbnVsbCBvciB1bmRlZmluZWQgcGFyYW1ldGVyIHRvIFNrLm1pc2NldmFsLnJpY2hDb21wYXJlQm9vbCIsCiAgICAgICAgKQogICAgICAgIHZhciBmID0gbmV3IFNrLmJ1aWx0aW4udHlwZShhKQogICAgICAgIHZhciBnID0gbmV3IFNrLmJ1aWx0aW4udHlwZShiKQogICAgICAgIGlmICgKICAgICAgICAgICFTay5fX2Z1dHVyZV9fLnB5dGhvbjMgJiYKICAgICAgICAgIGYgIT09IGcgJiYKICAgICAgICAgICgiR3RFIiA9PT0gYyB8fCAiR3QiID09PSBjIHx8ICJMdEUiID09PSBjIHx8ICJMdCIgPT09IGMpCiAgICAgICAgKSB7CiAgICAgICAgICB2YXIgaCA9IFsKICAgICAgICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm9iJHR5cGUsCiAgICAgICAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUub2IkdHlwZSwKICAgICAgICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm9iJHR5cGUsCiAgICAgICAgICAgIFNrLmJ1aWx0aW4uYm9vbC5wcm90b3R5cGUub2IkdHlwZSwKICAgICAgICAgIF0KICAgICAgICAgIHZhciBrID0gWwogICAgICAgICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLm9iJHR5cGUsCiAgICAgICAgICAgIFNrLmJ1aWx0aW4uZW51bWVyYXRlLnByb3RvdHlwZS5vYiR0eXBlLAogICAgICAgICAgICBTay5idWlsdGluLmZpbHRlcl8ucHJvdG90eXBlLm9iJHR5cGUsCiAgICAgICAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUub2IkdHlwZSwKICAgICAgICAgICAgU2suYnVpbHRpbi5tYXBfLnByb3RvdHlwZS5vYiR0eXBlLAogICAgICAgICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUub2IkdHlwZSwKICAgICAgICAgICAgU2suYnVpbHRpbi50dXBsZS5wcm90b3R5cGUub2IkdHlwZSwKICAgICAgICAgICAgU2suYnVpbHRpbi56aXBfLnByb3RvdHlwZS5vYiR0eXBlLAogICAgICAgICAgXQogICAgICAgICAgdmFyIGwgPSBoLmluZGV4T2YoZikKICAgICAgICAgIHZhciByID0gay5pbmRleE9mKGYpCiAgICAgICAgICBoID0gaC5pbmRleE9mKGcpCiAgICAgICAgICBrID0gay5pbmRleE9mKGcpCiAgICAgICAgICBpZiAoZiA9PT0gU2suYnVpbHRpbi5ub25lLnByb3RvdHlwZS5vYiR0eXBlKQogICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICBjYXNlICJMdCI6CiAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICBjYXNlICJMdEUiOgogICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgY2FzZSAiR3QiOgogICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgY2FzZSAiR3RFIjoKICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICB9CiAgICAgICAgICBpZiAoZyA9PT0gU2suYnVpbHRpbi5ub25lLnByb3RvdHlwZS5vYiR0eXBlKQogICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICBjYXNlICJMdCI6CiAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgICBjYXNlICJMdEUiOgogICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgY2FzZSAiR3QiOgogICAgICAgICAgICAgICAgcmV0dXJuICEwCiAgICAgICAgICAgICAgY2FzZSAiR3RFIjoKICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICB9CiAgICAgICAgICBpZiAoLTEgIT09IGwgJiYgLTEgIT09IGspCiAgICAgICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgICAgIGNhc2UgIkx0IjoKICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgIGNhc2UgIkx0RSI6CiAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgICBjYXNlICJHdCI6CiAgICAgICAgICAgICAgICByZXR1cm4gITEKICAgICAgICAgICAgICBjYXNlICJHdEUiOgogICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgIH0KICAgICAgICAgIGlmICgtMSAhPT0gciAmJiAtMSAhPT0gaCkKICAgICAgICAgICAgc3dpdGNoIChjKSB7CiAgICAgICAgICAgICAgY2FzZSAiTHQiOgogICAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgICAgY2FzZSAiTHRFIjoKICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICAgIGNhc2UgIkd0IjoKICAgICAgICAgICAgICAgIHJldHVybiAhMAogICAgICAgICAgICAgIGNhc2UgIkd0RSI6CiAgICAgICAgICAgICAgICByZXR1cm4gITAKICAgICAgICAgICAgfQogICAgICAgICAgaWYgKC0xICE9PSByICYmIC0xICE9PSBrKQogICAgICAgICAgICBzd2l0Y2ggKGMpIHsKICAgICAgICAgICAgICBjYXNlICJMdCI6CiAgICAgICAgICAgICAgICByZXR1cm4gciA8IGsKICAgICAgICAgICAgICBjYXNlICJMdEUiOgogICAgICAgICAgICAgICAgcmV0dXJuIHIgPD0gawogICAgICAgICAgICAgIGNhc2UgIkd0IjoKICAgICAgICAgICAgICAgIHJldHVybiByID4gawogICAgICAgICAgICAgIGNhc2UgIkd0RSI6CiAgICAgICAgICAgICAgICByZXR1cm4gciA+PSBrCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCJJcyIgPT09IGMpCiAgICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyAmJiBiIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfCiAgICAgICAgICAgID8gMCA9PT0gYS5udW1iZXJDb21wYXJlKGIpCiAgICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfICYmIGIgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgICA/IDAgPT09IGEubnVtYmVyQ29tcGFyZShiKQogICAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyAmJiBiIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgICAgPyAwID09PSBhLmxvbmdDb21wYXJlKGIpCiAgICAgICAgICAgIDogYSA9PT0gYgogICAgICAgIGlmICgiSXNOb3QiID09PSBjKQogICAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYgYiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XwogICAgICAgICAgICA/IDAgIT09IGEubnVtYmVyQ29tcGFyZShiKQogICAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XyAmJiBiIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgICAgPyAwICE9PSBhLm51bWJlckNvbXBhcmUoYikKICAgICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgJiYgYiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICAgID8gMCAhPT0gYS5sb25nQ29tcGFyZShiKQogICAgICAgICAgICA6IGEgIT09IGIKICAgICAgICBpZiAoIkluIiA9PT0gYykKICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jaGFpbigKICAgICAgICAgICAgU2suYWJzdHIuc2VxdWVuY2VDb250YWlucyhiLCBhLCBkKSwKICAgICAgICAgICAgU2subWlzY2V2YWwuaXNUcnVlLAogICAgICAgICAgKQogICAgICAgIGlmICgiTm90SW4iID09PSBjKQogICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmNoYWluKAogICAgICAgICAgICBTay5hYnN0ci5zZXF1ZW5jZUNvbnRhaW5zKGIsIGEsIGQpLAogICAgICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgIHJldHVybiAhU2subWlzY2V2YWwuaXNUcnVlKGEpCiAgICAgICAgICAgIH0sCiAgICAgICAgICApCiAgICAgICAgbCA9IHsKICAgICAgICAgIEVxOiAib2IkZXEiLAogICAgICAgICAgTm90RXE6ICJvYiRuZSIsCiAgICAgICAgICBHdDogIm9iJGd0IiwKICAgICAgICAgIEd0RTogIm9iJGdlIiwKICAgICAgICAgIEx0OiAib2IkbHQiLAogICAgICAgICAgTHRFOiAib2IkbGUiLAogICAgICAgIH0KICAgICAgICByID0gbFtjXQogICAgICAgIGlmICgKICAgICAgICAgIChkID0gYS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkocikpICYmCiAgICAgICAgICAoZSA9IGFbcl0oYikpICE9PSBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICAgICkKICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5pc1RydWUoZSkKICAgICAgICBsID0gbFtTay5taXNjZXZhbC5zd2FwcGVkT3BfW2NdXQogICAgICAgIGlmICgKICAgICAgICAgIChyID0gYi5jb25zdHJ1Y3Rvci5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkobCkpICYmCiAgICAgICAgICAoZSA9IGJbbF0oYSkpICE9PSBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICAgICkKICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5pc1RydWUoZSkKICAgICAgICBpZiAoCiAgICAgICAgICAoYS50cCRyaWNoY29tcGFyZSAmJgogICAgICAgICAgICB2b2lkIDAgIT09IChlID0gYS50cCRyaWNoY29tcGFyZShiLCBjKSkgJiYKICAgICAgICAgICAgZSAhPSBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJCkgfHwKICAgICAgICAgIChiLnRwJHJpY2hjb21wYXJlICYmCiAgICAgICAgICAgIHZvaWQgMCAhPT0gKGUgPSBiLnRwJHJpY2hjb21wYXJlKGEsIFNrLm1pc2NldmFsLnN3YXBwZWRPcF9bY10pKSAmJgogICAgICAgICAgICBlICE9IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkKQogICAgICAgICkKICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5pc1RydWUoZSkKICAgICAgICBpZiAoCiAgICAgICAgICAoKGwgPSBTay5hYnN0ci5sb29rdXBTcGVjaWFsKGEsIFNrLm1pc2NldmFsLm9wMm1ldGhvZF9bY10pKSAmJgogICAgICAgICAgICAhZCAmJgogICAgICAgICAgICAoKGUgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkobCwgW2EsIGJdKSksCiAgICAgICAgICAgIGUgIT0gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQpKSB8fAogICAgICAgICAgKChkID0gU2suYWJzdHIubG9va3VwU3BlY2lhbCgKICAgICAgICAgICAgYiwKICAgICAgICAgICAgU2subWlzY2V2YWwub3AybWV0aG9kX1tTay5taXNjZXZhbC5zd2FwcGVkT3BfW2NdXSwKICAgICAgICAgICkpICYmCiAgICAgICAgICAgICFyICYmCiAgICAgICAgICAgICgoZSA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShkLCBbYiwgYV0pKSwKICAgICAgICAgICAgZSAhPSBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJCkpCiAgICAgICAgKQogICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmlzVHJ1ZShlKQogICAgICAgIGlmICghU2suX19mdXR1cmVfXy5weXRob24zKSB7CiAgICAgICAgICBpZiAoKGQgPSBTay5hYnN0ci5sb29rdXBTcGVjaWFsKGEsIFNrLmJ1aWx0aW4uc3RyLiRjbXApKSkKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBlID0gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGQsIFthLCBiXSkKICAgICAgICAgICAgICBpZiAoU2suYnVpbHRpbi5jaGVja051bWJlcihlKSkgewogICAgICAgICAgICAgICAgZSA9IFNrLmJ1aWx0aW4uYXNudW0kKGUpCiAgICAgICAgICAgICAgICBpZiAoIkVxIiA9PT0gYykgcmV0dXJuIDAgPT09IGUKICAgICAgICAgICAgICAgIGlmICgiTm90RXEiID09PSBjKSByZXR1cm4gMCAhPT0gZQogICAgICAgICAgICAgICAgaWYgKCJMdCIgPT09IGMpIHJldHVybiAwID4gZQogICAgICAgICAgICAgICAgaWYgKCJHdCIgPT09IGMpIHJldHVybiAwIDwgZQogICAgICAgICAgICAgICAgaWYgKCJMdEUiID09PSBjKSByZXR1cm4gMCA+PSBlCiAgICAgICAgICAgICAgICBpZiAoIkd0RSIgPT09IGMpIHJldHVybiAwIDw9IGUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGUgIT09IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICAgICAiY29tcGFyaXNvbiBkaWQgbm90IHJldHVybiBhbiBpbnQiLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB9IGNhdGNoIChuKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJjb21wYXJpc29uIGRpZCBub3QgcmV0dXJuIGFuIGludCIpCiAgICAgICAgICAgIH0KICAgICAgICAgIGlmICgoZCA9IFNrLmFic3RyLmxvb2t1cFNwZWNpYWwoYiwgU2suYnVpbHRpbi5zdHIuJGNtcCkpKQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGUgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoZCwgW2IsIGFdKQogICAgICAgICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrTnVtYmVyKGUpKSB7CiAgICAgICAgICAgICAgICBlID0gU2suYnVpbHRpbi5hc251bSQoZSkKICAgICAgICAgICAgICAgIGlmICgiRXEiID09PSBjKSByZXR1cm4gMCA9PT0gZQogICAgICAgICAgICAgICAgaWYgKCJOb3RFcSIgPT09IGMpIHJldHVybiAwICE9PSBlCiAgICAgICAgICAgICAgICBpZiAoIkx0IiA9PT0gYykgcmV0dXJuIDAgPCBlCiAgICAgICAgICAgICAgICBpZiAoIkd0IiA9PT0gYykgcmV0dXJuIDAgPiBlCiAgICAgICAgICAgICAgICBpZiAoIkx0RSIgPT09IGMpIHJldHVybiAwIDw9IGUKICAgICAgICAgICAgICAgIGlmICgiR3RFIiA9PT0gYykgcmV0dXJuIDAgPj0gZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoZSAhPT0gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgICAgICJjb21wYXJpc29uIGRpZCBub3QgcmV0dXJuIGFuIGludCIsCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIH0gY2F0Y2ggKG4pIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImNvbXBhcmlzb24gZGlkIG5vdCByZXR1cm4gYW4gaW50IikKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoCiAgICAgICAgICAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubm9uZSAmJiBiIGluc3RhbmNlb2YgU2suYnVpbHRpbi5ub25lKSB8fAogICAgICAgICAgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmJvb2wgJiYgYiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYm9vbCkKICAgICAgICApIHsKICAgICAgICAgIGlmICgiRXEiID09PSBjKSByZXR1cm4gYS52ID09PSBiLnYKICAgICAgICAgIGlmICgiTm90RXEiID09PSBjKSByZXR1cm4gYS52ICE9PSBiLnYKICAgICAgICAgIGlmICgiR3QiID09PSBjKSByZXR1cm4gYS52ID4gYi52CiAgICAgICAgICBpZiAoIkd0RSIgPT09IGMpIHJldHVybiBhLnYgPj0gYi52CiAgICAgICAgICBpZiAoIkx0IiA9PT0gYykgcmV0dXJuIGEudiA8IGIudgogICAgICAgICAgaWYgKCJMdEUiID09PSBjKSByZXR1cm4gYS52IDw9IGIudgogICAgICAgIH0KICAgICAgICBpZiAoIkVxIiA9PT0gYykKICAgICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zdHIgJiYgYiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uc3RyCiAgICAgICAgICAgID8gYS52ID09PSBiLnYKICAgICAgICAgICAgOiBhID09PSBiCiAgICAgICAgaWYgKCJOb3RFcSIgPT09IGMpCiAgICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uc3RyICYmIGIgaW5zdGFuY2VvZiBTay5idWlsdGluLnN0cgogICAgICAgICAgICA/IGEudiAhPT0gYi52CiAgICAgICAgICAgIDogYSAhPT0gYgogICAgICAgIGEgPSBTay5hYnN0ci50eXBlTmFtZShhKQogICAgICAgIGIgPSBTay5hYnN0ci50eXBlTmFtZShiKQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICInIiArCiAgICAgICAgICAgIFNrLm1pc2NldmFsLm9wU3ltYm9sc1tjXSArCiAgICAgICAgICAgICInIG5vdCBzdXBwb3J0ZWQgYmV0d2VlbiBpbnN0YW5jZXMgb2YgJyIgKwogICAgICAgICAgICBhICsKICAgICAgICAgICAgIicgYW5kICciICsKICAgICAgICAgICAgYiArCiAgICAgICAgICAgICInIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKAogICAgICAgICJTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2wiLAogICAgICAgIFNrLm1pc2NldmFsLnJpY2hDb21wYXJlQm9vbCwKICAgICAgKQogICAgICBTay5taXNjZXZhbC5vYmplY3RSZXByID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCh2b2lkIDAgIT09IGEsICJ0cnlpbmcgdG8gcmVwciB1bmRlZmluZWQiKQogICAgICAgIHJldHVybiBudWxsID09PSBhIHx8IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLm5vbmUKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uc3RyKCJOb25lIikKICAgICAgICAgIDogITAgPT09IGEKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uc3RyKCJUcnVlIikKICAgICAgICAgIDogITEgPT09IGEKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uc3RyKCJGYWxzZSIpCiAgICAgICAgICA6ICJudW1iZXIiID09PSB0eXBlb2YgYQogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5zdHIoIiIgKyBhKQogICAgICAgICAgOiAic3RyaW5nIiA9PT0gdHlwZW9mIGEKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uc3RyKGEpCiAgICAgICAgICA6IGEuJHIKICAgICAgICAgID8gYS5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgICAgPyBJbmZpbml0eSA9PT0gYS52CiAgICAgICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5zdHIoImluZiIpCiAgICAgICAgICAgICAgOiAtSW5maW5pdHkgPT09IGEudgogICAgICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uc3RyKCItaW5mIikKICAgICAgICAgICAgICA6IGEuJHIoKQogICAgICAgICAgICA6IGEuJHIoKQogICAgICAgICAgOiBhLnRwJG5hbWUKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uc3RyKCI8IiArIGEudHAkbmFtZSArICIgb2JqZWN0PiIpCiAgICAgICAgICA6IG5ldyBTay5idWlsdGluLnN0cigiPHVua25vd24+IikKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLm1pc2NldmFsLm9iamVjdFJlcHIiLCBTay5taXNjZXZhbC5vYmplY3RSZXByKQogICAgICBTay5taXNjZXZhbC5vcEFsbG93c0VxdWFsaXR5ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBzd2l0Y2ggKGEpIHsKICAgICAgICAgIGNhc2UgIkx0RSI6CiAgICAgICAgICBjYXNlICJFcSI6CiAgICAgICAgICBjYXNlICJHdEUiOgogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9CiAgICAgICAgcmV0dXJuICExCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKAogICAgICAgICJTay5taXNjZXZhbC5vcEFsbG93c0VxdWFsaXR5IiwKICAgICAgICBTay5taXNjZXZhbC5vcEFsbG93c0VxdWFsaXR5LAogICAgICApCiAgICAgIFNrLm1pc2NldmFsLmlzVHJ1ZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKCEwID09PSBhKSByZXR1cm4gITAKICAgICAgICBpZiAoCiAgICAgICAgICAhMSA9PT0gYSB8fAogICAgICAgICAgbnVsbCA9PT0gYSB8fAogICAgICAgICAgYS5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5ub25lIHx8CiAgICAgICAgICBhLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLk5vdEltcGxlbWVudGVkCiAgICAgICAgKQogICAgICAgICAgcmV0dXJuICExCiAgICAgICAgaWYgKGEuY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4uYm9vbCkgcmV0dXJuIGEudgogICAgICAgIGlmICgibnVtYmVyIiA9PT0gdHlwZW9mIGEpIHJldHVybiAwICE9PSBhCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykgcmV0dXJuIGEubmIkbm9uemVybygpCiAgICAgICAgaWYgKAogICAgICAgICAgYS5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICBhLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLmZsb2F0XwogICAgICAgICkKICAgICAgICAgIHJldHVybiAwICE9PSBhLnYKICAgICAgICBpZiAoU2suX19mdXR1cmVfXy5weXRob24zKSB7CiAgICAgICAgICBpZiAoYS5fX2Jvb2xfXykgewogICAgICAgICAgICBhID0gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGEuX19ib29sX18sIFthXSkKICAgICAgICAgICAgaWYgKCEoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYm9vbCkpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICAgIl9fYm9vbF9fIHNob3VsZCByZXR1cm4gYm9vbCwgcmV0dXJuZWQgIiArIFNrLmFic3RyLnR5cGVOYW1lKGEpLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIGEudgogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoYS5fX25vbnplcm9fXykgewogICAgICAgICAgYSA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShhLl9fbm9uemVyb19fLCBbYV0pCiAgICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tJbnQoYSkpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiX19ub256ZXJvX18gc2hvdWxkIHJldHVybiBhbiBpbnQiKQogICAgICAgICAgcmV0dXJuIDAgIT09IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgfQogICAgICAgIGlmIChhLl9fbGVuX18pIHsKICAgICAgICAgIGEgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYS5fX2xlbl9fLCBbYV0pCiAgICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tJbnQoYSkpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiX19sZW5fXyBzaG91bGQgcmV0dXJuIGFuIGludCIpCiAgICAgICAgICByZXR1cm4gMCAhPT0gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEubXAkbGVuZ3RoCiAgICAgICAgICA/IDAgIT09IFNrLmJ1aWx0aW4uYXNudW0kKGEubXAkbGVuZ3RoKCkpCiAgICAgICAgICA6IGEuc3EkbGVuZ3RoCiAgICAgICAgICA/IDAgIT09IFNrLmJ1aWx0aW4uYXNudW0kKGEuc3EkbGVuZ3RoKCkpCiAgICAgICAgICA6ICEwCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5taXNjZXZhbC5pc1RydWUiLCBTay5taXNjZXZhbC5pc1RydWUpCiAgICAgIFNrLm1pc2NldmFsLnNvZnRzcGFjZV8gPSAhMQogICAgICBTay5taXNjZXZhbC5wcmludF8gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLm1pc2NldmFsLnNvZnRzcGFjZV8gJiYKICAgICAgICAgICgiXG4iICE9PSBhICYmIFNrLm91dHB1dCgiICIpLCAoU2subWlzY2V2YWwuc29mdHNwYWNlXyA9ICExKSkKICAgICAgICB2YXIgYiA9IG5ldyBTay5idWlsdGluLnN0cihhKQogICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jaGFpbigKICAgICAgICAgIFNrLmltcG9ydE1vZHVsZSgic3lzIiwgITEsICEwKSwKICAgICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5hcHBseSgKICAgICAgICAgICAgICBhLiRkLnN0ZG91dC53cml0ZSwKICAgICAgICAgICAgICB2b2lkIDAsCiAgICAgICAgICAgICAgdm9pZCAwLAogICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgICBbYS4kZC5zdGRvdXQsIGJdLAogICAgICAgICAgICApCiAgICAgICAgICB9LAogICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgYQogICAgICAgICAgICA7KGEgPSAwID09PSBiLnYubGVuZ3RoKSB8fAogICAgICAgICAgICAgICgoYSA9IGIudltiLnYubGVuZ3RoIC0gMV0pLAogICAgICAgICAgICAgIChhID0gISgiXG4iID09PSBhIHx8ICJcdCIgPT09IGEgfHwgIlxyIiA9PT0gYSkpKQogICAgICAgICAgICBpZiAoYSB8fCAiICIgPT09IGIudltiLnYubGVuZ3RoIC0gMV0pIFNrLm1pc2NldmFsLnNvZnRzcGFjZV8gPSAhMAogICAgICAgICAgfSwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5taXNjZXZhbC5wcmludF8iLCBTay5taXNjZXZhbC5wcmludF8pCiAgICAgIFNrLm1pc2NldmFsLmxvYWRuYW1lID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBiID0gYlthXQogICAgICAgIGlmICh2b2lkIDAgIT09IGIpCiAgICAgICAgICByZXR1cm4gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIgJiYKICAgICAgICAgICAgdm9pZCAwID09PSBiLiRkICYmCiAgICAgICAgICAgIHZvaWQgMCA9PT0gYi50cCRuYW1lCiAgICAgICAgICAgID8gYigpCiAgICAgICAgICAgIDogYgogICAgICAgIGIgPSBTay5idWlsdGluc1thXQogICAgICAgIGlmICh2b2lkIDAgIT09IGIpIHJldHVybiBiCiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTmFtZUVycm9yKAogICAgICAgICAgIm5hbWUgJyIgKyBTay51bmZpeFJlc2VydmVkKGEpICsgIicgaXMgbm90IGRlZmluZWQiLAogICAgICAgICkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLm1pc2NldmFsLmxvYWRuYW1lIiwgU2subWlzY2V2YWwubG9hZG5hbWUpCiAgICAgIFNrLm1pc2NldmFsLmNhbGwgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSkgewogICAgICAgIGUgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDQpCiAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmFwcGx5KGEsIGIsIGMsIGQsIGUpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5taXNjZXZhbC5jYWxsIiwgU2subWlzY2V2YWwuY2FsbCkKICAgICAgU2subWlzY2V2YWwuY2FsbEFzeW5jID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUsIGYpIHsKICAgICAgICBmID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCA1KQogICAgICAgIHJldHVybiBTay5taXNjZXZhbC5hcHBseUFzeW5jKGEsIGIsIGMsIGQsIGUsIGYpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5taXNjZXZhbC5jYWxsQXN5bmMiLCBTay5taXNjZXZhbC5jYWxsQXN5bmMpCiAgICAgIFNrLm1pc2NldmFsLmNhbGxPclN1c3BlbmQgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSkgewogICAgICAgIGUgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDQpCiAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmFwcGx5T3JTdXNwZW5kKGEsIGIsIGMsIGQsIGUpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5taXNjZXZhbC5jYWxsT3JTdXNwZW5kIiwgU2subWlzY2V2YWwuY2FsbE9yU3VzcGVuZCkKICAgICAgU2subWlzY2V2YWwuY2FsbHNpbSA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgYiA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSkKICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuYXBwbHkoYSwgdm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgYikKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLm1pc2NldmFsLmNhbGxzaW0iLCBTay5taXNjZXZhbC5jYWxsc2ltKQogICAgICBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBTay5taXNjZXZhbC5hcHBseShhLCB2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBiID8gYiA6IFtdKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2subWlzY2V2YWwuY2FsbHNpbUFycmF5IiwgU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KQogICAgICBTay5taXNjZXZhbC5jYWxsc2ltQXN5bmMgPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIGMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpCiAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmFwcGx5QXN5bmMoYSwgYiwgdm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgYykKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLm1pc2NldmFsLmNhbGxzaW1Bc3luYyIsIFNrLm1pc2NldmFsLmNhbGxzaW1Bc3luYykKICAgICAgU2subWlzY2V2YWwuY2FsbHNpbU9yU3VzcGVuZCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgYiA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSkKICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuYXBwbHlPclN1c3BlbmQoYSwgdm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgYikKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woCiAgICAgICAgIlNrLm1pc2NldmFsLmNhbGxzaW1PclN1c3BlbmQiLAogICAgICAgIFNrLm1pc2NldmFsLmNhbGxzaW1PclN1c3BlbmQsCiAgICAgICkKICAgICAgU2subWlzY2V2YWwuY2FsbHNpbU9yU3VzcGVuZEFycmF5ID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuYXBwbHlPclN1c3BlbmQoYSwgdm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgYiA/IGIgOiBbXSkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woCiAgICAgICAgIlNrLm1pc2NldmFsLmNhbGxzaW1PclN1c3BlbmRBcnJheSIsCiAgICAgICAgU2subWlzY2V2YWwuY2FsbHNpbU9yU3VzcGVuZEFycmF5LAogICAgICApCiAgICAgIFNrLm1pc2NldmFsLmFwcGx5ID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICBhID0gU2subWlzY2V2YWwuYXBwbHlPclN1c3BlbmQoYSwgYiwgYywgZCwgZSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLm1pc2NldmFsLlN1c3BlbnNpb24KICAgICAgICAgID8gU2subWlzY2V2YWwucmV0cnlPcHRpb25hbFN1c3BlbnNpb25PclRocm93KGEpCiAgICAgICAgICA6IGEKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLm1pc2NldmFsLmFwcGx5IiwgU2subWlzY2V2YWwuYXBwbHkpCiAgICAgIFNrLm1pc2NldmFsLmFzeW5jVG9Qcm9taXNlID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGMsIGQpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIDsoZnVuY3Rpb24gZyhhKSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGZvciAoCiAgICAgICAgICAgICAgICAgIHZhciBmID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgZyhhLnJlc3VtZSgpKQogICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAocSkgewogICAgICAgICAgICAgICAgICAgICAgICBkKHEpCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBrID0gZnVuY3Rpb24gKGIpIHsKICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIDsoYS5kYXRhLnJlc3VsdCA9IGIpLCBmKCkKICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZChEKQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgbCA9IGZ1bmN0aW9uIChiKSB7CiAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICA7KGEuZGF0YS5lcnJvciA9IGIpLCBmKCkKICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZChEKQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5taXNjZXZhbC5TdXNwZW5zaW9uOwoKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICB2YXIgciA9IGIgJiYgKGJbYS5kYXRhLnR5cGVdIHx8IGJbIioiXSkKICAgICAgICAgICAgICAgICAgaWYgKHIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IHIoYSkKICAgICAgICAgICAgICAgICAgICBpZiAobikgewogICAgICAgICAgICAgICAgICAgICAgbi50aGVuKGcsIGQpCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaWYgKCJTay5wcm9taXNlIiA9PSBhLmRhdGEudHlwZSkgewogICAgICAgICAgICAgICAgICAgIGEuZGF0YS5wcm9taXNlLnRoZW4oaywgbCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoIlNrLnlpZWxkIiA9PSBhLmRhdGEudHlwZSkgewogICAgICAgICAgICAgICAgICAgIFNrLmdsb2JhbC5zZXRJbW1lZGlhdGUoZikKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoIlNrLmRlbGF5IiA9PSBhLmRhdGEudHlwZSkgewogICAgICAgICAgICAgICAgICAgIFNrLmdsb2JhbC5zZXRJbW1lZGlhdGUoZikKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoYS5vcHRpb25hbCkgYSA9IGEucmVzdW1lKCkKICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN1c3BlbnNpb25FcnJvcigKICAgICAgICAgICAgICAgICAgICAgICJVbmhhbmRsZWQgbm9uLW9wdGlvbmFsIHN1c3BlbnNpb24gb2YgdHlwZSAnIiArCiAgICAgICAgICAgICAgICAgICAgICAgIGEuZGF0YS50eXBlICsKICAgICAgICAgICAgICAgICAgICAgICAgIiciLAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGMoYSkKICAgICAgICAgICAgICB9IGNhdGNoIChxKSB7CiAgICAgICAgICAgICAgICBkKHEpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KShhKCkpCiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGQoZSkKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2subWlzY2V2YWwuYXN5bmNUb1Byb21pc2UiLCBTay5taXNjZXZhbC5hc3luY1RvUHJvbWlzZSkKICAgICAgU2subWlzY2V2YWwuYXBwbHlBc3luYyA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCBlLCBmKSB7CiAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmFzeW5jVG9Qcm9taXNlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5hcHBseU9yU3VzcGVuZChiLCBjLCBkLCBlLCBmKQogICAgICAgIH0sIGEpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5taXNjZXZhbC5hcHBseUFzeW5jIiwgU2subWlzY2V2YWwuYXBwbHlBc3luYykKICAgICAgU2subWlzY2V2YWwuY2hhaW4gPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGZvciAodmFyIGMgPSAxLCBkID0gYSwgZSwgZjsgOyApIHsKICAgICAgICAgIGlmIChjID09IGFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBkCiAgICAgICAgICBpZiAoZCAmJiBkLiRpc1N1c3BlbnNpb24pIGJyZWFrCiAgICAgICAgICBkID0gYXJndW1lbnRzW2NdKGQpCiAgICAgICAgICBjKysKICAgICAgICB9CiAgICAgICAgZiA9IEFycmF5KGFyZ3VtZW50cy5sZW5ndGggLSBjKQogICAgICAgIGZvciAoZSA9IDA7IGUgPCBhcmd1bWVudHMubGVuZ3RoIC0gYzsgZSsrKSBmW2VdID0gYXJndW1lbnRzW2MgKyBlXQogICAgICAgIGUgPSAwCiAgICAgICAgcmV0dXJuIChmdW5jdGlvbiBrKGEpIHsKICAgICAgICAgIGZvciAoOyBlIDwgZi5sZW5ndGg7ICkgewogICAgICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLm1pc2NldmFsLlN1c3BlbnNpb24pCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5taXNjZXZhbC5TdXNwZW5zaW9uKGssIGEpCiAgICAgICAgICAgIGEgPSBmW2VdKGEpCiAgICAgICAgICAgIGUrKwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGEKICAgICAgICB9KShkKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2subWlzY2V2YWwuY2hhaW4iLCBTay5taXNjZXZhbC5jaGFpbikKICAgICAgU2subWlzY2V2YWwudHJ5Q2F0Y2ggPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIgYyA9IGEoKQogICAgICAgIH0gY2F0Y2ggKGQpIHsKICAgICAgICAgIHJldHVybiBiKGQpCiAgICAgICAgfQogICAgICAgIHJldHVybiBjIGluc3RhbmNlb2YgU2subWlzY2V2YWwuU3VzcGVuc2lvbgogICAgICAgICAgPyAoKGEgPSBuZXcgU2subWlzY2V2YWwuU3VzcGVuc2lvbih2b2lkIDAsIGMpKSwKICAgICAgICAgICAgKGEucmVzdW1lID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC50cnlDYXRjaChjLnJlc3VtZSwgYikKICAgICAgICAgICAgfSksCiAgICAgICAgICAgIGEpCiAgICAgICAgICA6IGMKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLm1pc2NldmFsLnRyeUNhdGNoIiwgU2subWlzY2V2YWwudHJ5Q2F0Y2gpCiAgICAgIFNrLm1pc2NldmFsLml0ZXJGb3IgPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIHZhciBkID0gYywKICAgICAgICAgIGUgPSBmdW5jdGlvbiAoYikgewogICAgICAgICAgICBkID0gYgogICAgICAgICAgICByZXR1cm4gYiBpbnN0YW5jZW9mIFNrLm1pc2NldmFsLkJyZWFrID8gYiA6IGEudHAkaXRlcm5leHQoITApCiAgICAgICAgICB9CiAgICAgICAgcmV0dXJuIChmdW5jdGlvbiBoKGEpIHsKICAgICAgICAgIGZvciAoOyB2b2lkIDAgIT09IGE7ICkgewogICAgICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLm1pc2NldmFsLlN1c3BlbnNpb24pCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5taXNjZXZhbC5TdXNwZW5zaW9uKGgsIGEpCiAgICAgICAgICAgIGlmIChhID09PSBTay5taXNjZXZhbC5CcmVhayB8fCBhIGluc3RhbmNlb2YgU2subWlzY2V2YWwuQnJlYWspCiAgICAgICAgICAgICAgcmV0dXJuIGEuYnJWYWx1ZQogICAgICAgICAgICBhID0gU2subWlzY2V2YWwuY2hhaW4oYihhLCBkKSwgZSkKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBkCiAgICAgICAgfSkoYS50cCRpdGVybmV4dCghMCkpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5taXNjZXZhbC5pdGVyRm9yIiwgU2subWlzY2V2YWwuaXRlckZvcikKICAgICAgU2subWlzY2V2YWwuQnJlYWsgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5taXNjZXZhbC5CcmVhaykpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLm1pc2NldmFsLkJyZWFrKGEpCiAgICAgICAgdGhpcy5iclZhbHVlID0gYQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2subWlzY2V2YWwuQnJlYWsiLCBTay5taXNjZXZhbC5CcmVhaykKICAgICAgU2subWlzY2V2YWwuYXBwbHlPclN1c3BlbmQgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSkgewogICAgICAgIHZhciBmCiAgICAgICAgaWYgKG51bGwgPT09IGEgfHwgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubm9uZSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIiciICsgU2suYWJzdHIudHlwZU5hbWUoYSkgKyAiJyBvYmplY3QgaXMgbm90IGNhbGxhYmxlIiwKICAgICAgICAgICkKICAgICAgICAiZnVuY3Rpb24iID09PSB0eXBlb2YgYSAmJgogICAgICAgICAgdm9pZCAwID09PSBhLnRwJGNhbGwgJiYKICAgICAgICAgIChhID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhhKSkKICAgICAgICB2YXIgZyA9IGEudHAkY2FsbAogICAgICAgIGlmICh2b2lkIDAgIT09IGcpIHsKICAgICAgICAgIGlmIChjKQogICAgICAgICAgICBmb3IgKAogICAgICAgICAgICAgIGMgPSBjLnRwJGl0ZXIoKSwgZiA9IGMudHAkaXRlcm5leHQoKTsKICAgICAgICAgICAgICB2b2lkIDAgIT09IGY7CiAgICAgICAgICAgICAgZiA9IGMudHAkaXRlcm5leHQoKQogICAgICAgICAgICApCiAgICAgICAgICAgICAgZS5wdXNoKGYpCiAgICAgICAgICBpZiAoYikKICAgICAgICAgICAgZm9yICgKICAgICAgICAgICAgICBjID0gU2suYWJzdHIuaXRlcihiKSwgZiA9IGMudHAkaXRlcm5leHQoKTsKICAgICAgICAgICAgICB2b2lkIDAgIT09IGY7CiAgICAgICAgICAgICAgZiA9IGMudHAkaXRlcm5leHQoKQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoZikpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgICAgICJGdW5jdGlvbiBrZXl3b3JkcyBtdXN0IGJlIHN0cmluZ3MiLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIGQucHVzaChmLnYpCiAgICAgICAgICAgICAgZC5wdXNoKFNrLmFic3RyLm9iamVjdEdldEl0ZW0oYiwgZiwgITEpKQogICAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZy5jYWxsKGEsIGUsIGQsIGIpCiAgICAgICAgfQogICAgICAgIGcgPSBhLl9fY2FsbF9fCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gZykgcmV0dXJuIGUudW5zaGlmdChhKSwgU2subWlzY2V2YWwuYXBwbHkoZywgYiwgYywgZCwgZSkKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAiJyIgKyBTay5hYnN0ci50eXBlTmFtZShhKSArICInIG9iamVjdCBpcyBub3QgY2FsbGFibGUiLAogICAgICAgICkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLm1pc2NldmFsLmFwcGx5T3JTdXNwZW5kIiwgU2subWlzY2V2YWwuYXBwbHlPclN1c3BlbmQpCiAgICAgIFNrLm1pc2NldmFsLnByb21pc2VUb1N1c3BlbnNpb24gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0gbmV3IFNrLm1pc2NldmFsLlN1c3BlbnNpb24oKQogICAgICAgIGIucmVzdW1lID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKGIuZGF0YS5lcnJvcikgdGhyb3cgYi5kYXRhLmVycm9yCiAgICAgICAgICByZXR1cm4gYi5kYXRhLnJlc3VsdAogICAgICAgIH0KICAgICAgICBiLmRhdGEgPSB7IHR5cGU6ICJTay5wcm9taXNlIiwgcHJvbWlzZTogYSB9CiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woCiAgICAgICAgIlNrLm1pc2NldmFsLnByb21pc2VUb1N1c3BlbnNpb24iLAogICAgICAgIFNrLm1pc2NldmFsLnByb21pc2VUb1N1c3BlbnNpb24sCiAgICAgICkKICAgICAgU2subWlzY2V2YWwuYnVpbGRDbGFzcyA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgdmFyIGYgPSBTay5idWlsdGluLnR5cGUsCiAgICAgICAgICBnID0ge30KICAgICAgICBiKGEsIGcsIHZvaWQgMCA9PT0gZSA/IHt9IDogZSkKICAgICAgICBnLl9fbW9kdWxlX18gPSBhLl9fbmFtZV9fCiAgICAgICAgYSA9IG5ldyBTay5idWlsdGluLnN0cihjKQogICAgICAgIGQgPSBuZXcgU2suYnVpbHRpbi50dXBsZShkKQogICAgICAgIGIgPSBbXQogICAgICAgIGZvciAodmFyIGggaW4gZykKICAgICAgICAgIGcuaGFzT3duUHJvcGVydHkoaCkgJiYgKGIucHVzaChuZXcgU2suYnVpbHRpbi5zdHIoaCkpLCBiLnB1c2goZ1toXSkpCiAgICAgICAgYiA9IG5ldyBTay5idWlsdGluLmRpY3QoYikKICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGYsIFthLCBkLCBiXSkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLm1pc2NldmFsLmJ1aWxkQ2xhc3MiLCBTay5taXNjZXZhbC5idWlsZENsYXNzKQogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4uc2VxdHlwZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5FeHRlcm5hbEVycm9yKAogICAgICAgICAgIkNhbm5vdCBpbnN0YW50aWF0ZSBhYnN0cmFjdCBTay5idWlsdGluLnNlcXR5cGUgY2xhc3MiLAogICAgICAgICkKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJTZXF1ZW5jZVR5cGUiLAogICAgICAgIFNrLmJ1aWx0aW4uc2VxdHlwZSwKICAgICAgICBTay5idWlsdGluLm9iamVjdCwKICAgICAgKQogICAgICBTay5idWlsdGluLnNlcXR5cGUuc2skYWJzdHJhY3QgPSAhMAogICAgICBTay5idWlsdGluLnNlcXR5cGUucHJvdG90eXBlLl9fbGVuX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19sZW5fXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICExLCAhMCkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhhLnNxJGxlbmd0aCgpKQogICAgICB9KQogICAgICBTay5idWlsdGluLnNlcXR5cGUucHJvdG90eXBlLl9faXRlcl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9faXRlcl9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITEsICEwKQogICAgICAgIHJldHVybiBhLnRwJGl0ZXIoKQogICAgICB9KQogICAgICBTay5idWlsdGluLnNlcXR5cGUucHJvdG90eXBlLl9fY29udGFpbnNfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigKICAgICAgICAgICJfX2NvbnRhaW5zX18iLAogICAgICAgICAgYXJndW1lbnRzLmxlbmd0aCwKICAgICAgICAgIDEsCiAgICAgICAgICAxLAogICAgICAgICAgITEsCiAgICAgICAgICAhMCwKICAgICAgICApCiAgICAgICAgcmV0dXJuIGEuc3EkY29udGFpbnMoYikgPyBTay5idWlsdGluLmJvb2wudHJ1ZSQgOiBTay5idWlsdGluLmJvb2wuZmFsc2UkCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc2VxdHlwZS5wcm90b3R5cGUuX19nZXRpdGVtX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fZ2V0aXRlbV9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBhLm1wJHN1YnNjcmlwdChiKQogICAgICB9KQogICAgICBTay5idWlsdGluLnNlcXR5cGUucHJvdG90eXBlLl9fYWRkX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fYWRkX18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEuc3EkY29uY2F0KGIpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc2VxdHlwZS5wcm90b3R5cGUuX19tdWxfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19tdWxfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEsICExLCAhMCkKICAgICAgICBpZiAoIVNrLm1pc2NldmFsLmlzSW5kZXgoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJjYW4ndCBtdWx0aXBseSBzZXF1ZW5jZSBieSBub24taW50IG9mIHR5cGUgJyIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGIpICsKICAgICAgICAgICAgICAiJyIsCiAgICAgICAgICApCiAgICAgICAgcmV0dXJuIGEuc3EkcmVwZWF0KGIpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc2VxdHlwZS5wcm90b3R5cGUuX19ybXVsX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fcm11bF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBhLnNxJHJlcGVhdChiKQogICAgICB9KQogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4ubGlzdCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgaWYgKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLmxpc3QpIGIgPSBiIHx8ICExCiAgICAgICAgZWxzZSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubGlzdChhLCBiIHx8ICEwKQogICAgICAgIHRoaXMuX19jbGFzc19fID0gU2suYnVpbHRpbi5saXN0CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYSkgdmFyIGMgPSBbXQogICAgICAgIGVsc2UgaWYgKCJbb2JqZWN0IEFycmF5XSIgPT09IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuYXBwbHkoYSkpIGMgPSBhCiAgICAgICAgZWxzZSB7CiAgICAgICAgICBpZiAoU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGEpKSB7CiAgICAgICAgICAgIGMgPSBbXQogICAgICAgICAgICB2YXIgZCA9IFNrLmFic3RyLml0ZXIoYSkKICAgICAgICAgICAgdmFyIGUgPSB0aGlzCiAgICAgICAgICAgIHJldHVybiAoZnVuY3Rpb24gaChhKSB7CiAgICAgICAgICAgICAgZm9yICg7OykgewogICAgICAgICAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5taXNjZXZhbC5TdXNwZW5zaW9uKQogICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLm1pc2NldmFsLlN1c3BlbnNpb24oaCwgYSkKICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IGEpIHJldHVybiAoZS52ID0gYyksIGUKICAgICAgICAgICAgICAgIGMucHVzaChhKQogICAgICAgICAgICAgICAgYSA9IGQudHAkaXRlcm5leHQoYikKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pKGQudHAkaXRlcm5leHQoYikpCiAgICAgICAgICB9CiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICInIiArIFNrLmFic3RyLnR5cGVOYW1lKGEpICsgIicgb2JqZWN0IGlzIG5vdCBpdGVyYWJsZSIsCiAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIHRoaXMudiA9IHRoaXMudiA9IGMKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoImxpc3QiLCBTay5idWlsdGluLmxpc3QsIFNrLmJ1aWx0aW4uc2VxdHlwZSkKICAgICAgU2suYWJzdHIubWFya1VuaGFzaGFibGUoU2suYnVpbHRpbi5saXN0KQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3RfY29uY2F0XyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBpZiAoIWEuX19jbGFzc19fIHx8IGEuX19jbGFzc19fICE9IFNrLmJ1aWx0aW4ubGlzdCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiY2FuIG9ubHkgY29uY2F0ZW5hdGUgbGlzdCB0byBsaXN0IikKICAgICAgICB2YXIgYyA9IHRoaXMudi5zbGljZSgpCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGEudi5sZW5ndGg7ICsrYikgYy5wdXNoKGEudltiXSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubGlzdChjLCAhMSkKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3RfZXh0ZW5kXyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZShhKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIiciICsgU2suYWJzdHIudHlwZU5hbWUoYSkgKyAiJyBvYmplY3QgaXMgbm90IGl0ZXJhYmxlIiwKICAgICAgICAgICkKICAgICAgICBpZiAodGhpcyA9PSBhKSB7CiAgICAgICAgICB2YXIgYyA9IFtdCiAgICAgICAgICBhID0gU2suYWJzdHIuaXRlcihhKQogICAgICAgICAgZm9yIChiID0gYS50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGI7IGIgPSBhLnRwJGl0ZXJuZXh0KCkpIGMucHVzaChiKQogICAgICAgICAgdGhpcy52LnB1c2guYXBwbHkodGhpcy52LCBjKQogICAgICAgIH0gZWxzZQogICAgICAgICAgZm9yICgKICAgICAgICAgICAgYSA9IFNrLmFic3RyLml0ZXIoYSksIGIgPSBhLnRwJGl0ZXJuZXh0KCk7CiAgICAgICAgICAgIHZvaWQgMCAhPT0gYjsKICAgICAgICAgICAgYiA9IGEudHAkaXRlcm5leHQoKQogICAgICAgICAgKQogICAgICAgICAgICB0aGlzLnYucHVzaChiKQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X2RlbF9pdGVtXyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgYSA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgaWYgKDAgPiBhIHx8IGEgPj0gdGhpcy52Lmxlbmd0aCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLkluZGV4RXJyb3IoImxpc3QgYXNzaWdubWVudCBpbmRleCBvdXQgb2YgcmFuZ2UiKQogICAgICAgIHRoaXMubGlzdF9kZWxfc2xpY2VfKGEsIGEgKyAxKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubGlzdF9kZWxfc2xpY2VfID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBhID0gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICBiID0gU2suYnVpbHRpbi5hc251bSQoYikKICAgICAgICB2YXIgYyA9IFtdCiAgICAgICAgYy51bnNoaWZ0KGIgLSBhKQogICAgICAgIGMudW5zaGlmdChhKQogICAgICAgIHRoaXMudi5zcGxpY2UuYXBwbHkodGhpcy52LCBjKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubGlzdF9hc3NfaXRlbV8gPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGEgPSBTay5idWlsdGluLmFzbnVtJChhKQogICAgICAgIGlmICgwID4gYSB8fCBhID49IHRoaXMudi5sZW5ndGgpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5JbmRleEVycm9yKCJsaXN0IGFzc2lnbm1lbnQgaW5kZXggb3V0IG9mIHJhbmdlIikKICAgICAgICB0aGlzLnZbYV0gPSBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X2Fzc19zbGljZV8gPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIGEgPSBTay5idWlsdGluLmFzbnVtJChhKQogICAgICAgIGIgPSBTay5idWlsdGluLmFzbnVtJChiKQogICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrSXRlcmFibGUoYykpCiAgICAgICAgICBjID0gbmV3IFNrLmJ1aWx0aW4ubGlzdChjLCAhMSkudi5zbGljZSgwKQogICAgICAgIGVsc2UgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJjYW4gb25seSBhc3NpZ24gYW4gaXRlcmFibGUiKQogICAgICAgIGMudW5zaGlmdChiIC0gYSkKICAgICAgICBjLnVuc2hpZnQoYSkKICAgICAgICB0aGlzLnYuc3BsaWNlLmFwcGx5KHRoaXMudiwgYykKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLiRyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBhLAogICAgICAgICAgYiA9IFtdCiAgICAgICAgdmFyIGMgPSBTay5hYnN0ci5pdGVyKHRoaXMpCiAgICAgICAgZm9yIChhID0gYy50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGE7IGEgPSBjLnRwJGl0ZXJuZXh0KCkpCiAgICAgICAgICBhID09PSB0aGlzID8gYi5wdXNoKCJbLi4uXSIpIDogYi5wdXNoKFNrLm1pc2NldmFsLm9iamVjdFJlcHIoYSkudikKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKCJbIiArIGIuam9pbigiLCAiKSArICJdIikKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLnRwJHJpY2hjb21wYXJlID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB2YXIgYwogICAgICAgIGlmICh0aGlzID09PSBhICYmIFNrLm1pc2NldmFsLm9wQWxsb3dzRXF1YWxpdHkoYikpIHJldHVybiAhMAogICAgICAgIGlmICghYS5fX2NsYXNzX18gfHwgYS5fX2NsYXNzX18gIT0gU2suYnVpbHRpbi5saXN0KQogICAgICAgICAgcmV0dXJuICJFcSIgPT09IGIKICAgICAgICAgICAgPyAhMQogICAgICAgICAgICA6ICJOb3RFcSIgPT09IGIKICAgICAgICAgICAgPyAhMAogICAgICAgICAgICA6IFNrLl9fZnV0dXJlX18ucHl0aG9uMwogICAgICAgICAgICA/IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgICAgICAgIDogITEKICAgICAgICB2YXIgZCA9IHRoaXMudgogICAgICAgIGEgPSBhLnYKICAgICAgICB2YXIgZSA9IGQubGVuZ3RoCiAgICAgICAgdmFyIGYgPSBhLmxlbmd0aAogICAgICAgIGZvciAoYyA9IDA7IGMgPCBlICYmIGMgPCBmOyArK2MpIHsKICAgICAgICAgIHZhciBnID0gU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGRbY10sIGFbY10sICJFcSIpCiAgICAgICAgICBpZiAoIWcpIGJyZWFrCiAgICAgICAgfQogICAgICAgIGlmIChjID49IGUgfHwgYyA+PSBmKQogICAgICAgICAgc3dpdGNoIChiKSB7CiAgICAgICAgICAgIGNhc2UgIkx0IjoKICAgICAgICAgICAgICByZXR1cm4gZSA8IGYKICAgICAgICAgICAgY2FzZSAiTHRFIjoKICAgICAgICAgICAgICByZXR1cm4gZSA8PSBmCiAgICAgICAgICAgIGNhc2UgIkVxIjoKICAgICAgICAgICAgICByZXR1cm4gZSA9PT0gZgogICAgICAgICAgICBjYXNlICJOb3RFcSI6CiAgICAgICAgICAgICAgcmV0dXJuIGUgIT09IGYKICAgICAgICAgICAgY2FzZSAiR3QiOgogICAgICAgICAgICAgIHJldHVybiBlID4gZgogICAgICAgICAgICBjYXNlICJHdEUiOgogICAgICAgICAgICAgIHJldHVybiBlID49IGYKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoKQogICAgICAgICAgfQogICAgICAgIHJldHVybiAiRXEiID09PSBiCiAgICAgICAgICA/ICExCiAgICAgICAgICA6ICJOb3RFcSIgPT09IGIKICAgICAgICAgID8gITAKICAgICAgICAgIDogU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGRbY10sIGFbY10sIGIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5fX2l0ZXJfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2l0ZXJfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICEwLCAhMSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubGlzdF9pdGVyXyhhKQogICAgICB9KQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLnRwJGl0ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxpc3RfaXRlcl8odGhpcykKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLnNxJGxlbmd0aCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy52Lmxlbmd0aAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUuc3EkY29uY2F0ID0KICAgICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3RfY29uY2F0XwogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLm5iJGFkZCA9IFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubGlzdF9jb25jYXRfCiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubmIkaW5wbGFjZV9hZGQgPQogICAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubGlzdF9leHRlbmRfCiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUuc3EkcmVwZWF0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiwgYwogICAgICAgIGlmICghU2subWlzY2V2YWwuaXNJbmRleChhKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgImNhbid0IG11bHRpcGx5IHNlcXVlbmNlIGJ5IG5vbi1pbnQgb2YgdHlwZSAnIiArCiAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYSkgKwogICAgICAgICAgICAgICInIiwKICAgICAgICAgICkKICAgICAgICBhID0gU2subWlzY2V2YWwuYXNJbmRleChhKQogICAgICAgIHZhciBkID0gW10KICAgICAgICBmb3IgKGMgPSAwOyBjIDwgYTsgKytjKQogICAgICAgICAgZm9yIChiID0gMDsgYiA8IHRoaXMudi5sZW5ndGg7ICsrYikgZC5wdXNoKHRoaXMudltiXSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubGlzdChkLCAhMSkKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLm5iJG11bHRpcGx5ID0KICAgICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLnNxJHJlcGVhdAogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLm5iJGlucGxhY2VfbXVsdGlwbHkgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiLCBjCiAgICAgICAgaWYgKCFTay5taXNjZXZhbC5pc0luZGV4KGEpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiY2FuJ3QgbXVsdGlwbHkgc2VxdWVuY2UgYnkgbm9uLWludCBvZiB0eXBlICciICsKICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShhKSArCiAgICAgICAgICAgICAgIiciLAogICAgICAgICAgKQogICAgICAgIGEgPSBTay5taXNjZXZhbC5hc0luZGV4KGEpCiAgICAgICAgdmFyIGQgPSB0aGlzLnYubGVuZ3RoCiAgICAgICAgZm9yIChjID0gMTsgYyA8IGE7ICsrYykgZm9yIChiID0gMDsgYiA8IGQ7ICsrYikgdGhpcy52LnB1c2godGhpcy52W2JdKQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5zcSRhc3NfaXRlbSA9CiAgICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X2Fzc19pdGVtXwogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLnNxJGRlbF9pdGVtID0KICAgICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3RfZGVsX2l0ZW1fCiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUuc3EkYXNzX3NsaWNlID0KICAgICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3RfYXNzX3NsaWNlXwogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLnNxJGRlbF9zbGljZSA9CiAgICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X2RlbF9zbGljZV8KICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5zcSRjb250YWlucyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICB2YXIgYyA9IHRoaXMudHAkaXRlcigpCiAgICAgICAgZm9yIChiID0gYy50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGI7IGIgPSBjLnRwJGl0ZXJuZXh0KCkpCiAgICAgICAgICBpZiAoU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGIsIGEsICJFcSIpKSByZXR1cm4gITAKICAgICAgICByZXR1cm4gITEKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLl9fY29udGFpbnNfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19jb250YWluc19fIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMikKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uYm9vbChhLnNxJGNvbnRhaW5zKGIpKQogICAgICB9KQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3Rfc3Vic2NyaXB0XyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKFNrLm1pc2NldmFsLmlzSW5kZXgoYSkpIHsKICAgICAgICAgIHZhciBiID0gU2subWlzY2V2YWwuYXNJbmRleChhKQogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gYikgewogICAgICAgICAgICAwID4gYiAmJiAoYiA9IHRoaXMudi5sZW5ndGggKyBiKQogICAgICAgICAgICBpZiAoMCA+IGIgfHwgYiA+PSB0aGlzLnYubGVuZ3RoKQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLkluZGV4RXJyb3IoImxpc3QgaW5kZXggb3V0IG9mIHJhbmdlIikKICAgICAgICAgICAgcmV0dXJuIHRoaXMudltiXQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uc2xpY2UpIHsKICAgICAgICAgIHZhciBjID0gW10KICAgICAgICAgIGEuc3NzaXRlciQodGhpcywgZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgYy5wdXNoKGIudlthXSkKICAgICAgICAgIH0pCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubGlzdChjLCAhMSkKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgImxpc3QgaW5kaWNlcyBtdXN0IGJlIGludGVnZXJzLCBub3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGEpLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3RfYXNzX3N1YnNjcmlwdF8gPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGlmIChTay5taXNjZXZhbC5pc0luZGV4KGEpKSB7CiAgICAgICAgICB2YXIgYyA9IFNrLm1pc2NldmFsLmFzSW5kZXgoYSkKICAgICAgICAgIGlmICh2b2lkIDAgIT09IGMpIHsKICAgICAgICAgICAgMCA+IGMgJiYgKGMgPSB0aGlzLnYubGVuZ3RoICsgYykKICAgICAgICAgICAgdGhpcy5saXN0X2Fzc19pdGVtXyhjLCBiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLnNsaWNlKSB7CiAgICAgICAgICBjID0gYS5zbGljZV9pbmRpY2VzXyh0aGlzLnYubGVuZ3RoKQogICAgICAgICAgaWYgKDEgPT09IGNbMl0pIHRoaXMubGlzdF9hc3Nfc2xpY2VfKGNbMF0sIGNbMV0sIGIpCiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgdmFyIGQgPSBbXQogICAgICAgICAgICBhLnNzc2l0ZXIkKHRoaXMsIGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgZC5wdXNoKGEpCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGEgPSAwCiAgICAgICAgICAgIGlmIChkLmxlbmd0aCAhPT0gYi52Lmxlbmd0aCkKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKAogICAgICAgICAgICAgICAgImF0dGVtcHQgdG8gYXNzaWduIHNlcXVlbmNlIG9mIHNpemUgIiArCiAgICAgICAgICAgICAgICAgIGIudi5sZW5ndGggKwogICAgICAgICAgICAgICAgICAiIHRvIGV4dGVuZGVkIHNsaWNlIG9mIHNpemUgIiArCiAgICAgICAgICAgICAgICAgIGQubGVuZ3RoLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgZm9yIChjID0gMDsgYyA8IGQubGVuZ3RoOyArK2MpCiAgICAgICAgICAgICAgdGhpcy52LnNwbGljZShkW2NdLCAxLCBiLnZbYV0pLCAoYSArPSAxKQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICJsaXN0IGluZGljZXMgbXVzdCBiZSBpbnRlZ2Vycywgbm90ICIgKyBTay5hYnN0ci50eXBlTmFtZShhKSwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X2RlbF9zdWJzY3JpcHRfID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoU2subWlzY2V2YWwuaXNJbmRleChhKSkgewogICAgICAgICAgdmFyIGIgPSBTay5taXNjZXZhbC5hc0luZGV4KGEpCiAgICAgICAgICBpZiAodm9pZCAwICE9PSBiKSB7CiAgICAgICAgICAgIDAgPiBiICYmIChiID0gdGhpcy52Lmxlbmd0aCArIGIpCiAgICAgICAgICAgIHRoaXMubGlzdF9kZWxfaXRlbV8oYikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zbGljZSkgewogICAgICAgICAgYiA9IGEuc2xpY2VfaW5kaWNlc18odGhpcy52Lmxlbmd0aCkKICAgICAgICAgIGlmICgxID09PSBiWzJdKSB0aGlzLmxpc3RfZGVsX3NsaWNlXyhiWzBdLCBiWzFdKQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhciBjID0gdGhpcwogICAgICAgICAgICB2YXIgZCA9IDAKICAgICAgICAgICAgdmFyIGUgPSAwIDwgYlsyXSA/IDEgOiAwCiAgICAgICAgICAgIGEuc3NzaXRlciQodGhpcywgZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICBjLnYuc3BsaWNlKGEgLSBkLCAxKQogICAgICAgICAgICAgIGQgKz0gZQogICAgICAgICAgICB9KQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICJsaXN0IGluZGljZXMgbXVzdCBiZSBpbnRlZ2Vycywgbm90ICIgKyB0eXBlb2YgYSwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5tcCRzdWJzY3JpcHQgPQogICAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubGlzdF9zdWJzY3JpcHRfCiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubXAkYXNzX3N1YnNjcmlwdCA9CiAgICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X2Fzc19zdWJzY3JpcHRfCiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubXAkZGVsX3N1YnNjcmlwdCA9CiAgICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X2RlbF9zdWJzY3JpcHRfCiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUuX19nZXRpdGVtX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3Rfc3Vic2NyaXB0Xy5jYWxsKGEsIGIpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUuX19zZXRpdGVtX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICAgYywKICAgICAgKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubGlzdF9hc3Nfc3Vic2NyaXB0Xy5jYWxsKGEsIGIsIGMpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUuX19kZWxpdGVtX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3RfZGVsX3N1YnNjcmlwdF8uY2FsbChhLCBiKQogICAgICB9KQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3Rfc29ydF8gPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgewogICAgICAgIHZhciBlLAogICAgICAgICAgZiA9IHZvaWQgMCAhPT0gYyAmJiBudWxsICE9PSBjICYmIGMgIT09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICAgIHZhciBnID0gdm9pZCAwICE9PSBiICYmIG51bGwgIT09IGIgJiYgYiAhPT0gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgICAgaWYgKHZvaWQgMCA9PT0gZCkgdmFyIGggPSAhMQogICAgICAgIGVsc2UgewogICAgICAgICAgaWYgKGQgPT09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJhbiBpbnRlZ2VyIGlzIHJlcXVpcmVkIikKICAgICAgICAgIGggPSBTay5taXNjZXZhbC5pc1RydWUoZCkKICAgICAgICB9CiAgICAgICAgZCA9IG5ldyBTay5idWlsdGluLnRpbVNvcnQoYSkKICAgICAgICBhLnYgPSBbXQogICAgICAgIHZhciBrID0gbmV3IFNrLmJ1aWx0aW4uaW50XygwKQogICAgICAgIGlmIChmKQogICAgICAgICAgZm9yICgKICAgICAgICAgICAgZC5sdCA9IGcKICAgICAgICAgICAgICA/IGZ1bmN0aW9uIChhLCBjKSB7CiAgICAgICAgICAgICAgICAgIGEgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYiwgW2FbMF0sIGNbMF1dKQogICAgICAgICAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGEsIGssICJMdCIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgOiBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGFbMF0sIGJbMF0sICJMdCIpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGUgPSAwOwogICAgICAgICAgICBlIDwgZC5saXN0bGVuZ3RoOwogICAgICAgICAgICBlKysKICAgICAgICAgICkgewogICAgICAgICAgICBnID0gZC5saXN0LnZbZV0KICAgICAgICAgICAgdmFyIGwgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYywgW2ddKQogICAgICAgICAgICBkLmxpc3QudltlXSA9IFtsLCBnXQogICAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICAgIGcgJiYKICAgICAgICAgICAgKGQubHQgPSBmdW5jdGlvbiAoYSwgYykgewogICAgICAgICAgICAgIGEgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYiwgW2EsIGNdKQogICAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woYSwgaywgIkx0IikKICAgICAgICAgICAgfSkKICAgICAgICBoICYmIGQubGlzdC5saXN0X3JldmVyc2VfKGQubGlzdCkKICAgICAgICBkLnNvcnQoKQogICAgICAgIGggJiYgZC5saXN0Lmxpc3RfcmV2ZXJzZV8oZC5saXN0KQogICAgICAgIGlmIChmKQogICAgICAgICAgZm9yIChjID0gMDsgYyA8IGQubGlzdGxlbmd0aDsgYysrKQogICAgICAgICAgICAoZyA9IGQubGlzdC52W2NdWzFdKSwgKGQubGlzdC52W2NdID0gZykKICAgICAgICBjID0gMCA8IGEuc3EkbGVuZ3RoKCkKICAgICAgICBhLnYgPSBkLmxpc3QudgogICAgICAgIGlmIChjKSB0aHJvdyBuZXcgU2suYnVpbHRpbi5PcGVyYXRpb25FcnJvcigibGlzdCBtb2RpZmllZCBkdXJpbmcgc29ydCIpCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubGlzdF9zb3J0Xy5jb192YXJuYW1lcyA9IFsKICAgICAgICAiX19zZWxmX18iLAogICAgICAgICJjbXAiLAogICAgICAgICJrZXkiLAogICAgICAgICJyZXZlcnNlIiwKICAgICAgXQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmxpc3Rfc29ydF8uJGRlZmF1bHRzID0gWwogICAgICAgIFNrLmJ1aWx0aW4ubm9uZS5ub25lJCwKICAgICAgICBTay5idWlsdGluLm5vbmUubm9uZSQsCiAgICAgICAgITEsCiAgICAgIF0KICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5saXN0X3JldmVyc2VfID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJyZXZlcnNlIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICB2YXIgYiA9IGEudi5sZW5ndGgKICAgICAgICB2YXIgYyA9IGEudgogICAgICAgIHZhciBkID0gW10KICAgICAgICBmb3IgKC0tYjsgLTEgPCBiOyAtLWIpIGQucHVzaChjW2JdKQogICAgICAgIGEudiA9IGQKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5hcHBlbmQgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiYXBwZW5kIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMikKICAgICAgICBhLnYucHVzaChiKQogICAgICAgIHJldHVybiBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5pbnNlcnQgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICAgYywKICAgICAgKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaW5zZXJ0IiwgYXJndW1lbnRzLmxlbmd0aCwgMywgMykKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tOdW1iZXIoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImFuIGludGVnZXIgaXMgcmVxdWlyZWQiKQogICAgICAgIGIgPSBTay5idWlsdGluLmFzbnVtJChiKQogICAgICAgIDAgPiBiICYmIChiICs9IGEudi5sZW5ndGgpCiAgICAgICAgMCA+IGIgPyAoYiA9IDApIDogYiA+IGEudi5sZW5ndGggJiYgKGIgPSBhLnYubGVuZ3RoKQogICAgICAgIGEudi5zcGxpY2UoYiwgMCwgYykKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUuZXh0ZW5kID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImV4dGVuZCIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDIpCiAgICAgICAgYS5saXN0X2V4dGVuZF8oYikKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUucG9wID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInBvcCIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDIpCiAgICAgICAgdm9pZCAwID09PSBiICYmIChiID0gYS52Lmxlbmd0aCAtIDEpCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrTnVtYmVyKGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJhbiBpbnRlZ2VyIGlzIHJlcXVpcmVkIikKICAgICAgICBiID0gU2suYnVpbHRpbi5hc251bSQoYikKICAgICAgICAwID4gYiAmJiAoYiArPSBhLnYubGVuZ3RoKQogICAgICAgIGlmICgwID4gYiB8fCBiID49IGEudi5sZW5ndGgpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5JbmRleEVycm9yKCJwb3AgaW5kZXggb3V0IG9mIHJhbmdlIikKICAgICAgICB2YXIgYyA9IGEudltiXQogICAgICAgIGEudi5zcGxpY2UoYiwgMSkKICAgICAgICByZXR1cm4gYwogICAgICB9KQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLnJlbW92ZSA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJyZW1vdmUiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIHZhciBjID0gU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5pbmRleC5mdW5jX2NvZGUoYSwgYikKICAgICAgICBhLnYuc3BsaWNlKFNrLmJ1aWx0aW4uYXNudW0kKGMpLCAxKQogICAgICAgIHJldHVybiBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5saXN0LnByb3RvdHlwZS5jbGVhciQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImNsZWFyIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICBhLnYgPSBbXQogICAgICAgIHJldHVybiBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmluZGV4ID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICAgIGMsCiAgICAgICAgZCwKICAgICAgKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaW5kZXgiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCA0KQogICAgICAgIGlmICh2b2lkIDAgIT09IGMgJiYgIVNrLmJ1aWx0aW4uY2hlY2tJbnQoYykpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoInNsaWNlIGluZGljZXMgbXVzdCBiZSBpbnRlZ2VycyIpCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gZCAmJiAhU2suYnVpbHRpbi5jaGVja0ludChkKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigic2xpY2UgaW5kaWNlcyBtdXN0IGJlIGludGVnZXJzIikKICAgICAgICB2YXIgZSA9IGEudi5sZW5ndGgKICAgICAgICB2YXIgZiA9IGEudgogICAgICAgIGMgPSB2b2lkIDAgPT09IGMgPyAwIDogYy52CiAgICAgICAgMCA+IGMgJiYgKGMgPSAwIDw9IGMgKyBlID8gYyArIGUgOiAwKQogICAgICAgIGQgPSB2b2lkIDAgPT09IGQgPyBlIDogZC52CiAgICAgICAgMCA+IGQgJiYgKGQgPSAwIDw9IGQgKyBlID8gZCArIGUgOiAwKQogICAgICAgIGZvciAoZSA9IGM7IGUgPCBkOyArK2UpCiAgICAgICAgICBpZiAoU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGZbZV0sIGIsICJFcSIpKQogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhlKQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoImxpc3QuaW5kZXgoeCk6IHggbm90IGluIGxpc3QiKQogICAgICB9KQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmNvdW50ID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjLCBkCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiY291bnQiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIHZhciBlID0gYS52Lmxlbmd0aAogICAgICAgIHZhciBmID0gYS52CiAgICAgICAgZm9yIChjID0gZCA9IDA7IGMgPCBlOyArK2MpCiAgICAgICAgICBTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woZltjXSwgYiwgIkVxIikgJiYgKGQgKz0gMSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhkKQogICAgICB9KQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLmNvcHkgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJjb3B5IiwgYXJndW1lbnRzLmxlbmd0aCAtIDEsIDAsIDApCiAgICAgICAgdmFyIGMgPSBbXQogICAgICAgIHZhciBkID0gU2suYWJzdHIuaXRlcihhKQogICAgICAgIGZvciAoYiA9IGQudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBiOyBiID0gZC50cCRpdGVybmV4dCgpKSBjLnB1c2goYikKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubGlzdChjKQogICAgICB9KQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLnJldmVyc2UgPSBuZXcgU2suYnVpbHRpbi5mdW5jKAogICAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubGlzdF9yZXZlcnNlXywKICAgICAgKQogICAgICBTay5idWlsdGluLmxpc3QucHJvdG90eXBlLnNvcnQgPSBuZXcgU2suYnVpbHRpbi5mdW5jKAogICAgICAgIFNrLmJ1aWx0aW4ubGlzdC5wcm90b3R5cGUubGlzdF9zb3J0XywKICAgICAgKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4ubGlzdCIsIFNrLmJ1aWx0aW4ubGlzdCkKICAgICAgU2suYnVpbHRpbi5saXN0X2l0ZXJfID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5saXN0X2l0ZXJfKSkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5saXN0X2l0ZXJfKGEpCiAgICAgICAgdGhpcy4kaW5kZXggPSAwCiAgICAgICAgdGhpcy5sc3QgPSBhLnYuc2xpY2UoKQogICAgICAgIHRoaXMuc3EkbGVuZ3RoID0gdGhpcy5sc3QubGVuZ3RoCiAgICAgICAgdGhpcy50cCRpdGVyID0gdGhpcwogICAgICAgIHRoaXMudHAkaXRlcm5leHQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoISh0aGlzLiRpbmRleCA+PSB0aGlzLnNxJGxlbmd0aCkpIHJldHVybiB0aGlzLmxzdFt0aGlzLiRpbmRleCsrXQogICAgICAgIH0KICAgICAgICB0aGlzLiRyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigibGlzdGl0ZXJhdG9yIikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJsaXN0aXRlcmF0b3IiLAogICAgICAgIFNrLmJ1aWx0aW4ubGlzdF9pdGVyXywKICAgICAgICBTay5idWlsdGluLm9iamVjdCwKICAgICAgKQogICAgICBTay5idWlsdGluLmxpc3RfaXRlcl8ucHJvdG90eXBlLl9fY2xhc3NfXyA9IFNrLmJ1aWx0aW4ubGlzdF9pdGVyXwogICAgICBTay5idWlsdGluLmxpc3RfaXRlcl8ucHJvdG90eXBlLl9faXRlcl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoCiAgICAgICAgYSwKICAgICAgKSB7CiAgICAgICAgcmV0dXJuIGEKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5saXN0X2l0ZXJfLnByb3RvdHlwZS5uZXh0JCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgYSA9IGEudHAkaXRlcm5leHQoKQogICAgICAgIGlmICh2b2lkIDAgPT09IGEpIHRocm93IG5ldyBTay5idWlsdGluLlN0b3BJdGVyYXRpb24oKQogICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgIH0sCiAgICBmdW5jdGlvbiAobSwgcCkgewogICAgICBTay5idWlsdGluLmludGVybmVkID0ge30KICAgICAgU2suYnVpbHRpbi5zdHIgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInN0ciIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDEpCiAgICAgICAgdm9pZCAwID09PSBhICYmIChhID0gIiIpCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLnN0cikgcmV0dXJuIGEKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zdHIpKSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGEpCiAgICAgICAgaWYgKCEwID09PSBhKSB2YXIgYiA9ICJUcnVlIgogICAgICAgIGVsc2UgaWYgKCExID09PSBhKSBiID0gIkZhbHNlIgogICAgICAgIGVsc2UgaWYgKG51bGwgPT09IGEgfHwgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubm9uZSkgYiA9ICJOb25lIgogICAgICAgIGVsc2UgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmJvb2wpIGIgPSBhLnYgPyAiVHJ1ZSIgOiAiRmFsc2UiCiAgICAgICAgZWxzZSBpZiAoIm51bWJlciIgPT09IHR5cGVvZiBhKQogICAgICAgICAgKGIgPSBhLnRvU3RyaW5nKCkpLAogICAgICAgICAgICAiSW5maW5pdHkiID09PSBiID8gKGIgPSAiaW5mIikgOiAiLUluZmluaXR5IiA9PT0gYiAmJiAoYiA9ICItaW5mIikKICAgICAgICBlbHNlIGlmICgic3RyaW5nIiA9PT0gdHlwZW9mIGEpIGIgPSBhCiAgICAgICAgZWxzZSB7CiAgICAgICAgICBpZiAodm9pZCAwICE9PSBhLnRwJHN0cikgewogICAgICAgICAgICBiID0gYS50cCRzdHIoKQogICAgICAgICAgICBpZiAoIShiIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zdHIpKQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoIl9fc3RyX18gZGlkbid0IHJldHVybiBhIHN0ciIpCiAgICAgICAgICAgIHJldHVybiBiCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwub2JqZWN0UmVwcihhKQogICAgICAgIH0KICAgICAgICBpZiAoU2suYnVpbHRpbi5pbnRlcm5lZFsiMSIgKyBiXSkgcmV0dXJuIFNrLmJ1aWx0aW4uaW50ZXJuZWRbIjEiICsgYl0KICAgICAgICB0aGlzLl9fY2xhc3NfXyA9IFNrLmJ1aWx0aW4uc3RyCiAgICAgICAgdGhpcy52ID0gdGhpcy52ID0gYgogICAgICAgIFNrLmJ1aWx0aW4uaW50ZXJuZWRbIjEiICsgYl0gPSB0aGlzCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uc3RyIiwgU2suYnVpbHRpbi5zdHIpCiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoInN0ciIsIFNrLmJ1aWx0aW4uc3RyLCBTay5idWlsdGluLnNlcXR5cGUpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS4kanNzdHIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5tcCRzdWJzY3JpcHQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmIChTay5taXNjZXZhbC5pc0luZGV4KGEpKSB7CiAgICAgICAgICBhID0gU2subWlzY2V2YWwuYXNJbmRleChhKQogICAgICAgICAgMCA+IGEgJiYgKGEgPSB0aGlzLnYubGVuZ3RoICsgYSkKICAgICAgICAgIGlmICgwID4gYSB8fCBhID49IHRoaXMudi5sZW5ndGgpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLkluZGV4RXJyb3IoInN0cmluZyBpbmRleCBvdXQgb2YgcmFuZ2UiKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cih0aGlzLnYuY2hhckF0KGEpKQogICAgICAgIH0KICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uc2xpY2UpIHsKICAgICAgICAgIHZhciBiID0gIiIKICAgICAgICAgIGEuc3NzaXRlciQodGhpcywgZnVuY3Rpb24gKGEsIGQpIHsKICAgICAgICAgICAgMCA8PSBhICYmIGEgPCBkLnYubGVuZ3RoICYmIChiICs9IGQudi5jaGFyQXQoYSkpCiAgICAgICAgICB9KQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihiKQogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAic3RyaW5nIGluZGljZXMgbXVzdCBiZSBpbnRlZ2Vycywgbm90ICIgKyBTay5hYnN0ci50eXBlTmFtZShhKSwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLnNxJGxlbmd0aCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy52Lmxlbmd0aAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5zcSRjb25jYXQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICghYSB8fCAhU2suYnVpbHRpbi5jaGVja1N0cmluZyhhKSkKICAgICAgICAgIHRocm93ICgKICAgICAgICAgICAgKChhID0gU2suYWJzdHIudHlwZU5hbWUoYSkpLAogICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgImNhbm5vdCBjb25jYXRlbmF0ZSAnc3RyJyBhbmQgJyIgKyBhICsgIicgb2JqZWN0cyIsCiAgICAgICAgICAgICkpCiAgICAgICAgICApCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cih0aGlzLnYgKyBhLnYpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLm5iJGFkZCA9IFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5zcSRjb25jYXQKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLm5iJGlucGxhY2VfYWRkID0KICAgICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUuc3EkY29uY2F0CiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5zcSRyZXBlYXQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiCiAgICAgICAgaWYgKCFTay5taXNjZXZhbC5pc0luZGV4KGEpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiY2FuJ3QgbXVsdGlwbHkgc2VxdWVuY2UgYnkgbm9uLWludCBvZiB0eXBlICciICsKICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShhKSArCiAgICAgICAgICAgICAgIiciLAogICAgICAgICAgKQogICAgICAgIGEgPSBTay5taXNjZXZhbC5hc0luZGV4KGEpCiAgICAgICAgdmFyIGMgPSAiIgogICAgICAgIGZvciAoYiA9IDA7IGIgPCBhOyArK2IpIGMgKz0gdGhpcy52CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihjKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5uYiRtdWx0aXBseSA9IFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5zcSRyZXBlYXQKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLm5iJGlucGxhY2VfbXVsdGlwbHkgPQogICAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5zcSRyZXBlYXQKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLnNxJGl0ZW0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCkKICAgICAgfQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUuc3Ekc2xpY2UgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGEgPSBTay5idWlsdGluLmFzbnVtJChhKQogICAgICAgIGIgPSBTay5idWlsdGluLmFzbnVtJChiKQogICAgICAgIDAgPiBhICYmIChhID0gMCkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKHRoaXMudi5zdWJzdHIoYSwgYiAtIGEpKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5zcSRjb250YWlucyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKCEoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uc3RyKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIlR5cGVFcnJvcjogJ0luIDxzdHJpbmc+IHJlcXVpcmVzIHN0cmluZyBhcyBsZWZ0IG9wZXJhbmQiLAogICAgICAgICAgKQogICAgICAgIHJldHVybiAtMSAhPSB0aGlzLnYuaW5kZXhPZihhLnYpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLl9faXRlcl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHJfaXRlcl8oYSkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLnRwJGl0ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cl9pdGVyXyh0aGlzKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS50cCRyaWNoY29tcGFyZSA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgaWYgKCEoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uc3RyKSkKICAgICAgICAgIHJldHVybiBTay5fX2Z1dHVyZV9fLnB5dGhvbjMKICAgICAgICAgICAgPyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICAgICAgICA6ICExCiAgICAgICAgc3dpdGNoIChiKSB7CiAgICAgICAgICBjYXNlICJMdCI6CiAgICAgICAgICAgIHJldHVybiB0aGlzLnYgPCBhLnYKICAgICAgICAgIGNhc2UgIkx0RSI6CiAgICAgICAgICAgIHJldHVybiB0aGlzLnYgPD0gYS52CiAgICAgICAgICBjYXNlICJFcSI6CiAgICAgICAgICAgIHJldHVybiB0aGlzLnYgPT09IGEudgogICAgICAgICAgY2FzZSAiTm90RXEiOgogICAgICAgICAgICByZXR1cm4gdGhpcy52ICE9PSBhLnYKICAgICAgICAgIGNhc2UgIkd0IjoKICAgICAgICAgICAgcmV0dXJuIHRoaXMudiA+IGEudgogICAgICAgICAgY2FzZSAiR3RFIjoKICAgICAgICAgICAgcmV0dXJuIHRoaXMudiA+PSBhLnYKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgpCiAgICAgICAgfQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS4kciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgYSwKICAgICAgICAgIGIgPSAiJyIKICAgICAgICA7LTEgIT09IHRoaXMudi5pbmRleE9mKCInIikgJiYgLTEgPT09IHRoaXMudi5pbmRleE9mKCciJykgJiYgKGIgPSAnIicpCiAgICAgICAgdmFyIGMgPSB0aGlzLnYubGVuZ3RoCiAgICAgICAgdmFyIGQgPSBiCiAgICAgICAgZm9yIChhID0gMDsgYSA8IGM7ICsrYSkgewogICAgICAgICAgdmFyIGUgPSB0aGlzLnYuY2hhckF0KGEpCiAgICAgICAgICBlID09PSBiIHx8ICJcXCIgPT09IGUKICAgICAgICAgICAgPyAoZCArPSAiXFwiICsgZSkKICAgICAgICAgICAgOiAiXHQiID09PSBlCiAgICAgICAgICAgID8gKGQgKz0gIlxcdCIpCiAgICAgICAgICAgIDogIlxuIiA9PT0gZQogICAgICAgICAgICA/IChkICs9ICJcXG4iKQogICAgICAgICAgICA6ICJcciIgPT09IGUKICAgICAgICAgICAgPyAoZCArPSAiXFxyIikKICAgICAgICAgICAgOiAiICIgPiBlIHx8IDEyNyA8PSBlCiAgICAgICAgICAgID8gKChlID0gZS5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KSksCiAgICAgICAgICAgICAgMiA+IGUubGVuZ3RoICYmIChlID0gIjAiICsgZSksCiAgICAgICAgICAgICAgKGQgKz0gIlxceCIgKyBlKSkKICAgICAgICAgICAgOiAoZCArPSBlKQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGQgKyBiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc3RyLnJlX2VzY2FwZV8gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiLAogICAgICAgICAgYyA9IFtdLAogICAgICAgICAgZCA9IC9eW0EtWmEtejAtOV0rJC8KICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYS5sZW5ndGg7ICsrYikgewogICAgICAgICAgdmFyIGUgPSBhLmNoYXJBdChiKQogICAgICAgICAgZC50ZXN0KGUpCiAgICAgICAgICAgID8gYy5wdXNoKGUpCiAgICAgICAgICAgIDogIlxcMDAwIiA9PT0gZQogICAgICAgICAgICA/IGMucHVzaCgiXFwwMDAiKQogICAgICAgICAgICA6IGMucHVzaCgiXFwiICsgZSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGMuam9pbigiIikKICAgICAgfQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUubG93ZXIgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigibG93ZXIiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoYS52LnRvTG93ZXJDYXNlKCkpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS51cHBlciA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJ1cHBlciIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihhLnYudG9VcHBlckNhc2UoKSkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLmNhcGl0YWxpemUgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJjYXBpdGFsaXplIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICB2YXIgYyA9IGEudgogICAgICAgIGlmICgwID09PSBjLmxlbmd0aCkgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigiIikKICAgICAgICB2YXIgZCA9IGMuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkKICAgICAgICBmb3IgKGIgPSAxOyBiIDwgYy5sZW5ndGg7IGIrKykgZCArPSBjLmNoYXJBdChiKS50b0xvd2VyQ2FzZSgpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihkKQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUuam9pbiA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB2YXIgYwogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImpvaW4iLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja1R5cGUoInNlcSIsICJpdGVyYWJsZSIsIFNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZShiKSkKICAgICAgICB2YXIgZCA9IFtdCiAgICAgICAgdmFyIGUgPSBiLnRwJGl0ZXIoKQogICAgICAgIGZvciAoYyA9IGUudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBjOyBjID0gZS50cCRpdGVybmV4dCgpKSB7CiAgICAgICAgICBpZiAoYy5jb25zdHJ1Y3RvciAhPT0gU2suYnVpbHRpbi5zdHIpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAiVHlwZUVycm9yOiBzZXF1ZW5jZSBpdGVtICIgKwogICAgICAgICAgICAgICAgZC5sZW5ndGggKwogICAgICAgICAgICAgICAgIjogZXhwZWN0ZWQgc3RyaW5nLCAiICsKICAgICAgICAgICAgICAgIHR5cGVvZiBjICsKICAgICAgICAgICAgICAgICIgZm91bmQiLAogICAgICAgICAgICApCiAgICAgICAgICBkLnB1c2goYy52KQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGQuam9pbihhLnYpKQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUuc3BsaXQgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQsIGUKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJzcGxpdCIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDMpCiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYiB8fCBiIGluc3RhbmNlb2YgU2suYnVpbHRpbi5ub25lKSBiID0gbnVsbAogICAgICAgIGlmIChudWxsICE9PSBiICYmICFTay5idWlsdGluLmNoZWNrU3RyaW5nKGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJleHBlY3RlZCBhIHN0cmluZyIpCiAgICAgICAgaWYgKG51bGwgIT09IGIgJiYgIiIgPT09IGIudikKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoImVtcHR5IHNlcGFyYXRvciIpCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gYyAmJiAhU2suYnVpbHRpbi5jaGVja0ludChjKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiYW4gaW50ZWdlciBpcyByZXF1aXJlZCIpCiAgICAgICAgYyA9IFNrLmJ1aWx0aW4uYXNudW0kKGMpCiAgICAgICAgdmFyIGYgPSAvW1xzXHhhMF0rL2cKICAgICAgICB2YXIgZyA9IGEudgogICAgICAgIGlmIChudWxsID09PSBiKSBnID0gZy5yZXBsYWNlKC9eW1xzXHhhMF0rLywgIiIpCiAgICAgICAgZWxzZSB7CiAgICAgICAgICB2YXIgaCA9IGIudi5yZXBsYWNlKC8oWy4qKz89fFxcXC8oKVxbXF1ce1x9XiRdKS9nLCAiXFwkMSIpCiAgICAgICAgICBmID0gbmV3IFJlZ0V4cChoLCAiZyIpCiAgICAgICAgfQogICAgICAgIHZhciBrID0gW10KICAgICAgICBmb3IgKAogICAgICAgICAgaCA9IGQgPSAwOwogICAgICAgICAgbnVsbCAhPSAoZSA9IGYuZXhlYyhnKSkgJiYKICAgICAgICAgIGUuaW5kZXggIT09IGYubGFzdEluZGV4ICYmCiAgICAgICAgICAhKGsucHVzaChuZXcgU2suYnVpbHRpbi5zdHIoZy5zdWJzdHJpbmcoZCwgZS5pbmRleCkpKSwKICAgICAgICAgIChkID0gZi5sYXN0SW5kZXgpLAogICAgICAgICAgKGggKz0gMSksCiAgICAgICAgICBjICYmIGggPj0gYyk7CgogICAgICAgICk7CiAgICAgICAgZyA9IGcuc3Vic3RyaW5nKGQpCiAgICAgICAgOyhudWxsICE9PSBiIHx8IDAgPCBnLmxlbmd0aCkgJiYgay5wdXNoKG5ldyBTay5idWlsdGluLnN0cihnKSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubGlzdChrKQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUuc3RyaXAgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigic3RyaXAiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyKQogICAgICAgIGlmICh2b2lkIDAgIT09IGIgJiYgIVNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoInN0cmlwIGFyZyBtdXN0IGJlIE5vbmUgb3Igc3RyIikKICAgICAgICBpZiAodm9pZCAwID09PSBiKSB2YXIgYyA9IC9eXHMrfFxzKyQvZwogICAgICAgIGVsc2UKICAgICAgICAgIChjID0gU2suYnVpbHRpbi5zdHIucmVfZXNjYXBlXyhiLnYpKSwKICAgICAgICAgICAgKGMgPSBuZXcgUmVnRXhwKCJeWyIgKyBjICsgIl0rfFsiICsgYyArICJdKyQiLCAiZyIpKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoYS52LnJlcGxhY2UoYywgIiIpKQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUubHN0cmlwID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImxzdHJpcCIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDIpCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gYiAmJiAhU2suYnVpbHRpbi5jaGVja1N0cmluZyhiKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigibHN0cmlwIGFyZyBtdXN0IGJlIE5vbmUgb3Igc3RyIikKICAgICAgICBpZiAodm9pZCAwID09PSBiKSB2YXIgYyA9IC9eXHMrL2cKICAgICAgICBlbHNlCiAgICAgICAgICAoYyA9IFNrLmJ1aWx0aW4uc3RyLnJlX2VzY2FwZV8oYi52KSksCiAgICAgICAgICAgIChjID0gbmV3IFJlZ0V4cCgiXlsiICsgYyArICJdKyIsICJnIikpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihhLnYucmVwbGFjZShjLCAiIikpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5yc3RyaXAgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigicnN0cmlwIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMikKICAgICAgICBpZiAodm9pZCAwICE9PSBiICYmICFTay5idWlsdGluLmNoZWNrU3RyaW5nKGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJyc3RyaXAgYXJnIG11c3QgYmUgTm9uZSBvciBzdHIiKQogICAgICAgIGlmICh2b2lkIDAgPT09IGIpIHZhciBjID0gL1xzKyQvZwogICAgICAgIGVsc2UKICAgICAgICAgIChjID0gU2suYnVpbHRpbi5zdHIucmVfZXNjYXBlXyhiLnYpKSwKICAgICAgICAgICAgKGMgPSBuZXcgUmVnRXhwKCJbIiArIGMgKyAiXSskIiwgImciKSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGEudi5yZXBsYWNlKGMsICIiKSkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLl9fZm9ybWF0X18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fZm9ybWF0X18iLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrU3RyaW5nKGIpKSB7CiAgICAgICAgICB2YXIgYyA9IFNrLmZmaS5yZW1hcFRvSnMoYikKICAgICAgICAgIGlmICgiIiAhPT0gYyAmJiAicyIgIT09IGMpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAgICAgImZvcm1hdCBzcGVjIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQiLAogICAgICAgICAgICApCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChTay5fX2Z1dHVyZV9fLmV4Y2VwdGlvbnMpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAiZm9ybWF0KCkgYXJndW1lbnQgMiBtdXN0IGJlIHN0ciwgbm90ICIgKyBTay5hYnN0ci50eXBlTmFtZShiKSwKICAgICAgICAgICAgKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiZm9ybWF0IGV4cGVjdHMgYXJnIDIgdG8gYmUgc3RyaW5nIG9yIHVuaWNvZGUsIG5vdCAiICsKICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShiKSwKICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihhKQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUucGFydGl0aW9uID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInBhcnRpdGlvbiIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDIpCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrVHlwZSgic2VwIiwgInN0cmluZyIsIFNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYikpCiAgICAgICAgdmFyIGMgPSBuZXcgU2suYnVpbHRpbi5zdHIoYikKICAgICAgICB2YXIgZCA9IGEudi5pbmRleE9mKGMudikKICAgICAgICByZXR1cm4gMCA+IGQKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4udHVwbGUoWwogICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgU2suYnVpbHRpbi5zdHIuJGVtcHR5c3RyLAogICAgICAgICAgICAgIFNrLmJ1aWx0aW4uc3RyLiRlbXB0eXN0ciwKICAgICAgICAgICAgXSkKICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4udHVwbGUoWwogICAgICAgICAgICAgIG5ldyBTay5idWlsdGluLnN0cihhLnYuc3Vic3RyaW5nKDAsIGQpKSwKICAgICAgICAgICAgICBjLAogICAgICAgICAgICAgIG5ldyBTay5idWlsdGluLnN0cihhLnYuc3Vic3RyaW5nKGQgKyBjLnYubGVuZ3RoKSksCiAgICAgICAgICAgIF0pCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5ycGFydGl0aW9uID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICApIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJycGFydGl0aW9uIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMikKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tUeXBlKCJzZXAiLCAic3RyaW5nIiwgU2suYnVpbHRpbi5jaGVja1N0cmluZyhiKSkKICAgICAgICB2YXIgYyA9IG5ldyBTay5idWlsdGluLnN0cihiKQogICAgICAgIHZhciBkID0gYS52Lmxhc3RJbmRleE9mKGMudikKICAgICAgICByZXR1cm4gMCA+IGQKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4udHVwbGUoWwogICAgICAgICAgICAgIFNrLmJ1aWx0aW4uc3RyLiRlbXB0eXN0ciwKICAgICAgICAgICAgICBTay5idWlsdGluLnN0ci4kZW1wdHlzdHIsCiAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgXSkKICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4udHVwbGUoWwogICAgICAgICAgICAgIG5ldyBTay5idWlsdGluLnN0cihhLnYuc3Vic3RyaW5nKDAsIGQpKSwKICAgICAgICAgICAgICBjLAogICAgICAgICAgICAgIG5ldyBTay5idWlsdGluLnN0cihhLnYuc3Vic3RyaW5nKGQgKyBjLnYubGVuZ3RoKSksCiAgICAgICAgICAgIF0pCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5jb3VudCA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgICBjLAogICAgICAgIGQsCiAgICAgICkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImNvdW50IiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgNCkKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImV4cGVjdGVkIGEgY2hhcmFjdGVyIGJ1ZmZlciBvYmplY3QiKQogICAgICAgIGlmICh2b2lkIDAgIT09IGMgJiYgIVNrLmJ1aWx0aW4uY2hlY2tJbnQoYykpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJzbGljZSBpbmRpY2VzIG11c3QgYmUgaW50ZWdlcnMgb3IgTm9uZSBvciBoYXZlIGFuIF9faW5kZXhfXyBtZXRob2QiLAogICAgICAgICAgKQogICAgICAgIGlmICh2b2lkIDAgIT09IGQgJiYgIVNrLmJ1aWx0aW4uY2hlY2tJbnQoZCkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJzbGljZSBpbmRpY2VzIG11c3QgYmUgaW50ZWdlcnMgb3IgTm9uZSBvciBoYXZlIGFuIF9faW5kZXhfXyBtZXRob2QiLAogICAgICAgICAgKQogICAgICAgIHZvaWQgMCA9PT0gYwogICAgICAgICAgPyAoYyA9IDApCiAgICAgICAgICA6ICgoYyA9IFNrLmJ1aWx0aW4uYXNudW0kKGMpKSwgKGMgPSAwIDw9IGMgPyBjIDogYS52Lmxlbmd0aCArIGMpKQogICAgICAgIHZvaWQgMCA9PT0gZAogICAgICAgICAgPyAoZCA9IGEudi5sZW5ndGgpCiAgICAgICAgICA6ICgoZCA9IFNrLmJ1aWx0aW4uYXNudW0kKGQpKSwgKGQgPSAwIDw9IGQgPyBkIDogYS52Lmxlbmd0aCArIGQpKQogICAgICAgIHZhciBlID0gYi52LnJlcGxhY2UoL1stW1xde30oKSorPy4sXFxeJHwjXHNdL2csICJcXCQmIikKICAgICAgICBlID0gbmV3IFJlZ0V4cChlLCAiZyIpCiAgICAgICAgcmV0dXJuIChlID0gYS52LnNsaWNlKGMsIGQpLm1hdGNoKGUpKQogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5pbnRfKGUubGVuZ3RoKQogICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5pbnRfKDApCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5sanVzdCA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJsanVzdCIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDMpCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrSW50KGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiaW50ZWdlciBhcmd1bWVudCBleGVwY3RlZCwgZ290ICIgKyBTay5hYnN0ci50eXBlTmFtZShiKSwKICAgICAgICAgICkKICAgICAgICBpZiAodm9pZCAwICE9PSBjICYmICghU2suYnVpbHRpbi5jaGVja1N0cmluZyhjKSB8fCAxICE9PSBjLnYubGVuZ3RoKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIm11c3QgYmUgY2hhciwgbm90ICIgKyBTay5hYnN0ci50eXBlTmFtZShjKSwKICAgICAgICAgICkKICAgICAgICBjID0gdm9pZCAwID09PSBjID8gIiAiIDogYy52CiAgICAgICAgYiA9IFNrLmJ1aWx0aW4uYXNudW0kKGIpCiAgICAgICAgaWYgKGEudi5sZW5ndGggPj0gYikgcmV0dXJuIGEKICAgICAgICB2YXIgZCA9IEFycmF5LnByb3RvdHlwZS5qb2luLmNhbGwoCiAgICAgICAgICB7IGxlbmd0aDogTWF0aC5mbG9vcihiIC0gYS52Lmxlbmd0aCkgKyAxIH0sCiAgICAgICAgICBjLAogICAgICAgICkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGEudiArIGQpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5yanVzdCA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJyanVzdCIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDMpCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrSW50KGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiaW50ZWdlciBhcmd1bWVudCBleGVwY3RlZCwgZ290ICIgKyBTay5hYnN0ci50eXBlTmFtZShiKSwKICAgICAgICAgICkKICAgICAgICBpZiAodm9pZCAwICE9PSBjICYmICghU2suYnVpbHRpbi5jaGVja1N0cmluZyhjKSB8fCAxICE9PSBjLnYubGVuZ3RoKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIm11c3QgYmUgY2hhciwgbm90ICIgKyBTay5hYnN0ci50eXBlTmFtZShjKSwKICAgICAgICAgICkKICAgICAgICBjID0gdm9pZCAwID09PSBjID8gIiAiIDogYy52CiAgICAgICAgYiA9IFNrLmJ1aWx0aW4uYXNudW0kKGIpCiAgICAgICAgaWYgKGEudi5sZW5ndGggPj0gYikgcmV0dXJuIGEKICAgICAgICB2YXIgZCA9IEFycmF5LnByb3RvdHlwZS5qb2luLmNhbGwoCiAgICAgICAgICB7IGxlbmd0aDogTWF0aC5mbG9vcihiIC0gYS52Lmxlbmd0aCkgKyAxIH0sCiAgICAgICAgICBjLAogICAgICAgICkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGQgKyBhLnYpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5jZW50ZXIgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiY2VudGVyIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMykKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tJbnQoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJpbnRlZ2VyIGFyZ3VtZW50IGV4ZXBjdGVkLCBnb3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGIpLAogICAgICAgICAgKQogICAgICAgIGlmICh2b2lkIDAgIT09IGMgJiYgKCFTay5idWlsdGluLmNoZWNrU3RyaW5nKGMpIHx8IDEgIT09IGMudi5sZW5ndGgpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAibXVzdCBiZSBjaGFyLCBub3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGMpLAogICAgICAgICAgKQogICAgICAgIGMgPSB2b2lkIDAgPT09IGMgPyAiICIgOiBjLnYKICAgICAgICBiID0gU2suYnVpbHRpbi5hc251bSQoYikKICAgICAgICBpZiAoYS52Lmxlbmd0aCA+PSBiKSByZXR1cm4gYQogICAgICAgIHZhciBkID0gQXJyYXkucHJvdG90eXBlLmpvaW4uY2FsbCgKICAgICAgICAgIHsgbGVuZ3RoOiBNYXRoLmZsb29yKChiIC0gYS52Lmxlbmd0aCkgLyAyKSArIDEgfSwKICAgICAgICAgIGMsCiAgICAgICAgKQogICAgICAgIGQgPSBkICsgYS52ICsgZAogICAgICAgIGQubGVuZ3RoIDwgYiAmJiAoZCArPSBjKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoZCkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLmZpbmQgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICAgYywKICAgICAgICBkLAogICAgICApIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJmaW5kIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgNCkKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImV4cGVjdGVkIGEgY2hhcmFjdGVyIGJ1ZmZlciBvYmplY3QiKQogICAgICAgIGlmICh2b2lkIDAgIT09IGMgJiYgIVNrLmJ1aWx0aW4uY2hlY2tJbnQoYykpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJzbGljZSBpbmRpY2VzIG11c3QgYmUgaW50ZWdlcnMgb3IgTm9uZSBvciBoYXZlIGFuIF9faW5kZXhfXyBtZXRob2QiLAogICAgICAgICAgKQogICAgICAgIGlmICh2b2lkIDAgIT09IGQgJiYgIVNrLmJ1aWx0aW4uY2hlY2tJbnQoZCkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJzbGljZSBpbmRpY2VzIG11c3QgYmUgaW50ZWdlcnMgb3IgTm9uZSBvciBoYXZlIGFuIF9faW5kZXhfXyBtZXRob2QiLAogICAgICAgICAgKQogICAgICAgIHZvaWQgMCA9PT0gYwogICAgICAgICAgPyAoYyA9IDApCiAgICAgICAgICA6ICgoYyA9IFNrLmJ1aWx0aW4uYXNudW0kKGMpKSwgKGMgPSAwIDw9IGMgPyBjIDogYS52Lmxlbmd0aCArIGMpKQogICAgICAgIHZvaWQgMCA9PT0gZAogICAgICAgICAgPyAoZCA9IGEudi5sZW5ndGgpCiAgICAgICAgICA6ICgoZCA9IFNrLmJ1aWx0aW4uYXNudW0kKGQpKSwgKGQgPSAwIDw9IGQgPyBkIDogYS52Lmxlbmd0aCArIGQpKQogICAgICAgIHZhciBlID0gYS52LmluZGV4T2YoYi52LCBjKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKGUgPj0gYyAmJiBlIDwgZCA/IGUgOiAtMSkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLmluZGV4ID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICAgIGMsCiAgICAgICAgZCwKICAgICAgKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaW5kZXgiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCA0KQogICAgICAgIHZhciBlID0gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGEuZmluZCwgW2EsIGIsIGMsIGRdKQogICAgICAgIGlmICgtMSA9PT0gU2suYnVpbHRpbi5hc251bSQoZSkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJzdWJzdHJpbmcgbm90IGZvdW5kIikKICAgICAgICByZXR1cm4gZQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUucmZpbmQgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICAgYywKICAgICAgICBkLAogICAgICApIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJyZmluZCIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDQpCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrU3RyaW5nKGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJleHBlY3RlZCBhIGNoYXJhY3RlciBidWZmZXIgb2JqZWN0IikKICAgICAgICBpZiAodm9pZCAwICE9PSBjICYmICFTay5idWlsdGluLmNoZWNrSW50KGMpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAic2xpY2UgaW5kaWNlcyBtdXN0IGJlIGludGVnZXJzIG9yIE5vbmUgb3IgaGF2ZSBhbiBfX2luZGV4X18gbWV0aG9kIiwKICAgICAgICAgICkKICAgICAgICBpZiAodm9pZCAwICE9PSBkICYmICFTay5idWlsdGluLmNoZWNrSW50KGQpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAic2xpY2UgaW5kaWNlcyBtdXN0IGJlIGludGVnZXJzIG9yIE5vbmUgb3IgaGF2ZSBhbiBfX2luZGV4X18gbWV0aG9kIiwKICAgICAgICAgICkKICAgICAgICB2b2lkIDAgPT09IGMKICAgICAgICAgID8gKGMgPSAwKQogICAgICAgICAgOiAoKGMgPSBTay5idWlsdGluLmFzbnVtJChjKSksIChjID0gMCA8PSBjID8gYyA6IGEudi5sZW5ndGggKyBjKSkKICAgICAgICB2b2lkIDAgPT09IGQKICAgICAgICAgID8gKGQgPSBhLnYubGVuZ3RoKQogICAgICAgICAgOiAoKGQgPSBTay5idWlsdGluLmFzbnVtJChkKSksIChkID0gMCA8PSBkID8gZCA6IGEudi5sZW5ndGggKyBkKSkKICAgICAgICB2YXIgZSA9IGEudi5sYXN0SW5kZXhPZihiLnYsIGQpCiAgICAgICAgZSA9IGUgIT09IGQgPyBlIDogYS52Lmxhc3RJbmRleE9mKGIudiwgZCAtIDEpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oZSA+PSBjICYmIGUgPCBkID8gZSA6IC0xKQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUucmluZGV4ID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICAgIGMsCiAgICAgICAgZCwKICAgICAgKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigicmluZGV4IiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgNCkKICAgICAgICB2YXIgZSA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShhLnJmaW5kLCBbYSwgYiwgYywgZF0pCiAgICAgICAgaWYgKC0xID09PSBTay5idWlsdGluLmFzbnVtJChlKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoInN1YnN0cmluZyBub3QgZm91bmQiKQogICAgICAgIHJldHVybiBlCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5zdGFydHN3aXRoID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICApIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJzdGFydHN3aXRoIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMikKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tUeXBlKCJ0Z3QiLCAic3RyaW5nIiwgU2suYnVpbHRpbi5jaGVja1N0cmluZyhiKSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uYm9vbCgwID09PSBhLnYuaW5kZXhPZihiLnYpKQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUuZW5kc3dpdGggPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiZW5kc3dpdGgiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja1R5cGUoInRndCIsICJzdHJpbmciLCBTay5idWlsdGluLmNoZWNrU3RyaW5nKGIpKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5ib29sKAogICAgICAgICAgLTEgIT09IGEudi5pbmRleE9mKGIudiwgYS52Lmxlbmd0aCAtIGIudi5sZW5ndGgpLAogICAgICAgICkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLnJlcGxhY2UgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICAgYywKICAgICAgICBkLAogICAgICApIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJyZXBsYWNlIiwgYXJndW1lbnRzLmxlbmd0aCwgMywgNCkKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tUeXBlKCJvbGRTIiwgInN0cmluZyIsIFNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYikpCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrVHlwZSgibmV3UyIsICJzdHJpbmciLCBTay5idWlsdGluLmNoZWNrU3RyaW5nKGMpKQogICAgICAgIGlmICh2b2lkIDAgIT09IGQgJiYgIVNrLmJ1aWx0aW4uY2hlY2tJbnQoZCkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJpbnRlZ2VyIGFyZ3VtZW50IGV4cGVjdGVkLCBnb3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGQpLAogICAgICAgICAgKQogICAgICAgIGQgPSBTay5idWlsdGluLmFzbnVtJChkKQogICAgICAgIHZhciBlID0gbmV3IFJlZ0V4cChTay5idWlsdGluLnN0ci5yZV9lc2NhcGVfKGIudiksICJnIikKICAgICAgICBpZiAodm9pZCAwID09PSBkIHx8IDAgPiBkKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihhLnYucmVwbGFjZShlLCBjLnYpKQogICAgICAgIHZhciBmID0gMAogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgICBhLnYucmVwbGFjZShlLCBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICBmKysKICAgICAgICAgICAgcmV0dXJuIGYgPD0gZCA/IGMudiA6IGEKICAgICAgICAgIH0pLAogICAgICAgICkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLnpmaWxsID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjID0gYS52LAogICAgICAgICAgZCA9ICIiCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiemZpbGwiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0ludChiKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgImludGVnZXIgYXJndW1lbnQgZXhlcGVjdGVkLCBnb3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGIpLAogICAgICAgICAgKQogICAgICAgIHZhciBlID0gYi52IC0gYy5sZW5ndGgKICAgICAgICB2YXIgZiA9ICIrIiA9PT0gY1swXSB8fCAiLSIgPT09IGNbMF0gPyAxIDogMAogICAgICAgIGZvciAodmFyIGcgPSAwOyBnIDwgZTsgZysrKSBkICs9ICIwIgogICAgICAgIGMgPSBjLnN1YnN0cigwLCBmKSArIGQgKyBjLnN1YnN0cihmKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoYykKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLmlzZGlnaXQgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaXNkaWdpdCIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmJvb2woL15cZCskLy50ZXN0KGEudikpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5pc3NwYWNlID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImlzc3BhY2UiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5ib29sKC9eXHMrJC8udGVzdChhLnYpKQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUuZXhwYW5kdGFicyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiZXhwYW5kdGFicyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDIpCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gYiAmJiAhU2suYnVpbHRpbi5jaGVja0ludChiKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgImludGVnZXIgYXJndW1lbnQgZXhlcGVjdGVkLCBnb3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGIpLAogICAgICAgICAgKQogICAgICAgIGIgPSB2b2lkIDAgPT09IGIgPyA4IDogU2suYnVpbHRpbi5hc251bSQoYikKICAgICAgICB2YXIgYyA9IEFycmF5KGIgKyAxKS5qb2luKCIgIikKICAgICAgICB2YXIgZCA9IGEudi5yZXBsYWNlKC8oW15cclxuXHRdKilcdC9nLCBmdW5jdGlvbiAoYSwgZCkgewogICAgICAgICAgcmV0dXJuIGQgKyBjLnNsaWNlKGQubGVuZ3RoICUgYikKICAgICAgICB9KQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoZCkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLnN3YXBjYXNlID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInN3YXBjYXNlIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICB2YXIgYiA9IGEudi5yZXBsYWNlKC9bYS16XS9naSwgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHZhciBiID0gYS50b0xvd2VyQ2FzZSgpCiAgICAgICAgICByZXR1cm4gYiA9PT0gYSA/IGEudG9VcHBlckNhc2UoKSA6IGIKICAgICAgICB9KQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoYikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLnNwbGl0bGluZXMgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIHZhciBjID0gYS52LAogICAgICAgICAgZCwKICAgICAgICAgIGUgPSBhLnYubGVuZ3RoLAogICAgICAgICAgZiA9IFtdLAogICAgICAgICAgZyA9IDAKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJzcGxpdGxpbmVzIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMikKICAgICAgICBpZiAodm9pZCAwICE9PSBiICYmICFTay5idWlsdGluLmNoZWNrQm9vbChiKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgImJvb2xlYW4gYXJndW1lbnQgZXhwZWN0ZWQsIGdvdCAiICsgU2suYWJzdHIudHlwZU5hbWUoYiksCiAgICAgICAgICApCiAgICAgICAgYiA9IHZvaWQgMCA9PT0gYiA/ICExIDogYi52CiAgICAgICAgZm9yIChkID0gMDsgZCA8IGU7IGQrKykgewogICAgICAgICAgdmFyIGggPSBjLmNoYXJBdChkKQogICAgICAgICAgaWYgKCJcbiIgPT09IGMuY2hhckF0KGQgKyAxKSAmJiAiXHIiID09PSBoKQogICAgICAgICAgICAoaCA9IGQgKyAyKSwKICAgICAgICAgICAgICAoZyA9IGMuc2xpY2UoZywgaCkpLAogICAgICAgICAgICAgIGIgfHwgKGcgPSBnLnJlcGxhY2UoLyhccnxcbikvZywgIiIpKSwKICAgICAgICAgICAgICBmLnB1c2gobmV3IFNrLmJ1aWx0aW4uc3RyKGcpKSwKICAgICAgICAgICAgICAoZyA9IGgpCiAgICAgICAgICBlbHNlIGlmICgoIlxuIiA9PT0gaCAmJiAiXHIiICE9PSBjLmNoYXJBdChkIC0gMSkpIHx8ICJcciIgPT09IGgpCiAgICAgICAgICAgIChoID0gZCArIDEpLAogICAgICAgICAgICAgIChnID0gYy5zbGljZShnLCBoKSksCiAgICAgICAgICAgICAgYiB8fCAoZyA9IGcucmVwbGFjZSgvKFxyfFxuKS9nLCAiIikpLAogICAgICAgICAgICAgIGYucHVzaChuZXcgU2suYnVpbHRpbi5zdHIoZykpLAogICAgICAgICAgICAgIChnID0gaCkKICAgICAgICB9CiAgICAgICAgZyA8IGUgJiYKICAgICAgICAgICgoZyA9IGMuc2xpY2UoZywgZSkpLAogICAgICAgICAgYiB8fCAoZyA9IGcucmVwbGFjZSgvKFxyfFxuKS9nLCAiIikpLAogICAgICAgICAgZi5wdXNoKG5ldyBTay5idWlsdGluLnN0cihnKSkpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxpc3QoZikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLnRpdGxlID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInRpdGxlIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICB2YXIgYiA9IGEudi5yZXBsYWNlKC9bYS16XVthLXpdKi9naSwgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhWzBdLnRvVXBwZXJDYXNlKCkgKyBhLnN1YnN0cigxKS50b0xvd2VyQ2FzZSgpCiAgICAgICAgfSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGIpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5pc2FscGhhID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImlzYWxwaGEiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5ib29sKGEudi5sZW5ndGggJiYgIS9bXmEtekEtWl0vLnRlc3QoYS52KSkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLmlzYWxudW0gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaXNhbG51bSIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmJvb2woYS52Lmxlbmd0aCAmJiAhL1teYS16QS1aMC05XS8udGVzdChhLnYpKQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUuaXNudW1lcmljID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImlzbnVtZXJpYyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmJvb2woYS52Lmxlbmd0aCAmJiAhL1teMC05XS8udGVzdChhLnYpKQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUuaXNsb3dlciA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJpc2xvd2VyIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uYm9vbCgKICAgICAgICAgIGEudi5sZW5ndGggJiYgL1thLXpdLy50ZXN0KGEudikgJiYgIS9bQS1aXS8udGVzdChhLnYpLAogICAgICAgICkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLmlzdXBwZXIgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaXN1cHBlciIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmJvb2woCiAgICAgICAgICBhLnYubGVuZ3RoICYmICEvW2Etel0vLnRlc3QoYS52KSAmJiAvW0EtWl0vLnRlc3QoYS52KSwKICAgICAgICApCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc3RyLnByb3RvdHlwZS5pc3RpdGxlID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0gYS52LAogICAgICAgICAgYyA9ICExLAogICAgICAgICAgZCA9ICExLAogICAgICAgICAgZQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImlzdGl0bGUiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxKQogICAgICAgIGZvciAoZSA9IDA7IGUgPCBiLmxlbmd0aDsgZSsrKSB7CiAgICAgICAgICB2YXIgZiA9IGIuY2hhckF0KGUpCiAgICAgICAgICBpZiAoIS9bYS16XS8udGVzdChmKSAmJiAvW0EtWl0vLnRlc3QoZikpIHsKICAgICAgICAgICAgaWYgKGQpIHJldHVybiBuZXcgU2suYnVpbHRpbi5ib29sKCExKQogICAgICAgICAgICBjID0gZCA9ICEwCiAgICAgICAgICB9IGVsc2UgaWYgKC9bYS16XS8udGVzdChmKSAmJiAhL1tBLVpdLy50ZXN0KGYpKSB7CiAgICAgICAgICAgIGlmICghZCkgcmV0dXJuIG5ldyBTay5idWlsdGluLmJvb2woITEpCiAgICAgICAgICAgIGMgPSAhMAogICAgICAgICAgfSBlbHNlIGQgPSAhMQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uYm9vbChjKQogICAgICB9KQogICAgICBTay5idWlsdGluLnN0ci5wcm90b3R5cGUubmIkcmVtYWluZGVyID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIGEuY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4udHVwbGUgfHwKICAgICAgICAgICh2b2lkIDAgIT09IGEubXAkc3Vic2NyaXB0ICYmIGEuY29uc3RydWN0b3IgIT09IFNrLmJ1aWx0aW4uc3RyKSB8fAogICAgICAgICAgKGEgPSBuZXcgU2suYnVpbHRpbi50dXBsZShbYV0pKQogICAgICAgIHZhciBjID0gMAogICAgICAgIHZhciBkID0gdGhpcy52LnJlcGxhY2UoCiAgICAgICAgICAvJShcKFthLXpBLVowLTldK1wpKT8oWyMwICtcLV0rKT8oXCp8WzAtOV0rKT8oXC4oXCp8WzAtOV0rKSk/W2hsTF0/KFtkaW91eFhlRWZGZ0djcnMlXSkvZywKICAgICAgICAgIGZ1bmN0aW9uIChkLCBmLCBnLCBoLCBrLCBsLCByKSB7CiAgICAgICAgICAgIHZhciBlLCBxLCBtLCB4LCBwCiAgICAgICAgICAgIGggPSBTay5idWlsdGluLmFzbnVtJChoKQogICAgICAgICAgICBrID0gU2suYnVpbHRpbi5hc251bSQoaykKICAgICAgICAgICAgOyh2b2lkIDAgIT09IGYgJiYgIiIgIT09IGYpIHx8ICIlIiA9PSByIHx8IChlID0gYysrKQogICAgICAgICAgICAiIiA9PT0gayAmJiAoayA9IHZvaWQgMCkKICAgICAgICAgICAgdmFyIEogPSAocSA9IG0gPSB4ID0gcCA9ICExKQogICAgICAgICAgICBnICYmCiAgICAgICAgICAgICAgKC0xICE9PSBnLmluZGV4T2YoIi0iKQogICAgICAgICAgICAgICAgPyAoeCA9ICEwKQogICAgICAgICAgICAgICAgOiAtMSAhPT0gZy5pbmRleE9mKCIwIikgJiYgKHAgPSAhMCksCiAgICAgICAgICAgICAgLTEgIT09IGcuaW5kZXhPZigiKyIpCiAgICAgICAgICAgICAgICA/IChxID0gITApCiAgICAgICAgICAgICAgICA6IC0xICE9PSBnLmluZGV4T2YoIiAiKSAmJiAobSA9ICEwKSwKICAgICAgICAgICAgICAoSiA9IC0xICE9PSBnLmluZGV4T2YoIiMiKSkpCiAgICAgICAgICAgIGsgJiYgKGsgPSBwYXJzZUludChrLnN1YnN0cigxKSwgMTApKQogICAgICAgICAgICBnID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICB2YXIgYwogICAgICAgICAgICAgIGIgPSBTay5idWlsdGluLmFzbnVtJChiKQogICAgICAgICAgICAgIHZhciBkID0gITEKICAgICAgICAgICAgICBpZiAoIm51bWJlciIgPT09IHR5cGVvZiBhKSB7CiAgICAgICAgICAgICAgICAwID4gYSAmJiAoKGEgPSAtYSksIChkID0gITApKQogICAgICAgICAgICAgICAgdmFyIGUgPSBhLnRvU3RyaW5nKGIpCiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgICAgICAgICAgPyAoKGUgPSBhLnN0ciQoYiwgITEpKSwKICAgICAgICAgICAgICAgICAgICAyIDwgZS5sZW5ndGggJiYKICAgICAgICAgICAgICAgICAgICAgICIuMCIgPT09IGUuc3Vic3RyKC0yKSAmJgogICAgICAgICAgICAgICAgICAgICAgKGUgPSBlLnN1YnN0cigwLCBlLmxlbmd0aCAtIDIpKSwKICAgICAgICAgICAgICAgICAgICAoZCA9IGEubmIkaXNuZWdhdGl2ZSgpKSkKICAgICAgICAgICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfCiAgICAgICAgICAgICAgICAgID8gKChlID0gYS5zdHIkKGIsICExKSksIChkID0gYS5uYiRpc25lZ2F0aXZlKCkpKQogICAgICAgICAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyAmJgogICAgICAgICAgICAgICAgICAgICgoZSA9IGEuc3RyJChiLCAhMSkpLCAoZCA9IGEubmIkaXNuZWdhdGl2ZSgpKSkKICAgICAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydCh2b2lkIDAgIT09IGUsICJ1bmhhbmRsZWQgbnVtYmVyIGZvcm1hdCIpCiAgICAgICAgICAgICAgYSA9ICExCiAgICAgICAgICAgICAgaWYgKGspIGZvciAoYyA9IGUubGVuZ3RoOyBjIDwgazsgKytjKSAoZSA9ICIwIiArIGUpLCAoYSA9ICEwKQogICAgICAgICAgICAgIGMgPSAiIgogICAgICAgICAgICAgIGQgPyAoYyA9ICItIikgOiBxID8gKGMgPSAiKyIgKyBjKSA6IG0gJiYgKGMgPSAiICIgKyBjKQogICAgICAgICAgICAgIEogJiYKICAgICAgICAgICAgICAgICgxNiA9PT0gYgogICAgICAgICAgICAgICAgICA/IChjICs9ICIweCIpCiAgICAgICAgICAgICAgICAgIDogOCAhPT0gYiB8fCBhIHx8ICIwIiA9PT0gZSB8fCAoYyArPSAiMCIpKQogICAgICAgICAgICAgIHJldHVybiBbYywgZV0KICAgICAgICAgICAgfQogICAgICAgICAgICBkID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICB2YXIgYiA9IGFbMF0KICAgICAgICAgICAgICBhID0gYVsxXQogICAgICAgICAgICAgIGlmIChoKSB7CiAgICAgICAgICAgICAgICBoID0gcGFyc2VJbnQoaCwgMTApCiAgICAgICAgICAgICAgICB2YXIgYyA9IGEubGVuZ3RoICsgYi5sZW5ndGgKICAgICAgICAgICAgICAgIGlmIChwKSBmb3IgKDsgYyA8IGg7ICsrYykgYSA9ICIwIiArIGEKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHgpIGZvciAoOyBjIDwgaDsgKytjKSBhICs9ICIgIgogICAgICAgICAgICAgICAgZWxzZSBmb3IgKDsgYyA8IGg7ICsrYykgYiA9ICIgIiArIGIKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIGIgKyBhCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGEuY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4udHVwbGUpIGYgPSBhLnZbZV0KICAgICAgICAgICAgZWxzZSBpZiAodm9pZCAwICE9PSBhLm1wJHN1YnNjcmlwdCAmJiB2b2lkIDAgIT09IGYpCiAgICAgICAgICAgICAgKGYgPSBmLnN1YnN0cmluZygxLCBmLmxlbmd0aCAtIDEpKSwKICAgICAgICAgICAgICAgIChmID0gYS5tcCRzdWJzY3JpcHQobmV3IFNrLmJ1aWx0aW4uc3RyKGYpKSkKICAgICAgICAgICAgZWxzZSBpZiAoCiAgICAgICAgICAgICAgYS5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5kaWN0IHx8CiAgICAgICAgICAgICAgYS5jb25zdHJ1Y3RvciA9PT0gU2suYnVpbHRpbi5saXN0CiAgICAgICAgICAgICkKICAgICAgICAgICAgICBmID0gYQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uQXR0cmlidXRlRXJyb3IoCiAgICAgICAgICAgICAgICBhLnRwJG5hbWUgKyAiIGluc3RhbmNlIGhhcyBubyBhdHRyaWJ1dGUgJ21wJHN1YnNjcmlwdCciLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgaWYgKCJkIiA9PT0gciB8fCAiaSIgPT09IHIpIHJldHVybiBkKGcoZiwgMTApKQogICAgICAgICAgICBpZiAoIm8iID09PSByKSByZXR1cm4gZChnKGYsIDgpKQogICAgICAgICAgICBpZiAoIngiID09PSByKSByZXR1cm4gZChnKGYsIDE2KSkKICAgICAgICAgICAgaWYgKCJYIiA9PT0gcikgcmV0dXJuIGQoZyhmLCAxNikpLnRvVXBwZXJDYXNlKCkKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICJmIiA9PT0gciB8fAogICAgICAgICAgICAgICJGIiA9PT0gciB8fAogICAgICAgICAgICAgICJlIiA9PT0gciB8fAogICAgICAgICAgICAgICJFIiA9PT0gciB8fAogICAgICAgICAgICAgICJnIiA9PT0gciB8fAogICAgICAgICAgICAgICJHIiA9PT0gcgogICAgICAgICAgICApIHsKICAgICAgICAgICAgICBlID0gU2suYnVpbHRpbi5hc251bSQoZikKICAgICAgICAgICAgICAic3RyaW5nIiA9PT0gdHlwZW9mIGUgJiYgKGUgPSBOdW1iZXIoZSkpCiAgICAgICAgICAgICAgaWYgKEluZmluaXR5ID09PSBlKSByZXR1cm4gImluZiIKICAgICAgICAgICAgICBpZiAoLUluZmluaXR5ID09PSBlKSByZXR1cm4gIi1pbmYiCiAgICAgICAgICAgICAgaWYgKGlzTmFOKGUpKSByZXR1cm4gIm5hbiIKICAgICAgICAgICAgICBnID0gWyJ0b0V4cG9uZW50aWFsIiwgInRvRml4ZWQiLCAidG9QcmVjaXNpb24iXVsKICAgICAgICAgICAgICAgICJlZmciLmluZGV4T2Yoci50b0xvd2VyQ2FzZSgpKQogICAgICAgICAgICAgIF0KICAgICAgICAgICAgICBpZiAodm9pZCAwID09PSBrIHx8ICIiID09PSBrKQogICAgICAgICAgICAgICAgaWYgKCJlIiA9PT0gciB8fCAiRSIgPT09IHIpIGsgPSA2CiAgICAgICAgICAgICAgICBlbHNlIGlmICgiZiIgPT09IHIgfHwgIkYiID09PSByKQogICAgICAgICAgICAgICAgICBrID0gU2suX19mdXR1cmVfXy5weXRob24zID8gNiA6IDcKICAgICAgICAgICAgICBnID0gZVtnXShrKQogICAgICAgICAgICAgIFNrLmJ1aWx0aW4uY2hlY2tGbG9hdChmKSAmJgogICAgICAgICAgICAgICAgMCA9PT0gZSAmJgogICAgICAgICAgICAgICAgLUluZmluaXR5ID09PSAxIC8gZSAmJgogICAgICAgICAgICAgICAgKGcgPSAiLSIgKyBnKQogICAgICAgICAgICAgIFNrLl9fZnV0dXJlX18ucHl0aG9uMyAmJgogICAgICAgICAgICAgICAgKDcgPD0gZy5sZW5ndGggJiYKICAgICAgICAgICAgICAgICAgIjAuMDAwMCIgPT0gZy5zbGljZSgwLCA2KSAmJgogICAgICAgICAgICAgICAgICAoKGIgPSBwYXJzZUZsb2F0KGcpKSwgKGcgPSBiLnRvRXhwb25lbnRpYWwoKSkpLAogICAgICAgICAgICAgICAgIi0iID09IGcuY2hhckF0KGcubGVuZ3RoIC0gMikgJiYKICAgICAgICAgICAgICAgICAgKGcgPSBnLnNsaWNlKDAsIGcubGVuZ3RoIC0gMSkgKyAiMCIgKyBnLmNoYXJBdChnLmxlbmd0aCAtIDEpKSkKICAgICAgICAgICAgICA7LTEgIT09ICJFRkciLmluZGV4T2YocikgJiYgKGcgPSBnLnRvVXBwZXJDYXNlKCkpCiAgICAgICAgICAgICAgcmV0dXJuIGQoWyIiLCBnXSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoImMiID09PSByKSB7CiAgICAgICAgICAgICAgaWYgKCJudW1iZXIiID09PSB0eXBlb2YgZikgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoZikKICAgICAgICAgICAgICBpZiAoZiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XykgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoZi52KQogICAgICAgICAgICAgIGlmIChmIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8pCiAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShmLnYpCiAgICAgICAgICAgICAgaWYgKGYgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykKICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGYuc3RyJCgxMCwgITEpWzBdKQogICAgICAgICAgICAgIGlmIChmLmNvbnN0cnVjdG9yID09PSBTay5idWlsdGluLnN0cikgcmV0dXJuIGYudi5zdWJzdHIoMCwgMSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImFuIGludGVnZXIgaXMgcmVxdWlyZWQiKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgiciIgPT09IHIpCiAgICAgICAgICAgICAgcmV0dXJuIChyID0gU2suYnVpbHRpbi5yZXByKGYpKSwgayA/IHIudi5zdWJzdHIoMCwgaykgOiByLnYKICAgICAgICAgICAgaWYgKCJzIiA9PT0gcikgewogICAgICAgICAgICAgIHIgPSBuZXcgU2suYnVpbHRpbi5zdHIoZikKICAgICAgICAgICAgICByID0gci4kanNzdHIoKQogICAgICAgICAgICAgIGlmIChrKSByZXR1cm4gci5zdWJzdHIoMCwgaykKICAgICAgICAgICAgICBoICYmIChyID0gZChbIiAiLCByXSkpCiAgICAgICAgICAgICAgcmV0dXJuIHIKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIiUiID09PSByKSByZXR1cm4gIiUiCiAgICAgICAgICB9LAogICAgICAgICkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGQpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zdHJfaXRlcl8gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLnN0cl9pdGVyXykpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyX2l0ZXJfKGEpCiAgICAgICAgdGhpcy4kaW5kZXggPSAwCiAgICAgICAgdGhpcy4kb2JqID0gYS52LnNsaWNlKCkKICAgICAgICB0aGlzLnNxJGxlbmd0aCA9IHRoaXMuJG9iai5sZW5ndGgKICAgICAgICB0aGlzLnRwJGl0ZXIgPSB0aGlzCiAgICAgICAgdGhpcy50cCRpdGVybmV4dCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICghKHRoaXMuJGluZGV4ID49IHRoaXMuc3EkbGVuZ3RoKSkKICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cih0aGlzLiRvYmouc3Vic3RyKHRoaXMuJGluZGV4KyssIDEpKQogICAgICAgIH0KICAgICAgICB0aGlzLiRyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigiaXRlcmF0b3IiKQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIml0ZXJhdG9yIiwKICAgICAgICBTay5idWlsdGluLnN0cl9pdGVyXywKICAgICAgICBTay5idWlsdGluLm9iamVjdCwKICAgICAgKQogICAgICBTay5idWlsdGluLnN0cl9pdGVyXy5wcm90b3R5cGUuX19jbGFzc19fID0gU2suYnVpbHRpbi5zdHJfaXRlcl8KICAgICAgU2suYnVpbHRpbi5zdHJfaXRlcl8ucHJvdG90eXBlLl9faXRlcl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoCiAgICAgICAgYSwKICAgICAgKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19pdGVyX18iLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMCwgITEpCiAgICAgICAgcmV0dXJuIGEKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zdHJfaXRlcl8ucHJvdG90eXBlLm5leHQkID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBhID0gYS50cCRpdGVybmV4dCgpCiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYSkgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3RvcEl0ZXJhdGlvbigpCiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwKSB7CiAgICAgIG0gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0ge30KICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKAogICAgICAgICAgImZvcm1hdCIsCiAgICAgICAgICBhcmd1bWVudHMubGVuZ3RoLAogICAgICAgICAgMCwKICAgICAgICAgIEluZmluaXR5LAogICAgICAgICAgITAsCiAgICAgICAgICAhMCwKICAgICAgICApCiAgICAgICAgdmFyIGMgPSBuZXcgU2suYnVpbHRpbnMudHVwbGUoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSkKICAgICAgICB2YXIgZCA9IG5ldyBTay5idWlsdGlucy5kaWN0KGEpCiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYXJndW1lbnRzWzFdKSByZXR1cm4gYy52CiAgICAgICAgdmFyIGUgPSAwCiAgICAgICAgaWYgKDAgIT09IGQuc2l6ZSkgewogICAgICAgICAgZCA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShTay5idWlsdGluLmRpY3QucHJvdG90eXBlLml0ZW1zLCBbZF0pCiAgICAgICAgICBmb3IgKHZhciBmIGluIGQudikgYltkLnZbZl0udlswXS52XSA9IGQudltmXS52WzFdCiAgICAgICAgfQogICAgICAgIGZvciAodmFyIGcgaW4gYy52KSAiMCIgIT09IGcgJiYgKGJbZyAtIDFdID0gYy52W2ddKQogICAgICAgIGMgPSBjLnZbMF0udi5yZXBsYWNlKAogICAgICAgICAgL3soKCg/OlxkKyl8KD86XHcrKSk/KCg/OlwuKFx3KykpfCg/OlxbKCg/OlxkKyl8KD86XHcrKSlcXSk/KSk/KD86IShbcnNdKSk/KD86OigoPzooLik/KFs8Pj1cXl0pKT8oW1wrXC1cc10pPygjKT8oMCk/KFxkKyk/KCwpPyg/OlwuKFxkKykpPyhbYmNkZUVmRmdHbm9zeFglXSk/KSk/fS9nLAogICAgICAgICAgZnVuY3Rpb24gKGEsIGMsIGQsIGcsIGYsIHEsIG0sIHgsIHAsIEosIEEsIEMsIEssIEIsIFMsIEcsIHosIFAsIFYpIHsKICAgICAgICAgICAgdmFyIGssIGwsIGgsIHIKICAgICAgICAgICAgQiA9IFNrLmJ1aWx0aW4uYXNudW0kKEIpCiAgICAgICAgICAgIEcgPSBTay5idWlsdGluLmFzbnVtJChHKQogICAgICAgICAgICBpZiAodm9pZCAwICE9PSBxICYmICIiICE9PSBxKSB7CiAgICAgICAgICAgICAgYSA9IGJbZF0KICAgICAgICAgICAgICB2YXIgbiA9CiAgICAgICAgICAgICAgICBhLmNvbnN0cnVjdG9yID09PSBBcnJheQogICAgICAgICAgICAgICAgICA/IGFbcV0KICAgICAgICAgICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5kaWN0CiAgICAgICAgICAgICAgICAgID8gU2suYWJzdHIub2JqZWN0R2V0SXRlbShhLCBuZXcgU2suYnVpbHRpbi5zdHIocSksICExKQogICAgICAgICAgICAgICAgICA6IFNrLmFic3RyLm9iamVjdEdldEl0ZW0oCiAgICAgICAgICAgICAgICAgICAgICBhLAogICAgICAgICAgICAgICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uaW50XyhwYXJzZUludChxLCAxMCkpLAogICAgICAgICAgICAgICAgICAgICAgITEsCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIGUrKwogICAgICAgICAgICB9IGVsc2UgaWYgKHZvaWQgMCAhPT0gZiAmJiAiIiAhPT0gZikgKG4gPSBiW2RdW2ZdKSwgZSsrCiAgICAgICAgICAgIGVsc2UgaWYgKHZvaWQgMCAhPT0gZCAmJiAiIiAhPT0gZCkgKG4gPSBiW2RdKSwgZSsrCiAgICAgICAgICAgIGVsc2UgaWYgKHZvaWQgMCA9PT0gYyB8fCAiIiA9PT0gYykgKHEgPSBiW2VdKSwgZSsrLCAobiA9IHEpCiAgICAgICAgICAgIGVsc2UgaWYgKAogICAgICAgICAgICAgIGMgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgICAgICBjIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8gfHwKICAgICAgICAgICAgICBjIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgfHwKICAgICAgICAgICAgICAhaXNOYU4ocGFyc2VJbnQoYywgMTApKQogICAgICAgICAgICApCiAgICAgICAgICAgICAgKHEgPSBiW2NdKSwgZSsrLCAobiA9IHEpCiAgICAgICAgICAgICIiID09PSBHICYmIChHID0gdm9pZCAwKQogICAgICAgICAgICBpZiAodm9pZCAwID09PSBwIHx8ICIiID09PSBwKSBwID0gIiAiCiAgICAgICAgICAgIHZhciBEID0gKGsgPSBsID0gaCA9ICExKQogICAgICAgICAgICB4ICYmCiAgICAgICAgICAgICAgKHZvaWQgMCAhPT0gQSAmJgogICAgICAgICAgICAgICAgIiIgIT09IEEgJiYKICAgICAgICAgICAgICAgICgtMSAhPT0gIi0iLmluZGV4T2YoQSkKICAgICAgICAgICAgICAgICAgPyAoaCA9ICEwKQogICAgICAgICAgICAgICAgICA6IC0xICE9PSAiKyIuaW5kZXhPZihBKQogICAgICAgICAgICAgICAgICA/IChrID0gITApCiAgICAgICAgICAgICAgICAgIDogLTEgIT09ICIgIi5pbmRleE9mKEEpICYmIChsID0gITApKSwKICAgICAgICAgICAgICBDICYmIChEID0gLTEgIT09ICIjIi5pbmRleE9mKEMpKSwKICAgICAgICAgICAgICB2b2lkIDAgPT09IEIgfHwKICAgICAgICAgICAgICAgICIiID09PSBCIHx8CiAgICAgICAgICAgICAgICAodm9pZCAwICE9PSBwICYmICIiICE9PSBwKSB8fAogICAgICAgICAgICAgICAgKHAgPSAiICIpLAogICAgICAgICAgICAgIC0xICE9PSAiJSIuaW5kZXhPZih6KSAmJiAociA9ICEwKSkKICAgICAgICAgICAgRyAmJiAoRyA9IHBhcnNlSW50KEcsIDEwKSkKICAgICAgICAgICAgdmFyIEggPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IG0gfHwgIiIgPT09IG0gfHwgInMiID09IG0pCiAgICAgICAgICAgICAgICByZXR1cm4gKGEgPSBuZXcgU2suYnVpbHRpbi5zdHIoYSkpLCBhLnYKICAgICAgICAgICAgICBpZiAoInIiID09IG0pIHJldHVybiAoYSA9IFNrLmJ1aWx0aW4ucmVwcihhKSksIGEudgogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBOID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICBiID0gU2suZmZpLnJlbWFwVG9KcyhiKQogICAgICAgICAgICAgIHIgJiYgKGIgKz0gIiUiKQogICAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IEIgJiYgIiIgIT09IEIpIHsKICAgICAgICAgICAgICAgIEIgPSBwYXJzZUludChCLCAxMCkKICAgICAgICAgICAgICAgIHZhciBjID0gYi5sZW5ndGggKyBhLmxlbmd0aAogICAgICAgICAgICAgICAgaWYgKGgpIGZvciAoOyBjIDwgQjsgKytjKSBiICs9IHAKICAgICAgICAgICAgICAgIGVsc2UgaWYgKC0xICE9PSAiPiIuaW5kZXhPZihKKSkgZm9yICg7IGMgPCBCOyArK2MpIGEgPSBwICsgYQogICAgICAgICAgICAgICAgZWxzZSBpZiAoLTEgIT09ICJeIi5pbmRleE9mKEopKQogICAgICAgICAgICAgICAgICBmb3IgKDsgYyA8IEI7ICsrYykKICAgICAgICAgICAgICAgICAgICAwID09PSBjICUgMiA/IChhID0gcCArIGEpIDogMSA9PT0gYyAlIDIgJiYgKGIgKz0gcCkKICAgICAgICAgICAgICAgIGVsc2UgaWYgKC0xICE9PSAiPSIuaW5kZXhPZihKKSkgZm9yICg7IGMgPCBCOyArK2MpIGIgPSBwICsgYgogICAgICAgICAgICAgICAgZWxzZSBmb3IgKDsgYyA8IEI7ICsrYykgYiArPSBwCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBIKGEgKyBiKQogICAgICAgICAgICB9CiAgICAgICAgICAgIEEgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgIGIgPSBTay5idWlsdGluLmFzbnVtJChiKQogICAgICAgICAgICAgIHZhciBjID0gITEKICAgICAgICAgICAgICBpZiAodm9pZCAwID09PSB4KSByZXR1cm4gSChuKQogICAgICAgICAgICAgIGlmICgibnVtYmVyIiA9PT0gdHlwZW9mIGEpIHsKICAgICAgICAgICAgICAgIDAgPiBhICYmICgoYSA9IC1hKSwgKGMgPSAhMCkpCiAgICAgICAgICAgICAgICB2YXIgZCA9IGEudG9TdHJpbmcoYikKICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgICAgICAgICA/ICgoZCA9IGEuc3RyJChiLCAhMSkpLAogICAgICAgICAgICAgICAgICAgIDIgPCBkLmxlbmd0aCAmJgogICAgICAgICAgICAgICAgICAgICAgIi4wIiA9PT0gZC5zdWJzdHIoLTIpICYmCiAgICAgICAgICAgICAgICAgICAgICAoZCA9IGQuc3Vic3RyKDAsIGQubGVuZ3RoIC0gMikpLAogICAgICAgICAgICAgICAgICAgIChjID0gYS5uYiRpc25lZ2F0aXZlKCkpKQogICAgICAgICAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8KICAgICAgICAgICAgICAgICAgPyAoKGQgPSBhLnN0ciQoYiwgITEpKSwgKGMgPSBhLm5iJGlzbmVnYXRpdmUoKSkpCiAgICAgICAgICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICAgICAgICAgID8gKChkID0gYS5zdHIkKGIsICExKSksIChjID0gYS5uYiRpc25lZ2F0aXZlKCkpKQogICAgICAgICAgICAgICAgICA6IChkID0gYSkKICAgICAgICAgICAgICBHICYmCiAgICAgICAgICAgICAgICAoKGEgPSBOdW1iZXIoZCkpLAogICAgICAgICAgICAgICAgMCA+IGEgJiYgKChhID0gLWEpLCAoYyA9ICEwKSksCiAgICAgICAgICAgICAgICAoZCA9IGEudG9GaXhlZChHKSkpCiAgICAgICAgICAgICAgYSA9ICIiCiAgICAgICAgICAgICAgYyA/IChhID0gIi0iKSA6IGsgPyAoYSA9ICIrIikgOiBsICYmIChhID0gIiAiKQogICAgICAgICAgICAgIEQgJiYKICAgICAgICAgICAgICAgICgxNiA9PT0gYgogICAgICAgICAgICAgICAgICA/IChhICs9ICIweCIpCiAgICAgICAgICAgICAgICAgIDogOCA9PT0gYiAmJiAiMCIgIT09IGQKICAgICAgICAgICAgICAgICAgPyAoYSArPSAiMG8iKQogICAgICAgICAgICAgICAgICA6IDIgPT09IGIgJiYgIjAiICE9PSBkICYmIChhICs9ICIwYiIpKQogICAgICAgICAgICAgICJuIiA9PT0gegogICAgICAgICAgICAgICAgPyAoZCA9IGQudG9Mb2NhbGVTdHJpbmcoKSkKICAgICAgICAgICAgICAgIDogLTEgIT09ICIsIi5pbmRleE9mKFMpICYmCiAgICAgICAgICAgICAgICAgICgoYiA9IGQudG9TdHJpbmcoKS5zcGxpdCgiLiIpKSwKICAgICAgICAgICAgICAgICAgKGJbMF0gPSBiWzBdLnJlcGxhY2UoL1xCKD89KFxkezN9KSsoPyFcZCkpL2csICIsIikpLAogICAgICAgICAgICAgICAgICAoZCA9IGIuam9pbigiLiIpKSkKICAgICAgICAgICAgICByZXR1cm4gTihhLCBkKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgiZCIgPT09IHogfHwgIm4iID09PSB6IHx8ICIiID09PSB6IHx8IHZvaWQgMCA9PT0geikKICAgICAgICAgICAgICByZXR1cm4gQShuLCAxMCkKICAgICAgICAgICAgaWYgKCJiIiA9PT0geikgcmV0dXJuIEEobiwgMikKICAgICAgICAgICAgaWYgKCJvIiA9PT0geikgcmV0dXJuIEEobiwgOCkKICAgICAgICAgICAgaWYgKCJ4IiA9PT0geikgcmV0dXJuIEEobiwgMTYpCiAgICAgICAgICAgIGlmICgiWCIgPT09IHopIHJldHVybiBBKG4sIDE2KS50b1VwcGVyQ2FzZSgpCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAiZiIgPT09IHogfHwKICAgICAgICAgICAgICAiRiIgPT09IHogfHwKICAgICAgICAgICAgICAiZSIgPT09IHogfHwKICAgICAgICAgICAgICAiRSIgPT09IHogfHwKICAgICAgICAgICAgICAiZyIgPT09IHogfHwKICAgICAgICAgICAgICAiRyIgPT09IHoKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgaWYgKEQpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKAogICAgICAgICAgICAgICAgICAiQWx0ZXJuYXRlIGZvcm0gKCMpIG5vdCBhbGxvd2VkIGluIGZsb2F0IGZvcm1hdCBzcGVjaWZpZXIiLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIHEgPSBTay5idWlsdGluLmFzbnVtJChuKQogICAgICAgICAgICAgICJzdHJpbmciID09PSB0eXBlb2YgcSAmJiAocSA9IE51bWJlcihxKSkKICAgICAgICAgICAgICBpZiAoSW5maW5pdHkgPT09IHEpIHJldHVybiBOKCIiLCAiaW5mIikKICAgICAgICAgICAgICBpZiAoLUluZmluaXR5ID09PSBxKSByZXR1cm4gTigiLSIsICJpbmYiKQogICAgICAgICAgICAgIGlmIChpc05hTihxKSkgcmV0dXJuIE4oIiIsICJuYW4iKQogICAgICAgICAgICAgIEMgPSBbInRvRXhwb25lbnRpYWwiLCAidG9GaXhlZCIsICJ0b1ByZWNpc2lvbiJdWwogICAgICAgICAgICAgICAgImVmZyIuaW5kZXhPZih6LnRvTG93ZXJDYXNlKCkpCiAgICAgICAgICAgICAgXQogICAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IEcgfHwgIiIgPT09IEcpCiAgICAgICAgICAgICAgICBpZiAoImUiID09PSB6IHx8ICJFIiA9PT0geiB8fCAiJSIgPT09IHopIEcgPSA2CiAgICAgICAgICAgICAgICBlbHNlIGlmICgiZiIgPT09IHogfHwgIkYiID09PSB6KSBHID0gNgogICAgICAgICAgICAgIEMgPSBxW0NdKEcpCiAgICAgICAgICAgICAgOy0xICE9PSAiRUZHIi5pbmRleE9mKHopICYmIChDID0gQy50b1VwcGVyQ2FzZSgpKQogICAgICAgICAgICAgIHJldHVybiBBKEMsIDEwKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgiYyIgPT09IHopIHsKICAgICAgICAgICAgICBpZiAoIm51bWJlciIgPT09IHR5cGVvZiBuKSByZXR1cm4gTigiIiwgU3RyaW5nLmZyb21DaGFyQ29kZShuKSkKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBuIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICAgICAgICBuIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICByZXR1cm4gTigiIiwgU3RyaW5nLmZyb21DaGFyQ29kZShuLnYpKQogICAgICAgICAgICAgIGlmIChuIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcpCiAgICAgICAgICAgICAgICByZXR1cm4gTigiIiwgU3RyaW5nLmZyb21DaGFyQ29kZShuLnN0ciQoMTAsICExKVswXSkpCiAgICAgICAgICAgICAgaWYgKG4uY29uc3RydWN0b3IgPT09IFNrLmJ1aWx0aW4uc3RyKQogICAgICAgICAgICAgICAgcmV0dXJuIE4oIiIsIG4udi5zdWJzdHIoMCwgMSkpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJhbiBpbnRlZ2VyIGlzIHJlcXVpcmVkIikKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocikKICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgdm9pZCAwID09PSBHICYmIChHID0gNyksCiAgICAgICAgICAgICAgICBBKG4ubmIkbXVsdGlwbHkobmV3IFNrLmJ1aWx0aW4uaW50XygxMDApKSwgMTApCiAgICAgICAgICAgICAgKQogICAgICAgICAgfSwKICAgICAgICApCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihjKQogICAgICB9CiAgICAgIG0uY29fa3dhcmdzID0gITAKICAgICAgU2suYnVpbHRpbi5zdHIucHJvdG90eXBlLmZvcm1hdCA9IG5ldyBTay5idWlsdGluLmZ1bmMobSkKICAgIH0sCiAgICBmdW5jdGlvbiAobSwgcCkgewogICAgICBTay5idWlsdGluLnR1cGxlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLnR1cGxlKSkKICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInR1cGxlIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMSksCiAgICAgICAgICAgIG5ldyBTay5idWlsdGluLnR1cGxlKGEpCiAgICAgICAgICApCiAgICAgICAgdm9pZCAwID09PSBhICYmIChhID0gW10pCiAgICAgICAgaWYgKCJbb2JqZWN0IEFycmF5XSIgPT09IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuYXBwbHkoYSkpIHRoaXMudiA9IGEKICAgICAgICBlbHNlIGlmIChTay5idWlsdGluLmNoZWNrSXRlcmFibGUoYSkpIHsKICAgICAgICAgIHRoaXMudiA9IFtdCiAgICAgICAgICB2YXIgYyA9IFNrLmFic3RyLml0ZXIoYSkKICAgICAgICAgIGZvciAoYiA9IGMudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBiOyBiID0gYy50cCRpdGVybmV4dCgpKQogICAgICAgICAgICB0aGlzLnYucHVzaChiKQogICAgICAgIH0gZWxzZSB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImV4cGVjdGluZyBBcnJheSBvciBpdGVyYWJsZSIpCiAgICAgICAgdGhpcy5fX2NsYXNzX18gPSBTay5idWlsdGluLnR1cGxlCiAgICAgICAgdGhpcy52ID0gdGhpcy52CiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKCJ0dXBsZSIsIFNrLmJ1aWx0aW4udHVwbGUsIFNrLmJ1aWx0aW4uc2VxdHlwZSkKICAgICAgU2suYnVpbHRpbi50dXBsZS5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGEKICAgICAgICBpZiAoMCA9PT0gdGhpcy52Lmxlbmd0aCkgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigiKCkiKQogICAgICAgIHZhciBiID0gW10KICAgICAgICBmb3IgKGEgPSAwOyBhIDwgdGhpcy52Lmxlbmd0aDsgKythKQogICAgICAgICAgYlthXSA9IFNrLm1pc2NldmFsLm9iamVjdFJlcHIodGhpcy52W2FdKS52CiAgICAgICAgYSA9IGIuam9pbigiLCAiKQogICAgICAgIDEgPT09IHRoaXMudi5sZW5ndGggJiYgKGEgKz0gIiwiKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoIigiICsgYSArICIpIikKICAgICAgfQogICAgICBTay5idWlsdGluLnR1cGxlLnByb3RvdHlwZS5tcCRzdWJzY3JpcHQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmIChTay5taXNjZXZhbC5pc0luZGV4KGEpKSB7CiAgICAgICAgICB2YXIgYiA9IFNrLm1pc2NldmFsLmFzSW5kZXgoYSkKICAgICAgICAgIGlmICh2b2lkIDAgIT09IGIpIHsKICAgICAgICAgICAgMCA+IGIgJiYgKGIgPSB0aGlzLnYubGVuZ3RoICsgYikKICAgICAgICAgICAgaWYgKDAgPiBiIHx8IGIgPj0gdGhpcy52Lmxlbmd0aCkKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5JbmRleEVycm9yKCJ0dXBsZSBpbmRleCBvdXQgb2YgcmFuZ2UiKQogICAgICAgICAgICByZXR1cm4gdGhpcy52W2JdCiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zbGljZSkgewogICAgICAgICAgdmFyIGMgPSBbXQogICAgICAgICAgYS5zc3NpdGVyJCh0aGlzLCBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICBjLnB1c2goYi52W2FdKQogICAgICAgICAgfSkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi50dXBsZShjKQogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAidHVwbGUgaW5kaWNlcyBtdXN0IGJlIGludGVnZXJzLCBub3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGEpLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLnR1cGxlLnByb3RvdHlwZS50cCRoYXNoID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBhLAogICAgICAgICAgYiA9IDEwMDAwMDMsCiAgICAgICAgICBjID0gMzQzMDAwOCwKICAgICAgICAgIGQgPSB0aGlzLnYubGVuZ3RoCiAgICAgICAgZm9yIChhID0gMDsgYSA8IGQ7ICsrYSkgewogICAgICAgICAgdmFyIGUgPSBTay5idWlsdGluLmhhc2godGhpcy52W2FdKS52CiAgICAgICAgICBpZiAoLTEgPT09IGUpIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKC0xKQogICAgICAgICAgYyA9IChjIF4gZSkgKiBiCiAgICAgICAgICBiICs9IDgyNTIwICsgZCArIGQKICAgICAgICB9CiAgICAgICAgYyArPSA5NzUzMQogICAgICAgIDstMSA9PT0gYyAmJiAoYyA9IC0yKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKGMgfCAwKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udHVwbGUucHJvdG90eXBlLnNxJHJlcGVhdCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIsIGMKICAgICAgICBhID0gU2subWlzY2V2YWwuYXNJbmRleChhKQogICAgICAgIHZhciBkID0gW10KICAgICAgICBmb3IgKGMgPSAwOyBjIDwgYTsgKytjKQogICAgICAgICAgZm9yIChiID0gMDsgYiA8IHRoaXMudi5sZW5ndGg7ICsrYikgZC5wdXNoKHRoaXMudltiXSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4udHVwbGUoZCkKICAgICAgfQogICAgICBTay5idWlsdGluLnR1cGxlLnByb3RvdHlwZS5uYiRtdWx0aXBseSA9CiAgICAgICAgU2suYnVpbHRpbi50dXBsZS5wcm90b3R5cGUuc3EkcmVwZWF0CiAgICAgIFNrLmJ1aWx0aW4udHVwbGUucHJvdG90eXBlLm5iJGlucGxhY2VfbXVsdGlwbHkgPQogICAgICAgIFNrLmJ1aWx0aW4udHVwbGUucHJvdG90eXBlLnNxJHJlcGVhdAogICAgICBTay5idWlsdGluLnR1cGxlLnByb3RvdHlwZS5fX2l0ZXJfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2l0ZXJfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnR1cGxlX2l0ZXJfKGEpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4udHVwbGUucHJvdG90eXBlLnRwJGl0ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnR1cGxlX2l0ZXJfKHRoaXMpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50dXBsZS5wcm90b3R5cGUudHAkcmljaGNvbXBhcmUgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjCiAgICAgICAgaWYgKAogICAgICAgICAgIWEuX19jbGFzc19fIHx8CiAgICAgICAgICAhU2subWlzY2V2YWwuaXNUcnVlKFNrLmJ1aWx0aW4uaXNpbnN0YW5jZShhLCBTay5idWlsdGluLnR1cGxlKSkKICAgICAgICApCiAgICAgICAgICByZXR1cm4gIkVxIiA9PT0gYgogICAgICAgICAgICA/ICExCiAgICAgICAgICAgIDogIk5vdEVxIiA9PT0gYgogICAgICAgICAgICA/ICEwCiAgICAgICAgICAgIDogU2suX19mdXR1cmVfXy5weXRob24zCiAgICAgICAgICAgID8gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgICAgICAgOiAhMQogICAgICAgIHZhciBkID0gdGhpcy52CiAgICAgICAgYSA9IGEudgogICAgICAgIHZhciBlID0gZC5sZW5ndGgKICAgICAgICB2YXIgZiA9IGEubGVuZ3RoCiAgICAgICAgZm9yIChjID0gMDsgYyA8IGUgJiYgYyA8IGY7ICsrYykgewogICAgICAgICAgdmFyIGcgPSBTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woZFtjXSwgYVtjXSwgIkVxIikKICAgICAgICAgIGlmICghZykgYnJlYWsKICAgICAgICB9CiAgICAgICAgaWYgKGMgPj0gZSB8fCBjID49IGYpCiAgICAgICAgICBzd2l0Y2ggKGIpIHsKICAgICAgICAgICAgY2FzZSAiTHQiOgogICAgICAgICAgICAgIHJldHVybiBlIDwgZgogICAgICAgICAgICBjYXNlICJMdEUiOgogICAgICAgICAgICAgIHJldHVybiBlIDw9IGYKICAgICAgICAgICAgY2FzZSAiRXEiOgogICAgICAgICAgICAgIHJldHVybiBlID09PSBmCiAgICAgICAgICAgIGNhc2UgIk5vdEVxIjoKICAgICAgICAgICAgICByZXR1cm4gZSAhPT0gZgogICAgICAgICAgICBjYXNlICJHdCI6CiAgICAgICAgICAgICAgcmV0dXJuIGUgPiBmCiAgICAgICAgICAgIGNhc2UgIkd0RSI6CiAgICAgICAgICAgICAgcmV0dXJuIGUgPj0gZgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgpCiAgICAgICAgICB9CiAgICAgICAgcmV0dXJuICJFcSIgPT09IGIKICAgICAgICAgID8gITEKICAgICAgICAgIDogIk5vdEVxIiA9PT0gYgogICAgICAgICAgPyAhMAogICAgICAgICAgOiBTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woZFtjXSwgYVtjXSwgYikKICAgICAgfQogICAgICBTay5idWlsdGluLnR1cGxlLnByb3RvdHlwZS5zcSRjb25jYXQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmIChhLl9fY2xhc3NfXyAhPSBTay5idWlsdGluLnR1cGxlKQogICAgICAgICAgdGhyb3cgKAogICAgICAgICAgICAoKGEgPQogICAgICAgICAgICAgICdjYW4gb25seSBjb25jYXRlbmF0ZSB0dXBsZSAobm90ICInICsKICAgICAgICAgICAgICAoU2suYWJzdHIudHlwZU5hbWUoYSkgKyAnIikgdG8gdHVwbGUnKSksCiAgICAgICAgICAgIG5ldyBTay5idWlsdGluLlR5cGVFcnJvcihhKSkKICAgICAgICAgICkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4udHVwbGUodGhpcy52LmNvbmNhdChhLnYpKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udHVwbGUucHJvdG90eXBlLnNxJGNvbnRhaW5zID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIHZhciBjID0gdGhpcy50cCRpdGVyKCkKICAgICAgICBmb3IgKGIgPSBjLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gYjsgYiA9IGMudHAkaXRlcm5leHQoKSkKICAgICAgICAgIGlmIChTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woYiwgYSwgIkVxIikpIHJldHVybiAhMAogICAgICAgIHJldHVybiAhMQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udHVwbGUucHJvdG90eXBlLm5iJGFkZCA9IFNrLmJ1aWx0aW4udHVwbGUucHJvdG90eXBlLnNxJGNvbmNhdAogICAgICBTay5idWlsdGluLnR1cGxlLnByb3RvdHlwZS5uYiRpbnBsYWNlX2FkZCA9CiAgICAgICAgU2suYnVpbHRpbi50dXBsZS5wcm90b3R5cGUuc3EkY29uY2F0CiAgICAgIFNrLmJ1aWx0aW4udHVwbGUucHJvdG90eXBlLnNxJGxlbmd0aCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy52Lmxlbmd0aAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udHVwbGUucHJvdG90eXBlLmluZGV4ID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjID0gYS52Lmxlbmd0aCwKICAgICAgICAgIGQgPSBhLnYKICAgICAgICBmb3IgKGEgPSAwOyBhIDwgYzsgKythKQogICAgICAgICAgaWYgKFNrLm1pc2NldmFsLnJpY2hDb21wYXJlQm9vbChkW2FdLCBiLCAiRXEiKSkKICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oYSkKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJ0dXBsZS5pbmRleCh4KTogeCBub3QgaW4gdHVwbGUiKQogICAgICB9KQogICAgICBTay5idWlsdGluLnR1cGxlLnByb3RvdHlwZS5jb3VudCA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IGEudi5sZW5ndGgsCiAgICAgICAgICBkID0gYS52LAogICAgICAgICAgZSA9IDAKICAgICAgICBmb3IgKGEgPSAwOyBhIDwgYzsgKythKQogICAgICAgICAgU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGRbYV0sIGIsICJFcSIpICYmIChlICs9IDEpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oZSkKICAgICAgfSkKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLnR1cGxlIiwgU2suYnVpbHRpbi50dXBsZSkKICAgICAgU2suYnVpbHRpbi50dXBsZV9pdGVyXyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4udHVwbGVfaXRlcl8pKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnR1cGxlX2l0ZXJfKGEpCiAgICAgICAgdGhpcy4kaW5kZXggPSAwCiAgICAgICAgdGhpcy4kb2JqID0gYS52LnNsaWNlKCkKICAgICAgICB0aGlzLnNxJGxlbmd0aCA9IHRoaXMuJG9iai5sZW5ndGgKICAgICAgICB0aGlzLnRwJGl0ZXIgPSB0aGlzCiAgICAgICAgdGhpcy50cCRpdGVybmV4dCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICghKHRoaXMuJGluZGV4ID49IHRoaXMuc3EkbGVuZ3RoKSkgcmV0dXJuIHRoaXMuJG9ialt0aGlzLiRpbmRleCsrXQogICAgICAgIH0KICAgICAgICB0aGlzLiRyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigidHVwbGVpdGVyYXRvciIpCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAidHVwbGVpdGVyYXRvciIsCiAgICAgICAgU2suYnVpbHRpbi50dXBsZV9pdGVyXywKICAgICAgICBTay5idWlsdGluLm9iamVjdCwKICAgICAgKQogICAgICBTay5idWlsdGluLnR1cGxlX2l0ZXJfLnByb3RvdHlwZS5fX2NsYXNzX18gPSBTay5idWlsdGluLnR1cGxlX2l0ZXJfCiAgICAgIFNrLmJ1aWx0aW4udHVwbGVfaXRlcl8ucHJvdG90eXBlLl9faXRlcl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoCiAgICAgICAgYSwKICAgICAgKSB7CiAgICAgICAgcmV0dXJuIGEKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi50dXBsZV9pdGVyXy5wcm90b3R5cGUubmV4dCQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGEgPSBhLnRwJGl0ZXJuZXh0KCkKICAgICAgICBpZiAodm9pZCAwID09PSBhKSB0aHJvdyBuZXcgU2suYnVpbHRpbi5TdG9wSXRlcmF0aW9uKCkKICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHApIHsKICAgICAgU2suYnVpbHRpbi5kaWN0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiwgZAogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLmRpY3QpKSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZGljdChhKQogICAgICAgIHZvaWQgMCA9PT0gYSAmJiAoYSA9IFtdKQogICAgICAgIHRoaXMuc2l6ZSA9IDAKICAgICAgICB0aGlzLmJ1Y2tldHMgPSB7fQogICAgICAgIGlmICgiW29iamVjdCBBcnJheV0iID09PSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmFwcGx5KGEpKQogICAgICAgICAgZm9yIChiID0gMDsgYiA8IGEubGVuZ3RoOyBiICs9IDIpCiAgICAgICAgICAgIHRoaXMubXAkYXNzX3N1YnNjcmlwdChhW2JdLCBhW2IgKyAxXSkKICAgICAgICBlbHNlIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5kaWN0KSB7CiAgICAgICAgICB2YXIgZSA9IFNrLmFic3RyLml0ZXIoYSkKICAgICAgICAgIGZvciAoZCA9IGUudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBkOyBkID0gZS50cCRpdGVybmV4dCgpKQogICAgICAgICAgICAoYiA9IGEubXAkc3Vic2NyaXB0KGQpKSwKICAgICAgICAgICAgICB2b2lkIDAgPT09IGIgJiYgKGIgPSBudWxsKSwKICAgICAgICAgICAgICB0aGlzLm1wJGFzc19zdWJzY3JpcHQoZCwgYikKICAgICAgICB9IGVsc2UgaWYgKFNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZShhKSkKICAgICAgICAgIGZvciAoCiAgICAgICAgICAgIGUgPSBTay5hYnN0ci5pdGVyKGEpLCBiID0gZS50cCRpdGVybmV4dCgpOwogICAgICAgICAgICB2b2lkIDAgIT09IGI7CiAgICAgICAgICAgIGIgPSBlLnRwJGl0ZXJuZXh0KCkKICAgICAgICAgICkKICAgICAgICAgICAgaWYgKGIubXAkc3Vic2NyaXB0KQogICAgICAgICAgICAgIHRoaXMubXAkYXNzX3N1YnNjcmlwdChiLm1wJHN1YnNjcmlwdCgwKSwgYi5tcCRzdWJzY3JpcHQoMSkpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgICAiZWxlbWVudCAiICsgdGhpcy5zaXplICsgIiBpcyBub3QgYSBzZXF1ZW5jZSIsCiAgICAgICAgICAgICAgKQogICAgICAgIGVsc2UgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJvYmplY3QgaXMgbm90IGl0ZXJhYmxlIikKICAgICAgICB0aGlzLl9fY2xhc3NfXyA9IFNrLmJ1aWx0aW4uZGljdAogICAgICAgIHRoaXMudHAkY2FsbCA9IHZvaWQgMAogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5kaWN0LnRwJGNhbGwgPSBmdW5jdGlvbiAoYSwgYykgewogICAgICAgIHZhciBiCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiZGljdCIsIGEsIDAsIDEpCiAgICAgICAgYSA9IG5ldyBTay5idWlsdGluLmRpY3QoYVswXSkKICAgICAgICBpZiAoYykKICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCBjLmxlbmd0aDsgYiArPSAyKQogICAgICAgICAgICBhLm1wJGFzc19zdWJzY3JpcHQobmV3IFNrLmJ1aWx0aW4uc3RyKGNbYl0pLCBjW2IgKyAxXSkKICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoImRpY3QiLCBTay5idWlsdGluLmRpY3QsIFNrLmJ1aWx0aW4ub2JqZWN0KQogICAgICBTay5hYnN0ci5tYXJrVW5oYXNoYWJsZShTay5idWlsdGluLmRpY3QpCiAgICAgIHZhciBhID0gU2suYnVpbHRpbi5oYXNoCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUua2V5JGxvb2t1cCA9IGZ1bmN0aW9uIChhLCBjKSB7CiAgICAgICAgdmFyIGIsIGUKICAgICAgICBmb3IgKGUgPSAwOyBlIDwgYS5pdGVtcy5sZW5ndGg7IGUrKykgewogICAgICAgICAgdmFyIGYgPSBhLml0ZW1zW2VdCiAgICAgICAgICBpZiAoKGIgPSBTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woZi5saHMsIGMsICJFcSIpKSkgcmV0dXJuIGYKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGwKICAgICAgfQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLmtleSRwb3AgPSBmdW5jdGlvbiAoYSwgYykgewogICAgICAgIHZhciBiLCBlCiAgICAgICAgZm9yIChlID0gMDsgZSA8IGEuaXRlbXMubGVuZ3RoOyBlKyspIHsKICAgICAgICAgIHZhciBmID0gYS5pdGVtc1tlXQogICAgICAgICAgaWYgKChiID0gU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGYubGhzLCBjLCAiRXEiKSkpCiAgICAgICAgICAgIHJldHVybiBhLml0ZW1zLnNwbGljZShlLCAxKSwgLS10aGlzLnNpemUsIGYKICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5tcCRsb29rdXAgPSBmdW5jdGlvbiAoYikgewogICAgICAgIHZhciBjID0gYShiKQogICAgICAgIGMgPSB0aGlzLmJ1Y2tldHNbYy52XQogICAgICAgIGlmICh2b2lkIDAgIT09IGMgJiYgKGIgPSB0aGlzLmtleSRsb29rdXAoYywgYikpKSByZXR1cm4gYi5yaHMKICAgICAgfQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLm1wJHN1YnNjcmlwdCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiW10iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyLCAhMSwgITEpCiAgICAgICAgdmFyIGIgPSB0aGlzLm1wJGxvb2t1cChhKQogICAgICAgIGlmICh2b2lkIDAgIT09IGIpIHJldHVybiBiCiAgICAgICAgYiA9IG5ldyBTay5idWlsdGluLnN0cihhKQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLktleUVycm9yKGIudikKICAgICAgfQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLnNxJGNvbnRhaW5zID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gdm9pZCAwICE9PSB0aGlzLm1wJGxvb2t1cChhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUubXAkYXNzX3N1YnNjcmlwdCA9IGZ1bmN0aW9uIChiLCBjKSB7CiAgICAgICAgdmFyIGQgPSBhKGIpLAogICAgICAgICAgZSA9IHRoaXMuYnVja2V0c1tkLnZdCiAgICAgICAgdm9pZCAwID09PSBlCiAgICAgICAgICA/ICgoZSA9IHsgJGhhc2g6IGQsIGl0ZW1zOiBbeyBsaHM6IGIsIHJoczogYyB9XSB9KSwKICAgICAgICAgICAgKHRoaXMuYnVja2V0c1tkLnZdID0gZSksCiAgICAgICAgICAgICh0aGlzLnNpemUgKz0gMSkpCiAgICAgICAgICA6IChkID0gdGhpcy5rZXkkbG9va3VwKGUsIGIpKQogICAgICAgICAgPyAoZC5yaHMgPSBjKQogICAgICAgICAgOiAoZS5pdGVtcy5wdXNoKHsgbGhzOiBiLCByaHM6IGMgfSksICh0aGlzLnNpemUgKz0gMSkpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5tcCRkZWxfc3Vic2NyaXB0ID0gZnVuY3Rpb24gKGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJkZWwiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITEpCiAgICAgICAgdmFyIGMgPSBhKGIpCiAgICAgICAgYyA9IHRoaXMuYnVja2V0c1tjLnZdCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gYyAmJiAoKGMgPSB0aGlzLmtleSRwb3AoYywgYikpLCB2b2lkIDAgIT09IGMpKSByZXR1cm4KICAgICAgICBjID0gbmV3IFNrLmJ1aWx0aW4uc3RyKGIpCiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uS2V5RXJyb3IoYy52KQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGEsCiAgICAgICAgICBjID0gW10KICAgICAgICB2YXIgZCA9IFNrLmFic3RyLml0ZXIodGhpcykKICAgICAgICBmb3IgKGEgPSBkLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gYTsgYSA9IGQudHAkaXRlcm5leHQoKSkgewogICAgICAgICAgdmFyIGUgPSB0aGlzLm1wJHN1YnNjcmlwdChhKQogICAgICAgICAgdm9pZCAwID09PSBlICYmIChlID0gbnVsbCkKICAgICAgICAgIGUgPT09IHRoaXMKICAgICAgICAgICAgPyBjLnB1c2goU2subWlzY2V2YWwub2JqZWN0UmVwcihhKS52ICsgIjogey4uLn0iKQogICAgICAgICAgICA6IGMucHVzaCgKICAgICAgICAgICAgICAgIFNrLm1pc2NldmFsLm9iamVjdFJlcHIoYSkudiArCiAgICAgICAgICAgICAgICAgICI6ICIgKwogICAgICAgICAgICAgICAgICBTay5taXNjZXZhbC5vYmplY3RSZXByKGUpLnYsCiAgICAgICAgICAgICAgKQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKCJ7IiArIGMuam9pbigiLCAiKSArICJ9IikKICAgICAgfQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLm1wJGxlbmd0aCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy5zaXplCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5nZXQgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhLCBjLCBkKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiZ2V0KCkiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyLCAhMSwgITApCiAgICAgICAgdm9pZCAwID09PSBkICYmIChkID0gU2suYnVpbHRpbi5ub25lLm5vbmUkKQogICAgICAgIHZhciBiID0gYS5tcCRsb29rdXAoYykKICAgICAgICB2b2lkIDAgPT09IGIgJiYgKGIgPSBkKQogICAgICAgIHJldHVybiBiCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUucG9wID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYiwgYywgZCkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInBvcCgpIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMiwgITEsICEwKQogICAgICAgIHZhciBlID0gYShjKQogICAgICAgIGUgPSBiLmJ1Y2tldHNbZS52XQogICAgICAgIGlmICh2b2lkIDAgIT09IGUgJiYgKChlID0gYi5rZXkkcG9wKGUsIGMpKSwgdm9pZCAwICE9PSBlKSkgcmV0dXJuIGUucmhzCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gZCkgcmV0dXJuIGQKICAgICAgICBlID0gbmV3IFNrLmJ1aWx0aW4uc3RyKGMpCiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uS2V5RXJyb3IoZS52KQogICAgICB9KQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLmhhc19rZXkgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhLCBjKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaGFzX2tleSgpIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5ib29sKGEuc3EkY29udGFpbnMoYykpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuaXRlbXMgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiaXRlbXMoKSIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICExLCAhMCkKICAgICAgICB2YXIgYiwKICAgICAgICAgIGQgPSBbXQogICAgICAgIHZhciBlID0gU2suYWJzdHIuaXRlcihhKQogICAgICAgIGZvciAoYiA9IGUudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBiOyBiID0gZS50cCRpdGVybmV4dCgpKSB7CiAgICAgICAgICB2YXIgZiA9IGEubXAkc3Vic2NyaXB0KGIpCiAgICAgICAgICB2b2lkIDAgPT09IGYgJiYgKGYgPSBudWxsKQogICAgICAgICAgZC5wdXNoKG5ldyBTay5idWlsdGluLnR1cGxlKFtiLCBmXSkpCiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5saXN0KGQpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUua2V5cyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJrZXlzKCkiLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMSwgITApCiAgICAgICAgdmFyIGIsCiAgICAgICAgICBkID0gW10KICAgICAgICB2YXIgZSA9IFNrLmFic3RyLml0ZXIoYSkKICAgICAgICBmb3IgKGIgPSBlLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gYjsgYiA9IGUudHAkaXRlcm5leHQoKSkgZC5wdXNoKGIpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxpc3QoZCkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS52YWx1ZXMgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigidmFsdWVzKCkiLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMSwgITApCiAgICAgICAgdmFyIGIsCiAgICAgICAgICBkID0gW10KICAgICAgICB2YXIgZSA9IFNrLmFic3RyLml0ZXIoYSkKICAgICAgICBmb3IgKGIgPSBlLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gYjsgYiA9IGUudHAkaXRlcm5leHQoKSkKICAgICAgICAgIChiID0gYS5tcCRzdWJzY3JpcHQoYikpLCB2b2lkIDAgPT09IGIgJiYgKGIgPSBudWxsKSwgZC5wdXNoKGIpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxpc3QoZCkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5jbGVhciA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJjbGVhcigpIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITEsICEwKQogICAgICAgIHZhciBiCiAgICAgICAgdmFyIGQgPSBTay5hYnN0ci5pdGVyKGEpCiAgICAgICAgZm9yIChiID0gZC50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGI7IGIgPSBkLnRwJGl0ZXJuZXh0KCkpCiAgICAgICAgICBhLm1wJGRlbF9zdWJzY3JpcHQoYikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5zZXRkZWZhdWx0ID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoCiAgICAgICAgYSwKICAgICAgICBjLAogICAgICAgIGQsCiAgICAgICkgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gYS5tcCRzdWJzY3JpcHQoYykKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICB2b2lkIDAgPT09IGQgJiYgKGQgPSBTay5idWlsdGluLm5vbmUubm9uZSQpLAogICAgICAgICAgICBhLm1wJGFzc19zdWJzY3JpcHQoYywgZCksCiAgICAgICAgICAgIGQKICAgICAgICAgICkKICAgICAgICB9CiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuZGljdF9tZXJnZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZGljdCkgewogICAgICAgICAgdmFyIGQgPSBhLnRwJGl0ZXIoKQogICAgICAgICAgZm9yIChiID0gZC50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGI7IGIgPSBkLnRwJGl0ZXJuZXh0KCkpIHsKICAgICAgICAgICAgdmFyIGUgPSBhLm1wJHN1YnNjcmlwdChiKQogICAgICAgICAgICBpZiAodm9pZCAwID09PSBlKQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yKAogICAgICAgICAgICAgICAgImNhbm5vdCBnZXQgaXRlbSBmb3Iga2V5OiAiICsgYi52LAogICAgICAgICAgICAgICkKICAgICAgICAgICAgdGhpcy5tcCRhc3Nfc3Vic2NyaXB0KGIsIGUpCiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlCiAgICAgICAgICBmb3IgKAogICAgICAgICAgICBkID0gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGEua2V5cywgW2FdKSwKICAgICAgICAgICAgICBkID0gU2suYWJzdHIuaXRlcihkKSwKICAgICAgICAgICAgICBiID0gZC50cCRpdGVybmV4dCgpOwogICAgICAgICAgICB2b2lkIDAgIT09IGI7CiAgICAgICAgICAgIGIgPSBkLnRwJGl0ZXJuZXh0KCkKICAgICAgICAgICkgewogICAgICAgICAgICBlID0gYS50cCRnZXRpdGVtKGIpCiAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IGUpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uQXR0cmlidXRlRXJyb3IoCiAgICAgICAgICAgICAgICAiY2Fubm90IGdldCBpdGVtIGZvciBrZXk6ICIgKyBiLnYsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICB0aGlzLm1wJGFzc19zdWJzY3JpcHQoYiwgZSkKICAgICAgICAgIH0KICAgICAgfQogICAgICBtID0gZnVuY3Rpb24gKGEsIGMsIGQpIHsKICAgICAgICBpZiAodm9pZCAwICE9PSBkICYmICgiZGljdCIgPT09IGQudHAkbmFtZSB8fCBkLmtleXMpKSBjLmRpY3RfbWVyZ2UoZCkKICAgICAgICBlbHNlIGlmICh2b2lkIDAgIT09IGQgJiYgU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGQpKSB7CiAgICAgICAgICB2YXIgYiwKICAgICAgICAgICAgZiA9IDAKICAgICAgICAgIGQgPSBTay5hYnN0ci5pdGVyKGQpCiAgICAgICAgICBmb3IgKGIgPSBkLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gYjsgYiA9IGQudHAkaXRlcm5leHQoKSwgZisrKSB7CiAgICAgICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGIpKQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAgICJjYW5ub3QgY29udmVydCBkaWN0aW9uYXJ5IHVwZGF0ZSBzZXF1ZW5jZSBlbGVtZW50ICMiICsKICAgICAgICAgICAgICAgICAgZiArCiAgICAgICAgICAgICAgICAgICIgdG8gYSBzZXF1ZW5jZSIsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBpZiAoMiA9PT0gYi5zcSRsZW5ndGgoKSkgewogICAgICAgICAgICAgIHZhciBnID0gU2suYWJzdHIuaXRlcihiKQogICAgICAgICAgICAgIGIgPSBnLnRwJGl0ZXJuZXh0KCkKICAgICAgICAgICAgICBnID0gZy50cCRpdGVybmV4dCgpCiAgICAgICAgICAgICAgYy5tcCRhc3Nfc3Vic2NyaXB0KGIsIGcpCiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoCiAgICAgICAgICAgICAgICAiZGljdGlvbmFyeSB1cGRhdGUgc2VxdWVuY2UgZWxlbWVudCAjIiArCiAgICAgICAgICAgICAgICAgIGYgKwogICAgICAgICAgICAgICAgICAiIGhhcyBsZW5ndGggIiArCiAgICAgICAgICAgICAgICAgIGIuc3EkbGVuZ3RoKCkgKwogICAgICAgICAgICAgICAgICAiOyAyIGlzIHJlcXVpcmVkIiwKICAgICAgICAgICAgICApCiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh2b2lkIDAgIT09IGQpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICInIiArIFNrLmFic3RyLnR5cGVOYW1lKGQpICsgIicgb2JqZWN0IGlzIG5vdCBpdGVyYWJsZSIsCiAgICAgICAgICApCiAgICAgICAgYSA9IG5ldyBTay5idWlsdGlucy5kaWN0KGEpCiAgICAgICAgYy5kaWN0X21lcmdlKGEpCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICB9CiAgICAgIG0uY29fa3dhcmdzID0gITAKICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS51cGRhdGUgPSBuZXcgU2suYnVpbHRpbi5mdW5jKG0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuX19jb250YWluc19fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoCiAgICAgICAgYSwKICAgICAgICBjLAogICAgICApIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2NvbnRhaW5zX18iLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5ib29sKGEuc3EkY29udGFpbnMoYykpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuX19jbXBfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKAogICAgICAgIGEsCiAgICAgICAgYywKICAgICAgICBkLAogICAgICApIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5fX2RlbGl0ZW1fXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKAogICAgICAgIGEsCiAgICAgICAgYywKICAgICAgKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19kZWxpdGVtX18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITApCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUubXAkZGVsX3N1YnNjcmlwdC5jYWxsKGEsIGMpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuX19nZXRpdGVtX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGMsCiAgICAgICkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fZ2V0aXRlbV9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLm1wJHN1YnNjcmlwdC5jYWxsKGEsIGMpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuX19zZXRpdGVtX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGMsCiAgICAgICAgZCwKICAgICAgKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19zZXRpdGVtX18iLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyLCAhMSwgITApCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUubXAkYXNzX3N1YnNjcmlwdC5jYWxsKGEsIGMsIGQpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuX19oYXNoX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19oYXNoX18iLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMSwgITApCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUudHAkaGFzaC5jYWxsKGEpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuX19sZW5fXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2xlbl9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITEsICEwKQogICAgICAgIHJldHVybiBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLm1wJGxlbmd0aC5jYWxsKGEpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuX19nZXRhdHRyaWJ1dGVfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgZnVuY3Rpb24gKGEsIGMpIHsKICAgICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oCiAgICAgICAgICAgICJfX2dldGF0dHJpYnV0ZV9fIiwKICAgICAgICAgICAgYXJndW1lbnRzLmxlbmd0aCwKICAgICAgICAgICAgMSwKICAgICAgICAgICAgMSwKICAgICAgICAgICAgITEsCiAgICAgICAgICAgICEwLAogICAgICAgICAgKQogICAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrU3RyaW5nKGMpKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoIl9fZ2V0YXR0cmlidXRlX18gcmVxdWlyZXMgYSBzdHJpbmciKQogICAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUudHAkZ2V0YXR0ci5jYWxsKGEsIGMpCiAgICAgICAgfSwKICAgICAgKQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLl9faXRlcl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9faXRlcl9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITEsICEwKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5kaWN0X2l0ZXJfKGEpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUudHAkaXRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZGljdF9pdGVyXyh0aGlzKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuX19yZXByX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19yZXByX18iLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMSwgITApCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUuJHIuY2FsbChhKQogICAgICB9KQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLm9iJGVxID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIGlmICh0aGlzID09PSBhKSByZXR1cm4gU2suYnVpbHRpbi5ib29sLnRydWUkCiAgICAgICAgaWYgKCEoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZGljdCkpCiAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgICBpZiAodGhpcy5zaXplICE9PSBhLnNpemUpIHJldHVybiBTay5idWlsdGluLmJvb2wuZmFsc2UkCiAgICAgICAgdmFyIGQgPSB0aGlzLnRwJGl0ZXIoKQogICAgICAgIGZvciAoYiA9IGQudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBiOyBiID0gZC50cCRpdGVybmV4dCgpKSB7CiAgICAgICAgICB2YXIgZSA9IHRoaXMubXAkc3Vic2NyaXB0KGIpCiAgICAgICAgICBiID0gYS5tcCRzdWJzY3JpcHQoYikKICAgICAgICAgIGlmICghU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGUsIGIsICJFcSIpKQogICAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgIH0KICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ib29sLnRydWUkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5vYiRuZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgYSA9IHRoaXMub2IkZXEoYSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQKICAgICAgICAgID8gYQogICAgICAgICAgOiBhLnYKICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgICAgOiBTay5idWlsdGluLmJvb2wudHJ1ZSQKICAgICAgfQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLmNvcHkgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiY29weSIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICExLCAhMCkKICAgICAgICB2YXIgYiwKICAgICAgICAgIGQgPSBuZXcgU2suYnVpbHRpbi5kaWN0KFtdKQogICAgICAgIHZhciBlID0gU2suYWJzdHIuaXRlcihhKQogICAgICAgIGZvciAoYiA9IGUudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBiOyBiID0gZS50cCRpdGVybmV4dCgpKSB7CiAgICAgICAgICB2YXIgZiA9IGEubXAkc3Vic2NyaXB0KGIpCiAgICAgICAgICB2b2lkIDAgPT09IGYgJiYgKGYgPSBudWxsKQogICAgICAgICAgZC5tcCRhc3Nfc3Vic2NyaXB0KGIsIGYpCiAgICAgICAgfQogICAgICAgIHJldHVybiBkCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC4kZnJvbWtleXMgPSBmdW5jdGlvbiAoYSwgYywgZCkgewogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5kaWN0KSB7CiAgICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJmcm9ta2V5cyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDIsICExLCAhMCkKICAgICAgICAgIHZhciBiID0gYQogICAgICAgICAgdmFyIGYgPSBjCiAgICAgICAgICB2YXIgZyA9IHZvaWQgMCA9PT0gZCA/IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCA6IGQKICAgICAgICB9IGVsc2UKICAgICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImZyb21rZXlzIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMiwgITEsICExKSwKICAgICAgICAgICAgKGIgPSBuZXcgU2suYnVpbHRpbi5kaWN0KFtdKSksCiAgICAgICAgICAgIChmID0gYSksCiAgICAgICAgICAgIChnID0gdm9pZCAwID09PSBjID8gU2suYnVpbHRpbi5ub25lLm5vbmUkIDogYykKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZShmKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIiciICsgU2suYWJzdHIudHlwZU5hbWUoZikgKyAiJyBvYmplY3QgaXMgbm90IGl0ZXJhYmxlIiwKICAgICAgICAgICkKICAgICAgICB2YXIgaCA9IFNrLmFic3RyLml0ZXIoZikKICAgICAgICBmb3IgKGYgPSBoLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gZjsgZiA9IGgudHAkaXRlcm5leHQoKSkKICAgICAgICAgIGIubXAkYXNzX3N1YnNjcmlwdChmLCBnKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5pdGVyaXRlbXMgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICJkaWN0Lml0ZXJpdGVtcyBpcyBub3QgeWV0IGltcGxlbWVudGVkIGluIFNrdWxwdCIsCiAgICAgICAgKQogICAgICB9KQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLml0ZXJrZXlzID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAiZGljdC5pdGVya2V5cyBpcyBub3QgeWV0IGltcGxlbWVudGVkIGluIFNrdWxwdCIsCiAgICAgICAgKQogICAgICB9KQogICAgICBTay5idWlsdGluLmRpY3QucHJvdG90eXBlLml0ZXJ2YWx1ZXMgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICJkaWN0Lml0ZXJ2YWx1ZXMgaXMgbm90IHlldCBpbXBsZW1lbnRlZCBpbiBTa3VscHQiLAogICAgICAgICkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5wb3BpdGVtID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAiZGljdC5wb3BpdGVtIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQgaW4gU2t1bHB0IiwKICAgICAgICApCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUudmlld2l0ZW1zID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAiZGljdC52aWV3aXRlbXMgaXMgbm90IHlldCBpbXBsZW1lbnRlZCBpbiBTa3VscHQiLAogICAgICAgICkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS52aWV3a2V5cyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgImRpY3Qudmlld2tleXMgaXMgbm90IHlldCBpbXBsZW1lbnRlZCBpbiBTa3VscHQiLAogICAgICAgICkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS52aWV3dmFsdWVzID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAiZGljdC52aWV3dmFsdWVzIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQgaW4gU2t1bHB0IiwKICAgICAgICApCiAgICAgIH0pCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5kaWN0IiwgU2suYnVpbHRpbi5kaWN0KQogICAgICBTay5idWlsdGluLmRpY3RfaXRlcl8gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiLCBkCiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZGljdF9pdGVyXykpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZGljdF9pdGVyXyhhKQogICAgICAgIHRoaXMuJGluZGV4ID0gMAogICAgICAgIHRoaXMuJG9iaiA9IGEKICAgICAgICB2YXIgZSA9IFtdCiAgICAgICAgdmFyIGYgPSBhLmJ1Y2tldHMKICAgICAgICBmb3IgKGIgaW4gZikKICAgICAgICAgIGlmICgKICAgICAgICAgICAgZi5oYXNPd25Qcm9wZXJ0eShiKSAmJgogICAgICAgICAgICAoZCA9IGZbYl0pICYmCiAgICAgICAgICAgIHZvaWQgMCAhPT0gZC4kaGFzaCAmJgogICAgICAgICAgICB2b2lkIDAgIT09IGQuaXRlbXMKICAgICAgICAgICkKICAgICAgICAgICAgZm9yIChhID0gMDsgYSA8IGQuaXRlbXMubGVuZ3RoOyBhKyspIGUucHVzaChkLml0ZW1zW2FdLmxocykKICAgICAgICB0aGlzLiRrZXlzID0gZQogICAgICAgIHRoaXMudHAkaXRlciA9IHRoaXMKICAgICAgICB0aGlzLnRwJGl0ZXJuZXh0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKCEodGhpcy4kaW5kZXggPj0gdGhpcy4ka2V5cy5sZW5ndGgpKQogICAgICAgICAgICByZXR1cm4gdGhpcy4ka2V5c1t0aGlzLiRpbmRleCsrXQogICAgICAgIH0KICAgICAgICB0aGlzLiRyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigiZGljdGlvbmFyeS1rZXlpdGVyYXRvciIpCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgKICAgICAgICAiZGljdGlvbmFyeS1rZXlpdGVyYXRvciIsCiAgICAgICAgU2suYnVpbHRpbi5kaWN0X2l0ZXJfLAogICAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uZGljdF9pdGVyXy5wcm90b3R5cGUuX19jbGFzc19fID0gU2suYnVpbHRpbi5kaWN0X2l0ZXJfCiAgICAgIFNrLmJ1aWx0aW4uZGljdF9pdGVyXy5wcm90b3R5cGUuX19pdGVyX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICApIHsKICAgICAgICByZXR1cm4gYQogICAgICB9KQogICAgICBTay5idWlsdGluLmRpY3RfaXRlcl8ucHJvdG90eXBlLm5leHQkID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBhID0gYS50cCRpdGVybmV4dCgpCiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYSkgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3RvcEl0ZXJhdGlvbigpCiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5FeHRlcm5hbEVycm9yKAogICAgICAgICAgIkNhbm5vdCBpbnN0YW50aWF0ZSBhYnN0cmFjdCBTay5idWlsdGluLm51bXR5cGUgY2xhc3MiLAogICAgICAgICkKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJOdW1lcmljVHlwZSIsCiAgICAgICAgU2suYnVpbHRpbi5udW10eXBlLAogICAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5zayRhYnN0cmFjdCA9ICEwCiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUuX19hYnNfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAodm9pZCAwID09PSBhLm5iJGFicykKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAgICJfX2Fic19fIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQiLAogICAgICAgICAgKQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fYWJzX18iLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEubmIkYWJzKCkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5fX25lZ19fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEubmIkbmVnYXRpdmUpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAiX19uZWdfXyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICkKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX25lZ19fIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITEsICEwKQogICAgICAgIHJldHVybiBhLm5iJG5lZ2F0aXZlKCkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5fX3Bvc19fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEubmIkcG9zaXRpdmUpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAiX19wb3NfXyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICkKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX3Bvc19fIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITEsICEwKQogICAgICAgIHJldHVybiBhLm5iJHBvc2l0aXZlKCkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5fX2ludF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEubmIkaW50XykKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAgICJfX2ludF9fIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQiLAogICAgICAgICAgKQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9faW50X18iLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEubmIkaW50XygpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUuX19sb25nX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYS5uYiRsbmcpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAiX19sb25nX18gaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgICApCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19sb25nX18iLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEubmIkbG5nKCkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5fX2Zsb2F0X18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICApIHsKICAgICAgICBpZiAodm9pZCAwID09PSBhLm5iJGZsb2F0XykKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAgICJfX2Zsb2F0X18gaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgICApCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19mbG9hdF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITEsICEwKQogICAgICAgIHJldHVybiBhLm5iJGZsb2F0XygpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUuX19hZGRfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYS5uYiRhZGQpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAiX19hZGRfXyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICkKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2FkZF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBhLm5iJGFkZChiKQogICAgICB9KQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLl9fcmFkZF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICApIHsKICAgICAgICBpZiAodm9pZCAwID09PSBhLm5iJHJlZmxlY3RlZF9hZGQpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAiX19yYWRkX18gaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgICApCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19yYWRkX18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEubmIkcmVmbGVjdGVkX2FkZChiKQogICAgICB9KQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLl9fc3ViX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEubmIkc3VidHJhY3QpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAiX19zdWJfXyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICkKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX3N1Yl9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBhLm5iJHN1YnRyYWN0KGIpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUuX19yc3ViX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEubmIkcmVmbGVjdGVkX3N1YnRyYWN0KQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgIl9fcnN1Yl9fIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQiLAogICAgICAgICAgKQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fcnN1Yl9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBhLm5iJHJlZmxlY3RlZF9zdWJ0cmFjdChiKQogICAgICB9KQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLl9fbXVsX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEubmIkbXVsdGlwbHkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAiX19tdWxfXyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICkKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX211bF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBhLm5iJG11bHRpcGx5KGIpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUuX19ybXVsX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEubmIkcmVmbGVjdGVkX211bHRpcGx5KQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgIl9fcm11bF9fIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQiLAogICAgICAgICAgKQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fcm11bF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBhLm5iJHJlZmxlY3RlZF9tdWx0aXBseShiKQogICAgICB9KQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLl9fZGl2X18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEubmIkZGl2aWRlKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgIl9fZGl2X18gaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgICApCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19kaXZfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEsICExLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRkaXZpZGUoYikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5fX3JkaXZfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYS5uYiRyZWZsZWN0ZWRfZGl2aWRlKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgIl9fcmRpdl9fIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQiLAogICAgICAgICAgKQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fcmRpdl9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBhLm5iJHJlZmxlY3RlZF9kaXZpZGUoYikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5fX2Zsb29yZGl2X18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEubmIkZmxvb3JfZGl2aWRlKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgIl9fZmxvb3JkaXZfXyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICkKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKAogICAgICAgICAgIl9fZmxvb3JkaXZfXyIsCiAgICAgICAgICBhcmd1bWVudHMubGVuZ3RoLAogICAgICAgICAgMSwKICAgICAgICAgIDEsCiAgICAgICAgICAhMSwKICAgICAgICAgICEwLAogICAgICAgICkKICAgICAgICByZXR1cm4gYS5uYiRmbG9vcl9kaXZpZGUoYikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5fX3JmbG9vcmRpdl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYygKICAgICAgICBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgaWYgKHZvaWQgMCA9PT0gYS5uYiRyZWZsZWN0ZWRfZmxvb3JfZGl2aWRlKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAgICJfX3JmbG9vcmRpdl9fIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQiLAogICAgICAgICAgICApCiAgICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKAogICAgICAgICAgICAiX19yZmxvb3JkaXZfXyIsCiAgICAgICAgICAgIGFyZ3VtZW50cy5sZW5ndGgsCiAgICAgICAgICAgIDEsCiAgICAgICAgICAgIDEsCiAgICAgICAgICAgICExLAogICAgICAgICAgICAhMCwKICAgICAgICAgICkKICAgICAgICAgIHJldHVybiBhLm5iJHJlZmxlY3RlZF9mbG9vcl9kaXZpZGUoYikKICAgICAgICB9LAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUuX19tb2RfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYS5uYiRyZW1haW5kZXIpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAiX19tb2RfXyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICkKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX21vZF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBhLm5iJHJlbWFpbmRlcihiKQogICAgICB9KQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLl9fcm1vZF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICApIHsKICAgICAgICBpZiAodm9pZCAwID09PSBhLm5iJHJlZmxlY3RlZF9yZW1haW5kZXIpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAiX19ybW9kX18gaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgICApCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19ybW9kX18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMSwgITApCiAgICAgICAgcmV0dXJuIGEubmIkcmVmbGVjdGVkX3JlbWFpbmRlcihiKQogICAgICB9KQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLl9fZGl2bW9kX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIGlmICh2b2lkIDAgPT09IGEubmIkZGl2bW9kKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgIl9fZGl2bW9kX18gaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgICApCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19kaXZtb2RfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEsICExLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRkaXZtb2QoYikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5fX3JkaXZtb2RfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYS5uYiRyZWZsZWN0ZWRfZGl2bW9kKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgIl9fcmRpdm1vZF9fIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQiLAogICAgICAgICAgKQogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fcmRpdm1vZF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITEsICEwKQogICAgICAgIHJldHVybiBhLm5iJHJlZmxlY3RlZF9kaXZtb2QoYikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5fX3Bvd19fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICApIHsKICAgICAgICBpZiAodm9pZCAwID09PSBhLm5iJHBvd2VyKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgIl9fcG93X18gaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgICApCiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19wb3dfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEsICExLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRwb3dlcihiKQogICAgICB9KQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLl9fcnBvd19fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICApIHsKICAgICAgICBpZiAodm9pZCAwID09PSBhLm5iJHJlZmxlY3RlZF9wb3dlcikKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAgICJfX3Jwb3dfXyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICkKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX3Jwb3dfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEsICExLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRyZWZsZWN0ZWRfcG93ZXIoYikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5fX2NvZXJjZV9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICApIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgIl9fY29lcmNlX18gaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgKQogICAgICB9KQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJGFkZCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfYWRkID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJGlucGxhY2VfYWRkID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJHN1YnRyYWN0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9zdWJ0cmFjdCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5uYiRpbnBsYWNlX3N1YnRyYWN0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJG11bHRpcGx5ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9tdWx0aXBseSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5uYiRpbnBsYWNlX211bHRpcGx5ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJGRpdmlkZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfZGl2aWRlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJGlucGxhY2VfZGl2aWRlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJGZsb29yX2RpdmlkZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfZmxvb3JfZGl2aWRlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJGlucGxhY2VfZmxvb3JfZGl2aWRlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJHJlbWFpbmRlciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfcmVtYWluZGVyID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJGlucGxhY2VfcmVtYWluZGVyID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJGRpdm1vZCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfZGl2bW9kID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJHBvd2VyID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9wb3dlciA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5uYiRpbnBsYWNlX3Bvd2VyID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJGFicyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJG5lZ2F0aXZlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUubmIkcG9zaXRpdmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5udW10eXBlLnByb3RvdHlwZS5uYiRub256ZXJvID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubnVtdHlwZS5wcm90b3R5cGUubmIkaXNuZWdhdGl2ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLm51bXR5cGUucHJvdG90eXBlLm5iJGlzcG9zaXRpdmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgIH0sCiAgICBmdW5jdGlvbiAobSwgcCkgewogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIgPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIG51bGwgIT0gYSAmJgogICAgICAgICAgKCJudW1iZXIiID09IHR5cGVvZiBhCiAgICAgICAgICAgID8gdGhpcy5mcm9tTnVtYmVyKGEsIGIsIGMpCiAgICAgICAgICAgIDogbnVsbCA9PSBiICYmICJzdHJpbmciICE9IHR5cGVvZiBhCiAgICAgICAgICAgID8gdGhpcy5mcm9tU3RyaW5nKGEsIDI1NikKICAgICAgICAgICAgOiB0aGlzLmZyb21TdHJpbmcoYSwgYikpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLmNhbmFyeSA9IDB4ZGVhZGJlZWZjYWZlCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5qX2xtID0KICAgICAgICAxNTcxNTA3MCA9PSAoU2suYnVpbHRpbi5iaWdpbnRlZ2VyLmNhbmFyeSAmIDE2Nzc3MjE1KQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5iaWdpbnRlZ2VyKG51bGwpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5hbTEgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSwgZikgewogICAgICAgIGZvciAodmFyIGc7IDAgPD0gLS1mOyApCiAgICAgICAgICAoZyA9IGIgKiB0aGlzW2ErK10gKyBjW2RdICsgZSksCiAgICAgICAgICAgIChlID0gTWF0aC5mbG9vcihnIC8gNjcxMDg4NjQpKSwKICAgICAgICAgICAgKGNbZCsrXSA9IGcgJiA2NzEwODg2MykKICAgICAgICByZXR1cm4gZQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYW0yID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUsIGYpIHsKICAgICAgICBmb3IgKHZhciBnLCBoLCBrID0gYiAmIDMyNzY3LCBsID0gYiA+PiAxNTsgMCA8PSAtLWY7ICkKICAgICAgICAgIChoID0gdGhpc1thXSAmIDMyNzY3KSwKICAgICAgICAgICAgKGcgPSB0aGlzW2ErK10gPj4gMTUpLAogICAgICAgICAgICAoYiA9IGwgKiBoICsgZyAqIGspLAogICAgICAgICAgICAoaCA9IGsgKiBoICsgKChiICYgMzI3NjcpIDw8IDE1KSArIGNbZF0gKyAoZSAmIDEwNzM3NDE4MjMpKSwKICAgICAgICAgICAgKGUgPSAoaCA+Pj4gMzApICsgKGIgPj4+IDE1KSArIGwgKiBnICsgKGUgPj4+IDMwKSksCiAgICAgICAgICAgIChjW2QrK10gPSBoICYgMTA3Mzc0MTgyMykKICAgICAgICByZXR1cm4gZQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYW0zID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUsIGYpIHsKICAgICAgICBmb3IgKHZhciBnLCBoLCBrID0gYiAmIDE2MzgzLCBsID0gYiA+PiAxNDsgMCA8PSAtLWY7ICkKICAgICAgICAgIChoID0gdGhpc1thXSAmIDE2MzgzKSwKICAgICAgICAgICAgKGcgPSB0aGlzW2ErK10gPj4gMTQpLAogICAgICAgICAgICAoYiA9IGwgKiBoICsgZyAqIGspLAogICAgICAgICAgICAoaCA9IGsgKiBoICsgKChiICYgMTYzODMpIDw8IDE0KSArIGNbZF0gKyBlKSwKICAgICAgICAgICAgKGUgPSAoaCA+PiAyOCkgKyAoYiA+PiAxNCkgKyBsICogZyksCiAgICAgICAgICAgIChjW2QrK10gPSBoICYgMjY4NDM1NDU1KQogICAgICAgIHJldHVybiBlCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5hbSA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYW0zCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5kYml0cyA9IDI4CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuREIgPSBTay5idWlsdGluLmJpZ2ludGVnZXIuZGJpdHMKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ETSA9CiAgICAgICAgKDEgPDwgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLmRiaXRzKSAtIDEKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5EViA9IDEgPDwgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLmRiaXRzCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5CSV9GUCA9IDUyCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuRlYgPSBNYXRoLnBvdygKICAgICAgICAyLAogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5CSV9GUCwKICAgICAgKQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLkYxID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuQklfRlAgLSBTay5idWlsdGluLmJpZ2ludGVnZXIuZGJpdHMKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5GMiA9CiAgICAgICAgMiAqIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5kYml0cyAtIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5CSV9GUAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuQklfUk0gPSAiMDEyMzQ1Njc4OWFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6IgogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuQklfUkMgPSBbXQogICAgICBtID0gNDgKICAgICAgZm9yIChwID0gMDsgOSA+PSBwOyArK3ApIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5CSV9SQ1ttKytdID0gcAogICAgICBtID0gOTcKICAgICAgZm9yIChwID0gMTA7IDM2ID4gcDsgKytwKSBTay5idWlsdGluLmJpZ2ludGVnZXIuQklfUkNbbSsrXSA9IHAKICAgICAgbSA9IDY1CiAgICAgIGZvciAocCA9IDEwOyAzNiA+IHA7ICsrcCkgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLkJJX1JDW20rK10gPSBwCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5pbnQyY2hhciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5CSV9STS5jaGFyQXQoYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuaW50QXQgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGEgPSBTay5idWlsdGluLmJpZ2ludGVnZXIuQklfUkNbYS5jaGFyQ29kZUF0KGIpXQogICAgICAgIHJldHVybiBudWxsID09IGEgPyAtMSA6IGEKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucENvcHlUbyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBmb3IgKGIgPSB0aGlzLnQgLSAxOyAwIDw9IGI7IC0tYikgYVtiXSA9IHRoaXNbYl0KICAgICAgICBhLnQgPSB0aGlzLnQKICAgICAgICBhLnMgPSB0aGlzLnMKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucEZyb21JbnQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHRoaXMudCA9IDEKICAgICAgICB0aGlzLnMgPSAwID4gYSA/IC0xIDogMAogICAgICAgIDAgPCBhID8gKHRoaXNbMF0gPSBhKSA6IC0xID4gYSA/ICh0aGlzWzBdID0gYSArIHRoaXMuRFYpIDogKHRoaXMudCA9IDApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5idiA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIgPSBuZXcgU2suYnVpbHRpbi5iaWdpbnRlZ2VyKG51bGwpCiAgICAgICAgYi5ibnBGcm9tSW50KGEpCiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucEZyb21TdHJpbmcgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjCiAgICAgICAgaWYgKDE2ID09IGIpIHZhciBkID0gNAogICAgICAgIGVsc2UgaWYgKDggPT0gYikgZCA9IDMKICAgICAgICBlbHNlIGlmICgyNTYgPT0gYikgZCA9IDgKICAgICAgICBlbHNlIGlmICgyID09IGIpIGQgPSAxCiAgICAgICAgZWxzZSBpZiAoMzIgPT0gYikgZCA9IDUKICAgICAgICBlbHNlIGlmICg0ID09IGIpIGQgPSAyCiAgICAgICAgZWxzZSB7CiAgICAgICAgICB0aGlzLmZyb21SYWRpeChhLCBiKQogICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIHRoaXMucyA9IHRoaXMudCA9IDAKICAgICAgICB2YXIgZSA9IGEubGVuZ3RoCiAgICAgICAgdmFyIGYgPSAhMQogICAgICAgIGZvciAoYyA9IDA7IDAgPD0gLS1lOyApCiAgICAgICAgICAoYiA9IDggPT0gZCA/IGFbZV0gJiAyNTUgOiBTay5idWlsdGluLmJpZ2ludGVnZXIuaW50QXQoYSwgZSkpLAogICAgICAgICAgICAwID4gYgogICAgICAgICAgICAgID8gIi0iID09IGEuY2hhckF0KGUpICYmIChmID0gITApCiAgICAgICAgICAgICAgOiAoKGYgPSAhMSksCiAgICAgICAgICAgICAgICAwID09PSBjCiAgICAgICAgICAgICAgICAgID8gKHRoaXNbdGhpcy50KytdID0gYikKICAgICAgICAgICAgICAgICAgOiBjICsgZCA+IHRoaXMuREIKICAgICAgICAgICAgICAgICAgPyAoKHRoaXNbdGhpcy50IC0gMV0gfD0KICAgICAgICAgICAgICAgICAgICAgIChiICYgKCgxIDw8ICh0aGlzLkRCIC0gYykpIC0gMSkpIDw8IGMpLAogICAgICAgICAgICAgICAgICAgICh0aGlzW3RoaXMudCsrXSA9IGIgPj4gKHRoaXMuREIgLSBjKSkpCiAgICAgICAgICAgICAgICAgIDogKHRoaXNbdGhpcy50IC0gMV0gfD0gYiA8PCBjKSwKICAgICAgICAgICAgICAgIChjICs9IGQpLAogICAgICAgICAgICAgICAgYyA+PSB0aGlzLkRCICYmIChjIC09IHRoaXMuREIpKQogICAgICAgIDggPT0gZCAmJgogICAgICAgICAgMCAhPT0gKGFbMF0gJiAxMjgpICYmCiAgICAgICAgICAoKHRoaXMucyA9IC0xKSwKICAgICAgICAgIDAgPCBjICYmICh0aGlzW3RoaXMudCAtIDFdIHw9ICgoMSA8PCAodGhpcy5EQiAtIGMpKSAtIDEpIDw8IGMpKQogICAgICAgIHRoaXMuY2xhbXAoKQogICAgICAgIGYgJiYgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLlpFUk8uc3ViVG8odGhpcywgdGhpcykKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucENsYW1wID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZvciAodmFyIGEgPSB0aGlzLnMgJiB0aGlzLkRNOyAwIDwgdGhpcy50ICYmIHRoaXNbdGhpcy50IC0gMV0gPT0gYTsgKQogICAgICAgICAgLS10aGlzLnQKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuVG9TdHJpbmcgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiCiAgICAgICAgaWYgKDAgPiB0aGlzLnMpIHJldHVybiAiLSIgKyB0aGlzLm5lZ2F0ZSgpLnRvU3RyaW5nKGEpCiAgICAgICAgaWYgKDE2ID09IGEpIHZhciBjID0gNAogICAgICAgIGVsc2UgaWYgKDggPT0gYSkgYyA9IDMKICAgICAgICBlbHNlIGlmICgyID09IGEpIGMgPSAxCiAgICAgICAgZWxzZSBpZiAoMzIgPT0gYSkgYyA9IDUKICAgICAgICBlbHNlIGlmICg0ID09IGEpIGMgPSAyCiAgICAgICAgZWxzZSByZXR1cm4gdGhpcy50b1JhZGl4KGEpCiAgICAgICAgdmFyIGQgPSAoMSA8PCBjKSAtIDEKICAgICAgICB2YXIgZSA9ICExCiAgICAgICAgdmFyIGYgPSAiIgogICAgICAgIHZhciBnID0gdGhpcy50CiAgICAgICAgYSA9IHRoaXMuREIgLSAoKGcgKiB0aGlzLkRCKSAlIGMpCiAgICAgICAgaWYgKDAgPCBnLS0pCiAgICAgICAgICBmb3IgKAogICAgICAgICAgICBhIDwgdGhpcy5EQiAmJgogICAgICAgICAgICAwIDwgKGIgPSB0aGlzW2ddID4+IGEpICYmCiAgICAgICAgICAgICgoZSA9ICEwKSwgKGYgPSBTay5idWlsdGluLmJpZ2ludGVnZXIuaW50MmNoYXIoYikpKTsKICAgICAgICAgICAgMCA8PSBnOwoKICAgICAgICAgICkKICAgICAgICAgICAgYSA8IGMKICAgICAgICAgICAgICA/ICgoYiA9ICh0aGlzW2ddICYgKCgxIDw8IGEpIC0gMSkpIDw8IChjIC0gYSkpLAogICAgICAgICAgICAgICAgKGIgfD0gdGhpc1stLWddID4+IChhICs9IHRoaXMuREIgLSBjKSkpCiAgICAgICAgICAgICAgOiAoKGIgPSAodGhpc1tnXSA+PiAoYSAtPSBjKSkgJiBkKSwKICAgICAgICAgICAgICAgIDAgPj0gYSAmJiAoKGEgKz0gdGhpcy5EQiksIC0tZykpLAogICAgICAgICAgICAgIDAgPCBiICYmIChlID0gITApLAogICAgICAgICAgICAgIGUgJiYgKGYgKz0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLmludDJjaGFyKGIpKQogICAgICAgIHJldHVybiBlID8gZiA6ICIwIgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5OZWdhdGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGEgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCkKICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuWkVSTy5zdWJUbyh0aGlzLCBhKQogICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkFicyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gMCA+IHRoaXMucyA/IHRoaXMubmVnYXRlKCkgOiB0aGlzCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkNvbXBhcmVUbyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIgPSB0aGlzLnMgLSBhLnMKICAgICAgICBpZiAoMCAhPT0gYikgcmV0dXJuIGIKICAgICAgICB2YXIgYyA9IHRoaXMudAogICAgICAgIGIgPSBjIC0gYS50CiAgICAgICAgaWYgKDAgIT09IGIpIHJldHVybiAwID4gdGhpcy5zID8gLWIgOiBiCiAgICAgICAgZm9yICg7IDAgPD0gLS1jOyApIGlmICgwICE9PSAoYiA9IHRoaXNbY10gLSBhW2NdKSkgcmV0dXJuIGIKICAgICAgICByZXR1cm4gMAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYml0cyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIgPSAxLAogICAgICAgICAgYwogICAgICAgIDAgIT09IChjID0gYSA+Pj4gMTYpICYmICgoYSA9IGMpLCAoYiArPSAxNikpCiAgICAgICAgMCAhPT0gKGMgPSBhID4+IDgpICYmICgoYSA9IGMpLCAoYiArPSA4KSkKICAgICAgICAwICE9PSAoYyA9IGEgPj4gNCkgJiYgKChhID0gYyksIChiICs9IDQpKQogICAgICAgIDAgIT09IChjID0gYSA+PiAyKSAmJiAoKGEgPSBjKSwgKGIgKz0gMikpCiAgICAgICAgMCAhPT0gYSA+PiAxICYmIChiICs9IDEpCiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuQml0TGVuZ3RoID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAwID49IHRoaXMudAogICAgICAgICAgPyAwCiAgICAgICAgICA6IHRoaXMuREIgKiAodGhpcy50IC0gMSkgKwogICAgICAgICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYml0cyh0aGlzW3RoaXMudCAtIDFdIF4gKHRoaXMucyAmIHRoaXMuRE0pKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wRExTaGlmdFRvID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB2YXIgYwogICAgICAgIGZvciAoYyA9IHRoaXMudCAtIDE7IDAgPD0gYzsgLS1jKSBiW2MgKyBhXSA9IHRoaXNbY10KICAgICAgICBmb3IgKGMgPSBhIC0gMTsgMCA8PSBjOyAtLWMpIGJbY10gPSAwCiAgICAgICAgYi50ID0gdGhpcy50ICsgYQogICAgICAgIGIucyA9IHRoaXMucwogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wRFJTaGlmdFRvID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB2YXIgYwogICAgICAgIGZvciAoYyA9IGE7IGMgPCB0aGlzLnQ7ICsrYykgYltjIC0gYV0gPSB0aGlzW2NdCiAgICAgICAgYi50ID0gTWF0aC5tYXgodGhpcy50IC0gYSwgMCkKICAgICAgICBiLnMgPSB0aGlzLnMKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucExTaGlmdFRvID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IGEgJSB0aGlzLkRCLAogICAgICAgICAgZCA9IHRoaXMuREIgLSBjLAogICAgICAgICAgZSA9ICgxIDw8IGQpIC0gMQogICAgICAgIGEgPSBNYXRoLmZsb29yKGEgLyB0aGlzLkRCKQogICAgICAgIHZhciBmID0gKHRoaXMucyA8PCBjKSAmIHRoaXMuRE0sCiAgICAgICAgICBnCiAgICAgICAgZm9yIChnID0gdGhpcy50IC0gMTsgMCA8PSBnOyAtLWcpCiAgICAgICAgICAoYltnICsgYSArIDFdID0gKHRoaXNbZ10gPj4gZCkgfCBmKSwgKGYgPSAodGhpc1tnXSAmIGUpIDw8IGMpCiAgICAgICAgZm9yIChnID0gYSAtIDE7IDAgPD0gZzsgLS1nKSBiW2ddID0gMAogICAgICAgIGJbYV0gPSBmCiAgICAgICAgYi50ID0gdGhpcy50ICsgYSArIDEKICAgICAgICBiLnMgPSB0aGlzLnMKICAgICAgICBiLmNsYW1wKCkKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucFJTaGlmdFRvID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBiLnMgPSB0aGlzLnMKICAgICAgICB2YXIgYyA9IE1hdGguZmxvb3IoYSAvIHRoaXMuREIpCiAgICAgICAgaWYgKGMgPj0gdGhpcy50KSBiLnQgPSAwCiAgICAgICAgZWxzZSB7CiAgICAgICAgICB2YXIgZCA9IGEgJSB0aGlzLkRCCiAgICAgICAgICB2YXIgZSA9IHRoaXMuREIgLSBkCiAgICAgICAgICB2YXIgZiA9ICgxIDw8IGQpIC0gMQogICAgICAgICAgYlswXSA9IHRoaXNbY10gPj4gZAogICAgICAgICAgZm9yIChhID0gYyArIDE7IGEgPCB0aGlzLnQ7ICsrYSkKICAgICAgICAgICAgKGJbYSAtIGMgLSAxXSB8PSAodGhpc1thXSAmIGYpIDw8IGUpLCAoYlthIC0gY10gPSB0aGlzW2FdID4+IGQpCiAgICAgICAgICAwIDwgZCAmJiAoYlt0aGlzLnQgLSBjIC0gMV0gfD0gKHRoaXMucyAmIGYpIDw8IGUpCiAgICAgICAgICBiLnQgPSB0aGlzLnQgLSBjCiAgICAgICAgICBiLmNsYW1wKCkKICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBTdWJUbyA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgZm9yICh2YXIgYyA9IDAsIGQgPSAwLCBlID0gTWF0aC5taW4oYS50LCB0aGlzLnQpOyBjIDwgZTsgKQogICAgICAgICAgKGQgKz0gdGhpc1tjXSAtIGFbY10pLCAoYltjKytdID0gZCAmIHRoaXMuRE0pLCAoZCA+Pj0gdGhpcy5EQikKICAgICAgICBpZiAoYS50IDwgdGhpcy50KSB7CiAgICAgICAgICBmb3IgKGQgLT0gYS5zOyBjIDwgdGhpcy50OyApCiAgICAgICAgICAgIChkICs9IHRoaXNbY10pLCAoYltjKytdID0gZCAmIHRoaXMuRE0pLCAoZCA+Pj0gdGhpcy5EQikKICAgICAgICAgIGQgKz0gdGhpcy5zCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZvciAoZCArPSB0aGlzLnM7IGMgPCBhLnQ7ICkKICAgICAgICAgICAgKGQgLT0gYVtjXSksIChiW2MrK10gPSBkICYgdGhpcy5ETSksIChkID4+PSB0aGlzLkRCKQogICAgICAgICAgZCAtPSBhLnMKICAgICAgICB9CiAgICAgICAgYi5zID0gMCA+IGQgPyAtMSA6IDAKICAgICAgICA7LTEgPiBkID8gKGJbYysrXSA9IHRoaXMuRFYgKyBkKSA6IDAgPCBkICYmIChiW2MrK10gPSBkKQogICAgICAgIGIudCA9IGMKICAgICAgICBiLmNsYW1wKCkKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucE11bHRpcGx5VG8gPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjID0gdGhpcy5hYnMoKSwKICAgICAgICAgIGQgPSBhLmFicygpLAogICAgICAgICAgZSA9IGMudAogICAgICAgIGZvciAoYi50ID0gZSArIGQudDsgMCA8PSAtLWU7ICkgYltlXSA9IDAKICAgICAgICBmb3IgKGUgPSAwOyBlIDwgZC50OyArK2UpIGJbZSArIGMudF0gPSBjLmFtKDAsIGRbZV0sIGIsIGUsIDAsIGMudCkKICAgICAgICBiLnMgPSAwCiAgICAgICAgYi5jbGFtcCgpCiAgICAgICAgdGhpcy5zICE9IGEucyAmJiBTay5idWlsdGluLmJpZ2ludGVnZXIuWkVSTy5zdWJUbyhiLCBiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wU3F1YXJlVG8gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGZvciAodmFyIGIsIGMgPSB0aGlzLmFicygpLCBkID0gKGEudCA9IDIgKiBjLnQpOyAwIDw9IC0tZDsgKSBhW2RdID0gMAogICAgICAgIGZvciAoZCA9IDA7IGQgPCBjLnQgLSAxOyArK2QpCiAgICAgICAgICAoYiA9IGMuYW0oZCwgY1tkXSwgYSwgMiAqIGQsIDAsIDEpKSwKICAgICAgICAgICAgKGFbZCArIGMudF0gKz0gYy5hbSgKICAgICAgICAgICAgICBkICsgMSwKICAgICAgICAgICAgICAyICogY1tkXSwKICAgICAgICAgICAgICBhLAogICAgICAgICAgICAgIDIgKiBkICsgMSwKICAgICAgICAgICAgICBiLAogICAgICAgICAgICAgIGMudCAtIGQgLSAxLAogICAgICAgICAgICApKSA+PSBjLkRWICYmICgoYVtkICsgYy50XSAtPSBjLkRWKSwgKGFbZCArIGMudCArIDFdID0gMSkpCiAgICAgICAgMCA8IGEudCAmJiAoYVthLnQgLSAxXSArPSBjLmFtKGQsIGNbZF0sIGEsIDIgKiBkLCAwLCAxKSkKICAgICAgICBhLnMgPSAwCiAgICAgICAgYS5jbGFtcCgpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBEaXZSZW1UbyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQgPSBhLmFicygpCiAgICAgICAgaWYgKCEoMCA+PSBkLnQpKSB7CiAgICAgICAgICB2YXIgZSA9IHRoaXMuYWJzKCkKICAgICAgICAgIGlmIChlLnQgPCBkLnQpIG51bGwgIT0gYiAmJiBiLmZyb21JbnQoMCksIG51bGwgIT0gYyAmJiB0aGlzLmNvcHlUbyhjKQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIG51bGwgPT0gYyAmJiAoYyA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYmkoKSkKICAgICAgICAgICAgdmFyIGYgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCkKICAgICAgICAgICAgdmFyIGcgPSB0aGlzLnMKICAgICAgICAgICAgdmFyIGggPSBhLnMKICAgICAgICAgICAgYSA9IHRoaXMuREIgLSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpdHMoZFtkLnQgLSAxXSkKICAgICAgICAgICAgMCA8IGEKICAgICAgICAgICAgICA/IChkLmxTaGlmdFRvKGEsIGYpLCBlLmxTaGlmdFRvKGEsIGMpKQogICAgICAgICAgICAgIDogKGQuY29weVRvKGYpLCBlLmNvcHlUbyhjKSkKICAgICAgICAgICAgdmFyIGsgPSBmLnQKICAgICAgICAgICAgZCA9IGZbayAtIDFdCiAgICAgICAgICAgIGlmICgwICE9PSBkKSB7CiAgICAgICAgICAgICAgdmFyIGwgPSBkICogKDEgPDwgdGhpcy5GMSkgKyAoMSA8IGsgPyBmW2sgLSAyXSA+PiB0aGlzLkYyIDogMCkKICAgICAgICAgICAgICBlID0gdGhpcy5GViAvIGwKICAgICAgICAgICAgICB2YXIgciA9ICgxIDw8IHRoaXMuRjEpIC8gbAogICAgICAgICAgICAgIHZhciBuID0gMSA8PCB0aGlzLkYyCiAgICAgICAgICAgICAgdmFyIHEgPSBjLnQKICAgICAgICAgICAgICB2YXIgbSA9IHEgLSBrCiAgICAgICAgICAgICAgdmFyIHAgPSBudWxsID09IGIgPyBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCkgOiBiCiAgICAgICAgICAgICAgZi5kbFNoaWZ0VG8obSwgcCkKICAgICAgICAgICAgICAwIDw9IGMuY29tcGFyZVRvKHApICYmICgoY1tjLnQrK10gPSAxKSwgYy5zdWJUbyhwLCBjKSkKICAgICAgICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuT05FLmRsU2hpZnRUbyhrLCBwKQogICAgICAgICAgICAgIGZvciAocC5zdWJUbyhmLCBmKTsgZi50IDwgazsgKSBmW2YudCsrXSA9IDAKICAgICAgICAgICAgICBmb3IgKDsgMCA8PSAtLW07ICkKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgKChsID0KICAgICAgICAgICAgICAgICAgICBjWy0tcV0gPT0gZAogICAgICAgICAgICAgICAgICAgICAgPyB0aGlzLkRNCiAgICAgICAgICAgICAgICAgICAgICA6IE1hdGguZmxvb3IoY1txXSAqIGUgKyAoY1txIC0gMV0gKyBuKSAqIHIpKSwKICAgICAgICAgICAgICAgICAgKGNbcV0gKz0gZi5hbSgwLCBsLCBjLCBtLCAwLCBrKSkgPCBsKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICBmb3IgKGYuZGxTaGlmdFRvKG0sIHApLCBjLnN1YlRvKHAsIGMpOyBjW3FdIDwgLS1sOyApCiAgICAgICAgICAgICAgICAgICAgYy5zdWJUbyhwLCBjKQogICAgICAgICAgICAgIG51bGwgIT0gYiAmJgogICAgICAgICAgICAgICAgKGMuZHJTaGlmdFRvKGssIGIpLAogICAgICAgICAgICAgICAgZyAhPSBoICYmIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5aRVJPLnN1YlRvKGIsIGIpKQogICAgICAgICAgICAgIGMudCA9IGsKICAgICAgICAgICAgICBjLmNsYW1wKCkKICAgICAgICAgICAgICAwIDwgYSAmJiBjLnJTaGlmdFRvKGEsIGMpCiAgICAgICAgICAgICAgMCA+IGcgJiYgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLlpFUk8uc3ViVG8oYywgYykKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuTW9kID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYmkoKQogICAgICAgIHRoaXMuYWJzKCkuZGl2UmVtVG8oYSwgbnVsbCwgYikKICAgICAgICAwID4gdGhpcy5zICYmCiAgICAgICAgICAwIDwgYi5jb21wYXJlVG8oU2suYnVpbHRpbi5iaWdpbnRlZ2VyLlpFUk8pICYmCiAgICAgICAgICBhLnN1YlRvKGIsIGIpCiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuQ2xhc3NpYyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdGhpcy5tID0gYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuY0NvbnZlcnQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiAwID4gYS5zIHx8IDAgPD0gYS5jb21wYXJlVG8odGhpcy5tKSA/IGEubW9kKHRoaXMubSkgOiBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5jUmV2ZXJ0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuY1JlZHVjZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgYS5kaXZSZW1Ubyh0aGlzLm0sIG51bGwsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5jTXVsVG8gPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIGEubXVsdGlwbHlUbyhiLCBjKQogICAgICAgIHRoaXMucmVkdWNlKGMpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5jU3FyVG8gPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGEuc3F1YXJlVG8oYikKICAgICAgICB0aGlzLnJlZHVjZShiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5DbGFzc2ljLnByb3RvdHlwZS5jb252ZXJ0ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmNDb252ZXJ0CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5DbGFzc2ljLnByb3RvdHlwZS5yZXZlcnQgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuY1JldmVydAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuQ2xhc3NpYy5wcm90b3R5cGUucmVkdWNlID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmNSZWR1Y2UKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLkNsYXNzaWMucHJvdG90eXBlLm11bFRvID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmNNdWxUbwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuQ2xhc3NpYy5wcm90b3R5cGUuc3FyVG8gPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuY1NxclRvCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wSW52RGlnaXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKDEgPiB0aGlzLnQpIHJldHVybiAwCiAgICAgICAgdmFyIGEgPSB0aGlzWzBdCiAgICAgICAgaWYgKDAgPT09IChhICYgMSkpIHJldHVybiAwCiAgICAgICAgdmFyIGIgPSBhICYgMwogICAgICAgIGIgPSAoYiAqICgyIC0gKGEgJiAxNSkgKiBiKSkgJiAxNQogICAgICAgIGIgPSAoYiAqICgyIC0gKGEgJiAyNTUpICogYikpICYgMjU1CiAgICAgICAgYiA9IChiICogKDIgLSAoKChhICYgNjU1MzUpICogYikgJiA2NTUzNSkpKSAmIDY1NTM1CiAgICAgICAgYiA9IChiICogKDIgLSAoKGEgKiBiKSAlIHRoaXMuRFYpKSkgJSB0aGlzLkRWCiAgICAgICAgcmV0dXJuIDAgPCBiID8gdGhpcy5EViAtIGIgOiAtYgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5Nb250Z29tZXJ5ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB0aGlzLm0gPSBhCiAgICAgICAgdGhpcy5tcCA9IGEuaW52RGlnaXQoKQogICAgICAgIHRoaXMubXBsID0gdGhpcy5tcCAmIDMyNzY3CiAgICAgICAgdGhpcy5tcGggPSB0aGlzLm1wID4+IDE1CiAgICAgICAgdGhpcy51bSA9ICgxIDw8IChhLkRCIC0gMTUpKSAtIDEKICAgICAgICB0aGlzLm10MiA9IDIgKiBhLnQKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1vbnRDb252ZXJ0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYmkoKQogICAgICAgIGEuYWJzKCkuZGxTaGlmdFRvKHRoaXMubS50LCBiKQogICAgICAgIGIuZGl2UmVtVG8odGhpcy5tLCBudWxsLCBiKQogICAgICAgIDAgPiBhLnMgJiYKICAgICAgICAgIDAgPCBiLmNvbXBhcmVUbyhTay5idWlsdGluLmJpZ2ludGVnZXIuWkVSTykgJiYKICAgICAgICAgIHRoaXMubS5zdWJUbyhiLCBiKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5tb250UmV2ZXJ0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYmkoKQogICAgICAgIGEuY29weVRvKGIpCiAgICAgICAgdGhpcy5yZWR1Y2UoYikKICAgICAgICByZXR1cm4gYgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUubW9udFJlZHVjZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgZm9yICh2YXIgYiwgYywgZDsgYS50IDw9IHRoaXMubXQyOyApIGFbYS50KytdID0gMAogICAgICAgIGZvciAoZCA9IDA7IGQgPCB0aGlzLm0udDsgKytkKQogICAgICAgICAgZm9yICgKICAgICAgICAgICAgYyA9IGFbZF0gJiAzMjc2NywKICAgICAgICAgICAgICBiID0KICAgICAgICAgICAgICAgIChjICogdGhpcy5tcGwgKwogICAgICAgICAgICAgICAgICAoKChjICogdGhpcy5tcGggKyAoYVtkXSA+PiAxNSkgKiB0aGlzLm1wbCkgJiB0aGlzLnVtKSA8PAogICAgICAgICAgICAgICAgICAgIDE1KSkgJgogICAgICAgICAgICAgICAgYS5ETSwKICAgICAgICAgICAgICBjID0gZCArIHRoaXMubS50LAogICAgICAgICAgICAgIGFbY10gKz0gdGhpcy5tLmFtKDAsIGIsIGEsIGQsIDAsIHRoaXMubS50KTsKICAgICAgICAgICAgYVtjXSA+PSBhLkRWOwoKICAgICAgICAgICkKICAgICAgICAgICAgKGFbY10gLT0gYS5EViksIGFbKytjXSsrCiAgICAgICAgYS5jbGFtcCgpCiAgICAgICAgYS5kclNoaWZ0VG8odGhpcy5tLnQsIGEpCiAgICAgICAgMCA8PSBhLmNvbXBhcmVUbyh0aGlzLm0pICYmIGEuc3ViVG8odGhpcy5tLCBhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUubW9udFNxclRvID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBhLnNxdWFyZVRvKGIpCiAgICAgICAgdGhpcy5yZWR1Y2UoYikKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1vbnRNdWxUbyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgYS5tdWx0aXBseVRvKGIsIGMpCiAgICAgICAgdGhpcy5yZWR1Y2UoYykKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuTW9udGdvbWVyeS5wcm90b3R5cGUuY29udmVydCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5tb250Q29udmVydAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuTW9udGdvbWVyeS5wcm90b3R5cGUucmV2ZXJ0ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1vbnRSZXZlcnQKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLk1vbnRnb21lcnkucHJvdG90eXBlLnJlZHVjZSA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5tb250UmVkdWNlCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5Nb250Z29tZXJ5LnByb3RvdHlwZS5tdWxUbyA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5tb250TXVsVG8KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLk1vbnRnb21lcnkucHJvdG90eXBlLnNxclRvID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1vbnRTcXJUbwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucElzRXZlbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gMCA9PT0gKDAgPCB0aGlzLnQgPyB0aGlzWzBdICYgMSA6IHRoaXMucykKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucEV4cCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgaWYgKDQyOTQ5NjcyOTUgPCBhIHx8IDEgPiBhKSByZXR1cm4gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLk9ORQogICAgICAgIHZhciBjID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgdmFyIGQgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCkKICAgICAgICB2YXIgZSA9IGIuY29udmVydCh0aGlzKQogICAgICAgIHZhciBmID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaXRzKGEpIC0gMQogICAgICAgIGZvciAoZS5jb3B5VG8oYyk7IDAgPD0gLS1mOyApCiAgICAgICAgICBpZiAoKGIuc3FyVG8oYywgZCksIDAgPCAoYSAmICgxIDw8IGYpKSkpIGIubXVsVG8oZCwgZSwgYykKICAgICAgICAgIGVsc2UgewogICAgICAgICAgICB2YXIgZyA9IGMKICAgICAgICAgICAgYyA9IGQKICAgICAgICAgICAgZCA9IGcKICAgICAgICAgIH0KICAgICAgICByZXR1cm4gYi5yZXZlcnQoYykKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuTW9kUG93SW50ID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBiID0KICAgICAgICAgIDI1NiA+IGEgfHwgYi5pc0V2ZW4oKQogICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmJpZ2ludGVnZXIuQ2xhc3NpYyhiKQogICAgICAgICAgICA6IG5ldyBTay5idWlsdGluLmJpZ2ludGVnZXIuTW9udGdvbWVyeShiKQogICAgICAgIHJldHVybiB0aGlzLmV4cChhLCBiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuY29weVRvID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucENvcHlUbwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmZyb21JbnQgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wRnJvbUludAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmZyb21TdHJpbmcgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wRnJvbVN0cmluZwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmNsYW1wID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucENsYW1wCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuZGxTaGlmdFRvID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucERMU2hpZnRUbwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmRyU2hpZnRUbyA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBEUlNoaWZ0VG8KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5sU2hpZnRUbyA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBMU2hpZnRUbwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLnJTaGlmdFRvID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucFJTaGlmdFRvCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuc3ViVG8gPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wU3ViVG8KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5tdWx0aXBseVRvID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucE11bHRpcGx5VG8KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5zcXVhcmVUbyA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBTcXVhcmVUbwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmRpdlJlbVRvID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucERpdlJlbVRvCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuaW52RGlnaXQgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wSW52RGlnaXQKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5pc0V2ZW4gPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wSXNFdmVuCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuZXhwID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucEV4cAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLnRvU3RyaW5nID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuVG9TdHJpbmcKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5uZWdhdGUgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5OZWdhdGUKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5hYnMgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5BYnMKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5jb21wYXJlVG8gPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5Db21wYXJlVG8KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iaXRMZW5ndGggPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5CaXRMZW5ndGgKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5tb2QgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5Nb2QKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5tb2RQb3dJbnQgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5Nb2RQb3dJbnQKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLlpFUk8gPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJ2KDApCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5PTkUgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJ2KDEpCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5DbG9uZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgYSA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYmkoKQogICAgICAgIHRoaXMuY29weVRvKGEpCiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuSW50VmFsdWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKDAgPiB0aGlzLnMpIHsKICAgICAgICAgIGlmICgxID09IHRoaXMudCkgcmV0dXJuIHRoaXNbMF0gLSB0aGlzLkRWCiAgICAgICAgICBpZiAoMCA9PT0gdGhpcy50KSByZXR1cm4gLTEKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKDEgPT0gdGhpcy50KSByZXR1cm4gdGhpc1swXQogICAgICAgICAgaWYgKDAgPT09IHRoaXMudCkgcmV0dXJuIDAKICAgICAgICB9CiAgICAgICAgcmV0dXJuICgodGhpc1sxXSAmICgoMSA8PCAoMzIgLSB0aGlzLkRCKSkgLSAxKSkgPDwgdGhpcy5EQikgfCB0aGlzWzBdCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkJ5dGVWYWx1ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gMCA9PT0gdGhpcy50ID8gdGhpcy5zIDogKHRoaXNbMF0gPDwgMjQpID4+IDI0CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblNob3J0VmFsdWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIDAgPT09IHRoaXMudCA/IHRoaXMucyA6ICh0aGlzWzBdIDw8IDE2KSA+PiAxNgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wQ2h1bmtTaXplID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gTWF0aC5mbG9vcigoTWF0aC5MTjIgKiB0aGlzLkRCKSAvIE1hdGgubG9nKGEpKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5TaWdOdW0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIDAgPiB0aGlzLnMKICAgICAgICAgID8gLTEKICAgICAgICAgIDogMCA+PSB0aGlzLnQgfHwgKDEgPT0gdGhpcy50ICYmIDAgPj0gdGhpc1swXSkKICAgICAgICAgID8gMAogICAgICAgICAgOiAxCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBUb1JhZGl4ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBudWxsID09IGEgJiYgKGEgPSAxMCkKICAgICAgICBpZiAoMCA9PT0gdGhpcy5zaWdudW0oKSB8fCAyID4gYSB8fCAzNiA8IGEpIHJldHVybiAiMCIKICAgICAgICB2YXIgYiA9IHRoaXMuY2h1bmtTaXplKGEpCiAgICAgICAgdmFyIGMgPSBNYXRoLnBvdyhhLCBiKQogICAgICAgIGIgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJ2KGMpCiAgICAgICAgdmFyIGQgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCkKICAgICAgICB2YXIgZSA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYmkoKQogICAgICAgIHZhciBmID0gIiIKICAgICAgICBmb3IgKHRoaXMuZGl2UmVtVG8oYiwgZCwgZSk7IDAgPCBkLnNpZ251bSgpOyApCiAgICAgICAgICAoZiA9IChjICsgZS5pbnRWYWx1ZSgpKS50b1N0cmluZyhhKS5zdWJzdHIoMSkgKyBmKSwKICAgICAgICAgICAgZC5kaXZSZW1UbyhiLCBkLCBlKQogICAgICAgIHJldHVybiBlLmludFZhbHVlKCkudG9TdHJpbmcoYSkgKyBmCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBGcm9tUmFkaXggPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjLCBkLCBlCiAgICAgICAgdGhpcy5mcm9tSW50KDApCiAgICAgICAgbnVsbCA9PSBiICYmIChiID0gMTApCiAgICAgICAgdmFyIGYgPSB0aGlzLmNodW5rU2l6ZShiKQogICAgICAgIHZhciBnID0gTWF0aC5wb3coYiwgZikKICAgICAgICB2YXIgaCA9ICExCiAgICAgICAgZm9yIChjID0gZSA9IGQgPSAwOyBjIDwgYS5sZW5ndGg7ICsrYykgewogICAgICAgICAgdmFyIGsgPSBTay5idWlsdGluLmJpZ2ludGVnZXIuaW50QXQoYSwgYykKICAgICAgICAgIGlmICgwID4gaykgewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgKCItIiA9PSBhLmNoYXJBdChjKSAmJiAwID09PSB0aGlzLnNpZ251bSgpICYmIChoID0gITApLAogICAgICAgICAgICAgICIuIiA9PSBhLmNoYXJBdChjKSkKICAgICAgICAgICAgKQogICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgKGUgPSBiICogZSArIGspLAogICAgICAgICAgICAgICsrZCA+PSBmICYmCiAgICAgICAgICAgICAgICAodGhpcy5kTXVsdGlwbHkoZyksIHRoaXMuZEFkZE9mZnNldChlLCAwKSwgKGUgPSBkID0gMCkpCiAgICAgICAgfQogICAgICAgIDAgPCBkICYmICh0aGlzLmRNdWx0aXBseShNYXRoLnBvdyhiLCBkKSksIHRoaXMuZEFkZE9mZnNldChlLCAwKSkKICAgICAgICBoICYmIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5aRVJPLnN1YlRvKHRoaXMsIHRoaXMpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBGcm9tTnVtYmVyID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICBpZiAoIm51bWJlciIgPT0gdHlwZW9mIGIpCiAgICAgICAgICBpZiAoMiA+IGEpIHRoaXMuZnJvbUludCgxKQogICAgICAgICAgZWxzZQogICAgICAgICAgICBmb3IgKAogICAgICAgICAgICAgIHRoaXMuZnJvbU51bWJlcihhLCBjKSwKICAgICAgICAgICAgICAgIHRoaXMudGVzdEJpdChhIC0gMSkgfHwKICAgICAgICAgICAgICAgICAgdGhpcy5iaXR3aXNlVG8oCiAgICAgICAgICAgICAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLk9ORS5zaGlmdExlZnQoYSAtIDEpLAogICAgICAgICAgICAgICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5vcF9vciwKICAgICAgICAgICAgICAgICAgICB0aGlzLAogICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgdGhpcy5pc0V2ZW4oKSAmJiB0aGlzLmRBZGRPZmZzZXQoMSwgMCk7CiAgICAgICAgICAgICAgIXRoaXMuaXNQcm9iYWJsZVByaW1lKGIpOwoKICAgICAgICAgICAgKQogICAgICAgICAgICAgIHRoaXMuZEFkZE9mZnNldCgyLCAwKSwKICAgICAgICAgICAgICAgIHRoaXMuYml0TGVuZ3RoKCkgPiBhICYmCiAgICAgICAgICAgICAgICAgIHRoaXMuc3ViVG8oU2suYnVpbHRpbi5iaWdpbnRlZ2VyLk9ORS5zaGlmdExlZnQoYSAtIDEpLCB0aGlzKQogICAgICAgIHRoaXMuZnJvbVN0cmluZyhhICsgIiIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblRvQnl0ZUFycmF5ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBhLAogICAgICAgICAgYiA9IHRoaXMudCwKICAgICAgICAgIGMgPSBbXQogICAgICAgIGNbMF0gPSB0aGlzLnMKICAgICAgICB2YXIgZCA9IHRoaXMuREIgLSAoKGIgKiB0aGlzLkRCKSAlIDgpCiAgICAgICAgdmFyIGUgPSAwCiAgICAgICAgaWYgKDAgPCBiLS0pCiAgICAgICAgICBmb3IgKAogICAgICAgICAgICBkIDwgdGhpcy5EQiAmJgogICAgICAgICAgICAoYSA9IHRoaXNbYl0gPj4gZCkgIT0gKHRoaXMucyAmIHRoaXMuRE0pID4+IGQgJiYKICAgICAgICAgICAgKGNbZSsrXSA9IGEgfCAodGhpcy5zIDw8ICh0aGlzLkRCIC0gZCkpKTsKICAgICAgICAgICAgMCA8PSBiOwoKICAgICAgICAgICkKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICg4ID4gZAogICAgICAgICAgICAgICAgPyAoKGEgPSAodGhpc1tiXSAmICgoMSA8PCBkKSAtIDEpKSA8PCAoOCAtIGQpKSwKICAgICAgICAgICAgICAgICAgKGEgfD0gdGhpc1stLWJdID4+IChkICs9IHRoaXMuREIgLSA4KSkpCiAgICAgICAgICAgICAgICA6ICgoYSA9ICh0aGlzW2JdID4+IChkIC09IDgpKSAmIDI1NSksCiAgICAgICAgICAgICAgICAgIDAgPj0gZCAmJiAoKGQgKz0gdGhpcy5EQiksIC0tYikpLAogICAgICAgICAgICAgIDAgIT09IChhICYgMTI4KSAmJiAoYSB8PSAtMjU2KSwKICAgICAgICAgICAgICAwID09PSBlICYmICh0aGlzLnMgJiAxMjgpICE9IChhICYgMTI4KSAmJiArK2UsCiAgICAgICAgICAgICAgMCA8IGUgfHwgYSAhPSB0aGlzLnMpCiAgICAgICAgICAgICkKICAgICAgICAgICAgICBjW2UrK10gPSBhCiAgICAgICAgcmV0dXJuIGMKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuRXF1YWxzID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gMCA9PT0gdGhpcy5jb21wYXJlVG8oYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuTWluID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gMCA+IHRoaXMuY29tcGFyZVRvKGEpID8gdGhpcyA6IGEKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuTWF4ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gMCA8IHRoaXMuY29tcGFyZVRvKGEpID8gdGhpcyA6IGEKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucEJpdHdpc2VUbyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQsCiAgICAgICAgICBlID0gTWF0aC5taW4oYS50LCB0aGlzLnQpCiAgICAgICAgZm9yIChkID0gMDsgZCA8IGU7ICsrZCkgY1tkXSA9IGIodGhpc1tkXSwgYVtkXSkKICAgICAgICBpZiAoYS50IDwgdGhpcy50KSB7CiAgICAgICAgICB2YXIgZiA9IGEucyAmIHRoaXMuRE0KICAgICAgICAgIGZvciAoZCA9IGU7IGQgPCB0aGlzLnQ7ICsrZCkgY1tkXSA9IGIodGhpc1tkXSwgZikKICAgICAgICAgIGMudCA9IHRoaXMudAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmID0gdGhpcy5zICYgdGhpcy5ETQogICAgICAgICAgZm9yIChkID0gZTsgZCA8IGEudDsgKytkKSBjW2RdID0gYihmLCBhW2RdKQogICAgICAgICAgYy50ID0gYS50CiAgICAgICAgfQogICAgICAgIGMucyA9IGIodGhpcy5zLCBhLnMpCiAgICAgICAgYy5jbGFtcCgpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm9wX2FuZCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIGEgJiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkFuZCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCkKICAgICAgICB0aGlzLmJpdHdpc2VUbyhhLCBTay5idWlsdGluLmJpZ2ludGVnZXIub3BfYW5kLCBiKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm9wX29yID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gYSB8IGIKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuT3IgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgdGhpcy5iaXR3aXNlVG8oYSwgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm9wX29yLCBiKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm9wX3hvciA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIGEgXiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblhvciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCkKICAgICAgICB0aGlzLmJpdHdpc2VUbyhhLCBTay5idWlsdGluLmJpZ2ludGVnZXIub3BfeG9yLCBiKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm9wX2FuZG5vdCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIGEgJiB+YgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5BbmROb3QgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgdGhpcy5iaXR3aXNlVG8oYSwgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm9wX2FuZG5vdCwgYikKICAgICAgICByZXR1cm4gYgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5Ob3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGEsCiAgICAgICAgICBiID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgZm9yIChhID0gMDsgYSA8IHRoaXMudDsgKythKSBiW2FdID0gdGhpcy5ETSAmIH50aGlzW2FdCiAgICAgICAgYi50ID0gdGhpcy50CiAgICAgICAgYi5zID0gfnRoaXMucwogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblNoaWZ0TGVmdCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCkKICAgICAgICAwID4gYSA/IHRoaXMuclNoaWZ0VG8oLWEsIGIpIDogdGhpcy5sU2hpZnRUbyhhLCBiKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblNoaWZ0UmlnaHQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgMCA+IGEgPyB0aGlzLmxTaGlmdFRvKC1hLCBiKSA6IHRoaXMuclNoaWZ0VG8oYSwgYikKICAgICAgICByZXR1cm4gYgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5sYml0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoMCA9PT0gYSkgcmV0dXJuIC0xCiAgICAgICAgdmFyIGIgPSAwCiAgICAgICAgMCA9PT0gKGEgJiA2NTUzNSkgJiYgKChhID4+PSAxNiksIChiICs9IDE2KSkKICAgICAgICAwID09PSAoYSAmIDI1NSkgJiYgKChhID4+PSA4KSwgKGIgKz0gOCkpCiAgICAgICAgMCA9PT0gKGEgJiAxNSkgJiYgKChhID4+PSA0KSwgKGIgKz0gNCkpCiAgICAgICAgMCA9PT0gKGEgJiAzKSAmJiAoKGEgPj49IDIpLCAoYiArPSAyKSkKICAgICAgICAwID09PSAoYSAmIDEpICYmICsrYgogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkdldExvd2VzdFNldEJpdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgYQogICAgICAgIGZvciAoYSA9IDA7IGEgPCB0aGlzLnQ7ICsrYSkKICAgICAgICAgIGlmICgwICE9PSB0aGlzW2FdKQogICAgICAgICAgICByZXR1cm4gYSAqIHRoaXMuREIgKyBTay5idWlsdGluLmJpZ2ludGVnZXIubGJpdCh0aGlzW2FdKQogICAgICAgIHJldHVybiAwID4gdGhpcy5zID8gdGhpcy50ICogdGhpcy5EQiA6IC0xCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLmNiaXQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGZvciAodmFyIGIgPSAwOyAwICE9PSBhOyApIChhICY9IGEgLSAxKSwgKytiCiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuQml0Q291bnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGEsCiAgICAgICAgICBiID0gMCwKICAgICAgICAgIGMgPSB0aGlzLnMgJiB0aGlzLkRNCiAgICAgICAgZm9yIChhID0gMDsgYSA8IHRoaXMudDsgKythKQogICAgICAgICAgYiArPSBTay5idWlsdGluLmJpZ2ludGVnZXIuY2JpdCh0aGlzW2FdIF4gYykKICAgICAgICByZXR1cm4gYgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5UZXN0Qml0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiA9IE1hdGguZmxvb3IoYSAvIHRoaXMuREIpCiAgICAgICAgcmV0dXJuIGIgPj0gdGhpcy50ID8gMCAhPT0gdGhpcy5zIDogMCAhPT0gKHRoaXNbYl0gJiAoMSA8PCBhICUgdGhpcy5EQikpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBDaGFuZ2VCaXQgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGEgPSBTay5idWlsdGluLmJpZ2ludGVnZXIuT05FLnNoaWZ0TGVmdChhKQogICAgICAgIHRoaXMuYml0d2lzZVRvKGEsIGIsIGEpCiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuU2V0Qml0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5jaGFuZ2VCaXQoYSwgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm9wX29yKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5DbGVhckJpdCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY2hhbmdlQml0KGEsIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5vcF9hbmRub3QpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkZsaXBCaXQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiB0aGlzLmNoYW5nZUJpdChhLCBTay5idWlsdGluLmJpZ2ludGVnZXIub3BfeG9yKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wQWRkVG8gPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGZvciAodmFyIGMgPSAwLCBkID0gMCwgZSA9IE1hdGgubWluKGEudCwgdGhpcy50KTsgYyA8IGU7ICkKICAgICAgICAgIChkICs9IHRoaXNbY10gKyBhW2NdKSwgKGJbYysrXSA9IGQgJiB0aGlzLkRNKSwgKGQgPj49IHRoaXMuREIpCiAgICAgICAgaWYgKGEudCA8IHRoaXMudCkgewogICAgICAgICAgZm9yIChkICs9IGEuczsgYyA8IHRoaXMudDsgKQogICAgICAgICAgICAoZCArPSB0aGlzW2NdKSwgKGJbYysrXSA9IGQgJiB0aGlzLkRNKSwgKGQgPj49IHRoaXMuREIpCiAgICAgICAgICBkICs9IHRoaXMucwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmb3IgKGQgKz0gdGhpcy5zOyBjIDwgYS50OyApCiAgICAgICAgICAgIChkICs9IGFbY10pLCAoYltjKytdID0gZCAmIHRoaXMuRE0pLCAoZCA+Pj0gdGhpcy5EQikKICAgICAgICAgIGQgKz0gYS5zCiAgICAgICAgfQogICAgICAgIGIucyA9IDAgPiBkID8gLTEgOiAwCiAgICAgICAgMCA8IGQgPyAoYltjKytdID0gZCkgOiAtMSA+IGQgJiYgKGJbYysrXSA9IHRoaXMuRFYgKyBkKQogICAgICAgIGIudCA9IGMKICAgICAgICBiLmNsYW1wKCkKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuQWRkID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYmkoKQogICAgICAgIHRoaXMuYWRkVG8oYSwgYikKICAgICAgICByZXR1cm4gYgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5TdWJ0cmFjdCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCkKICAgICAgICB0aGlzLnN1YlRvKGEsIGIpCiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuTXVsdGlwbHkgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgdGhpcy5tdWx0aXBseVRvKGEsIGIpCiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuRGl2aWRlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYmkoKQogICAgICAgIHRoaXMuZGl2UmVtVG8oYSwgYiwgbnVsbCkKICAgICAgICByZXR1cm4gYgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5SZW1haW5kZXIgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgdGhpcy5kaXZSZW1UbyhhLCBudWxsLCBiKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkRpdmlkZUFuZFJlbWFpbmRlciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCksCiAgICAgICAgICBjID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgdGhpcy5kaXZSZW1UbyhhLCBiLCBjKQogICAgICAgIHJldHVybiBbYiwgY10KICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucERNdWx0aXBseSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdGhpc1t0aGlzLnRdID0gdGhpcy5hbSgwLCBhIC0gMSwgdGhpcywgMCwgMCwgdGhpcy50KQogICAgICAgICsrdGhpcy50CiAgICAgICAgdGhpcy5jbGFtcCgpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBEQWRkT2Zmc2V0ID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBpZiAoMCAhPT0gYSkgewogICAgICAgICAgZm9yICg7IHRoaXMudCA8PSBiOyApIHRoaXNbdGhpcy50KytdID0gMAogICAgICAgICAgZm9yICh0aGlzW2JdICs9IGE7IHRoaXNbYl0gPj0gdGhpcy5EVjsgKQogICAgICAgICAgICAodGhpc1tiXSAtPSB0aGlzLkRWKSwKICAgICAgICAgICAgICArK2IgPj0gdGhpcy50ICYmICh0aGlzW3RoaXMudCsrXSA9IDApLAogICAgICAgICAgICAgICsrdGhpc1tiXQogICAgICAgIH0KICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuTnVsbEV4cCA9IGZ1bmN0aW9uICgpIHt9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUubk5vcCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm5NdWxUbyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgYS5tdWx0aXBseVRvKGIsIGMpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5uU3FyVG8gPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGEuc3F1YXJlVG8oYikKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuTnVsbEV4cC5wcm90b3R5cGUuY29udmVydCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5uTm9wCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5OdWxsRXhwLnByb3RvdHlwZS5yZXZlcnQgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUubk5vcAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuTnVsbEV4cC5wcm90b3R5cGUubXVsVG8gPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUubk11bFRvCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5OdWxsRXhwLnByb3RvdHlwZS5zcXJUbyA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5uU3FyVG8KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblBvdyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZXhwKGEsIG5ldyBTay5idWlsdGluLmJpZ2ludGVnZXIuTnVsbEV4cCgpKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wTXVsdGlwbHlMb3dlclRvID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICB2YXIgZCwKICAgICAgICAgIGUgPSBNYXRoLm1pbih0aGlzLnQgKyBhLnQsIGIpCiAgICAgICAgYy5zID0gMAogICAgICAgIGZvciAoYy50ID0gZTsgMCA8IGU7ICkgY1stLWVdID0gMAogICAgICAgIGZvciAoZCA9IGMudCAtIHRoaXMudDsgZSA8IGQ7ICsrZSkKICAgICAgICAgIGNbZSArIHRoaXMudF0gPSB0aGlzLmFtKDAsIGFbZV0sIGMsIGUsIDAsIHRoaXMudCkKICAgICAgICBmb3IgKGQgPSBNYXRoLm1pbihhLnQsIGIpOyBlIDwgZDsgKytlKSB0aGlzLmFtKDAsIGFbZV0sIGMsIGUsIDAsIGIgLSBlKQogICAgICAgIGMuY2xhbXAoKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wTXVsdGlwbHlVcHBlclRvID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICAtLWIKICAgICAgICB2YXIgZCA9IChjLnQgPSB0aGlzLnQgKyBhLnQgLSBiKQogICAgICAgIGZvciAoYy5zID0gMDsgMCA8PSAtLWQ7ICkgY1tkXSA9IDAKICAgICAgICBmb3IgKGQgPSBNYXRoLm1heChiIC0gdGhpcy50LCAwKTsgZCA8IGEudDsgKytkKQogICAgICAgICAgY1t0aGlzLnQgKyBkIC0gYl0gPSB0aGlzLmFtKGIgLSBkLCBhW2RdLCBjLCAwLCAwLCB0aGlzLnQgKyBkIC0gYikKICAgICAgICBjLmNsYW1wKCkKICAgICAgICBjLmRyU2hpZnRUbygxLCBjKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5CYXJyZXR0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB0aGlzLnIyID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgdGhpcy5xMyA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYmkoKQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5PTkUuZGxTaGlmdFRvKDIgKiBhLnQsIHRoaXMucjIpCiAgICAgICAgdGhpcy5tdSA9IHRoaXMucjIuZGl2aWRlKGEpCiAgICAgICAgdGhpcy5tID0gYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYmFycmV0dENvbnZlcnQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICgwID4gYS5zIHx8IGEudCA+IDIgKiB0aGlzLm0udCkgcmV0dXJuIGEubW9kKHRoaXMubSkKICAgICAgICBpZiAoMCA+IGEuY29tcGFyZVRvKHRoaXMubSkpIHJldHVybiBhCiAgICAgICAgdmFyIGIgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCkKICAgICAgICBhLmNvcHlUbyhiKQogICAgICAgIHRoaXMucmVkdWNlKGIpCiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJhcnJldHRSZXZlcnQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iYXJyZXR0UmVkdWNlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBhLmRyU2hpZnRUbyh0aGlzLm0udCAtIDEsIHRoaXMucjIpCiAgICAgICAgYS50ID4gdGhpcy5tLnQgKyAxICYmICgoYS50ID0gdGhpcy5tLnQgKyAxKSwgYS5jbGFtcCgpKQogICAgICAgIHRoaXMubXUubXVsdGlwbHlVcHBlclRvKHRoaXMucjIsIHRoaXMubS50ICsgMSwgdGhpcy5xMykKICAgICAgICBmb3IgKAogICAgICAgICAgdGhpcy5tLm11bHRpcGx5TG93ZXJUbyh0aGlzLnEzLCB0aGlzLm0udCArIDEsIHRoaXMucjIpOwogICAgICAgICAgMCA+IGEuY29tcGFyZVRvKHRoaXMucjIpOwoKICAgICAgICApCiAgICAgICAgICBhLmRBZGRPZmZzZXQoMSwgdGhpcy5tLnQgKyAxKQogICAgICAgIGZvciAoYS5zdWJUbyh0aGlzLnIyLCBhKTsgMCA8PSBhLmNvbXBhcmVUbyh0aGlzLm0pOyApIGEuc3ViVG8odGhpcy5tLCBhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYmFycmV0dFNxclRvID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBhLnNxdWFyZVRvKGIpCiAgICAgICAgdGhpcy5yZWR1Y2UoYikKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJhcnJldHRNdWxUbyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgYS5tdWx0aXBseVRvKGIsIGMpCiAgICAgICAgdGhpcy5yZWR1Y2UoYykKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuQmFycmV0dC5wcm90b3R5cGUuY29udmVydCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iYXJyZXR0Q29udmVydAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIuQmFycmV0dC5wcm90b3R5cGUucmV2ZXJ0ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJhcnJldHRSZXZlcnQKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLkJhcnJldHQucHJvdG90eXBlLnJlZHVjZSA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iYXJyZXR0UmVkdWNlCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5CYXJyZXR0LnByb3RvdHlwZS5tdWxUbyA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iYXJyZXR0TXVsVG8KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLkJhcnJldHQucHJvdG90eXBlLnNxclRvID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJhcnJldHRTcXJUbwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuTW9kUG93ID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IGEuYml0TGVuZ3RoKCkKICAgICAgICB2YXIgZCA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYnYoMSkKICAgICAgICBpZiAoMCA+PSBjKSByZXR1cm4gZAogICAgICAgIHZhciBlID0gMTggPiBjID8gMSA6IDQ4ID4gYyA/IDMgOiAxNDQgPiBjID8gNCA6IDc2OCA+IGMgPyA1IDogNgogICAgICAgIHZhciBmID0KICAgICAgICAgIDggPiBjCiAgICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5DbGFzc2ljKGIpCiAgICAgICAgICAgIDogYi5pc0V2ZW4oKQogICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmJpZ2ludGVnZXIuQmFycmV0dChiKQogICAgICAgICAgICA6IG5ldyBTay5idWlsdGluLmJpZ2ludGVnZXIuTW9udGdvbWVyeShiKQogICAgICAgIGIgPSBbXQogICAgICAgIHZhciBnID0gMwogICAgICAgIHZhciBoID0gZSAtIDEKICAgICAgICB2YXIgayA9ICgxIDw8IGUpIC0gMQogICAgICAgIGJbMV0gPSBmLmNvbnZlcnQodGhpcykKICAgICAgICBpZiAoMSA8IGUpCiAgICAgICAgICBmb3IgKGMgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCksIGYuc3FyVG8oYlsxXSwgYyk7IGcgPD0gazsgKQogICAgICAgICAgICAoYltnXSA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5uYmkoKSksCiAgICAgICAgICAgICAgZi5tdWxUbyhjLCBiW2cgLSAyXSwgYltnXSksCiAgICAgICAgICAgICAgKGcgKz0gMikKICAgICAgICB2YXIgbCA9IGEudCAtIDEKICAgICAgICB2YXIgciA9ICEwCiAgICAgICAgdmFyIG4gPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpKCkKICAgICAgICBmb3IgKGMgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJpdHMoYVtsXSkgLSAxOyAwIDw9IGw7ICkgewogICAgICAgICAgaWYgKGMgPj0gaCkgdmFyIHEgPSAoYVtsXSA+PiAoYyAtIGgpKSAmIGsKICAgICAgICAgIGVsc2UKICAgICAgICAgICAgKHEgPSAoYVtsXSAmICgoMSA8PCAoYyArIDEpKSAtIDEpKSA8PCAoaCAtIGMpKSwKICAgICAgICAgICAgICAwIDwgbCAmJiAocSB8PSBhW2wgLSAxXSA+PiAodGhpcy5EQiArIGMgLSBoKSkKICAgICAgICAgIGZvciAoZyA9IGU7IDAgPT09IChxICYgMSk7ICkgKHEgPj49IDEpLCAtLWcKICAgICAgICAgIDAgPiAoYyAtPSBnKSAmJiAoKGMgKz0gdGhpcy5EQiksIC0tbCkKICAgICAgICAgIGlmIChyKSBiW3FdLmNvcHlUbyhkKSwgKHIgPSAhMSkKICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBmb3IgKDsgMSA8IGc7ICkgZi5zcXJUbyhkLCBuKSwgZi5zcXJUbyhuLCBkKSwgKGcgLT0gMikKICAgICAgICAgICAgMCA8IGcgPyBmLnNxclRvKGQsIG4pIDogKChnID0gZCksIChkID0gbiksIChuID0gZykpCiAgICAgICAgICAgIGYubXVsVG8obiwgYltxXSwgZCkKICAgICAgICAgIH0KICAgICAgICAgIGZvciAoOyAwIDw9IGwgJiYgMCA9PT0gKGFbbF0gJiAoMSA8PCBjKSk7ICkKICAgICAgICAgICAgZi5zcXJUbyhkLCBuKSwKICAgICAgICAgICAgICAoZyA9IGQpLAogICAgICAgICAgICAgIChkID0gbiksCiAgICAgICAgICAgICAgKG4gPSBnKSwKICAgICAgICAgICAgICAwID4gLS1jICYmICgoYyA9IHRoaXMuREIgLSAxKSwgLS1sKQogICAgICAgIH0KICAgICAgICByZXR1cm4gZi5yZXZlcnQoZCkKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuR0NEID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiA9IDAgPiB0aGlzLnMgPyB0aGlzLm5lZ2F0ZSgpIDogdGhpcy5jbG9uZSgpCiAgICAgICAgYSA9IDAgPiBhLnMgPyBhLm5lZ2F0ZSgpIDogYS5jbG9uZSgpCiAgICAgICAgaWYgKDAgPiBiLmNvbXBhcmVUbyhhKSkgewogICAgICAgICAgdmFyIGMgPSBiCiAgICAgICAgICBiID0gYQogICAgICAgICAgYSA9IGMKICAgICAgICB9CiAgICAgICAgYyA9IGIuZ2V0TG93ZXN0U2V0Qml0KCkKICAgICAgICB2YXIgZCA9IGEuZ2V0TG93ZXN0U2V0Qml0KCkKICAgICAgICBpZiAoMCA+IGQpIHJldHVybiBiCiAgICAgICAgYyA8IGQgJiYgKGQgPSBjKQogICAgICAgIDAgPCBkICYmIChiLnJTaGlmdFRvKGQsIGIpLCBhLnJTaGlmdFRvKGQsIGEpKQogICAgICAgIGZvciAoOyAwIDwgYi5zaWdudW0oKTsgKQogICAgICAgICAgMCA8IChjID0gYi5nZXRMb3dlc3RTZXRCaXQoKSkgJiYgYi5yU2hpZnRUbyhjLCBiKSwKICAgICAgICAgICAgMCA8IChjID0gYS5nZXRMb3dlc3RTZXRCaXQoKSkgJiYgYS5yU2hpZnRUbyhjLCBhKSwKICAgICAgICAgICAgMCA8PSBiLmNvbXBhcmVUbyhhKQogICAgICAgICAgICAgID8gKGIuc3ViVG8oYSwgYiksIGIuclNoaWZ0VG8oMSwgYikpCiAgICAgICAgICAgICAgOiAoYS5zdWJUbyhiLCBhKSwgYS5yU2hpZnRUbygxLCBhKSkKICAgICAgICAwIDwgZCAmJiBhLmxTaGlmdFRvKGQsIGEpCiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucE1vZEludCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBpZiAoMCA+PSBhKSByZXR1cm4gMAogICAgICAgIHZhciBjID0gdGhpcy5EViAlIGEKICAgICAgICB2YXIgZCA9IDAgPiB0aGlzLnMgPyBhIC0gMSA6IDAKICAgICAgICBpZiAoMCA8IHRoaXMudCkKICAgICAgICAgIGlmICgwID09PSBjKSBkID0gdGhpc1swXSAlIGEKICAgICAgICAgIGVsc2UgZm9yIChiID0gdGhpcy50IC0gMTsgMCA8PSBiOyAtLWIpIGQgPSAoYyAqIGQgKyB0aGlzW2JdKSAlIGEKICAgICAgICByZXR1cm4gZAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5Nb2RJbnZlcnNlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiwKICAgICAgICAgIGMgPSBhLmlzRXZlbigpCiAgICAgICAgaWYgKCh0aGlzLmlzRXZlbigpICYmIGMpIHx8IDAgPT09IGEuc2lnbnVtKCkpCiAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLlpFUk8KICAgICAgICB2YXIgZCA9IGEuY2xvbmUoKQogICAgICAgIHZhciBlID0gdGhpcy5jbG9uZSgpCiAgICAgICAgdmFyIGYgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJ2KDEpCiAgICAgICAgdmFyIGcgPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJ2KDApCiAgICAgICAgdmFyIGggPSBTay5idWlsdGluLmJpZ2ludGVnZXIubmJ2KDApCiAgICAgICAgZm9yIChiID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5idigxKTsgMCAhPT0gZC5zaWdudW0oKTsgKSB7CiAgICAgICAgICBmb3IgKDsgZC5pc0V2ZW4oKTsgKQogICAgICAgICAgICBkLnJTaGlmdFRvKDEsIGQpLAogICAgICAgICAgICAgIGMKICAgICAgICAgICAgICAgID8gKChmLmlzRXZlbigpICYmIGcuaXNFdmVuKCkpIHx8CiAgICAgICAgICAgICAgICAgICAgKGYuYWRkVG8odGhpcywgZiksIGcuc3ViVG8oYSwgZykpLAogICAgICAgICAgICAgICAgICBmLnJTaGlmdFRvKDEsIGYpKQogICAgICAgICAgICAgICAgOiBnLmlzRXZlbigpIHx8IGcuc3ViVG8oYSwgZyksCiAgICAgICAgICAgICAgZy5yU2hpZnRUbygxLCBnKQogICAgICAgICAgZm9yICg7IGUuaXNFdmVuKCk7ICkKICAgICAgICAgICAgZS5yU2hpZnRUbygxLCBlKSwKICAgICAgICAgICAgICBjCiAgICAgICAgICAgICAgICA/ICgoaC5pc0V2ZW4oKSAmJiBiLmlzRXZlbigpKSB8fAogICAgICAgICAgICAgICAgICAgIChoLmFkZFRvKHRoaXMsIGgpLCBiLnN1YlRvKGEsIGIpKSwKICAgICAgICAgICAgICAgICAgaC5yU2hpZnRUbygxLCBoKSkKICAgICAgICAgICAgICAgIDogYi5pc0V2ZW4oKSB8fCBiLnN1YlRvKGEsIGIpLAogICAgICAgICAgICAgIGIuclNoaWZ0VG8oMSwgYikKICAgICAgICAgIDAgPD0gZC5jb21wYXJlVG8oZSkKICAgICAgICAgICAgPyAoZC5zdWJUbyhlLCBkKSwgYyAmJiBmLnN1YlRvKGgsIGYpLCBnLnN1YlRvKGIsIGcpKQogICAgICAgICAgICA6IChlLnN1YlRvKGQsIGUpLCBjICYmIGguc3ViVG8oZiwgaCksIGIuc3ViVG8oZywgYikpCiAgICAgICAgfQogICAgICAgIGlmICgwICE9PSBlLmNvbXBhcmVUbyhTay5idWlsdGluLmJpZ2ludGVnZXIuT05FKSkKICAgICAgICAgIHJldHVybiBTay5idWlsdGluLmJpZ2ludGVnZXIuWkVSTwogICAgICAgIGlmICgwIDw9IGIuY29tcGFyZVRvKGEpKSByZXR1cm4gYi5zdWJ0cmFjdChhKQogICAgICAgIGlmICgwID4gYi5zaWdudW0oKSkgYi5hZGRUbyhhLCBiKQogICAgICAgIGVsc2UgcmV0dXJuIGIKICAgICAgICByZXR1cm4gMCA+IGIuc2lnbnVtKCkgPyBiLmFkZChhKSA6IGIKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIubG93cHJpbWVzID0gWwogICAgICAgIDIsCiAgICAgICAgMywKICAgICAgICA1LAogICAgICAgIDcsCiAgICAgICAgMTEsCiAgICAgICAgMTMsCiAgICAgICAgMTcsCiAgICAgICAgMTksCiAgICAgICAgMjMsCiAgICAgICAgMjksCiAgICAgICAgMzEsCiAgICAgICAgMzcsCiAgICAgICAgNDEsCiAgICAgICAgNDMsCiAgICAgICAgNDcsCiAgICAgICAgNTMsCiAgICAgICAgNTksCiAgICAgICAgNjEsCiAgICAgICAgNjcsCiAgICAgICAgNzEsCiAgICAgICAgNzMsCiAgICAgICAgNzksCiAgICAgICAgODMsCiAgICAgICAgODksCiAgICAgICAgOTcsCiAgICAgICAgMTAxLAogICAgICAgIDEwMywKICAgICAgICAxMDcsCiAgICAgICAgMTA5LAogICAgICAgIDExMywKICAgICAgICAxMjcsCiAgICAgICAgMTMxLAogICAgICAgIDEzNywKICAgICAgICAxMzksCiAgICAgICAgMTQ5LAogICAgICAgIDE1MSwKICAgICAgICAxNTcsCiAgICAgICAgMTYzLAogICAgICAgIDE2NywKICAgICAgICAxNzMsCiAgICAgICAgMTc5LAogICAgICAgIDE4MSwKICAgICAgICAxOTEsCiAgICAgICAgMTkzLAogICAgICAgIDE5NywKICAgICAgICAxOTksCiAgICAgICAgMjExLAogICAgICAgIDIyMywKICAgICAgICAyMjcsCiAgICAgICAgMjI5LAogICAgICAgIDIzMywKICAgICAgICAyMzksCiAgICAgICAgMjQxLAogICAgICAgIDI1MSwKICAgICAgICAyNTcsCiAgICAgICAgMjYzLAogICAgICAgIDI2OSwKICAgICAgICAyNzEsCiAgICAgICAgMjc3LAogICAgICAgIDI4MSwKICAgICAgICAyODMsCiAgICAgICAgMjkzLAogICAgICAgIDMwNywKICAgICAgICAzMTEsCiAgICAgICAgMzEzLAogICAgICAgIDMxNywKICAgICAgICAzMzEsCiAgICAgICAgMzM3LAogICAgICAgIDM0NywKICAgICAgICAzNDksCiAgICAgICAgMzUzLAogICAgICAgIDM1OSwKICAgICAgICAzNjcsCiAgICAgICAgMzczLAogICAgICAgIDM3OSwKICAgICAgICAzODMsCiAgICAgICAgMzg5LAogICAgICAgIDM5NywKICAgICAgICA0MDEsCiAgICAgICAgNDA5LAogICAgICAgIDQxOSwKICAgICAgICA0MjEsCiAgICAgICAgNDMxLAogICAgICAgIDQzMywKICAgICAgICA0MzksCiAgICAgICAgNDQzLAogICAgICAgIDQ0OSwKICAgICAgICA0NTcsCiAgICAgICAgNDYxLAogICAgICAgIDQ2MywKICAgICAgICA0NjcsCiAgICAgICAgNDc5LAogICAgICAgIDQ4NywKICAgICAgICA0OTEsCiAgICAgICAgNDk5LAogICAgICAgIDUwMywKICAgICAgICA1MDksCiAgICAgIF0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLmxwbGltID0KICAgICAgICA2NzEwODg2NCAvCiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLmxvd3ByaW1lc1sKICAgICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5sb3dwcmltZXMubGVuZ3RoIC0gMQogICAgICAgIF0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibklzUHJvYmFibGVQcmltZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIsCiAgICAgICAgICBjLAogICAgICAgICAgZCA9IHRoaXMuYWJzKCkKICAgICAgICBpZiAoCiAgICAgICAgICAxID09IGQudCAmJgogICAgICAgICAgZFswXSA8PQogICAgICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIubG93cHJpbWVzWwogICAgICAgICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5sb3dwcmltZXMubGVuZ3RoIC0gMQogICAgICAgICAgICBdCiAgICAgICAgKSB7CiAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLmxvd3ByaW1lcy5sZW5ndGg7ICsrYykKICAgICAgICAgICAgaWYgKGRbMF0gPT0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLmxvd3ByaW1lc1tjXSkgcmV0dXJuICEwCiAgICAgICAgICByZXR1cm4gITEKICAgICAgICB9CiAgICAgICAgaWYgKGQuaXNFdmVuKCkpIHJldHVybiAhMQogICAgICAgIGZvciAoYyA9IDE7IGMgPCBTay5idWlsdGluLmJpZ2ludGVnZXIubG93cHJpbWVzLmxlbmd0aDsgKSB7CiAgICAgICAgICB2YXIgZSA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5sb3dwcmltZXNbY10KICAgICAgICAgIGZvciAoCiAgICAgICAgICAgIGIgPSBjICsgMTsKICAgICAgICAgICAgYiA8IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5sb3dwcmltZXMubGVuZ3RoICYmCiAgICAgICAgICAgIGUgPCBTay5idWlsdGluLmJpZ2ludGVnZXIubHBsaW07CgogICAgICAgICAgKQogICAgICAgICAgICBlICo9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5sb3dwcmltZXNbYisrXQogICAgICAgICAgZm9yIChlID0gZC5tb2RJbnQoZSk7IGMgPCBiOyApCiAgICAgICAgICAgIGlmICgwID09PSBlICUgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLmxvd3ByaW1lc1tjKytdKSByZXR1cm4gITEKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGQubWlsbGVyUmFiaW4oYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucE1pbGxlclJhYmluID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiwKICAgICAgICAgIGMsCiAgICAgICAgICBkID0gdGhpcy5zdWJ0cmFjdChTay5idWlsdGluLmJpZ2ludGVnZXIuT05FKSwKICAgICAgICAgIGUgPSBkLmdldExvd2VzdFNldEJpdCgpCiAgICAgICAgaWYgKDAgPj0gZSkgcmV0dXJuICExCiAgICAgICAgdmFyIGYgPSBkLnNoaWZ0UmlnaHQoZSkKICAgICAgICBhID0gKGEgKyAxKSA+PiAxCiAgICAgICAgYSA+IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5sb3dwcmltZXMubGVuZ3RoICYmCiAgICAgICAgICAoYSA9IFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5sb3dwcmltZXMubGVuZ3RoKQogICAgICAgIHZhciBnID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLm5iaSgpCiAgICAgICAgZm9yIChjID0gMDsgYyA8IGE7ICsrYykgewogICAgICAgICAgZy5mcm9tSW50KFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5sb3dwcmltZXNbY10pCiAgICAgICAgICB2YXIgaCA9IGcubW9kUG93KGYsIHRoaXMpCiAgICAgICAgICBpZiAoCiAgICAgICAgICAgIDAgIT09IGguY29tcGFyZVRvKFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5PTkUpICYmCiAgICAgICAgICAgIDAgIT09IGguY29tcGFyZVRvKGQpCiAgICAgICAgICApIHsKICAgICAgICAgICAgZm9yIChiID0gMTsgYisrIDwgZSAmJiAwICE9PSBoLmNvbXBhcmVUbyhkKTsgKQogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICgoaCA9IGgubW9kUG93SW50KDIsIHRoaXMpKSwKICAgICAgICAgICAgICAgIDAgPT09IGguY29tcGFyZVRvKFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5PTkUpKQogICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHJldHVybiAhMQogICAgICAgICAgICBpZiAoMCAhPT0gaC5jb21wYXJlVG8oZCkpIHJldHVybiAhMQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gITAKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmlzbmVnYXRpdmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIDAgPiB0aGlzLnMKICAgICAgfQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmlzcG9zaXRpdmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIDAgPD0gdGhpcy5zCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS50cnVlQ29tcGFyZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIDAgPD0gdGhpcy5zICYmIDAgPiBhLnMKICAgICAgICAgID8gMQogICAgICAgICAgOiAwID4gdGhpcy5zICYmIDAgPD0gYS5zCiAgICAgICAgICA/IC0xCiAgICAgICAgICA6IHRoaXMuY29tcGFyZShhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuY2h1bmtTaXplID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucENodW5rU2l6ZQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLnRvUmFkaXggPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wVG9SYWRpeAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmZyb21SYWRpeCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBGcm9tUmFkaXgKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5mcm9tTnVtYmVyID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucEZyb21OdW1iZXIKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iaXR3aXNlVG8gPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wQml0d2lzZVRvCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuY2hhbmdlQml0ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucENoYW5nZUJpdAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmFkZFRvID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucEFkZFRvCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuZE11bHRpcGx5ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucERNdWx0aXBseQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmRBZGRPZmZzZXQgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wREFkZE9mZnNldAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm11bHRpcGx5TG93ZXJUbyA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibnBNdWx0aXBseUxvd2VyVG8KICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5tdWx0aXBseVVwcGVyVG8gPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5wTXVsdGlwbHlVcHBlclRvCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUubW9kSW50ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucE1vZEludAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1pbGxlclJhYmluID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJucE1pbGxlclJhYmluCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuY2xvbmUgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5DbG9uZQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmludFZhbHVlID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuSW50VmFsdWUKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ieXRlVmFsdWUgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5CeXRlVmFsdWUKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5zaG9ydFZhbHVlID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuU2hvcnRWYWx1ZQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLnNpZ251bSA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblNpZ051bQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLnRvQnl0ZUFycmF5ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuVG9CeXRlQXJyYXkKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5lcXVhbHMgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5FcXVhbHMKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5jb21wYXJlID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmNvbXBhcmVUbwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1pbiA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibk1pbgogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1heCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibk1heAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmFuZCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkFuZAogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm9yID0gU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibk9yCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUueG9yID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuWG9yCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYW5kTm90ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuQW5kTm90CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUubm90ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuTm90CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuc2hpZnRMZWZ0ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuU2hpZnRMZWZ0CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuc2hpZnRSaWdodCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblNoaWZ0UmlnaHQKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5nZXRMb3dlc3RTZXRCaXQgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5HZXRMb3dlc3RTZXRCaXQKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iaXRDb3VudCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkJpdENvdW50CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUudGVzdEJpdCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblRlc3RCaXQKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5zZXRCaXQgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5TZXRCaXQKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5jbGVhckJpdCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkNsZWFyQml0CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuZmxpcEJpdCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkZsaXBCaXQKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5hZGQgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5BZGQKICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5zdWJ0cmFjdCA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblN1YnRyYWN0CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUubXVsdGlwbHkgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5NdWx0aXBseQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmRpdmlkZSA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkRpdmlkZQogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLnJlbWFpbmRlciA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5iblJlbWFpbmRlcgogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmRpdmlkZUFuZFJlbWFpbmRlciA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibkRpdmlkZUFuZFJlbWFpbmRlcgogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1vZFBvdyA9CiAgICAgICAgU2suYnVpbHRpbi5iaWdpbnRlZ2VyLnByb3RvdHlwZS5ibk1vZFBvdwogICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLm1vZEludmVyc2UgPQogICAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuYm5Nb2RJbnZlcnNlCiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUucG93ID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuUG93CiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuZ2NkID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuR0NECiAgICAgIFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5wcm90b3R5cGUuaXNQcm9iYWJsZVByaW1lID0KICAgICAgICBTay5idWlsdGluLmJpZ2ludGVnZXIucHJvdG90eXBlLmJuSXNQcm9iYWJsZVByaW1lCiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHApIHsKICAgICAgU2suYnVpbHRpbi5pbnRfID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfKSkgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oYSwgYikKICAgICAgICBpZiAodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYm9vbCkgcmV0dXJuIHRoaXMKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyAmJiB2b2lkIDAgPT09IGIpCiAgICAgICAgICByZXR1cm4gKHRoaXMudiA9IGEudiksIHRoaXMKICAgICAgICBpZiAoCiAgICAgICAgICBiICE9PSBTay5idWlsdGluLm5vbmUubm9uZSQgJiYKICAgICAgICAgIHZvaWQgMCAhPT0gYiAmJgogICAgICAgICAgIVNrLmJ1aWx0aW4uY2hlY2tJbnQoYikKICAgICAgICApIHsKICAgICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrRmxvYXQoYikpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgICAiaW50ZWdlciBhcmd1bWVudCBleHBlY3RlZCwgZ290ICIgKyBTay5hYnN0ci50eXBlTmFtZShiKSwKICAgICAgICAgICAgKQogICAgICAgICAgaWYgKGIuX19pbmRleF9fKSBiID0gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGIuX19pbmRleF9fLCBbYl0pCiAgICAgICAgICBlbHNlIGlmIChiLl9faW50X18pIGIgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYi5fX2ludF9fLCBbYl0pCiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yKAogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGIpICsKICAgICAgICAgICAgICAgICIgaW5zdGFuY2UgaGFzIG5vIGF0dHJpYnV0ZSAnX19pbmRleF9fJyBvciAnX19pbnRfXyciLAogICAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zdHIpIHsKICAgICAgICAgIGIgPSBTay5idWlsdGluLmFzbnVtJChiKQogICAgICAgICAgYiA9PT0gU2suYnVpbHRpbi5ub25lLm5vbmUkICYmIChiID0gMTApCiAgICAgICAgICB2YXIgYyA9IFNrLnN0cjJudW1iZXIoCiAgICAgICAgICAgIGEudiwKICAgICAgICAgICAgYiwKICAgICAgICAgICAgcGFyc2VJbnQsCiAgICAgICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgcmV0dXJuIC1hCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJpbnQiLAogICAgICAgICAgKQogICAgICAgICAgaWYgKGMgPiBTay5idWlsdGluLmludF8udGhyZXNob2xkJCB8fCBjIDwgLVNrLmJ1aWx0aW4uaW50Xy50aHJlc2hvbGQkKQogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubG5nKGEsIGIpCiAgICAgICAgICB0aGlzLnYgPSBjCiAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgIH0KICAgICAgICBpZiAodm9pZCAwICE9PSBiICYmIGIgIT09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgImludCgpIGNhbid0IGNvbnZlcnQgbm9uLXN0cmluZyB3aXRoIGV4cGxpY2l0IGJhc2UiLAogICAgICAgICAgKQogICAgICAgIGlmICh2b2lkIDAgPT09IGEgfHwgYSA9PT0gU2suYnVpbHRpbi5ub25lKSBhID0gMAogICAgICAgIGlmICgKICAgICAgICAgIHZvaWQgMCAhPT0gYSAmJgogICAgICAgICAgYS50cCRnZXRhdHRyICYmCiAgICAgICAgICAoYyA9IGEudHAkZ2V0YXR0cihTay5idWlsdGluLnN0ci4kaW50XykpCiAgICAgICAgKSB7CiAgICAgICAgICB2YXIgZCA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShjKQogICAgICAgICAgdmFyIGUgPSAiX19pbnRfXyIKICAgICAgICB9IGVsc2UKICAgICAgICAgIHZvaWQgMCAhPT0gYSAmJiBhLl9faW50X18KICAgICAgICAgICAgPyAoKGQgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYS5fX2ludF9fLCBbYV0pKSwgKGUgPSAiX19pbnRfXyIpKQogICAgICAgICAgICA6IHZvaWQgMCAhPT0gYSAmJgogICAgICAgICAgICAgIGEudHAkZ2V0YXR0ciAmJgogICAgICAgICAgICAgIChjID0gYS50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiR0cnVuYykpCiAgICAgICAgICAgID8gKChkID0gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGMpKSwgKGUgPSAiX190cnVuY19fIikpCiAgICAgICAgICAgIDogdm9pZCAwICE9PSBhICYmCiAgICAgICAgICAgICAgYS5fX3RydW5jX18gJiYKICAgICAgICAgICAgICAoKGQgPSBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYS5fX3RydW5jX18sIFthXSkpLAogICAgICAgICAgICAgIChlID0gIl9fdHJ1bmNfXyIpKQogICAgICAgIGlmICh2b2lkIDAgPT09IGQgfHwgU2suYnVpbHRpbi5jaGVja0ludChkKSkgdm9pZCAwICE9PSBkICYmIChhID0gZCkKICAgICAgICBlbHNlCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgIGUgKyAiIHJldHVybmVkIG5vbi1JbnRlZ3JhbCAodHlwZSAiICsgU2suYWJzdHIudHlwZU5hbWUoZCkgKyAiKSIsCiAgICAgICAgICApCiAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrTnVtYmVyKGEpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiaW50KCkgYXJndW1lbnQgbXVzdCBiZSBhIHN0cmluZyBvciBhIG51bWJlciwgbm90ICciICsKICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShhKSArCiAgICAgICAgICAgICAgIiciLAogICAgICAgICAgKQogICAgICAgIGEgPSBTay5idWlsdGluLmFzbnVtJChhKQogICAgICAgIGlmIChhID4gU2suYnVpbHRpbi5pbnRfLnRocmVzaG9sZCQgfHwgYSA8IC1Tay5idWlsdGluLmludF8udGhyZXNob2xkJCkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5sbmcoYSkKICAgICAgICA7LTEgPCBhICYmIDEgPiBhICYmIChhID0gMCkKICAgICAgICB0aGlzLnYgPSBwYXJzZUludChhLCBiKQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLiRzaGlmdGNvbnN0cyA9IFsKICAgICAgICAwLjUsCiAgICAgICAgMSwKICAgICAgICAyLAogICAgICAgIDQsCiAgICAgICAgOCwKICAgICAgICAxNiwKICAgICAgICAzMiwKICAgICAgICA2NCwKICAgICAgICAxMjgsCiAgICAgICAgMjU2LAogICAgICAgIDUxMiwKICAgICAgICAxMDI0LAogICAgICAgIDIwNDgsCiAgICAgICAgNDA5NiwKICAgICAgICA4MTkyLAogICAgICAgIDE2Mzg0LAogICAgICAgIDMyNzY4LAogICAgICAgIDY1NTM2LAogICAgICAgIDEzMTA3MiwKICAgICAgICAyNjIxNDQsCiAgICAgICAgNTI0Mjg4LAogICAgICAgIDEwNDg1NzYsCiAgICAgICAgMjA5NzE1MiwKICAgICAgICA0MTk0MzA0LAogICAgICAgIDgzODg2MDgsCiAgICAgICAgMTY3NzcyMTYsCiAgICAgICAgMzM1NTQ0MzIsCiAgICAgICAgNjcxMDg4NjQsCiAgICAgICAgMTM0MjE3NzI4LAogICAgICAgIDI2ODQzNTQ1NiwKICAgICAgICA1MzY4NzA5MTIsCiAgICAgICAgMTA3Mzc0MTgyNCwKICAgICAgICAyMTQ3NDgzNjQ4LAogICAgICAgIDQyOTQ5NjcyOTYsCiAgICAgICAgODU4OTkzNDU5MiwKICAgICAgICAxNzE3OTg2OTE4NCwKICAgICAgICAzNDM1OTczODM2OCwKICAgICAgICA2ODcxOTQ3NjczNiwKICAgICAgICAxMzc0Mzg5NTM0NzIsCiAgICAgICAgMjc0ODc3OTA2OTQ0LAogICAgICAgIDU0OTc1NTgxMzg4OCwKICAgICAgICAxMDk5NTExNjI3Nzc2LAogICAgICAgIDIxOTkwMjMyNTU1NTIsCiAgICAgICAgNDM5ODA0NjUxMTEwNCwKICAgICAgICA4Nzk2MDkzMDIyMjA4LAogICAgICAgIDE3NTkyMTg2MDQ0NDE2LAogICAgICAgIDM1MTg0MzcyMDg4ODMyLAogICAgICAgIDcwMzY4NzQ0MTc3NjY0LAogICAgICAgIDB4ODAwMDAwMDAwMDAwLAogICAgICAgIDI4MTQ3NDk3NjcxMDY1NiwKICAgICAgICA1NjI5NDk5NTM0MjEzMTIsCiAgICAgICAgMHg0MDAwMDAwMDAwMDAwLAogICAgICAgIDB4ODAwMDAwMDAwMDAwMCwKICAgICAgICA0NTAzNTk5NjI3MzcwNDk2LAogICAgICAgIDkwMDcxOTkyNTQ3NDA5OTIsCiAgICAgIF0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgiaW50IiwgU2suYnVpbHRpbi5pbnRfLCBTay5idWlsdGluLm51bXR5cGUpCiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkaW50XyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkZmxvYXRfID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy52KQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkbG5nID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy52KQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUuX190cnVuY19fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBhCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUuX19pbmRleF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBhCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUuX19jb21wbGV4X18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUudHAkaW5kZXggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUudHAkaGFzaCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50Xyh0aGlzLnYpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnRocmVzaG9sZCQgPSBNYXRoLnBvdygyLCA1MykgLSAxCiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8odGhpcy52KQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkYWRkID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XykgewogICAgICAgICAgdmFyIGIgPSB0aGlzLnYgKyBhLnYKICAgICAgICAgIHJldHVybiBiID4gU2suYnVpbHRpbi5pbnRfLnRocmVzaG9sZCQgfHwKICAgICAgICAgICAgYiA8IC1Tay5idWlsdGluLmludF8udGhyZXNob2xkJAogICAgICAgICAgICA/ICgoYiA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpKSwgYi5uYiRhZGQoYSkpCiAgICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uaW50XyhiKQogICAgICAgIH0KICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/ICgoYiA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpKSwgYi5uYiRhZGQoYSkpCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyAoKGIgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy52KSksIGIubmIkYWRkKGEpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX2FkZCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkYWRkLmNhbGwodGhpcywgYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJHN1YnRyYWN0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XykgewogICAgICAgICAgdmFyIGIgPSB0aGlzLnYgLSBhLnYKICAgICAgICAgIHJldHVybiBiID4gU2suYnVpbHRpbi5pbnRfLnRocmVzaG9sZCQgfHwKICAgICAgICAgICAgYiA8IC1Tay5idWlsdGluLmludF8udGhyZXNob2xkJAogICAgICAgICAgICA/ICgoYiA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpKSwgYi5uYiRzdWJ0cmFjdChhKSkKICAgICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5pbnRfKGIpCiAgICAgICAgfQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gKChiID0gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMudikpLCBiLm5iJHN1YnRyYWN0KGEpKQogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gKChiID0gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKHRoaXMudikpLCBiLm5iJHN1YnRyYWN0KGEpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX3N1YnRyYWN0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiA9IHRoaXMubmIkbmVnYXRpdmUoKQogICAgICAgIHJldHVybiBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGFkZC5jYWxsKGIsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRtdWx0aXBseSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8pIHsKICAgICAgICAgIHZhciBiID0gdGhpcy52ICogYS52CiAgICAgICAgICByZXR1cm4gYiA+IFNrLmJ1aWx0aW4uaW50Xy50aHJlc2hvbGQkIHx8CiAgICAgICAgICAgIGIgPCAtU2suYnVpbHRpbi5pbnRfLnRocmVzaG9sZCQKICAgICAgICAgICAgPyAoKGIgPSBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy52KSksIGIubmIkbXVsdGlwbHkoYSkpCiAgICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uaW50XyhiKQogICAgICAgIH0KICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/ICgoYiA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpKSwgYi5uYiRtdWx0aXBseShhKSkKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/ICgoYiA9IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzLnYpKSwgYi5uYiRtdWx0aXBseShhKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9tdWx0aXBseSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkbXVsdGlwbHkuY2FsbCh0aGlzLCBhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkZGl2aWRlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoU2suX19mdXR1cmVfXy5kaXZpc2lvbikgewogICAgICAgICAgdmFyIGIgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy52KQogICAgICAgICAgcmV0dXJuIGIubmIkZGl2aWRlKGEpCiAgICAgICAgfQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfCiAgICAgICAgICA/IHRoaXMubmIkZmxvb3JfZGl2aWRlKGEpCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZwogICAgICAgICAgPyAoKGIgPSBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy52KSksIGIubmIkZGl2aWRlKGEpKQogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gKChiID0gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKHRoaXMudikpLCBiLm5iJGRpdmlkZShhKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9kaXZpZGUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiB0aGlzLm5iJHJlZmxlY3RlZF9mbG9vcl9kaXZpZGUoYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGZsb29yX2RpdmlkZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8pIHsKICAgICAgICAgIGlmICgwID09PSBhLnYpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlplcm9EaXZpc2lvbkVycm9yKAogICAgICAgICAgICAgICJpbnRlZ2VyIGRpdmlzaW9uIG9yIG1vZHVsbyBieSB6ZXJvIiwKICAgICAgICAgICAgKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oTWF0aC5mbG9vcih0aGlzLnYgLyBhLnYpKQogICAgICAgIH0KICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nKSB7CiAgICAgICAgICB2YXIgYiA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpCiAgICAgICAgICByZXR1cm4gYi5uYiRmbG9vcl9kaXZpZGUoYSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyAoKGIgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy52KSksIGIubmIkZmxvb3JfZGl2aWRlKGEpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX2Zsb29yX2RpdmlkZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8KICAgICAgICAgID8gYS5uYiRkaXZpZGUodGhpcykKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJHJlbWFpbmRlciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8pIHsKICAgICAgICAgIHZhciBiID0gU2suYWJzdHIubnVtYmVyQmluT3AodGhpcywgYSwgIkZsb29yRGl2IikKICAgICAgICAgIGIgPSBTay5hYnN0ci5udW1iZXJCaW5PcChiLCBhLCAiTXVsdCIpCiAgICAgICAgICBiID0gU2suYWJzdHIubnVtYmVyQmluT3AodGhpcywgYiwgIlN1YiIpCiAgICAgICAgICBiID0gYi52CiAgICAgICAgICAwID4gYS52ICYmIDAgPT09IGIKICAgICAgICAgICAgPyAoYiA9IC0wKQogICAgICAgICAgICA6IDAgPT09IGIgJiYgLUluZmluaXR5ID09PSBJbmZpbml0eSAvIGIgJiYgKGIgPSAwKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oYikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZwogICAgICAgICAgPyAoKGIgPSBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy52KSksIGIubmIkcmVtYWluZGVyKGEpKQogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gKChiID0gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKHRoaXMudikpLCBiLm5iJHJlbWFpbmRlcihhKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9yZW1haW5kZXIgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfCiAgICAgICAgICA/IGEubmIkcmVtYWluZGVyKHRoaXMpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRkaXZtb2QgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnR1cGxlKFsKICAgICAgICAgICAgdGhpcy5uYiRmbG9vcl9kaXZpZGUoYSksCiAgICAgICAgICAgIHRoaXMubmIkcmVtYWluZGVyKGEpLAogICAgICAgICAgXSkKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nKSB7CiAgICAgICAgICB2YXIgYiA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpCiAgICAgICAgICByZXR1cm4gYi5uYiRkaXZtb2QoYSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyAoKGIgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy52KSksIGIubmIkZGl2bW9kKGEpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX2Rpdm1vZCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8KICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4udHVwbGUoWwogICAgICAgICAgICAgIGEubmIkZmxvb3JfZGl2aWRlKHRoaXMpLAogICAgICAgICAgICAgIGEubmIkcmVtYWluZGVyKHRoaXMpLAogICAgICAgICAgICBdKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkcG93ZXIgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGlmICgKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYKICAgICAgICAgICh2b2lkIDAgPT09IGIgfHwgYiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XykKICAgICAgICApIHsKICAgICAgICAgIHZhciBjID0gTWF0aC5wb3codGhpcy52LCBhLnYpCiAgICAgICAgICBjID4gU2suYnVpbHRpbi5pbnRfLnRocmVzaG9sZCQgfHwgYyA8IC1Tay5idWlsdGluLmludF8udGhyZXNob2xkJAogICAgICAgICAgICA/ICgoYyA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpKSwgKGMgPSBjLm5iJHBvd2VyKGEsIGIpKSkKICAgICAgICAgICAgOiAoYyA9IDAgPiBhLnYgPyBuZXcgU2suYnVpbHRpbi5mbG9hdF8oYykgOiBuZXcgU2suYnVpbHRpbi5pbnRfKGMpKQogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gYikgewogICAgICAgICAgICBpZiAoMCA+IGEudikKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgICAicG93KCkgMm5kIGFyZ3VtZW50IGNhbm5vdCBiZSBuZWdhdGl2ZSB3aGVuIDNyZCBhcmd1bWVudCBzcGVjaWZpZWQiLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIGMubmIkcmVtYWluZGVyKGIpCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYwogICAgICAgIH0KICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/ICgoYyA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpKSwgYy5uYiRwb3dlcihhKSkKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/ICgoYiA9IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzLnYpKSwgYi5uYiRwb3dlcihhKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9wb3dlciA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8KICAgICAgICAgID8gYS5uYiRwb3dlcih0aGlzLCBiKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkYWJzID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKE1hdGguYWJzKHRoaXMudikpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRhbmQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfKSB7CiAgICAgICAgICBhID0gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICAgIHZhciBiID0gdGhpcy52ICYgYQogICAgICAgICAgdm9pZCAwICE9PSBiICYmIDAgPiBiICYmIChiICs9IDQyOTQ5NjcyOTYpCiAgICAgICAgICBpZiAodm9pZCAwICE9PSBiKSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhiKQogICAgICAgIH0KICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/ICgoYiA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpKSwgYi5uYiRhbmQoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfYW5kID0KICAgICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGFuZAogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJG9yID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XykgewogICAgICAgICAgYSA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgICB2YXIgYiA9IHRoaXMudiB8IGEKICAgICAgICAgIHZvaWQgMCAhPT0gYiAmJiAwID4gYiAmJiAoYiArPSA0Mjk0OTY3Mjk2KQogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gYikgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oYikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZwogICAgICAgICAgPyAoKGIgPSBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy52KSksIGIubmIkYW5kKGEpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX29yID0KICAgICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJG9yCiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkeG9yID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XykgewogICAgICAgICAgYSA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgICB2YXIgYiA9IHRoaXMudiBeIGEKICAgICAgICAgIHZvaWQgMCAhPT0gYiAmJiAwID4gYiAmJiAoYiArPSA0Mjk0OTY3Mjk2KQogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gYikgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oYikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZwogICAgICAgICAgPyAoKGIgPSBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy52KSksIGIubmIkeG9yKGEpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX3hvciA9CiAgICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiR4b3IKICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRsc2hpZnQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICgwID09PSB0aGlzLnYpIHJldHVybiB0aGlzCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8pIHsKICAgICAgICAgIHZhciBiID0gU2suYnVpbHRpbi5hc251bSQoYSkKICAgICAgICAgIGlmICh2b2lkIDAgIT09IGIpIHsKICAgICAgICAgICAgaWYgKDAgPiBiKSB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJuZWdhdGl2ZSBzaGlmdCBjb3VudCIpCiAgICAgICAgICAgIGlmICg1MyA8IGIpCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpLm5iJGxzaGlmdCgKICAgICAgICAgICAgICAgIG5ldyBTay5idWlsdGluLmludF8oYiksCiAgICAgICAgICAgICAgKQogICAgICAgICAgICB2YXIgYyA9IDIgKiB0aGlzLnYgKiBTay5idWlsdGluLmludF8uJHNoaWZ0Y29uc3RzW2JdCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBjID4gU2suYnVpbHRpbi5pbnRfLnRocmVzaG9sZCQgfHwKICAgICAgICAgICAgICBjIDwgLVNrLmJ1aWx0aW4uaW50Xy50aHJlc2hvbGQkCiAgICAgICAgICAgICkKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubG5nKGMpCiAgICAgICAgICB9CiAgICAgICAgICBpZiAodm9pZCAwICE9PSBjKSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhjKQogICAgICAgIH0KICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/ICgoYyA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpKSwgYy5uYiRsc2hpZnQoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfbHNoaWZ0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XwogICAgICAgICAgPyBhLm5iJGxzaGlmdCh0aGlzKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkcnNoaWZ0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XykgewogICAgICAgICAgdmFyIGIgPSBTay5idWlsdGluLmFzbnVtJChhKQogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gYikgewogICAgICAgICAgICBpZiAoMCA+IGIpIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoIm5lZ2F0aXZlIHNoaWZ0IGNvdW50IikKICAgICAgICAgICAgdmFyIGMgPSB0aGlzLnYgPj4gYgogICAgICAgICAgICAwIDwgdGhpcy52ICYmIDAgPiBjICYmIChjICY9IE1hdGgucG93KDIsIDMyIC0gYikgLSAxKQogICAgICAgICAgfQogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gYykgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oYykKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZwogICAgICAgICAgPyAoKGMgPSBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy52KSksIGMubmIkcnNoaWZ0KGEpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX3JzaGlmdCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8KICAgICAgICAgID8gYS5uYiRyc2hpZnQodGhpcykKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGludmVydCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50Xyh+dGhpcy52KQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkaW5wbGFjZV9hZGQgPQogICAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkYWRkCiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkaW5wbGFjZV9zdWJ0cmFjdCA9CiAgICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRzdWJ0cmFjdAogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJGlucGxhY2VfbXVsdGlwbHkgPQogICAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkbXVsdGlwbHkKICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRpbnBsYWNlX2RpdmlkZSA9CiAgICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRkaXZpZGUKICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRpbnBsYWNlX3JlbWFpbmRlciA9CiAgICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRyZW1haW5kZXIKICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRpbnBsYWNlX2Zsb29yX2RpdmlkZSA9CiAgICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRmbG9vcl9kaXZpZGUKICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRpbnBsYWNlX3Bvd2VyID0KICAgICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm5iJHBvd2VyCiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkaW5wbGFjZV9hbmQgPQogICAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkYW5kCiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkaW5wbGFjZV9vciA9IFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkb3IKICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRpbnBsYWNlX3hvciA9CiAgICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiR4b3IKICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRpbnBsYWNlX2xzaGlmdCA9CiAgICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRsc2hpZnQKICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRpbnBsYWNlX3JzaGlmdCA9CiAgICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRyc2hpZnQKICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRuZWdhdGl2ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XygtdGhpcy52KQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkcG9zaXRpdmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubmIkbm9uemVybyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gMCAhPT0gdGhpcy52CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRpc25lZ2F0aXZlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAwID4gdGhpcy52CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5uYiRpc3Bvc2l0aXZlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAwIDw9IHRoaXMudgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUubnVtYmVyQ29tcGFyZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8KICAgICAgICAgID8gdGhpcy52IC0gYS52CiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZwogICAgICAgICAgPyAtYS5sb25nQ29tcGFyZSh0aGlzKQogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gLWEubnVtYmVyQ29tcGFyZSh0aGlzKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUub2IkZXEgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5ib29sKDAgPT0gdGhpcy5udW1iZXJDb21wYXJlKGEpKQogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5ub25lCiAgICAgICAgICA/IFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm9iJG5lID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uYm9vbCgwICE9IHRoaXMubnVtYmVyQ29tcGFyZShhKSkKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubm9uZQogICAgICAgICAgPyBTay5idWlsdGluLmJvb2wudHJ1ZSQKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLm9iJGx0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uYm9vbCgwID4gdGhpcy5udW1iZXJDb21wYXJlKGEpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUub2IkbGUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5ib29sKDAgPj0gdGhpcy5udW1iZXJDb21wYXJlKGEpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUub2IkZ3QgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5ib29sKDAgPCB0aGlzLm51bWJlckNvbXBhcmUoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5vYiRnZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmJvb2woMCA8PSB0aGlzLm51bWJlckNvbXBhcmUoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pbnRfLnByb3RvdHlwZS5yb3VuZCQgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fcm91bmRfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDIpCiAgICAgICAgaWYgKHZvaWQgMCAhPT0gYiAmJiAhU2subWlzY2V2YWwuaXNJbmRleChiKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIiciICsKICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShiKSArCiAgICAgICAgICAgICAgIicgb2JqZWN0IGNhbm5vdCBiZSBpbnRlcnByZXRlZCBhcyBhbiBpbmRleCIsCiAgICAgICAgICApCiAgICAgICAgdmFyIGMgPSBTay5idWlsdGluLmFzbnVtJChhKQogICAgICAgIHZhciBkID0gdm9pZCAwID09PSBiID8gMCA6IFNrLm1pc2NldmFsLmFzSW5kZXgoYikKICAgICAgICBpZiAoU2suX19mdXR1cmVfXy5iYW5rZXJzX3JvdW5kaW5nKSB7CiAgICAgICAgICBjICo9IE1hdGgucG93KDEwLCBkKQogICAgICAgICAgdmFyIGUgPSBNYXRoLnJvdW5kKGMpCiAgICAgICAgICBkID0KICAgICAgICAgICAgKDAuNSA9PT0gKDAgPCBjID8gYyA6IC1jKSAlIDEgPyAoMCA9PT0gZSAlIDIgPyBlIDogZSAtIDEpIDogZSkgLwogICAgICAgICAgICBNYXRoLnBvdygxMCwgZCkKICAgICAgICB9IGVsc2UgKGQgPSBNYXRoLnBvdygxMCwgZCkpLCAoZCA9IE1hdGgucm91bmQoYyAqIGQpIC8gZCkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhkKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUuX19mb3JtYXRfXyA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19mb3JtYXRfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDIsIDIpCiAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYikpIHsKICAgICAgICAgIHZhciBjID0gU2suZmZpLnJlbWFwVG9KcyhiKQogICAgICAgICAgaWYgKCIiICE9PSBjKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAgICJmb3JtYXQgc3BlYyBpcyBub3QgeWV0IGltcGxlbWVudGVkIiwKICAgICAgICAgICAgKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoU2suX19mdXR1cmVfXy5leGNlcHRpb25zKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgImZvcm1hdCgpIGFyZ3VtZW50IDIgbXVzdCBiZSBzdHIsIG5vdCAiICsgU2suYWJzdHIudHlwZU5hbWUoYiksCiAgICAgICAgICAgICkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgImZvcm1hdCBleHBlY3RzIGFyZyAyIHRvIGJlIHN0cmluZyBvciB1bmljb2RlLCBub3QgIiArCiAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYiksCiAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLmNvbmp1Z2F0ZSA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhhLnYpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cih0aGlzLnN0ciQoMTAsICEwKSkKICAgICAgfQogICAgICBTay5idWlsdGluLmludF8ucHJvdG90eXBlLnRwJHN0ciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKHRoaXMuc3RyJCgxMCwgITApKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5wcm90b3R5cGUuc3RyJCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdm9pZCAwID09PSBiICYmIChiID0gITApCiAgICAgICAgYiA9IGIgPyB0aGlzLnYgOiBNYXRoLmFicyh0aGlzLnYpCiAgICAgICAgcmV0dXJuIHZvaWQgMCA9PT0gYSB8fCAxMCA9PT0gYSA/IGIudG9TdHJpbmcoKSA6IGIudG9TdHJpbmcoYSkKICAgICAgfQogICAgICBTay5zdHIybnVtYmVyID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICB2YXIgZiA9IGEsCiAgICAgICAgICBnID0gITEsCiAgICAgICAgICBoCiAgICAgICAgYSA9IGEucmVwbGFjZSgvXlxzK3xccyskL2csICIiKQogICAgICAgICItIiA9PT0gYS5jaGFyQXQoMCkgJiYgKChnID0gITApLCAoYSA9IGEuc3Vic3RyaW5nKDEpKSkKICAgICAgICAiKyIgPT09IGEuY2hhckF0KDApICYmIChhID0gYS5zdWJzdHJpbmcoMSkpCiAgICAgICAgaWYgKG51bGwgPT09IGIgfHwgdm9pZCAwID09PSBiKSBiID0gMTAKICAgICAgICBpZiAoKDIgPiBiIHx8IDM2IDwgYikgJiYgMCAhPT0gYikKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoZSArICIoKSBiYXNlIG11c3QgYmUgPj0gMiBhbmQgPD0gMzYiKQogICAgICAgIGlmICgiMHgiID09PSBhLnN1YnN0cmluZygwLCAyKS50b0xvd2VyQ2FzZSgpKQogICAgICAgICAgaWYgKDE2ID09PSBiIHx8IDAgPT09IGIpIChhID0gYS5zdWJzdHJpbmcoMikpLCAoYiA9IDE2KQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmICgzNCA+IGIpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigKICAgICAgICAgICAgICAgICJpbnZhbGlkIGxpdGVyYWwgZm9yICIgKwogICAgICAgICAgICAgICAgICBlICsKICAgICAgICAgICAgICAgICAgIigpIHdpdGggYmFzZSAiICsKICAgICAgICAgICAgICAgICAgYiArCiAgICAgICAgICAgICAgICAgICI6ICciICsKICAgICAgICAgICAgICAgICAgZiArCiAgICAgICAgICAgICAgICAgICInIiwKICAgICAgICAgICAgICApCiAgICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoIjBiIiA9PT0gYS5zdWJzdHJpbmcoMCwgMikudG9Mb3dlckNhc2UoKSkKICAgICAgICAgIGlmICgyID09PSBiIHx8IDAgPT09IGIpIChhID0gYS5zdWJzdHJpbmcoMikpLCAoYiA9IDIpCiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYgKDEyID4gYikKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKAogICAgICAgICAgICAgICAgImludmFsaWQgbGl0ZXJhbCBmb3IgIiArCiAgICAgICAgICAgICAgICAgIGUgKwogICAgICAgICAgICAgICAgICAiKCkgd2l0aCBiYXNlICIgKwogICAgICAgICAgICAgICAgICBiICsKICAgICAgICAgICAgICAgICAgIjogJyIgKwogICAgICAgICAgICAgICAgICBmICsKICAgICAgICAgICAgICAgICAgIiciLAogICAgICAgICAgICAgICkKICAgICAgICAgIH0KICAgICAgICBlbHNlIGlmICgiMG8iID09PSBhLnN1YnN0cmluZygwLCAyKS50b0xvd2VyQ2FzZSgpKQogICAgICAgICAgaWYgKDggPT09IGIgfHwgMCA9PT0gYikgKGEgPSBhLnN1YnN0cmluZygyKSksIChiID0gOCkKICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBpZiAoMjUgPiBiKQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoCiAgICAgICAgICAgICAgICAiaW52YWxpZCBsaXRlcmFsIGZvciAiICsKICAgICAgICAgICAgICAgICAgZSArCiAgICAgICAgICAgICAgICAgICIoKSB3aXRoIGJhc2UgIiArCiAgICAgICAgICAgICAgICAgIGIgKwogICAgICAgICAgICAgICAgICAiOiAnIiArCiAgICAgICAgICAgICAgICAgIGYgKwogICAgICAgICAgICAgICAgICAiJyIsCiAgICAgICAgICAgICAgKQogICAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKCIwIiA9PT0gYS5jaGFyQXQoMCkpIHsKICAgICAgICAgIGlmICgiMCIgPT09IGEpIHJldHVybiAwCiAgICAgICAgICBpZiAoOCA9PT0gYiB8fCAwID09PSBiKSBiID0gOAogICAgICAgIH0KICAgICAgICAwID09PSBiICYmIChiID0gMTApCiAgICAgICAgaWYgKDAgPT09IGEubGVuZ3RoKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigKICAgICAgICAgICAgImludmFsaWQgbGl0ZXJhbCBmb3IgIiArIGUgKyAiKCkgd2l0aCBiYXNlICIgKyBiICsgIjogJyIgKyBmICsgIiciLAogICAgICAgICAgKQogICAgICAgIGZvciAoaCA9IDA7IGggPCBhLmxlbmd0aDsgaCArPSAxKSB7CiAgICAgICAgICB2YXIgayA9IGEuY2hhckNvZGVBdChoKQogICAgICAgICAgdmFyIGwgPSBiCiAgICAgICAgICA0OCA8PSBrICYmIDU3ID49IGsKICAgICAgICAgICAgPyAobCA9IGsgLSA0OCkKICAgICAgICAgICAgOiA2NSA8PSBrICYmIDkwID49IGsKICAgICAgICAgICAgPyAobCA9IGsgLSA2NSArIDEwKQogICAgICAgICAgICA6IDk3IDw9IGsgJiYgMTIyID49IGsgJiYgKGwgPSBrIC0gOTcgKyAxMCkKICAgICAgICAgIGlmIChsID49IGIpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoCiAgICAgICAgICAgICAgImludmFsaWQgbGl0ZXJhbCBmb3IgIiArCiAgICAgICAgICAgICAgICBlICsKICAgICAgICAgICAgICAgICIoKSB3aXRoIGJhc2UgIiArCiAgICAgICAgICAgICAgICBiICsKICAgICAgICAgICAgICAgICI6ICciICsKICAgICAgICAgICAgICAgIGYgKwogICAgICAgICAgICAgICAgIiciLAogICAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIGwgPSBjKGEsIGIpCiAgICAgICAgZyAmJiAobCA9IGQobCkpCiAgICAgICAgcmV0dXJuIGwKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uaW50XyIsIFNrLmJ1aWx0aW4uaW50XykKICAgIH0sCiAgICBmdW5jdGlvbiAobSwgcCkgewogICAgICBTay5idWlsdGluLmJvb2wgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImJvb2wiLCBhcmd1bWVudHMubGVuZ3RoLCAxKQogICAgICAgIHJldHVybiBTay5taXNjZXZhbC5pc1RydWUoYSkKICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLnRydWUkCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKCJib29sIiwgU2suYnVpbHRpbi5ib29sLCBTay5idWlsdGluLmludF8pCiAgICAgIFNrLmJ1aWx0aW4uYm9vbC5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudiA/IG5ldyBTay5idWlsdGluLnN0cigiVHJ1ZSIpIDogbmV3IFNrLmJ1aWx0aW4uc3RyKCJGYWxzZSIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ib29sLnByb3RvdHlwZS50cCRoYXNoID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5pbnRfKHRoaXMudikKICAgICAgfQogICAgICBTay5idWlsdGluLmJvb2wucHJvdG90eXBlLl9faW50X18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgYSA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oYSkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5ib29sLnByb3RvdHlwZS5fX2Zsb2F0X18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmZsb2F0XyhTay5mZmkucmVtYXBUb0pzKGEpKQogICAgICB9KQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uYm9vbCIsIFNrLmJ1aWx0aW4uYm9vbCkKICAgIH0sCiAgICBmdW5jdGlvbiAobSwgcCkgewogICAgICBTay5idWlsdGluLmZsb2F0XyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYSkgcmV0dXJuIG5ldyBTay5idWlsdGluLmZsb2F0XygwKQogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGEpCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLnN0cikgcmV0dXJuIFNrLmJ1aWx0aW4uX3N0cl90b19mbG9hdChhLnYpCiAgICAgICAgaWYgKAogICAgICAgICAgIm51bWJlciIgPT09IHR5cGVvZiBhIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICkgewogICAgICAgICAgYSA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgICBpZiAoInN0cmluZyIgPT09IHR5cGVvZiBhKSByZXR1cm4gU2suYnVpbHRpbi5fc3RyX3RvX2Zsb2F0KGEpCiAgICAgICAgICB0aGlzLnYgPSBhCiAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgIH0KICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYm9vbCkKICAgICAgICAgIHJldHVybiAodGhpcy52ID0gU2suYnVpbHRpbi5hc251bSQoYSkpLCB0aGlzCiAgICAgICAgaWYgKCJib29sZWFuIiA9PT0gdHlwZW9mIGEpIHJldHVybiAodGhpcy52ID0gYSA/IDEgOiAwKSwgdGhpcwogICAgICAgIGlmICgic3RyaW5nIiA9PT0gdHlwZW9mIGEpIHJldHVybiAodGhpcy52ID0gcGFyc2VGbG9hdChhKSksIHRoaXMKICAgICAgICB2YXIgYiA9IFNrLmFic3RyLmxvb2t1cFNwZWNpYWwoYSwgU2suYnVpbHRpbi5zdHIuJGZsb2F0XykKICAgICAgICBpZiAobnVsbCAhPSBiKSByZXR1cm4gU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KGIsIFthXSkKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAiZmxvYXQoKSBhcmd1bWVudCBtdXN0IGJlIGEgc3RyaW5nIG9yIGEgbnVtYmVyIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgiZmxvYXQiLCBTay5idWlsdGluLmZsb2F0XywgU2suYnVpbHRpbi5udW10eXBlKQogICAgICBTay5idWlsdGluLl9zdHJfdG9fZmxvYXQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmIChhLm1hdGNoKC9eLWluZiQvaSkpIGEgPSAtSW5maW5pdHkKICAgICAgICBlbHNlIGlmIChhLm1hdGNoKC9eWytdP2luZiQvaSkpIGEgPSBJbmZpbml0eQogICAgICAgIGVsc2UgaWYgKGEubWF0Y2goL15bLStdP25hbiQvaSkpIGEgPSBOYU4KICAgICAgICBlbHNlIHsKICAgICAgICAgIGlmIChpc05hTihhKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigKICAgICAgICAgICAgICAiZmxvYXQ6IEFyZ3VtZW50OiAiICsgYSArICIgaXMgbm90IG51bWJlciIsCiAgICAgICAgICAgICkKICAgICAgICAgIGEgPSBwYXJzZUZsb2F0KGEpCiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5mbG9hdF8oYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkaW50XyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgYSA9IHRoaXMudgogICAgICAgIGEgPSAwID4gYSA/IE1hdGguY2VpbChhKSA6IE1hdGguZmxvb3IoYSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uaW50XyhhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRmbG9hdF8gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkbG5nID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy52KQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLlB5RmxvYXRfQ2hlY2sgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiB2b2lkIDAgPT09IGEKICAgICAgICAgID8gITEKICAgICAgICAgIDogU2suYnVpbHRpbi5jaGVja051bWJlcihhKSB8fAogICAgICAgICAgICBTay5idWlsdGluLmNoZWNrRmxvYXQoYSkgfHwKICAgICAgICAgICAgU2suYnVpbHRpbi5pc3N1YmNsYXNzKGEub2IkdHlwZSwgU2suYnVpbHRpbi5mbG9hdF8pCiAgICAgICAgICA/ICEwCiAgICAgICAgICA6ICExCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8uUHlGbG9hdF9DaGVja19FeGFjdCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uY2hlY2tGbG9hdChhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLlB5RmxvYXRfQXNEb3VibGUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmIChhICYmIFNrLmJ1aWx0aW4uZmxvYXRfLlB5RmxvYXRfQ2hlY2soYSkpIHJldHVybiBTay5mZmkucmVtYXBUb0pzKGEpCiAgICAgICAgaWYgKG51bGwgPT0gYSkKICAgICAgICAgIHRocm93IEVycm9yKCJiYWQgYXJndW1lbnQgZm9yIGludGVybmFsIFB5RmxvYXRfQXNEb3VibGUgZnVuY3Rpb24iKQogICAgICAgIHZhciBiID0gU2suYnVpbHRpbi50eXBlLnR5cGVMb29rdXAoYS5vYiR0eXBlLCBTay5idWlsdGluLnN0ci4kZmxvYXRfKQogICAgICAgIGlmIChudWxsID09IGIpIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiYSBmbG9hdCBpcyByZXF1aXJlZCIpCiAgICAgICAgYSA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShiLCBbYV0pCiAgICAgICAgaWYgKCFTay5idWlsdGluLmZsb2F0Xy5QeUZsb2F0X0NoZWNrKGEpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJuYl9mbG9hdCBzaG91bGQgcmV0dXJuIGZsb2F0IG9iamVjdCIpCiAgICAgICAgcmV0dXJuIFNrLmZmaS5yZW1hcFRvSnMoYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUudHAkaW5kZXggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS50cCRoYXNoID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLm5iJGludF8oKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKHRoaXMudikKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUudG9GaXhlZCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgYSA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgcmV0dXJuIHRoaXMudi50b0ZpeGVkKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJGFkZCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzLnYgKyBhLnYpCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy52ICsgcGFyc2VGbG9hdChhLnN0ciQoMTAsICEwKSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9hZGQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkYWRkLmNhbGwodGhpcywgYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkc3VidHJhY3QgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy52IC0gYS52KQogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKHRoaXMudiAtIHBhcnNlRmxvYXQoYS5zdHIkKDEwLCAhMCkpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfc3VidHJhY3QgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0gdGhpcy5uYiRuZWdhdGl2ZSgpCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRhZGQuY2FsbChiLCBhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRtdWx0aXBseSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzLnYgKiBhLnYpCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy52ICogcGFyc2VGbG9hdChhLnN0ciQoMTAsICEwKSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9tdWx0aXBseSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRtdWx0aXBseS5jYWxsKHRoaXMsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJGRpdmlkZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfKSB7CiAgICAgICAgICBpZiAoMCA9PT0gYS52KQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5aZXJvRGl2aXNpb25FcnJvcigKICAgICAgICAgICAgICAiaW50ZWdlciBkaXZpc2lvbiBvciBtb2R1bG8gYnkgemVybyIsCiAgICAgICAgICAgICkKICAgICAgICAgIHJldHVybiBJbmZpbml0eSA9PT0gdGhpcy52CiAgICAgICAgICAgID8gSW5maW5pdHkgPT09IGEudiB8fCAtSW5maW5pdHkgPT09IGEudgogICAgICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKE5hTikKICAgICAgICAgICAgICA6IGEubmIkaXNuZWdhdGl2ZSgpCiAgICAgICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5mbG9hdF8oLUluZmluaXR5KQogICAgICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKEluZmluaXR5KQogICAgICAgICAgICA6IC1JbmZpbml0eSA9PT0gdGhpcy52CiAgICAgICAgICAgID8gSW5maW5pdHkgPT09IGEudiB8fCAtSW5maW5pdHkgPT09IGEudgogICAgICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKE5hTikKICAgICAgICAgICAgICA6IGEubmIkaXNuZWdhdGl2ZSgpCiAgICAgICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5mbG9hdF8oSW5maW5pdHkpCiAgICAgICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5mbG9hdF8oLUluZmluaXR5KQogICAgICAgICAgICA6IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzLnYgLyBhLnYpCiAgICAgICAgfQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcpIHsKICAgICAgICAgIGlmICgwID09PSBhLmxvbmdDb21wYXJlKFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5aRVJPKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uWmVyb0RpdmlzaW9uRXJyb3IoCiAgICAgICAgICAgICAgImludGVnZXIgZGl2aXNpb24gb3IgbW9kdWxvIGJ5IHplcm8iLAogICAgICAgICAgICApCiAgICAgICAgICByZXR1cm4gSW5maW5pdHkgPT09IHRoaXMudgogICAgICAgICAgICA/IGEubmIkaXNuZWdhdGl2ZSgpCiAgICAgICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5mbG9hdF8oLUluZmluaXR5KQogICAgICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKEluZmluaXR5KQogICAgICAgICAgICA6IC1JbmZpbml0eSA9PT0gdGhpcy52CiAgICAgICAgICAgID8gYS5uYiRpc25lZ2F0aXZlKCkKICAgICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmZsb2F0XyhJbmZpbml0eSkKICAgICAgICAgICAgICA6IG5ldyBTay5idWlsdGluLmZsb2F0XygtSW5maW5pdHkpCiAgICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKHRoaXMudiAvIHBhcnNlRmxvYXQoYS5zdHIkKDEwLCAhMCkpKQogICAgICAgIH0KICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX2RpdmlkZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nKQogICAgICAgICAgYSA9IG5ldyBTay5idWlsdGluLmZsb2F0XyhhKQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gYS5uYiRkaXZpZGUodGhpcykKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkZmxvb3JfZGl2aWRlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fCBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8pIHsKICAgICAgICAgIGlmIChJbmZpbml0eSA9PT0gdGhpcy52IHx8IC1JbmZpbml0eSA9PT0gdGhpcy52KQogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKE5hTikKICAgICAgICAgIGlmICgwID09PSBhLnYpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlplcm9EaXZpc2lvbkVycm9yKAogICAgICAgICAgICAgICJpbnRlZ2VyIGRpdmlzaW9uIG9yIG1vZHVsbyBieSB6ZXJvIiwKICAgICAgICAgICAgKQogICAgICAgICAgcmV0dXJuIEluZmluaXR5ID09PSBhLnYKICAgICAgICAgICAgPyB0aGlzLm5iJGlzbmVnYXRpdmUoKQogICAgICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKC0xKQogICAgICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKDApCiAgICAgICAgICAgIDogLUluZmluaXR5ID09PSBhLnYKICAgICAgICAgICAgPyB0aGlzLm5iJGlzbmVnYXRpdmUoKSB8fCAhdGhpcy5uYiRub256ZXJvKCkKICAgICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmZsb2F0XygwKQogICAgICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKC0xKQogICAgICAgICAgICA6IG5ldyBTay5idWlsdGluLmZsb2F0XyhNYXRoLmZsb29yKHRoaXMudiAvIGEudikpCiAgICAgICAgfQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcpIHsKICAgICAgICAgIGlmICgwID09PSBhLmxvbmdDb21wYXJlKFNrLmJ1aWx0aW4uYmlnaW50ZWdlci5aRVJPKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uWmVyb0RpdmlzaW9uRXJyb3IoCiAgICAgICAgICAgICAgImludGVnZXIgZGl2aXNpb24gb3IgbW9kdWxvIGJ5IHplcm8iLAogICAgICAgICAgICApCiAgICAgICAgICByZXR1cm4gSW5maW5pdHkgPT09IHRoaXMudiB8fCAtSW5maW5pdHkgPT09IHRoaXMudgogICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmZsb2F0XyhOYU4pCiAgICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKAogICAgICAgICAgICAgICAgTWF0aC5mbG9vcih0aGlzLnYgLyBwYXJzZUZsb2F0KGEuc3RyJCgxMCwgITApKSksCiAgICAgICAgICAgICAgKQogICAgICAgIH0KICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX2Zsb29yX2RpdmlkZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nKQogICAgICAgICAgYSA9IG5ldyBTay5idWlsdGluLmZsb2F0XyhhKQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gYS5uYiRmbG9vcl9kaXZpZGUodGhpcykKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkcmVtYWluZGVyID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fCBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8pIHsKICAgICAgICAgIGlmICgwID09PSBhLnYpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlplcm9EaXZpc2lvbkVycm9yKAogICAgICAgICAgICAgICJpbnRlZ2VyIGRpdmlzaW9uIG9yIG1vZHVsbyBieSB6ZXJvIiwKICAgICAgICAgICAgKQogICAgICAgICAgaWYgKDAgPT09IHRoaXMudikgcmV0dXJuIG5ldyBTay5idWlsdGluLmZsb2F0XygwKQogICAgICAgICAgaWYgKEluZmluaXR5ID09PSBhLnYpCiAgICAgICAgICAgIHJldHVybiBJbmZpbml0eSA9PT0gdGhpcy52IHx8IC1JbmZpbml0eSA9PT0gdGhpcy52CiAgICAgICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5mbG9hdF8oTmFOKQogICAgICAgICAgICAgIDogdGhpcy5uYiRpc3Bvc2l0aXZlKCkKICAgICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzLnYpCiAgICAgICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5mbG9hdF8oSW5maW5pdHkpCiAgICAgICAgICB2YXIgYiA9IHRoaXMudiAlIGEudgogICAgICAgICAgMCA+IHRoaXMudgogICAgICAgICAgICA/IDAgPCBhLnYgJiYgMCA+IGIgJiYgKGIgKz0gYS52KQogICAgICAgICAgICA6IDAgPiBhLnYgJiYgMCAhPT0gYiAmJiAoYiArPSBhLnYpCiAgICAgICAgICAwID4gYS52ICYmIDAgPT09IGIKICAgICAgICAgICAgPyAoYiA9IC0wKQogICAgICAgICAgICA6IDAgPT09IGIgJiYgLUluZmluaXR5ID09PSBJbmZpbml0eSAvIGIgJiYgKGIgPSAwKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmZsb2F0XyhiKQogICAgICAgIH0KICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nKSB7CiAgICAgICAgICBpZiAoMCA9PT0gYS5sb25nQ29tcGFyZShTay5idWlsdGluLmJpZ2ludGVnZXIuWkVSTykpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlplcm9EaXZpc2lvbkVycm9yKAogICAgICAgICAgICAgICJpbnRlZ2VyIGRpdmlzaW9uIG9yIG1vZHVsbyBieSB6ZXJvIiwKICAgICAgICAgICAgKQogICAgICAgICAgaWYgKDAgPT09IHRoaXMudikgcmV0dXJuIG5ldyBTay5idWlsdGluLmZsb2F0XygwKQogICAgICAgICAgdmFyIGMgPSBwYXJzZUZsb2F0KGEuc3RyJCgxMCwgITApKQogICAgICAgICAgYiA9IHRoaXMudiAlIGMKICAgICAgICAgIDAgPiBiID8gMCA8IGMgJiYgMCAhPT0gYiAmJiAoYiArPSBjKSA6IDAgPiBjICYmIDAgIT09IGIgJiYgKGIgKz0gYykKICAgICAgICAgIGEubmIkaXNuZWdhdGl2ZSgpICYmIDAgPT09IGIKICAgICAgICAgICAgPyAoYiA9IC0wKQogICAgICAgICAgICA6IDAgPT09IGIgJiYgLUluZmluaXR5ID09PSBJbmZpbml0eSAvIGIgJiYgKGIgPSAwKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmZsb2F0XyhiKQogICAgICAgIH0KICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX3JlbWFpbmRlciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nKQogICAgICAgICAgYSA9IG5ldyBTay5idWlsdGluLmZsb2F0XyhhKQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gYS5uYiRyZW1haW5kZXIodGhpcykKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkZGl2bW9kID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fCBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcpCiAgICAgICAgICBhID0gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGEpCiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi50dXBsZShbCiAgICAgICAgICAgICAgdGhpcy5uYiRmbG9vcl9kaXZpZGUoYSksCiAgICAgICAgICAgICAgdGhpcy5uYiRyZW1haW5kZXIoYSksCiAgICAgICAgICAgIF0pCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9kaXZtb2QgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykKICAgICAgICAgIGEgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8oYSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLnR1cGxlKFsKICAgICAgICAgICAgICBhLm5iJGZsb29yX2RpdmlkZSh0aGlzKSwKICAgICAgICAgICAgICBhLm5iJHJlbWFpbmRlcih0aGlzKSwKICAgICAgICAgICAgXSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkcG93ZXIgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykgewogICAgICAgICAgaWYgKDAgPiB0aGlzLnYgJiYgMCAhPT0gYS52ICUgMSkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTmVnYXRpdmVQb3dlckVycm9yKAogICAgICAgICAgICAgICJjYW5ub3QgcmFpc2UgYSBuZWdhdGl2ZSBudW1iZXIgdG8gYSBmcmFjdGlvbmFsIHBvd2VyIiwKICAgICAgICAgICAgKQogICAgICAgICAgaWYgKDAgPT09IHRoaXMudiAmJiAwID4gYS52KQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5OZWdhdGl2ZVBvd2VyRXJyb3IoCiAgICAgICAgICAgICAgImNhbm5vdCByYWlzZSB6ZXJvIHRvIGEgbmVnYXRpdmUgcG93ZXIiLAogICAgICAgICAgICApCiAgICAgICAgICBiID0gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKE1hdGgucG93KHRoaXMudiwgYS52KSkKICAgICAgICAgIGlmICgKICAgICAgICAgICAgSW5maW5pdHkgPT09IE1hdGguYWJzKGIudikgJiYKICAgICAgICAgICAgSW5maW5pdHkgIT09IE1hdGguYWJzKHRoaXMudikgJiYKICAgICAgICAgICAgSW5maW5pdHkgIT09IE1hdGguYWJzKGEudikKICAgICAgICAgICkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uT3ZlcmZsb3dFcnJvcigiTnVtZXJpY2FsIHJlc3VsdCBvdXQgb2YgcmFuZ2UiKQogICAgICAgICAgcmV0dXJuIGIKICAgICAgICB9CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykgewogICAgICAgICAgaWYgKDAgPT09IHRoaXMudiAmJiAwID4gYS5sb25nQ29tcGFyZShTay5idWlsdGluLmJpZ2ludGVnZXIuWkVSTykpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5lZ2F0aXZlUG93ZXJFcnJvcigKICAgICAgICAgICAgICAiY2Fubm90IHJhaXNlIHplcm8gdG8gYSBuZWdhdGl2ZSBwb3dlciIsCiAgICAgICAgICAgICkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5mbG9hdF8oCiAgICAgICAgICAgIE1hdGgucG93KHRoaXMudiwgcGFyc2VGbG9hdChhLnN0ciQoMTAsICEwKSkpLAogICAgICAgICAgKQogICAgICAgIH0KICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX3Bvd2VyID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fCBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcpCiAgICAgICAgICBhID0gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGEpCiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyBhLm5iJHBvd2VyKHRoaXMsIGIpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJGFicyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKE1hdGguYWJzKHRoaXMudikpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJGlucGxhY2VfYWRkID0KICAgICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkYWRkCiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRpbnBsYWNlX3N1YnRyYWN0ID0KICAgICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkc3VidHJhY3QKICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJGlucGxhY2VfbXVsdGlwbHkgPQogICAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRtdWx0aXBseQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkaW5wbGFjZV9kaXZpZGUgPQogICAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRkaXZpZGUKICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJGlucGxhY2VfcmVtYWluZGVyID0KICAgICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkcmVtYWluZGVyCiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRpbnBsYWNlX2Zsb29yX2RpdmlkZSA9CiAgICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJGZsb29yX2RpdmlkZQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkaW5wbGFjZV9wb3dlciA9CiAgICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJHBvd2VyCiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5uYiRuZWdhdGl2ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKC10aGlzLnYpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJHBvc2l0aXZlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLmNsb25lKCkKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkbm9uemVybyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gMCAhPT0gdGhpcy52CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm5iJGlzbmVnYXRpdmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIDAgPiB0aGlzLnYKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubmIkaXNwb3NpdGl2ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gMCA8PSB0aGlzLnYKICAgICAgfQogICAgICBTay5idWlsdGluLmZsb2F0Xy5wcm90b3R5cGUubnVtYmVyQ29tcGFyZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfKQogICAgICAgICAgcmV0dXJuIChJbmZpbml0eSA9PSB0aGlzLnYgJiYgSW5maW5pdHkgPT0gYS52KSB8fAogICAgICAgICAgICAoLUluZmluaXR5ID09IHRoaXMudiAmJiAtSW5maW5pdHkgPT0gYS52KQogICAgICAgICAgICA/IDAKICAgICAgICAgICAgOiB0aGlzLnYgLSBhLnYKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nKSB7CiAgICAgICAgICBpZiAoMCA9PT0gdGhpcy52ICUgMSkgewogICAgICAgICAgICB2YXIgYiA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLnYpCiAgICAgICAgICAgIHJldHVybiAoYSA9IGIubG9uZ0NvbXBhcmUoYSkpCiAgICAgICAgICB9CiAgICAgICAgICBhID0gdGhpcy5uYiRzdWJ0cmFjdChhKQogICAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykgcmV0dXJuIGEudgogICAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykKICAgICAgICAgICAgcmV0dXJuIGEubG9uZ0NvbXBhcmUoU2suYnVpbHRpbi5iaWdpbnRlZ2VyLlpFUk8pCiAgICAgICAgfQogICAgICAgIHJldHVybiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5vYiRlcSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmJvb2woMCA9PSB0aGlzLm51bWJlckNvbXBhcmUoYSkpCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLm5vbmUKICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5vYiRuZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmJvb2woMCAhPSB0aGlzLm51bWJlckNvbXBhcmUoYSkpCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLm5vbmUKICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLnRydWUkCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm9iJGx0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uYm9vbCgwID4gdGhpcy5udW1iZXJDb21wYXJlKGEpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5vYiRsZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmJvb2woMCA+PSB0aGlzLm51bWJlckNvbXBhcmUoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLm9iJGd0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uYm9vbCgwIDwgdGhpcy5udW1iZXJDb21wYXJlKGEpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5vYiRnZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmJvb2woMCA8PSB0aGlzLm51bWJlckNvbXBhcmUoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLnJvdW5kJCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19yb3VuZF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMikKICAgICAgICBpZiAodm9pZCAwICE9PSBiICYmICFTay5taXNjZXZhbC5pc0luZGV4KGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiJyIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGIpICsKICAgICAgICAgICAgICAiJyBvYmplY3QgY2Fubm90IGJlIGludGVycHJldGVkIGFzIGFuIGluZGV4IiwKICAgICAgICAgICkKICAgICAgICB2YXIgYyA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgdmFyIGQgPSB2b2lkIDAgPT09IGIgPyAwIDogU2subWlzY2V2YWwuYXNJbmRleChiKQogICAgICAgIGlmIChTay5fX2Z1dHVyZV9fLmJhbmtlcnNfcm91bmRpbmcpIHsKICAgICAgICAgIGMgKj0gTWF0aC5wb3coMTAsIGQpCiAgICAgICAgICB2YXIgZSA9IE1hdGgucm91bmQoYykKICAgICAgICAgIGQgPQogICAgICAgICAgICAoMC41ID09PSAoMCA8IGMgPyBjIDogLWMpICUgMSA/ICgwID09PSBlICUgMiA/IGUgOiBlIC0gMSkgOiBlKSAvCiAgICAgICAgICAgIE1hdGgucG93KDEwLCBkKQogICAgICAgICAgcmV0dXJuIHZvaWQgMCA9PT0gYgogICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmludF8oZCkKICAgICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5mbG9hdF8oZCkKICAgICAgICB9CiAgICAgICAgZCA9IE1hdGgucG93KDEwLCBkKQogICAgICAgIGQgPSBNYXRoLnJvdW5kKGMgKiBkKSAvIGQKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGQpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLl9fZm9ybWF0X18gPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fZm9ybWF0X18iLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrU3RyaW5nKGIpKSB7CiAgICAgICAgICB2YXIgYyA9IFNrLmZmaS5yZW1hcFRvSnMoYikKICAgICAgICAgIGlmICgiIiAhPT0gYykKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgICAiZm9ybWF0IHNwZWMgaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgICAgICkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKFNrLl9fZnV0dXJlX18uZXhjZXB0aW9ucykKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICJmb3JtYXQoKSBhcmd1bWVudCAyIG11c3QgYmUgc3RyLCBub3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGIpLAogICAgICAgICAgICApCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJmb3JtYXQgZXhwZWN0cyBhcmcgMiB0byBiZSBzdHJpbmcgb3IgdW5pY29kZSwgbm90ICIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGIpLAogICAgICAgICAgKQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLmNvbmp1Z2F0ZSA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGEudikKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLiRyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIodGhpcy5zdHIkKDEwLCAhMCkpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5mbG9hdF8ucHJvdG90eXBlLnRwJHN0ciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKHRoaXMuc3RyJCgxMCwgITApKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmxvYXRfLnByb3RvdHlwZS5zdHIkID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBpZiAoaXNOYU4odGhpcy52KSkgcmV0dXJuICJuYW4iCiAgICAgICAgdm9pZCAwID09PSBiICYmIChiID0gITApCiAgICAgICAgaWYgKEluZmluaXR5ID09IHRoaXMudikgcmV0dXJuICJpbmYiCiAgICAgICAgaWYgKC1JbmZpbml0eSA9PSB0aGlzLnYgJiYgYikgcmV0dXJuICItaW5mIgogICAgICAgIGlmICgtSW5maW5pdHkgPT0gdGhpcy52ICYmICFiKSByZXR1cm4gImluZiIKICAgICAgICBiID0gYiA/IHRoaXMudiA6IE1hdGguYWJzKHRoaXMudikKICAgICAgICBpZiAodm9pZCAwID09PSBhIHx8IDEwID09PSBhKSB7CiAgICAgICAgICB2YXIgYyA9IFNrLl9fZnV0dXJlX18ucHl0aG9uMyA/IGIudG9QcmVjaXNpb24oMTYpIDogYi50b1ByZWNpc2lvbigxMikKICAgICAgICAgIHZhciBkID0gYy5pbmRleE9mKCIuIikKICAgICAgICAgIGEgPSBiLnRvU3RyaW5nKCkuc2xpY2UoMCwgZCkKICAgICAgICAgIGQgPSBiLnRvU3RyaW5nKCkuc2xpY2UoZCkKICAgICAgICAgIGEubWF0Y2goL14tPzAkLykgJiYKICAgICAgICAgICAgZC5zbGljZSgxKS5tYXRjaCgvXjB7NCx9LykgJiYKICAgICAgICAgICAgKGMgPSAxMiA+IGMubGVuZ3RoID8gYi50b0V4cG9uZW50aWFsKCkgOiBiLnRvRXhwb25lbnRpYWwoMTEpKQogICAgICAgICAgaWYgKDAgPiBjLmluZGV4T2YoImUiKSAmJiAwIDw9IGMuaW5kZXhPZigiLiIpKSB7CiAgICAgICAgICAgIGZvciAoOyAiMCIgPT0gYy5jaGFyQXQoYy5sZW5ndGggLSAxKTsgKQogICAgICAgICAgICAgIGMgPSBjLnN1YnN0cmluZygwLCBjLmxlbmd0aCAtIDEpCiAgICAgICAgICAgICIuIiA9PSBjLmNoYXJBdChjLmxlbmd0aCAtIDEpICYmIChjICs9ICIwIikKICAgICAgICAgIH0KICAgICAgICAgIGMgPSBjLnJlcGxhY2UoL1wuMCtlLywgImUiLCAiaSIpCiAgICAgICAgICBjID0gYy5yZXBsYWNlKC8oZVstK10pKFsxLTldKSQvLCAiJDEwJDIiKQogICAgICAgICAgYyA9IGMucmVwbGFjZSgvMCsoZS4qKS8sICIkMSIpCiAgICAgICAgfSBlbHNlIGMgPSBiLnRvU3RyaW5nKGEpCiAgICAgICAgMCA9PT0gdGhpcy52ICYmIC1JbmZpbml0eSA9PT0gMSAvIHRoaXMudiAmJiAoYyA9ICItIiArIGMpCiAgICAgICAgMCA+IGMuaW5kZXhPZigiLiIpICYmCiAgICAgICAgICAwID4gYy5pbmRleE9mKCJFIikgJiYKICAgICAgICAgIDAgPiBjLmluZGV4T2YoImUiKSAmJgogICAgICAgICAgKGMgKz0gIi4wIikKICAgICAgICByZXR1cm4gYwogICAgICB9CiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHApIHsKICAgICAgdmFyIGEgPSBuZXcgU2suYnVpbHRpbi5FeHRlcm5hbEVycm9yKCJTay5idWlsdGluLm5tYmVyIGlzIGRlcHJlY2F0ZWQuIikKICAgICAgU2suYnVpbHRpbi5ubWJlciA9IGZ1bmN0aW9uIChhLCBjKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uRXh0ZXJuYWxFcnJvcigKICAgICAgICAgICJTay5idWlsdGluLm5tYmVyIGlzIGRlcHJlY2F0ZWQuIFBsZWFzZSByZXBsYWNlIHdpdGggU2suYnVpbHRpbi5pbnRfLCBTay5idWlsdGluLmZsb2F0Xywgb3IgU2suYnVpbHRpbi5hc3NrJC4iLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS50cCRpbmRleCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy52CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUudHAkaGFzaCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5mcm9tSW50JCA9IGZ1bmN0aW9uIChiKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS50b0ZpeGVkID0gZnVuY3Rpb24gKGIpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkYWRkID0gZnVuY3Rpb24gKGIpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkc3VidHJhY3QgPSBmdW5jdGlvbiAoYikgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRtdWx0aXBseSA9IGZ1bmN0aW9uIChiKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJGRpdmlkZSA9IGZ1bmN0aW9uIChiKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJGZsb29yX2RpdmlkZSA9IGZ1bmN0aW9uIChiKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJHJlbWFpbmRlciA9IGZ1bmN0aW9uIChiKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJGRpdm1vZCA9IGZ1bmN0aW9uIChiKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJHBvd2VyID0gZnVuY3Rpb24gKGIpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkYW5kID0gZnVuY3Rpb24gKGIpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkb3IgPSBmdW5jdGlvbiAoYikgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiR4b3IgPSBmdW5jdGlvbiAoYikgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRsc2hpZnQgPSBmdW5jdGlvbiAoYikgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRyc2hpZnQgPSBmdW5jdGlvbiAoYikgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRpbnBsYWNlX2FkZCA9CiAgICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkYWRkCiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJGlucGxhY2Vfc3VidHJhY3QgPQogICAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJHN1YnRyYWN0CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJGlucGxhY2VfbXVsdGlwbHkgPQogICAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJG11bHRpcGx5CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJGlucGxhY2VfZGl2aWRlID0KICAgICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRkaXZpZGUKICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkaW5wbGFjZV9yZW1haW5kZXIgPQogICAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJHJlbWFpbmRlcgogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRpbnBsYWNlX2Zsb29yX2RpdmlkZSA9CiAgICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkZmxvb3JfZGl2aWRlCiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJGlucGxhY2VfcG93ZXIgPQogICAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJHBvd2VyCiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJGlucGxhY2VfYW5kID0KICAgICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRhbmQKICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkaW5wbGFjZV9vciA9CiAgICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkb3IKICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkaW5wbGFjZV94b3IgPQogICAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJHhvcgogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRpbnBsYWNlX2xzaGlmdCA9CiAgICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkbHNoaWZ0CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJGlucGxhY2VfcnNoaWZ0ID0KICAgICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRyc2hpZnQKICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUubmIkbmVnYXRpdmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLm5iJHBvc2l0aXZlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRub256ZXJvID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRpc25lZ2F0aXZlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5uYiRpc3Bvc2l0aXZlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRocm93IGEKICAgICAgfQogICAgICBTay5idWlsdGluLm5tYmVyLnByb3RvdHlwZS5udW1iZXJDb21wYXJlID0gZnVuY3Rpb24gKGIpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUuX19lcV9fID0gZnVuY3Rpb24gKGIsIGMpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUuX19uZV9fID0gZnVuY3Rpb24gKGIsIGMpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUuX19sdF9fID0gZnVuY3Rpb24gKGIsIGMpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUuX19sZV9fID0gZnVuY3Rpb24gKGIsIGMpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUuX19ndF9fID0gZnVuY3Rpb24gKGIsIGMpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUuX19nZV9fID0gZnVuY3Rpb24gKGIsIGMpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUucm91bmQkID0gZnVuY3Rpb24gKGIsIGMpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubm1iZXIucHJvdG90eXBlLnRwJHN0ciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aHJvdyBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5ubWJlci5wcm90b3R5cGUuc3RyJCA9IGZ1bmN0aW9uIChiLCBjKSB7CiAgICAgICAgdGhyb3cgYQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5ubWJlciIsIFNrLmJ1aWx0aW4ubm1iZXIpCiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHApIHsKICAgICAgU2suYnVpbHRpbi5sbmcgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGIgPSBTay5idWlsdGluLmFzbnVtJChiKQogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykpIHJldHVybiBuZXcgU2suYnVpbHRpbi5sbmcoYSwgYikKICAgICAgICBpZiAodm9pZCAwID09PSBhKQogICAgICAgICAgcmV0dXJuICh0aGlzLmJpZ2ludGVnZXIgPSBuZXcgU2suYnVpbHRpbi5iaWdpbnRlZ2VyKDApKSwgdGhpcwogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcpCiAgICAgICAgICByZXR1cm4gKHRoaXMuYmlnaW50ZWdlciA9IGEuYmlnaW50ZWdlci5jbG9uZSgpKSwgdGhpcwogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5iaWdpbnRlZ2VyKQogICAgICAgICAgcmV0dXJuICh0aGlzLmJpZ2ludGVnZXIgPSBhKSwgdGhpcwogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU3RyaW5nIHx8ICJzdHJpbmciID09PSB0eXBlb2YgYSkKICAgICAgICAgIHJldHVybiBTay5sb25nRnJvbVN0cihhLCBiKQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zdHIpIHJldHVybiBTay5sb25nRnJvbVN0cihhLnYsIGIpCiAgICAgICAgaWYgKAogICAgICAgICAgdm9pZCAwICE9PSBhICYmCiAgICAgICAgICAhU2suYnVpbHRpbi5jaGVja1N0cmluZyhhKSAmJgogICAgICAgICAgIVNrLmJ1aWx0aW4uY2hlY2tOdW1iZXIoYSkKICAgICAgICApCiAgICAgICAgICBpZiAoITAgPT09IGEpIGEgPSAxCiAgICAgICAgICBlbHNlIGlmICghMSA9PT0gYSkgYSA9IDAKICAgICAgICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICJsb25nKCkgYXJndW1lbnQgbXVzdCBiZSBhIHN0cmluZyBvciBhIG51bWJlciwgbm90ICciICsKICAgICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGEpICsKICAgICAgICAgICAgICAgICInIiwKICAgICAgICAgICAgKQogICAgICAgIGEgPSBTay5idWlsdGluLmFzbnVtJG5vZmxvYXQoYSkKICAgICAgICB0aGlzLmJpZ2ludGVnZXIgPSBuZXcgU2suYnVpbHRpbi5iaWdpbnRlZ2VyKGEpCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKCJsb25nIiwgU2suYnVpbHRpbi5sbmcsIFNrLmJ1aWx0aW4ubnVtdHlwZSkKICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLnRwJGluZGV4ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBwYXJzZUludCh0aGlzLnN0ciQoMTAsICEwKSwgMTApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLnRwJGhhc2ggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8odGhpcy50cCRpbmRleCgpKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRpbnRfID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLmNhbnRCZUludCgpCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmxuZyh0aGlzKQogICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5pbnRfKHRoaXMudG9JbnQkKCkpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLl9fZm9ybWF0X18gPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fZm9ybWF0X18iLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrU3RyaW5nKGIpKSB7CiAgICAgICAgICB2YXIgYyA9IFNrLmZmaS5yZW1hcFRvSnMoYikKICAgICAgICAgIGlmICgiIiAhPT0gYykKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWRFcnJvcigKICAgICAgICAgICAgICAiZm9ybWF0IHNwZWMgaXMgbm90IHlldCBpbXBsZW1lbnRlZCIsCiAgICAgICAgICAgICkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKFNrLl9fZnV0dXJlX18uZXhjZXB0aW9ucykKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICJmb3JtYXQoKSBhcmd1bWVudCAyIG11c3QgYmUgc3RyLCBub3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGIpLAogICAgICAgICAgICApCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJmb3JtYXQgZXhwZWN0cyBhcmcgMiB0byBiZSBzdHJpbmcgb3IgdW5pY29kZSwgbm90ICIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGIpLAogICAgICAgICAgKQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLnJvdW5kJCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19yb3VuZF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMikKICAgICAgICBpZiAodm9pZCAwICE9PSBiICYmICFTay5taXNjZXZhbC5pc0luZGV4KGIpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiJyIgKwogICAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGIpICsKICAgICAgICAgICAgICAiJyBvYmplY3QgY2Fubm90IGJlIGludGVycHJldGVkIGFzIGFuIGluZGV4IiwKICAgICAgICAgICkKICAgICAgICB2YXIgYyA9IFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgdmFyIGQgPSB2b2lkIDAgPT09IGIgPyAwIDogU2subWlzY2V2YWwuYXNJbmRleChiKQogICAgICAgIGlmIChTay5fX2Z1dHVyZV9fLmJhbmtlcnNfcm91bmRpbmcpIHsKICAgICAgICAgIGMgKj0gTWF0aC5wb3coMTAsIGQpCiAgICAgICAgICB2YXIgZSA9IE1hdGgucm91bmQoYykKICAgICAgICAgIGQgPQogICAgICAgICAgICAoMC41ID09PSAoMCA8IGMgPyBjIDogLWMpICUgMSA/ICgwID09PSBlICUgMiA/IGUgOiBlIC0gMSkgOiBlKSAvCiAgICAgICAgICAgIE1hdGgucG93KDEwLCBkKQogICAgICAgIH0gZWxzZSAoZCA9IE1hdGgucG93KDEwLCBkKSksIChkID0gTWF0aC5yb3VuZChjICogZCkgLyBkKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5sbmcoZCkKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUuX19pbmRleF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBhLm5iJGludF8oYSkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGxuZ18gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkZmxvYXRfID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5mbG9hdF8oU2suZmZpLnJlbWFwVG9Kcyh0aGlzKSkKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5NQVhfSU5UJCA9IG5ldyBTay5idWlsdGluLmxuZyhTay5idWlsdGluLmludF8udGhyZXNob2xkJCkKICAgICAgU2suYnVpbHRpbi5sbmcuTUlOX0lOVCQgPSBuZXcgU2suYnVpbHRpbi5sbmcoLVNrLmJ1aWx0aW4uaW50Xy50aHJlc2hvbGQkKQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUuY2FudEJlSW50ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAoCiAgICAgICAgICAwIDwgdGhpcy5sb25nQ29tcGFyZShTay5idWlsdGluLmxuZy5NQVhfSU5UJCkgfHwKICAgICAgICAgIDAgPiB0aGlzLmxvbmdDb21wYXJlKFNrLmJ1aWx0aW4ubG5nLk1JTl9JTlQkKQogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5mcm9tSW50JCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxuZyhhKQogICAgICB9CiAgICAgIFNrLmxvbmdGcm9tU3RyID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBhID0gU2suc3RyMm51bWJlcigKICAgICAgICAgIGEsCiAgICAgICAgICBiLAogICAgICAgICAgZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgcmV0dXJuIDEwID09PSBiCiAgICAgICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5iaWdpbnRlZ2VyKGEpCiAgICAgICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5iaWdpbnRlZ2VyKGEsIGIpCiAgICAgICAgICB9LAogICAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgcmV0dXJuIGEubmVnYXRlKCkKICAgICAgICAgIH0sCiAgICAgICAgICAibG9uZyIsCiAgICAgICAgKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5sbmcoYSkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmxvbmdGcm9tU3RyIiwgU2subG9uZ0Zyb21TdHIpCiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS50b0ludCQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYmlnaW50ZWdlci5pbnRWYWx1ZSgpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5sbmcodGhpcykKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUuY29uanVnYXRlID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBhLmNsb25lKCkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGFkZCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykgewogICAgICAgICAgdmFyIGIgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy5zdHIkKDEwLCAhMCkpCiAgICAgICAgICByZXR1cm4gYi5uYiRhZGQoYSkKICAgICAgICB9CiAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyAmJiAoYSA9IG5ldyBTay5idWlsdGluLmxuZyhhLnYpKQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMuYmlnaW50ZWdlci5hZGQoYS5iaWdpbnRlZ2VyKSkKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYmlnaW50ZWdlcgogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy5iaWdpbnRlZ2VyLmFkZChhKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX2FkZCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRhZGQuY2FsbCh0aGlzLCBhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRpbnBsYWNlX2FkZCA9IFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRhZGQKICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHN1YnRyYWN0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfKSB7CiAgICAgICAgICB2YXIgYiA9IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzLnN0ciQoMTAsICEwKSkKICAgICAgICAgIHJldHVybiBiLm5iJHN1YnRyYWN0KGEpCiAgICAgICAgfQogICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYgKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoYS52KSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLmJpZ2ludGVnZXIuc3VidHJhY3QoYS5iaWdpbnRlZ2VyKSkKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYmlnaW50ZWdlcgogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy5iaWdpbnRlZ2VyLnN1YnRyYWN0KGEpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfc3VidHJhY3QgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0gdGhpcy5uYiRuZWdhdGl2ZSgpCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRhZGQuY2FsbChiLCBhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRpbnBsYWNlX3N1YnRyYWN0ID0KICAgICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkc3VidHJhY3QKICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJG11bHRpcGx5ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfKSB7CiAgICAgICAgICB2YXIgYiA9IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzLnN0ciQoMTAsICEwKSkKICAgICAgICAgIHJldHVybiBiLm5iJG11bHRpcGx5KGEpCiAgICAgICAgfQogICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYgKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoYS52KSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLmJpZ2ludGVnZXIubXVsdGlwbHkoYS5iaWdpbnRlZ2VyKSkKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYmlnaW50ZWdlcgogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy5iaWdpbnRlZ2VyLm11bHRpcGx5KGEpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfbXVsdGlwbHkgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkbXVsdGlwbHkuY2FsbCh0aGlzLCBhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRpbnBsYWNlX211bHRpcGx5ID0KICAgICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkbXVsdGlwbHkKICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGRpdmlkZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykgewogICAgICAgICAgdmFyIGIgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy5zdHIkKDEwLCAhMCkpCiAgICAgICAgICByZXR1cm4gYi5uYiRkaXZpZGUoYSkKICAgICAgICB9CiAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyAmJiAoYSA9IG5ldyBTay5idWlsdGluLmxuZyhhLnYpKQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcpIHsKICAgICAgICAgIGIgPSB0aGlzLm5iJGlzbmVnYXRpdmUoKQogICAgICAgICAgdmFyIGMgPSBhLm5iJGlzbmVnYXRpdmUoKQogICAgICAgICAgaWYgKChiICYmICFjKSB8fCAoYyAmJiAhYikpIHsKICAgICAgICAgICAgYSA9IHRoaXMuYmlnaW50ZWdlci5kaXZpZGVBbmRSZW1haW5kZXIoYS5iaWdpbnRlZ2VyKQogICAgICAgICAgICBpZiAoMCA9PT0gYVsxXS50cnVlQ29tcGFyZShTay5idWlsdGluLmJpZ2ludGVnZXIuWkVSTykpCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxuZyhhWzBdKQogICAgICAgICAgICBhID0gYVswXS5zdWJ0cmFjdChTay5idWlsdGluLmJpZ2ludGVnZXIuT05FKQogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubG5nKGEpCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMuYmlnaW50ZWdlci5kaXZpZGUoYS5iaWdpbnRlZ2VyKSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9kaXZpZGUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYgKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoYS52KSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/IGEubmIkZGl2aWRlKHRoaXMpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGZsb29yX2RpdmlkZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykgewogICAgICAgICAgdmFyIGIgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8odGhpcy5zdHIkKDEwLCAhMCkpCiAgICAgICAgICByZXR1cm4gYi5uYiRmbG9vcl9kaXZpZGUoYSkKICAgICAgICB9CiAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyAmJiAoYSA9IG5ldyBTay5idWlsdGluLmxuZyhhLnYpKQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gYS5uYiRkaXZpZGUodGhpcykKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkZGl2bW9kID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfICYmIChhID0gbmV3IFNrLmJ1aWx0aW4ubG5nKGEudikpCiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi50dXBsZShbCiAgICAgICAgICAgICAgdGhpcy5uYiRmbG9vcl9kaXZpZGUoYSksCiAgICAgICAgICAgICAgdGhpcy5uYiRyZW1haW5kZXIoYSksCiAgICAgICAgICAgIF0pCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9kaXZtb2QgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYgKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoYS52KSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLnR1cGxlKFsKICAgICAgICAgICAgICBhLm5iJGZsb29yX2RpdmlkZSh0aGlzKSwKICAgICAgICAgICAgICBhLm5iJHJlbWFpbmRlcih0aGlzKSwKICAgICAgICAgICAgXSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkaW5wbGFjZV9kaXZpZGUgPQogICAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRkaXZpZGUKICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGZsb29yX2RpdmlkZSA9CiAgICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGRpdmlkZQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX2Zsb29yX2RpdmlkZSA9CiAgICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9kaXZpZGUKICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGlucGxhY2VfZmxvb3JfZGl2aWRlID0KICAgICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkZmxvb3JfZGl2aWRlCiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRyZW1haW5kZXIgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICgwID09PSB0aGlzLmJpZ2ludGVnZXIudHJ1ZUNvbXBhcmUoU2suYnVpbHRpbi5iaWdpbnRlZ2VyLlpFUk8pKQogICAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmZsb2F0XygwKQogICAgICAgICAgICA6IG5ldyBTay5idWlsdGluLmxuZygwKQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8pIHsKICAgICAgICAgIHZhciBiID0gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKHRoaXMuc3RyJCgxMCwgITApKQogICAgICAgICAgcmV0dXJuIGIubmIkcmVtYWluZGVyKGEpCiAgICAgICAgfQogICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYgKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoYS52KSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/ICgoYiA9IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLmJpZ2ludGVnZXIucmVtYWluZGVyKGEuYmlnaW50ZWdlcikpKSwKICAgICAgICAgICAgdGhpcy5uYiRpc25lZ2F0aXZlKCkKICAgICAgICAgICAgICA/IGEubmIkaXNwb3NpdGl2ZSgpICYmCiAgICAgICAgICAgICAgICBiLm5iJG5vbnplcm8oKSAmJgogICAgICAgICAgICAgICAgKGIgPSBiLm5iJGFkZChhKS5uYiRyZW1haW5kZXIoYSkpCiAgICAgICAgICAgICAgOiBhLm5iJGlzbmVnYXRpdmUoKSAmJiBiLm5iJG5vbnplcm8oKSAmJiAoYiA9IGIubmIkYWRkKGEpKSwKICAgICAgICAgICAgYikKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX3JlbWFpbmRlciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyAmJiAoYSA9IG5ldyBTay5idWlsdGluLmxuZyhhLnYpKQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gYS5uYiRyZW1haW5kZXIodGhpcykKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkaW5wbGFjZV9yZW1haW5kZXIgPQogICAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRyZW1haW5kZXIKICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGRpdm1vZCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgYSA9PT0gU2suYnVpbHRpbi5ib29sLnRydWUkICYmIChhID0gbmV3IFNrLmJ1aWx0aW4ubG5nKDEpKQogICAgICAgIGEgPT09IFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQgJiYgKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoMCkpCiAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyAmJiAoYSA9IG5ldyBTay5idWlsdGluLmxuZyhhLnYpKQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4udHVwbGUoWwogICAgICAgICAgICB0aGlzLm5iJGZsb29yX2RpdmlkZShhKSwKICAgICAgICAgICAgdGhpcy5uYiRyZW1haW5kZXIoYSksCiAgICAgICAgICBdKQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8pIHsKICAgICAgICAgIHZhciBiID0gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKHRoaXMuc3RyJCgxMCwgITApKQogICAgICAgICAgcmV0dXJuIGIubmIkZGl2bW9kKGEpCiAgICAgICAgfQogICAgICAgIHJldHVybiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRwb3dlciA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgaWYgKHZvaWQgMCAhPT0gYikKICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIChhID0gbmV3IFNrLmJ1aWx0aW4uYmlnaW50ZWdlcihTay5idWlsdGluLmFzbnVtJChhKSkpLAogICAgICAgICAgICAoYiA9IG5ldyBTay5idWlsdGluLmJpZ2ludGVnZXIoU2suYnVpbHRpbi5hc251bSQoYikpKSwKICAgICAgICAgICAgbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMuYmlnaW50ZWdlci5tb2RQb3dJbnQoYSwgYikpCiAgICAgICAgICApCiAgICAgICAgaWYgKAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfIHx8CiAgICAgICAgICAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyAmJiAwID4gYS52KQogICAgICAgICkKICAgICAgICAgIHJldHVybiAoYiA9IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzLnN0ciQoMTAsICEwKSkpLCBiLm5iJHBvd2VyKGEpCiAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyAmJiAoYSA9IG5ldyBTay5idWlsdGluLmxuZyhhLnYpKQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gdm9pZCAwICE9PSBiCiAgICAgICAgICAgID8gKChhID0gbmV3IFNrLmJ1aWx0aW4uYmlnaW50ZWdlcihTay5idWlsdGluLmFzbnVtJChhKSkpLAogICAgICAgICAgICAgIChiID0gbmV3IFNrLmJ1aWx0aW4uYmlnaW50ZWdlcihTay5idWlsdGluLmFzbnVtJChiKSkpLAogICAgICAgICAgICAgIG5ldyBTay5idWlsdGluLmxuZyh0aGlzLmJpZ2ludGVnZXIubW9kUG93SW50KGEsIGIpKSkKICAgICAgICAgICAgOiBhLm5iJGlzbmVnYXRpdmUoKQogICAgICAgICAgICA/ICgoYiA9IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzLnN0ciQoMTAsICEwKSkpLCBiLm5iJHBvd2VyKGEpKQogICAgICAgICAgICA6IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLmJpZ2ludGVnZXIucG93KGEuYmlnaW50ZWdlcikpCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmJpZ2ludGVnZXIKICAgICAgICAgID8gdm9pZCAwICE9PSBiCiAgICAgICAgICAgID8gKChiID0gbmV3IFNrLmJ1aWx0aW4uYmlnaW50ZWdlcihTay5idWlsdGluLmFzbnVtJChiKSkpLAogICAgICAgICAgICAgIG5ldyBTay5idWlsdGluLmxuZyh0aGlzLmJpZ2ludGVnZXIubW9kUG93SW50KGEsIGIpKSkKICAgICAgICAgICAgOiBhLmlzbmVnYXRpdmUoKQogICAgICAgICAgICA/ICgoYiA9IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzLnN0ciQoMTAsICEwKSkpLCBiLm5iJHBvd2VyKGEpKQogICAgICAgICAgICA6IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLmJpZ2ludGVnZXIucG93KGEpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfcG93ZXIgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYgKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoYS52KSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/IGEubmIkcG93ZXIodGhpcywgYikKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkaW5wbGFjZV9wb3dlciA9CiAgICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHBvd2VyCiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRhYnMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxuZyh0aGlzLmJpZ2ludGVnZXIuYm5BYnMoKSkKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkbHNoaWZ0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfICYmIChhID0gbmV3IFNrLmJ1aWx0aW4ubG5nKGEudikpCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykgewogICAgICAgICAgaWYgKDAgPiBhLmJpZ2ludGVnZXIuc2lnbnVtKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoIm5lZ2F0aXZlIHNoaWZ0IGNvdW50IikKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy5iaWdpbnRlZ2VyLnNoaWZ0TGVmdChhLmJpZ2ludGVnZXIpKQogICAgICAgIH0KICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYmlnaW50ZWdlcikgewogICAgICAgICAgaWYgKDAgPiBhLnNpZ251bSgpKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJuZWdhdGl2ZSBzaGlmdCBjb3VudCIpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMuYmlnaW50ZWdlci5zaGlmdExlZnQoYSkpCiAgICAgICAgfQogICAgICAgIHJldHVybiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfbHNoaWZ0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfICYmIChhID0gbmV3IFNrLmJ1aWx0aW4ubG5nKGEudikpCiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZwogICAgICAgICAgPyBhLm5iJGxzaGlmdCh0aGlzKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRpbnBsYWNlX2xzaGlmdCA9CiAgICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGxzaGlmdAogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkcnNoaWZ0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfICYmIChhID0gbmV3IFNrLmJ1aWx0aW4ubG5nKGEudikpCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykgewogICAgICAgICAgaWYgKDAgPiBhLmJpZ2ludGVnZXIuc2lnbnVtKCkpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoIm5lZ2F0aXZlIHNoaWZ0IGNvdW50IikKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy5iaWdpbnRlZ2VyLnNoaWZ0UmlnaHQoYS5iaWdpbnRlZ2VyKSkKICAgICAgICB9CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmJpZ2ludGVnZXIpIHsKICAgICAgICAgIGlmICgwID4gYS5zaWdudW0oKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigibmVnYXRpdmUgc2hpZnQgY291bnQiKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmxuZyh0aGlzLmJpZ2ludGVnZXIuc2hpZnRSaWdodChhKSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9yc2hpZnQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYgKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoYS52KSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/IGEubmIkcnNoaWZ0KHRoaXMpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGlucGxhY2VfcnNoaWZ0ID0KICAgICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkcnNoaWZ0CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRhbmQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYgKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoYS52KSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLmJpZ2ludGVnZXIuYW5kKGEuYmlnaW50ZWdlcikpCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmJpZ2ludGVnZXIKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMuYmlnaW50ZWdlci5hbmQoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHJlZmxlY3RlZF9hbmQgPQogICAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRhbmQKICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGlucGxhY2VfYW5kID0gU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGFuZAogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkb3IgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gJiYgKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoYS52KSkKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmxuZyh0aGlzLmJpZ2ludGVnZXIub3IoYS5iaWdpbnRlZ2VyKSkKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYmlnaW50ZWdlcgogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy5iaWdpbnRlZ2VyLm9yKGEpKQogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRyZWZsZWN0ZWRfb3IgPSBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkb3IKICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJGlucGxhY2Vfb3IgPSBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkb3IKICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHhvciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyAmJiAoYSA9IG5ldyBTay5idWlsdGluLmxuZyhhLnYpKQogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMuYmlnaW50ZWdlci54b3IoYS5iaWdpbnRlZ2VyKSkKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYmlnaW50ZWdlcgogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy5iaWdpbnRlZ2VyLnhvcihhKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkcmVmbGVjdGVkX3hvciA9CiAgICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJHhvcgogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkaW5wbGFjZV94b3IgPSBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkeG9yCiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRuZWdhdGl2ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubG5nKHRoaXMuYmlnaW50ZWdlci5uZWdhdGUoKSkKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkaW52ZXJ0ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5sbmcodGhpcy5iaWdpbnRlZ2VyLm5vdCgpKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRwb3NpdGl2ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jbG9uZSgpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm5iJG5vbnplcm8gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIDAgIT09IHRoaXMuYmlnaW50ZWdlci50cnVlQ29tcGFyZShTay5idWlsdGluLmJpZ2ludGVnZXIuWkVSTykKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUubmIkaXNuZWdhdGl2ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy5iaWdpbnRlZ2VyLmlzbmVnYXRpdmUoKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5uYiRpc3Bvc2l0aXZlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAhdGhpcy5iaWdpbnRlZ2VyLmlzbmVnYXRpdmUoKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5sb25nQ29tcGFyZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgIm51bWJlciIgPT09IHR5cGVvZiBhICYmIChhID0gbmV3IFNrLmJ1aWx0aW4ubG5nKGEpKQogICAgICAgIGlmICgKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8gJiYgMCA9PT0gYS52ICUgMSkKICAgICAgICApCiAgICAgICAgICByZXR1cm4gKGEgPSBuZXcgU2suYnVpbHRpbi5sbmcoYS52KSksIHRoaXMubG9uZ0NvbXBhcmUoYSkKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfKSB7CiAgICAgICAgICB2YXIgYiA9IG5ldyBTay5idWlsdGluLmZsb2F0Xyh0aGlzKQogICAgICAgICAgcmV0dXJuIGIubnVtYmVyQ29tcGFyZShhKQogICAgICAgIH0KICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICA/IHRoaXMuYmlnaW50ZWdlci5zdWJ0cmFjdChhLmJpZ2ludGVnZXIpCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmJpZ2ludGVnZXIKICAgICAgICAgID8gdGhpcy5iaWdpbnRlZ2VyLnN1YnRyYWN0KGEpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm9iJGVxID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uYm9vbCgwID09IHRoaXMubG9uZ0NvbXBhcmUoYSkpCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLm5vbmUKICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5vYiRuZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmJvb2woMCAhPSB0aGlzLmxvbmdDb21wYXJlKGEpKQogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5ub25lCiAgICAgICAgICA/IFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICAgICAgOiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS5vYiRsdCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8gfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfCiAgICAgICAgICA/IG5ldyBTay5idWlsdGluLmJvb2woMCA+IHRoaXMubG9uZ0NvbXBhcmUoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm9iJGxlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uYm9vbCgwID49IHRoaXMubG9uZ0NvbXBhcmUoYSkpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5sbmcucHJvdG90eXBlLm9iJGd0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XyB8fAogICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8KICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uYm9vbCgwIDwgdGhpcy5sb25nQ29tcGFyZShhKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUub2IkZ2UgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcgfHwKICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XwogICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5ib29sKDAgPD0gdGhpcy5sb25nQ29tcGFyZShhKSkKICAgICAgICAgIDogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGEgPSBTay5fX2Z1dHVyZV9fLnB5dGhvbjMgPyAiIiA6ICJMIgogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIodGhpcy5zdHIkKDEwLCAhMCkgKyBhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubG5nLnByb3RvdHlwZS50cCRzdHIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cih0aGlzLnN0ciQoMTAsICEwKSkKICAgICAgfQogICAgICBTay5idWlsdGluLmxuZy5wcm90b3R5cGUuc3RyJCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdm9pZCAwID09PSBiICYmIChiID0gITApCiAgICAgICAgYiA9IGIgPyB0aGlzLmJpZ2ludGVnZXIgOiB0aGlzLmJpZ2ludGVnZXIuYWJzKCkKICAgICAgICByZXR1cm4gdm9pZCAwID09PSBhIHx8IDEwID09PSBhID8gYi50b1N0cmluZygpIDogYi50b1N0cmluZyhhKQogICAgICB9CiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHApIHsKICAgICAgTWF0aC5oeXBvdCA9CiAgICAgICAgTWF0aC5oeXBvdCB8fAogICAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGZvciAodmFyIGEgPSAwLCBiID0gYXJndW1lbnRzLmxlbmd0aCwgYyA9IDA7IGMgPCBiOyBjKyspIHsKICAgICAgICAgICAgaWYgKEluZmluaXR5ID09PSBhcmd1bWVudHNbY10gfHwgLUluZmluaXR5ID09PSBhcmd1bWVudHNbY10pCiAgICAgICAgICAgICAgcmV0dXJuIEluZmluaXR5CiAgICAgICAgICAgIGEgKz0gYXJndW1lbnRzW2NdICogYXJndW1lbnRzW2NdCiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KGEpCiAgICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXggPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImNvbXBsZXgiLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAyKQogICAgICAgIHZhciBjLAogICAgICAgICAgZCA9ICExLAogICAgICAgICAgZSA9ICExCiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uY29tcGxleCkpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uY29tcGxleChhLCBiKQogICAgICAgIHZhciBmID0gbnVsbCA9PSBhID8gU2suYnVpbHRpbi5ib29sLmZhbHNlJCA6IGEKICAgICAgICBpZiAoZiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uY29tcGxleCAmJiBudWxsID09IGIpIHJldHVybiBhCiAgICAgICAgaWYgKG51bGwgIT0gZiAmJiBTay5idWlsdGluLmNoZWNrU3RyaW5nKGYpKSB7CiAgICAgICAgICBpZiAobnVsbCAhPSBiKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgImNvbXBsZXgoKSBjYW4ndCB0YWtlIHNlY29uZCBhcmcgaWYgZmlyc3QgaXMgYSBzdHJpbmciLAogICAgICAgICAgICApCiAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5jb21wbGV4LmNvbXBsZXhfc3VidHlwZV9mcm9tX3N0cmluZyhmKQogICAgICAgIH0KICAgICAgICBpZiAobnVsbCAhPSBiICYmIFNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJjb21wbGV4KCkgc2Vjb25kIGFyZyBjYW4ndCBiZSBhIHN0cmluZyIsCiAgICAgICAgICApCiAgICAgICAgdmFyIGcgPSBTay5idWlsdGluLmNvbXBsZXgudHJ5X2NvbXBsZXhfc3BlY2lhbF9tZXRob2QoZikKICAgICAgICBpZiAobnVsbCAhPSBnICYmIGcgIT09IFNrLmJ1aWx0aW4uTm90SW1wbGVtZW50ZWQuTm90SW1wbGVtZW50ZWQkKSB7CiAgICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tDb21wbGV4KGcpKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgIl9fY29tcGxleF9fIHNob3VsZCByZXR1cm4gYSBjb21wbGV4IG9iamVjdCIsCiAgICAgICAgICAgICkKICAgICAgICAgIGYgPSBnCiAgICAgICAgfQogICAgICAgIGcgPSBTay5idWlsdGluLmFzbnVtJChmKQogICAgICAgIG51bGwgIT0gYiAmJiAoYyA9IFNrLmJ1aWx0aW4uYXNudW0kKGIpKQogICAgICAgIHZhciBoID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgU2suYnVpbHRpbi5jaGVja051bWJlcihhKSB8fAogICAgICAgICAgICB2b2lkIDAgIT09CiAgICAgICAgICAgICAgU2suYnVpbHRpbi50eXBlLnR5cGVMb29rdXAoYS5vYiR0eXBlLCBTay5idWlsdGluLnN0ci4kZmxvYXRfKQogICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9CiAgICAgICAgaWYgKAogICAgICAgICAgbnVsbCA9PSBnIHx8CiAgICAgICAgICAoIWgoZikgJiYgIVNrLmJ1aWx0aW4uY2hlY2tDb21wbGV4KGYpKSB8fAogICAgICAgICAgKG51bGwgIT0gYiAmJiAobnVsbCA9PSBjIHx8ICghaChiKSAmJiAhU2suYnVpbHRpbi5jaGVja0NvbXBsZXgoYikpKSkKICAgICAgICApCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJjb21wbGV4KCkgYXJndW1lbnQgbXVzdCBiZSBhIHN0cmluZyBvciBudW1iZXIiLAogICAgICAgICAgKQogICAgICAgIGlmIChTay5idWlsdGluLmNvbXBsZXguX2NvbXBsZXhfY2hlY2soZikpCiAgICAgICAgICAoYyA9IGYucmVhbC52KSwgKGYgPSBmLmltYWcudiksIChkID0gITApCiAgICAgICAgZWxzZSB7CiAgICAgICAgICBnID0gU2suYnVpbHRpbi5mbG9hdF8uUHlGbG9hdF9Bc0RvdWJsZShmKQogICAgICAgICAgaWYgKG51bGwgPT0gZykgcmV0dXJuIG51bGwKICAgICAgICAgIGMgPSBnCiAgICAgICAgICBmID0gMAogICAgICAgIH0KICAgICAgICBpZiAobnVsbCA9PSBiKSBnID0gMAogICAgICAgIGVsc2UgaWYgKFNrLmJ1aWx0aW4uY29tcGxleC5fY29tcGxleF9jaGVjayhiKSkgewogICAgICAgICAgZyA9IGIucmVhbC52CiAgICAgICAgICB2YXIgayA9IGIuaW1hZy52CiAgICAgICAgICBlID0gITAKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZyA9IFNrLmJ1aWx0aW4uZmxvYXRfLlB5RmxvYXRfQXNEb3VibGUoYikKICAgICAgICAgIGlmIChudWxsID09IGcpIHJldHVybiBudWxsCiAgICAgICAgICBrID0gMAogICAgICAgIH0KICAgICAgICAhMCA9PT0gZSAmJiAoYyAtPSBrKQogICAgICAgICEwID09PSBkICYmIChnICs9IGYpCiAgICAgICAgMCA9PT0gYyAmJiAoMCA+IGcgfHwgU2suYnVpbHRpbi5jb21wbGV4Ll9pc05lZ2F0aXZlWmVybyhnKSkgJiYgKGMgPSAtMCkKICAgICAgICB0aGlzLnJlYWwgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8oYykKICAgICAgICB0aGlzLmltYWcgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8oZykKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgImNvbXBsZXgiLAogICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleCwKICAgICAgICBTay5idWlsdGluLm51bXR5cGUsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX2NsYXNzX18gPSBTay5idWlsdGluLmNvbXBsZXgKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5uYiRpbnRfID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiY2FuJ3QgY29udmVydCBjb21wbGV4IHRvIGludCIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5uYiRmbG9hdF8gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJjYW4ndCBjb252ZXJ0IGNvbXBsZXggdG8gZmxvYXQiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkbG5nID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiY2FuJ3QgY29udmVydCBjb21wbGV4IHRvIGxvbmciKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuX19kb2NfXyA9IG5ldyBTay5idWlsdGluLnN0cigKICAgICAgICAiY29tcGxleChyZWFsWywgaW1hZ10pIC0+IGNvbXBsZXggbnVtYmVyXG5cbkNyZWF0ZSBhIGNvbXBsZXggbnVtYmVyIGZyb20gYSByZWFsIHBhcnQgYW5kIGFuIG9wdGlvbmFsIGltYWdpbmFyeSBwYXJ0LlxuVGhpcyBpcyBlcXVpdmFsZW50IHRvIChyZWFsICsgaW1hZyoxaikgd2hlcmUgaW1hZyBkZWZhdWx0cyB0byAwLiIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4Ll9pc05lZ2F0aXZlWmVybyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIDAgIT09IGEgPyAhMSA6IC1JbmZpbml0eSA9PT0gMSAvIGEKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgudHJ5X2NvbXBsZXhfc3BlY2lhbF9tZXRob2QgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmIChudWxsID09IGEpIHJldHVybiBudWxsCiAgICAgICAgdmFyIGIgPSBTay5hYnN0ci5sb29rdXBTcGVjaWFsKGEsIFNrLmJ1aWx0aW4uc3RyLiRjb21wbGV4KQogICAgICAgIHJldHVybiBudWxsICE9IGIgPyAoYSA9IFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShiLCBbYV0pKSA6IG51bGwKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXguY2hlY2tfbnVtYmVyX29yX2NvbXBsZXggPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja051bWJlcihhKSAmJiAiY29tcGxleCIgIT09IGEudHAkbmFtZSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgInVuc3VwcG9ydGVkIG9wZXJhbmQgdHlwZShzKSBmb3IgKzogJ2NvbXBsZXgnIGFuZCAnIiArCiAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYSkgKwogICAgICAgICAgICAgICInIiwKICAgICAgICAgICkKICAgICAgICBTay5idWlsdGluLmNoZWNrTnVtYmVyKGEpICYmIChhID0gbmV3IFNrLmJ1aWx0aW4uY29tcGxleChhKSkKICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5jb21wbGV4X3N1YnR5cGVfZnJvbV9zdHJpbmcgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0gMCwKICAgICAgICAgIGMgPSAwLAogICAgICAgICAgZCA9ICExCiAgICAgICAgaWYgKFNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYSkpIGEgPSBTay5mZmkucmVtYXBUb0pzKGEpCiAgICAgICAgZWxzZSBpZiAoInN0cmluZyIgIT09IHR5cGVvZiBhKQogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigicHJvdmlkZWQgdW5zdXBwb3J0ZWQgc3RyaW5nLWFsaWtlIGFyZ3VtZW50IikKICAgICAgICBpZiAoLTEgIT09IGEuaW5kZXhPZigiXHgwMCIpIHx8IDAgPT09IGEubGVuZ3RoIHx8ICIiID09PSBhKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigiY29tcGxleCgpIGFyZyBpcyBhIG1hbGZvcm1lZCBzdHJpbmciKQogICAgICAgIHZhciBlID0gMAogICAgICAgIGEgPSBhLnJlcGxhY2UoL2luZnxpbmZpbml0eS9naSwgIkluZmluaXR5IikKICAgICAgICBmb3IgKGEgPSBhLnJlcGxhY2UoL25hbi9naSwgIk5hTiIpOyAiICIgPT09IGFbZV07ICkgZSsrCiAgICAgICAgaWYgKCIoIiA9PT0gYVtlXSkgZm9yIChkID0gITAsIGUrKzsgIiAiID09PSBhW2VdOyApIGUrKwogICAgICAgIHZhciBmID0gL14oPzpbKy1dPyg/Oig/Oig/OlxkKlwuXGQrKXwoPzpcZCtcLj8pKSg/OltlRV1bKy1dP1xkKyk/fE5hTnxJbmZpbml0eSkpLwogICAgICAgIHZhciBnID0gYS5zdWJzdHIoZSkKICAgICAgICB2YXIgaCA9IGcubWF0Y2goZikKICAgICAgICBpZiAobnVsbCAhPT0gaCkKICAgICAgICAgIGlmICgoKGUgKz0gaFswXS5sZW5ndGgpLCAiaiIgPT09IGFbZV0gfHwgIkoiID09PSBhW2VdKSkKICAgICAgICAgICAgKGMgPSBwYXJzZUZsb2F0KGhbMF0pKSwgZSsrCiAgICAgICAgICBlbHNlIGlmICgiKyIgPT09IGFbZV0gfHwgIi0iID09PSBhW2VdKSB7CiAgICAgICAgICAgIGIgPSBwYXJzZUZsb2F0KGhbMF0pCiAgICAgICAgICAgIGggPSBhLnN1YnN0cihlKS5tYXRjaChmKQogICAgICAgICAgICBudWxsICE9PSBoCiAgICAgICAgICAgICAgPyAoKGMgPSBwYXJzZUZsb2F0KGhbMF0pKSwgKGUgKz0gaFswXS5sZW5ndGgpKQogICAgICAgICAgICAgIDogKChjID0gIisiID09PSBhW2VdID8gMSA6IC0xKSwgZSsrKQogICAgICAgICAgICBpZiAoImoiICE9PSBhW2VdICYmICJKIiAhPT0gYVtlXSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKAogICAgICAgICAgICAgICAgImNvbXBsZXgoKSBhcmcgaXMgbWFsZm9ybWVkIHN0cmluZyIsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBlKysKICAgICAgICAgIH0gZWxzZSBiID0gcGFyc2VGbG9hdChoWzBdKQogICAgICAgIGVsc2UKICAgICAgICAgIChoID0gaCA9IGcubWF0Y2goL14oWystXT9bakpdKS8pKSwKICAgICAgICAgICAgbnVsbCAhPT0gaCAmJgogICAgICAgICAgICAgICgoYyA9IDEgPT09IGhbMF0ubGVuZ3RoID8gMSA6ICIrIiA9PT0gaFswXVswXSA/IDEgOiAtMSksCiAgICAgICAgICAgICAgKGUgKz0gaFswXS5sZW5ndGgpKQogICAgICAgIGZvciAoOyAiICIgPT09IGFbZV07ICkgZSsrCiAgICAgICAgaWYgKGQpIHsKICAgICAgICAgIGlmICgiKSIgIT09IGFbZV0pCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoImNvbXBsZXgoKSBhcmcgaXMgbWFsZm9ybWVkIHN0cmluZyIpCiAgICAgICAgICBmb3IgKGUrKzsgIiAiID09PSBhW2VdOyApIGUrKwogICAgICAgIH0KICAgICAgICBpZiAoYS5sZW5ndGggIT09IGUpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKCJjb21wbGV4KCkgYXJnIGlzIG1hbGZvcm1lZCBzdHJpbmciKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5jb21wbGV4KAogICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGIpLAogICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGMpLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLnRwJGhhc2ggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmludF8oCiAgICAgICAgICAxMDAwMDAzICogdGhpcy50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiRpbWFnKS52ICsKICAgICAgICAgICAgdGhpcy50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiRyZWFsKS52LAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLm5iJGFkZCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgYSA9IFNrLmJ1aWx0aW4uY29tcGxleC5jaGVja19udW1iZXJfb3JfY29tcGxleChhKQogICAgICAgIHZhciBiID0KICAgICAgICAgIHRoaXMudHAkZ2V0YXR0cihTay5idWlsdGluLnN0ci4kcmVhbCkudiArCiAgICAgICAgICBhLnRwJGdldGF0dHIoU2suYnVpbHRpbi5zdHIuJHJlYWwpLnYKICAgICAgICBhID0KICAgICAgICAgIHRoaXMudHAkZ2V0YXR0cihTay5idWlsdGluLnN0ci4kaW1hZykudiArCiAgICAgICAgICBhLnRwJGdldGF0dHIoU2suYnVpbHRpbi5zdHIuJGltYWcpLnYKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uY29tcGxleCgKICAgICAgICAgIG5ldyBTay5idWlsdGluLmZsb2F0XyhiKSwKICAgICAgICAgIG5ldyBTay5idWlsdGluLmZsb2F0XyhhKSwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4Ll9jX2RpZmYgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjID0gYS5yZWFsLm5iJHN1YnRyYWN0LmNhbGwoYS5yZWFsLCBiLnJlYWwpCiAgICAgICAgYSA9IGEuaW1hZy5uYiRzdWJ0cmFjdC5jYWxsKGEuaW1hZywgYi5pbWFnKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5jb21wbGV4KGMsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5uYiRzdWJ0cmFjdCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIgPSBTay5idWlsdGluLmNvbXBsZXguY2hlY2tfbnVtYmVyX29yX2NvbXBsZXgodGhpcykKICAgICAgICBhID0gU2suYnVpbHRpbi5jb21wbGV4LmNoZWNrX251bWJlcl9vcl9jb21wbGV4KGEpCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uY29tcGxleC5fY19kaWZmKGIsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5uYiRtdWx0aXBseSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIgPSBTay5idWlsdGluLmNvbXBsZXguY2hlY2tfbnVtYmVyX29yX2NvbXBsZXgoYSkKICAgICAgICBhID0gdGhpcy5yZWFsLnYgKiBiLnJlYWwudiAtIHRoaXMuaW1hZy52ICogYi5pbWFnLnYKICAgICAgICBiID0gdGhpcy5yZWFsLnYgKiBiLmltYWcudiArIHRoaXMuaW1hZy52ICogYi5yZWFsLnYKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uY29tcGxleCgKICAgICAgICAgIG5ldyBTay5idWlsdGluLmZsb2F0XyhhKSwKICAgICAgICAgIG5ldyBTay5idWlsdGluLmZsb2F0XyhiKSwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5uYiRkaXZpZGUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGEgPSBTay5idWlsdGluLmNvbXBsZXguY2hlY2tfbnVtYmVyX29yX2NvbXBsZXgoYSkKICAgICAgICB2YXIgYiA9IGEucmVhbC52CiAgICAgICAgdmFyIGMgPSBhLmltYWcudgogICAgICAgIGEgPSB0aGlzLnJlYWwudgogICAgICAgIHZhciBkID0gdGhpcy5pbWFnLnYKICAgICAgICB2YXIgZSA9IE1hdGguYWJzKGIpCiAgICAgICAgdmFyIGYgPSBNYXRoLmFicyhjKQogICAgICAgIGlmIChlID49IGYpIHsKICAgICAgICAgIGlmICgwID09PSBlKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5aZXJvRGl2aXNpb25FcnJvcigiY29tcGxleCBkaXZpc2lvbiBieSB6ZXJvIikKICAgICAgICAgIGUgPSBjIC8gYgogICAgICAgICAgZiA9IGIgKyBjICogZQogICAgICAgICAgYiA9IChhICsgZCAqIGUpIC8gZgogICAgICAgICAgYSA9IChkIC0gYSAqIGUpIC8gZgogICAgICAgIH0gZWxzZQogICAgICAgICAgZiA+PSBlCiAgICAgICAgICAgID8gKChlID0gYiAvIGMpLAogICAgICAgICAgICAgIChmID0gYiAqIGUgKyBjKSwKICAgICAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgwICE9PSBjKSwKICAgICAgICAgICAgICAoYiA9IChhICogZSArIGQpIC8gZiksCiAgICAgICAgICAgICAgKGEgPSAoZCAqIGUgLSBhKSAvIGYpKQogICAgICAgICAgICA6IChhID0gYiA9IE5hTikKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uY29tcGxleCgKICAgICAgICAgIG5ldyBTay5idWlsdGluLmZsb2F0XyhiKSwKICAgICAgICAgIG5ldyBTay5idWlsdGluLmZsb2F0XyhhKSwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5uYiRmbG9vcl9kaXZpZGUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiY2FuJ3QgdGFrZSBmbG9vciBvZiBjb21wbGV4IG51bWJlci4iKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkcmVtYWluZGVyID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImNhbid0IG1vZCBjb21wbGV4IG51bWJlcnMuIikKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLm5iJHBvd2VyID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBpZiAobnVsbCAhPSBiICYmICFTay5idWlsdGluLmNoZWNrTm9uZShiKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoImNvbXBsZXggbW9kdWxvIikKICAgICAgICBiID0gU2suYnVpbHRpbi5jb21wbGV4LmNoZWNrX251bWJlcl9vcl9jb21wbGV4KGEpCiAgICAgICAgYSA9IGIucmVhbC52IHwgMAogICAgICAgIHJldHVybiAwID09PSBiLmltYWcudiAmJiBiLnJlYWwudiA9PT0gYQogICAgICAgICAgPyBTay5idWlsdGluLmNvbXBsZXguY19wb3dpKHRoaXMsIGEpCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uY29tcGxleC5jX3Bvdyh0aGlzLCBiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5jX3BvdyA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIGMgPSBiLnJlYWwudgogICAgICAgIGIgPSBiLmltYWcudgogICAgICAgIHZhciBkID0gYS5yZWFsLnYKICAgICAgICB2YXIgZSA9IGEuaW1hZy52CiAgICAgICAgaWYgKDAgPT09IGMgJiYgMCA9PT0gYikgKGIgPSAxKSwgKGEgPSAwKQogICAgICAgIGVsc2UgaWYgKDAgPT09IGQgJiYgMCA9PT0gZSkgewogICAgICAgICAgaWYgKDAgIT09IGIgfHwgMCA+IGMpCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlplcm9EaXZpc2lvbkVycm9yKCJjb21wbGV4IGRpdmlzaW9uIGJ5IHplcm8iKQogICAgICAgICAgYSA9IGIgPSAwCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBmID0gTWF0aC5oeXBvdChkLCBlKQogICAgICAgICAgYSA9IE1hdGgucG93KGYsIGMpCiAgICAgICAgICBkID0gTWF0aC5hdGFuMihlLCBkKQogICAgICAgICAgYyAqPSBkCiAgICAgICAgICAwICE9PSBiICYmICgoYSAvPSBNYXRoLmV4cChkICogYikpLCAoYyArPSBiICogTWF0aC5sb2coZikpKQogICAgICAgICAgYiA9IGEgKiBNYXRoLmNvcyhjKQogICAgICAgICAgYSAqPSBNYXRoLnNpbihjKQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uY29tcGxleCgKICAgICAgICAgIG5ldyBTay5idWlsdGluLmZsb2F0XyhiKSwKICAgICAgICAgIG5ldyBTay5idWlsdGluLmZsb2F0XyhhKSwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LmNfcG93aSA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgcmV0dXJuIDEwMCA8IGIgfHwgLTEwMCA+IGIKICAgICAgICAgID8gKChiID0gbmV3IFNrLmJ1aWx0aW4uY29tcGxleCgKICAgICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5mbG9hdF8oYiksCiAgICAgICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKDApLAogICAgICAgICAgICApKSwKICAgICAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LmNfcG93KGEsIGIpKQogICAgICAgICAgOiAwIDwgYgogICAgICAgICAgPyBTay5idWlsdGluLmNvbXBsZXguY19wb3d1KGEsIGIpCiAgICAgICAgICA6IG5ldyBTay5idWlsdGluLmNvbXBsZXgoCiAgICAgICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKDEpLAogICAgICAgICAgICAgIG5ldyBTay5idWlsdGluLmZsb2F0XygwKSwKICAgICAgICAgICAgKS5uYiRkaXZpZGUoU2suYnVpbHRpbi5jb21wbGV4LmNfcG93dShhLCAtYikpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LmNfcG93dSA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIGMsCiAgICAgICAgICBkID0gMQogICAgICAgIGZvciAoCiAgICAgICAgICBjID0gbmV3IFNrLmJ1aWx0aW4uY29tcGxleCgKICAgICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKDEpLAogICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5mbG9hdF8oMCksCiAgICAgICAgICApOwogICAgICAgICAgMCA8IGQgJiYgYiA+PSBkOwoKICAgICAgICApCiAgICAgICAgICBiICYgZCAmJiAoYyA9IGMubmIkbXVsdGlwbHkoYSkpLCAoZCA8PD0gMSksIChhID0gYS5uYiRtdWx0aXBseShhKSkKICAgICAgICByZXR1cm4gYwogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkaW5wbGFjZV9hZGQgPQogICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkYWRkCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkaW5wbGFjZV9zdWJ0cmFjdCA9CiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5uYiRzdWJ0cmFjdAogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLm5iJGlucGxhY2VfbXVsdGlwbHkgPQogICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkbXVsdGlwbHkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5uYiRpbnBsYWNlX2RpdmlkZSA9CiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5uYiRkaXZpZGUKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5uYiRpbnBsYWNlX3JlbWFpbmRlciA9CiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5uYiRyZW1haW5kZXIKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5uYiRpbnBsYWNlX2Zsb29yX2RpdmlkZSA9CiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5uYiRmbG9vcl9kaXZpZGUKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5uYiRpbnBsYWNlX3Bvd2VyID0KICAgICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLm5iJHBvd2VyCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUubmIkbmVnYXRpdmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLnJlYWwudgogICAgICAgIHZhciBiID0gLXRoaXMuaW1hZy52CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmNvbXBsZXgoCiAgICAgICAgICBuZXcgU2suYnVpbHRpbi5mbG9hdF8oLWEpLAogICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGIpLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLm5iJHBvc2l0aXZlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLmNvbXBsZXguY2hlY2tfbnVtYmVyX29yX2NvbXBsZXgodGhpcykKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXguX2NvbXBsZXhfY2hlY2sgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiB2b2lkIDAgPT09IGEKICAgICAgICAgID8gITEKICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uY29tcGxleCB8fAogICAgICAgICAgICAoYS50cCRuYW1lICYmICJjb21wbGV4IiA9PT0gYS50cCRuYW1lKSB8fAogICAgICAgICAgICBTay5idWlsdGluLmlzc3ViY2xhc3MobmV3IFNrLmJ1aWx0aW4udHlwZShhKSwgU2suYnVpbHRpbi5jb21wbGV4KQogICAgICAgICAgPyAhMAogICAgICAgICAgOiAhMQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUudHAkcmljaGNvbXBhcmUgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGlmICgiRXEiICE9PSBiICYmICJOb3RFcSIgIT09IGIpIHsKICAgICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrTnVtYmVyKGEpIHx8IFNrLmJ1aWx0aW4uY29tcGxleC5fY29tcGxleF9jaGVjayhhKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICJubyBvcmRlcmluZyByZWxhdGlvbiBpcyBkZWZpbmVkIGZvciBjb21wbGV4IG51bWJlcnMiLAogICAgICAgICAgICApCiAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQKICAgICAgICB9CiAgICAgICAgdmFyIGMgPSBTay5idWlsdGluLmNvbXBsZXguY2hlY2tfbnVtYmVyX29yX2NvbXBsZXgodGhpcykKICAgICAgICB2YXIgZCA9IGMudHAkZ2V0YXR0cihTay5idWlsdGluLnN0ci4kcmVhbCkudgogICAgICAgIGMgPSBjLnRwJGdldGF0dHIoU2suYnVpbHRpbi5zdHIuJGltYWcpLnYKICAgICAgICBpZiAoU2suYnVpbHRpbi5jaGVja0ludChhKSkgewogICAgICAgICAgaWYgKDAgPT09IGMpCiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgKGQgPSBTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2wobmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGQpLCBhLCBiKSksCiAgICAgICAgICAgICAgKGIgPSBuZXcgU2suYnVpbHRpbi5ib29sKGQpKQogICAgICAgICAgICApCiAgICAgICAgICBkID0gITEKICAgICAgICB9IGVsc2UgaWYgKFNrLmJ1aWx0aW4uY2hlY2tGbG9hdChhKSkKICAgICAgICAgIGQgPSBkID09PSBTay5idWlsdGluLmZsb2F0Xy5QeUZsb2F0X0FzRG91YmxlKGEpICYmIDAgPT09IGMKICAgICAgICBlbHNlIGlmIChTay5idWlsdGluLmNvbXBsZXguX2NvbXBsZXhfY2hlY2soYSkpIHsKICAgICAgICAgIHZhciBlID0gYS50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiRyZWFsKS52CiAgICAgICAgICBhID0gYS50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiRpbWFnKS52CiAgICAgICAgICBkID0gZCA9PT0gZSAmJiBjID09PSBhCiAgICAgICAgfSBlbHNlIHJldHVybiBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICAgICJOb3RFcSIgPT09IGIgJiYgKGQgPSAhZCkKICAgICAgICByZXR1cm4gKGIgPSBuZXcgU2suYnVpbHRpbi5ib29sKGQpKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuX19lcV9fID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS50cCRyaWNoY29tcGFyZS5jYWxsKGEsIGIsICJFcSIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX25lX18gPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLnRwJHJpY2hjb21wYXJlLmNhbGwoYSwgYiwgIk5vdEVxIikKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fbHRfXyA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgInVub3JkZXJhYmxlIHR5cGVzOiAiICsKICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYSkgKwogICAgICAgICAgICAiIDwgIiArCiAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGIpLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fbGVfXyA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgInVub3JkZXJhYmxlIHR5cGVzOiAiICsKICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYSkgKwogICAgICAgICAgICAiIDw9ICIgKwogICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShiKSwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX2d0X18gPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICJ1bm9yZGVyYWJsZSB0eXBlczogIiArCiAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGEpICsKICAgICAgICAgICAgIiA+ICIgKwogICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShiKSwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX2dlX18gPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICJ1bm9yZGVyYWJsZSB0eXBlczogIiArCiAgICAgICAgICAgIFNrLmFic3RyLnR5cGVOYW1lKGEpICsKICAgICAgICAgICAgIiA+PSAiICsKICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYiksCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuX19mbG9hdF9fID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImNhbid0IGNvbnZlcnQgY29tcGxleCB0byBmbG9hdCIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX2ludF9fID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoImNhbid0IGNvbnZlcnQgY29tcGxleCB0byBpbnQiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuX2ludGVybmFsR2VuZXJpY0dldEF0dHIgPQogICAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5HZW5lcmljR2V0QXR0cgogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLnRwJGdldGF0dHIgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmIChudWxsICE9IGEgJiYgKFNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYSkgfHwgInN0cmluZyIgPT09IHR5cGVvZiBhKSkgewogICAgICAgICAgdmFyIGIgPSBhCiAgICAgICAgICBTay5idWlsdGluLmNoZWNrU3RyaW5nKGEpICYmIChiID0gU2suZmZpLnJlbWFwVG9KcyhhKSkKICAgICAgICAgIGlmICgicmVhbCIgPT09IGIgfHwgImltYWciID09PSBiKSByZXR1cm4gdGhpc1tiXQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5faW50ZXJuYWxHZW5lcmljR2V0QXR0cihhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUudHAkc2V0YXR0ciA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgaWYgKAogICAgICAgICAgbnVsbCAhPSBhICYmCiAgICAgICAgICAoU2suYnVpbHRpbi5jaGVja1N0cmluZyhhKSB8fCAic3RyaW5nIiA9PT0gdHlwZW9mIGEpICYmCiAgICAgICAgICAoKGIgPSBhKSwKICAgICAgICAgIFNrLmJ1aWx0aW4uY2hlY2tTdHJpbmcoYSkgJiYgKGIgPSBTay5mZmkucmVtYXBUb0pzKGEpKSwKICAgICAgICAgICJyZWFsIiA9PT0gYiB8fCAiaW1hZyIgPT09IGIpCiAgICAgICAgKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uQXR0cmlidXRlRXJyb3IoInJlYWRvbmx5IGF0dHJpYnV0ZSIpCiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uQXR0cmlidXRlRXJyb3IoCiAgICAgICAgICAiJ2NvbXBsZXgnIG9iamVjdCBhdHRyaWJ1dGUgJyIgKyBhICsgIicgaXMgcmVhZG9ubHkiLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXguY29tcGxleF9mb3JtYXQgPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIGlmIChudWxsID09IGEgfHwgIVNrLmJ1aWx0aW4uY29tcGxleC5fY29tcGxleF9jaGVjayhhKSkKICAgICAgICAgIHRocm93IEVycm9yKAogICAgICAgICAgICAiSW52YWxpZCBpbnRlcm5hbCBtZXRob2QgY2FsbDogU2suY29tcGxleC5jb21wbGV4X2Zvcm1hdCgpIGNhbGxlZCB3aXRoIGludmFsaWQgdmFsdWUgdHlwZS4iLAogICAgICAgICAgKQogICAgICAgIHZhciBkID0gIiIsCiAgICAgICAgICBlID0gIiIKICAgICAgICBpZiAoMCA9PT0gYS5yZWFsLnYgJiYgMSA9PSAoMCA+IGEucmVhbC52ID8gLTEgOiAxKSkgewogICAgICAgICAgdmFyIGYgPSAiIgogICAgICAgICAgYiA9IFNrLmJ1aWx0aW4uY29tcGxleC5QeU9TX2RvdWJsZV90b19zdHJpbmcoYS5pbWFnLnYsIGMsIGIsIDAsIG51bGwpCiAgICAgICAgfSBlbHNlCiAgICAgICAgICAoZiA9IFNrLmJ1aWx0aW4uY29tcGxleC5QeU9TX2RvdWJsZV90b19zdHJpbmcoCiAgICAgICAgICAgIGEucmVhbC52LAogICAgICAgICAgICBjLAogICAgICAgICAgICBiLAogICAgICAgICAgICAwLAogICAgICAgICAgICBudWxsLAogICAgICAgICAgKSksCiAgICAgICAgICAgIChiID0gU2suYnVpbHRpbi5jb21wbGV4LlB5T1NfZG91YmxlX3RvX3N0cmluZygKICAgICAgICAgICAgICBhLmltYWcudiwKICAgICAgICAgICAgICBjLAogICAgICAgICAgICAgIGIsCiAgICAgICAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LlB5T1NfZG91YmxlX3RvX3N0cmluZy5QeV9EVFNGX1NJR04sCiAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgKSksCiAgICAgICAgICAgIDAgPT09IGEuaW1hZy52ICYmCiAgICAgICAgICAgICAgLUluZmluaXR5ID09PSAxIC8gYS5pbWFnLnYgJiYKICAgICAgICAgICAgICBiICYmCiAgICAgICAgICAgICAgIi0iICE9PSBiWzBdICYmCiAgICAgICAgICAgICAgKGIgPSAiLSIgKyBiKSwKICAgICAgICAgICAgKGQgPSAiKCIpLAogICAgICAgICAgICAoZSA9ICIpIikKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKCIiICsgZCArIGYgKyBiICsgImoiICsgZSkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLiRyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLmNvbXBsZXguY29tcGxleF9mb3JtYXQodGhpcywgMCwgInIiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUudHAkc3RyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBTay5idWlsdGluLmNvbXBsZXguY29tcGxleF9mb3JtYXQodGhpcywgbnVsbCwgImciKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGZvcm1hdCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgaWYgKG51bGwgPT0gYikgcmV0dXJuIG51bGwKICAgICAgICBpZiAoU2suYnVpbHRpbi5jaGVja1N0cmluZyhiKSkKICAgICAgICAgIHJldHVybiAoYSA9IFNrLmJ1aWx0aW4uY29tcGxleC5fUHlDb21wbGV4X0Zvcm1hdEFkdmFuY2VkKGEsIGIpKQogICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigiX19mb3JtYXRfXyByZXF1aXJlcyBzdHIgb3IgdW5pY29kZSIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkZm9ybWF0LmNvX25hbWUgPSBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgIl9fZm9ybWF0X18iLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuX19mb3JtYXRfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkZm9ybWF0LAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5fUHlDb21wbGV4X0Zvcm1hdEFkdmFuY2VkID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgIl9fZm9ybWF0X18gaXMgbm90IGltcGxlbWVudGVkIGZvciBjb21wbGV4IHR5cGUuIiwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4Ll9pc19maW5pdGUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiAhaXNOYU4oYSkgJiYgSW5maW5pdHkgIT09IGEgJiYgLUluZmluaXR5ICE9PSBhCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4Ll9pc19pbmZpbml0eSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIEluZmluaXR5ID09PSBhIHx8IC1JbmZpbml0eSA9PT0gYQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGFicyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIgPSBhLnJlYWwudgogICAgICAgIGEgPSBhLmltYWcudgogICAgICAgIGlmICgKICAgICAgICAgICFTay5idWlsdGluLmNvbXBsZXguX2lzX2Zpbml0ZShiKSB8fAogICAgICAgICAgIVNrLmJ1aWx0aW4uY29tcGxleC5faXNfZmluaXRlKGEpCiAgICAgICAgKQogICAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4uY29tcGxleC5faXNfaW5maW5pdHkoYikKICAgICAgICAgICAgPyAoKGIgPSBNYXRoLmFicyhiKSksIG5ldyBTay5idWlsdGluLmZsb2F0XyhiKSkKICAgICAgICAgICAgOiBTay5idWlsdGluLmNvbXBsZXguX2lzX2luZmluaXR5KGEpCiAgICAgICAgICAgID8gKChiID0gTWF0aC5hYnMoYSkpLCBuZXcgU2suYnVpbHRpbi5mbG9hdF8oYikpCiAgICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKE5hTikKICAgICAgICBiID0gTWF0aC5oeXBvdChiLCBhKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jb21wbGV4Ll9pc19maW5pdGUoYikpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5PdmVyZmxvd0Vycm9yKCJhYnNvbHV0ZSB2YWx1ZSB0b28gbGFyZ2UiKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5mbG9hdF8oYikKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRhYnMuY29fbmFtZSA9IG5ldyBTay5idWlsdGluLnN0cigKICAgICAgICAiX19hYnNfXyIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX2Fic19fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYygKICAgICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRhYnMsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkYm9vbCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmJvb2woCiAgICAgICAgICBhLnRwJGdldGF0dHIoU2suYnVpbHRpbi5zdHIuJHJlYWwpLnYgfHwKICAgICAgICAgICAgYS50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiRyZWFsKS52LAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRib29sLmNvX25hbWUgPSBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgIl9fYm9vbF9fIiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fYm9vbF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYygKICAgICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRib29sLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JHRydWVkaXYgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fdHJ1ZWRpdl9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITApCiAgICAgICAgcmV0dXJuIGEubmIkZGl2aWRlLmNhbGwoYSwgYikKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCR0cnVlZGl2LmNvX25hbWUgPSBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgIl9fdHJ1ZWRpdl9fIiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fdHJ1ZWRpdl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYygKICAgICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCR0cnVlZGl2LAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGhhc2ggPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9faGFzaF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITApCiAgICAgICAgcmV0dXJuIGEudHAkaGFzaC5jYWxsKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkaGFzaC5jb19uYW1lID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJfX2hhc2hfXyIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX2hhc2hfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkaGFzaCwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRhZGQgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fYWRkX18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRhZGQuY2FsbChhLCBiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGFkZC5jb19uYW1lID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJfX2FkZF9fIiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fYWRkX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKAogICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGFkZCwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRyZXByID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX3JlcHJfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICEwKQogICAgICAgIHJldHVybiBhLnIkLmNhbGwoYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRyZXByLmNvX25hbWUgPSBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgIl9fcmVwcl9fIiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fcmVwcl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYygKICAgICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRyZXByLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JHN0ciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19zdHJfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICEwKQogICAgICAgIHJldHVybiBhLnRwJHN0ci5jYWxsKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkc3RyLmNvX25hbWUgPSBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgIl9fc3RyX18iLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuX19zdHJfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkc3RyLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JHN1YiA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19zdWJfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEsICEwKQogICAgICAgIHJldHVybiBhLm5iJHN1YnRyYWN0LmNhbGwoYSwgYikKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRzdWIuY29fbmFtZSA9IG5ldyBTay5idWlsdGluLnN0cigKICAgICAgICAiX19zdWJfXyIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX3N1Yl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYygKICAgICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRzdWIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkbXVsID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX211bF9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITApCiAgICAgICAgcmV0dXJuIGEubmIkbXVsdGlwbHkuY2FsbChhLCBiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JG11bC5jb19uYW1lID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJfX211bF9fIiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fbXVsX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKAogICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JG11bCwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRkaXYgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fZGl2X18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRkaXZpZGUuY2FsbChhLCBiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGRpdi5jb19uYW1lID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJfX2Rpdl9fIiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fZGl2X18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKAogICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGRpdiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRmbG9vcmRpdiA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19mbG9vcmRpdl9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSwgITApCiAgICAgICAgcmV0dXJuIGEubmIkZmxvb3JfZGl2aWRlLmNhbGwoYSwgYikKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRmbG9vcmRpdi5jb19uYW1lID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJfX2Zsb29yZGl2X18iLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuX19mbG9vcmRpdl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYygKICAgICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRmbG9vcmRpdiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRtb2QgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fbW9kX18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRyZW1haW5kZXIuY2FsbChhLCBiKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JG1vZC5jb19uYW1lID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJfX21vZF9fIiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fbW9kX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKAogICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JG1vZCwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRwb3cgPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fcG93X18iLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRwb3dlci5jYWxsKGEsIGIsIGMpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkcG93LmNvX25hbWUgPSBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgIl9fcG93X18iLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuX19wb3dfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkcG93LAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JG5lZyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19uZWdfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICEwKQogICAgICAgIHJldHVybiBhLm5iJG5lZ2F0aXZlLmNhbGwoYSkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fbmVnX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKAogICAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JG5lZywKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRwb3MgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fcG9zX18iLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMCkKICAgICAgICByZXR1cm4gYS5uYiRwb3NpdGl2ZS5jYWxsKGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkcG9zLmNvX25hbWUgPSBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgIl9fcG9zX18iLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuX19wb3NfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkcG9zLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGNvbmp1Z2F0ZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiY29uanVnYXRlIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITApCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmNvbXBsZXgoYS5yZWFsLCBuZXcgU2suYnVpbHRpbi5mbG9hdF8oLWEuaW1hZy52KSkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRjb25qdWdhdGUuY29fbmFtZSA9IG5ldyBTay5idWlsdGluLnN0cigKICAgICAgICAiY29uanVnYXRlIiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmNvbmp1Z2F0ZSA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkY29uanVnYXRlLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JGRpdm1vZCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19kaXZtb2RfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDEsIDEsICEwKQogICAgICAgIHZhciBjID0gU2suYnVpbHRpbi5jb21wbGV4LmNoZWNrX251bWJlcl9vcl9jb21wbGV4KGEpCiAgICAgICAgdmFyIGQgPSBTay5idWlsdGluLmNvbXBsZXguY2hlY2tfbnVtYmVyX29yX2NvbXBsZXgoYikKICAgICAgICB2YXIgZSA9IGMubmIkZGl2aWRlLmNhbGwoYywgZCkKICAgICAgICBlLnJlYWwgPSBuZXcgU2suYnVpbHRpbi5mbG9hdF8oTWF0aC5mbG9vcihlLnJlYWwudikpCiAgICAgICAgZS5pbWFnID0gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKDApCiAgICAgICAgYyA9IGMubmIkc3VidHJhY3QuY2FsbChjLCBkLm5iJG11bHRpcGx5LmNhbGwoZCwgZSkpCiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnR1cGxlKFtlLCBjXSkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRkaXZtb2QuY29fbmFtZSA9IG5ldyBTay5idWlsdGluLnN0cigKICAgICAgICAiX19kaXZtb2RfXyIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX2Rpdm1vZF9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYygKICAgICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRkaXZtb2QsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkZ2V0bmV3YXJncyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiX19nZXRuZXdhcmdzX18iLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAwLCAhMCkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4udHVwbGUoW2EucmVhbCwgYS5pbWFnXSkKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRnZXRuZXdhcmdzLmNvX25hbWUgPSBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgIl9fZ2V0bmV3YXJnc19fIiwKICAgICAgKQogICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLl9fZ2V0bmV3YXJnc19fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYygKICAgICAgICBTay5idWlsdGluLmNvbXBsZXgucHJvdG90eXBlLmludCRnZXRuZXdhcmdzLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uY29tcGxleC5wcm90b3R5cGUuaW50JG5vbnplcm8gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9fbm9uemVyb19fIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITApCiAgICAgICAgcmV0dXJuIDAgIT09IGEucmVhbC52IHx8IDAgIT09IGEuaW1hZy52CiAgICAgICAgICA/IFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICAgICAgOiBTay5idWlsdGluLmJvb2wuZmFsc2UkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkbm9uemVyby5jb19uYW1lID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJfX25vbnplcm9fXyIsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5fX25vbnplcm9fXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5jb21wbGV4LnByb3RvdHlwZS5pbnQkbm9uemVybywKICAgICAgKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uY29tcGxleCIsIFNrLmJ1aWx0aW4uY29tcGxleCkKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LlB5T1NfZG91YmxlX3RvX3N0cmluZyA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgZSA9ICExCiAgICAgICAgc3dpdGNoIChiKSB7CiAgICAgICAgICBjYXNlICJlIjoKICAgICAgICAgIGNhc2UgImYiOgogICAgICAgICAgY2FzZSAiZyI6CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlICJFIjoKICAgICAgICAgICAgZSA9ICEwCiAgICAgICAgICAgIGIgPSAiZSIKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgIkYiOgogICAgICAgICAgICBlID0gITAKICAgICAgICAgICAgYiA9ICJmIgogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSAiciI6CiAgICAgICAgICAgIGlmICgwICE9PSBjKSB0aHJvdyBFcnJvcigiQmFkIGludGVybmFsbCBjYWxsIikKICAgICAgICAgICAgYyA9IDE3CiAgICAgICAgICAgIGIgPSAiZyIKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IEVycm9yKCJCYWQgaW50ZXJuYWxsIGNhbGwiKQogICAgICAgIH0KICAgICAgICBpZiAoaXNOYU4oYSkpIGEgPSAibmFuIgogICAgICAgIGVsc2UgaWYgKEluZmluaXR5ID09PSBhKSBhID0gImluZiIKICAgICAgICBlbHNlIGlmICgtSW5maW5pdHkgPT09IGEpIGEgPSAiLWluZiIKICAgICAgICBlbHNlIHsKICAgICAgICAgIGQgJiBTay5idWlsdGluLmNvbXBsZXguUHlPU19kb3VibGVfdG9fc3RyaW5nLlB5X0RUU0ZfQUREX0RPVF8wICYmCiAgICAgICAgICAgIChiID0gImciKQogICAgICAgICAgdmFyIGYgPQogICAgICAgICAgICAiJSIgKwogICAgICAgICAgICAoZCAmIFNrLmJ1aWx0aW4uY29tcGxleC5QeU9TX2RvdWJsZV90b19zdHJpbmcuUHlfRFRTRl9BTFQKICAgICAgICAgICAgICA/ICIjIgogICAgICAgICAgICAgIDogIiIpCiAgICAgICAgICBudWxsICE9IGMgJiYgKGYgPSBmICsgIi4iICsgYykKICAgICAgICAgIGYgPSBuZXcgU2suYnVpbHRpbi5zdHIoZiArIGIpCiAgICAgICAgICBhID0gZi5uYiRyZW1haW5kZXIobmV3IFNrLmJ1aWx0aW4uZmxvYXRfKGEpKQogICAgICAgICAgYSA9IGEudgogICAgICAgIH0KICAgICAgICBkICYgU2suYnVpbHRpbi5jb21wbGV4LlB5T1NfZG91YmxlX3RvX3N0cmluZy5QeV9EVFNGX1NJR04gJiYKICAgICAgICAgICItIiAhPT0gYVswXSAmJgogICAgICAgICAgKGEgPSAiKyIgKyBhKQogICAgICAgIGUgJiYgKGEgPSBhLnRvVXBwZXJDYXNlKCkpCiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgICBTay5idWlsdGluLmNvbXBsZXguUHlPU19kb3VibGVfdG9fc3RyaW5nLlB5X0RUU0ZfU0lHTiA9IDEKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LlB5T1NfZG91YmxlX3RvX3N0cmluZy5QeV9EVFNGX0FERF9ET1RfMCA9IDIKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LlB5T1NfZG91YmxlX3RvX3N0cmluZy5QeV9EVFNGX0FMVCA9IDQKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LlB5T1NfZG91YmxlX3RvX3N0cmluZy5QeV9EVFNUX0ZJTklURSA9IDAKICAgICAgU2suYnVpbHRpbi5jb21wbGV4LlB5T1NfZG91YmxlX3RvX3N0cmluZy5QeV9EVFNUX0lORklOSVRFID0gMQogICAgICBTay5idWlsdGluLmNvbXBsZXguUHlPU19kb3VibGVfdG9fc3RyaW5nLlB5X0RUU1RfTkFOID0gMgogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4uc2xpY2UgPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInNsaWNlIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMywgITEsICExKQogICAgICAgIGlmICgKICAgICAgICAgIHZvaWQgMCAhPT0gYyAmJgogICAgICAgICAgU2subWlzY2V2YWwuaXNJbmRleChjKSAmJgogICAgICAgICAgMCA9PT0gU2subWlzY2V2YWwuYXNJbmRleChjKQogICAgICAgICkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoInNsaWNlIHN0ZXAgY2Fubm90IGJlIHplcm8iKQogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLnNsaWNlKSkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zbGljZShhLCBiLCBjKQogICAgICAgIHZvaWQgMCA9PT0gYiAmJiB2b2lkIDAgPT09IGMgJiYgKChiID0gYSksIChhID0gU2suYnVpbHRpbi5ub25lLm5vbmUkKSkKICAgICAgICB2b2lkIDAgPT09IGIgJiYgKGIgPSBTay5idWlsdGluLm5vbmUubm9uZSQpCiAgICAgICAgdm9pZCAwID09PSBjICYmIChjID0gU2suYnVpbHRpbi5ub25lLm5vbmUkKQogICAgICAgIHRoaXMuc3RhcnQgPSBhCiAgICAgICAgdGhpcy5zdG9wID0gYgogICAgICAgIHRoaXMuc3RlcCA9IGMKICAgICAgICB0aGlzLl9fY2xhc3NfXyA9IFNrLmJ1aWx0aW4uc2xpY2UKICAgICAgICB0aGlzLiRkID0gbmV3IFNrLmJ1aWx0aW4uZGljdChbCiAgICAgICAgICBTay5idWlsdGluLnNsaWNlJHN0YXJ0LAogICAgICAgICAgdGhpcy5zdGFydCwKICAgICAgICAgIFNrLmJ1aWx0aW4uc2xpY2Ukc3RvcCwKICAgICAgICAgIHRoaXMuc3RvcCwKICAgICAgICAgIFNrLmJ1aWx0aW4uc2xpY2Ukc3RlcCwKICAgICAgICAgIHRoaXMuc3RlcCwKICAgICAgICBdKQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgic2xpY2UiLCBTay5idWlsdGluLnNsaWNlLCBTay5idWlsdGluLm9iamVjdCkKICAgICAgU2suYnVpbHRpbi5zbGljZS5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGEgPSBTay5idWlsdGluLnJlcHIodGhpcy5zdGFydCkudiwKICAgICAgICAgIGIgPSBTay5idWlsdGluLnJlcHIodGhpcy5zdG9wKS52LAogICAgICAgICAgYyA9IFNrLmJ1aWx0aW4ucmVwcih0aGlzLnN0ZXApLnYKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKCJzbGljZSgiICsgYSArICIsICIgKyBiICsgIiwgIiArIGMgKyAiKSIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zbGljZS5wcm90b3R5cGUudHAkcmljaGNvbXBhcmUgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGlmICghYS5fX2NsYXNzX18gfHwgYS5fX2NsYXNzX18gIT0gU2suYnVpbHRpbi5zbGljZSkKICAgICAgICAgIHJldHVybiAiRXEiID09PSBiCiAgICAgICAgICAgID8gITEKICAgICAgICAgICAgOiAiTm90RXEiID09PSBiCiAgICAgICAgICAgID8gITAKICAgICAgICAgICAgOiBTay5fX2Z1dHVyZV9fLnB5dGhvbjMKICAgICAgICAgICAgPyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkLk5vdEltcGxlbWVudGVkJAogICAgICAgICAgICA6ICExCiAgICAgICAgdmFyIGMgPSBuZXcgU2suYnVpbHRpbi50dXBsZShbdGhpcy5zdGFydCwgdGhpcy5zdG9wLCB0aGlzLnN0ZXBdKQogICAgICAgIGEgPSBuZXcgU2suYnVpbHRpbi50dXBsZShbYS5zdGFydCwgYS5zdG9wLCBhLnN0ZXBdKQogICAgICAgIHJldHVybiBjLnRwJHJpY2hjb21wYXJlKGEsIGIpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zbGljZS5wcm90b3R5cGUuc2xpY2VfaW5kaWNlc18gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrTm9uZSh0aGlzLnN0YXJ0KSkgdmFyIGIgPSBudWxsCiAgICAgICAgZWxzZSBpZiAoU2subWlzY2V2YWwuaXNJbmRleCh0aGlzLnN0YXJ0KSkKICAgICAgICAgIGIgPSBTay5taXNjZXZhbC5hc0luZGV4KHRoaXMuc3RhcnQpCiAgICAgICAgZWxzZQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAic2xpY2UgaW5kaWNlcyBtdXN0IGJlIGludGVnZXJzIG9yIE5vbmUiLAogICAgICAgICAgKQogICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrTm9uZSh0aGlzLnN0b3ApKSB2YXIgYyA9IG51bGwKICAgICAgICBlbHNlIGlmIChTay5taXNjZXZhbC5pc0luZGV4KHRoaXMuc3RvcCkpCiAgICAgICAgICBjID0gU2subWlzY2V2YWwuYXNJbmRleCh0aGlzLnN0b3ApCiAgICAgICAgZWxzZQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAic2xpY2UgaW5kaWNlcyBtdXN0IGJlIGludGVnZXJzIG9yIE5vbmUiLAogICAgICAgICAgKQogICAgICAgIGlmIChTay5idWlsdGluLmNoZWNrTm9uZSh0aGlzLnN0ZXApKSB2YXIgZCA9IG51bGwKICAgICAgICBlbHNlIGlmIChTay5taXNjZXZhbC5pc0luZGV4KHRoaXMuc3RlcCkpCiAgICAgICAgICBkID0gU2subWlzY2V2YWwuYXNJbmRleCh0aGlzLnN0ZXApCiAgICAgICAgZWxzZQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAic2xpY2UgaW5kaWNlcyBtdXN0IGJlIGludGVnZXJzIG9yIE5vbmUiLAogICAgICAgICAgKQogICAgICAgIG51bGwgPT09IGQgJiYgKGQgPSAxKQogICAgICAgIDAgPCBkCiAgICAgICAgICA/IChudWxsID09PSBiICYmIChiID0gMCksCiAgICAgICAgICAgIG51bGwgPT09IGMgJiYgKGMgPSBhKSwKICAgICAgICAgICAgYyA+IGEgJiYgKGMgPSBhKSwKICAgICAgICAgICAgMCA+IGIgJiYgKChiID0gYSArIGIpLCAwID4gYiAmJiAoYiA9IDApKSwKICAgICAgICAgICAgMCA+IGMgJiYgKGMgPSBhICsgYykpCiAgICAgICAgICA6IChudWxsID09PSBiICYmIChiID0gYSAtIDEpLAogICAgICAgICAgICBiID49IGEgJiYgKGIgPSBhIC0gMSksCiAgICAgICAgICAgIG51bGwgPT09IGMgPyAoYyA9IC0xKSA6IDAgPiBjICYmICgoYyA9IGEgKyBjKSwgMCA+IGMgJiYgKGMgPSAtMSkpLAogICAgICAgICAgICAwID4gYiAmJiAoYiA9IGEgKyBiKSkKICAgICAgICByZXR1cm4gW2IsIGMsIGRdCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zbGljZS5wcm90b3R5cGUuaW5kaWNlcyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJpbmRpY2VzIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMiwgITEsICExKQogICAgICAgIGIgPSBTay5idWlsdGluLmFzbnVtJChiKQogICAgICAgIHZhciBjID0gYS5zbGljZV9pbmRpY2VzXyhiKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi50dXBsZShbCiAgICAgICAgICBuZXcgU2suYnVpbHRpbi5pbnRfKGNbMF0pLAogICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uaW50XyhjWzFdKSwKICAgICAgICAgIG5ldyBTay5idWlsdGluLmludF8oY1syXSksCiAgICAgICAgXSkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zbGljZS5wcm90b3R5cGUuc3NzaXRlciQgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjID0gU2suYnVpbHRpbi5hc251bSQoYSksCiAgICAgICAgICBkID0gdGhpcy5zbGljZV9pbmRpY2VzXygibnVtYmVyIiA9PT0gdHlwZW9mIGMgPyBjIDogYS52Lmxlbmd0aCkKICAgICAgICBpZiAoMCA8IGRbMl0pIGZvciAoYSA9IGRbMF07IGEgPCBkWzFdICYmICExICE9PSBiKGEsIGMpOyBhICs9IGRbMl0pOwogICAgICAgIGVsc2UgZm9yIChhID0gZFswXTsgYSA+IGRbMV0gJiYgITEgIT09IGIoYSwgYyk7IGEgKz0gZFsyXSk7CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zbGljZSRzdGFydCA9IG5ldyBTay5idWlsdGluLnN0cigic3RhcnQiKQogICAgICBTay5idWlsdGluLnNsaWNlJHN0b3AgPSBuZXcgU2suYnVpbHRpbi5zdHIoInN0b3AiKQogICAgICBTay5idWlsdGluLnNsaWNlJHN0ZXAgPSBuZXcgU2suYnVpbHRpbi5zdHIoInN0ZXAiKQogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4uc2V0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLnNldCkpCiAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJzZXQiLCBhcmd1bWVudHMubGVuZ3RoLCAwLCAxKSwKICAgICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uc2V0KGEpCiAgICAgICAgICApCiAgICAgICAgInVuZGVmaW5lZCIgPT09IHR5cGVvZiBhICYmIChhID0gW10pCiAgICAgICAgdGhpcy5zZXRfcmVzZXRfKCkKICAgICAgICB2YXIgYyA9IG5ldyBTay5idWlsdGluLmxpc3QoYSkKICAgICAgICBjID0gU2suYWJzdHIuaXRlcihjKQogICAgICAgIGZvciAoYiA9IGMudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBiOyBiID0gYy50cCRpdGVybmV4dCgpKQogICAgICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLmFkZC5mdW5jX2NvZGUodGhpcywgYikKICAgICAgICB0aGlzLl9fY2xhc3NfXyA9IFNrLmJ1aWx0aW4uc2V0CiAgICAgICAgdGhpcy52ID0gdGhpcy52CiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKCJzZXQiLCBTay5idWlsdGluLnNldCwgU2suYnVpbHRpbi5vYmplY3QpCiAgICAgIFNrLmFic3RyLm1hcmtVbmhhc2hhYmxlKFNrLmJ1aWx0aW4uc2V0KQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuc2V0X3Jlc2V0XyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLnYgPSBuZXcgU2suYnVpbHRpbi5kaWN0KFtdKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS4kciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgYSwKICAgICAgICAgIGIgPSBbXQogICAgICAgIHZhciBjID0gU2suYWJzdHIuaXRlcih0aGlzKQogICAgICAgIGZvciAoYSA9IGMudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBhOyBhID0gYy50cCRpdGVybmV4dCgpKQogICAgICAgICAgYi5wdXNoKFNrLm1pc2NldmFsLm9iamVjdFJlcHIoYSkudikKICAgICAgICByZXR1cm4gU2suX19mdXR1cmVfXy5zZXRfcmVwcgogICAgICAgICAgPyAwID09PSBiLmxlbmd0aAogICAgICAgICAgICA/IG5ldyBTay5idWlsdGluLnN0cigic2V0KCkiKQogICAgICAgICAgICA6IG5ldyBTay5idWlsdGluLnN0cigieyIgKyBiLmpvaW4oIiwgIikgKyAifSIpCiAgICAgICAgICA6IG5ldyBTay5idWlsdGluLnN0cigic2V0KFsiICsgYi5qb2luKCIsICIpICsgIl0pIikKICAgICAgfQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUub2IkZXEgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiB0aGlzID09PSBhCiAgICAgICAgICA/IFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zZXQgJiYKICAgICAgICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLnNxJGxlbmd0aC5jYWxsKHRoaXMpID09PQogICAgICAgICAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5zcSRsZW5ndGguY2FsbChhKQogICAgICAgICAgPyB0aGlzLmlzc3Vic2V0LmZ1bmNfY29kZSh0aGlzLCBhKQogICAgICAgICAgOiBTay5idWlsdGluLmJvb2wuZmFsc2UkCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLm9iJG5lID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gdGhpcyA9PT0gYQogICAgICAgICAgPyBTay5idWlsdGluLmJvb2wuZmFsc2UkCiAgICAgICAgICA6IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLnNldCAmJgogICAgICAgICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuc3EkbGVuZ3RoLmNhbGwodGhpcykgPT09CiAgICAgICAgICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLnNxJGxlbmd0aC5jYWxsKGEpCiAgICAgICAgICA/IHRoaXMuaXNzdWJzZXQuZnVuY19jb2RlKHRoaXMsIGEpLnYKICAgICAgICAgICAgPyBTay5idWlsdGluLmJvb2wuZmFsc2UkCiAgICAgICAgICAgIDogU2suYnVpbHRpbi5ib29sLnRydWUkCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5vYiRsdCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMgPT09IGEgfHwKICAgICAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5zcSRsZW5ndGguY2FsbCh0aGlzKSA+PQogICAgICAgICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuc3EkbGVuZ3RoLmNhbGwoYSkKICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgICAgOiB0aGlzLmlzc3Vic2V0LmZ1bmNfY29kZSh0aGlzLCBhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5vYiRsZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMgPT09IGEKICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLnRydWUkCiAgICAgICAgICA6IFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5zcSRsZW5ndGguY2FsbCh0aGlzKSA+CiAgICAgICAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5zcSRsZW5ndGguY2FsbChhKQogICAgICAgICAgPyBTay5idWlsdGluLmJvb2wuZmFsc2UkCiAgICAgICAgICA6IHRoaXMuaXNzdWJzZXQuZnVuY19jb2RlKHRoaXMsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLm9iJGd0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gdGhpcyA9PT0gYSB8fAogICAgICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLnNxJGxlbmd0aC5jYWxsKHRoaXMpIDw9CiAgICAgICAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5zcSRsZW5ndGguY2FsbChhKQogICAgICAgICAgPyBTay5idWlsdGluLmJvb2wuZmFsc2UkCiAgICAgICAgICA6IHRoaXMuaXNzdXBlcnNldC5mdW5jX2NvZGUodGhpcywgYSkKICAgICAgfQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUub2IkZ2UgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiB0aGlzID09PSBhCiAgICAgICAgICA/IFNrLmJ1aWx0aW4uYm9vbC50cnVlJAogICAgICAgICAgOiBTay5idWlsdGluLnNldC5wcm90b3R5cGUuc3EkbGVuZ3RoLmNhbGwodGhpcykgPAogICAgICAgICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuc3EkbGVuZ3RoLmNhbGwoYSkKICAgICAgICAgID8gU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgICAgOiB0aGlzLmlzc3VwZXJzZXQuZnVuY19jb2RlKHRoaXMsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLm5iJGFuZCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuaW50ZXJzZWN0aW9uLmZ1bmNfY29kZSh0aGlzLCBhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5uYiRvciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudW5pb24uZnVuY19jb2RlKHRoaXMsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLm5iJHhvciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc3ltbWV0cmljX2RpZmZlcmVuY2UuZnVuY19jb2RlKHRoaXMsIGEpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLm5iJHN1YnRyYWN0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5kaWZmZXJlbmNlLmZ1bmNfY29kZSh0aGlzLCBhKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5fX2l0ZXJfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJfX2l0ZXJfXyIsIGFyZ3VtZW50cy5sZW5ndGgsIDAsIDAsICExLCAhMCkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc2V0X2l0ZXJfKGEpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS50cCRpdGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zZXRfaXRlcl8odGhpcykKICAgICAgfQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuc3EkbGVuZ3RoID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLnYubXAkbGVuZ3RoKCkKICAgICAgfQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuc3EkY29udGFpbnMgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiB0aGlzLnYuc3EkY29udGFpbnMoYSkKICAgICAgfQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuaXNkaXNqb2ludCA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgKSB7CiAgICAgICAgdmFyIGMKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJpc2Rpc2pvaW50IiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMikKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZShiKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIiciICsgU2suYWJzdHIudHlwZU5hbWUoYikgKyAiJyBvYmplY3QgaXMgbm90IGl0ZXJhYmxlIiwKICAgICAgICAgICkKICAgICAgICB2YXIgZCA9IFNrLmFic3RyLml0ZXIoYSkKICAgICAgICBmb3IgKGMgPSBkLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gYzsgYyA9IGQudHAkaXRlcm5leHQoKSkKICAgICAgICAgIGlmICgoYyA9IFNrLmFic3RyLnNlcXVlbmNlQ29udGFpbnMoYiwgYykpKQogICAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgIHJldHVybiBTay5idWlsdGluLmJvb2wudHJ1ZSQKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLmlzc3Vic2V0ID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImlzc3Vic2V0IiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMikKICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZShiKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIiciICsgU2suYWJzdHIudHlwZU5hbWUoYikgKyAiJyBvYmplY3QgaXMgbm90IGl0ZXJhYmxlIiwKICAgICAgICAgICkKICAgICAgICB2YXIgYyA9IGEuc3EkbGVuZ3RoKCkKICAgICAgICB2YXIgZCA9IGIuc3EkbGVuZ3RoKCkKICAgICAgICBpZiAoYyA+IGQpIHJldHVybiBTay5idWlsdGluLmJvb2wuZmFsc2UkCiAgICAgICAgYyA9IFNrLmFic3RyLml0ZXIoYSkKICAgICAgICBmb3IgKGQgPSBjLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gZDsgZCA9IGMudHAkaXRlcm5leHQoKSkKICAgICAgICAgIGlmICgoKGQgPSBTay5hYnN0ci5zZXF1ZW5jZUNvbnRhaW5zKGIsIGQpKSwgIWQpKQogICAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ib29sLmZhbHNlJAogICAgICAgIHJldHVybiBTay5idWlsdGluLmJvb2wudHJ1ZSQKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLmlzc3VwZXJzZXQgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImlzc3VwZXJzZXQiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIHJldHVybiBTay5idWlsdGluLnNldC5wcm90b3R5cGUuaXNzdWJzZXQuZnVuY19jb2RlKGIsIGEpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS51bmlvbiA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oInVuaW9uIiwgYXJndW1lbnRzLmxlbmd0aCwgMSkKICAgICAgICB2YXIgYyA9IFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5jb3B5LmZ1bmNfY29kZShhKQogICAgICAgIHZhciBkID0gW2NdCiAgICAgICAgZm9yIChiID0gMTsgYiA8IGFyZ3VtZW50cy5sZW5ndGg7IGIrKykgZC5wdXNoKGFyZ3VtZW50c1tiXSkKICAgICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUudXBkYXRlLmZ1bmNfY29kZS5hcHBseShudWxsLCBkKQogICAgICAgIHJldHVybiBjCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5pbnRlcnNlY3Rpb24gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJpbnRlcnNlY3Rpb24iLCBhcmd1bWVudHMubGVuZ3RoLCAxKQogICAgICAgIHZhciBjID0gU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLmNvcHkuZnVuY19jb2RlKGEpCiAgICAgICAgdmFyIGQgPSBbY10KICAgICAgICBmb3IgKGIgPSAxOyBiIDwgYXJndW1lbnRzLmxlbmd0aDsgYisrKSBkLnB1c2goYXJndW1lbnRzW2JdKQogICAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5pbnRlcnNlY3Rpb25fdXBkYXRlLmZ1bmNfY29kZS5hcHBseShudWxsLCBkKQogICAgICAgIHJldHVybiBjCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5kaWZmZXJlbmNlID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoCiAgICAgICAgYSwKICAgICAgICBiLAogICAgICApIHsKICAgICAgICB2YXIgYwogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImRpZmZlcmVuY2UiLCBhcmd1bWVudHMubGVuZ3RoLCAyKQogICAgICAgIHZhciBkID0gU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLmNvcHkuZnVuY19jb2RlKGEpCiAgICAgICAgdmFyIGUgPSBbZF0KICAgICAgICBmb3IgKGMgPSAxOyBjIDwgYXJndW1lbnRzLmxlbmd0aDsgYysrKSBlLnB1c2goYXJndW1lbnRzW2NdKQogICAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5kaWZmZXJlbmNlX3VwZGF0ZS5mdW5jX2NvZGUuYXBwbHkobnVsbCwgZSkKICAgICAgICByZXR1cm4gZAogICAgICB9KQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuc3ltbWV0cmljX2RpZmZlcmVuY2UgPSBuZXcgU2suYnVpbHRpbi5mdW5jKAogICAgICAgIGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICB2YXIgYwogICAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigKICAgICAgICAgICAgInN5bW1ldHJpY19kaWZmZXJlbmNlIiwKICAgICAgICAgICAgYXJndW1lbnRzLmxlbmd0aCwKICAgICAgICAgICAgMiwKICAgICAgICAgICAgMiwKICAgICAgICAgICkKICAgICAgICAgIHZhciBkID0gU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLnVuaW9uLmZ1bmNfY29kZShhLCBiKQogICAgICAgICAgdmFyIGUgPSBTay5hYnN0ci5pdGVyKGQpCiAgICAgICAgICBmb3IgKGMgPSBlLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gYzsgYyA9IGUudHAkaXRlcm5leHQoKSkKICAgICAgICAgICAgU2suYWJzdHIuc2VxdWVuY2VDb250YWlucyhhLCBjKSAmJgogICAgICAgICAgICAgIFNrLmFic3RyLnNlcXVlbmNlQ29udGFpbnMoYiwgYykgJiYKICAgICAgICAgICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuZGlzY2FyZC5mdW5jX2NvZGUoZCwgYykKICAgICAgICAgIHJldHVybiBkCiAgICAgICAgfSwKICAgICAgKQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuY29weSA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJjb3B5IiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc2V0KGEpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS51cGRhdGUgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIGMsIGQKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJ1cGRhdGUiLCBhcmd1bWVudHMubGVuZ3RoLCAyKQogICAgICAgIGZvciAoYyA9IDE7IGMgPCBhcmd1bWVudHMubGVuZ3RoOyBjKyspIHsKICAgICAgICAgIHZhciBlID0gYXJndW1lbnRzW2NdCiAgICAgICAgICBpZiAoIVNrLmJ1aWx0aW4uY2hlY2tJdGVyYWJsZShlKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICInIiArIFNrLmFic3RyLnR5cGVOYW1lKGUpICsgIicgb2JqZWN0IGlzIG5vdCBpdGVyYWJsZSIsCiAgICAgICAgICAgICkKICAgICAgICAgIGUgPSBTay5hYnN0ci5pdGVyKGUpCiAgICAgICAgICBmb3IgKGQgPSBlLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gZDsgZCA9IGUudHAkaXRlcm5leHQoKSkKICAgICAgICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLmFkZC5mdW5jX2NvZGUoYSwgZCkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICB9KQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuaW50ZXJzZWN0aW9uX3VwZGF0ZSA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHZhciBjLCBkCiAgICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJpbnRlcnNlY3Rpb25fdXBkYXRlIiwgYXJndW1lbnRzLmxlbmd0aCwgMikKICAgICAgICAgIGZvciAoYyA9IDE7IGMgPCBhcmd1bWVudHMubGVuZ3RoOyBjKyspCiAgICAgICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGFyZ3VtZW50c1tjXSkpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICAgIiciICsKICAgICAgICAgICAgICAgICAgU2suYWJzdHIudHlwZU5hbWUoYXJndW1lbnRzW2NdKSArCiAgICAgICAgICAgICAgICAgICInIG9iamVjdCBpcyBub3QgaXRlcmFibGUiLAogICAgICAgICAgICAgICkKICAgICAgICAgIHZhciBlID0gU2suYWJzdHIuaXRlcihhKQogICAgICAgICAgZm9yIChkID0gZS50cCRpdGVybmV4dCgpOyB2b2lkIDAgIT09IGQ7IGQgPSBlLnRwJGl0ZXJuZXh0KCkpCiAgICAgICAgICAgIGZvciAoYyA9IDE7IGMgPCBhcmd1bWVudHMubGVuZ3RoOyBjKyspCiAgICAgICAgICAgICAgaWYgKCFTay5hYnN0ci5zZXF1ZW5jZUNvbnRhaW5zKGFyZ3VtZW50c1tjXSwgZCkpIHsKICAgICAgICAgICAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5kaXNjYXJkLmZ1bmNfY29kZShhLCBkKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgICAgfSwKICAgICAgKQogICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuZGlmZmVyZW5jZV91cGRhdGUgPSBuZXcgU2suYnVpbHRpbi5mdW5jKAogICAgICAgIGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICB2YXIgYywgZAogICAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiZGlmZmVyZW5jZV91cGRhdGUiLCBhcmd1bWVudHMubGVuZ3RoLCAyKQogICAgICAgICAgZm9yIChjID0gMTsgYyA8IGFyZ3VtZW50cy5sZW5ndGg7IGMrKykKICAgICAgICAgICAgaWYgKCFTay5idWlsdGluLmNoZWNrSXRlcmFibGUoYXJndW1lbnRzW2NdKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgICAiJyIgKwogICAgICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShhcmd1bWVudHNbY10pICsKICAgICAgICAgICAgICAgICAgIicgb2JqZWN0IGlzIG5vdCBpdGVyYWJsZSIsCiAgICAgICAgICAgICAgKQogICAgICAgICAgdmFyIGUgPSBTay5hYnN0ci5pdGVyKGEpCiAgICAgICAgICBmb3IgKGQgPSBlLnRwJGl0ZXJuZXh0KCk7IHZvaWQgMCAhPT0gZDsgZCA9IGUudHAkaXRlcm5leHQoKSkKICAgICAgICAgICAgZm9yIChjID0gMTsgYyA8IGFyZ3VtZW50cy5sZW5ndGg7IGMrKykKICAgICAgICAgICAgICBpZiAoU2suYWJzdHIuc2VxdWVuY2VDb250YWlucyhhcmd1bWVudHNbY10sIGQpKSB7CiAgICAgICAgICAgICAgICBTay5idWlsdGluLnNldC5wcm90b3R5cGUuZGlzY2FyZC5mdW5jX2NvZGUoYSwgZCkKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICAgIH0sCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLnN5bW1ldHJpY19kaWZmZXJlbmNlX3VwZGF0ZSA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oCiAgICAgICAgICAgICJzeW1tZXRyaWNfZGlmZmVyZW5jZV91cGRhdGUiLAogICAgICAgICAgICBhcmd1bWVudHMubGVuZ3RoLAogICAgICAgICAgICAyLAogICAgICAgICAgICAyLAogICAgICAgICAgKQogICAgICAgICAgdmFyIGMgPSBTay5idWlsdGluLnNldC5wcm90b3R5cGUuc3ltbWV0cmljX2RpZmZlcmVuY2UuZnVuY19jb2RlKGEsIGIpCiAgICAgICAgICBhLnNldF9yZXNldF8oKQogICAgICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLnVwZGF0ZS5mdW5jX2NvZGUoYSwgYykKICAgICAgICAgIHJldHVybiBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgICB9LAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5hZGQgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigiYWRkIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMikKICAgICAgICBhLnYubXAkYXNzX3N1YnNjcmlwdChiLCAhMCkKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5kaXNjYXJkID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSwgYikgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oImRpc2NhcmQiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIFNrLmJ1aWx0aW4uZGljdC5wcm90b3R5cGUucG9wLmZ1bmNfY29kZShhLnYsIGIsIFNrLmJ1aWx0aW4ubm9uZS5ub25lJCkKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc2V0LnByb3RvdHlwZS5wb3AgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigicG9wIiwgYXJndW1lbnRzLmxlbmd0aCwgMSwgMSkKICAgICAgICBpZiAoMCA9PT0gYS5zcSRsZW5ndGgoKSkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLktleUVycm9yKCJwb3AgZnJvbSBhbiBlbXB0eSBzZXQiKQogICAgICAgIHZhciBiID0gU2suYWJzdHIuaXRlcihhKS50cCRpdGVybmV4dCgpCiAgICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLmRpc2NhcmQuZnVuY19jb2RlKGEsIGIpCiAgICAgICAgcmV0dXJuIGIKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5zZXQucHJvdG90eXBlLnJlbW92ZSA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJyZW1vdmUiLCBhcmd1bWVudHMubGVuZ3RoLCAyLCAyKQogICAgICAgIGEudi5tcCRkZWxfc3Vic2NyaXB0KGIpCiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICB9KQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uc2V0IiwgU2suYnVpbHRpbi5zZXQpCiAgICAgIFNrLmJ1aWx0aW4uc2V0X2l0ZXJfID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiwgYwogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLnNldF9pdGVyXykpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc2V0X2l0ZXJfKGEpCiAgICAgICAgdGhpcy4kb2JqID0gYQogICAgICAgIHRoaXMudHAkaXRlciA9IHRoaXMKICAgICAgICB2YXIgZCA9IFtdCiAgICAgICAgdmFyIGUgPSBhLnYuYnVja2V0cwogICAgICAgIGZvciAoYiBpbiBlKQogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLmhhc093blByb3BlcnR5KGIpICYmCiAgICAgICAgICAgIChjID0gZVtiXSkgJiYKICAgICAgICAgICAgdm9pZCAwICE9PSBjLiRoYXNoICYmCiAgICAgICAgICAgIHZvaWQgMCAhPT0gYy5pdGVtcwogICAgICAgICAgKQogICAgICAgICAgICBmb3IgKGEgPSAwOyBhIDwgYy5pdGVtcy5sZW5ndGg7IGErKykgZC5wdXNoKGMuaXRlbXNbYV0ubGhzKQogICAgICAgIHRoaXMuJGluZGV4ID0gMAogICAgICAgIHRoaXMuJGtleXMgPSBkCiAgICAgICAgdGhpcy50cCRpdGVybmV4dCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICghKHRoaXMuJGluZGV4ID49IHRoaXMuJGtleXMubGVuZ3RoKSkKICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGtleXNbdGhpcy4kaW5kZXgrK10KICAgICAgICB9CiAgICAgICAgdGhpcy4kciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoInNldGl0ZXJhdG9yIikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJzZXRpdGVyYXRvciIsCiAgICAgICAgU2suYnVpbHRpbi5zZXRfaXRlcl8sCiAgICAgICAgU2suYnVpbHRpbi5vYmplY3QsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5zZXRfaXRlcl8ucHJvdG90eXBlLl9fY2xhc3NfXyA9IFNrLmJ1aWx0aW4uc2V0X2l0ZXJfCiAgICAgIFNrLmJ1aWx0aW4uc2V0X2l0ZXJfLnByb3RvdHlwZS5fX2l0ZXJfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKAogICAgICAgIGEsCiAgICAgICkgewogICAgICAgIFNrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oIl9faXRlcl9fIiwgYXJndW1lbnRzLmxlbmd0aCwgMCwgMCwgITAsICExKQogICAgICAgIHJldHVybiBhCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uc2V0X2l0ZXJfLnByb3RvdHlwZS5uZXh0JCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgYSA9IGEudHAkaXRlcm5leHQoKQogICAgICAgIGlmICh2b2lkIDAgPT09IGEpIHRocm93IG5ldyBTay5idWlsdGluLlN0b3BJdGVyYXRpb24oKQogICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgIH0sCiAgICBmdW5jdGlvbiAobSwgcCkgewogICAgICBtID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKAogICAgICAgICAgInByaW50IiwKICAgICAgICAgIGFyZ3VtZW50cy5sZW5ndGgsCiAgICAgICAgICAwLAogICAgICAgICAgSW5maW5pdHksCiAgICAgICAgICAhMCwKICAgICAgICAgICExLAogICAgICAgICkKICAgICAgICB2YXIgYiA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSksCiAgICAgICAgICBjID0gbmV3IFNrLmJ1aWx0aW5zLmRpY3QoYSkKICAgICAgICBTay5mZmkucmVtYXBUb0pzKGMpCiAgICAgICAgdmFyIGQgPSB7IHNlcDogIiAiLCBlbmQ6ICJcbiIsIGZpbGU6IG51bGwgfQogICAgICAgIHZhciBlID0gYy5tcCRsb29rdXAobmV3IFNrLmJ1aWx0aW4uc3RyKCJzZXAiKSkKICAgICAgICBpZiAodm9pZCAwICE9PSBlKSB7CiAgICAgICAgICB2YXIgZiA9IFNrLmJ1aWx0aW4uY2hlY2tOb25lKGUpCiAgICAgICAgICBpZiAoU2suYnVpbHRpbi5jaGVja1N0cmluZyhlKSB8fCBmKQogICAgICAgICAgICBkLnNlcCA9IGYgPyBkLnNlcCA6IFNrLmZmaS5yZW1hcFRvSnMoZSkKICAgICAgICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICJzZXAgbXVzdCBiZSBOb25lIG9yIGEgc3RyaW5nLCBub3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGUpLAogICAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIGUgPSBjLm1wJGxvb2t1cChuZXcgU2suYnVpbHRpbi5zdHIoImVuZCIpKQogICAgICAgIGlmICh2b2lkIDAgIT09IGUpCiAgICAgICAgICBpZiAoKChmID0gU2suYnVpbHRpbi5jaGVja05vbmUoZSkpLCBTay5idWlsdGluLmNoZWNrU3RyaW5nKGUpIHx8IGYpKQogICAgICAgICAgICBkLmVuZCA9IGYgPyBkLmVuZCA6IFNrLmZmaS5yZW1hcFRvSnMoZSkKICAgICAgICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICJlbmQgbXVzdCBiZSBOb25lIG9yIGEgc3RyaW5nLCBub3QgIiArIFNrLmFic3RyLnR5cGVOYW1lKGUpLAogICAgICAgICAgICApCiAgICAgICAgZSA9IGMubXAkbG9va3VwKG5ldyBTay5idWlsdGluLnN0cigiZmlsZSIpKQogICAgICAgIGlmICh2b2lkIDAgIT09IGUpCiAgICAgICAgICBpZiAoKGYgPSBTay5idWlsdGluLmNoZWNrTm9uZShlKSkgfHwgdm9pZCAwICE9PSBlLnRwJGdldGF0dHIoIndyaXRlIikpCiAgICAgICAgICAgIGQuZmlsZSA9IGYgPyBkLmZpbGUgOiBlCiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yKAogICAgICAgICAgICAgICInIiArIFNrLmFic3RyLnR5cGVOYW1lKGUpICsgIicgb2JqZWN0IGhhcyBubyBhdHRyaWJ1dGUgJ3dyaXRlJyIsCiAgICAgICAgICAgICkKICAgICAgICB2YXIgZyA9ICIiCiAgICAgICAgZm9yIChjID0gMDsgYyA8IGIubGVuZ3RoOyBjKyspCiAgICAgICAgICAoZyArPSBuZXcgU2suYnVpbHRpbi5zdHIoYltjXSkudiksIChnICs9IGQuc2VwKQogICAgICAgIDAgPCBiLmxlbmd0aCAmJgogICAgICAgICAgMCA8IGQuc2VwLmxlbmd0aCAmJgogICAgICAgICAgKGcgPSBnLnN1YnN0cmluZygwLCBnLmxlbmd0aCAtIGQuc2VwLmxlbmd0aCkpCiAgICAgICAgZyArPSBkLmVuZAogICAgICAgIGlmIChudWxsICE9PSBkLmZpbGUpCiAgICAgICAgICBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoZC5maWxlLndyaXRlLCBbCiAgICAgICAgICAgIGQuZmlsZSwKICAgICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uc3RyKGcpLAogICAgICAgICAgXSkKICAgICAgICBlbHNlCiAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuY2hhaW4oU2suaW1wb3J0TW9kdWxlKCJzeXMiLCAhMSwgITApLCBmdW5jdGlvbiAoCiAgICAgICAgICAgIGEsCiAgICAgICAgICApIHsKICAgICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmFwcGx5KAogICAgICAgICAgICAgIGEuJGQuc3Rkb3V0LndyaXRlLAogICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgICB2b2lkIDAsCiAgICAgICAgICAgICAgdm9pZCAwLAogICAgICAgICAgICAgIFthLiRkLnN0ZG91dCwgbmV3IFNrLmJ1aWx0aW4uc3RyKGcpXSwKICAgICAgICAgICAgKQogICAgICAgICAgfSkKICAgICAgfQogICAgICBtLmNvX2t3YXJncyA9ICEwCiAgICAgIFNrLmJ1aWx0aW4ucHJpbnQgPSBuZXcgU2suYnVpbHRpbi5mdW5jKG0pCiAgICAgIFNrLmJ1aWx0aW4ucHJpbnQuX19kb2NfXyA9IG5ldyBTay5idWlsdGluLnN0cigKICAgICAgICAicHJpbnQodmFsdWUsIC4uLiwgc2VwPScgJywgZW5kPSdcXG4nLCBmaWxlPXN5cy5zdGRvdXQsIGZsdXNoPUZhbHNlKVxuXG5QcmludHMgdGhlIHZhbHVlcyB0byBhIHN0cmVhbSwgb3IgdG8gc3lzLnN0ZG91dCBieSBkZWZhdWx0LlxuT3B0aW9uYWwga2V5d29yZCBhcmd1bWVudHM6XG5maWxlOiAgYSBmaWxlLWxpa2Ugb2JqZWN0IChzdHJlYW0pOyBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBzeXMuc3Rkb3V0Llxuc2VwOiAgIHN0cmluZyBpbnNlcnRlZCBiZXR3ZWVuIHZhbHVlcywgZGVmYXVsdCBhIHNwYWNlLlxuZW5kOiAgIHN0cmluZyBhcHBlbmRlZCBhZnRlciB0aGUgbGFzdCB2YWx1ZSwgZGVmYXVsdCBhIG5ld2xpbmUuXG5mbHVzaDogd2hldGhlciB0byBmb3JjaWJseSBmbHVzaCB0aGUgc3RyZWFtLiIsCiAgICAgICkKICAgIH0sCiAgICBmdW5jdGlvbiAobSwgcCkgewogICAgICBTay5idWlsdGluLm1vZHVsZSA9IGZ1bmN0aW9uICgpIHt9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5tb2R1bGUiLCBTay5idWlsdGluLm1vZHVsZSkKICAgICAgU2suYnVpbHRpbi5tb2R1bGUucHJvdG90eXBlLm9iJHR5cGUgPSBTay5idWlsdGluLnR5cGUubWFrZUludG9UeXBlT2JqKAogICAgICAgICJtb2R1bGUiLAogICAgICAgIFNrLmJ1aWx0aW4ubW9kdWxlLAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4ubW9kdWxlLnByb3RvdHlwZS50cCRnZXRhdHRyID0KICAgICAgICBTay5idWlsdGluLm9iamVjdC5wcm90b3R5cGUuR2VuZXJpY0dldEF0dHIKICAgICAgU2suYnVpbHRpbi5tb2R1bGUucHJvdG90eXBlLnRwJHNldGF0dHIgPQogICAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LnByb3RvdHlwZS5HZW5lcmljU2V0QXR0cgogICAgICBTay5idWlsdGluLm1vZHVsZS5wcm90b3R5cGUudHAkbmFtZSA9ICJtb2R1bGUiCiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHApIHsKICAgICAgU2suYnVpbHRpbi5zdHJ1Y3RzZXFfdHlwZXMgPSB7fQogICAgICBTay5idWlsdGluLm1ha2Vfc3RydWN0c2VxID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsKICAgICAgICB2YXIgZSA9IGEgKyAiLiIgKyBiLAogICAgICAgICAgZiA9IFtdCiAgICAgICAgYSA9IFtdCiAgICAgICAgZm9yICh2YXIgZyBpbiBjKSBmLnB1c2goZyksIGEucHVzaChjW2ddKQogICAgICAgIGMgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbihlLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAxKQogICAgICAgICAgdmFyIGIKICAgICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLnN0cnVjdHNlcV90eXBlc1tlXSkpIHsKICAgICAgICAgICAgdmFyIGMgPSBPYmplY3QuY3JlYXRlKFNrLmJ1aWx0aW4uc3RydWN0c2VxX3R5cGVzW2VdLnByb3RvdHlwZSkKICAgICAgICAgICAgYy5jb25zdHJ1Y3Rvci5hcHBseShjLCBhcmd1bWVudHMpCiAgICAgICAgICAgIHJldHVybiBjCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShhKSkgdmFyIGQgPSBhCiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgZCA9IFtdCiAgICAgICAgICAgIGMgPSBTay5hYnN0ci5pdGVyKGEpCiAgICAgICAgICAgIGZvciAoYiA9IGMudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBiOyBiID0gYy50cCRpdGVybmV4dCgpKQogICAgICAgICAgICAgIGQucHVzaChiKQogICAgICAgICAgICBpZiAoZC5sZW5ndGggIT0gZi5sZW5ndGgpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICAgZSArCiAgICAgICAgICAgICAgICAgICIoKSB0YWtlcyBhICIgKwogICAgICAgICAgICAgICAgICBmLmxlbmd0aCArCiAgICAgICAgICAgICAgICAgICItc2VxdWVuY2UgKCIgKwogICAgICAgICAgICAgICAgICBkLmxlbmd0aCArCiAgICAgICAgICAgICAgICAgICItc2VxdWVuY2UgZ2l2ZW4pIiwKICAgICAgICAgICAgICApCiAgICAgICAgICB9CiAgICAgICAgICBTay5idWlsdGluLnR1cGxlLmNhbGwodGhpcywgZCkKICAgICAgICAgIHRoaXMuX19jbGFzc19fID0gU2suYnVpbHRpbi5zdHJ1Y3RzZXFfdHlwZXNbZV0KICAgICAgICB9CiAgICAgICAgU2suYnVpbHRpbi5zdHJ1Y3RzZXFfdHlwZXNbZV0gPSBjCiAgICAgICAgU2suYWJzdHIuaW5oZXJpdHMoYywgU2suYnVpbHRpbi50dXBsZSkKICAgICAgICBkICYmIChjLnByb3RvdHlwZS5fX2RvY19fID0gZCkKICAgICAgICBjLnByb3RvdHlwZS50cCRuYW1lID0gZQogICAgICAgIGMucHJvdG90eXBlLm9iJHR5cGUgPSBTay5idWlsdGluLnR5cGUubWFrZUludG9UeXBlT2JqKAogICAgICAgICAgZSwKICAgICAgICAgIFNrLmJ1aWx0aW4uc3RydWN0c2VxX3R5cGVzW2VdLAogICAgICAgICkKICAgICAgICBjLnByb3RvdHlwZS5vYiR0eXBlLiRkID0gbmV3IFNrLmJ1aWx0aW4uZGljdChbXSkKICAgICAgICBjLnByb3RvdHlwZS5vYiR0eXBlLiRkLm1wJGFzc19zdWJzY3JpcHQoCiAgICAgICAgICBTay5idWlsdGluLnR5cGUuYmFzZXNTdHJfLAogICAgICAgICAgbmV3IFNrLmJ1aWx0aW4udHVwbGUoW1NrLmJ1aWx0aW4udHVwbGVdKSwKICAgICAgICApCiAgICAgICAgYy5wcm90b3R5cGUuX19nZXRpdGVtX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICByZXR1cm4gU2suYnVpbHRpbi50dXBsZS5wcm90b3R5cGUubXAkc3Vic2NyaXB0LmNhbGwoYSwgYikKICAgICAgICB9KQogICAgICAgIGMucHJvdG90eXBlLl9fcmVkdWNlX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5FeGNlcHRpb24oIl9fcmVkdWNlX18gaXMgbm90IGltcGxlbWVudGVkIikKICAgICAgICB9KQogICAgICAgIGMucHJvdG90eXBlLiRyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIGEKICAgICAgICAgIGlmICgwID09PSB0aGlzLnYubGVuZ3RoKSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGUgKyAiKCkiKQogICAgICAgICAgdmFyIGIgPSBbXQogICAgICAgICAgZm9yIChhID0gMDsgYSA8IHRoaXMudi5sZW5ndGg7ICsrYSkKICAgICAgICAgICAgYlthXSA9IGZbYV0gKyAiPSIgKyBTay5taXNjZXZhbC5vYmplY3RSZXByKHRoaXMudlthXSkudgogICAgICAgICAgYSA9IGIuam9pbigiLCAiKQogICAgICAgICAgMSA9PT0gdGhpcy52Lmxlbmd0aCAmJiAoYSArPSAiLCIpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGUgKyAiKCIgKyBhICsgIikiKQogICAgICAgIH0KICAgICAgICBjLnByb3RvdHlwZS50cCRzZXRhdHRyID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLkF0dHJpYnV0ZUVycm9yKCJyZWFkb25seSBwcm9wZXJ0eSIpCiAgICAgICAgfQogICAgICAgIGMucHJvdG90eXBlLnRwJGdldGF0dHIgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgdmFyIGIgPSBhLiRqc3N0cigpCiAgICAgICAgICBiID0gZi5pbmRleE9mKGIpCiAgICAgICAgICByZXR1cm4gMCA8PSBiCiAgICAgICAgICAgID8gdGhpcy52W2JdCiAgICAgICAgICAgIDogU2suYnVpbHRpbi5vYmplY3QucHJvdG90eXBlLkdlbmVyaWNHZXRBdHRyKGEpCiAgICAgICAgfQogICAgICAgIHJldHVybiBjCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLm1ha2Vfc3RydWN0c2VxIiwgU2suYnVpbHRpbi5tYWtlX3N0cnVjdHNlcSkKICAgIH0sCiAgICBmdW5jdGlvbiAobSwgcCkgewogICAgICBTay5idWlsdGluLmdlbmVyYXRvciA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgdmFyIGYKICAgICAgICBpZiAoYSkgewogICAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZ2VuZXJhdG9yKSkKICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLmdlbmVyYXRvcihhLCBiLCBjLCBkLCBlKQogICAgICAgICAgdGhpcy5mdW5jX2NvZGUgPSBhCiAgICAgICAgICB0aGlzLmZ1bmNfZ2xvYmFscyA9IGIgfHwgbnVsbAogICAgICAgICAgdGhpcy5naSRydW5uaW5nID0gITEKICAgICAgICAgIHRoaXMuZ2kkcmVzdW1lYXQgPSAwCiAgICAgICAgICB0aGlzLmdpJHNlbnR2YWx1ZSA9IHZvaWQgMAogICAgICAgICAgdGhpcy5naSRsb2NhbHMgPSB7fQogICAgICAgICAgdGhpcy5naSRjZWxscyA9IHt9CiAgICAgICAgICBpZiAoMCA8IGMubGVuZ3RoKQogICAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYS5jb192YXJuYW1lcy5sZW5ndGg7ICsrYikKICAgICAgICAgICAgICB0aGlzLmdpJGxvY2Fsc1thLmNvX3Zhcm5hbWVzW2JdXSA9IGNbYl0KICAgICAgICAgIGlmICh2b2lkIDAgIT09IGUpIGZvciAoZiBpbiBlKSBkW2ZdID0gZVtmXQogICAgICAgICAgdGhpcy5mdW5jX2Nsb3N1cmUgPSBkCiAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgIH0KICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uZ2VuZXJhdG9yIiwgU2suYnVpbHRpbi5nZW5lcmF0b3IpCiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgImdlbmVyYXRvciIsCiAgICAgICAgU2suYnVpbHRpbi5nZW5lcmF0b3IsCiAgICAgICAgU2suYnVpbHRpbi5vYmplY3QsCiAgICAgICkKICAgICAgU2suYnVpbHRpbi5nZW5lcmF0b3IucHJvdG90eXBlLnRwJGl0ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5idWlsdGluLmdlbmVyYXRvci5wcm90b3R5cGUudHAkaXRlcm5leHQgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjID0gdGhpcwogICAgICAgIHRoaXMuZ2kkcnVubmluZyA9ICEwCiAgICAgICAgdm9pZCAwID09PSBiICYmIChiID0gbnVsbCkKICAgICAgICB0aGlzLmdpJHNlbnR2YWx1ZSA9IGIKICAgICAgICBiID0gW3RoaXNdCiAgICAgICAgdGhpcy5mdW5jX2Nsb3N1cmUgJiYgYi5wdXNoKHRoaXMuZnVuY19jbG9zdXJlKQogICAgICAgIHJldHVybiAoZnVuY3Rpb24gZihiKSB7CiAgICAgICAgICBpZiAoYiBpbnN0YW5jZW9mIFNrLm1pc2NldmFsLlN1c3BlbnNpb24pIHsKICAgICAgICAgICAgaWYgKGEpIHJldHVybiBuZXcgU2subWlzY2V2YWwuU3VzcGVuc2lvbihmLCBiKQogICAgICAgICAgICBiID0gU2subWlzY2V2YWwucmV0cnlPcHRpb25hbFN1c3BlbnNpb25PclRocm93KGIpCiAgICAgICAgICB9CiAgICAgICAgICBjLmdpJHJ1bm5pbmcgPSAhMQogICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQodm9pZCAwICE9PSBiKQogICAgICAgICAgaWYgKGIgIT09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCkKICAgICAgICAgICAgcmV0dXJuIChjLmdpJHJlc3VtZWF0ID0gYlswXSksIChiID0gYlsxXSkKICAgICAgICB9KSh0aGlzLmZ1bmNfY29kZS5hcHBseSh0aGlzLmZ1bmNfZ2xvYmFscywgYikpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5nZW5lcmF0b3IucHJvdG90eXBlLm5leHQkID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gYS50cCRpdGVybmV4dCghMCkKICAgICAgfQogICAgICBTay5idWlsdGluLmdlbmVyYXRvci5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigKICAgICAgICAgICI8Z2VuZXJhdG9yIG9iamVjdCAiICsgdGhpcy5mdW5jX2NvZGUuY29fbmFtZS52ICsgIj4iLAogICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLmdlbmVyYXRvci5wcm90b3R5cGUuc2VuZCA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKAogICAgICAgIGEsCiAgICAgICAgYiwKICAgICAgKSB7CiAgICAgICAgcmV0dXJuIGEudHAkaXRlcm5leHQoITAsIGIpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubWFrZUdlbmVyYXRvciA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIGMsCiAgICAgICAgICBkID0gbmV3IFNrLmJ1aWx0aW4uZ2VuZXJhdG9yKG51bGwsIG51bGwsIG51bGwpCiAgICAgICAgZC50cCRpdGVybmV4dCA9IGEKICAgICAgICBmb3IgKGMgaW4gYikgYi5oYXNPd25Qcm9wZXJ0eShjKSAmJiAoZFtjXSA9IGJbY10pCiAgICAgICAgcmV0dXJuIGQKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4ubWFrZUdlbmVyYXRvciIsIFNrLmJ1aWx0aW4ubWFrZUdlbmVyYXRvcikKICAgIH0sCiAgICBmdW5jdGlvbiAobSwgcCkgewogICAgICBTay5idWlsdGluLmZpbGUgPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIHZhciBkCiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmlsZSkpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZmlsZShhLCBiLCBjKQogICAgICAgIHRoaXMubW9kZSA9IGIKICAgICAgICB0aGlzLm5hbWUgPSBTay5mZmkucmVtYXBUb0pzKGEpCiAgICAgICAgdGhpcy5jbG9zZWQgPSAhMQogICAgICAgIGlmICgiL2Rldi9zdGRvdXQiID09PSB0aGlzLm5hbWUpCiAgICAgICAgICAodGhpcy5kYXRhJCA9IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCksICh0aGlzLmZpbGVubyA9IDEpCiAgICAgICAgZWxzZSBpZiAoIi9kZXYvc3RkaW4iID09PSB0aGlzLm5hbWUpIHRoaXMuZmlsZW5vID0gMAogICAgICAgIGVsc2UgaWYgKCIvZGV2L3N0ZGVyciIgPT09IHRoaXMubmFtZSkgdGhpcy5maWxlbm8gPSAyCiAgICAgICAgZWxzZSB7CiAgICAgICAgICBpZiAoU2suaW5Ccm93c2VyKQogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgKCh0aGlzLmZpbGVubyA9IDEwKSwKICAgICAgICAgICAgICAoYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGEudikpLAogICAgICAgICAgICAgIG51bGwgPT0gYykKICAgICAgICAgICAgKQogICAgICAgICAgICAgIGlmICgidyIgPT0gYi52IHx8ICJhIiA9PSBiLnYpIHRoaXMuZGF0YSQgPSAiIgogICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLklPRXJyb3IoCiAgICAgICAgICAgICAgICAgICJbRXJybm8gMl0gTm8gc3VjaCBmaWxlIG9yIGRpcmVjdG9yeTogJyIgKyBhLnYgKyAiJyIsCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAidGV4dGFyZWEiID09IGMubm9kZU5hbWUudG9Mb3dlckNhc2UoKQogICAgICAgICAgICAgICAgPyAodGhpcy5kYXRhJCA9IGMudmFsdWUpCiAgICAgICAgICAgICAgICA6ICh0aGlzLmRhdGEkID0gYy50ZXh0Q29udGVudCkKICAgICAgICAgIGVsc2UgKHRoaXMuZmlsZW5vID0gMTEpLCAodGhpcy5kYXRhJCA9IFNrLnJlYWQoYS52KSkKICAgICAgICAgIHRoaXMubGluZUxpc3QgPSB0aGlzLmRhdGEkLnNwbGl0KCJcbiIpCiAgICAgICAgICB0aGlzLmxpbmVMaXN0ID0gdGhpcy5saW5lTGlzdC5zbGljZSgwLCAtMSkKICAgICAgICAgIGZvciAoZCBpbiB0aGlzLmxpbmVMaXN0KSB0aGlzLmxpbmVMaXN0W2RdICs9ICJcbiIKICAgICAgICAgIHRoaXMuY3VycmVudExpbmUgPSAwCiAgICAgICAgfQogICAgICAgIHRoaXMucG9zJCA9IDAKICAgICAgICB0aGlzLl9fY2xhc3NfXyA9IFNrLmJ1aWx0aW4uZmlsZQogICAgICAgIFNrLmZpbGVvcGVuICYmIDEwIDw9IHRoaXMuZmlsZW5vICYmIFNrLmZpbGVvcGVuKHRoaXMpCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKCJmaWxlIiwgU2suYnVpbHRpbi5maWxlLCBTay5idWlsdGluLm9iamVjdCkKICAgICAgU2suYnVpbHRpbi5maWxlLnByb3RvdHlwZS4kciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICAgIjwiICsKICAgICAgICAgICAgKHRoaXMuY2xvc2VkID8gImNsb3NlZCIgOiAib3BlbiIpICsKICAgICAgICAgICAgImZpbGUgJyIgKwogICAgICAgICAgICB0aGlzLm5hbWUgKwogICAgICAgICAgICAiJywgbW9kZSAnIiArCiAgICAgICAgICAgIFNrLmZmaS5yZW1hcFRvSnModGhpcy5tb2RlKSArCiAgICAgICAgICAgICInPiIsCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmlsZS5wcm90b3R5cGUuX19lbnRlcl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBhCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZmlsZS5wcm90b3R5cGUuX19leGl0X18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShTay5idWlsdGluLmZpbGUucHJvdG90eXBlLmNsb3NlLCBbYV0pCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZmlsZS5wcm90b3R5cGUudHAkaXRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgYSA9IHsKICAgICAgICAgIHRwJGl0ZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgIH0sCiAgICAgICAgICAkb2JqOiB0aGlzLAogICAgICAgICAgJGluZGV4OiB0aGlzLmN1cnJlbnRMaW5lLAogICAgICAgICAgJGxpbmVzOiB0aGlzLmxpbmVMaXN0LAogICAgICAgICAgdHAkaXRlcm5leHQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKCEoYS4kaW5kZXggPj0gYS4kbGluZXMubGVuZ3RoKSkKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGEuJGxpbmVzW2EuJGluZGV4KytdKQogICAgICAgICAgfSwKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgICBTay5idWlsdGluLmZpbGUucHJvdG90eXBlLmNsb3NlID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIGEuY2xvc2VkID0gITAKICAgICAgICByZXR1cm4gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZmlsZS5wcm90b3R5cGUuZmx1c2ggPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7fSkKICAgICAgU2suYnVpbHRpbi5maWxlLnByb3RvdHlwZS5maWxlbm8gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZmlsZW5vCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZmlsZS5wcm90b3R5cGUuaXNhdHR5ID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiAhMQogICAgICB9KQogICAgICBTay5idWlsdGluLmZpbGUucHJvdG90eXBlLnJlYWQgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIGMgPSBhLmRhdGEkLmxlbmd0aAogICAgICAgIGlmIChhLmNsb3NlZCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoIkkvTyBvcGVyYXRpb24gb24gY2xvc2VkIGZpbGUiKQogICAgICAgIHZhciBkID0gdm9pZCAwID09PSBiID8gYyA6IFNrLmZmaS5yZW1hcFRvSnMoYikKICAgICAgICBkID0gbmV3IFNrLmJ1aWx0aW4uc3RyKGEuZGF0YSQuc3Vic3RyKGEucG9zJCwgZCkpCiAgICAgICAgYS5wb3MkID0gdm9pZCAwID09PSBiID8gYyA6IGEucG9zJCArIFNrLmZmaS5yZW1hcFRvSnMoYikKICAgICAgICBhLnBvcyQgPj0gYyAmJiAoYS5wb3MkID0gYykKICAgICAgICByZXR1cm4gZAogICAgICB9KQogICAgICBTay5idWlsdGluLmZpbGUuJHJlYWRsaW5lID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICBpZiAoMCA9PT0gYS5maWxlbm8pIHsKICAgICAgICAgIGEgPSBTay5mZmkucmVtYXBUb0pzKGMpCiAgICAgICAgICBhID0gU2suaW5wdXRmdW4oYSA/IGEgOiAiIikKICAgICAgICAgIGlmIChhIGluc3RhbmNlb2YgUHJvbWlzZSkgewogICAgICAgICAgICB2YXIgZCA9IG5ldyBTay5taXNjZXZhbC5TdXNwZW5zaW9uKCkKICAgICAgICAgICAgZC5yZXN1bWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgaWYgKGQuZGF0YS5lcnJvcikgdGhyb3cgZC5kYXRhLmVycm9yCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cihkLmRhdGEucmVzdWx0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGQuZGF0YSA9IHsgdHlwZTogIlNrLnByb21pc2UiLCBwcm9taXNlOiBhIH0KICAgICAgICAgICAgcmV0dXJuIGQKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoYSkKICAgICAgICB9CiAgICAgICAgYiA9ICIiCiAgICAgICAgYS5jdXJyZW50TGluZSA8IGEubGluZUxpc3QubGVuZ3RoICYmCiAgICAgICAgICAoKGIgPSBhLmxpbmVMaXN0W2EuY3VycmVudExpbmVdKSwgYS5jdXJyZW50TGluZSsrKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoYikKICAgICAgfQogICAgICBTay5idWlsdGluLmZpbGUucHJvdG90eXBlLnJlYWRsaW5lID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBTay5idWlsdGluLmZpbGUuJHJlYWRsaW5lKGEsIGIsIHZvaWQgMCkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5maWxlLnByb3RvdHlwZS5yZWFkbGluZXMgPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICAgIGIsCiAgICAgICkgewogICAgICAgIGlmICgwID09PSBhLmZpbGVubykKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yKAogICAgICAgICAgICAicmVhZGxpbmVzIGlucyd0IGltcGxlbWVudGVkIGJlY2F1c2UgdGhlIHdlYiBkb2Vzbid0IHN1cHBvcnQgQ3RybCtEIiwKICAgICAgICAgICkKICAgICAgICB2YXIgYyA9IFtdCiAgICAgICAgZm9yIChiID0gYS5jdXJyZW50TGluZTsgYiA8IGEubGluZUxpc3QubGVuZ3RoOyBiKyspCiAgICAgICAgICBjLnB1c2gobmV3IFNrLmJ1aWx0aW4uc3RyKGEubGluZUxpc3RbYl0pKQogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5saXN0KGMpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uZmlsZS5wcm90b3R5cGUuc2VlayA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICBiID0gU2suZmZpLnJlbWFwVG9KcyhiKQogICAgICAgIHZvaWQgMCA9PT0gYyAmJiAoYyA9IDApCiAgICAgICAgMCA9PT0gYwogICAgICAgICAgPyAoYS5wb3MkID0gYikKICAgICAgICAgIDogMSA9PSBjCiAgICAgICAgICA/IChhLnBvcyQgPSBhLmRhdGEkLmxlbmd0aCArIGIpCiAgICAgICAgICA6IDIgPT0gYyAmJiAoYS5wb3MkID0gYS5kYXRhJC5sZW5ndGggKyBiKQogICAgICAgIHJldHVybiBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5maWxlLnByb3RvdHlwZS50ZWxsID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBTay5mZmkucmVtYXBUb1B5KGEucG9zJCkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5maWxlLnByb3RvdHlwZS50cnVuY2F0ZSA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBTay5hc3NlcnRzLmZhaWwoKQogICAgICB9KQogICAgICBTay5idWlsdGluLmZpbGUucHJvdG90eXBlLndyaXRlID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjID0gU2suZmZpLnJlbWFwVG9KcyhhLm1vZGUpCiAgICAgICAgaWYgKCJ3IiA9PT0gYyB8fCAid2IiID09PSBjIHx8ICJhIiA9PT0gYyB8fCAiYWIiID09PSBjKQogICAgICAgICAgaWYgKFNrLmZpbGV3cml0ZSkgewogICAgICAgICAgICBpZiAoYS5jbG9zZWQpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigiSS9PIG9wZXJhdGlvbiBvbiBjbG9zZWQgZmlsZSIpCiAgICAgICAgICAgIDEgPT09IGEuZmlsZW5vID8gU2sub3V0cHV0KFNrLmZmaS5yZW1hcFRvSnMoYikpIDogU2suZmlsZXdyaXRlKGEsIGIpCiAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgMSA9PT0gYS5maWxlbm8gPyBTay5vdXRwdXQoU2suZmZpLnJlbWFwVG9KcyhiKSkgOiBTay5hc3NlcnRzLmZhaWwoKQogICAgICAgIGVsc2UgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uSU9FcnJvcigiRmlsZSBub3Qgb3BlbiBmb3Igd3JpdGluZyIpCiAgICAgIH0pCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5maWxlIiwgU2suYnVpbHRpbi5maWxlKQogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwKSB7CiAgICAgIFNrLmZmaSA9IFNrLmZmaSB8fCB7fQogICAgICBTay5mZmkucmVtYXBUb1B5ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIGlmIChudWxsID09PSBhIHx8ICJ1bmRlZmluZWQiID09PSB0eXBlb2YgYSkgcmV0dXJuIFNrLmJ1aWx0aW4ubm9uZS5ub25lJAogICAgICAgIGlmIChhLm9iJHR5cGUpIHJldHVybiBhCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5taXNjZXZhbC5TdXNwZW5zaW9uKSByZXR1cm4gYQogICAgICAgIGlmICgiW29iamVjdCBBcnJheV0iID09PSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYSkpIHsKICAgICAgICAgIHZhciBjID0gW10KICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCBhLmxlbmd0aDsgKytiKSBjLnB1c2goU2suZmZpLnJlbWFwVG9QeShhW2JdKSkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5saXN0KGMpCiAgICAgICAgfQogICAgICAgIGlmICgib2JqZWN0IiA9PT0gdHlwZW9mIGEpIHsKICAgICAgICAgIGMgPSBbXQogICAgICAgICAgZm9yIChiIGluIGEpCiAgICAgICAgICAgIGMucHVzaChTay5mZmkucmVtYXBUb1B5KGIpKSwgYy5wdXNoKFNrLmZmaS5yZW1hcFRvUHkoYVtiXSkpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZGljdChjKQogICAgICAgIH0KICAgICAgICBpZiAoInN0cmluZyIgPT09IHR5cGVvZiBhKSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGEpCiAgICAgICAgaWYgKCJudW1iZXIiID09PSB0eXBlb2YgYSkgcmV0dXJuIFNrLmJ1aWx0aW4uYXNzayQoYSkKICAgICAgICBpZiAoImJvb2xlYW4iID09PSB0eXBlb2YgYSkgcmV0dXJuIG5ldyBTay5idWlsdGluLmJvb2woYSkKICAgICAgICBpZiAoInVuZGVmaW5lZCIgPT09IHR5cGVvZiBhKSByZXR1cm4gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgICAgaWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBhKSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZnVuYyhhKQogICAgICAgIFNrLmFzc2VydHMuZmFpbCgidW5oYW5kbGVkIHJlbWFwIHR5cGUgIiArIHR5cGVvZiBhKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suZmZpLnJlbWFwVG9QeSIsIFNrLmZmaS5yZW1hcFRvUHkpCiAgICAgIFNrLmZmaS5yZW1hcFRvSnMgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmRpY3QpIHsKICAgICAgICAgIHZhciBjID0ge30KICAgICAgICAgIHZhciBkID0gYS50cCRpdGVyKCkKICAgICAgICAgIGZvciAoYiA9IGQudHAkaXRlcm5leHQoKTsgdm9pZCAwICE9PSBiOyBiID0gZC50cCRpdGVybmV4dCgpKSB7CiAgICAgICAgICAgIHZhciBlID0gYS5tcCRzdWJzY3JpcHQoYikKICAgICAgICAgICAgdm9pZCAwID09PSBlICYmIChlID0gbnVsbCkKICAgICAgICAgICAgYiA9IFNrLmZmaS5yZW1hcFRvSnMoYikKICAgICAgICAgICAgY1tiXSA9IFNrLmZmaS5yZW1hcFRvSnMoZSkKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBjCiAgICAgICAgfQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5saXN0IHx8IGEgaW5zdGFuY2VvZiBTay5idWlsdGluLnR1cGxlKSB7CiAgICAgICAgICBjID0gW10KICAgICAgICAgIGZvciAoZSA9IDA7IGUgPCBhLnYubGVuZ3RoOyArK2UpIGMucHVzaChTay5mZmkucmVtYXBUb0pzKGEudltlXSkpCiAgICAgICAgICByZXR1cm4gYwogICAgICAgIH0KICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uYm9vbCkgcmV0dXJuIGEudiA/ICEwIDogITEKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uaW50XykgcmV0dXJuIFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykgcmV0dXJuIFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmxuZykgcmV0dXJuIFNrLmJ1aWx0aW4uYXNudW0kKGEpCiAgICAgICAgaWYgKAogICAgICAgICAgIm51bWJlciIgPT09IHR5cGVvZiBhIHx8CiAgICAgICAgICAiYm9vbGVhbiIgPT09IHR5cGVvZiBhIHx8CiAgICAgICAgICAic3RyaW5nIiA9PT0gdHlwZW9mIGEKICAgICAgICApCiAgICAgICAgICByZXR1cm4gYQogICAgICAgIGlmICh2b2lkIDAgIT09IGEpIHJldHVybiBhLnYKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmZmaS5yZW1hcFRvSnMiLCBTay5mZmkucmVtYXBUb0pzKQogICAgICBTay5mZmkuY2FsbGJhY2sgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiB2b2lkIDAgPT09IGEKICAgICAgICAgID8gYQogICAgICAgICAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmFwcGx5KAogICAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCksCiAgICAgICAgICAgICAgKQogICAgICAgICAgICB9CiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5mZmkuY2FsbGJhY2siLCBTay5mZmkuY2FsbGJhY2spCiAgICAgIFNrLmZmaS5zdGR3cmFwID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBhID0gbmV3IGEoKQogICAgICAgIGEudiA9IGIKICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suZmZpLnN0ZHdyYXAiLCBTay5mZmkuc3Rkd3JhcCkKICAgICAgU2suZmZpLmJhc2ljd3JhcCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgaWYgKGEgaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8pIHJldHVybiBTay5idWlsdGluLmFzbnVtJChhKQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mbG9hdF8pIHJldHVybiBTay5idWlsdGluLmFzbnVtJChhKQogICAgICAgIGlmIChhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcpIHJldHVybiBTay5idWlsdGluLmFzbnVtJChhKQogICAgICAgIGlmICgibnVtYmVyIiA9PT0gdHlwZW9mIGEgfHwgImJvb2xlYW4iID09PSB0eXBlb2YgYSkgcmV0dXJuIGEKICAgICAgICBpZiAoInN0cmluZyIgPT09IHR5cGVvZiBhKSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGEpCiAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJ1bmV4cGVjdGVkIHR5cGUgZm9yIGJhc2ljd3JhcCIpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5mZmkuYmFzaWN3cmFwIiwgU2suZmZpLmJhc2ljd3JhcCkKICAgICAgU2suZmZpLnVud3JhcG8gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICh2b2lkIDAgIT09IGEpIHJldHVybiBhLnYKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmZmaS51bndyYXBvIiwgU2suZmZpLnVud3JhcG8pCiAgICAgIFNrLmZmaS51bndyYXBuID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gbnVsbCA9PT0gYSA/IG51bGwgOiBhLnYKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmZmaS51bndyYXBuIiwgU2suZmZpLnVud3JhcG4pCiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHApIHsKICAgICAgU2suYnVpbHRpbi5pdGVyYXRvciA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIGMKICAgICAgICBpZiAoYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZ2VuZXJhdG9yKSByZXR1cm4gYQogICAgICAgIGlmICgoYyA9IFNrLmFic3RyLmxvb2t1cFNwZWNpYWwoYSwgU2suYnVpbHRpbi5zdHIuJGl0ZXIpKSkKICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYywgW2FdKQogICAgICAgIHRoaXMuc2VudGluZWwgPSBiCiAgICAgICAgdGhpcy5mbGFnID0gITEKICAgICAgICB0aGlzLmlkeCA9IDAKICAgICAgICB0aGlzLm9iaiA9IGEKICAgICAgICB2b2lkIDAgPT09IGIKICAgICAgICAgID8gKCh0aGlzLmdldGl0ZW0gPSBTay5hYnN0ci5sb29rdXBTcGVjaWFsKAogICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgU2suYnVpbHRpbi5zdHIuJGdldGl0ZW0sCiAgICAgICAgICAgICkpLAogICAgICAgICAgICAodGhpcy4kciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKCI8aXRlcmF0b3Igb2JqZWN0PiIpCiAgICAgICAgICAgIH0pKQogICAgICAgICAgOiAoKHRoaXMuY2FsbCA9IFNrLmFic3RyLmxvb2t1cFNwZWNpYWwoYSwgU2suYnVpbHRpbi5zdHIuJGNhbGwpKSwKICAgICAgICAgICAgKHRoaXMuJHIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigiPGNhbGxhYmxlLWl0ZXJhdG9yIG9iamVjdD4iKQogICAgICAgICAgICB9KSkKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoCiAgICAgICAgIml0ZXJhdG9yIiwKICAgICAgICBTay5idWlsdGluLml0ZXJhdG9yLAogICAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uaXRlcmF0b3IucHJvdG90eXBlLl9fY2xhc3NfXyA9IFNrLmJ1aWx0aW4uaXRlcmF0b3IKICAgICAgU2suYnVpbHRpbi5pdGVyYXRvci5wcm90b3R5cGUuX19pdGVyX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uICgKICAgICAgICBhLAogICAgICApIHsKICAgICAgICByZXR1cm4gYS50cCRpdGVyKCkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5pdGVyYXRvci5wcm90b3R5cGUudHAkaXRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uaXRlcmF0b3IucHJvdG90eXBlLnRwJGl0ZXJuZXh0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiA9IHRoaXMKICAgICAgICBpZiAoITAgIT09IHRoaXMuZmxhZykgewogICAgICAgICAgaWYgKHRoaXMuZ2V0aXRlbSkgewogICAgICAgICAgICB2YXIgYyA9IFNrLm1pc2NldmFsLnRyeUNhdGNoKAogICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kQXJyYXkoYi5nZXRpdGVtLCBbCiAgICAgICAgICAgICAgICAgIGIub2JqLAogICAgICAgICAgICAgICAgICBTay5mZmkucmVtYXBUb1B5KGIuaWR4KyspLAogICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICEoCiAgICAgICAgICAgICAgICAgICAgYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uU3RvcEl0ZXJhdGlvbiB8fAogICAgICAgICAgICAgICAgICAgIGEgaW5zdGFuY2VvZiBTay5idWlsdGluLkluZGV4RXJyb3IKICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICB0aHJvdyBhCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4gYSA/IGMgOiBTay5taXNjZXZhbC5yZXRyeU9wdGlvbmFsU3VzcGVuc2lvbk9yVGhyb3coYykKICAgICAgICAgIH0KICAgICAgICAgIGMgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICBpZiAoU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGEsIGIuc2VudGluZWwsICJFcSIpKSBiLmZsYWcgPSAhMAogICAgICAgICAgICBlbHNlIHJldHVybiBhCiAgICAgICAgICB9CiAgICAgICAgICBjID0gdGhpcy5jYWxsCiAgICAgICAgICAgID8gU2subWlzY2V2YWwuY2hhaW4oCiAgICAgICAgICAgICAgICBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kQXJyYXkodGhpcy5jYWxsLCBbdGhpcy5vYmpdKSwKICAgICAgICAgICAgICAgIGMsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICA6IFNrLm1pc2NldmFsLmNoYWluKFNrLm1pc2NldmFsLmNhbGxzaW1PclN1c3BlbmRBcnJheSh0aGlzLm9iaiksIGMpCiAgICAgICAgICByZXR1cm4gYSA/IGMgOiBTay5taXNjZXZhbC5yZXRyeU9wdGlvbmFsU3VzcGVuc2lvbk9yVGhyb3coYykKICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5pdGVyYXRvci5wcm90b3R5cGUubmV4dCQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGEgPSBhLnRwJGl0ZXJuZXh0KCkKICAgICAgICBpZiAoIWEpIHRocm93IG5ldyBTay5idWlsdGluLlN0b3BJdGVyYXRpb24oKQogICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLml0ZXJhdG9yIiwgU2suYnVpbHRpbi5pdGVyYXRvcikKICAgIH0sCiAgICBmdW5jdGlvbiAobSwgcCkgewogICAgICBTay5idWlsdGluLmVudW1lcmF0ZSA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZW51bWVyYXRlKSkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5lbnVtZXJhdGUoYSwgYikKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJlbnVtZXJhdGUiLCBhcmd1bWVudHMubGVuZ3RoLCAxLCAyKQogICAgICAgIGlmICghU2suYnVpbHRpbi5jaGVja0l0ZXJhYmxlKGEpKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAiJyIgKyBTay5hYnN0ci50eXBlTmFtZShhKSArICInIG9iamVjdCBpcyBub3QgaXRlcmFibGUiLAogICAgICAgICAgKQogICAgICAgIGlmICh2b2lkIDAgIT09IGIpCiAgICAgICAgICBpZiAoU2subWlzY2V2YWwuaXNJbmRleChiKSkgYiA9IFNrLm1pc2NldmFsLmFzSW5kZXgoYikKICAgICAgICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKAogICAgICAgICAgICAgICInIiArCiAgICAgICAgICAgICAgICBTay5hYnN0ci50eXBlTmFtZShiKSArCiAgICAgICAgICAgICAgICAiJyBvYmplY3QgY2Fubm90IGJlIGludGVycHJldGVkIGFzIGFuIGluZGV4IiwKICAgICAgICAgICAgKQogICAgICAgIGVsc2UgYiA9IDAKICAgICAgICB2YXIgYyA9IGEudHAkaXRlcigpCiAgICAgICAgdGhpcy50cCRpdGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgICB9CiAgICAgICAgdGhpcy4kaW5kZXggPSBiCiAgICAgICAgdGhpcy50cCRpdGVybmV4dCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBhID0gYy50cCRpdGVybmV4dCgpCiAgICAgICAgICBpZiAodm9pZCAwICE9PSBhKSB7CiAgICAgICAgICAgIHZhciBiID0gbmV3IFNrLmJ1aWx0aW4uaW50Xyh0aGlzLiRpbmRleCsrKQogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4udHVwbGUoW2IsIGFdKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLl9fY2xhc3NfXyA9IFNrLmJ1aWx0aW4uZW51bWVyYXRlCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKAogICAgICAgICJlbnVtZXJhdGUiLAogICAgICAgIFNrLmJ1aWx0aW4uZW51bWVyYXRlLAogICAgICAgIFNrLmJ1aWx0aW4ub2JqZWN0LAogICAgICApCiAgICAgIFNrLmJ1aWx0aW4uZW51bWVyYXRlLnByb3RvdHlwZS5fX2l0ZXJfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKAogICAgICAgIGEsCiAgICAgICkgewogICAgICAgIHJldHVybiBhLnRwJGl0ZXIoKQogICAgICB9KQogICAgICBTay5idWlsdGluLmVudW1lcmF0ZS5wcm90b3R5cGUubmV4dCQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBhLnRwJGl0ZXJuZXh0KCkKICAgICAgfQogICAgICBTay5idWlsdGluLmVudW1lcmF0ZS5jb192YXJuYW1lcyA9IFsiaXRlcmFibGUiLCAic3RhcnQiXQogICAgICBTay5idWlsdGluLmVudW1lcmF0ZS5jb19hcmdjb3VudCA9IDIKICAgICAgU2suYnVpbHRpbi5lbnVtZXJhdGUuJGRlZmF1bHRzID0gW1NrLmJ1aWx0aW4ubm9uZS5ub25lJCwgMF0KICAgICAgU2suYnVpbHRpbi5lbnVtZXJhdGUuY29fbmFtZSA9IFNrLmJ1aWx0aW4uc3RyKCJlbnVtZXJhdGUiKQogICAgICBTay5idWlsdGluLmVudW1lcmF0ZS5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigiPGVudW1lcmF0ZSBvYmplY3Q+IikKICAgICAgfQogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4uZmlsdGVyXyA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIGMsIGQKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJmaWx0ZXJfIiwgYXJndW1lbnRzLmxlbmd0aCwgMiwgMikKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5maWx0ZXJfKSkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5maWx0ZXJfKGEsIGIpCiAgICAgICAgdmFyIGUgPSBTay5hYnN0ci5pdGVyKGIpCiAgICAgICAgdmFyIGYgPSBmdW5jdGlvbiAoYikgewogICAgICAgICAgYyA9IGEgPT09IFNrLmJ1aWx0aW4ubm9uZS5ub25lJCA/IGIgOiBTay5taXNjZXZhbC5jYWxsc2ltQXJyYXkoYSwgW2JdKQogICAgICAgICAgaWYgKFNrLm1pc2NldmFsLmlzVHJ1ZShjKSkgcmV0dXJuIGMKICAgICAgICB9CiAgICAgICAgdGhpcy50cCRpdGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgICB9CiAgICAgICAgdGhpcy50cCRpdGVybmV4dCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGQgPSBlLnRwJGl0ZXJuZXh0KCkKICAgICAgICAgIGlmICh2b2lkIDAgIT09IGQpIHsKICAgICAgICAgICAgZm9yIChjID0gZihkKTsgdm9pZCAwID09PSBjOyApIHsKICAgICAgICAgICAgICBkID0gZS50cCRpdGVybmV4dCgpCiAgICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gZCkgcmV0dXJuCiAgICAgICAgICAgICAgYyA9IGYoZCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZAogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLl9fY2xhc3NfXyA9IFNrLmJ1aWx0aW4uZmlsdGVyXwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgiZmlsdGVyIiwgU2suYnVpbHRpbi5maWx0ZXJfLCBTay5idWlsdGluLm9iamVjdCkKICAgICAgU2suYnVpbHRpbi5maWx0ZXJfLnByb3RvdHlwZS5fX2l0ZXJfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gYS50cCRpdGVyKCkKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5maWx0ZXJfLnByb3RvdHlwZS5uZXh0JCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEudHAkaXRlcm5leHQoKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uZmlsdGVyXy5wcm90b3R5cGUuJHIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnN0cigiPGZpbHRlciBvYmplY3Q+IikKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4uZmlsdGVyXyIsIFNrLmJ1aWx0aW4uZmlsdGVyXykKICAgIH0sCiAgICBmdW5jdGlvbiAobSwgcCkgewogICAgICBTay5idWlsdGluLnppcF8gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGEsIGIKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi56aXBfKSkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi56aXBfKC4uLmFyZ3VtZW50cykKICAgICAgICBpZiAoMCA9PT0gYXJndW1lbnRzLmxlbmd0aCkKICAgICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi56aXBfKG5ldyBTay5idWlsdGluLmxpc3QoW10pKQogICAgICAgIHZhciBjID0gW10KICAgICAgICBmb3IgKGEgPSAwOyBhIDwgYXJndW1lbnRzLmxlbmd0aDsgYSsrKQogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYy5wdXNoKFNrLmFic3RyLml0ZXIoYXJndW1lbnRzW2FdKSkKICAgICAgICAgIH0gY2F0Y2ggKGQpIHsKICAgICAgICAgICAgaWYgKGQgaW5zdGFuY2VvZiBTay5idWlsdGluLlR5cGVFcnJvcikKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICAgICAiemlwIGFyZ3VtZW50ICMiICsgKGEgKyAxKSArICIgbXVzdCBzdXBwb3J0IGl0ZXJhdGlvbiIsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICB0aHJvdyBkCiAgICAgICAgICB9CiAgICAgICAgdGhpcy50cCRpdGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgICB9CiAgICAgICAgdGhpcy50cCRpdGVybmV4dCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBkID0gW10KICAgICAgICAgIGZvciAoYSA9IDA7IGEgPCBjLmxlbmd0aDsgYSsrKSB7CiAgICAgICAgICAgIGIgPSBjW2FdLnRwJGl0ZXJuZXh0KCkKICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gYikgcmV0dXJuCiAgICAgICAgICAgIGQucHVzaChiKQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLnR1cGxlKGQpCiAgICAgICAgfQogICAgICAgIHRoaXMuX19jbGFzc19fID0gU2suYnVpbHRpbi56aXBfCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hYnN0ci5zZXRVcEluaGVyaXRhbmNlKCJ6aXAiLCBTay5idWlsdGluLnppcF8sIFNrLmJ1aWx0aW4ub2JqZWN0KQogICAgICBTay5idWlsdGluLnppcF8ucHJvdG90eXBlLl9faXRlcl9fID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBhLnRwJGl0ZXIoKQogICAgICB9KQogICAgICBTay5idWlsdGluLnppcF8ucHJvdG90eXBlLm5leHQkID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gYS50cCRpdGVybmV4dCgpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi56aXBfLnByb3RvdHlwZS4kciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKCI8emlwIG9iamVjdD4iKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi56aXBfIiwgU2suYnVpbHRpbi56aXBfKQogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4ubWFwXyA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIGMsIGQsIGUsIGYKICAgICAgICBTay5idWlsdGluLnB5Q2hlY2tBcmdzTGVuKCJtYXBfIiwgYXJndW1lbnRzLmxlbmd0aCwgMikKICAgICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgU2suYnVpbHRpbi5tYXBfKSkgewogICAgICAgICAgdmFyIGcgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuYXBwbHkoYXJndW1lbnRzKS5zbGljZSgxKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5idWlsdGluLm1hcF8oYSwgLi4uZykKICAgICAgICB9CiAgICAgICAgaWYgKDIgPCBhcmd1bWVudHMubGVuZ3RoKSB7CiAgICAgICAgICB2YXIgaCA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5hcHBseShhcmd1bWVudHMpLnNsaWNlKDEpCiAgICAgICAgICBmb3IgKGQgPSAwOyBkIDwgaC5sZW5ndGg7IGQrKykgaFtkXSA9IFNrLmFic3RyLml0ZXIoaFtkXSkKICAgICAgICAgIHZhciBrID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmID0gW10KICAgICAgICAgICAgZm9yIChkID0gMDsgZCA8IGgubGVuZ3RoOyBkKyspIHsKICAgICAgICAgICAgICBjID0gaFtkXS50cCRpdGVybmV4dCgpCiAgICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gYykgcmV0dXJuCiAgICAgICAgICAgICAgZi5wdXNoKGMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGYKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UKICAgICAgICAgIChiID0gU2suYWJzdHIuaXRlcihiKSksCiAgICAgICAgICAgIChrID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHJldHVybiBiLnRwJGl0ZXJuZXh0KCkKICAgICAgICAgICAgfSkKICAgICAgICB0aGlzLnRwJGl0ZXJuZXh0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgZSA9IGsoKQogICAgICAgICAgaWYgKHZvaWQgMCAhPT0gZSkgewogICAgICAgICAgICBpZiAoYSA9PT0gU2suYnVpbHRpbi5ub25lLm5vbmUkKQogICAgICAgICAgICAgIHJldHVybiBlIGluc3RhbmNlb2YgQXJyYXkgJiYgKGUgPSBuZXcgU2suYnVpbHRpbi50dXBsZShlKSksIGUKICAgICAgICAgICAgZSBpbnN0YW5jZW9mIEFycmF5IHx8IChlID0gW2VdKQogICAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuYXBwbHlPclN1c3BlbmQoYSwgdm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZSkKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy50cCRpdGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgICB9CiAgICAgICAgdGhpcy5fX2NsYXNzX18gPSBTay5idWlsdGluLm1hcF8KICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFic3RyLnNldFVwSW5oZXJpdGFuY2UoIm1hcCIsIFNrLmJ1aWx0aW4ubWFwXywgU2suYnVpbHRpbi5vYmplY3QpCiAgICAgIFNrLmJ1aWx0aW4ubWFwXy5wcm90b3R5cGUuX19pdGVyX18gPSBuZXcgU2suYnVpbHRpbi5mdW5jKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEudHAkaXRlcigpCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4ubWFwXy5wcm90b3R5cGUubmV4dCQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHJldHVybiBhLnRwJGl0ZXJuZXh0KCkKICAgICAgfQogICAgICBTay5idWlsdGluLm1hcF8ucHJvdG90eXBlLiRyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuZXcgU2suYnVpbHRpbi5zdHIoIjxtYXAgb2JqZWN0PiIpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGluLm1hcF8iLCBTay5idWlsdGluLm1hcF8pCiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHApIHsKICAgICAgdmFyIGEgPSB7CiAgICAgICAgVF9FTkRNQVJLRVI6IDAsCiAgICAgICAgVF9OQU1FOiAxLAogICAgICAgIFRfTlVNQkVSOiAyLAogICAgICAgIFRfU1RSSU5HOiAzLAogICAgICAgIFRfTkVXTElORTogNCwKICAgICAgICBUX0lOREVOVDogNSwKICAgICAgICBUX0RFREVOVDogNiwKICAgICAgICBUX0xQQVI6IDcsCiAgICAgICAgVF9SUEFSOiA4LAogICAgICAgIFRfTFNRQjogOSwKICAgICAgICBUX1JTUUI6IDEwLAogICAgICAgIFRfQ09MT046IDExLAogICAgICAgIFRfQ09NTUE6IDEyLAogICAgICAgIFRfU0VNSTogMTMsCiAgICAgICAgVF9QTFVTOiAxNCwKICAgICAgICBUX01JTlVTOiAxNSwKICAgICAgICBUX1NUQVI6IDE2LAogICAgICAgIFRfU0xBU0g6IDE3LAogICAgICAgIFRfVkJBUjogMTgsCiAgICAgICAgVF9BTVBFUjogMTksCiAgICAgICAgVF9MRVNTOiAyMCwKICAgICAgICBUX0dSRUFURVI6IDIxLAogICAgICAgIFRfRVFVQUw6IDIyLAogICAgICAgIFRfRE9UOiAyMywKICAgICAgICBUX1BFUkNFTlQ6IDI0LAogICAgICAgIFRfTEJSQUNFOiAyNSwKICAgICAgICBUX1JCUkFDRTogMjYsCiAgICAgICAgVF9FUUVRVUFMOiAyNywKICAgICAgICBUX05PVEVRVUFMOiAyOCwKICAgICAgICBUX0xFU1NFUVVBTDogMjksCiAgICAgICAgVF9HUkVBVEVSRVFVQUw6IDMwLAogICAgICAgIFRfVElMREU6IDMxLAogICAgICAgIFRfQ0lSQ1VNRkxFWDogMzIsCiAgICAgICAgVF9MRUZUU0hJRlQ6IDMzLAogICAgICAgIFRfUklHSFRTSElGVDogMzQsCiAgICAgICAgVF9ET1VCTEVTVEFSOiAzNSwKICAgICAgICBUX1BMVVNFUVVBTDogMzYsCiAgICAgICAgVF9NSU5FUVVBTDogMzcsCiAgICAgICAgVF9TVEFSRVFVQUw6IDM4LAogICAgICAgIFRfU0xBU0hFUVVBTDogMzksCiAgICAgICAgVF9QRVJDRU5URVFVQUw6IDQwLAogICAgICAgIFRfQU1QRVJFUVVBTDogNDEsCiAgICAgICAgVF9WQkFSRVFVQUw6IDQyLAogICAgICAgIFRfQ0lSQ1VNRkxFWEVRVUFMOiA0MywKICAgICAgICBUX0xFRlRTSElGVEVRVUFMOiA0NCwKICAgICAgICBUX1JJR0hUU0hJRlRFUVVBTDogNDUsCiAgICAgICAgVF9ET1VCTEVTVEFSRVFVQUw6IDQ2LAogICAgICAgIFRfRE9VQkxFU0xBU0g6IDQ3LAogICAgICAgIFRfRE9VQkxFU0xBU0hFUVVBTDogNDgsCiAgICAgICAgVF9BVDogNDksCiAgICAgICAgVF9BVEVRVUFMOiA1MCwKICAgICAgICBUX1JBUlJPVzogNTEsCiAgICAgICAgVF9FTExJUFNJUzogNTIsCiAgICAgICAgVF9PUDogNTMsCiAgICAgICAgVF9BV0FJVDogNTQsCiAgICAgICAgVF9BU1lOQzogNTUsCiAgICAgICAgVF9FUlJPUlRPS0VOOiA1NiwKICAgICAgICBUX05UX09GRlNFVDogMjU2LAogICAgICAgIFRfTl9UT0tFTlM6IDYwLAogICAgICAgIFRfQ09NTUVOVDogNTcsCiAgICAgICAgVF9OTDogNTgsCiAgICAgICAgVF9FTkNPRElORzogNTksCiAgICAgIH0KICAgICAgbSA9IHsKICAgICAgICAiIT0iOiBhLk5PVEVRVUFMLAogICAgICAgICIlIjogYS5QRVJDRU5ULAogICAgICAgICIlPSI6IGEuUEVSQ0VOVEVRVUFMLAogICAgICAgICImIjogYS5BTVBFUiwKICAgICAgICAiJj0iOiBhLkFNUEVSRVFVQUwsCiAgICAgICAgIigiOiBhLkxQQVIsCiAgICAgICAgIikiOiBhLlJQQVIsCiAgICAgICAgIioiOiBhLlNUQVIsCiAgICAgICAgIioqIjogYS5ET1VCTEVTVEFSLAogICAgICAgICIqKj0iOiBhLkRPVUJMRVNUQVJFUVVBTCwKICAgICAgICAiKj0iOiBhLlNUQVJFUVVBTCwKICAgICAgICAiKyI6IGEuUExVUywKICAgICAgICAiKz0iOiBhLlBMVVNFUVVBTCwKICAgICAgICAiLCI6IGEuQ09NTUEsCiAgICAgICAgIi0iOiBhLk1JTlVTLAogICAgICAgICItPSI6IGEuTUlORVFVQUwsCiAgICAgICAgIi0+IjogYS5SQVJST1csCiAgICAgICAgIi4iOiBhLkRPVCwKICAgICAgICAiLi4uIjogYS5FTExJUFNJUywKICAgICAgICAiLyI6IGEuU0xBU0gsCiAgICAgICAgIi8vIjogYS5ET1VCTEVTTEFTSCwKICAgICAgICAiLy89IjogYS5ET1VCTEVTTEFTSEVRVUFMLAogICAgICAgICIvPSI6IGEuU0xBU0hFUVVBTCwKICAgICAgICAiOiI6IGEuQ09MT04sCiAgICAgICAgIjo9IjogYS5DT0xPTkVRVUFMLAogICAgICAgICI7IjogYS5TRU1JLAogICAgICAgICI8IjogYS5MRVNTLAogICAgICAgICI8PCI6IGEuTEVGVFNISUZULAogICAgICAgICI8PD0iOiBhLkxFRlRTSElGVEVRVUFMLAogICAgICAgICI8PSI6IGEuTEVTU0VRVUFMLAogICAgICAgICI9IjogYS5FUVVBTCwKICAgICAgICAiPT0iOiBhLkVRRVFVQUwsCiAgICAgICAgIj4iOiBhLkdSRUFURVIsCiAgICAgICAgIj49IjogYS5HUkVBVEVSRVFVQUwsCiAgICAgICAgIj4+IjogYS5SSUdIVFNISUZULAogICAgICAgICI+Pj0iOiBhLlJJR0hUU0hJRlRFUVVBTCwKICAgICAgICAiQCI6IGEuQVQsCiAgICAgICAgIkA9IjogYS5BVEVRVUFMLAogICAgICAgICJbIjogYS5MU1FCLAogICAgICAgICJdIjogYS5SU1FCLAogICAgICAgICJeIjogYS5DSVJDVU1GTEVYLAogICAgICAgICJePSI6IGEuQ0lSQ1VNRkxFWEVRVUFMLAogICAgICAgICJ7IjogYS5MQlJBQ0UsCiAgICAgICAgInwiOiBhLlZCQVIsCiAgICAgICAgInw9IjogYS5WQkFSRVFVQUwsCiAgICAgICAgIn0iOiBhLlJCUkFDRSwKICAgICAgICAifiI6IGEuVElMREUsCiAgICAgIH0KICAgICAgdmFyIGIgPSB7fQogICAgICA7KGZ1bmN0aW9uICgpIHsKICAgICAgICBmb3IgKHZhciBjIGluIGEpIGJbYVtjXV0gPSBjCiAgICAgIH0pKCkKICAgICAgO1sidG9rX25hbWUiLCAiSVNURVJNSU5BTCIsICJJU05PTlRFUk1JTkFMIiwgIklTRU9GIl0uY29uY2F0KAogICAgICAgIE9iamVjdC5rZXlzKGIpLm1hcChmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGJbYV0KICAgICAgICB9KSwKICAgICAgKQogICAgICBTay50b2tlbiA9IHt9CiAgICAgIFNrLnRva2VuLnRva2VucyA9IGEKICAgICAgU2sudG9rZW4udG9rX25hbWUgPSBiCiAgICAgIFNrLnRva2VuLkVYQUNUX1RPS0VOX1RZUEVTID0gbQogICAgICBTay50b2tlbi5JU1RFUk1JTkFMID0gZnVuY3Rpb24gKGIpIHsKICAgICAgICByZXR1cm4gYiA8IGEuVF9OVF9PRkZTRVQKICAgICAgfQogICAgICBTay50b2tlbi5JU05PTlRFUk1JTkFMID0gZnVuY3Rpb24gKGIpIHsKICAgICAgICByZXR1cm4gYiA+PSBhLlRfTlRfT0ZGU0VUCiAgICAgIH0KICAgICAgU2sudG9rZW4uSVNFT0YgPSBmdW5jdGlvbiAoYikgewogICAgICAgIHJldHVybiBiID09IGEuVF9FTkRNQVJLRVIKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLnRva2VuIiwgU2sudG9rZW4pCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2sudG9rZW4udG9rZW5zIiwgU2sudG9rZW4udG9rZW5zKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLnRva2VuLnRva19uYW1lIiwgU2sudG9rZW4udG9rX25hbWUpCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2sudG9rZW4uRVhBQ1RfVE9LRU5fVFlQRVMiKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLnRva2VuLklTVEVSTUlOQUwiLCBTay50b2tlbi5JU1RFUk1JTkFMKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLnRva2VuLklTTk9OVEVSTUlOQUwiLCBTay50b2tlbi5JU05PTlRFUk1JTkFMKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLnRva2VuLklTRU9GIiwgU2sudG9rZW4uSVNFT0YpCiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHApIHsKICAgICAgZnVuY3Rpb24gYShhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgdGhpcy50eXBlID0gYQogICAgICAgIHRoaXMuc3RyaW5nID0gYgogICAgICAgIHRoaXMuc3RhcnQgPSBjCiAgICAgICAgdGhpcy5lbmQgPSBkCiAgICAgICAgdGhpcy5saW5lID0gZQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGIoYSkgewogICAgICAgIHJldHVybiAiKCIgKyBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpLmpvaW4oInwiKSArICIpIgogICAgICB9CiAgICAgIGZ1bmN0aW9uIGMoYSkgewogICAgICAgIHJldHVybiBiLmFwcGx5KG51bGwsIGFyZ3VtZW50cykgKyAiPyIKICAgICAgfQogICAgICBmdW5jdGlvbiBkKGEsIGIpIHsKICAgICAgICBmb3IgKHZhciBjID0gYS5sZW5ndGg7IGMtLTsgKSBpZiAoYVtjXSA9PT0gYikgcmV0dXJuICEwCiAgICAgICAgcmV0dXJuICExCiAgICAgIH0KICAgICAgZnVuY3Rpb24gZSgpIHsKICAgICAgICByZXR1cm4gIiBGUiBSRiBCciBCUiBGciByIEIgUiBiIGJSIGYgcmIgckIgRiBSZiBVIHJGIHUgUkIgYnIgZlIgZnIgcmYgUmIiLnNwbGl0KAogICAgICAgICAgIiAiLAogICAgICAgICkKICAgICAgfQogICAgICB2YXIgZiA9IFNrLnRva2VuLnRva2VucwogICAgICBjb25zdCBnID0gU2suYnVpbHRpbi5TeW50YXhFcnJvciwKICAgICAgICBoID0gU2suYnVpbHRpbi5TeW50YXhFcnJvcgogICAgICBhLnByb3RvdHlwZS5leGFjdF90eXBlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLnR5cGUgPT0gZi5UX09QICYmIHRoaXMuc3RyaW5nIGluIFNrLnRva2VuLkVYQUNUX1RPS0VOX1RZUEVTCiAgICAgICAgICA/IFNrLnRva2VuLkVYQUNUX1RPS0VOX1RZUEVTW3RoaXMuc3RyaW5nXQogICAgICAgICAgOiB0aGlzLnR5cGUKICAgICAgfQogICAgICB2YXIgayA9IC9bXFxeJC4qKz8oKVtcXXt9fF0vZywKICAgICAgICBsID0gUmVnRXhwKGsuc291cmNlKQogICAgICBjb25zdCByID0gKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgYSA9IGIoCiAgICAgICAgICAgICJbQS1aXSIsCiAgICAgICAgICAgICJbYS16XSIsCiAgICAgICAgICAgICJbXFx1ezEwQjk5fS1cXHV7MTBCOUN9XFx1ezExMkE5fVxcdXsxMTVEQ30tXFx1ezExNUREfVxcdTAzNEZcXHUxMTVGLVxcdTExNjBcXHUxN0I0LVxcdTE3QjVcXHUyMDY1XFx1MzE2NFxcdUZGQTBcXHVGRkYwLVxcdUZGRjhcXHV7RTAwMDB9XFx1e0UwMDAyfS1cXHV7RTAwMUZ9XFx1e0UwMDgwfS1cXHV7RTAwRkZ9XFx1e0UwMUYwfS1cXHV7RTBGRkZ9XFx1ezExMkE5fVxcdTAwRDddIiwKICAgICAgICAgICAgIltcXHUwMkIwLVxcdTAyQzFcXHUwMkM2LVxcdTAyRDFcXHUwMkUwLVxcdTAyRTRcXHUwMkVDXFx1MDJFRVxcdTAzNzRcXHUwMzdBXFx1MDU1OVxcdTA2RTUtXFx1MDZFNlxcdTA3RjQtXFx1MDdGNVxcdTA5NzFcXHUxQzc4LVxcdTFDN0RcXHUxRDJDLVxcdTFENkFcXHUxREZELVxcdTFERkZcXHUyRTJGXFx1MzBGQ1xcdUE2N0ZcXHVBNjlDLVxcdUE2OURcXHVBNzE3LVxcdUE3MUZcXHVBNzg4XFx1QTdGOC1cXHVBN0Y5XFx1QUI1Qy1cXHVBQjVGXFx1RkY3MFxcdUZGOUUtXFx1RkY5RlxcdXsxNkY5M30tXFx1ezE2RjlGfVxcdTAyRDAtXFx1MDJEMVxcdTA2NDBcXHUwN0ZBXFx1MEU0NlxcdTBFQzZcXHUxODQzXFx1MUFBN1xcdTFDN0JcXHUzMDA1XFx1MzAzMS1cXHUzMDM1XFx1MzA5RC1cXHUzMDlFXFx1MzBGQy1cXHUzMEZFXFx1QTAxNVxcdUE2MENcXHVBOUNGXFx1QTlFNlxcdUFBNzBcXHVBQUREXFx1QUFGMy1cXHVBQUY0XFx1RkY3MFxcdXsxNkI0Mn0tXFx1ezE2QjQzfVxcdXsxNkZFMH0tXFx1ezE2RkUxfVxcdTAyQjAtXFx1MDJCOFxcdTAyQzAtXFx1MDJDMVxcdTAyRTAtXFx1MDJFNFxcdTAzN0FcXHUxRDJDLVxcdTFENkFcXHUxRDc4XFx1MUQ5Qi1cXHUxREJGXFx1MjA3MVxcdTIwN0ZcXHUyMDkwLVxcdTIwOUNcXHUyQzdDLVxcdTJDN0RcXHVBNjlDLVxcdUE2OURcXHVBNzcwXFx1QTdGOC1cXHVBN0Y5XFx1QUI1Qy1cXHVBQjVGXFx1RkY5RS1cXHVGRjlGXFx1MDJCMlxcdTFENjJcXHUxREE0XFx1MURBOFxcdTIwNzFcXHUyQzdDXFx1MkUxOC1cXHUyRTE5XFx1MkUyRl0iLAogICAgICAgICAgICAiW1xcdTIxMzUtXFx1MjEzOFxcdXsxRUUwMH0tXFx1ezFFRTAzfVxcdXsxRUUwNX0tXFx1ezFFRTFGfVxcdXsxRUUyMX0tXFx1ezFFRTIyfVxcdXsxRUUyNH1cXHV7MUVFMjd9XFx1ezFFRTI5fS1cXHV7MUVFMzJ9XFx1ezFFRTM0fS1cXHV7MUVFMzd9XFx1ezFFRTM5fVxcdXsxRUUzQn1cXHV7MUVFNDJ9XFx1ezFFRTQ3fVxcdXsxRUU0OX1cXHV7MUVFNEJ9XFx1ezFFRTREfS1cXHV7MUVFNEZ9XFx1ezFFRTUxfS1cXHV7MUVFNTJ9XFx1ezFFRTU0fVxcdXsxRUU1N31cXHV7MUVFNTl9XFx1ezFFRTVCfVxcdXsxRUU1RH1cXHV7MUVFNUZ9XFx1ezFFRTYxfS1cXHV7MUVFNjJ9XFx1ezFFRTY0fVxcdXsxRUU2N30tXFx1ezFFRTZBfVxcdXsxRUU2Q30tXFx1ezFFRTcyfVxcdXsxRUU3NH0tXFx1ezFFRTc3fVxcdXsxRUU3OX0tXFx1ezFFRTdDfVxcdXsxRUU3RX1cXHV7MUVFODB9LVxcdXsxRUU4OX1cXHV7MUVFOEJ9LVxcdXsxRUU5Qn1cXHV7MUVFQTF9LVxcdXsxRUVBM31cXHV7MUVFQTV9LVxcdXsxRUVBOX1cXHV7MUVFQUJ9LVxcdXsxRUVCQn1cXHUzMDA2XFx1MzQwMC1cXHU0REI1XFx1NEUwMC1cXHU5RkVGXFx1RjkwMC1cXHVGQTZEXFx1RkE3MC1cXHVGQUQ5XFx1ezE3MDAwfS1cXHV7MTg3RjF9XFx1ezE4ODAwfS1cXHV7MThBRjJ9XFx1ezFCMTcwfS1cXHV7MUIyRkJ9XFx1ezIwMDAwfS1cXHV7MkE2RDZ9XFx1ezJBNzAwfS1cXHV7MkI3MzR9XFx1ezJCNzQwfS1cXHV7MkI4MUR9XFx1ezJCODIwfS1cXHV7MkNFQTF9XFx1ezJDRUIwfS1cXHV7MkVCRTB9XFx1ezJGODAwfS1cXHV7MkZBMUR9XFx1QUFDMFxcdUFBQzJcXHVGRTIwLVxcdUZFMkZcXHV7MTBEMjJ9LVxcdXsxMEQyM31cXHV7MTEzNUR9XFx1MDBBQVxcdTAwQkFcXHUzNDAwLVxcdTREQjVcXHU0RTAwLVxcdTlGRUZcXHVGQTBFLVxcdUZBMEZcXHVGQTExXFx1RkExMy1cXHVGQTE0XFx1RkExRlxcdUZBMjFcXHVGQTIzLVxcdUZBMjRcXHVGQTI3LVxcdUZBMjlcXHV7MjAwMDB9LVxcdXsyQTZENn1cXHV7MkE3MDB9LVxcdXsyQjczNH1cXHV7MkI3NDB9LVxcdXsyQjgxRH1cXHV7MkI4MjB9LVxcdXsyQ0VBMX1cXHV7MkNFQjB9LVxcdXsyRUJFMH1cXHUxMTVGLVxcdTExNjBcXHUzMTY0XFx1RkZBMFxcdTA2NzNcXHUxN0EzLVxcdTE3QTRcXHUwRTQwLVxcdTBFNDRcXHUwRUMwLVxcdTBFQzRcXHUxOUI1LVxcdTE5QjdcXHUxOUJBXFx1QUFCNS1cXHVBQUI2XFx1QUFCOVxcdUFBQkItXFx1QUFCQ10iLAogICAgICAgICAgICAiW1xcdTMwMDdcXHUzMDIxLVxcdTMwMjlcXHUzMDM4LVxcdTMwM0FcXHUyMTcwLVxcdTIxN0ZcXHUyMTYwLVxcdTIxNkZdIiwKICAgICAgICAgICAgIl8iLAogICAgICAgICAgICAiW1xcdTE4ODUtXFx1MTg4NlxcdTIxMThcXHUyMTJFXFx1MzA5Qi1cXHUzMDlDXSIsCiAgICAgICAgICApLAogICAgICAgICAgYyA9IGIoCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgICJbXFx1MTA0QS1cXHUxMDRCXFx1MTAyQi1cXHUxMDJDXFx1MTAyRC1cXHUxMDMwXFx1MTAzMVxcdTEwMzItXFx1MTAzNlxcdTEwMzhcXHUxMDNCLVxcdTEwM0NcXHUxMDNELVxcdTEwM0VcXHUxMDU2LVxcdTEwNTdcXHUxMDU4LVxcdTEwNTlcXHUxMDVFLVxcdTEwNjBcXHUxMDYyXFx1MTA2Ny1cXHUxMDY4XFx1MTA3MS1cXHUxMDc0XFx1MTA4MlxcdTEwODMtXFx1MTA4NFxcdTEwODUtXFx1MTA4NlxcdTEwOUNcXHUxMDlEXFx1MTAzN1xcdTEwMzktXFx1MTAzQVxcdTEwODctXFx1MTA4Q1xcdTEwOERcXHUxMDhGXFx1MTA5QS1cXHUxMDlCXFx1QTlFNVxcdUFBN0JcXHVBQTdDXFx1QUE3RFxcdUE5RTZcXHVBQTcwXFx1MTA0QS1cXHUxMDRCXSIsCiAgICAgICAgICAgICJbXFx1MDkwM1xcdTA5M0JcXHUwOTNFLVxcdTA5NDBcXHUwOTQ5LVxcdTA5NENcXHUwOTRFLVxcdTA5NEZcXHUwOTgyLVxcdTA5ODNcXHUwOUJFLVxcdTA5QzBcXHUwOUM3LVxcdTA5QzhcXHUwOUNCLVxcdTA5Q0NcXHUwOUQ3XFx1MEEwM1xcdTBBM0UtXFx1MEE0MFxcdTBBODNcXHUwQUJFLVxcdTBBQzBcXHUwQUM5XFx1MEFDQi1cXHUwQUNDXFx1MEIwMi1cXHUwQjAzXFx1MEIzRVxcdTBCNDBcXHUwQjQ3LVxcdTBCNDhcXHUwQjRCLVxcdTBCNENcXHUwQjU3XFx1MEJCRS1cXHUwQkJGXFx1MEJDMS1cXHUwQkMyXFx1MEJDNi1cXHUwQkM4XFx1MEJDQS1cXHUwQkNDXFx1MEJEN1xcdTBDMDEtXFx1MEMwM1xcdTBDNDEtXFx1MEM0NFxcdTBDODItXFx1MEM4M1xcdTBDQkVcXHUwQ0MwLVxcdTBDQzRcXHUwQ0M3LVxcdTBDQzhcXHUwQ0NBLVxcdTBDQ0JcXHUwQ0Q1LVxcdTBDRDZcXHUwRDAyLVxcdTBEMDNcXHUwRDNFLVxcdTBENDBcXHUwRDQ2LVxcdTBENDhcXHUwRDRBLVxcdTBENENcXHUwRDU3XFx1MEQ4Mi1cXHUwRDgzXFx1MERDRi1cXHUwREQxXFx1MEREOC1cXHUwRERGXFx1MERGMi1cXHUwREYzXFx1MEY3RlxcdTEwMkItXFx1MTAyQ1xcdTEwMzFcXHUxMDM4XFx1MTAzQi1cXHUxMDNDXFx1MTA1Ni1cXHUxMDU3XFx1MTA2MlxcdTEwNjctXFx1MTA2OFxcdTEwODMtXFx1MTA4NFxcdTEwOUNcXHUxN0I2XFx1MTdCRS1cXHUxN0M1XFx1MTdDNy1cXHUxN0M4XFx1MTkyMy1cXHUxOTI2XFx1MTkyOS1cXHUxOTJCXFx1MTkzMC1cXHUxOTMxXFx1MTkzMy1cXHUxOTM4XFx1MUExOS1cXHUxQTFBXFx1MUE1NVxcdTFBNTdcXHUxQTYxXFx1MUE2My1cXHUxQTY0XFx1MUE2RC1cXHUxQTcyXFx1MUIwNFxcdTFCMzVcXHUxQjNCXFx1MUIzRC1cXHUxQjQxXFx1MUI0M1xcdTFCODJcXHUxQkExXFx1MUJBNi1cXHUxQkE3XFx1MUJFN1xcdTFCRUEtXFx1MUJFQ1xcdTFCRUVcXHUxQzI0LVxcdTFDMkJcXHUxQzM0LVxcdTFDMzVcXHUxQ0YyLVxcdTFDRjNcXHVBODIzLVxcdUE4MjRcXHVBODI3XFx1QTg4MC1cXHVBODgxXFx1QThCNC1cXHVBOEMzXFx1QTk1MlxcdUE5ODNcXHVBOUI0LVxcdUE5QjVcXHVBOUJBLVxcdUE5QkJcXHVBOUJELVxcdUE5QkZcXHVBQTJGLVxcdUFBMzBcXHVBQTMzLVxcdUFBMzRcXHVBQTREXFx1QUFFQlxcdUFBRUUtXFx1QUFFRlxcdUFBRjVcXHVBQkUzLVxcdUFCRTRcXHVBQkU2LVxcdUFCRTdcXHVBQkU5LVxcdUFCRUFcXHV7MTEwMDB9XFx1ezExMDAyfVxcdXsxMTA4Mn1cXHV7MTEwQjB9LVxcdXsxMTBCMn1cXHV7MTEwQjd9LVxcdXsxMTBCOH1cXHV7MTExMkN9XFx1ezExMTQ1fS1cXHV7MTExNDZ9XFx1ezExMTgyfVxcdXsxMTFCM30tXFx1ezExMUI1fVxcdXsxMTFCRn1cXHV7MTEyMkN9LVxcdXsxMTIyRX1cXHV7MTEyMzJ9LVxcdXsxMTIzM31cXHV7MTEyRTB9LVxcdXsxMTJFMn1cXHV7MTEzMDJ9LVxcdXsxMTMwM31cXHV7MTEzM0V9LVxcdXsxMTMzRn1cXHV7MTEzNDF9LVxcdXsxMTM0NH1cXHV7MTEzNDd9LVxcdXsxMTM0OH1cXHV7MTEzNEJ9LVxcdXsxMTM0Q31cXHV7MTEzNTd9XFx1ezExMzYyfS1cXHV7MTEzNjN9XFx1ezExNDM1fS1cXHV7MTE0Mzd9XFx1ezExNDQwfS1cXHV7MTE0NDF9XFx1ezExNDQ1fVxcdXsxMTRCMH0tXFx1ezExNEIyfVxcdXsxMTRCOX1cXHV7MTE0QkJ9LVxcdXsxMTRCRX1cXHV7MTE0QzF9XFx1ezExNUFGfS1cXHV7MTE1QjF9XFx1ezExNUI4fS1cXHV7MTE1QkJ9XFx1ezExNUJFfVxcdXsxMTYzMH0tXFx1ezExNjMyfVxcdXsxMTYzQn0tXFx1ezExNjNDfVxcdXsxMTYzRX1cXHV7MTE2QUN9XFx1ezExNkFFfS1cXHV7MTE2QUZ9XFx1ezExNzIwfS1cXHV7MTE3MjF9XFx1ezExNzI2fVxcdXsxMTgyQ30tXFx1ezExODJFfVxcdXsxMTgzOH1cXHV7MTFBMzl9XFx1ezExQTU3fS1cXHV7MTFBNTh9XFx1ezExQTk3fVxcdXsxMUMyRn1cXHV7MTFDM0V9XFx1ezExQ0E5fVxcdXsxMUNCMX1cXHV7MTFDQjR9XFx1ezExRDhBfS1cXHV7MTFEOEV9XFx1ezExRDkzfS1cXHV7MTFEOTR9XFx1ezExRDk2fVxcdXsxMUVGNX0tXFx1ezExRUY2fVxcdXsxNkY1MX0tXFx1ezE2RjdFfVxcdTBGM0UtXFx1MEYzRlxcdTEwODctXFx1MTA4Q1xcdTEwOEZcXHUxMDlBLVxcdTEwOUJcXHUxQjQ0XFx1MUJBQVxcdTFDRTFcXHUxQ0Y3XFx1MzAyRS1cXHUzMDJGXFx1QTk1M1xcdUE5QzBcXHVBQTdCXFx1QUE3RFxcdUFCRUNcXHV7MTExQzB9XFx1ezExMjM1fVxcdXsxMTM0RH1cXHV7MTE2QjZ9XFx1ezFEMTZEfS1cXHV7MUQxNzJ9XFx1MDlCRVxcdTA5RDdcXHUwQjNFXFx1MEI1N1xcdTBCQkVcXHUwQkQ3XFx1MENDMlxcdTBDRDUtXFx1MENENlxcdTBEM0VcXHUwRDU3XFx1MERDRlxcdTBEREZcXHUzMDJFLVxcdTMwMkZcXHV7MTEzM0V9XFx1ezExMzU3fVxcdXsxMTRCMH1cXHV7MTE0QkR9XFx1ezExNUFGfVxcdXsxRDE2NX1cXHV7MUQxNkV9LVxcdXsxRDE3Mn1dIiwKICAgICAgICAgICAgIltcXHV7MUQ3Q0V9LVxcdXsxRDdGRn1cXHVGRjEwLVxcdUZGMTldIiwKICAgICAgICAgICAgIlxcdTIwNDAiLAogICAgICAgICAgICAiW1xcdTAwQjdcXHUwMzg3XFx1MTM2OS1cXHUxMzcxXFx1MTlEQV0iLAogICAgICAgICAgKQogICAgICAgIGlmICghMSA9PT0gUmVnRXhwKCkudW5pY29kZSkKICAgICAgICAgIHJldHVybiBuZXcgUmVnRXhwKCJeIiArIGEgKyAiKyIgKyBjICsgIiokIiwgInUiKQogICAgICAgIGEgPSBiKCJbQS1aXSIsICJbYS16XSIsICJfIikKICAgICAgICBjID0gYihhLCAiWzAtOV0iKQogICAgICAgIHJldHVybiBuZXcgUmVnRXhwKCJeIiArIGEgKyAiKyIgKyBjICsgIiokIikKICAgICAgfSkoKQogICAgICA7KGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGIuYXBwbHkobnVsbCwgYXJndW1lbnRzKSArICIqIgogICAgICB9KSgiXFxcXFxccj9cXG5bIFxcZlxcdF0qIikKICAgICAgYygiI1teXFxyXFxuXSoiKQogICAgICBtID0KICAgICAgICBiKAogICAgICAgICAgIlswLTldKD86Xz9bMC05XSkqXFwuKD86WzAtOV0oPzpfP1swLTldKSopPyIsCiAgICAgICAgICAiXFwuWzAtOV0oPzpfP1swLTldKSoiLAogICAgICAgICkgKyBjKCJbZUVdWy0rXT9bMC05XSg/Ol8/WzAtOV0pKiIpCiAgICAgIHZhciBuID0gYihtLCAiWzAtOV0oPzpfP1swLTldKSpbZUVdWy0rXT9bMC05XSg/Ol8/WzAtOV0pKiIpLAogICAgICAgIHEgPSBiKCJbMC05XSg/Ol8/WzAtOV0pKltqSl0iLCBuICsgIltqSl0iKQogICAgICBtID0gYi5hcHBseShudWxsLCBlKCkpCiAgICAgIHAgPSBiKG0gKyAiJycnIiwgbSArICciIiInKQogICAgICBiKAogICAgICAgIG0gKyAiJ1teXFxuJ1xcXFxdKig/OlxcXFwuW15cXG4nXFxcXF0qKSonIiwKICAgICAgICBtICsgJyJbXlxcbiJcXFxcXSooPzpcXFxcLlteXFxuIlxcXFxdKikqIicsCiAgICAgICkKICAgICAgdmFyIEQgPSBPYmplY3Qua2V5cyhTay50b2tlbi5FWEFDVF9UT0tFTl9UWVBFUykuc29ydCgpCiAgICAgIEQgPSBiLmFwcGx5KAogICAgICAgIHRoaXMsCiAgICAgICAgRC5yZXZlcnNlKCkubWFwKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYSAmJiBsLnRlc3QoYSkgPyBhLnJlcGxhY2UoaywgIlxcJCYiKSA6IGEKICAgICAgICB9KSwKICAgICAgKQogICAgICB2YXIgeCA9IGIoIlxccj9cXG4iLCBEKSwKICAgICAgICBIID0gYigKICAgICAgICAgIG0gKyAiJ1teXFxuJ1xcXFxdKig/OlxcXFwuW15cXG4nXFxcXF0qKSoiICsgYigiJyIsICJcXFxcXFxyP1xcbiIpLAogICAgICAgICAgbSArICciW15cXG4iXFxcXF0qKD86XFxcXC5bXlxcbiJcXFxcXSopKicgKyBiKCciJywgIlxcXFxcXHI/XFxuIiksCiAgICAgICAgKSwKICAgICAgICBKID0gYigiXFxcXFxccj9cXG58JCIsICIjW15cXHJcXG5dKiIsIHApLAogICAgICAgIEEgPSB7fQogICAgICBtID0gZSgpCiAgICAgIGZvciAobGV0IGEgb2YgbSkKICAgICAgICAoQVthICsgIiciXSA9ICJeW14nXFxcXF0qKD86XFxcXC5bXidcXFxcXSopKiciKSwKICAgICAgICAgIChBW2EgKyAnIiddID0gJ15bXiJcXFxcXSooPzpcXFxcLlteIlxcXFxdKikqIicpLAogICAgICAgICAgKEFbYSArICInJyciXSA9ICJeW14nXFxcXF0qKD86KD86XFxcXC58Jyg/IScnKSlbXidcXFxcXSopKicnJyIpLAogICAgICAgICAgKEFbYSArICciIiInXSA9ICdeW14iXFxcXF0qKD86KD86XFxcXC58Iig/ISIiKSlbXiJcXFxcXSopKiIiIicpCiAgICAgIGxldCBDID0gW10sCiAgICAgICAgSyA9IFtdCiAgICAgIGZvciAobGV0IGEgb2YgbSkKICAgICAgICBDLnB1c2goYSArICciJyksIEMucHVzaChhICsgIiciKSwgSy5wdXNoKGEgKyAnIiIiJyksIEsucHVzaChhICsgIicnJyIpCiAgICAgIFNrLl90b2tlbml6ZSA9IGZ1bmN0aW9uIChjLCBlLCBrLCBsKSB7CiAgICAgICAgdmFyIG0gPSBTay5fX2Z1dHVyZV9fLnB5dGhvbjMgPyAiIiA6ICIoPzpMPykiCiAgICAgICAgbSA9IGIoCiAgICAgICAgICAiMFt4WF0oPzpfP1swLTlhLWZBLUZdKSsiICsgbSwKICAgICAgICAgICIwW2JCXSg/Ol8/WzAxXSkrIiArIG0sCiAgICAgICAgICBTay5fX2Z1dHVyZV9fLnNpbGVudF9vY3RhbF9saXRlcmFsCiAgICAgICAgICAgID8gIjAoW29PXT8pKD86Xz9bMC03XSkrIiArIG0KICAgICAgICAgICAgOiAiMChbb09dKSg/Ol8/WzAtN10pKyIgKyBtLAogICAgICAgICAgIig/OjAoPzpfPzApKnxbMS05XSg/Ol8/WzAtOV0pKikiICsgbSwKICAgICAgICApCiAgICAgICAgbSA9IGIocSwgbiwgbSkKICAgICAgICBtID0gIlsgXFxmXFx0XSoiICsgYihKLCBtLCB4LCBILCAiXFx3KyIpCiAgICAgICAgbSA9IG5ldyBSZWdFeHAobSkKICAgICAgICB2YXIgcCA9IDAsCiAgICAgICAgICBEID0gMCwKICAgICAgICAgIEIgPSAwLAogICAgICAgICAgeiA9ICIiLAogICAgICAgICAgRyA9IDAsCiAgICAgICAgICBTID0gbnVsbCwKICAgICAgICAgIEkgPSBbMF0sCiAgICAgICAgICBFLAogICAgICAgICAgTiA9IHZvaWQgMCwKICAgICAgICAgIFUgPSB2b2lkIDAsCiAgICAgICAgICBGLAogICAgICAgICAgUQogICAgICAgIHZvaWQgMCAhPT0gayAmJgogICAgICAgICAgKCJ1dGYtOC1zaWciID09IGsgJiYgKGsgPSAidXRmLTgiKSwKICAgICAgICAgIGwobmV3IGEoZi5UX0VOQ09ESU5HLCBrLCBbMCwgMF0sIFswLCAwXSwgIiIpKSkKICAgICAgICBmb3IgKHZhciB5ID0gKGsgPSAiIik7IDsgKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICA7KGsgPSB5KSwgKHkgPSBlKCkpCiAgICAgICAgICB9IGNhdGNoIChNKSB7CiAgICAgICAgICAgIHkgPSAiIgogICAgICAgICAgfQogICAgICAgICAgcCArPSAxCiAgICAgICAgICB2YXIgdSA9IDAsCiAgICAgICAgICAgIEwgPSB5Lmxlbmd0aAogICAgICAgICAgaWYgKHopIHsKICAgICAgICAgICAgaWYgKCF5KSB0aHJvdyBuZXcgZygiRU9GIGluIG11bHRpLWxpbmUgc3RyaW5nIiwgYywgVVswXSwgVVsxXSkKICAgICAgICAgICAgTi5sYXN0SW5kZXggPSAwCiAgICAgICAgICAgIHZhciB0ID0gTi5leGVjKHkpCiAgICAgICAgICAgIGlmICh0KQogICAgICAgICAgICAgICh1ID0gRiA9IHRbMF0ubGVuZ3RoKSwKICAgICAgICAgICAgICAgIGwobmV3IGEoZi5UX1NUUklORywgeiArIHkuc3Vic3RyaW5nKDAsIEYpLCBVLCBbcCwgRl0sIFMgKyB5KSksCiAgICAgICAgICAgICAgICAoeiA9ICIiKSwKICAgICAgICAgICAgICAgIChHID0gMCksCiAgICAgICAgICAgICAgICAoUyA9IG51bGwpCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIEcgJiYKICAgICAgICAgICAgICAiXFxcbiIgIT09IHkuc3Vic3RyaW5nKHkubGVuZ3RoIC0gMikgJiYKICAgICAgICAgICAgICAiXFxcclxuIiAhPT0geS5zdWJzdHJpbmcoeS5sZW5ndGggLSAzKQogICAgICAgICAgICAgICAgPyAobChuZXcgYShmLlRfRVJST1JUT0tFTiwgeiArIHksIFUsIFtwLCB5Lmxlbmd0aF0sIFMpKSwKICAgICAgICAgICAgICAgICAgKHogPSAiIiksCiAgICAgICAgICAgICAgICAgIChTID0gbnVsbCkpCiAgICAgICAgICAgICAgICA6ICgoeiArPSB5KSwgKFMgKz0geSkpCiAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmICgwICE9IEQgfHwgQikgewogICAgICAgICAgICBpZiAoIXkpIHRocm93IG5ldyBnKCJFT0YgaW4gbXVsdGktbGluZSBzdGF0ZW1lbnQiLCBjLCBwLCAwKQogICAgICAgICAgICBCID0gMAogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCF5KSBicmVhawogICAgICAgICAgICBmb3IgKEUgPSAwOyB1IDwgTDsgKSB7CiAgICAgICAgICAgICAgaWYgKCIgIiA9PSB5W3VdKSBFICs9IDEKICAgICAgICAgICAgICBlbHNlIGlmICgiXHQiID09IHlbdV0pIEUgPSA4ICogTWF0aC5mbG9vcihFIC8gOCArIDEpCiAgICAgICAgICAgICAgZWxzZSBpZiAoIlxmIiA9PSB5W3VdKSBFID0gMAogICAgICAgICAgICAgIGVsc2UgYnJlYWsKICAgICAgICAgICAgICB1ICs9IDEKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodSA9PSBMKSBicmVhawogICAgICAgICAgICBpZiAoZCgiI1xyXG4iLCB5W3VdKSkgewogICAgICAgICAgICAgIGlmICgiIyIgPT0geVt1XSkgewogICAgICAgICAgICAgICAgRSA9IHkuc3Vic3RyaW5nKHUpCiAgICAgICAgICAgICAgICBmb3IgKAogICAgICAgICAgICAgICAgICBMID0gRS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgIDAgPCBMICYmIC0xICE9PSAiXHJcbiIuaW5kZXhPZihFLmNoYXJBdChMIC0gMSkpOwogICAgICAgICAgICAgICAgICAtLUwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBMID0gRS5zdWJzdHJpbmcoMCwgTCkKICAgICAgICAgICAgICAgIGwobmV3IGEoZi5UX0NPTU1FTlQsIEwsIFtwLCB1XSwgW3AsIHUgKyBMLmxlbmd0aF0sIHkpKQogICAgICAgICAgICAgICAgdSArPSBMLmxlbmd0aAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBsKG5ldyBhKGYuVF9OTCwgeS5zdWJzdHJpbmcodSksIFtwLCB1XSwgW3AsIHkubGVuZ3RoXSwgeSkpCiAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgfQogICAgICAgICAgICBFID4gSVtJLmxlbmd0aCAtIDFdICYmCiAgICAgICAgICAgICAgKEkucHVzaChFKSwKICAgICAgICAgICAgICBsKG5ldyBhKGYuVF9JTkRFTlQsIHkuc3Vic3RyaW5nKHUpLCBbcCwgMF0sIFtwLCB1XSwgeSkpKQogICAgICAgICAgICBmb3IgKDsgRSA8IElbSS5sZW5ndGggLSAxXTsgKSB7CiAgICAgICAgICAgICAgaWYgKCFkKEksIEUpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IGgoCiAgICAgICAgICAgICAgICAgICJ1bmluZGVudCBkb2VzIG5vdCBtYXRjaCBhbnkgb3V0ZXIgaW5kZW50YXRpb24gbGV2ZWwiLAogICAgICAgICAgICAgICAgICBjLAogICAgICAgICAgICAgICAgICBwLAogICAgICAgICAgICAgICAgICB1LAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIEkgPSBJLnNsaWNlKDAsIC0xKQogICAgICAgICAgICAgIGwobmV3IGEoZi5UX0RFREVOVCwgIiIsIFtwLCB1XSwgW3AsIHVdLCB5KSkKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZm9yICg7IHUgPCBMOyApIHsKICAgICAgICAgICAgZm9yIChFID0geS5jaGFyQXQodSk7ICIgIiA9PT0gRSB8fCAiXGYiID09PSBFIHx8ICJcdCIgPT09IEU7ICkKICAgICAgICAgICAgICAodSArPSAxKSwgKEUgPSB5LmNoYXJBdCh1KSkKICAgICAgICAgICAgaWYgKChRID0gbS5leGVjKHkuc3Vic3RyaW5nKHUpKSkpIHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAoKEUgPSB1KSwKICAgICAgICAgICAgICAgIChGID0gRSArIFFbMV0ubGVuZ3RoKSwKICAgICAgICAgICAgICAgIChRID0gW3AsIEVdKSwKICAgICAgICAgICAgICAgICh0ID0gW3AsIEZdKSwKICAgICAgICAgICAgICAgICh1ID0gRiksCiAgICAgICAgICAgICAgICBFICE9IEYpCiAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICBGID0geS5zdWJzdHJpbmcoRSwgRikKICAgICAgICAgICAgICAgIHZhciB2ID0geVtFXQogICAgICAgICAgICAgICAgaWYgKGQoIjAxMjM0NTY3ODkiLCB2KSB8fCAoIi4iID09IHYgJiYgIi4iICE9IEYgJiYgIi4uLiIgIT0gRikpCiAgICAgICAgICAgICAgICAgIGwobmV3IGEoZi5UX05VTUJFUiwgRiwgUSwgdCwgeSkpCiAgICAgICAgICAgICAgICBlbHNlIGlmIChkKCJcclxuIiwgdikpCiAgICAgICAgICAgICAgICAgIDAgPCBECiAgICAgICAgICAgICAgICAgICAgPyBsKG5ldyBhKGYuVF9OTCwgRiwgUSwgdCwgeSkpCiAgICAgICAgICAgICAgICAgICAgOiBsKG5ldyBhKGYuVF9ORVdMSU5FLCBGLCBRLCB0LCB5KSkKICAgICAgICAgICAgICAgIGVsc2UgaWYgKCIjIiA9PSB2KSBsKG5ldyBhKGYuVF9DT01NRU5ULCBGLCBRLCB0LCB5KSkKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGQoSywgRikpCiAgICAgICAgICAgICAgICAgIGlmICgoKE4gPSBSZWdFeHAoQVtGXSkpLCAodCA9IE4uZXhlYyh5LnN1YnN0cmluZyh1KSkpKSkKICAgICAgICAgICAgICAgICAgICAodSA9IHRbMF0ubGVuZ3RoICsgdSksCiAgICAgICAgICAgICAgICAgICAgICAoRiA9IHkuc3Vic3RyaW5nKEUsIHUpKSwKICAgICAgICAgICAgICAgICAgICAgIGwobmV3IGEoZi5UX1NUUklORywgRiwgUSwgW3AsIHVdLCB5KSkKICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgVSA9IFtwLCBFXQogICAgICAgICAgICAgICAgICAgIHogPSB5LnN1YnN0cmluZyhFKQogICAgICAgICAgICAgICAgICAgIFMgPSB5CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAoCiAgICAgICAgICAgICAgICAgIGQoQywgdikgfHwKICAgICAgICAgICAgICAgICAgZChDLCBGLnN1YnN0cmluZygwLCAyKSkgfHwKICAgICAgICAgICAgICAgICAgZChDLCBGLnN1YnN0cmluZygwLCAzKSkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgaWYgKCJcbiIgPT0gRltGLmxlbmd0aCAtIDFdKSB7CiAgICAgICAgICAgICAgICAgICAgVSA9IFtwLCBFXQogICAgICAgICAgICAgICAgICAgIE4gPSBSZWdFeHAoQVt2XSB8fCBBW0ZbMV1dIHx8IEFbRlsyXV0pCiAgICAgICAgICAgICAgICAgICAgeiA9IHkuc3Vic3RyaW5nKEUpCiAgICAgICAgICAgICAgICAgICAgRyA9IDEKICAgICAgICAgICAgICAgICAgICBTID0geQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgIH0gZWxzZSBsKG5ldyBhKGYuVF9TVFJJTkcsIEYsIFEsIHQsIHkpKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAoRSA9IHYubm9ybWFsaXplKCJORktDIikpLAogICAgICAgICAgICAgICAgICAgIHIudGVzdChFKQogICAgICAgICAgICAgICAgICAgICAgPyBsKG5ldyBhKGYuVF9OQU1FLCBGLCBRLCB0LCB5KSkKICAgICAgICAgICAgICAgICAgICAgIDogIlxcIiA9PSB2CiAgICAgICAgICAgICAgICAgICAgICA/IChCID0gMSkKICAgICAgICAgICAgICAgICAgICAgIDogKGQoIihbeyIsIHYpID8gKEQgKz0gMSkgOiBkKCIpXX0iLCB2KSAmJiAtLUQsCiAgICAgICAgICAgICAgICAgICAgICAgIGwobmV3IGEoZi5UX09QLCBGLCBRLCB0LCB5KSkpCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICBsKG5ldyBhKGYuVF9FUlJPUlRPS0VOLCB5W3VdLCBbcCwgdV0sIFtwLCB1ICsgMV0sIHkpKSwgKHUgKz0gMSkKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgayAmJgogICAgICAgICAgIWQoIlxyXG4iLCBrW2subGVuZ3RoIC0gMV0pICYmCiAgICAgICAgICBsKAogICAgICAgICAgICBuZXcgYSgKICAgICAgICAgICAgICBmLlRfTkVXTElORSwKICAgICAgICAgICAgICAiIiwKICAgICAgICAgICAgICBbcCAtIDEsIGsubGVuZ3RoXSwKICAgICAgICAgICAgICBbcCAtIDEsIGsubGVuZ3RoICsgMV0sCiAgICAgICAgICAgICAgIiIsCiAgICAgICAgICAgICksCiAgICAgICAgICApCiAgICAgICAgZm9yICh2YXIgVyBpbiBJLnNsaWNlKDEpKSBsKG5ldyBhKGYuVF9ERURFTlQsICIiLCBbcCwgMF0sIFtwLCAwXSwgIiIpKQogICAgICAgIGwobmV3IGEoZi5UX0VORE1BUktFUiwgIiIsIFtwLCAwXSwgW3AsIDBdLCAiIikpCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5fdG9rZW5pemUiLCBTay5fdG9rZW5pemUpCiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHApIHsKICAgICAgU2suT3BNYXAgPSB7CiAgICAgICAgIigiOiBTay50b2tlbi50b2tlbnMuVF9MUEFSLAogICAgICAgICIpIjogU2sudG9rZW4udG9rZW5zLlRfUlBBUiwKICAgICAgICAiWyI6IFNrLnRva2VuLnRva2Vucy5UX0xTUUIsCiAgICAgICAgIl0iOiBTay50b2tlbi50b2tlbnMuVF9SU1FCLAogICAgICAgICI6IjogU2sudG9rZW4udG9rZW5zLlRfQ09MT04sCiAgICAgICAgIiwiOiBTay50b2tlbi50b2tlbnMuVF9DT01NQSwKICAgICAgICAiOyI6IFNrLnRva2VuLnRva2Vucy5UX1NFTUksCiAgICAgICAgIisiOiBTay50b2tlbi50b2tlbnMuVF9QTFVTLAogICAgICAgICItIjogU2sudG9rZW4udG9rZW5zLlRfTUlOVVMsCiAgICAgICAgIioiOiBTay50b2tlbi50b2tlbnMuVF9TVEFSLAogICAgICAgICIvIjogU2sudG9rZW4udG9rZW5zLlRfU0xBU0gsCiAgICAgICAgInwiOiBTay50b2tlbi50b2tlbnMuVF9WQkFSLAogICAgICAgICImIjogU2sudG9rZW4udG9rZW5zLlRfQU1QRVIsCiAgICAgICAgIjwiOiBTay50b2tlbi50b2tlbnMuVF9MRVNTLAogICAgICAgICI+IjogU2sudG9rZW4udG9rZW5zLlRfR1JFQVRFUiwKICAgICAgICAiPSI6IFNrLnRva2VuLnRva2Vucy5UX0VRVUFMLAogICAgICAgICIuIjogU2sudG9rZW4udG9rZW5zLlRfRE9ULAogICAgICAgICIlIjogU2sudG9rZW4udG9rZW5zLlRfUEVSQ0VOVCwKICAgICAgICAiYCI6IFNrLnRva2VuLnRva2Vucy5UX0JBQ0tRVU9URSwKICAgICAgICAieyI6IFNrLnRva2VuLnRva2Vucy5UX0xCUkFDRSwKICAgICAgICAifSI6IFNrLnRva2VuLnRva2Vucy5UX1JCUkFDRSwKICAgICAgICAiQCI6IFNrLnRva2VuLnRva2Vucy5UX0FULAogICAgICAgICJAPSI6IFNrLnRva2VuLnRva2Vucy5UX0FURVFVQUwsCiAgICAgICAgIj09IjogU2sudG9rZW4udG9rZW5zLlRfRVFFUVVBTCwKICAgICAgICAiIT0iOiBTay50b2tlbi50b2tlbnMuVF9OT1RFUVVBTCwKICAgICAgICAiPD4iOiBTay50b2tlbi50b2tlbnMuVF9OT1RFUVVBTCwKICAgICAgICAiPD0iOiBTay50b2tlbi50b2tlbnMuVF9MRVNTRVFVQUwsCiAgICAgICAgIj49IjogU2sudG9rZW4udG9rZW5zLlRfR1JFQVRFUkVRVUFMLAogICAgICAgICJ+IjogU2sudG9rZW4udG9rZW5zLlRfVElMREUsCiAgICAgICAgIl4iOiBTay50b2tlbi50b2tlbnMuVF9DSVJDVU1GTEVYLAogICAgICAgICI8PCI6IFNrLnRva2VuLnRva2Vucy5UX0xFRlRTSElGVCwKICAgICAgICAiPj4iOiBTay50b2tlbi50b2tlbnMuVF9SSUdIVFNISUZULAogICAgICAgICIqKiI6IFNrLnRva2VuLnRva2Vucy5UX0RPVUJMRVNUQVIsCiAgICAgICAgIis9IjogU2sudG9rZW4udG9rZW5zLlRfUExVU0VRVUFMLAogICAgICAgICItPSI6IFNrLnRva2VuLnRva2Vucy5UX01JTkVRVUFMLAogICAgICAgICIqPSI6IFNrLnRva2VuLnRva2Vucy5UX1NUQVJFUVVBTCwKICAgICAgICAiLz0iOiBTay50b2tlbi50b2tlbnMuVF9TTEFTSEVRVUFMLAogICAgICAgICIlPSI6IFNrLnRva2VuLnRva2Vucy5UX1BFUkNFTlRFUVVBTCwKICAgICAgICAiJj0iOiBTay50b2tlbi50b2tlbnMuVF9BTVBFUkVRVUFMLAogICAgICAgICJ8PSI6IFNrLnRva2VuLnRva2Vucy5UX1ZCQVJFUVVBTCwKICAgICAgICAiXj0iOiBTay50b2tlbi50b2tlbnMuVF9DSVJDVU1GTEVYRVFVQUwsCiAgICAgICAgIjw8PSI6IFNrLnRva2VuLnRva2Vucy5UX0xFRlRTSElGVEVRVUFMLAogICAgICAgICI+Pj0iOiBTay50b2tlbi50b2tlbnMuVF9SSUdIVFNISUZURVFVQUwsCiAgICAgICAgIioqPSI6IFNrLnRva2VuLnRva2Vucy5UX0RPVUJMRVNUQVJFUVVBTCwKICAgICAgICAiLy8iOiBTay50b2tlbi50b2tlbnMuVF9ET1VCTEVTTEFTSCwKICAgICAgICAiLy89IjogU2sudG9rZW4udG9rZW5zLlRfRE9VQkxFU0xBU0hFUVVBTCwKICAgICAgICAiLT4iOiBTay50b2tlbi50b2tlbnMuVF9SQVJST1csCiAgICAgICAgIi4uLiI6IFNrLnRva2VuLnRva2Vucy5UX0VMTElQU0lTLAogICAgICB9CiAgICAgIFNrLlBhcnNlVGFibGVzID0gewogICAgICAgIHN5bTogewogICAgICAgICAgYW5kX2V4cHI6IDI1NywKICAgICAgICAgIGFuZF90ZXN0OiAyNTgsCiAgICAgICAgICBhbm5hc3NpZ246IDI1OSwKICAgICAgICAgIGFyZ2xpc3Q6IDI2MCwKICAgICAgICAgIGFyZ3VtZW50OiAyNjEsCiAgICAgICAgICBhcml0aF9leHByOiAyNjIsCiAgICAgICAgICBhc3NlcnRfc3RtdDogMjYzLAogICAgICAgICAgYXN5bmNfZnVuY2RlZjogMjY0LAogICAgICAgICAgYXN5bmNfc3RtdDogMjY1LAogICAgICAgICAgYXRvbTogMjY2LAogICAgICAgICAgYXRvbV9leHByOiAyNjcsCiAgICAgICAgICBhdWdhc3NpZ246IDI2OCwKICAgICAgICAgIGJyZWFrX3N0bXQ6IDI2OSwKICAgICAgICAgIGNsYXNzZGVmOiAyNzAsCiAgICAgICAgICBjb21wX2ZvcjogMjcxLAogICAgICAgICAgY29tcF9pZjogMjcyLAogICAgICAgICAgY29tcF9pdGVyOiAyNzMsCiAgICAgICAgICBjb21wX29wOiAyNzQsCiAgICAgICAgICBjb21wYXJpc29uOiAyNzUsCiAgICAgICAgICBjb21wb3VuZF9zdG10OiAyNzYsCiAgICAgICAgICBjb250aW51ZV9zdG10OiAyNzcsCiAgICAgICAgICBkZWJ1Z2dlcl9zdG10OiAyNzgsCiAgICAgICAgICBkZWNvcmF0ZWQ6IDI3OSwKICAgICAgICAgIGRlY29yYXRvcjogMjgwLAogICAgICAgICAgZGVjb3JhdG9yczogMjgxLAogICAgICAgICAgZGVsX3N0bXQ6IDI4MiwKICAgICAgICAgIGRpY3RvcnNldG1ha2VyOiAyODMsCiAgICAgICAgICBkb3R0ZWRfYXNfbmFtZTogMjg0LAogICAgICAgICAgZG90dGVkX2FzX25hbWVzOiAyODUsCiAgICAgICAgICBkb3R0ZWRfbmFtZTogMjg2LAogICAgICAgICAgZW5jb2RpbmdfZGVjbDogMjg3LAogICAgICAgICAgZXZhbF9pbnB1dDogMjg4LAogICAgICAgICAgZXhjZXB0X2NsYXVzZTogMjg5LAogICAgICAgICAgZXhwcjogMjkwLAogICAgICAgICAgZXhwcl9zdG10OiAyOTEsCiAgICAgICAgICBleHBybGlzdDogMjkyLAogICAgICAgICAgZmFjdG9yOiAyOTMsCiAgICAgICAgICBmaWxlX2lucHV0OiAyOTQsCiAgICAgICAgICBmbG93X3N0bXQ6IDI5NSwKICAgICAgICAgIGZvcl9zdG10OiAyOTYsCiAgICAgICAgICBmdW5jZGVmOiAyOTcsCiAgICAgICAgICBnbG9iYWxfc3RtdDogMjk4LAogICAgICAgICAgaWZfc3RtdDogMjk5LAogICAgICAgICAgaW1wb3J0X2FzX25hbWU6IDMwMCwKICAgICAgICAgIGltcG9ydF9hc19uYW1lczogMzAxLAogICAgICAgICAgaW1wb3J0X2Zyb206IDMwMiwKICAgICAgICAgIGltcG9ydF9uYW1lOiAzMDMsCiAgICAgICAgICBpbXBvcnRfc3RtdDogMzA0LAogICAgICAgICAgbGFtYmRlZjogMzA1LAogICAgICAgICAgbGFtYmRlZl9ub2NvbmQ6IDMwNiwKICAgICAgICAgIG5vbmxvY2FsX3N0bXQ6IDMwNywKICAgICAgICAgIG5vdF90ZXN0OiAzMDgsCiAgICAgICAgICBvcl90ZXN0OiAzMDksCiAgICAgICAgICBwYXJhbWV0ZXJzOiAzMTAsCiAgICAgICAgICBwYXNzX3N0bXQ6IDMxMSwKICAgICAgICAgIHBvd2VyOiAzMTIsCiAgICAgICAgICBwcmludF9zdG10OiAzMTMsCiAgICAgICAgICByYWlzZV9zdG10OiAzMTQsCiAgICAgICAgICByZXR1cm5fc3RtdDogMzE1LAogICAgICAgICAgc2hpZnRfZXhwcjogMzE2LAogICAgICAgICAgc2ltcGxlX3N0bXQ6IDMxNywKICAgICAgICAgIHNpbmdsZV9pbnB1dDogMjU2LAogICAgICAgICAgc2xpY2VvcDogMzE4LAogICAgICAgICAgc21hbGxfc3RtdDogMzE5LAogICAgICAgICAgc3Rhcl9leHByOiAzMjAsCiAgICAgICAgICBzdG10OiAzMjEsCiAgICAgICAgICBzdWJzY3JpcHQ6IDMyMiwKICAgICAgICAgIHN1YnNjcmlwdGxpc3Q6IDMyMywKICAgICAgICAgIHN1aXRlOiAzMjQsCiAgICAgICAgICB0ZXJtOiAzMjUsCiAgICAgICAgICB0ZXN0OiAzMjYsCiAgICAgICAgICB0ZXN0X25vY29uZDogMzI3LAogICAgICAgICAgdGVzdGxpc3Q6IDMyOCwKICAgICAgICAgIHRlc3RsaXN0X2NvbXA6IDMyOSwKICAgICAgICAgIHRlc3RsaXN0X3N0YXJfZXhwcjogMzMwLAogICAgICAgICAgdGZwZGVmOiAzMzEsCiAgICAgICAgICB0cmFpbGVyOiAzMzIsCiAgICAgICAgICB0cnlfc3RtdDogMzMzLAogICAgICAgICAgdHlwZWRhcmdzbGlzdDogMzM0LAogICAgICAgICAgdmFyYXJnc2xpc3Q6IDMzNSwKICAgICAgICAgIHZmcGRlZjogMzM2LAogICAgICAgICAgd2hpbGVfc3RtdDogMzM3LAogICAgICAgICAgd2l0aF9pdGVtOiAzMzgsCiAgICAgICAgICB3aXRoX3N0bXQ6IDMzOSwKICAgICAgICAgIHhvcl9leHByOiAzNDAsCiAgICAgICAgICB5aWVsZF9hcmc6IDM0MSwKICAgICAgICAgIHlpZWxkX2V4cHI6IDM0MiwKICAgICAgICAgIHlpZWxkX3N0bXQ6IDM0MywKICAgICAgICB9LAogICAgICAgIG51bWJlcjJzeW1ib2w6IHsKICAgICAgICAgIDI1NjogInNpbmdsZV9pbnB1dCIsCiAgICAgICAgICAyNTc6ICJhbmRfZXhwciIsCiAgICAgICAgICAyNTg6ICJhbmRfdGVzdCIsCiAgICAgICAgICAyNTk6ICJhbm5hc3NpZ24iLAogICAgICAgICAgMjYwOiAiYXJnbGlzdCIsCiAgICAgICAgICAyNjE6ICJhcmd1bWVudCIsCiAgICAgICAgICAyNjI6ICJhcml0aF9leHByIiwKICAgICAgICAgIDI2MzogImFzc2VydF9zdG10IiwKICAgICAgICAgIDI2NDogImFzeW5jX2Z1bmNkZWYiLAogICAgICAgICAgMjY1OiAiYXN5bmNfc3RtdCIsCiAgICAgICAgICAyNjY6ICJhdG9tIiwKICAgICAgICAgIDI2NzogImF0b21fZXhwciIsCiAgICAgICAgICAyNjg6ICJhdWdhc3NpZ24iLAogICAgICAgICAgMjY5OiAiYnJlYWtfc3RtdCIsCiAgICAgICAgICAyNzA6ICJjbGFzc2RlZiIsCiAgICAgICAgICAyNzE6ICJjb21wX2ZvciIsCiAgICAgICAgICAyNzI6ICJjb21wX2lmIiwKICAgICAgICAgIDI3MzogImNvbXBfaXRlciIsCiAgICAgICAgICAyNzQ6ICJjb21wX29wIiwKICAgICAgICAgIDI3NTogImNvbXBhcmlzb24iLAogICAgICAgICAgMjc2OiAiY29tcG91bmRfc3RtdCIsCiAgICAgICAgICAyNzc6ICJjb250aW51ZV9zdG10IiwKICAgICAgICAgIDI3ODogImRlYnVnZ2VyX3N0bXQiLAogICAgICAgICAgMjc5OiAiZGVjb3JhdGVkIiwKICAgICAgICAgIDI4MDogImRlY29yYXRvciIsCiAgICAgICAgICAyODE6ICJkZWNvcmF0b3JzIiwKICAgICAgICAgIDI4MjogImRlbF9zdG10IiwKICAgICAgICAgIDI4MzogImRpY3RvcnNldG1ha2VyIiwKICAgICAgICAgIDI4NDogImRvdHRlZF9hc19uYW1lIiwKICAgICAgICAgIDI4NTogImRvdHRlZF9hc19uYW1lcyIsCiAgICAgICAgICAyODY6ICJkb3R0ZWRfbmFtZSIsCiAgICAgICAgICAyODc6ICJlbmNvZGluZ19kZWNsIiwKICAgICAgICAgIDI4ODogImV2YWxfaW5wdXQiLAogICAgICAgICAgMjg5OiAiZXhjZXB0X2NsYXVzZSIsCiAgICAgICAgICAyOTA6ICJleHByIiwKICAgICAgICAgIDI5MTogImV4cHJfc3RtdCIsCiAgICAgICAgICAyOTI6ICJleHBybGlzdCIsCiAgICAgICAgICAyOTM6ICJmYWN0b3IiLAogICAgICAgICAgMjk0OiAiZmlsZV9pbnB1dCIsCiAgICAgICAgICAyOTU6ICJmbG93X3N0bXQiLAogICAgICAgICAgMjk2OiAiZm9yX3N0bXQiLAogICAgICAgICAgMjk3OiAiZnVuY2RlZiIsCiAgICAgICAgICAyOTg6ICJnbG9iYWxfc3RtdCIsCiAgICAgICAgICAyOTk6ICJpZl9zdG10IiwKICAgICAgICAgIDMwMDogImltcG9ydF9hc19uYW1lIiwKICAgICAgICAgIDMwMTogImltcG9ydF9hc19uYW1lcyIsCiAgICAgICAgICAzMDI6ICJpbXBvcnRfZnJvbSIsCiAgICAgICAgICAzMDM6ICJpbXBvcnRfbmFtZSIsCiAgICAgICAgICAzMDQ6ICJpbXBvcnRfc3RtdCIsCiAgICAgICAgICAzMDU6ICJsYW1iZGVmIiwKICAgICAgICAgIDMwNjogImxhbWJkZWZfbm9jb25kIiwKICAgICAgICAgIDMwNzogIm5vbmxvY2FsX3N0bXQiLAogICAgICAgICAgMzA4OiAibm90X3Rlc3QiLAogICAgICAgICAgMzA5OiAib3JfdGVzdCIsCiAgICAgICAgICAzMTA6ICJwYXJhbWV0ZXJzIiwKICAgICAgICAgIDMxMTogInBhc3Nfc3RtdCIsCiAgICAgICAgICAzMTI6ICJwb3dlciIsCiAgICAgICAgICAzMTM6ICJwcmludF9zdG10IiwKICAgICAgICAgIDMxNDogInJhaXNlX3N0bXQiLAogICAgICAgICAgMzE1OiAicmV0dXJuX3N0bXQiLAogICAgICAgICAgMzE2OiAic2hpZnRfZXhwciIsCiAgICAgICAgICAzMTc6ICJzaW1wbGVfc3RtdCIsCiAgICAgICAgICAzMTg6ICJzbGljZW9wIiwKICAgICAgICAgIDMxOTogInNtYWxsX3N0bXQiLAogICAgICAgICAgMzIwOiAic3Rhcl9leHByIiwKICAgICAgICAgIDMyMTogInN0bXQiLAogICAgICAgICAgMzIyOiAic3Vic2NyaXB0IiwKICAgICAgICAgIDMyMzogInN1YnNjcmlwdGxpc3QiLAogICAgICAgICAgMzI0OiAic3VpdGUiLAogICAgICAgICAgMzI1OiAidGVybSIsCiAgICAgICAgICAzMjY6ICJ0ZXN0IiwKICAgICAgICAgIDMyNzogInRlc3Rfbm9jb25kIiwKICAgICAgICAgIDMyODogInRlc3RsaXN0IiwKICAgICAgICAgIDMyOTogInRlc3RsaXN0X2NvbXAiLAogICAgICAgICAgMzMwOiAidGVzdGxpc3Rfc3Rhcl9leHByIiwKICAgICAgICAgIDMzMTogInRmcGRlZiIsCiAgICAgICAgICAzMzI6ICJ0cmFpbGVyIiwKICAgICAgICAgIDMzMzogInRyeV9zdG10IiwKICAgICAgICAgIDMzNDogInR5cGVkYXJnc2xpc3QiLAogICAgICAgICAgMzM1OiAidmFyYXJnc2xpc3QiLAogICAgICAgICAgMzM2OiAidmZwZGVmIiwKICAgICAgICAgIDMzNzogIndoaWxlX3N0bXQiLAogICAgICAgICAgMzM4OiAid2l0aF9pdGVtIiwKICAgICAgICAgIDMzOTogIndpdGhfc3RtdCIsCiAgICAgICAgICAzNDA6ICJ4b3JfZXhwciIsCiAgICAgICAgICAzNDE6ICJ5aWVsZF9hcmciLAogICAgICAgICAgMzQyOiAieWllbGRfZXhwciIsCiAgICAgICAgICAzNDM6ICJ5aWVsZF9zdG10IiwKICAgICAgICB9LAogICAgICAgIGRmYXM6IHsKICAgICAgICAgIDI1NjogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzEsIDFdLAogICAgICAgICAgICAgICAgWzIsIDFdLAogICAgICAgICAgICAgICAgWzMsIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAxXV0sCiAgICAgICAgICAgICAgW1syLCAxXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAyOiAxLAogICAgICAgICAgICAgIDQ6IDEsCiAgICAgICAgICAgICAgNTogMSwKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgODogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDEwOiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDEzOiAxLAogICAgICAgICAgICAgIDE0OiAxLAogICAgICAgICAgICAgIDE1OiAxLAogICAgICAgICAgICAgIDE2OiAxLAogICAgICAgICAgICAgIDE3OiAxLAogICAgICAgICAgICAgIDE4OiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIwOiAxLAogICAgICAgICAgICAgIDIxOiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDIzOiAxLAogICAgICAgICAgICAgIDI0OiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI2OiAxLAogICAgICAgICAgICAgIDI3OiAxLAogICAgICAgICAgICAgIDI4OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMxOiAxLAogICAgICAgICAgICAgIDMyOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM0OiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM2OiAxLAogICAgICAgICAgICAgIDM3OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDM5OiAxLAogICAgICAgICAgICAgIDQwOiAxLAogICAgICAgICAgICAgIDQxOiAxLAogICAgICAgICAgICAgIDQyOiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI1NzogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1s0NCwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0NSwgMF0sCiAgICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDY6IDEsCiAgICAgICAgICAgICAgNzogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI1ODogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1s0NiwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0NywgMF0sCiAgICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDY6IDEsCiAgICAgICAgICAgICAgNzogMSwKICAgICAgICAgICAgICA4OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMjU5OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzQ4LCAxXV0sCiAgICAgICAgICAgICAgW1s0OSwgMl1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MCwgM10sCiAgICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzQ5LCA0XV0sCiAgICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgNDg6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNjA6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbNTEsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTIsIDJdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUxLCAxXSwKICAgICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDg6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxNDogMSwKICAgICAgICAgICAgICAxNTogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgICA1MzogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNjE6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0OSwgMV0sCiAgICAgICAgICAgICAgICBbMTUsIDJdLAogICAgICAgICAgICAgICAgWzUzLCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MCwgMl0sCiAgICAgICAgICAgICAgICBbNTQsIDNdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1s0OSwgM11dLAogICAgICAgICAgICAgIFtbMCwgM11dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDg6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxNDogMSwKICAgICAgICAgICAgICAxNTogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgICA1MzogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNjI6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbNTUsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMzAsIDBdLAogICAgICAgICAgICAgICAgWzQzLCAwXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMjYzOiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzI0LCAxXV0sCiAgICAgICAgICAgICAgW1s0OSwgMl1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgM10sCiAgICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzQ5LCA0XV0sCiAgICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMjQ6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNjQ6IFtbW1sxMCwgMV1dLCBbWzU2LCAyXV0sIFtbMCwgMl1dXSwgeyAxMDogMSB9XSwKICAgICAgICAgIDI2NTogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxMCwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1NywgMl0sCiAgICAgICAgICAgICAgICBbNTYsIDJdLAogICAgICAgICAgICAgICAgWzU4LCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgMl1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDEwOiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMjY2OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNiwgMV0sCiAgICAgICAgICAgICAgICBbMjUsIDFdLAogICAgICAgICAgICAgICAgWzMzLCAxXSwKICAgICAgICAgICAgICAgIFs5LCAxXSwKICAgICAgICAgICAgICAgIFsxMSwgMV0sCiAgICAgICAgICAgICAgICBbMTIsIDJdLAogICAgICAgICAgICAgICAgWzM1LCAzXSwKICAgICAgICAgICAgICAgIFszOCwgNF0sCiAgICAgICAgICAgICAgICBbMTksIDFdLAogICAgICAgICAgICAgICAgWzcsIDVdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAxXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzU5LCAxXSwKICAgICAgICAgICAgICAgIFs2MCwgNl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNjEsIDFdLAogICAgICAgICAgICAgICAgWzYyLCA3XSwKICAgICAgICAgICAgICAgIFs2MywgN10sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNjQsIDFdLAogICAgICAgICAgICAgICAgWzYzLCA4XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs3LCA1XSwKICAgICAgICAgICAgICAgIFswLCA1XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbNTksIDFdXSwKICAgICAgICAgICAgICBbWzYxLCAxXV0sCiAgICAgICAgICAgICAgW1s2NCwgMV1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMjY3OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMjksIDFdLAogICAgICAgICAgICAgICAgWzY1LCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbNjUsIDJdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNjYsIDJdLAogICAgICAgICAgICAgICAgWzAsIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNjg6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs2NywgMV0sCiAgICAgICAgICAgICAgICBbNjgsIDFdLAogICAgICAgICAgICAgICAgWzY5LCAxXSwKICAgICAgICAgICAgICAgIFs3MCwgMV0sCiAgICAgICAgICAgICAgICBbNzEsIDFdLAogICAgICAgICAgICAgICAgWzcyLCAxXSwKICAgICAgICAgICAgICAgIFs3MywgMV0sCiAgICAgICAgICAgICAgICBbNzQsIDFdLAogICAgICAgICAgICAgICAgWzc1LCAxXSwKICAgICAgICAgICAgICAgIFs3NiwgMV0sCiAgICAgICAgICAgICAgICBbNzcsIDFdLAogICAgICAgICAgICAgICAgWzc4LCAxXSwKICAgICAgICAgICAgICAgIFs3OSwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzAsIDFdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDY3OiAxLAogICAgICAgICAgICAgIDY4OiAxLAogICAgICAgICAgICAgIDY5OiAxLAogICAgICAgICAgICAgIDcwOiAxLAogICAgICAgICAgICAgIDcxOiAxLAogICAgICAgICAgICAgIDcyOiAxLAogICAgICAgICAgICAgIDczOiAxLAogICAgICAgICAgICAgIDc0OiAxLAogICAgICAgICAgICAgIDc1OiAxLAogICAgICAgICAgICAgIDc2OiAxLAogICAgICAgICAgICAgIDc3OiAxLAogICAgICAgICAgICAgIDc4OiAxLAogICAgICAgICAgICAgIDc5OiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI2OTogW1tbWzM5LCAxXV0sIFtbMCwgMV1dXSwgeyAzOTogMSB9XSwKICAgICAgICAgIDI3MDogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxMywgMV1dLAogICAgICAgICAgICAgIFtbMjUsIDJdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNDgsIDNdLAogICAgICAgICAgICAgICAgWzM1LCA0XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbODAsIDVdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNjEsIDZdLAogICAgICAgICAgICAgICAgWzgxLCA3XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgNV1dLAogICAgICAgICAgICAgIFtbNDgsIDNdXSwKICAgICAgICAgICAgICBbWzYxLCA2XV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMTM6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNzE6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxMCwgMV0sCiAgICAgICAgICAgICAgICBbMzQsIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1szNCwgMl1dLAogICAgICAgICAgICAgIFtbODIsIDNdXSwKICAgICAgICAgICAgICBbWzgzLCA0XV0sCiAgICAgICAgICAgICAgW1s4NCwgNV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs4NSwgNl0sCiAgICAgICAgICAgICAgICBbMCwgNV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzAsIDZdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyAxMDogMSwgMzQ6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNzI6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbMzcsIDFdXSwKICAgICAgICAgICAgICBbWzg2LCAyXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzg1LCAzXSwKICAgICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgM11dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDM3OiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMjczOiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbODcsIDFdLAogICAgICAgICAgICAgICAgWzU0LCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDEwOiAxLCAzNDogMSwgMzc6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNzQ6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs4OCwgMV0sCiAgICAgICAgICAgICAgICBbODksIDFdLAogICAgICAgICAgICAgICAgWzgsIDJdLAogICAgICAgICAgICAgICAgWzkwLCAxXSwKICAgICAgICAgICAgICAgIFs4OCwgMV0sCiAgICAgICAgICAgICAgICBbODMsIDFdLAogICAgICAgICAgICAgICAgWzkxLCAxXSwKICAgICAgICAgICAgICAgIFs5MiwgM10sCiAgICAgICAgICAgICAgICBbOTMsIDFdLAogICAgICAgICAgICAgICAgWzk0LCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgICAgIFtbODMsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbOCwgMV0sCiAgICAgICAgICAgICAgICBbMCwgM10sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyA4OiAxLCA4MzogMSwgODg6IDEsIDg5OiAxLCA5MDogMSwgOTE6IDEsIDkyOiAxLCA5MzogMSwgOTQ6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNzU6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbOTUsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbOTYsIDBdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyNzY6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs5NywgMV0sCiAgICAgICAgICAgICAgICBbOTgsIDFdLAogICAgICAgICAgICAgICAgWzU4LCAxXSwKICAgICAgICAgICAgICAgIFs5OSwgMV0sCiAgICAgICAgICAgICAgICBbNTcsIDFdLAogICAgICAgICAgICAgICAgWzEwMCwgMV0sCiAgICAgICAgICAgICAgICBbNTYsIDFdLAogICAgICAgICAgICAgICAgWzEwMSwgMV0sCiAgICAgICAgICAgICAgICBbMTAyLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDQ6IDEsIDEwOiAxLCAxMzogMSwgMjA6IDEsIDIxOiAxLCAzNDogMSwgMzc6IDEsIDQxOiAxLCA0MjogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI3NzogW1tbWzQwLCAxXV0sIFtbMCwgMV1dXSwgeyA0MDogMSB9XSwKICAgICAgICAgIDI3ODogW1tbWzE3LCAxXV0sIFtbMCwgMV1dXSwgeyAxNzogMSB9XSwKICAgICAgICAgIDI3OTogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxMDMsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTYsIDJdLAogICAgICAgICAgICAgICAgWzEwNCwgMl0sCiAgICAgICAgICAgICAgICBbOTksIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgNDE6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyODA6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbNDEsIDFdXSwKICAgICAgICAgICAgICBbWzEwNSwgMl1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsyLCA0XSwKICAgICAgICAgICAgICAgIFszNSwgM10sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNjEsIDVdLAogICAgICAgICAgICAgICAgWzgxLCA2XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgNF1dLAogICAgICAgICAgICAgIFtbMiwgNF1dLAogICAgICAgICAgICAgIFtbNjEsIDVdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyA0MTogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI4MTogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxMDYsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTA2LCAxXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDQxOiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMjgyOiBbW1tbMjcsIDFdXSwgW1s4MiwgMl1dLCBbWzAsIDJdXV0sIHsgMjc6IDEgfV0sCiAgICAgICAgICAyODM6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0OSwgMV0sCiAgICAgICAgICAgICAgICBbMTA3LCAyXSwKICAgICAgICAgICAgICAgIFs1MywgM10sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNDgsIDRdLAogICAgICAgICAgICAgICAgWzU0LCA1XSwKICAgICAgICAgICAgICAgIFs1MiwgNl0sCiAgICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTQsIDVdLAogICAgICAgICAgICAgICAgWzUyLCA2XSwKICAgICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbOTUsIDddXSwKICAgICAgICAgICAgICBbWzQ5LCA3XV0sCiAgICAgICAgICAgICAgW1swLCA1XV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzQ5LCA4XSwKICAgICAgICAgICAgICAgIFsxMDcsIDhdLAogICAgICAgICAgICAgICAgWzAsIDZdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzU0LCA1XSwKICAgICAgICAgICAgICAgIFs1MiwgOV0sCiAgICAgICAgICAgICAgICBbMCwgN10sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTIsIDZdLAogICAgICAgICAgICAgICAgWzAsIDhdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzQ5LCAxMF0sCiAgICAgICAgICAgICAgICBbNTMsIDExXSwKICAgICAgICAgICAgICAgIFswLCA5XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbNDgsIDEyXV0sCiAgICAgICAgICAgICAgW1s5NSwgMTNdXSwKICAgICAgICAgICAgICBbWzQ5LCAxM11dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgOV0sCiAgICAgICAgICAgICAgICBbMCwgMTNdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgODogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDE0OiAxLAogICAgICAgICAgICAgIDE1OiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICAgIDUzOiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI4NDogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxMDUsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTA4LCAyXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMjUsIDNdXSwKICAgICAgICAgICAgICBbWzAsIDNdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyAyNTogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI4NTogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxMDksIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTIsIDBdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMjU6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyODY6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbMjUsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTEwLCAwXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDI1OiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMjg3OiBbW1tbMjUsIDFdXSwgW1swLCAxXV1dLCB7IDI1OiAxIH1dLAogICAgICAgICAgMjg4OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzExMSwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsyLCAxXSwKICAgICAgICAgICAgICAgIFsxMTIsIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgODogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDE0OiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI4OTogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxMTMsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNDksIDJdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzEwOCwgM10sCiAgICAgICAgICAgICAgICBbNTIsIDNdLAogICAgICAgICAgICAgICAgWzAsIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1s0OSwgNF1dLAogICAgICAgICAgICAgIFtbMCwgNF1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDExMzogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI5MDogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxMTQsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTE1LCAwXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMjkxOiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzExNiwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxMTcsIDJdLAogICAgICAgICAgICAgICAgWzUwLCAzXSwKICAgICAgICAgICAgICAgIFsxMTgsIDRdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzExMSwgNF0sCiAgICAgICAgICAgICAgICBbNjIsIDRdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzExNiwgNV0sCiAgICAgICAgICAgICAgICBbNjIsIDVdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUwLCAzXSwKICAgICAgICAgICAgICAgIFswLCA1XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDg6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxNDogMSwKICAgICAgICAgICAgICAxNTogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyOTI6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs5NSwgMV0sCiAgICAgICAgICAgICAgICBbMTA3LCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgMl0sCiAgICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbOTUsIDFdLAogICAgICAgICAgICAgICAgWzEwNywgMV0sCiAgICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDY6IDEsCiAgICAgICAgICAgICAgNzogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDE1OiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI5MzogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzExOSwgMl0sCiAgICAgICAgICAgICAgICBbMzAsIDFdLAogICAgICAgICAgICAgICAgWzIyLCAxXSwKICAgICAgICAgICAgICAgIFs0MywgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzEyMCwgMl1dLAogICAgICAgICAgICAgIFtbMCwgMl1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMjk0OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMiwgMF0sCiAgICAgICAgICAgICAgICBbMTEyLCAxXSwKICAgICAgICAgICAgICAgIFsxMjEsIDBdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAxXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAyOiAxLAogICAgICAgICAgICAgIDQ6IDEsCiAgICAgICAgICAgICAgNTogMSwKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgODogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDEwOiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDEzOiAxLAogICAgICAgICAgICAgIDE0OiAxLAogICAgICAgICAgICAgIDE1OiAxLAogICAgICAgICAgICAgIDE2OiAxLAogICAgICAgICAgICAgIDE3OiAxLAogICAgICAgICAgICAgIDE4OiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIwOiAxLAogICAgICAgICAgICAgIDIxOiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDIzOiAxLAogICAgICAgICAgICAgIDI0OiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI2OiAxLAogICAgICAgICAgICAgIDI3OiAxLAogICAgICAgICAgICAgIDI4OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMxOiAxLAogICAgICAgICAgICAgIDMyOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM0OiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM2OiAxLAogICAgICAgICAgICAgIDM3OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDM5OiAxLAogICAgICAgICAgICAgIDQwOiAxLAogICAgICAgICAgICAgIDQxOiAxLAogICAgICAgICAgICAgIDQyOiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICAgIDExMjogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyOTU6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxMjIsIDFdLAogICAgICAgICAgICAgICAgWzEyMywgMV0sCiAgICAgICAgICAgICAgICBbMTI0LCAxXSwKICAgICAgICAgICAgICAgIFsxMjUsIDFdLAogICAgICAgICAgICAgICAgWzEyNiwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzAsIDFdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyA1OiAxLCAyMzogMSwgMzE6IDEsIDM5OiAxLCA0MDogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI5NjogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1szNCwgMV1dLAogICAgICAgICAgICAgIFtbODIsIDJdXSwKICAgICAgICAgICAgICBbWzgzLCAzXV0sCiAgICAgICAgICAgICAgW1sxMTEsIDRdXSwKICAgICAgICAgICAgICBbWzQ4LCA1XV0sCiAgICAgICAgICAgICAgW1s4MCwgNl1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxMjcsIDddLAogICAgICAgICAgICAgICAgWzAsIDZdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1s0OCwgOF1dLAogICAgICAgICAgICAgIFtbODAsIDldXSwKICAgICAgICAgICAgICBbWzAsIDldXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyAzNDogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI5NzogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1s0LCAxXV0sCiAgICAgICAgICAgICAgW1syNSwgMl1dLAogICAgICAgICAgICAgIFtbMTI4LCAzXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzQ4LCA0XSwKICAgICAgICAgICAgICAgIFsxMjksIDVdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1s4MCwgNl1dLAogICAgICAgICAgICAgIFtbNDksIDddXSwKICAgICAgICAgICAgICBbWzAsIDZdXSwKICAgICAgICAgICAgICBbWzQ4LCA0XV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgNDogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDI5ODogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1syNiwgMV1dLAogICAgICAgICAgICAgIFtbMjUsIDJdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTIsIDFdLAogICAgICAgICAgICAgICAgWzAsIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMjY6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAyOTk6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbMzcsIDFdXSwKICAgICAgICAgICAgICBbWzQ5LCAyXV0sCiAgICAgICAgICAgICAgW1s0OCwgM11dLAogICAgICAgICAgICAgIFtbODAsIDRdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTI3LCA1XSwKICAgICAgICAgICAgICAgIFsxMzAsIDFdLAogICAgICAgICAgICAgICAgWzAsIDRdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1s0OCwgNl1dLAogICAgICAgICAgICAgIFtbODAsIDddXSwKICAgICAgICAgICAgICBbWzAsIDddXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyAzNzogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMwMDogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1syNSwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxMDgsIDJdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1syNSwgM11dLAogICAgICAgICAgICAgIFtbMCwgM11dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDI1OiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzAxOiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzEzMSwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgMl0sCiAgICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTMxLCAxXSwKICAgICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDI1OiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzAyOiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzM2LCAxXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzEwNSwgMl0sCiAgICAgICAgICAgICAgICBbMTksIDNdLAogICAgICAgICAgICAgICAgWzExMCwgM10sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzMyLCA0XV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzEwNSwgMl0sCiAgICAgICAgICAgICAgICBbMTksIDNdLAogICAgICAgICAgICAgICAgWzMyLCA0XSwKICAgICAgICAgICAgICAgIFsxMTAsIDNdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzEzMiwgNV0sCiAgICAgICAgICAgICAgICBbMTUsIDVdLAogICAgICAgICAgICAgICAgWzM1LCA2XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgNV1dLAogICAgICAgICAgICAgIFtbMTMyLCA3XV0sCiAgICAgICAgICAgICAgW1s2MSwgNV1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDM2OiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzAzOiBbW1tbMzIsIDFdXSwgW1sxMzMsIDJdXSwgW1swLCAyXV1dLCB7IDMyOiAxIH1dLAogICAgICAgICAgMzA0OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTM0LCAxXSwKICAgICAgICAgICAgICAgIFsxMzUsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAxXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMzI6IDEsIDM2OiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzA1OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzE0LCAxXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzQ4LCAyXSwKICAgICAgICAgICAgICAgIFsxMzYsIDNdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1s0OSwgNF1dLAogICAgICAgICAgICAgIFtbNDgsIDJdXSwKICAgICAgICAgICAgICBbWzAsIDRdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyAxNDogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMwNjogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxNCwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0OCwgMl0sCiAgICAgICAgICAgICAgICBbMTM2LCAzXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbODYsIDRdXSwKICAgICAgICAgICAgICBbWzQ4LCAyXV0sCiAgICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMTQ6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMDc6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbMTgsIDFdXSwKICAgICAgICAgICAgICBbWzI1LCAyXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUyLCAxXSwKICAgICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDE4OiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzA4OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbOCwgMV0sCiAgICAgICAgICAgICAgICBbMTM3LCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbNDYsIDJdXSwKICAgICAgICAgICAgICBbWzAsIDJdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDY6IDEsCiAgICAgICAgICAgICAgNzogMSwKICAgICAgICAgICAgICA4OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzA5OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzEzOCwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxMzksIDBdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgODogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMxMDogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1szNSwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs2MSwgMl0sCiAgICAgICAgICAgICAgICBbMTQwLCAzXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgMl1dLAogICAgICAgICAgICAgIFtbNjEsIDJdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyAzNTogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMxMTogW1tbWzI4LCAxXV0sIFtbMCwgMV1dXSwgeyAyODogMSB9XSwKICAgICAgICAgIDMxMjogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxNDEsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTMsIDJdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1sxMjAsIDNdXSwKICAgICAgICAgICAgICBbWzAsIDNdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDY6IDEsCiAgICAgICAgICAgICAgNzogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMxMzogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxNiwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0OSwgMl0sCiAgICAgICAgICAgICAgICBbMTQyLCAzXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgNF0sCiAgICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzQ5LCA1XV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzQ5LCAyXSwKICAgICAgICAgICAgICAgIFswLCA0XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgNl0sCiAgICAgICAgICAgICAgICBbMCwgNV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzQ5LCA3XV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUyLCA4XSwKICAgICAgICAgICAgICAgIFswLCA3XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0OSwgN10sCiAgICAgICAgICAgICAgICBbMCwgOF0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyAxNjogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMxNDogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1s1LCAxXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzQ5LCAyXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFszNiwgM10sCiAgICAgICAgICAgICAgICBbNTIsIDNdLAogICAgICAgICAgICAgICAgWzAsIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1s0OSwgNF1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgNV0sCiAgICAgICAgICAgICAgICBbMCwgNF0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzQ5LCA2XV0sCiAgICAgICAgICAgICAgW1swLCA2XV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgNTogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMxNTogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1syMywgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxMTEsIDJdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMjM6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMTY6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbMTQzLCAxXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzE0NCwgMF0sCiAgICAgICAgICAgICAgICBbMTQyLCAwXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzE3OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzE0NSwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsyLCAyXSwKICAgICAgICAgICAgICAgIFsxNDYsIDNdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzE0NSwgMV0sCiAgICAgICAgICAgICAgICBbMiwgMl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDU6IDEsCiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDg6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxNDogMSwKICAgICAgICAgICAgICAxNTogMSwKICAgICAgICAgICAgICAxNjogMSwKICAgICAgICAgICAgICAxNzogMSwKICAgICAgICAgICAgICAxODogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyMzogMSwKICAgICAgICAgICAgICAyNDogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyNjogMSwKICAgICAgICAgICAgICAyNzogMSwKICAgICAgICAgICAgICAyODogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMTogMSwKICAgICAgICAgICAgICAzMjogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzNjogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICAzOTogMSwKICAgICAgICAgICAgICA0MDogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMTg6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbNDgsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNDksIDJdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgNDg6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMTk6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNDcsIDFdLAogICAgICAgICAgICAgICAgWzE0OCwgMV0sCiAgICAgICAgICAgICAgICBbMTQ5LCAxXSwKICAgICAgICAgICAgICAgIFsxNTAsIDFdLAogICAgICAgICAgICAgICAgWzE1MSwgMV0sCiAgICAgICAgICAgICAgICBbMTUyLCAxXSwKICAgICAgICAgICAgICAgIFsxNTMsIDFdLAogICAgICAgICAgICAgICAgWzE1NCwgMV0sCiAgICAgICAgICAgICAgICBbMTU1LCAxXSwKICAgICAgICAgICAgICAgIFsxNTYsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAxXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICA1OiAxLAogICAgICAgICAgICAgIDY6IDEsCiAgICAgICAgICAgICAgNzogMSwKICAgICAgICAgICAgICA4OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTQ6IDEsCiAgICAgICAgICAgICAgMTU6IDEsCiAgICAgICAgICAgICAgMTY6IDEsCiAgICAgICAgICAgICAgMTc6IDEsCiAgICAgICAgICAgICAgMTg6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjM6IDEsCiAgICAgICAgICAgICAgMjQ6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjY6IDEsCiAgICAgICAgICAgICAgMjc6IDEsCiAgICAgICAgICAgICAgMjg6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzE6IDEsCiAgICAgICAgICAgICAgMzI6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzY6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgMzk6IDEsCiAgICAgICAgICAgICAgNDA6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzIwOiBbW1tbMTUsIDFdXSwgW1s5NSwgMl1dLCBbWzAsIDJdXV0sIHsgMTU6IDEgfV0sCiAgICAgICAgICAzMjE6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxLCAxXSwKICAgICAgICAgICAgICAgIFszLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNDogMSwKICAgICAgICAgICAgICA1OiAxLAogICAgICAgICAgICAgIDY6IDEsCiAgICAgICAgICAgICAgNzogMSwKICAgICAgICAgICAgICA4OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTA6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTM6IDEsCiAgICAgICAgICAgICAgMTQ6IDEsCiAgICAgICAgICAgICAgMTU6IDEsCiAgICAgICAgICAgICAgMTY6IDEsCiAgICAgICAgICAgICAgMTc6IDEsCiAgICAgICAgICAgICAgMTg6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjA6IDEsCiAgICAgICAgICAgICAgMjE6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjM6IDEsCiAgICAgICAgICAgICAgMjQ6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjY6IDEsCiAgICAgICAgICAgICAgMjc6IDEsCiAgICAgICAgICAgICAgMjg6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzE6IDEsCiAgICAgICAgICAgICAgMzI6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzQ6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzY6IDEsCiAgICAgICAgICAgICAgMzc6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgMzk6IDEsCiAgICAgICAgICAgICAgNDA6IDEsCiAgICAgICAgICAgICAgNDE6IDEsCiAgICAgICAgICAgICAgNDI6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzIyOiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNDksIDFdLAogICAgICAgICAgICAgICAgWzQ4LCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0OCwgMl0sCiAgICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNDksIDNdLAogICAgICAgICAgICAgICAgWzE1NywgNF0sCiAgICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTU3LCA0XSwKICAgICAgICAgICAgICAgIFswLCAzXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgNF1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDg6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxNDogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgICA0ODogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMjM6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbMTU4LCAxXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUyLCAyXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNTgsIDFdLAogICAgICAgICAgICAgICAgWzAsIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgODogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDE0OiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICAgIDQ4OiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMyNDogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzEsIDFdLAogICAgICAgICAgICAgICAgWzIsIDJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAxXV0sCiAgICAgICAgICAgICAgW1sxNTksIDNdXSwKICAgICAgICAgICAgICBbWzEyMSwgNF1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNjAsIDFdLAogICAgICAgICAgICAgICAgWzEyMSwgNF0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDI6IDEsCiAgICAgICAgICAgICAgNTogMSwKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgODogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDE0OiAxLAogICAgICAgICAgICAgIDE1OiAxLAogICAgICAgICAgICAgIDE2OiAxLAogICAgICAgICAgICAgIDE3OiAxLAogICAgICAgICAgICAgIDE4OiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDIzOiAxLAogICAgICAgICAgICAgIDI0OiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI2OiAxLAogICAgICAgICAgICAgIDI3OiAxLAogICAgICAgICAgICAgIDI4OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMxOiAxLAogICAgICAgICAgICAgIDMyOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM2OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDM5OiAxLAogICAgICAgICAgICAgIDQwOiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMyNTogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxMjAsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTYxLCAwXSwKICAgICAgICAgICAgICAgIFsxNSwgMF0sCiAgICAgICAgICAgICAgICBbMTYyLCAwXSwKICAgICAgICAgICAgICAgIFs0MSwgMF0sCiAgICAgICAgICAgICAgICBbMTYzLCAwXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzI2OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbODQsIDFdLAogICAgICAgICAgICAgICAgWzE2NCwgMl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMzcsIDNdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgICAgW1s4NCwgNF1dLAogICAgICAgICAgICAgIFtbMTI3LCA1XV0sCiAgICAgICAgICAgICAgW1s0OSwgMl1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDg6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxNDogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMjc6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNjUsIDFdLAogICAgICAgICAgICAgICAgWzg0LCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDg6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxNDogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMjg6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbNDksIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTIsIDJdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzQ5LCAxXSwKICAgICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDg6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxNDogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMjk6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0OSwgMV0sCiAgICAgICAgICAgICAgICBbMTA3LCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1NCwgMl0sCiAgICAgICAgICAgICAgICBbNTIsIDNdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzQ5LCA0XSwKICAgICAgICAgICAgICAgIFsxMDcsIDRdLAogICAgICAgICAgICAgICAgWzAsIDNdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUyLCAzXSwKICAgICAgICAgICAgICAgIFswLCA0XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDg6IDEsCiAgICAgICAgICAgICAgOTogMSwKICAgICAgICAgICAgICAxMTogMSwKICAgICAgICAgICAgICAxMjogMSwKICAgICAgICAgICAgICAxNDogMSwKICAgICAgICAgICAgICAxNTogMSwKICAgICAgICAgICAgICAxOTogMSwKICAgICAgICAgICAgICAyMjogMSwKICAgICAgICAgICAgICAyNTogMSwKICAgICAgICAgICAgICAyOTogMSwKICAgICAgICAgICAgICAzMDogMSwKICAgICAgICAgICAgICAzMzogMSwKICAgICAgICAgICAgICAzNTogMSwKICAgICAgICAgICAgICAzODogMSwKICAgICAgICAgICAgICA0MzogMSwKICAgICAgICAgICAgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMzA6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs0OSwgMV0sCiAgICAgICAgICAgICAgICBbMTA3LCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgMl0sCiAgICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNDksIDFdLAogICAgICAgICAgICAgICAgWzEwNywgMV0sCiAgICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDY6IDEsCiAgICAgICAgICAgICAgNzogMSwKICAgICAgICAgICAgICA4OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTQ6IDEsCiAgICAgICAgICAgICAgMTU6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzMxOiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzI1LCAxXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzQ4LCAyXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbNDksIDNdXSwKICAgICAgICAgICAgICBbWzAsIDNdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyAyNTogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMzMjogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzM1LCAxXSwKICAgICAgICAgICAgICAgIFsxMTAsIDJdLAogICAgICAgICAgICAgICAgWzM4LCAzXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs2MSwgNF0sCiAgICAgICAgICAgICAgICBbODEsIDVdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1syNSwgNF1dLAogICAgICAgICAgICAgIFtbMTY2LCA2XV0sCiAgICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICAgICAgW1s2MSwgNF1dLAogICAgICAgICAgICAgIFtbNjQsIDRdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyAzNTogMSwgMzg6IDEsIDExMDogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMzMzogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1syMCwgMV1dLAogICAgICAgICAgICAgIFtbNDgsIDJdXSwKICAgICAgICAgICAgICBbWzgwLCAzXV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzE2NywgNF0sCiAgICAgICAgICAgICAgICBbMTY4LCA1XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbNDgsIDZdXSwKICAgICAgICAgICAgICBbWzQ4LCA3XV0sCiAgICAgICAgICAgICAgW1s4MCwgOF1dLAogICAgICAgICAgICAgIFtbODAsIDldXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTY3LCA0XSwKICAgICAgICAgICAgICAgIFsxMjcsIDEwXSwKICAgICAgICAgICAgICAgIFsxNjgsIDVdLAogICAgICAgICAgICAgICAgWzAsIDhdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCA5XV0sCiAgICAgICAgICAgICAgW1s0OCwgMTFdXSwKICAgICAgICAgICAgICBbWzgwLCAxMl1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNjgsIDVdLAogICAgICAgICAgICAgICAgWzAsIDEyXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDIwOiAxIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzM0OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTUsIDFdLAogICAgICAgICAgICAgICAgWzE2OSwgMl0sCiAgICAgICAgICAgICAgICBbNTMsIDNdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzE2OSwgNF0sCiAgICAgICAgICAgICAgICBbNTIsIDVdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUwLCA2XSwKICAgICAgICAgICAgICAgIFs1MiwgN10sCiAgICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzE2OSwgOF1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgNV0sCiAgICAgICAgICAgICAgICBbMCwgNF0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTY5LCA5XSwKICAgICAgICAgICAgICAgIFs1MywgM10sCiAgICAgICAgICAgICAgICBbMCwgNV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzQ5LCAxMF1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNSwgMTFdLAogICAgICAgICAgICAgICAgWzE2OSwgMl0sCiAgICAgICAgICAgICAgICBbNTMsIDNdLAogICAgICAgICAgICAgICAgWzAsIDddLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUyLCAxMl0sCiAgICAgICAgICAgICAgICBbMCwgOF0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTAsIDEzXSwKICAgICAgICAgICAgICAgIFs1MiwgNV0sCiAgICAgICAgICAgICAgICBbMCwgOV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTIsIDddLAogICAgICAgICAgICAgICAgWzAsIDEwXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNjksIDE0XSwKICAgICAgICAgICAgICAgIFs1MiwgMTVdLAogICAgICAgICAgICAgICAgWzAsIDExXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMCwgMTJdXSwKICAgICAgICAgICAgICBbWzQ5LCA0XV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUyLCAxNV0sCiAgICAgICAgICAgICAgICBbMCwgMTRdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzE2OSwgMTZdLAogICAgICAgICAgICAgICAgWzUzLCAzXSwKICAgICAgICAgICAgICAgIFswLCAxNV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTAsIDE3XSwKICAgICAgICAgICAgICAgIFs1MiwgMTVdLAogICAgICAgICAgICAgICAgWzAsIDE2XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbNDksIDE0XV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMTU6IDEsIDI1OiAxLCA1MzogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDMzNTogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzE1LCAxXSwKICAgICAgICAgICAgICAgIFs1MywgMl0sCiAgICAgICAgICAgICAgICBbMTcwLCAzXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNzAsIDVdLAogICAgICAgICAgICAgICAgWzUyLCA0XSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbMTcwLCA2XV0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUwLCA3XSwKICAgICAgICAgICAgICAgIFs1MiwgOF0sCiAgICAgICAgICAgICAgICBbMCwgM10sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTMsIDJdLAogICAgICAgICAgICAgICAgWzE3MCwgOV0sCiAgICAgICAgICAgICAgICBbMCwgNF0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNTIsIDRdLAogICAgICAgICAgICAgICAgWzAsIDVdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUyLCAxMF0sCiAgICAgICAgICAgICAgICBbMCwgNl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzQ5LCAxMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNSwgMTJdLAogICAgICAgICAgICAgICAgWzUzLCAyXSwKICAgICAgICAgICAgICAgIFsxNzAsIDNdLAogICAgICAgICAgICAgICAgWzAsIDhdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUwLCAxM10sCiAgICAgICAgICAgICAgICBbNTIsIDRdLAogICAgICAgICAgICAgICAgWzAsIDldLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAxMF1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgOF0sCiAgICAgICAgICAgICAgICBbMCwgMTFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUyLCAxNV0sCiAgICAgICAgICAgICAgICBbMTcwLCAxNF0sCiAgICAgICAgICAgICAgICBbMCwgMTJdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1s0OSwgNV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MiwgMTVdLAogICAgICAgICAgICAgICAgWzAsIDE0XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFs1MywgMl0sCiAgICAgICAgICAgICAgICBbMTcwLCAxNl0sCiAgICAgICAgICAgICAgICBbMCwgMTVdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgWzUwLCAxN10sCiAgICAgICAgICAgICAgICBbNTIsIDE1XSwKICAgICAgICAgICAgICAgIFswLCAxNl0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzQ5LCAxNF1dLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7IDE1OiAxLCAyNTogMSwgNTM6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMzY6IFtbW1syNSwgMV1dLCBbWzAsIDFdXV0sIHsgMjU6IDEgfV0sCiAgICAgICAgICAzMzc6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbMjEsIDFdXSwKICAgICAgICAgICAgICBbWzQ5LCAyXV0sCiAgICAgICAgICAgICAgW1s0OCwgM11dLAogICAgICAgICAgICAgIFtbODAsIDRdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTI3LCA1XSwKICAgICAgICAgICAgICAgIFswLCA0XSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbNDgsIDZdXSwKICAgICAgICAgICAgICBbWzgwLCA3XV0sCiAgICAgICAgICAgICAgW1swLCA3XV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMjE6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzMzg6IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFtbNDksIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTA4LCAyXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbOTUsIDNdXSwKICAgICAgICAgICAgICBbWzAsIDNdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgewogICAgICAgICAgICAgIDY6IDEsCiAgICAgICAgICAgICAgNzogMSwKICAgICAgICAgICAgICA4OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTQ6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzM5OiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbWzQyLCAxXV0sCiAgICAgICAgICAgICAgW1sxNzEsIDJdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbNDgsIDNdLAogICAgICAgICAgICAgICAgWzUyLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIFtbODAsIDRdXSwKICAgICAgICAgICAgICBbWzAsIDRdXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgeyA0MjogMSB9LAogICAgICAgICAgXSwKICAgICAgICAgIDM0MDogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1sxNzIsIDFdXSwKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTczLCAwXSwKICAgICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgNjogMSwKICAgICAgICAgICAgICA3OiAxLAogICAgICAgICAgICAgIDk6IDEsCiAgICAgICAgICAgICAgMTE6IDEsCiAgICAgICAgICAgICAgMTI6IDEsCiAgICAgICAgICAgICAgMTk6IDEsCiAgICAgICAgICAgICAgMjI6IDEsCiAgICAgICAgICAgICAgMjU6IDEsCiAgICAgICAgICAgICAgMjk6IDEsCiAgICAgICAgICAgICAgMzA6IDEsCiAgICAgICAgICAgICAgMzM6IDEsCiAgICAgICAgICAgICAgMzU6IDEsCiAgICAgICAgICAgICAgMzg6IDEsCiAgICAgICAgICAgICAgNDM6IDEsCiAgICAgICAgICAgIH0sCiAgICAgICAgICBdLAogICAgICAgICAgMzQxOiBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBbMTExLCAyXSwKICAgICAgICAgICAgICAgIFszNiwgMV0sCiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBbWzQ5LCAyXV0sCiAgICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICA2OiAxLAogICAgICAgICAgICAgIDc6IDEsCiAgICAgICAgICAgICAgODogMSwKICAgICAgICAgICAgICA5OiAxLAogICAgICAgICAgICAgIDExOiAxLAogICAgICAgICAgICAgIDEyOiAxLAogICAgICAgICAgICAgIDE0OiAxLAogICAgICAgICAgICAgIDE5OiAxLAogICAgICAgICAgICAgIDIyOiAxLAogICAgICAgICAgICAgIDI1OiAxLAogICAgICAgICAgICAgIDI5OiAxLAogICAgICAgICAgICAgIDMwOiAxLAogICAgICAgICAgICAgIDMzOiAxLAogICAgICAgICAgICAgIDM1OiAxLAogICAgICAgICAgICAgIDM2OiAxLAogICAgICAgICAgICAgIDM4OiAxLAogICAgICAgICAgICAgIDQzOiAxLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICAgIDM0MjogWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgW1szMSwgMV1dLAogICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIFsxNzQsIDJdLAogICAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIHsgMzE6IDEgfSwKICAgICAgICAgIF0sCiAgICAgICAgICAzNDM6IFtbW1s2MiwgMV1dLCBbWzAsIDFdXV0sIHsgMzE6IDEgfV0sCiAgICAgICAgfSwKICAgICAgICBzdGF0ZXM6IFsKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxLCAxXSwKICAgICAgICAgICAgICBbMiwgMV0sCiAgICAgICAgICAgICAgWzMsIDJdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzAsIDFdXSwKICAgICAgICAgICAgW1syLCAxXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzQ0LCAxXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDUsIDBdLAogICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbNDYsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs0NywgMF0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1s0OCwgMV1dLAogICAgICAgICAgICBbWzQ5LCAyXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTAsIDNdLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s0OSwgNF1dLAogICAgICAgICAgICBbWzAsIDRdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbNTEsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MiwgMl0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUxLCAxXSwKICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ5LCAxXSwKICAgICAgICAgICAgICBbMTUsIDJdLAogICAgICAgICAgICAgIFs1MywgMl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTAsIDJdLAogICAgICAgICAgICAgIFs1NCwgM10sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzQ5LCAzXV0sCiAgICAgICAgICAgIFtbMCwgM11dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1s1NSwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzMwLCAwXSwKICAgICAgICAgICAgICBbNDMsIDBdLAogICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMjQsIDFdXSwKICAgICAgICAgICAgW1s0OSwgMl1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCAzXSwKICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbNDksIDRdXSwKICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICBdLAogICAgICAgICAgW1tbMTAsIDFdXSwgW1s1NiwgMl1dLCBbWzAsIDJdXV0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMTAsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1NywgMl0sCiAgICAgICAgICAgICAgWzU2LCAyXSwKICAgICAgICAgICAgICBbNTgsIDJdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzAsIDJdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNiwgMV0sCiAgICAgICAgICAgICAgWzI1LCAxXSwKICAgICAgICAgICAgICBbMzMsIDFdLAogICAgICAgICAgICAgIFs5LCAxXSwKICAgICAgICAgICAgICBbMTEsIDFdLAogICAgICAgICAgICAgIFsxMiwgMl0sCiAgICAgICAgICAgICAgWzM1LCAzXSwKICAgICAgICAgICAgICBbMzgsIDRdLAogICAgICAgICAgICAgIFsxOSwgMV0sCiAgICAgICAgICAgICAgWzcsIDVdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzAsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1OSwgMV0sCiAgICAgICAgICAgICAgWzYwLCA2XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs2MSwgMV0sCiAgICAgICAgICAgICAgWzYyLCA3XSwKICAgICAgICAgICAgICBbNjMsIDddLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzY0LCAxXSwKICAgICAgICAgICAgICBbNjMsIDhdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzcsIDVdLAogICAgICAgICAgICAgIFswLCA1XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s1OSwgMV1dLAogICAgICAgICAgICBbWzYxLCAxXV0sCiAgICAgICAgICAgIFtbNjQsIDFdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMjksIDFdLAogICAgICAgICAgICAgIFs2NSwgMl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbNjUsIDJdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs2NiwgMl0sCiAgICAgICAgICAgICAgWzAsIDJdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs2NywgMV0sCiAgICAgICAgICAgICAgWzY4LCAxXSwKICAgICAgICAgICAgICBbNjksIDFdLAogICAgICAgICAgICAgIFs3MCwgMV0sCiAgICAgICAgICAgICAgWzcxLCAxXSwKICAgICAgICAgICAgICBbNzIsIDFdLAogICAgICAgICAgICAgIFs3MywgMV0sCiAgICAgICAgICAgICAgWzc0LCAxXSwKICAgICAgICAgICAgICBbNzUsIDFdLAogICAgICAgICAgICAgIFs3NiwgMV0sCiAgICAgICAgICAgICAgWzc3LCAxXSwKICAgICAgICAgICAgICBbNzgsIDFdLAogICAgICAgICAgICAgIFs3OSwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgXSwKICAgICAgICAgIFtbWzM5LCAxXV0sIFtbMCwgMV1dXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1sxMywgMV1dLAogICAgICAgICAgICBbWzI1LCAyXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDgsIDNdLAogICAgICAgICAgICAgIFszNSwgNF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbODAsIDVdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs2MSwgNl0sCiAgICAgICAgICAgICAgWzgxLCA3XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCA1XV0sCiAgICAgICAgICAgIFtbNDgsIDNdXSwKICAgICAgICAgICAgW1s2MSwgNl1dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxMCwgMV0sCiAgICAgICAgICAgICAgWzM0LCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1szNCwgMl1dLAogICAgICAgICAgICBbWzgyLCAzXV0sCiAgICAgICAgICAgIFtbODMsIDRdXSwKICAgICAgICAgICAgW1s4NCwgNV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzg1LCA2XSwKICAgICAgICAgICAgICBbMCwgNV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMCwgNl1dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1szNywgMV1dLAogICAgICAgICAgICBbWzg2LCAyXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbODUsIDNdLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAzXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzg3LCAxXSwKICAgICAgICAgICAgICBbNTQsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzAsIDFdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbODgsIDFdLAogICAgICAgICAgICAgIFs4OSwgMV0sCiAgICAgICAgICAgICAgWzgsIDJdLAogICAgICAgICAgICAgIFs5MCwgMV0sCiAgICAgICAgICAgICAgWzg4LCAxXSwKICAgICAgICAgICAgICBbODMsIDFdLAogICAgICAgICAgICAgIFs5MSwgMV0sCiAgICAgICAgICAgICAgWzkyLCAzXSwKICAgICAgICAgICAgICBbOTMsIDFdLAogICAgICAgICAgICAgIFs5NCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgICBbWzgzLCAxXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbOCwgMV0sCiAgICAgICAgICAgICAgWzAsIDNdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1s5NSwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzk2LCAwXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzk3LCAxXSwKICAgICAgICAgICAgICBbOTgsIDFdLAogICAgICAgICAgICAgIFs1OCwgMV0sCiAgICAgICAgICAgICAgWzk5LCAxXSwKICAgICAgICAgICAgICBbNTcsIDFdLAogICAgICAgICAgICAgIFsxMDAsIDFdLAogICAgICAgICAgICAgIFs1NiwgMV0sCiAgICAgICAgICAgICAgWzEwMSwgMV0sCiAgICAgICAgICAgICAgWzEwMiwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgXSwKICAgICAgICAgIFtbWzQwLCAxXV0sIFtbMCwgMV1dXSwKICAgICAgICAgIFtbWzE3LCAxXV0sIFtbMCwgMV1dXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1sxMDMsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1NiwgMl0sCiAgICAgICAgICAgICAgWzEwNCwgMl0sCiAgICAgICAgICAgICAgWzk5LCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzQxLCAxXV0sCiAgICAgICAgICAgIFtbMTA1LCAyXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMiwgNF0sCiAgICAgICAgICAgICAgWzM1LCAzXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs2MSwgNV0sCiAgICAgICAgICAgICAgWzgxLCA2XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICAgIFtbMiwgNF1dLAogICAgICAgICAgICBbWzYxLCA1XV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzEwNiwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEwNiwgMV0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFtbWzI3LCAxXV0sIFtbODIsIDJdXSwgW1swLCAyXV1dLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ5LCAxXSwKICAgICAgICAgICAgICBbMTA3LCAyXSwKICAgICAgICAgICAgICBbNTMsIDNdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ4LCA0XSwKICAgICAgICAgICAgICBbNTQsIDVdLAogICAgICAgICAgICAgIFs1MiwgNl0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzU0LCA1XSwKICAgICAgICAgICAgICBbNTIsIDZdLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s5NSwgN11dLAogICAgICAgICAgICBbWzQ5LCA3XV0sCiAgICAgICAgICAgIFtbMCwgNV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ5LCA4XSwKICAgICAgICAgICAgICBbMTA3LCA4XSwKICAgICAgICAgICAgICBbMCwgNl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTQsIDVdLAogICAgICAgICAgICAgIFs1MiwgOV0sCiAgICAgICAgICAgICAgWzAsIDddLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCA2XSwKICAgICAgICAgICAgICBbMCwgOF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDksIDEwXSwKICAgICAgICAgICAgICBbNTMsIDExXSwKICAgICAgICAgICAgICBbMCwgOV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbNDgsIDEyXV0sCiAgICAgICAgICAgIFtbOTUsIDEzXV0sCiAgICAgICAgICAgIFtbNDksIDEzXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTIsIDldLAogICAgICAgICAgICAgIFswLCAxM10sCiAgICAgICAgICAgIF0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzEwNSwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEwOCwgMl0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzI1LCAzXV0sCiAgICAgICAgICAgIFtbMCwgM11dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1sxMDksIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MiwgMF0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1syNSwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzExMCwgMF0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFtbWzI1LCAxXV0sIFtbMCwgMV1dXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1sxMTEsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsyLCAxXSwKICAgICAgICAgICAgICBbMTEyLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzExMywgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ5LCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTA4LCAzXSwKICAgICAgICAgICAgICBbNTIsIDNdLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s0OSwgNF1dLAogICAgICAgICAgICBbWzAsIDRdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMTE0LCAxXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTE1LCAwXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzExNiwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzExNywgMl0sCiAgICAgICAgICAgICAgWzUwLCAzXSwKICAgICAgICAgICAgICBbMTE4LCA0XSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTExLCA0XSwKICAgICAgICAgICAgICBbNjIsIDRdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzExNiwgNV0sCiAgICAgICAgICAgICAgWzYyLCA1XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTAsIDNdLAogICAgICAgICAgICAgIFswLCA1XSwKICAgICAgICAgICAgXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbOTUsIDFdLAogICAgICAgICAgICAgIFsxMDcsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbOTUsIDFdLAogICAgICAgICAgICAgIFsxMDcsIDFdLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTE5LCAyXSwKICAgICAgICAgICAgICBbMzAsIDFdLAogICAgICAgICAgICAgIFsyMiwgMV0sCiAgICAgICAgICAgICAgWzQzLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1sxMjAsIDJdXSwKICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzIsIDBdLAogICAgICAgICAgICAgIFsxMTIsIDFdLAogICAgICAgICAgICAgIFsxMjEsIDBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzAsIDFdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTIyLCAxXSwKICAgICAgICAgICAgICBbMTIzLCAxXSwKICAgICAgICAgICAgICBbMTI0LCAxXSwKICAgICAgICAgICAgICBbMTI1LCAxXSwKICAgICAgICAgICAgICBbMTI2LCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAxXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzM0LCAxXV0sCiAgICAgICAgICAgIFtbODIsIDJdXSwKICAgICAgICAgICAgW1s4MywgM11dLAogICAgICAgICAgICBbWzExMSwgNF1dLAogICAgICAgICAgICBbWzQ4LCA1XV0sCiAgICAgICAgICAgIFtbODAsIDZdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxMjcsIDddLAogICAgICAgICAgICAgIFswLCA2XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s0OCwgOF1dLAogICAgICAgICAgICBbWzgwLCA5XV0sCiAgICAgICAgICAgIFtbMCwgOV1dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1s0LCAxXV0sCiAgICAgICAgICAgIFtbMjUsIDJdXSwKICAgICAgICAgICAgW1sxMjgsIDNdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs0OCwgNF0sCiAgICAgICAgICAgICAgWzEyOSwgNV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbODAsIDZdXSwKICAgICAgICAgICAgW1s0OSwgN11dLAogICAgICAgICAgICBbWzAsIDZdXSwKICAgICAgICAgICAgW1s0OCwgNF1dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1syNiwgMV1dLAogICAgICAgICAgICBbWzI1LCAyXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTIsIDFdLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMzcsIDFdXSwKICAgICAgICAgICAgW1s0OSwgMl1dLAogICAgICAgICAgICBbWzQ4LCAzXV0sCiAgICAgICAgICAgIFtbODAsIDRdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxMjcsIDVdLAogICAgICAgICAgICAgIFsxMzAsIDFdLAogICAgICAgICAgICAgIFswLCA0XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s0OCwgNl1dLAogICAgICAgICAgICBbWzgwLCA3XV0sCiAgICAgICAgICAgIFtbMCwgN11dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1syNSwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEwOCwgMl0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzI1LCAzXV0sCiAgICAgICAgICAgIFtbMCwgM11dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1sxMzEsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MiwgMl0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEzMSwgMV0sCiAgICAgICAgICAgICAgWzAsIDJdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1szNiwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEwNSwgMl0sCiAgICAgICAgICAgICAgWzE5LCAzXSwKICAgICAgICAgICAgICBbMTEwLCAzXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1szMiwgNF1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEwNSwgMl0sCiAgICAgICAgICAgICAgWzE5LCAzXSwKICAgICAgICAgICAgICBbMzIsIDRdLAogICAgICAgICAgICAgIFsxMTAsIDNdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEzMiwgNV0sCiAgICAgICAgICAgICAgWzE1LCA1XSwKICAgICAgICAgICAgICBbMzUsIDZdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzAsIDVdXSwKICAgICAgICAgICAgW1sxMzIsIDddXSwKICAgICAgICAgICAgW1s2MSwgNV1dLAogICAgICAgICAgXSwKICAgICAgICAgIFtbWzMyLCAxXV0sIFtbMTMzLCAyXV0sIFtbMCwgMl1dXSwKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxMzQsIDFdLAogICAgICAgICAgICAgIFsxMzUsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzAsIDFdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMTQsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs0OCwgMl0sCiAgICAgICAgICAgICAgWzEzNiwgM10sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbNDksIDRdXSwKICAgICAgICAgICAgW1s0OCwgMl1dLAogICAgICAgICAgICBbWzAsIDRdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMTQsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs0OCwgMl0sCiAgICAgICAgICAgICAgWzEzNiwgM10sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbODYsIDRdXSwKICAgICAgICAgICAgW1s0OCwgMl1dLAogICAgICAgICAgICBbWzAsIDRdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMTgsIDFdXSwKICAgICAgICAgICAgW1syNSwgMl1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCAxXSwKICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzgsIDFdLAogICAgICAgICAgICAgIFsxMzcsIDJdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzQ2LCAyXV0sCiAgICAgICAgICAgIFtbMCwgMl1dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1sxMzgsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxMzksIDBdLAogICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMzUsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs2MSwgMl0sCiAgICAgICAgICAgICAgWzE0MCwgM10sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMCwgMl1dLAogICAgICAgICAgICBbWzYxLCAyXV0sCiAgICAgICAgICBdLAogICAgICAgICAgW1tbMjgsIDFdXSwgW1swLCAxXV1dLAogICAgICAgICAgWwogICAgICAgICAgICBbWzE0MSwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUzLCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMTIwLCAzXV0sCiAgICAgICAgICAgIFtbMCwgM11dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1sxNiwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ5LCAyXSwKICAgICAgICAgICAgICBbMTQyLCAzXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTIsIDRdLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s0OSwgNV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ5LCAyXSwKICAgICAgICAgICAgICBbMCwgNF0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTIsIDZdLAogICAgICAgICAgICAgIFswLCA1XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s0OSwgN11dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCA4XSwKICAgICAgICAgICAgICBbMCwgN10sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDksIDddLAogICAgICAgICAgICAgIFswLCA4XSwKICAgICAgICAgICAgXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbNSwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ5LCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMzYsIDNdLAogICAgICAgICAgICAgIFs1MiwgM10sCiAgICAgICAgICAgICAgWzAsIDJdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzQ5LCA0XV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTIsIDVdLAogICAgICAgICAgICAgIFswLCA0XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s0OSwgNl1dLAogICAgICAgICAgICBbWzAsIDZdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMjMsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxMTEsIDJdLAogICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzE0MywgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzE0NCwgMF0sCiAgICAgICAgICAgICAgWzE0MiwgMF0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1sxNDUsIDFdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsyLCAyXSwKICAgICAgICAgICAgICBbMTQ2LCAzXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTQ1LCAxXSwKICAgICAgICAgICAgICBbMiwgMl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzQ4LCAxXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDksIDJdLAogICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzE0NywgMV0sCiAgICAgICAgICAgICAgWzE0OCwgMV0sCiAgICAgICAgICAgICAgWzE0OSwgMV0sCiAgICAgICAgICAgICAgWzE1MCwgMV0sCiAgICAgICAgICAgICAgWzE1MSwgMV0sCiAgICAgICAgICAgICAgWzE1MiwgMV0sCiAgICAgICAgICAgICAgWzE1MywgMV0sCiAgICAgICAgICAgICAgWzE1NCwgMV0sCiAgICAgICAgICAgICAgWzE1NSwgMV0sCiAgICAgICAgICAgICAgWzE1NiwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgXSwKICAgICAgICAgIFtbWzE1LCAxXV0sIFtbOTUsIDJdXSwgW1swLCAyXV1dLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEsIDFdLAogICAgICAgICAgICAgIFszLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAxXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ5LCAxXSwKICAgICAgICAgICAgICBbNDgsIDJdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ4LCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDksIDNdLAogICAgICAgICAgICAgIFsxNTcsIDRdLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxNTcsIDRdLAogICAgICAgICAgICAgIFswLCAzXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzE1OCwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTU4LCAxXSwKICAgICAgICAgICAgICBbMCwgMl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEsIDFdLAogICAgICAgICAgICAgIFsyLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAxXV0sCiAgICAgICAgICAgIFtbMTU5LCAzXV0sCiAgICAgICAgICAgIFtbMTIxLCA0XV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTYwLCAxXSwKICAgICAgICAgICAgICBbMTIxLCA0XSwKICAgICAgICAgICAgXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMTIwLCAxXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTYxLCAwXSwKICAgICAgICAgICAgICBbMTUsIDBdLAogICAgICAgICAgICAgIFsxNjIsIDBdLAogICAgICAgICAgICAgIFs0MSwgMF0sCiAgICAgICAgICAgICAgWzE2MywgMF0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs4NCwgMV0sCiAgICAgICAgICAgICAgWzE2NCwgMl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMzcsIDNdLAogICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgIFtbODQsIDRdXSwKICAgICAgICAgICAgW1sxMjcsIDVdXSwKICAgICAgICAgICAgW1s0OSwgMl1dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxNjUsIDFdLAogICAgICAgICAgICAgIFs4NCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMCwgMV1dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1s0OSwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDksIDFdLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDksIDFdLAogICAgICAgICAgICAgIFsxMDcsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzU0LCAyXSwKICAgICAgICAgICAgICBbNTIsIDNdLAogICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDksIDRdLAogICAgICAgICAgICAgIFsxMDcsIDRdLAogICAgICAgICAgICAgIFswLCAzXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MiwgM10sCiAgICAgICAgICAgICAgWzAsIDRdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs0OSwgMV0sCiAgICAgICAgICAgICAgWzEwNywgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTIsIDJdLAogICAgICAgICAgICAgIFswLCAxXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs0OSwgMV0sCiAgICAgICAgICAgICAgWzEwNywgMV0sCiAgICAgICAgICAgICAgWzAsIDJdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1syNSwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzQ4LCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbNDksIDNdXSwKICAgICAgICAgICAgW1swLCAzXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzM1LCAxXSwKICAgICAgICAgICAgICBbMTEwLCAyXSwKICAgICAgICAgICAgICBbMzgsIDNdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzYxLCA0XSwKICAgICAgICAgICAgICBbODEsIDVdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzI1LCA0XV0sCiAgICAgICAgICAgIFtbMTY2LCA2XV0sCiAgICAgICAgICAgIFtbMCwgNF1dLAogICAgICAgICAgICBbWzYxLCA0XV0sCiAgICAgICAgICAgIFtbNjQsIDRdXSwKICAgICAgICAgIF0sCiAgICAgICAgICBbCiAgICAgICAgICAgIFtbMjAsIDFdXSwKICAgICAgICAgICAgW1s0OCwgMl1dLAogICAgICAgICAgICBbWzgwLCAzXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTY3LCA0XSwKICAgICAgICAgICAgICBbMTY4LCA1XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s0OCwgNl1dLAogICAgICAgICAgICBbWzQ4LCA3XV0sCiAgICAgICAgICAgIFtbODAsIDhdXSwKICAgICAgICAgICAgW1s4MCwgOV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzE2NywgNF0sCiAgICAgICAgICAgICAgWzEyNywgMTBdLAogICAgICAgICAgICAgIFsxNjgsIDVdLAogICAgICAgICAgICAgIFswLCA4XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1swLCA5XV0sCiAgICAgICAgICAgIFtbNDgsIDExXV0sCiAgICAgICAgICAgIFtbODAsIDEyXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTY4LCA1XSwKICAgICAgICAgICAgICBbMCwgMTJdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxNSwgMV0sCiAgICAgICAgICAgICAgWzE2OSwgMl0sCiAgICAgICAgICAgICAgWzUzLCAzXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxNjksIDRdLAogICAgICAgICAgICAgIFs1MiwgNV0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUwLCA2XSwKICAgICAgICAgICAgICBbNTIsIDddLAogICAgICAgICAgICAgIFswLCAyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1sxNjksIDhdXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MiwgNV0sCiAgICAgICAgICAgICAgWzAsIDRdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzE2OSwgOV0sCiAgICAgICAgICAgICAgWzUzLCAzXSwKICAgICAgICAgICAgICBbMCwgNV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbNDksIDEwXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTUsIDExXSwKICAgICAgICAgICAgICBbMTY5LCAyXSwKICAgICAgICAgICAgICBbNTMsIDNdLAogICAgICAgICAgICAgIFswLCA3XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MiwgMTJdLAogICAgICAgICAgICAgIFswLCA4XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MCwgMTNdLAogICAgICAgICAgICAgIFs1MiwgNV0sCiAgICAgICAgICAgICAgWzAsIDldLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCA3XSwKICAgICAgICAgICAgICBbMCwgMTBdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzE2OSwgMTRdLAogICAgICAgICAgICAgIFs1MiwgMTVdLAogICAgICAgICAgICAgIFswLCAxMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMCwgMTJdXSwKICAgICAgICAgICAgW1s0OSwgNF1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCAxNV0sCiAgICAgICAgICAgICAgWzAsIDE0XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxNjksIDE2XSwKICAgICAgICAgICAgICBbNTMsIDNdLAogICAgICAgICAgICAgIFswLCAxNV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTAsIDE3XSwKICAgICAgICAgICAgICBbNTIsIDE1XSwKICAgICAgICAgICAgICBbMCwgMTZdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzQ5LCAxNF1dLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxNSwgMV0sCiAgICAgICAgICAgICAgWzUzLCAyXSwKICAgICAgICAgICAgICBbMTcwLCAzXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxNzAsIDVdLAogICAgICAgICAgICAgIFs1MiwgNF0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzE3MCwgNl1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUwLCA3XSwKICAgICAgICAgICAgICBbNTIsIDhdLAogICAgICAgICAgICAgIFswLCAzXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MywgMl0sCiAgICAgICAgICAgICAgWzE3MCwgOV0sCiAgICAgICAgICAgICAgWzAsIDRdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCA0XSwKICAgICAgICAgICAgICBbMCwgNV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTIsIDEwXSwKICAgICAgICAgICAgICBbMCwgNl0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbNDksIDExXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTUsIDEyXSwKICAgICAgICAgICAgICBbNTMsIDJdLAogICAgICAgICAgICAgIFsxNzAsIDNdLAogICAgICAgICAgICAgIFswLCA4XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MCwgMTNdLAogICAgICAgICAgICAgIFs1MiwgNF0sCiAgICAgICAgICAgICAgWzAsIDldLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzAsIDEwXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTIsIDhdLAogICAgICAgICAgICAgIFswLCAxMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTIsIDE1XSwKICAgICAgICAgICAgICBbMTcwLCAxNF0sCiAgICAgICAgICAgICAgWzAsIDEyXSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgW1s0OSwgNV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzUyLCAxNV0sCiAgICAgICAgICAgICAgWzAsIDE0XSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFs1MywgMl0sCiAgICAgICAgICAgICAgWzE3MCwgMTZdLAogICAgICAgICAgICAgIFswLCAxNV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNTAsIDE3XSwKICAgICAgICAgICAgICBbNTIsIDE1XSwKICAgICAgICAgICAgICBbMCwgMTZdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzQ5LCAxNF1dLAogICAgICAgICAgXSwKICAgICAgICAgIFtbWzI1LCAxXV0sIFtbMCwgMV1dXSwKICAgICAgICAgIFsKICAgICAgICAgICAgW1syMSwgMV1dLAogICAgICAgICAgICBbWzQ5LCAyXV0sCiAgICAgICAgICAgIFtbNDgsIDNdXSwKICAgICAgICAgICAgW1s4MCwgNF1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzEyNywgNV0sCiAgICAgICAgICAgICAgWzAsIDRdLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbWzQ4LCA2XV0sCiAgICAgICAgICAgIFtbODAsIDddXSwKICAgICAgICAgICAgW1swLCA3XV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzQ5LCAxXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTA4LCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbOTUsIDNdXSwKICAgICAgICAgICAgW1swLCAzXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzQyLCAxXV0sCiAgICAgICAgICAgIFtbMTcxLCAyXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbNDgsIDNdLAogICAgICAgICAgICAgIFs1MiwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbODAsIDRdXSwKICAgICAgICAgICAgW1swLCA0XV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzE3MiwgMV1dLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgWzE3MywgMF0sCiAgICAgICAgICAgICAgWzAsIDFdLAogICAgICAgICAgICBdLAogICAgICAgICAgXSwKICAgICAgICAgIFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgIFsxMTEsIDJdLAogICAgICAgICAgICAgIFszNiwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbNDksIDJdXSwKICAgICAgICAgICAgW1swLCAyXV0sCiAgICAgICAgICBdLAogICAgICAgICAgWwogICAgICAgICAgICBbWzMxLCAxXV0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICBbMTc0LCAyXSwKICAgICAgICAgICAgICBbMCwgMV0sCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFtbMCwgMl1dLAogICAgICAgICAgXSwKICAgICAgICAgIFtbWzYyLCAxXV0sIFtbMCwgMV1dXSwKICAgICAgICBdLAogICAgICAgIGxhYmVsczogWwogICAgICAgICAgWzAsICJFTVBUWSJdLAogICAgICAgICAgWzMxNywgbnVsbF0sCiAgICAgICAgICBbNCwgbnVsbF0sCiAgICAgICAgICBbMjc2LCBudWxsXSwKICAgICAgICAgIFsxLCAiZGVmIl0sCiAgICAgICAgICBbMSwgInJhaXNlIl0sCiAgICAgICAgICBbMSwgIlRydWUiXSwKICAgICAgICAgIFszLCBudWxsXSwKICAgICAgICAgIFsxLCAibm90Il0sCiAgICAgICAgICBbMSwgIm51bGwiXSwKICAgICAgICAgIFs1NSwgbnVsbF0sCiAgICAgICAgICBbMiwgbnVsbF0sCiAgICAgICAgICBbMjUsIG51bGxdLAogICAgICAgICAgWzEsICJjbGFzcyJdLAogICAgICAgICAgWzEsICJsYW1iZGEiXSwKICAgICAgICAgIFsxNiwgbnVsbF0sCiAgICAgICAgICBbMSwgInByaW50Il0sCiAgICAgICAgICBbMSwgImRlYnVnZ2VyIl0sCiAgICAgICAgICBbMSwgIm5vbmxvY2FsIl0sCiAgICAgICAgICBbNTIsIG51bGxdLAogICAgICAgICAgWzEsICJ0cnkiXSwKICAgICAgICAgIFsxLCAid2hpbGUiXSwKICAgICAgICAgIFszMSwgbnVsbF0sCiAgICAgICAgICBbMSwgInJldHVybiJdLAogICAgICAgICAgWzEsICJhc3NlcnQiXSwKICAgICAgICAgIFsxLCBudWxsXSwKICAgICAgICAgIFsxLCAiZ2xvYmFsIl0sCiAgICAgICAgICBbMSwgImRlbCJdLAogICAgICAgICAgWzEsICJwYXNzIl0sCiAgICAgICAgICBbNTQsIG51bGxdLAogICAgICAgICAgWzE1LCBudWxsXSwKICAgICAgICAgIFsxLCAieWllbGQiXSwKICAgICAgICAgIFsxLCAiaW1wb3J0Il0sCiAgICAgICAgICBbMSwgIkZhbHNlIl0sCiAgICAgICAgICBbMSwgImZvciJdLAogICAgICAgICAgWzcsIG51bGxdLAogICAgICAgICAgWzEsICJmcm9tIl0sCiAgICAgICAgICBbMSwgImlmIl0sCiAgICAgICAgICBbOSwgbnVsbF0sCiAgICAgICAgICBbMSwgImJyZWFrIl0sCiAgICAgICAgICBbMSwgImNvbnRpbnVlIl0sCiAgICAgICAgICBbNDksIG51bGxdLAogICAgICAgICAgWzEsICJ3aXRoIl0sCiAgICAgICAgICBbMTQsIG51bGxdLAogICAgICAgICAgWzMxNiwgbnVsbF0sCiAgICAgICAgICBbMTksIG51bGxdLAogICAgICAgICAgWzMwOCwgbnVsbF0sCiAgICAgICAgICBbMSwgImFuZCJdLAogICAgICAgICAgWzExLCBudWxsXSwKICAgICAgICAgIFszMjYsIG51bGxdLAogICAgICAgICAgWzIyLCBudWxsXSwKICAgICAgICAgIFsyNjEsIG51bGxdLAogICAgICAgICAgWzEyLCBudWxsXSwKICAgICAgICAgIFszNSwgbnVsbF0sCiAgICAgICAgICBbMjcxLCBudWxsXSwKICAgICAgICAgIFszMjUsIG51bGxdLAogICAgICAgICAgWzI5NywgbnVsbF0sCiAgICAgICAgICBbMzM5LCBudWxsXSwKICAgICAgICAgIFsyOTYsIG51bGxdLAogICAgICAgICAgWzI2LCBudWxsXSwKICAgICAgICAgIFsyODMsIG51bGxdLAogICAgICAgICAgWzgsIG51bGxdLAogICAgICAgICAgWzM0MiwgbnVsbF0sCiAgICAgICAgICBbMzI5LCBudWxsXSwKICAgICAgICAgIFsxMCwgbnVsbF0sCiAgICAgICAgICBbMjY2LCBudWxsXSwKICAgICAgICAgIFszMzIsIG51bGxdLAogICAgICAgICAgWzQ1LCBudWxsXSwKICAgICAgICAgIFszOCwgbnVsbF0sCiAgICAgICAgICBbNDAsIG51bGxdLAogICAgICAgICAgWzUwLCBudWxsXSwKICAgICAgICAgIFs0NiwgbnVsbF0sCiAgICAgICAgICBbNDEsIG51bGxdLAogICAgICAgICAgWzQyLCBudWxsXSwKICAgICAgICAgIFszNiwgbnVsbF0sCiAgICAgICAgICBbNDMsIG51bGxdLAogICAgICAgICAgWzQ4LCBudWxsXSwKICAgICAgICAgIFs0NCwgbnVsbF0sCiAgICAgICAgICBbMzcsIG51bGxdLAogICAgICAgICAgWzM5LCBudWxsXSwKICAgICAgICAgIFszMjQsIG51bGxdLAogICAgICAgICAgWzI2MCwgbnVsbF0sCiAgICAgICAgICBbMjkyLCBudWxsXSwKICAgICAgICAgIFsxLCAiaW4iXSwKICAgICAgICAgIFszMDksIG51bGxdLAogICAgICAgICAgWzI3MywgbnVsbF0sCiAgICAgICAgICBbMzI3LCBudWxsXSwKICAgICAgICAgIFsyNzIsIG51bGxdLAogICAgICAgICAgWzI4LCBudWxsXSwKICAgICAgICAgIFsyMSwgbnVsbF0sCiAgICAgICAgICBbMjcsIG51bGxdLAogICAgICAgICAgWzI5LCBudWxsXSwKICAgICAgICAgIFsxLCAiaXMiXSwKICAgICAgICAgIFszMCwgbnVsbF0sCiAgICAgICAgICBbMjAsIG51bGxdLAogICAgICAgICAgWzI5MCwgbnVsbF0sCiAgICAgICAgICBbMjc0LCBudWxsXSwKICAgICAgICAgIFszMzMsIG51bGxdLAogICAgICAgICAgWzI5OSwgbnVsbF0sCiAgICAgICAgICBbMjcwLCBudWxsXSwKICAgICAgICAgIFszMzcsIG51bGxdLAogICAgICAgICAgWzI3OSwgbnVsbF0sCiAgICAgICAgICBbMjY1LCBudWxsXSwKICAgICAgICAgIFsyODEsIG51bGxdLAogICAgICAgICAgWzI2NCwgbnVsbF0sCiAgICAgICAgICBbMjg2LCBudWxsXSwKICAgICAgICAgIFsyODAsIG51bGxdLAogICAgICAgICAgWzMyMCwgbnVsbF0sCiAgICAgICAgICBbMSwgImFzIl0sCiAgICAgICAgICBbMjg0LCBudWxsXSwKICAgICAgICAgIFsyMywgbnVsbF0sCiAgICAgICAgICBbMzI4LCBudWxsXSwKICAgICAgICAgIFswLCBudWxsXSwKICAgICAgICAgIFsxLCAiZXhjZXB0Il0sCiAgICAgICAgICBbMzQwLCBudWxsXSwKICAgICAgICAgIFsxOCwgbnVsbF0sCiAgICAgICAgICBbMzMwLCBudWxsXSwKICAgICAgICAgIFsyNjgsIG51bGxdLAogICAgICAgICAgWzI1OSwgbnVsbF0sCiAgICAgICAgICBbMzEyLCBudWxsXSwKICAgICAgICAgIFsyOTMsIG51bGxdLAogICAgICAgICAgWzMyMSwgbnVsbF0sCiAgICAgICAgICBbMjY5LCBudWxsXSwKICAgICAgICAgIFsyNzcsIG51bGxdLAogICAgICAgICAgWzMxNCwgbnVsbF0sCiAgICAgICAgICBbMzE1LCBudWxsXSwKICAgICAgICAgIFszNDMsIG51bGxdLAogICAgICAgICAgWzEsICJlbHNlIl0sCiAgICAgICAgICBbMzEwLCBudWxsXSwKICAgICAgICAgIFs1MSwgbnVsbF0sCiAgICAgICAgICBbMSwgImVsaWYiXSwKICAgICAgICAgIFszMDAsIG51bGxdLAogICAgICAgICAgWzMwMSwgbnVsbF0sCiAgICAgICAgICBbMjg1LCBudWxsXSwKICAgICAgICAgIFszMDMsIG51bGxdLAogICAgICAgICAgWzMwMiwgbnVsbF0sCiAgICAgICAgICBbMzM1LCBudWxsXSwKICAgICAgICAgIFsyNzUsIG51bGxdLAogICAgICAgICAgWzI1OCwgbnVsbF0sCiAgICAgICAgICBbMSwgIm9yIl0sCiAgICAgICAgICBbMzM0LCBudWxsXSwKICAgICAgICAgIFsyNjcsIG51bGxdLAogICAgICAgICAgWzM0LCBudWxsXSwKICAgICAgICAgIFsyNjIsIG51bGxdLAogICAgICAgICAgWzMzLCBudWxsXSwKICAgICAgICAgIFszMTksIG51bGxdLAogICAgICAgICAgWzEzLCBudWxsXSwKICAgICAgICAgIFsyOTUsIG51bGxdLAogICAgICAgICAgWzI2MywgbnVsbF0sCiAgICAgICAgICBbMjkxLCBudWxsXSwKICAgICAgICAgIFszMTEsIG51bGxdLAogICAgICAgICAgWzMwNywgbnVsbF0sCiAgICAgICAgICBbMzEzLCBudWxsXSwKICAgICAgICAgIFsyODIsIG51bGxdLAogICAgICAgICAgWzI5OCwgbnVsbF0sCiAgICAgICAgICBbMzA0LCBudWxsXSwKICAgICAgICAgIFsyNzgsIG51bGxdLAogICAgICAgICAgWzMxOCwgbnVsbF0sCiAgICAgICAgICBbMzIyLCBudWxsXSwKICAgICAgICAgIFs1LCBudWxsXSwKICAgICAgICAgIFs2LCBudWxsXSwKICAgICAgICAgIFs0NywgbnVsbF0sCiAgICAgICAgICBbMTcsIG51bGxdLAogICAgICAgICAgWzI0LCBudWxsXSwKICAgICAgICAgIFszMDUsIG51bGxdLAogICAgICAgICAgWzMwNiwgbnVsbF0sCiAgICAgICAgICBbMzIzLCBudWxsXSwKICAgICAgICAgIFsyODksIG51bGxdLAogICAgICAgICAgWzEsICJmaW5hbGx5Il0sCiAgICAgICAgICBbMzMxLCBudWxsXSwKICAgICAgICAgIFszMzYsIG51bGxdLAogICAgICAgICAgWzMzOCwgbnVsbF0sCiAgICAgICAgICBbMjU3LCBudWxsXSwKICAgICAgICAgIFszMiwgbnVsbF0sCiAgICAgICAgICBbMzQxLCBudWxsXSwKICAgICAgICBdLAogICAgICAgIGtleXdvcmRzOiB7CiAgICAgICAgICBGYWxzZTogMzMsCiAgICAgICAgICBudWxsOiA5LAogICAgICAgICAgVHJ1ZTogNiwKICAgICAgICAgIGFuZDogNDcsCiAgICAgICAgICBhczogMTA4LAogICAgICAgICAgYXNzZXJ0OiAyNCwKICAgICAgICAgIGJyZWFrOiAzOSwKICAgICAgICAgIGNsYXNzOiAxMywKICAgICAgICAgIGNvbnRpbnVlOiA0MCwKICAgICAgICAgIGRlYnVnZ2VyOiAxNywKICAgICAgICAgIGRlZjogNCwKICAgICAgICAgIGRlbDogMjcsCiAgICAgICAgICBlbGlmOiAxMzAsCiAgICAgICAgICBlbHNlOiAxMjcsCiAgICAgICAgICBleGNlcHQ6IDExMywKICAgICAgICAgIGZpbmFsbHk6IDE2OCwKICAgICAgICAgIGZvcjogMzQsCiAgICAgICAgICBmcm9tOiAzNiwKICAgICAgICAgIGdsb2JhbDogMjYsCiAgICAgICAgICBpZjogMzcsCiAgICAgICAgICBpbXBvcnQ6IDMyLAogICAgICAgICAgaW46IDgzLAogICAgICAgICAgaXM6IDkyLAogICAgICAgICAgbGFtYmRhOiAxNCwKICAgICAgICAgIG5vbmxvY2FsOiAxOCwKICAgICAgICAgIG5vdDogOCwKICAgICAgICAgIG9yOiAxMzksCiAgICAgICAgICBwYXNzOiAyOCwKICAgICAgICAgIHByaW50OiAxNiwKICAgICAgICAgIHJhaXNlOiA1LAogICAgICAgICAgcmV0dXJuOiAyMywKICAgICAgICAgIHRyeTogMjAsCiAgICAgICAgICB3aGlsZTogMjEsCiAgICAgICAgICB3aXRoOiA0MiwKICAgICAgICAgIHlpZWxkOiAzMSwKICAgICAgICB9LAogICAgICAgIHRva2VuczogewogICAgICAgICAgMDogMTEyLAogICAgICAgICAgMTogMjUsCiAgICAgICAgICAyOiAxMSwKICAgICAgICAgIDM6IDcsCiAgICAgICAgICA0OiAyLAogICAgICAgICAgNTogMTU5LAogICAgICAgICAgNjogMTYwLAogICAgICAgICAgNzogMzUsCiAgICAgICAgICA4OiA2MSwKICAgICAgICAgIDk6IDM4LAogICAgICAgICAgMTA6IDY0LAogICAgICAgICAgMTE6IDQ4LAogICAgICAgICAgMTI6IDUyLAogICAgICAgICAgMTM6IDE0NiwKICAgICAgICAgIDE0OiA0MywKICAgICAgICAgIDE1OiAzMCwKICAgICAgICAgIDE2OiAxNSwKICAgICAgICAgIDE3OiAxNjIsCiAgICAgICAgICAxODogMTE1LAogICAgICAgICAgMTk6IDQ1LAogICAgICAgICAgMjA6IDk0LAogICAgICAgICAgMjE6IDg5LAogICAgICAgICAgMjI6IDUwLAogICAgICAgICAgMjM6IDExMCwKICAgICAgICAgIDI0OiAxNjMsCiAgICAgICAgICAyNTogMTIsCiAgICAgICAgICAyNjogNTksCiAgICAgICAgICAyNzogOTAsCiAgICAgICAgICAyODogODgsCiAgICAgICAgICAyOTogOTEsCiAgICAgICAgICAzMDogOTMsCiAgICAgICAgICAzMTogMjIsCiAgICAgICAgICAzMjogMTczLAogICAgICAgICAgMzM6IDE0NCwKICAgICAgICAgIDM0OiAxNDIsCiAgICAgICAgICAzNTogNTMsCiAgICAgICAgICAzNjogNzQsCiAgICAgICAgICAzNzogNzgsCiAgICAgICAgICAzODogNjgsCiAgICAgICAgICAzOTogNzksCiAgICAgICAgICA0MDogNjksCiAgICAgICAgICA0MTogNzIsCiAgICAgICAgICA0MjogNzMsCiAgICAgICAgICA0MzogNzUsCiAgICAgICAgICA0NDogNzcsCiAgICAgICAgICA0NTogNjcsCiAgICAgICAgICA0NjogNzEsCiAgICAgICAgICA0NzogMTYxLAogICAgICAgICAgNDg6IDc2LAogICAgICAgICAgNDk6IDQxLAogICAgICAgICAgNTA6IDcwLAogICAgICAgICAgNTE6IDEyOSwKICAgICAgICAgIDUyOiAxOSwKICAgICAgICAgIDU0OiAyOSwKICAgICAgICAgIDU1OiAxMCwKICAgICAgICB9LAogICAgICAgIHN0YXJ0OiAyNTYsCiAgICAgIH0KICAgIH0sCiAgICBmdW5jdGlvbiAobSwgcCkgewogICAgICBmdW5jdGlvbiBhKGEsIGIpIHsKICAgICAgICB0aGlzLmZpbGVuYW1lID0gYQogICAgICAgIHRoaXMuZ3JhbW1hciA9IGIKICAgICAgICB0aGlzLnBfZmxhZ3MgPSAwCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBmdW5jdGlvbiBiKGIsIGQpIHsKICAgICAgICB2b2lkIDAgPT09IGQgJiYgKGQgPSAiZmlsZV9pbnB1dCIpCiAgICAgICAgYiA9IG5ldyBhKGIsIFNrLlBhcnNlVGFibGVzKQogICAgICAgICJmaWxlX2lucHV0IiA9PT0gZAogICAgICAgICAgPyBiLnNldHVwKFNrLlBhcnNlVGFibGVzLnN5bS5maWxlX2lucHV0KQogICAgICAgICAgOiBTay5hc3NlcnRzLmZhaWwoInRvZG87IikKICAgICAgICByZXR1cm4gYgogICAgICB9CiAgICAgIGEuRlVUVVJFX1BSSU5UX0ZVTkNUSU9OID0gInByaW50X2Z1bmN0aW9uIgogICAgICBhLkZVVFVSRV9VTklDT0RFX0xJVEVSQUxTID0gInVuaWNvZGVfbGl0ZXJhbHMiCiAgICAgIGEuRlVUVVJFX0RJVklTSU9OID0gImRpdmlzaW9uIgogICAgICBhLkZVVFVSRV9BQlNPTFVURV9JTVBPUlQgPSAiYWJzb2x1dGVfaW1wb3J0IgogICAgICBhLkZVVFVSRV9XSVRIX1NUQVRFTUVOVCA9ICJ3aXRoX3N0YXRlbWVudCIKICAgICAgYS5GVVRVUkVfTkVTVEVEX1NDT1BFUyA9ICJuZXN0ZWRfc2NvcGVzIgogICAgICBhLkZVVFVSRV9HRU5FUkFUT1JTID0gImdlbmVyYXRvcnMiCiAgICAgIGEuQ09fRlVUVVJFX1BSSU5UX0ZVTkNUSU9OID0gNjU1MzYKICAgICAgYS5DT19GVVRVUkVfVU5JQ09ERV9MSVRFUkFMUyA9IDEzMTA3MgogICAgICBhLkNPX0ZVVFVSRV9ESVZJU09OID0gODE5MgogICAgICBhLkNPX0ZVVFVSRV9BQlNPTFVURV9JTVBPUlQgPSAxNjM4NAogICAgICBhLkNPX0ZVVFVSRV9XSVRIX1NUQVRFTUVOVCA9IDMyNzY4CiAgICAgIGEucHJvdG90eXBlLnNldHVwID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBhID0gYSB8fCB0aGlzLmdyYW1tYXIuc3RhcnQKICAgICAgICB0aGlzLnN0YWNrID0gWwogICAgICAgICAgewogICAgICAgICAgICBkZmE6IHRoaXMuZ3JhbW1hci5kZmFzW2FdLAogICAgICAgICAgICBzdGF0ZTogMCwKICAgICAgICAgICAgbm9kZTogeyB0eXBlOiBhLCB2YWx1ZTogbnVsbCwgY29udGV4dDogbnVsbCwgY2hpbGRyZW46IFtdIH0sCiAgICAgICAgICB9LAogICAgICAgIF0KICAgICAgICB0aGlzLnVzZWRfbmFtZXMgPSB7fQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmFkZHRva2VuID0gZnVuY3Rpb24gKGEsIGIsIGUpIHsKICAgICAgICB2YXIgYywKICAgICAgICAgIGQgPSB0aGlzLmNsYXNzaWZ5KGEsIGIsIGUpCiAgICAgICAgYTogZm9yICg7OykgewogICAgICAgICAgdmFyIGggPSB0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoIC0gMV0KICAgICAgICAgIHZhciBrID0gaC5kZmFbMF0KICAgICAgICAgIHZhciBsID0ga1toLnN0YXRlXQogICAgICAgICAgZm9yIChjID0gMDsgYyA8IGwubGVuZ3RoOyArK2MpIHsKICAgICAgICAgICAgdmFyIHIgPSBsW2NdWzBdCiAgICAgICAgICAgIHZhciBuID0gbFtjXVsxXQogICAgICAgICAgICB2YXIgcSA9IHRoaXMuZ3JhbW1hci5sYWJlbHNbcl1bMF0KICAgICAgICAgICAgaWYgKGQgPT09IHIpIHsKICAgICAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgyNTYgPiBxKQogICAgICAgICAgICAgIHRoaXMuc2hpZnQoYSwgYiwgbiwgZSkKICAgICAgICAgICAgICBmb3IgKAogICAgICAgICAgICAgICAgZSA9IG47CiAgICAgICAgICAgICAgICAxID09PSBrW2VdLmxlbmd0aCAmJiAwID09PSBrW2VdWzBdWzBdICYmIGtbZV1bMF1bMV0gPT09IGU7CgogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy5wb3AoKQogICAgICAgICAgICAgICAgaWYgKDAgPT09IHRoaXMuc3RhY2subGVuZ3RoKSByZXR1cm4gITAKICAgICAgICAgICAgICAgIGggPSB0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoIC0gMV0KICAgICAgICAgICAgICAgIGUgPSBoLnN0YXRlCiAgICAgICAgICAgICAgICBrID0gaC5kZmFbMF0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuICExCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgIDI1NiA8PSBxICYmCiAgICAgICAgICAgICAgKChyID0gdGhpcy5ncmFtbWFyLmRmYXNbcV0pLCAociA9IHJbMV0pLCByLmhhc093blByb3BlcnR5KGQpKQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICB0aGlzLnB1c2gocSwgdGhpcy5ncmFtbWFyLmRmYXNbcV0sIG4sIGUpCiAgICAgICAgICAgICAgY29udGludWUgYQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBiOiB7CiAgICAgICAgICAgIGsgPSBbMCwgaC5zdGF0ZV0KICAgICAgICAgICAgZm9yIChoID0gbC5sZW5ndGg7IGgtLTsgKQogICAgICAgICAgICAgIGlmIChsW2hdWzBdID09PSBrWzBdICYmIGxbaF1bMV0gPT09IGtbMV0pIHsKICAgICAgICAgICAgICAgIGwgPSAhMAogICAgICAgICAgICAgICAgYnJlYWsgYgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgbCA9ICExCiAgICAgICAgICB9CiAgICAgICAgICBpZiAobCkgewogICAgICAgICAgICBpZiAoKHRoaXMucG9wKCksIDAgPT09IHRoaXMuc3RhY2subGVuZ3RoKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigidG9vIG11Y2ggaW5wdXQiLCB0aGlzLmZpbGVuYW1lKQogICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHRocm93ICgKICAgICAgICAgICAgICAoKGEgPSBlWzBdWzBdKSwKICAgICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigiYmFkIGlucHV0IiwgdGhpcy5maWxlbmFtZSwgYSwgZSkpCiAgICAgICAgICAgICkKICAgICAgICB9CiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY2xhc3NpZnkgPSBmdW5jdGlvbiAoYiwgZCwgZSkgewogICAgICAgIGlmIChiID09PSBTay50b2tlbi50b2tlbnMuVF9OQU1FKSB7CiAgICAgICAgICB0aGlzLnVzZWRfbmFtZXNbZF0gPSAhMAogICAgICAgICAgdmFyIGMgPQogICAgICAgICAgICB0aGlzLmdyYW1tYXIua2V5d29yZHMuaGFzT3duUHJvcGVydHkoZCkgJiYgdGhpcy5ncmFtbWFyLmtleXdvcmRzW2RdCiAgICAgICAgICAicHJpbnQiID09PSBkICYmCiAgICAgICAgICAgICh0aGlzLnBfZmxhZ3MgJiBhLkNPX0ZVVFVSRV9QUklOVF9GVU5DVElPTiB8fAogICAgICAgICAgICAgICEwID09PSBTay5fX2Z1dHVyZV9fLnByaW50X2Z1bmN0aW9uKSAmJgogICAgICAgICAgICAoYyA9ICExKQogICAgICAgICAgaWYgKGMpIHJldHVybiBjCiAgICAgICAgfQogICAgICAgIGMgPSB0aGlzLmdyYW1tYXIudG9rZW5zLmhhc093blByb3BlcnR5KGIpICYmIHRoaXMuZ3JhbW1hci50b2tlbnNbYl0KICAgICAgICBpZiAoIWMpIHsKICAgICAgICAgIGQgPSAiIyIgKyBiCiAgICAgICAgICBmb3IgKGxldCBhIGluIFNrLnRva2VuLnRva2VucykKICAgICAgICAgICAgaWYgKFNrLnRva2VuLnRva2Vuc1thXSA9PSBiKSB7CiAgICAgICAgICAgICAgZCA9IGEKICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICB9CiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgImJhZCB0b2tlbiAiICsgZCwKICAgICAgICAgICAgdGhpcy5maWxlbmFtZSwKICAgICAgICAgICAgZVswXVswXSwKICAgICAgICAgICAgZSwKICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGMKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5zaGlmdCA9IGZ1bmN0aW9uIChhLCBiLCBlLCBmKSB7CiAgICAgICAgdmFyIGMgPSB0aGlzLnN0YWNrW3RoaXMuc3RhY2subGVuZ3RoIC0gMV0uZGZhLAogICAgICAgICAgZCA9IHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSAxXS5ub2RlCiAgICAgICAgZC5jaGlsZHJlbi5wdXNoKHsKICAgICAgICAgIHR5cGU6IGEsCiAgICAgICAgICB2YWx1ZTogYiwKICAgICAgICAgIGxpbmVubzogZlswXVswXSwKICAgICAgICAgIGNvbF9vZmZzZXQ6IGZbMF1bMV0sCiAgICAgICAgICBjaGlsZHJlbjogbnVsbCwKICAgICAgICB9KQogICAgICAgIHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSAxXSA9IHsgZGZhOiBjLCBzdGF0ZTogZSwgbm9kZTogZCB9CiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUucHVzaCA9IGZ1bmN0aW9uIChhLCBiLCBlLCBmKSB7CiAgICAgICAgYSA9IHsKICAgICAgICAgIHR5cGU6IGEsCiAgICAgICAgICB2YWx1ZTogbnVsbCwKICAgICAgICAgIGxpbmVubzogZlswXVswXSwKICAgICAgICAgIGNvbF9vZmZzZXQ6IGZbMF1bMV0sCiAgICAgICAgICBjaGlsZHJlbjogW10sCiAgICAgICAgfQogICAgICAgIHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSAxXSA9IHsKICAgICAgICAgIGRmYTogdGhpcy5zdGFja1t0aGlzLnN0YWNrLmxlbmd0aCAtIDFdLmRmYSwKICAgICAgICAgIHN0YXRlOiBlLAogICAgICAgICAgbm9kZTogdGhpcy5zdGFja1t0aGlzLnN0YWNrLmxlbmd0aCAtIDFdLm5vZGUsCiAgICAgICAgfQogICAgICAgIHRoaXMuc3RhY2sucHVzaCh7IGRmYTogYiwgc3RhdGU6IDAsIG5vZGU6IGEgfSkKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5wb3AgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLnN0YWNrLnBvcCgpLm5vZGUKICAgICAgICBpZiAoYSkKICAgICAgICAgIGlmICgwICE9PSB0aGlzLnN0YWNrLmxlbmd0aCkgewogICAgICAgICAgICB2YXIgYiA9IHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSAxXS5ub2RlCiAgICAgICAgICAgIGIuY2hpbGRyZW4ucHVzaChhKQogICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICh0aGlzLnJvb3Rub2RlID0gYSksICh0aGlzLnJvb3Rub2RlLnVzZWRfbmFtZXMgPSB0aGlzLnVzZWRfbmFtZXMpCiAgICAgIH0KICAgICAgU2sucGFyc2UgPSBmdW5jdGlvbiAoYSwgZCkgewogICAgICAgIHZhciBjID0gU2sudG9rZW4udG9rZW5zLlRfQ09NTUVOVCwKICAgICAgICAgIGYgPSBTay50b2tlbi50b2tlbnMuVF9OTCwKICAgICAgICAgIGcgPSBTay50b2tlbi50b2tlbnMuVF9PUCwKICAgICAgICAgIGggPSBTay50b2tlbi50b2tlbnMuVF9FTkRNQVJLRVIsCiAgICAgICAgICBrID0gU2sudG9rZW4udG9rZW5zLlRfRU5DT0RJTkcsCiAgICAgICAgICBsID0gITEsCiAgICAgICAgICByID0gYihhKQogICAgICAgIFNrLl90b2tlbml6ZSgKICAgICAgICAgIGEsCiAgICAgICAgICAoZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgdmFyIGIgPSBhCiAgICAgICAgICAgICAgLnNwbGl0KCJcbiIpCiAgICAgICAgICAgICAgLnJldmVyc2UoKQogICAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhICsgIlxuIgogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgaWYgKDAgPT09IGIubGVuZ3RoKSB0aHJvdyBuZXcgU2suYnVpbHRpbi5FeGNlcHRpb24oIkVPRiIpCiAgICAgICAgICAgICAgcmV0dXJuIGIucG9wKCkKICAgICAgICAgICAgfQogICAgICAgICAgfSkoZCksCiAgICAgICAgICAidXRmLTgiLAogICAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgdmFyIGIgPSBudWxsCiAgICAgICAgICAgIGEudHlwZSAhPT0gYyAmJgogICAgICAgICAgICAgIGEudHlwZSAhPT0gZiAmJgogICAgICAgICAgICAgIGEudHlwZSAhPT0gayAmJgogICAgICAgICAgICAgIChhLnR5cGUgPT09IGcgJiYgKGIgPSBTay5PcE1hcFthLnN0cmluZ10pLAogICAgICAgICAgICAgIHIuYWRkdG9rZW4oYiB8fCBhLnR5cGUsIGEuc3RyaW5nLCBbYS5zdGFydCwgYS5lbmQsIGEubGluZV0pLAogICAgICAgICAgICAgIGEudHlwZSA9PT0gaCAmJiAobCA9ICEwKSkKICAgICAgICAgIH0sCiAgICAgICAgKQogICAgICAgIGlmICghbCkKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKCJpbmNvbXBsZXRlIGlucHV0IiwgdGhpcy5maWxlbmFtZSkKICAgICAgICByZXR1cm4geyBjc3Q6IHIucm9vdG5vZGUsIGZsYWdzOiByLnBfZmxhZ3MgfQogICAgICB9CiAgICAgIFNrLnBhcnNlVHJlZUR1bXAgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjCiAgICAgICAgYiA9IGIgfHwgIiIKICAgICAgICB2YXIgZCA9ICIiICsgYgogICAgICAgIGlmICgyNTYgPD0gYS50eXBlKQogICAgICAgICAgZm9yICgKICAgICAgICAgICAgZCArPSBTay5QYXJzZVRhYmxlcy5udW1iZXIyc3ltYm9sW2EudHlwZV0gKyAiXG4iLCBjID0gMDsKICAgICAgICAgICAgYyA8IGEuY2hpbGRyZW4ubGVuZ3RoOwogICAgICAgICAgICArK2MKICAgICAgICAgICkKICAgICAgICAgICAgZCArPSBTay5wYXJzZVRyZWVEdW1wKGEuY2hpbGRyZW5bY10sIGIgKyAiICAiKQogICAgICAgIGVsc2UKICAgICAgICAgIGQgKz0KICAgICAgICAgICAgU2sudG9rZW4udG9rX25hbWVbYS50eXBlXSArCiAgICAgICAgICAgICI6ICIgKwogICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5zdHIoYS52YWx1ZSkuJHIoKS52ICsKICAgICAgICAgICAgIlxuIgogICAgICAgIHJldHVybiBkCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5QYXJzZXIiLCBhKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLnBhcnNlIiwgU2sucGFyc2UpCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2sucGFyc2VUcmVlRHVtcCIsIFNrLnBhcnNlVHJlZUR1bXApCiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHApIHsKICAgICAgU2suYXN0bm9kZXMgPSB7fQogICAgICBTay5hc3Rub2Rlcy5Mb2FkID0gZnVuY3Rpb24gKCkge30KICAgICAgU2suYXN0bm9kZXMuU3RvcmUgPSBmdW5jdGlvbiAoKSB7fQogICAgICBTay5hc3Rub2Rlcy5EZWwgPSBmdW5jdGlvbiAoKSB7fQogICAgICBTay5hc3Rub2Rlcy5BdWdMb2FkID0gZnVuY3Rpb24gKCkge30KICAgICAgU2suYXN0bm9kZXMuQXVnU3RvcmUgPSBmdW5jdGlvbiAoKSB7fQogICAgICBTay5hc3Rub2Rlcy5QYXJhbSA9IGZ1bmN0aW9uICgpIHt9CiAgICAgIFNrLmFzdG5vZGVzLkFuZCA9IGZ1bmN0aW9uICgpIHt9CiAgICAgIFNrLmFzdG5vZGVzLk9yID0gZnVuY3Rpb24gKCkge30KICAgICAgU2suYXN0bm9kZXMuQWRkID0gZnVuY3Rpb24gKCkge30KICAgICAgU2suYXN0bm9kZXMuU3ViID0gZnVuY3Rpb24gKCkge30KICAgICAgU2suYXN0bm9kZXMuTXVsdCA9IGZ1bmN0aW9uICgpIHt9CiAgICAgIFNrLmFzdG5vZGVzLk1hdE11bHQgPSBmdW5jdGlvbiAoKSB7fQogICAgICBTay5hc3Rub2Rlcy5EaXYgPSBmdW5jdGlvbiAoKSB7fQogICAgICBTay5hc3Rub2Rlcy5Nb2QgPSBmdW5jdGlvbiAoKSB7fQogICAgICBTay5hc3Rub2Rlcy5Qb3cgPSBmdW5jdGlvbiAoKSB7fQogICAgICBTay5hc3Rub2Rlcy5MU2hpZnQgPSBmdW5jdGlvbiAoKSB7fQogICAgICBTay5hc3Rub2Rlcy5SU2hpZnQgPSBmdW5jdGlvbiAoKSB7fQogICAgICBTay5hc3Rub2Rlcy5CaXRPciA9IGZ1bmN0aW9uICgpIHt9CiAgICAgIFNrLmFzdG5vZGVzLkJpdFhvciA9IGZ1bmN0aW9uICgpIHt9CiAgICAgIFNrLmFzdG5vZGVzLkJpdEFuZCA9IGZ1bmN0aW9uICgpIHt9CiAgICAgIFNrLmFzdG5vZGVzLkZsb29yRGl2ID0gZnVuY3Rpb24gKCkge30KICAgICAgU2suYXN0bm9kZXMuSW52ZXJ0ID0gZnVuY3Rpb24gKCkge30KICAgICAgU2suYXN0bm9kZXMuTm90ID0gZnVuY3Rpb24gKCkge30KICAgICAgU2suYXN0bm9kZXMuVUFkZCA9IGZ1bmN0aW9uICgpIHt9CiAgICAgIFNrLmFzdG5vZGVzLlVTdWIgPSBmdW5jdGlvbiAoKSB7fQogICAgICBTay5hc3Rub2Rlcy5FcSA9IGZ1bmN0aW9uICgpIHt9CiAgICAgIFNrLmFzdG5vZGVzLk5vdEVxID0gZnVuY3Rpb24gKCkge30KICAgICAgU2suYXN0bm9kZXMuTHQgPSBmdW5jdGlvbiAoKSB7fQogICAgICBTay5hc3Rub2Rlcy5MdEUgPSBmdW5jdGlvbiAoKSB7fQogICAgICBTay5hc3Rub2Rlcy5HdCA9IGZ1bmN0aW9uICgpIHt9CiAgICAgIFNrLmFzdG5vZGVzLkd0RSA9IGZ1bmN0aW9uICgpIHt9CiAgICAgIFNrLmFzdG5vZGVzLklzID0gZnVuY3Rpb24gKCkge30KICAgICAgU2suYXN0bm9kZXMuSXNOb3QgPSBmdW5jdGlvbiAoKSB7fQogICAgICBTay5hc3Rub2Rlcy5JbiA9IGZ1bmN0aW9uICgpIHt9CiAgICAgIFNrLmFzdG5vZGVzLk5vdEluID0gZnVuY3Rpb24gKCkge30KICAgICAgU2suYXN0bm9kZXMuTW9kdWxlID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB0aGlzLmJvZHkgPSBhCiAgICAgICAgdGhpcy5kb2NzdHJpbmcgPSBiCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5JbnRlcmFjdGl2ZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdGhpcy5ib2R5ID0gYQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuRXhwcmVzc2lvbiA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdGhpcy5ib2R5ID0gYQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuU3VpdGUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHRoaXMuYm9keSA9IGEKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkZ1bmN0aW9uRGVmID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBnICYmIHZvaWQgMCAhPT0gZykKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBoICYmIHZvaWQgMCAhPT0gaCkKICAgICAgICB0aGlzLm5hbWUgPSBhCiAgICAgICAgdGhpcy5hcmdzID0gYgogICAgICAgIHRoaXMuYm9keSA9IGMKICAgICAgICB0aGlzLmRlY29yYXRvcl9saXN0ID0gZAogICAgICAgIHRoaXMucmV0dXJucyA9IGUKICAgICAgICB0aGlzLmRvY3N0cmluZyA9IGYKICAgICAgICB0aGlzLmxpbmVubyA9IGcKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBoCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5Bc3luY0Z1bmN0aW9uRGVmID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBnICYmIHZvaWQgMCAhPT0gZykKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBoICYmIHZvaWQgMCAhPT0gaCkKICAgICAgICB0aGlzLm5hbWUgPSBhCiAgICAgICAgdGhpcy5hcmdzID0gYgogICAgICAgIHRoaXMuYm9keSA9IGMKICAgICAgICB0aGlzLmRlY29yYXRvcl9saXN0ID0gZAogICAgICAgIHRoaXMucmV0dXJucyA9IGUKICAgICAgICB0aGlzLmRvY3N0cmluZyA9IGYKICAgICAgICB0aGlzLmxpbmVubyA9IGcKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBoCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5DbGFzc0RlZiA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZyAmJiB2b2lkIDAgIT09IGcpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gaCAmJiB2b2lkIDAgIT09IGgpCiAgICAgICAgdGhpcy5uYW1lID0gYQogICAgICAgIHRoaXMuYmFzZXMgPSBiCiAgICAgICAgdGhpcy5rZXl3b3JkcyA9IGMKICAgICAgICB0aGlzLmJvZHkgPSBkCiAgICAgICAgdGhpcy5kZWNvcmF0b3JfbGlzdCA9IGUKICAgICAgICB0aGlzLmRvY3N0cmluZyA9IGYKICAgICAgICB0aGlzLmxpbmVubyA9IGcKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBoCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5SZXR1cm4gPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGIgJiYgdm9pZCAwICE9PSBiKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIHRoaXMudmFsdWUgPSBhCiAgICAgICAgdGhpcy5saW5lbm8gPSBiCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuRGVsZXRlID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICB0aGlzLnRhcmdldHMgPSBhCiAgICAgICAgdGhpcy5saW5lbm8gPSBiCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuQXNzaWduID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICB0aGlzLnRhcmdldHMgPSBhCiAgICAgICAgdGhpcy52YWx1ZSA9IGIKICAgICAgICB0aGlzLmxpbmVubyA9IGMKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBkCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5BdWdBc3NpZ24gPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGUgJiYgdm9pZCAwICE9PSBlKQogICAgICAgIHRoaXMudGFyZ2V0ID0gYQogICAgICAgIHRoaXMub3AgPSBiCiAgICAgICAgdGhpcy52YWx1ZSA9IGMKICAgICAgICB0aGlzLmxpbmVubyA9IGQKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBlCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5Bbm5Bc3NpZ24gPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSwgZikgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGUgJiYgdm9pZCAwICE9PSBlKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGYgJiYgdm9pZCAwICE9PSBmKQogICAgICAgIHRoaXMudGFyZ2V0ID0gYQogICAgICAgIHRoaXMuYW5ub3RhdGlvbiA9IGIKICAgICAgICB0aGlzLnZhbHVlID0gYwogICAgICAgIHRoaXMuc2ltcGxlID0gZAogICAgICAgIHRoaXMubGluZW5vID0gZQogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGYKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkZvciA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCBlLCBmKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZSAmJiB2b2lkIDAgIT09IGUpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZiAmJiB2b2lkIDAgIT09IGYpCiAgICAgICAgdGhpcy50YXJnZXQgPSBhCiAgICAgICAgdGhpcy5pdGVyID0gYgogICAgICAgIHRoaXMuYm9keSA9IGMKICAgICAgICB0aGlzLm9yZWxzZSA9IGQKICAgICAgICB0aGlzLmxpbmVubyA9IGUKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBmCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5Bc3luY0ZvciA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCBlLCBmKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZSAmJiB2b2lkIDAgIT09IGUpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZiAmJiB2b2lkIDAgIT09IGYpCiAgICAgICAgdGhpcy50YXJnZXQgPSBhCiAgICAgICAgdGhpcy5pdGVyID0gYgogICAgICAgIHRoaXMuYm9keSA9IGMKICAgICAgICB0aGlzLm9yZWxzZSA9IGQKICAgICAgICB0aGlzLmxpbmVubyA9IGUKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBmCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5XaGlsZSA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZSAmJiB2b2lkIDAgIT09IGUpCiAgICAgICAgdGhpcy50ZXN0ID0gYQogICAgICAgIHRoaXMuYm9keSA9IGIKICAgICAgICB0aGlzLm9yZWxzZSA9IGMKICAgICAgICB0aGlzLmxpbmVubyA9IGQKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBlCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5JZiA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZSAmJiB2b2lkIDAgIT09IGUpCiAgICAgICAgdGhpcy50ZXN0ID0gYQogICAgICAgIHRoaXMuYm9keSA9IGIKICAgICAgICB0aGlzLm9yZWxzZSA9IGMKICAgICAgICB0aGlzLmxpbmVubyA9IGQKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBlCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5XaXRoID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICB0aGlzLml0ZW1zID0gYQogICAgICAgIHRoaXMuYm9keSA9IGIKICAgICAgICB0aGlzLmxpbmVubyA9IGMKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBkCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5Bc3luY1dpdGggPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIHRoaXMuaXRlbXMgPSBhCiAgICAgICAgdGhpcy5ib2R5ID0gYgogICAgICAgIHRoaXMubGluZW5vID0gYwogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGQKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLlJhaXNlID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUsIGYpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBlICYmIHZvaWQgMCAhPT0gZSkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBmICYmIHZvaWQgMCAhPT0gZikKICAgICAgICB0aGlzLmV4YyA9IGEKICAgICAgICB0aGlzLmNhdXNlID0gYgogICAgICAgIHRoaXMuaW5zdCA9IGMKICAgICAgICB0aGlzLnRiYWNrID0gZAogICAgICAgIHRoaXMubGluZW5vID0gZQogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGYKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLlRyeSA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCBlLCBmKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZSAmJiB2b2lkIDAgIT09IGUpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZiAmJiB2b2lkIDAgIT09IGYpCiAgICAgICAgdGhpcy5ib2R5ID0gYQogICAgICAgIHRoaXMuaGFuZGxlcnMgPSBiCiAgICAgICAgdGhpcy5vcmVsc2UgPSBjCiAgICAgICAgdGhpcy5maW5hbGJvZHkgPSBkCiAgICAgICAgdGhpcy5saW5lbm8gPSBlCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gZgogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuQXNzZXJ0ID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICB0aGlzLnRlc3QgPSBhCiAgICAgICAgdGhpcy5tc2cgPSBiCiAgICAgICAgdGhpcy5saW5lbm8gPSBjCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gZAogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuSW1wb3J0ID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICB0aGlzLm5hbWVzID0gYQogICAgICAgIHRoaXMubGluZW5vID0gYgogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGMKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkltcG9ydEZyb20gPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGUgJiYgdm9pZCAwICE9PSBlKQogICAgICAgIHRoaXMubW9kdWxlID0gYQogICAgICAgIHRoaXMubmFtZXMgPSBiCiAgICAgICAgdGhpcy5sZXZlbCA9IGMKICAgICAgICB0aGlzLmxpbmVubyA9IGQKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBlCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5HbG9iYWwgPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGIgJiYgdm9pZCAwICE9PSBiKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIHRoaXMubmFtZXMgPSBhCiAgICAgICAgdGhpcy5saW5lbm8gPSBiCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuTm9ubG9jYWwgPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGIgJiYgdm9pZCAwICE9PSBiKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIHRoaXMubmFtZXMgPSBhCiAgICAgICAgdGhpcy5saW5lbm8gPSBiCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuRXhwciA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYiAmJiB2b2lkIDAgIT09IGIpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMpCiAgICAgICAgdGhpcy52YWx1ZSA9IGEKICAgICAgICB0aGlzLmxpbmVubyA9IGIKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBjCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5QYXNzID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBhICYmIHZvaWQgMCAhPT0gYSkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikKICAgICAgICB0aGlzLmxpbmVubyA9IGEKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBiCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5CcmVhayA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYSAmJiB2b2lkIDAgIT09IGEpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYiAmJiB2b2lkIDAgIT09IGIpCiAgICAgICAgdGhpcy5saW5lbm8gPSBhCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYgogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuQ29udGludWUgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGEgJiYgdm9pZCAwICE9PSBhKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGIgJiYgdm9pZCAwICE9PSBiKQogICAgICAgIHRoaXMubGluZW5vID0gYQogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGIKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLlByaW50ID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBlICYmIHZvaWQgMCAhPT0gZSkKICAgICAgICB0aGlzLmRlc3QgPSBhCiAgICAgICAgdGhpcy52YWx1ZXMgPSBiCiAgICAgICAgdGhpcy5ubCA9IGMKICAgICAgICB0aGlzLmxpbmVubyA9IGQKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBlCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5EZWJ1Z2dlciA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYSAmJiB2b2lkIDAgIT09IGEpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYiAmJiB2b2lkIDAgIT09IGIpCiAgICAgICAgdGhpcy5saW5lbm8gPSBhCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYgogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuQm9vbE9wID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICB0aGlzLm9wID0gYQogICAgICAgIHRoaXMudmFsdWVzID0gYgogICAgICAgIHRoaXMubGluZW5vID0gYwogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGQKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkJpbk9wID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBlICYmIHZvaWQgMCAhPT0gZSkKICAgICAgICB0aGlzLmxlZnQgPSBhCiAgICAgICAgdGhpcy5vcCA9IGIKICAgICAgICB0aGlzLnJpZ2h0ID0gYwogICAgICAgIHRoaXMubGluZW5vID0gZAogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGUKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLlVuYXJ5T3AgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIHRoaXMub3AgPSBhCiAgICAgICAgdGhpcy5vcGVyYW5kID0gYgogICAgICAgIHRoaXMubGluZW5vID0gYwogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGQKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkxhbWJkYSA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQpCiAgICAgICAgdGhpcy5hcmdzID0gYQogICAgICAgIHRoaXMuYm9keSA9IGIKICAgICAgICB0aGlzLmxpbmVubyA9IGMKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBkCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5JZkV4cCA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZSAmJiB2b2lkIDAgIT09IGUpCiAgICAgICAgdGhpcy50ZXN0ID0gYQogICAgICAgIHRoaXMuYm9keSA9IGIKICAgICAgICB0aGlzLm9yZWxzZSA9IGMKICAgICAgICB0aGlzLmxpbmVubyA9IGQKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBlCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5EaWN0ID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICB0aGlzLmtleXMgPSBhCiAgICAgICAgdGhpcy52YWx1ZXMgPSBiCiAgICAgICAgdGhpcy5saW5lbm8gPSBjCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gZAogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuU2V0ID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICB0aGlzLmVsdHMgPSBhCiAgICAgICAgdGhpcy5saW5lbm8gPSBiCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuTGlzdENvbXAgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIHRoaXMuZWx0ID0gYQogICAgICAgIHRoaXMuZ2VuZXJhdG9ycyA9IGIKICAgICAgICB0aGlzLmxpbmVubyA9IGMKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBkCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5TZXRDb21wID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICB0aGlzLmVsdCA9IGEKICAgICAgICB0aGlzLmdlbmVyYXRvcnMgPSBiCiAgICAgICAgdGhpcy5saW5lbm8gPSBjCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gZAogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuRGljdENvbXAgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGUgJiYgdm9pZCAwICE9PSBlKQogICAgICAgIHRoaXMua2V5ID0gYQogICAgICAgIHRoaXMudmFsdWUgPSBiCiAgICAgICAgdGhpcy5nZW5lcmF0b3JzID0gYwogICAgICAgIHRoaXMubGluZW5vID0gZAogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGUKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkdlbmVyYXRvckV4cCA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQpCiAgICAgICAgdGhpcy5lbHQgPSBhCiAgICAgICAgdGhpcy5nZW5lcmF0b3JzID0gYgogICAgICAgIHRoaXMubGluZW5vID0gYwogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGQKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkF3YWl0ID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICB0aGlzLnZhbHVlID0gYQogICAgICAgIHRoaXMubGluZW5vID0gYgogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGMKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLllpZWxkID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICB0aGlzLnZhbHVlID0gYQogICAgICAgIHRoaXMubGluZW5vID0gYgogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGMKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLllpZWxkRnJvbSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYiAmJiB2b2lkIDAgIT09IGIpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMpCiAgICAgICAgdGhpcy52YWx1ZSA9IGEKICAgICAgICB0aGlzLmxpbmVubyA9IGIKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBjCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5Db21wYXJlID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBlICYmIHZvaWQgMCAhPT0gZSkKICAgICAgICB0aGlzLmxlZnQgPSBhCiAgICAgICAgdGhpcy5vcHMgPSBiCiAgICAgICAgdGhpcy5jb21wYXJhdG9ycyA9IGMKICAgICAgICB0aGlzLmxpbmVubyA9IGQKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBlCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5DYWxsID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBlICYmIHZvaWQgMCAhPT0gZSkKICAgICAgICB0aGlzLmZ1bmMgPSBhCiAgICAgICAgdGhpcy5hcmdzID0gYgogICAgICAgIHRoaXMua2V5d29yZHMgPSBjCiAgICAgICAgdGhpcy5saW5lbm8gPSBkCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gZQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuTnVtID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICB0aGlzLm4gPSBhCiAgICAgICAgdGhpcy5saW5lbm8gPSBiCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuU3RyID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICB0aGlzLnMgPSBhCiAgICAgICAgdGhpcy5saW5lbm8gPSBiCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuRm9ybWF0dGVkVmFsdWUgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGUgJiYgdm9pZCAwICE9PSBlKQogICAgICAgIHRoaXMudmFsdWUgPSBhCiAgICAgICAgdGhpcy5jb252ZXJzaW9uID0gYgogICAgICAgIHRoaXMuZm9ybWF0X3NwZWMgPSBjCiAgICAgICAgdGhpcy5saW5lbm8gPSBkCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gZQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuSm9pbmVkU3RyID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICB0aGlzLnZhbHVlcyA9IGEKICAgICAgICB0aGlzLmxpbmVubyA9IGIKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBjCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5CeXRlcyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYiAmJiB2b2lkIDAgIT09IGIpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMpCiAgICAgICAgdGhpcy5zID0gYQogICAgICAgIHRoaXMubGluZW5vID0gYgogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGMKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLk5hbWVDb25zdGFudCA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYiAmJiB2b2lkIDAgIT09IGIpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMpCiAgICAgICAgdGhpcy52YWx1ZSA9IGEKICAgICAgICB0aGlzLmxpbmVubyA9IGIKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBjCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5FbGxpcHNpcyA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYSAmJiB2b2lkIDAgIT09IGEpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYiAmJiB2b2lkIDAgIT09IGIpCiAgICAgICAgdGhpcy5saW5lbm8gPSBhCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYgogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuQ29uc3RhbnQgPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGIgJiYgdm9pZCAwICE9PSBiKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIHRoaXMudmFsdWUgPSBhCiAgICAgICAgdGhpcy5saW5lbm8gPSBiCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gYwogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuQXR0cmlidXRlID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBlICYmIHZvaWQgMCAhPT0gZSkKICAgICAgICB0aGlzLnZhbHVlID0gYQogICAgICAgIHRoaXMuYXR0ciA9IGIKICAgICAgICB0aGlzLmN0eCA9IGMKICAgICAgICB0aGlzLmxpbmVubyA9IGQKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBlCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5TdWJzY3JpcHQgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGUgJiYgdm9pZCAwICE9PSBlKQogICAgICAgIHRoaXMudmFsdWUgPSBhCiAgICAgICAgdGhpcy5zbGljZSA9IGIKICAgICAgICB0aGlzLmN0eCA9IGMKICAgICAgICB0aGlzLmxpbmVubyA9IGQKICAgICAgICB0aGlzLmNvbF9vZmZzZXQgPSBlCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5TdGFycmVkID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICB0aGlzLnZhbHVlID0gYQogICAgICAgIHRoaXMuY3R4ID0gYgogICAgICAgIHRoaXMubGluZW5vID0gYwogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGQKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLk5hbWUgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIHRoaXMuaWQgPSBhCiAgICAgICAgdGhpcy5jdHggPSBiCiAgICAgICAgdGhpcy5saW5lbm8gPSBjCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gZAogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuTGlzdCA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQpCiAgICAgICAgdGhpcy5lbHRzID0gYQogICAgICAgIHRoaXMuY3R4ID0gYgogICAgICAgIHRoaXMubGluZW5vID0gYwogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGQKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLlR1cGxlID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYykKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkKICAgICAgICB0aGlzLmVsdHMgPSBhCiAgICAgICAgdGhpcy5jdHggPSBiCiAgICAgICAgdGhpcy5saW5lbm8gPSBjCiAgICAgICAgdGhpcy5jb2xfb2Zmc2V0ID0gZAogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuU2xpY2UgPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIHRoaXMubG93ZXIgPSBhCiAgICAgICAgdGhpcy51cHBlciA9IGIKICAgICAgICB0aGlzLnN0ZXAgPSBjCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5FeHRTbGljZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdGhpcy5kaW1zID0gYQogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuSW5kZXggPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHRoaXMudmFsdWUgPSBhCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5jb21wcmVoZW5zaW9uID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsKICAgICAgICB0aGlzLnRhcmdldCA9IGEKICAgICAgICB0aGlzLml0ZXIgPSBiCiAgICAgICAgdGhpcy5pZnMgPSBjCiAgICAgICAgdGhpcy5pc19hc3luYyA9IGQKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLkV4Y2VwdEhhbmRsZXIgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KG51bGwgIT09IGUgJiYgdm9pZCAwICE9PSBlKQogICAgICAgIHRoaXMudHlwZSA9IGEKICAgICAgICB0aGlzLm5hbWUgPSBiCiAgICAgICAgdGhpcy5ib2R5ID0gYwogICAgICAgIHRoaXMubGluZW5vID0gZAogICAgICAgIHRoaXMuY29sX29mZnNldCA9IGUKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLmFyZ3VtZW50c18gPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSwgZikgewogICAgICAgIHRoaXMuYXJncyA9IGEKICAgICAgICB0aGlzLnZhcmFyZyA9IGIKICAgICAgICB0aGlzLmt3b25seWFyZ3MgPSBjCiAgICAgICAgdGhpcy5rd19kZWZhdWx0cyA9IGQKICAgICAgICB0aGlzLmt3YXJnID0gZQogICAgICAgIHRoaXMuZGVmYXVsdHMgPSBmCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5hcmcgPSBmdW5jdGlvbiBhKGEsIGIpIHsKICAgICAgICB0aGlzLmFyZyA9IGEKICAgICAgICB0aGlzLmFubm90YXRpb24gPSBiCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5rZXl3b3JkID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB0aGlzLmFyZyA9IGEKICAgICAgICB0aGlzLnZhbHVlID0gYgogICAgICAgIHJldHVybiB0aGlzCiAgICAgIH0KICAgICAgU2suYXN0bm9kZXMuYWxpYXMgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHRoaXMubmFtZSA9IGEKICAgICAgICB0aGlzLmFzbmFtZSA9IGIKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CiAgICAgIFNrLmFzdG5vZGVzLndpdGhpdGVtID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB0aGlzLmNvbnRleHRfZXhwciA9IGEKICAgICAgICB0aGlzLm9wdGlvbmFsX3ZhcnMgPSBiCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5hc3Rub2Rlcy5Nb2R1bGUucHJvdG90eXBlLl9hc3RuYW1lID0gIk1vZHVsZSIKICAgICAgU2suYXN0bm9kZXMuTW9kdWxlLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJib2R5IiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuYm9keQogICAgICAgIH0sCiAgICAgICAgImRvY3N0cmluZyIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmRvY3N0cmluZwogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuSW50ZXJhY3RpdmUucHJvdG90eXBlLl9hc3RuYW1lID0gIkludGVyYWN0aXZlIgogICAgICBTay5hc3Rub2Rlcy5JbnRlcmFjdGl2ZS5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAiYm9keSIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmJvZHkKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkV4cHJlc3Npb24ucHJvdG90eXBlLl9hc3RuYW1lID0gIkV4cHJlc3Npb24iCiAgICAgIFNrLmFzdG5vZGVzLkV4cHJlc3Npb24ucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgImJvZHkiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5ib2R5CiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5TdWl0ZS5wcm90b3R5cGUuX2FzdG5hbWUgPSAiU3VpdGUiCiAgICAgIFNrLmFzdG5vZGVzLlN1aXRlLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJib2R5IiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuYm9keQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuRnVuY3Rpb25EZWYucHJvdG90eXBlLl9hc3RuYW1lID0gIkZ1bmN0aW9uRGVmIgogICAgICBTay5hc3Rub2Rlcy5GdW5jdGlvbkRlZi5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAibmFtZSIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLm5hbWUKICAgICAgICB9LAogICAgICAgICJhcmdzIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuYXJncwogICAgICAgIH0sCiAgICAgICAgImJvZHkiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5ib2R5CiAgICAgICAgfSwKICAgICAgICAiZGVjb3JhdG9yX2xpc3QiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5kZWNvcmF0b3JfbGlzdAogICAgICAgIH0sCiAgICAgICAgInJldHVybnMiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5yZXR1cm5zCiAgICAgICAgfSwKICAgICAgICAiZG9jc3RyaW5nIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuZG9jc3RyaW5nCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5Bc3luY0Z1bmN0aW9uRGVmLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJBc3luY0Z1bmN0aW9uRGVmIgogICAgICBTay5hc3Rub2Rlcy5Bc3luY0Z1bmN0aW9uRGVmLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJuYW1lIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEubmFtZQogICAgICAgIH0sCiAgICAgICAgImFyZ3MiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5hcmdzCiAgICAgICAgfSwKICAgICAgICAiYm9keSIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmJvZHkKICAgICAgICB9LAogICAgICAgICJkZWNvcmF0b3JfbGlzdCIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmRlY29yYXRvcl9saXN0CiAgICAgICAgfSwKICAgICAgICAicmV0dXJucyIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLnJldHVybnMKICAgICAgICB9LAogICAgICAgICJkb2NzdHJpbmciLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5kb2NzdHJpbmcKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkNsYXNzRGVmLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJDbGFzc0RlZiIKICAgICAgU2suYXN0bm9kZXMuQ2xhc3NEZWYucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgIm5hbWUiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5uYW1lCiAgICAgICAgfSwKICAgICAgICAiYmFzZXMiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5iYXNlcwogICAgICAgIH0sCiAgICAgICAgImtleXdvcmRzIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEua2V5d29yZHMKICAgICAgICB9LAogICAgICAgICJib2R5IiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuYm9keQogICAgICAgIH0sCiAgICAgICAgImRlY29yYXRvcl9saXN0IiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuZGVjb3JhdG9yX2xpc3QKICAgICAgICB9LAogICAgICAgICJkb2NzdHJpbmciLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5kb2NzdHJpbmcKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLlJldHVybi5wcm90b3R5cGUuX2FzdG5hbWUgPSAiUmV0dXJuIgogICAgICBTay5hc3Rub2Rlcy5SZXR1cm4ucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgInZhbHVlIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEudmFsdWUKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkRlbGV0ZS5wcm90b3R5cGUuX2FzdG5hbWUgPSAiRGVsZXRlIgogICAgICBTay5hc3Rub2Rlcy5EZWxldGUucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgInRhcmdldHMiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS50YXJnZXRzCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5Bc3NpZ24ucHJvdG90eXBlLl9hc3RuYW1lID0gIkFzc2lnbiIKICAgICAgU2suYXN0bm9kZXMuQXNzaWduLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJ0YXJnZXRzIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEudGFyZ2V0cwogICAgICAgIH0sCiAgICAgICAgInZhbHVlIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEudmFsdWUKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkF1Z0Fzc2lnbi5wcm90b3R5cGUuX2FzdG5hbWUgPSAiQXVnQXNzaWduIgogICAgICBTay5hc3Rub2Rlcy5BdWdBc3NpZ24ucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgInRhcmdldCIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLnRhcmdldAogICAgICAgIH0sCiAgICAgICAgIm9wIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEub3AKICAgICAgICB9LAogICAgICAgICJ2YWx1ZSIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLnZhbHVlCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5Bbm5Bc3NpZ24ucHJvdG90eXBlLl9hc3RuYW1lID0gIkFubkFzc2lnbiIKICAgICAgU2suYXN0bm9kZXMuQW5uQXNzaWduLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJ0YXJnZXQiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS50YXJnZXQKICAgICAgICB9LAogICAgICAgICJhbm5vdGF0aW9uIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuYW5ub3RhdGlvbgogICAgICAgIH0sCiAgICAgICAgInZhbHVlIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEudmFsdWUKICAgICAgICB9LAogICAgICAgICJzaW1wbGUiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5zaW1wbGUKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkZvci5wcm90b3R5cGUuX2FzdG5hbWUgPSAiRm9yIgogICAgICBTay5hc3Rub2Rlcy5Gb3IucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgInRhcmdldCIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLnRhcmdldAogICAgICAgIH0sCiAgICAgICAgIml0ZXIiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5pdGVyCiAgICAgICAgfSwKICAgICAgICAiYm9keSIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmJvZHkKICAgICAgICB9LAogICAgICAgICJvcmVsc2UiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5vcmVsc2UKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkFzeW5jRm9yLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJBc3luY0ZvciIKICAgICAgU2suYXN0bm9kZXMuQXN5bmNGb3IucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgInRhcmdldCIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLnRhcmdldAogICAgICAgIH0sCiAgICAgICAgIml0ZXIiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5pdGVyCiAgICAgICAgfSwKICAgICAgICAiYm9keSIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmJvZHkKICAgICAgICB9LAogICAgICAgICJvcmVsc2UiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5vcmVsc2UKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLldoaWxlLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJXaGlsZSIKICAgICAgU2suYXN0bm9kZXMuV2hpbGUucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgInRlc3QiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS50ZXN0CiAgICAgICAgfSwKICAgICAgICAiYm9keSIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmJvZHkKICAgICAgICB9LAogICAgICAgICJvcmVsc2UiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5vcmVsc2UKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLklmLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJJZiIKICAgICAgU2suYXN0bm9kZXMuSWYucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgInRlc3QiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS50ZXN0CiAgICAgICAgfSwKICAgICAgICAiYm9keSIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmJvZHkKICAgICAgICB9LAogICAgICAgICJvcmVsc2UiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5vcmVsc2UKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLldpdGgucHJvdG90eXBlLl9hc3RuYW1lID0gIldpdGgiCiAgICAgIFNrLmFzdG5vZGVzLldpdGgucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgIml0ZW1zIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuaXRlbXMKICAgICAgICB9LAogICAgICAgICJib2R5IiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuYm9keQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuQXN5bmNXaXRoLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJBc3luY1dpdGgiCiAgICAgIFNrLmFzdG5vZGVzLkFzeW5jV2l0aC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAiaXRlbXMiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5pdGVtcwogICAgICAgIH0sCiAgICAgICAgImJvZHkiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5ib2R5CiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5SYWlzZS5wcm90b3R5cGUuX2FzdG5hbWUgPSAiUmFpc2UiCiAgICAgIFNrLmFzdG5vZGVzLlJhaXNlLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJleGMiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5leGMKICAgICAgICB9LAogICAgICAgICJjYXVzZSIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmNhdXNlCiAgICAgICAgfSwKICAgICAgICAiaW5zdCIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmluc3QKICAgICAgICB9LAogICAgICAgICJ0YmFjayIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLnRiYWNrCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5UcnkucHJvdG90eXBlLl9hc3RuYW1lID0gIlRyeSIKICAgICAgU2suYXN0bm9kZXMuVHJ5LnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJib2R5IiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuYm9keQogICAgICAgIH0sCiAgICAgICAgImhhbmRsZXJzIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuaGFuZGxlcnMKICAgICAgICB9LAogICAgICAgICJvcmVsc2UiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5vcmVsc2UKICAgICAgICB9LAogICAgICAgICJmaW5hbGJvZHkiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5maW5hbGJvZHkKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkFzc2VydC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiQXNzZXJ0IgogICAgICBTay5hc3Rub2Rlcy5Bc3NlcnQucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgInRlc3QiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS50ZXN0CiAgICAgICAgfSwKICAgICAgICAibXNnIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEubXNnCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5JbXBvcnQucHJvdG90eXBlLl9hc3RuYW1lID0gIkltcG9ydCIKICAgICAgU2suYXN0bm9kZXMuSW1wb3J0LnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJuYW1lcyIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLm5hbWVzCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5JbXBvcnRGcm9tLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJJbXBvcnRGcm9tIgogICAgICBTay5hc3Rub2Rlcy5JbXBvcnRGcm9tLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJtb2R1bGUiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5tb2R1bGUKICAgICAgICB9LAogICAgICAgICJuYW1lcyIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLm5hbWVzCiAgICAgICAgfSwKICAgICAgICAibGV2ZWwiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5sZXZlbAogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuR2xvYmFsLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJHbG9iYWwiCiAgICAgIFNrLmFzdG5vZGVzLkdsb2JhbC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAibmFtZXMiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5uYW1lcwogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuTm9ubG9jYWwucHJvdG90eXBlLl9hc3RuYW1lID0gIk5vbmxvY2FsIgogICAgICBTay5hc3Rub2Rlcy5Ob25sb2NhbC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAibmFtZXMiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5uYW1lcwogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuRXhwci5wcm90b3R5cGUuX2FzdG5hbWUgPSAiRXhwciIKICAgICAgU2suYXN0bm9kZXMuRXhwci5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAidmFsdWUiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS52YWx1ZQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuUGFzcy5wcm90b3R5cGUuX2FzdG5hbWUgPSAiUGFzcyIKICAgICAgU2suYXN0bm9kZXMuUGFzcy5wcm90b3R5cGUuX2ZpZWxkcyA9IFtdCiAgICAgIFNrLmFzdG5vZGVzLkJyZWFrLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJCcmVhayIKICAgICAgU2suYXN0bm9kZXMuQnJlYWsucHJvdG90eXBlLl9maWVsZHMgPSBbXQogICAgICBTay5hc3Rub2Rlcy5Db250aW51ZS5wcm90b3R5cGUuX2FzdG5hbWUgPSAiQ29udGludWUiCiAgICAgIFNrLmFzdG5vZGVzLkNvbnRpbnVlLnByb3RvdHlwZS5fZmllbGRzID0gW10KICAgICAgU2suYXN0bm9kZXMuUHJpbnQucHJvdG90eXBlLl9hc3RuYW1lID0gIlByaW50IgogICAgICBTay5hc3Rub2Rlcy5QcmludC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAiZGVzdCIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmRlc3QKICAgICAgICB9LAogICAgICAgICJ2YWx1ZXMiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS52YWx1ZXMKICAgICAgICB9LAogICAgICAgICJubCIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLm5sCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5EZWJ1Z2dlci5wcm90b3R5cGUuX2FzdG5hbWUgPSAiRGVidWdnZXIiCiAgICAgIFNrLmFzdG5vZGVzLkRlYnVnZ2VyLnByb3RvdHlwZS5fZmllbGRzID0gW10KICAgICAgU2suYXN0bm9kZXMuQm9vbE9wLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJCb29sT3AiCiAgICAgIFNrLmFzdG5vZGVzLkJvb2xPcC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAib3AiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5vcAogICAgICAgIH0sCiAgICAgICAgInZhbHVlcyIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLnZhbHVlcwogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuQmluT3AucHJvdG90eXBlLl9hc3RuYW1lID0gIkJpbk9wIgogICAgICBTay5hc3Rub2Rlcy5CaW5PcC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAibGVmdCIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmxlZnQKICAgICAgICB9LAogICAgICAgICJvcCIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLm9wCiAgICAgICAgfSwKICAgICAgICAicmlnaHQiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5yaWdodAogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuVW5hcnlPcC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiVW5hcnlPcCIKICAgICAgU2suYXN0bm9kZXMuVW5hcnlPcC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAib3AiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5vcAogICAgICAgIH0sCiAgICAgICAgIm9wZXJhbmQiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5vcGVyYW5kCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5MYW1iZGEucHJvdG90eXBlLl9hc3RuYW1lID0gIkxhbWJkYSIKICAgICAgU2suYXN0bm9kZXMuTGFtYmRhLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJhcmdzIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuYXJncwogICAgICAgIH0sCiAgICAgICAgImJvZHkiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5ib2R5CiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5JZkV4cC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiSWZFeHAiCiAgICAgIFNrLmFzdG5vZGVzLklmRXhwLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJ0ZXN0IiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEudGVzdAogICAgICAgIH0sCiAgICAgICAgImJvZHkiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5ib2R5CiAgICAgICAgfSwKICAgICAgICAib3JlbHNlIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEub3JlbHNlCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5EaWN0LnByb3RvdHlwZS5fYXN0bmFtZSA9ICJEaWN0IgogICAgICBTay5hc3Rub2Rlcy5EaWN0LnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJrZXlzIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEua2V5cwogICAgICAgIH0sCiAgICAgICAgInZhbHVlcyIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLnZhbHVlcwogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuU2V0LnByb3RvdHlwZS5fYXN0bmFtZSA9ICJTZXQiCiAgICAgIFNrLmFzdG5vZGVzLlNldC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAiZWx0cyIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmVsdHMKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkxpc3RDb21wLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJMaXN0Q29tcCIKICAgICAgU2suYXN0bm9kZXMuTGlzdENvbXAucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgImVsdCIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmVsdAogICAgICAgIH0sCiAgICAgICAgImdlbmVyYXRvcnMiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5nZW5lcmF0b3JzCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5TZXRDb21wLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJTZXRDb21wIgogICAgICBTay5hc3Rub2Rlcy5TZXRDb21wLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJlbHQiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5lbHQKICAgICAgICB9LAogICAgICAgICJnZW5lcmF0b3JzIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuZ2VuZXJhdG9ycwogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuRGljdENvbXAucHJvdG90eXBlLl9hc3RuYW1lID0gIkRpY3RDb21wIgogICAgICBTay5hc3Rub2Rlcy5EaWN0Q29tcC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAia2V5IiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEua2V5CiAgICAgICAgfSwKICAgICAgICAidmFsdWUiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS52YWx1ZQogICAgICAgIH0sCiAgICAgICAgImdlbmVyYXRvcnMiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5nZW5lcmF0b3JzCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5HZW5lcmF0b3JFeHAucHJvdG90eXBlLl9hc3RuYW1lID0gIkdlbmVyYXRvckV4cCIKICAgICAgU2suYXN0bm9kZXMuR2VuZXJhdG9yRXhwLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJlbHQiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5lbHQKICAgICAgICB9LAogICAgICAgICJnZW5lcmF0b3JzIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuZ2VuZXJhdG9ycwogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuQXdhaXQucHJvdG90eXBlLl9hc3RuYW1lID0gIkF3YWl0IgogICAgICBTay5hc3Rub2Rlcy5Bd2FpdC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAidmFsdWUiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS52YWx1ZQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuWWllbGQucHJvdG90eXBlLl9hc3RuYW1lID0gIllpZWxkIgogICAgICBTay5hc3Rub2Rlcy5ZaWVsZC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAidmFsdWUiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS52YWx1ZQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuWWllbGRGcm9tLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJZaWVsZEZyb20iCiAgICAgIFNrLmFzdG5vZGVzLllpZWxkRnJvbS5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAidmFsdWUiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS52YWx1ZQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuQ29tcGFyZS5wcm90b3R5cGUuX2FzdG5hbWUgPSAiQ29tcGFyZSIKICAgICAgU2suYXN0bm9kZXMuQ29tcGFyZS5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAibGVmdCIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmxlZnQKICAgICAgICB9LAogICAgICAgICJvcHMiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5vcHMKICAgICAgICB9LAogICAgICAgICJjb21wYXJhdG9ycyIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmNvbXBhcmF0b3JzCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5DYWxsLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJDYWxsIgogICAgICBTay5hc3Rub2Rlcy5DYWxsLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJmdW5jIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuZnVuYwogICAgICAgIH0sCiAgICAgICAgImFyZ3MiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5hcmdzCiAgICAgICAgfSwKICAgICAgICAia2V5d29yZHMiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5rZXl3b3JkcwogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuTnVtLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJOdW0iCiAgICAgIFNrLmFzdG5vZGVzLk51bS5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAibiIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLm4KICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLlN0ci5wcm90b3R5cGUuX2FzdG5hbWUgPSAiU3RyIgogICAgICBTay5hc3Rub2Rlcy5TdHIucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgInMiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5zCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5Gb3JtYXR0ZWRWYWx1ZS5wcm90b3R5cGUuX2FzdG5hbWUgPSAiRm9ybWF0dGVkVmFsdWUiCiAgICAgIFNrLmFzdG5vZGVzLkZvcm1hdHRlZFZhbHVlLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJ2YWx1ZSIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLnZhbHVlCiAgICAgICAgfSwKICAgICAgICAiY29udmVyc2lvbiIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmNvbnZlcnNpb24KICAgICAgICB9LAogICAgICAgICJmb3JtYXRfc3BlYyIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmZvcm1hdF9zcGVjCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5Kb2luZWRTdHIucHJvdG90eXBlLl9hc3RuYW1lID0gIkpvaW5lZFN0ciIKICAgICAgU2suYXN0bm9kZXMuSm9pbmVkU3RyLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJ2YWx1ZXMiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS52YWx1ZXMKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkJ5dGVzLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJCeXRlcyIKICAgICAgU2suYXN0bm9kZXMuQnl0ZXMucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgInMiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5zCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5OYW1lQ29uc3RhbnQucHJvdG90eXBlLl9hc3RuYW1lID0gIk5hbWVDb25zdGFudCIKICAgICAgU2suYXN0bm9kZXMuTmFtZUNvbnN0YW50LnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJ2YWx1ZSIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLnZhbHVlCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5FbGxpcHNpcy5wcm90b3R5cGUuX2FzdG5hbWUgPSAiRWxsaXBzaXMiCiAgICAgIFNrLmFzdG5vZGVzLkVsbGlwc2lzLnByb3RvdHlwZS5fZmllbGRzID0gW10KICAgICAgU2suYXN0bm9kZXMuQ29uc3RhbnQucHJvdG90eXBlLl9hc3RuYW1lID0gIkNvbnN0YW50IgogICAgICBTay5hc3Rub2Rlcy5Db25zdGFudC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAidmFsdWUiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS52YWx1ZQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuQXR0cmlidXRlLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJBdHRyaWJ1dGUiCiAgICAgIFNrLmFzdG5vZGVzLkF0dHJpYnV0ZS5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAidmFsdWUiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS52YWx1ZQogICAgICAgIH0sCiAgICAgICAgImF0dHIiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5hdHRyCiAgICAgICAgfSwKICAgICAgICAiY3R4IiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuY3R4CiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5TdWJzY3JpcHQucHJvdG90eXBlLl9hc3RuYW1lID0gIlN1YnNjcmlwdCIKICAgICAgU2suYXN0bm9kZXMuU3Vic2NyaXB0LnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJ2YWx1ZSIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLnZhbHVlCiAgICAgICAgfSwKICAgICAgICAic2xpY2UiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5zbGljZQogICAgICAgIH0sCiAgICAgICAgImN0eCIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmN0eAogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuU3RhcnJlZC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiU3RhcnJlZCIKICAgICAgU2suYXN0bm9kZXMuU3RhcnJlZC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAidmFsdWUiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS52YWx1ZQogICAgICAgIH0sCiAgICAgICAgImN0eCIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmN0eAogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuTmFtZS5wcm90b3R5cGUuX2FzdG5hbWUgPSAiTmFtZSIKICAgICAgU2suYXN0bm9kZXMuTmFtZS5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAiaWQiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5pZAogICAgICAgIH0sCiAgICAgICAgImN0eCIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmN0eAogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuTGlzdC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiTGlzdCIKICAgICAgU2suYXN0bm9kZXMuTGlzdC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAiZWx0cyIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmVsdHMKICAgICAgICB9LAogICAgICAgICJjdHgiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5jdHgKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLlR1cGxlLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJUdXBsZSIKICAgICAgU2suYXN0bm9kZXMuVHVwbGUucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgImVsdHMiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5lbHRzCiAgICAgICAgfSwKICAgICAgICAiY3R4IiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuY3R4CiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5Mb2FkLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJMb2FkIgogICAgICBTay5hc3Rub2Rlcy5Mb2FkLnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuU3RvcmUucHJvdG90eXBlLl9hc3RuYW1lID0gIlN0b3JlIgogICAgICBTay5hc3Rub2Rlcy5TdG9yZS5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLkRlbC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiRGVsIgogICAgICBTay5hc3Rub2Rlcy5EZWwucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5BdWdMb2FkLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJBdWdMb2FkIgogICAgICBTay5hc3Rub2Rlcy5BdWdMb2FkLnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuQXVnU3RvcmUucHJvdG90eXBlLl9hc3RuYW1lID0gIkF1Z1N0b3JlIgogICAgICBTay5hc3Rub2Rlcy5BdWdTdG9yZS5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLlBhcmFtLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJQYXJhbSIKICAgICAgU2suYXN0bm9kZXMuUGFyYW0ucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5TbGljZS5wcm90b3R5cGUuX2FzdG5hbWUgPSAiU2xpY2UiCiAgICAgIFNrLmFzdG5vZGVzLlNsaWNlLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJsb3dlciIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmxvd2VyCiAgICAgICAgfSwKICAgICAgICAidXBwZXIiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS51cHBlcgogICAgICAgIH0sCiAgICAgICAgInN0ZXAiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5zdGVwCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5FeHRTbGljZS5wcm90b3R5cGUuX2FzdG5hbWUgPSAiRXh0U2xpY2UiCiAgICAgIFNrLmFzdG5vZGVzLkV4dFNsaWNlLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJkaW1zIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuZGltcwogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuSW5kZXgucHJvdG90eXBlLl9hc3RuYW1lID0gIkluZGV4IgogICAgICBTay5hc3Rub2Rlcy5JbmRleC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAidmFsdWUiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS52YWx1ZQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuQW5kLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJBbmQiCiAgICAgIFNrLmFzdG5vZGVzLkFuZC5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLk9yLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJPciIKICAgICAgU2suYXN0bm9kZXMuT3IucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5BZGQucHJvdG90eXBlLl9hc3RuYW1lID0gIkFkZCIKICAgICAgU2suYXN0bm9kZXMuQWRkLnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuU3ViLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJTdWIiCiAgICAgIFNrLmFzdG5vZGVzLlN1Yi5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLk11bHQucHJvdG90eXBlLl9hc3RuYW1lID0gIk11bHQiCiAgICAgIFNrLmFzdG5vZGVzLk11bHQucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5NYXRNdWx0LnByb3RvdHlwZS5fYXN0bmFtZSA9ICJNYXRNdWx0IgogICAgICBTay5hc3Rub2Rlcy5NYXRNdWx0LnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuRGl2LnByb3RvdHlwZS5fYXN0bmFtZSA9ICJEaXYiCiAgICAgIFNrLmFzdG5vZGVzLkRpdi5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLk1vZC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiTW9kIgogICAgICBTay5hc3Rub2Rlcy5Nb2QucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5Qb3cucHJvdG90eXBlLl9hc3RuYW1lID0gIlBvdyIKICAgICAgU2suYXN0bm9kZXMuUG93LnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuTFNoaWZ0LnByb3RvdHlwZS5fYXN0bmFtZSA9ICJMU2hpZnQiCiAgICAgIFNrLmFzdG5vZGVzLkxTaGlmdC5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLlJTaGlmdC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiUlNoaWZ0IgogICAgICBTay5hc3Rub2Rlcy5SU2hpZnQucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5CaXRPci5wcm90b3R5cGUuX2FzdG5hbWUgPSAiQml0T3IiCiAgICAgIFNrLmFzdG5vZGVzLkJpdE9yLnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuQml0WG9yLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJCaXRYb3IiCiAgICAgIFNrLmFzdG5vZGVzLkJpdFhvci5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLkJpdEFuZC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiQml0QW5kIgogICAgICBTay5hc3Rub2Rlcy5CaXRBbmQucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5GbG9vckRpdi5wcm90b3R5cGUuX2FzdG5hbWUgPSAiRmxvb3JEaXYiCiAgICAgIFNrLmFzdG5vZGVzLkZsb29yRGl2LnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuSW52ZXJ0LnByb3RvdHlwZS5fYXN0bmFtZSA9ICJJbnZlcnQiCiAgICAgIFNrLmFzdG5vZGVzLkludmVydC5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLk5vdC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiTm90IgogICAgICBTay5hc3Rub2Rlcy5Ob3QucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5VQWRkLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJVQWRkIgogICAgICBTay5hc3Rub2Rlcy5VQWRkLnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuVVN1Yi5wcm90b3R5cGUuX2FzdG5hbWUgPSAiVVN1YiIKICAgICAgU2suYXN0bm9kZXMuVVN1Yi5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLkVxLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJFcSIKICAgICAgU2suYXN0bm9kZXMuRXEucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5Ob3RFcS5wcm90b3R5cGUuX2FzdG5hbWUgPSAiTm90RXEiCiAgICAgIFNrLmFzdG5vZGVzLk5vdEVxLnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuTHQucHJvdG90eXBlLl9hc3RuYW1lID0gIkx0IgogICAgICBTay5hc3Rub2Rlcy5MdC5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLkx0RS5wcm90b3R5cGUuX2FzdG5hbWUgPSAiTHRFIgogICAgICBTay5hc3Rub2Rlcy5MdEUucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5HdC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiR3QiCiAgICAgIFNrLmFzdG5vZGVzLkd0LnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuR3RFLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJHdEUiCiAgICAgIFNrLmFzdG5vZGVzLkd0RS5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLklzLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJJcyIKICAgICAgU2suYXN0bm9kZXMuSXMucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5Jc05vdC5wcm90b3R5cGUuX2FzdG5hbWUgPSAiSXNOb3QiCiAgICAgIFNrLmFzdG5vZGVzLklzTm90LnByb3RvdHlwZS5faXNlbnVtID0gITAKICAgICAgU2suYXN0bm9kZXMuSW4ucHJvdG90eXBlLl9hc3RuYW1lID0gIkluIgogICAgICBTay5hc3Rub2Rlcy5Jbi5wcm90b3R5cGUuX2lzZW51bSA9ICEwCiAgICAgIFNrLmFzdG5vZGVzLk5vdEluLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJOb3RJbiIKICAgICAgU2suYXN0bm9kZXMuTm90SW4ucHJvdG90eXBlLl9pc2VudW0gPSAhMAogICAgICBTay5hc3Rub2Rlcy5jb21wcmVoZW5zaW9uLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJjb21wcmVoZW5zaW9uIgogICAgICBTay5hc3Rub2Rlcy5jb21wcmVoZW5zaW9uLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJ0YXJnZXQiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS50YXJnZXQKICAgICAgICB9LAogICAgICAgICJpdGVyIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuaXRlcgogICAgICAgIH0sCiAgICAgICAgImlmcyIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmlmcwogICAgICAgIH0sCiAgICAgICAgImlzX2FzeW5jIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuaXNfYXN5bmMKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLkV4Y2VwdEhhbmRsZXIucHJvdG90eXBlLl9hc3RuYW1lID0gIkV4Y2VwdEhhbmRsZXIiCiAgICAgIFNrLmFzdG5vZGVzLkV4Y2VwdEhhbmRsZXIucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgInR5cGUiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS50eXBlCiAgICAgICAgfSwKICAgICAgICAibmFtZSIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLm5hbWUKICAgICAgICB9LAogICAgICAgICJib2R5IiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuYm9keQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuYXJndW1lbnRzXy5wcm90b3R5cGUuX2FzdG5hbWUgPSAiYXJndW1lbnRzIgogICAgICBTay5hc3Rub2Rlcy5hcmd1bWVudHNfLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJhcmdzIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuYXJncwogICAgICAgIH0sCiAgICAgICAgInZhcmFyZyIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLnZhcmFyZwogICAgICAgIH0sCiAgICAgICAgImt3b25seWFyZ3MiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5rd29ubHlhcmdzCiAgICAgICAgfSwKICAgICAgICAia3dfZGVmYXVsdHMiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5rd19kZWZhdWx0cwogICAgICAgIH0sCiAgICAgICAgImt3YXJnIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEua3dhcmcKICAgICAgICB9LAogICAgICAgICJkZWZhdWx0cyIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmRlZmF1bHRzCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5hc3Rub2Rlcy5hcmcucHJvdG90eXBlLl9hc3RuYW1lID0gImFyZyIKICAgICAgU2suYXN0bm9kZXMuYXJnLnByb3RvdHlwZS5fZmllbGRzID0gWwogICAgICAgICJhcmciLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5hcmcKICAgICAgICB9LAogICAgICAgICJhbm5vdGF0aW9uIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuYW5ub3RhdGlvbgogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMua2V5d29yZC5wcm90b3R5cGUuX2FzdG5hbWUgPSAia2V5d29yZCIKICAgICAgU2suYXN0bm9kZXMua2V5d29yZC5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAiYXJnIiwKICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIGEuYXJnCiAgICAgICAgfSwKICAgICAgICAidmFsdWUiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS52YWx1ZQogICAgICAgIH0sCiAgICAgIF0KICAgICAgU2suYXN0bm9kZXMuYWxpYXMucHJvdG90eXBlLl9hc3RuYW1lID0gImFsaWFzIgogICAgICBTay5hc3Rub2Rlcy5hbGlhcy5wcm90b3R5cGUuX2ZpZWxkcyA9IFsKICAgICAgICAibmFtZSIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLm5hbWUKICAgICAgICB9LAogICAgICAgICJhc25hbWUiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5hc25hbWUKICAgICAgICB9LAogICAgICBdCiAgICAgIFNrLmFzdG5vZGVzLndpdGhpdGVtLnByb3RvdHlwZS5fYXN0bmFtZSA9ICJ3aXRoaXRlbSIKICAgICAgU2suYXN0bm9kZXMud2l0aGl0ZW0ucHJvdG90eXBlLl9maWVsZHMgPSBbCiAgICAgICAgImNvbnRleHRfZXhwciIsCiAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLmNvbnRleHRfZXhwcgogICAgICAgIH0sCiAgICAgICAgIm9wdGlvbmFsX3ZhcnMiLAogICAgICAgIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICByZXR1cm4gYS5vcHRpb25hbF92YXJzCiAgICAgICAgfSwKICAgICAgXQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmFzdG5vZGVzIiwgU2suYXN0bm9kZXMpCiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHApIHsKICAgICAgZnVuY3Rpb24gYShhLCBiLCBjKSB7CiAgICAgICAgdGhpcy5jX2VuY29kaW5nID0gYQogICAgICAgIHRoaXMuY19maWxlbmFtZSA9IGIKICAgICAgICB0aGlzLmNfZmxhZ3MgPSBjIHx8IDAKICAgICAgfQogICAgICBmdW5jdGlvbiBiKGEpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCh2b2lkIDAgIT09IGEsICJub2RlIG11c3QgYmUgZGVmaW5lZCIpCiAgICAgICAgcmV0dXJuIG51bGwgPT09IGEuY2hpbGRyZW4gPyAwIDogYS5jaGlsZHJlbi5sZW5ndGgKICAgICAgfQogICAgICBmdW5jdGlvbiBjKGEsIGIpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCh2b2lkIDAgIT09IGEsICJub2RlIG11c3QgYmUgZGVmaW5lZCIpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQodm9pZCAwICE9PSBiLCAiaW5kZXggb2YgY2hpbGQgbXVzdCBiZSBzcGVjaWZpZWQiKQogICAgICAgIHJldHVybiBhLmNoaWxkcmVuW2JdCiAgICAgIH0KICAgICAgZnVuY3Rpb24gZChhLCBiKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoYS50eXBlID09PSBiLCAibm9kZSB3YXNuJ3QgZXhwZWN0ZWQgdHlwZSIpCiAgICAgIH0KICAgICAgZnVuY3Rpb24gZShhLCBiLCBjKSB7CiAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoYywgYS5jX2ZpbGVuYW1lLCBiLmxpbmVubykKICAgICAgfQogICAgICBmdW5jdGlvbiBmKGEpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgKICAgICAgICAgICJzdHJpbmciID09PSB0eXBlb2YgYSwKICAgICAgICAgICJleHBlY3Rpbmcgc3RyaW5nLCBnb3QgIiArIHR5cGVvZiBhLAogICAgICAgICkKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3RyKGEpCiAgICAgIH0KICAgICAgZnVuY3Rpb24gZyhhKSB7CiAgICAgICAgdmFyIGQsIGUKICAgICAgICBzd2l0Y2ggKGEudHlwZSkgewogICAgICAgICAgY2FzZSB0LnNpbmdsZV9pbnB1dDoKICAgICAgICAgICAgaWYgKGMoYSwgMCkudHlwZSA9PT0gdi5UX05FV0xJTkUpIGJyZWFrCiAgICAgICAgICAgIGVsc2UgcmV0dXJuIGcoYyhhLCAwKSkKICAgICAgICAgIGNhc2UgdC5maWxlX2lucHV0OgogICAgICAgICAgICBmb3IgKGQgPSBlID0gMDsgZCA8IGIoYSk7ICsrZCkgewogICAgICAgICAgICAgIHZhciBrID0gYyhhLCBkKQogICAgICAgICAgICAgIGsudHlwZSA9PT0gdC5zdG10ICYmIChlICs9IGcoaykpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGUKICAgICAgICAgIGNhc2UgdC5zdG10OgogICAgICAgICAgICByZXR1cm4gZyhjKGEsIDApKQogICAgICAgICAgY2FzZSB0LmNvbXBvdW5kX3N0bXQ6CiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICBjYXNlIHQuc2ltcGxlX3N0bXQ6CiAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKGIoYSkgLyAyKQogICAgICAgICAgY2FzZSB0LnN1aXRlOgogICAgICAgICAgICBpZiAoMSA9PT0gYihhKSkgcmV0dXJuIGcoYyhhLCAwKSkKICAgICAgICAgICAgZSA9IDAKICAgICAgICAgICAgZm9yIChkID0gMjsgZCA8IGIoYSkgLSAxOyArK2QpIGUgKz0gZyhjKGEsIGQpKQogICAgICAgICAgICByZXR1cm4gZQogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJOb24tc3RhdGVtZW50IGZvdW5kIikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIDAKICAgICAgfQogICAgICBmdW5jdGlvbiBoKGEsIGIsIGMsIGQpIHsKICAgICAgICBjIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zdHIgJiYgKGMgPSBjLnYpCiAgICAgICAgaWYgKCJOb25lIiA9PT0gYykKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAiYXNzaWdubWVudCB0byBOb25lIiwKICAgICAgICAgICAgYS5jX2ZpbGVuYW1lLAogICAgICAgICAgICBkLAogICAgICAgICAgKQogICAgICAgIGlmICgiVHJ1ZSIgPT09IGMgfHwgIkZhbHNlIiA9PT0gYykKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAiYXNzaWdubWVudCB0byBUcnVlIG9yIEZhbHNlIGlzIGZvcmJpZGRlbiIsCiAgICAgICAgICAgIGEuY19maWxlbmFtZSwKICAgICAgICAgICAgZCwKICAgICAgICAgICkKICAgICAgfQogICAgICBmdW5jdGlvbiBrKGEsIGIsIGMsIGQpIHsKICAgICAgICB2YXIgZQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KAogICAgICAgICAgYyAhPT0gU2suYXN0bm9kZXMuQXVnU3RvcmUgJiYgYyAhPT0gU2suYXN0bm9kZXMuQXVnTG9hZCwKICAgICAgICAgICJjb250ZXh0IG5vdCBBdWdTdG9yZSBvciBBdWdMb2FkIiwKICAgICAgICApCiAgICAgICAgdmFyIGcgPSAoZSA9IG51bGwpCiAgICAgICAgc3dpdGNoIChiLmNvbnN0cnVjdG9yKSB7CiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkF0dHJpYnV0ZToKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTmFtZToKICAgICAgICAgICAgYyA9PT0gU2suYXN0bm9kZXMuU3RvcmUgJiYgaChhLCBkLCBiLmF0dHIsIGQubGluZW5vKQogICAgICAgICAgICBiLmN0eCA9IGMKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuU3Vic2NyaXB0OgogICAgICAgICAgICBiLmN0eCA9IGMKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTGlzdDoKICAgICAgICAgICAgYi5jdHggPSBjCiAgICAgICAgICAgIGUgPSBiLmVsdHMKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuVHVwbGU6CiAgICAgICAgICAgIGlmICgwID09PSBiLmVsdHMubGVuZ3RoKQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICAgImNhbid0IGFzc2lnbiB0byAoKSIsCiAgICAgICAgICAgICAgICBhLmNfZmlsZW5hbWUsCiAgICAgICAgICAgICAgICBkLmxpbmVubywKICAgICAgICAgICAgICApCiAgICAgICAgICAgIGIuY3R4ID0gYwogICAgICAgICAgICBlID0gYi5lbHRzCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkxhbWJkYToKICAgICAgICAgICAgZyA9ICJsYW1iZGEiCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkNhbGw6CiAgICAgICAgICAgIGcgPSAiZnVuY3Rpb24gY2FsbCIKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQm9vbE9wOgogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5CaW5PcDoKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuVW5hcnlPcDoKICAgICAgICAgICAgZyA9ICJvcGVyYXRvciIKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuR2VuZXJhdG9yRXhwOgogICAgICAgICAgICBnID0gImdlbmVyYXRvciBleHByZXNzaW9uIgogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5ZaWVsZDoKICAgICAgICAgICAgZyA9ICJ5aWVsZCBleHByZXNzaW9uIgogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5MaXN0Q29tcDoKICAgICAgICAgICAgZyA9ICJsaXN0IGNvbXByZWhlbnNpb24iCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlNldENvbXA6CiAgICAgICAgICAgIGcgPSAic2V0IGNvbXByZWhlbnNpb24iCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkRpY3RDb21wOgogICAgICAgICAgICBnID0gImRpY3QgY29tcHJlaGVuc2lvbiIKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuRGljdDoKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuU2V0OgogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5OdW06CiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlN0cjoKICAgICAgICAgICAgZyA9ICJsaXRlcmFsIgogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5OYW1lQ29uc3RhbnQ6CiAgICAgICAgICAgIGcgPSAiVHJ1ZSwgRmFsc2Ugb3IgTm9uZSIKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQ29tcGFyZToKICAgICAgICAgICAgZyA9ICJjb21wYXJpc29uIgogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5SZXByOgogICAgICAgICAgICBnID0gInJlcHIiCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLklmRXhwOgogICAgICAgICAgICBnID0gImNvbmRpdGlvbmFsIGV4cHJlc3Npb24iCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoInVuaGFuZGxlZCBleHByZXNzaW9uIGluIGFzc2lnbm1lbnQiKQogICAgICAgIH0KICAgICAgICBpZiAoZykKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAiY2FuJ3QgIiArCiAgICAgICAgICAgICAgKGMgPT09IFNrLmFzdG5vZGVzLlN0b3JlID8gImFzc2lnbiB0byIgOiAiZGVsZXRlIikgKwogICAgICAgICAgICAgICIgIiArCiAgICAgICAgICAgICAgZywKICAgICAgICAgICAgYS5jX2ZpbGVuYW1lLAogICAgICAgICAgICBkLmxpbmVubywKICAgICAgICAgICkKICAgICAgICBpZiAoZSkgZm9yIChiID0gMDsgYiA8IGUubGVuZ3RoOyArK2IpIGsoYSwgZVtiXSwgYywgZCkKICAgICAgfQogICAgICBmdW5jdGlvbiBsKGEpIHsKICAgICAgICBpZiAodm9pZCAwID09PSBNW2EudHlwZV0pCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigiaW52YWxpZCBzeW50YXgiLCBhLnR5cGUsIGEubGluZW5vKQogICAgICAgIHJldHVybiBNW2EudHlwZV0KICAgICAgfQogICAgICBmdW5jdGlvbiByKGEsIGIpIHsKICAgICAgICByZXR1cm4gYS52YWx1ZSA/IFNrLmJ1aWx0aW4uc3RyKGEudmFsdWUpIDogU2suYnVpbHRpbi5zdHIoYSkKICAgICAgfQogICAgICBmdW5jdGlvbiBuKGEsIGUpIHsKICAgICAgICBkKGUsIHQuY29tcF9vcCkKICAgICAgICBpZiAoMSA9PT0gYihlKSkKICAgICAgICAgIHN3aXRjaCAoKChlID0gYyhlLCAwKSksIGUudHlwZSkpIHsKICAgICAgICAgICAgY2FzZSB2LlRfTEVTUzoKICAgICAgICAgICAgICByZXR1cm4gU2suYXN0bm9kZXMuTHQKICAgICAgICAgICAgY2FzZSB2LlRfR1JFQVRFUjoKICAgICAgICAgICAgICByZXR1cm4gU2suYXN0bm9kZXMuR3QKICAgICAgICAgICAgY2FzZSB2LlRfRVFFUVVBTDoKICAgICAgICAgICAgICByZXR1cm4gU2suYXN0bm9kZXMuRXEKICAgICAgICAgICAgY2FzZSB2LlRfTEVTU0VRVUFMOgogICAgICAgICAgICAgIHJldHVybiBTay5hc3Rub2Rlcy5MdEUKICAgICAgICAgICAgY2FzZSB2LlRfR1JFQVRFUkVRVUFMOgogICAgICAgICAgICAgIHJldHVybiBTay5hc3Rub2Rlcy5HdEUKICAgICAgICAgICAgY2FzZSB2LlRfTk9URVFVQUw6CiAgICAgICAgICAgICAgcmV0dXJuIFNrLmFzdG5vZGVzLk5vdEVxCiAgICAgICAgICAgIGNhc2Ugdi5UX05BTUU6CiAgICAgICAgICAgICAgaWYgKCJpbiIgPT09IGUudmFsdWUpIHJldHVybiBTay5hc3Rub2Rlcy5JbgogICAgICAgICAgICAgIGlmICgiaXMiID09PSBlLnZhbHVlKSByZXR1cm4gU2suYXN0bm9kZXMuSXMKICAgICAgICAgIH0KICAgICAgICBlbHNlIGlmICgyID09PSBiKGUpICYmIGMoZSwgMCkudHlwZSA9PT0gdi5UX05BTUUpIHsKICAgICAgICAgIGlmICgiaW4iID09PSBjKGUsIDEpLnZhbHVlKSByZXR1cm4gU2suYXN0bm9kZXMuTm90SW4KICAgICAgICAgIGlmICgiaXMiID09PSBjKGUsIDApLnZhbHVlKSByZXR1cm4gU2suYXN0bm9kZXMuSXNOb3QKICAgICAgICB9CiAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJpbnZhbGlkIGNvbXBfb3AiKQogICAgICB9CiAgICAgIGZ1bmN0aW9uIHEoYSwgYikgewogICAgICAgIGEgJiYKICAgICAgICAgICgoYS5saW5lbm8gPSBiLmxpbmVubyksCiAgICAgICAgICAoYS5jb2xfb2Zmc2V0ID0gYi5jb2xfb2Zmc2V0KSwKICAgICAgICAgIChhLmVuZF9saW5lbm8gPSBiLmVuZF9saW5lbm8pLAogICAgICAgICAgKGEuZW5kX2NvbF9vZmZzZXQgPSBiLmVuZF9jb2xfb2Zmc2V0KSkKICAgICAgICByZXR1cm4gYQogICAgICB9CiAgICAgIGZ1bmN0aW9uIEQoYSwgZCkgewogICAgICAgIHZhciBlLAogICAgICAgICAgayA9IFtdCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoCiAgICAgICAgICBkLnR5cGUgPT09IHQudGVzdGxpc3QgfHwKICAgICAgICAgICAgZC50eXBlID09PSB0LnRlc3RsaXN0X3N0YXJfZXhwciB8fAogICAgICAgICAgICBkLnR5cGUgPT09IHQubGlzdG1ha2VyIHx8CiAgICAgICAgICAgIGQudHlwZSA9PT0gdC50ZXN0bGlzdF9jb21wIHx8CiAgICAgICAgICAgIGQudHlwZSA9PT0gdC50ZXN0bGlzdF9zYWZlIHx8CiAgICAgICAgICAgIGQudHlwZSA9PT0gdC50ZXN0bGlzdDEsCiAgICAgICAgICAibm9kZSB0eXBlIG11c3QgYmUgbGlzdGxpa2UiLAogICAgICAgICkKICAgICAgICBmb3IgKGUgPSAwOyBlIDwgYihkKTsgZSArPSAyKQogICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoCiAgICAgICAgICAgIGMoZCwgZSkudHlwZSA9PT0gdC50ZXN0IHx8CiAgICAgICAgICAgICAgYyhkLCBlKS50eXBlID09PSB0Lm9sZF90ZXN0IHx8CiAgICAgICAgICAgICAgYyhkLCBlKS50eXBlID09PSB0LnN0YXJfZXhwciwKICAgICAgICAgICksCiAgICAgICAgICAgIChrW2UgLyAyXSA9IHUoYSwgYyhkLCBlKSkpCiAgICAgICAgcmV0dXJuIGsKICAgICAgfQogICAgICBmdW5jdGlvbiB4KGEsIGUpIHsKICAgICAgICB2YXIgawogICAgICAgIGQoZSwgdC5zdWl0ZSkKICAgICAgICB2YXIgZiA9IFtdCiAgICAgICAgdmFyIGwgPSAwCiAgICAgICAgaWYgKGMoZSwgMCkudHlwZSA9PT0gdC5zaW1wbGVfc3RtdCkgewogICAgICAgICAgZSA9IGMoZSwgMCkKICAgICAgICAgIHZhciB3ID0gYihlKSAtIDEKICAgICAgICAgIGMoZSwgdyAtIDEpLnR5cGUgPT09IHYuVF9TRU1JICYmIC0tdwogICAgICAgICAgZm9yIChrID0gMDsgayA8IHc7IGsgKz0gMikgZltsKytdID0gTChhLCBjKGUsIGspKQogICAgICAgIH0gZWxzZQogICAgICAgICAgZm9yIChrID0gMjsgayA8IGIoZSkgLSAxOyArK2spIHsKICAgICAgICAgICAgdyA9IGMoZSwgaykKICAgICAgICAgICAgZCh3LCB0LnN0bXQpCiAgICAgICAgICAgIHZhciBoID0gZyh3KQogICAgICAgICAgICBpZiAoMSA9PT0gaCkgZltsKytdID0gTChhLCB3KQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgZm9yICh3ID0gYyh3LCAwKSwgZCh3LCB0LnNpbXBsZV9zdG10KSwgaCA9IDA7IGggPCBiKHcpOyBoICs9IDIpIHsKICAgICAgICAgICAgICAgIGlmICgwID09PSBiKGModywgaCkpKSB7CiAgICAgICAgICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KGggKyAxID09PSBiKHcpKQogICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZltsKytdID0gTChhLCBjKHcsIGgpKQogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICBTay5hc3NlcnRzLmFzc2VydChsID09PSBnKGUpKQogICAgICAgIHJldHVybiBmCiAgICAgIH0KICAgICAgZnVuY3Rpb24gSChhLCBlLCBnKSB7CiAgICAgICAgdmFyIGYKICAgICAgICBkKGUsIHQuZXhwcmxpc3QpCiAgICAgICAgdmFyIGwgPSBbXQogICAgICAgIGZvciAoZiA9IDA7IGYgPCBiKGUpOyBmICs9IDIpIHsKICAgICAgICAgIHZhciB3ID0gdShhLCBjKGUsIGYpKQogICAgICAgICAgbFtmIC8gMl0gPSB3CiAgICAgICAgICBnICYmIGsoYSwgdywgZywgYyhlLCBmKSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGwKICAgICAgfQogICAgICBmdW5jdGlvbiBKKGEsIGQpIHsKICAgICAgICBhOiBmb3IgKDs7KQogICAgICAgICAgc3dpdGNoIChkLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSB0LmltcG9ydF9hc19uYW1lOgogICAgICAgICAgICAgIGEgPSBudWxsCiAgICAgICAgICAgICAgdmFyIGUgPSBmKGMoZCwgMCkudmFsdWUpCiAgICAgICAgICAgICAgMyA9PT0gYihkKSAmJiAoYSA9IGMoZCwgMikudmFsdWUpCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5hbGlhcyhlLCBudWxsID09IGEgPyBudWxsIDogZihhKSkKICAgICAgICAgICAgY2FzZSB0LmRvdHRlZF9hc19uYW1lOgogICAgICAgICAgICAgIGlmICgxID09PSBiKGQpKSB7CiAgICAgICAgICAgICAgICBkID0gYyhkLCAwKQogICAgICAgICAgICAgICAgY29udGludWUgYQogICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgKGEgPSBKKGEsIGMoZCwgMCkpKSwKICAgICAgICAgICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoIWEuYXNuYW1lKSwKICAgICAgICAgICAgICAgICAgKGEuYXNuYW1lID0gZihjKGQsIDIpLnZhbHVlKSksCiAgICAgICAgICAgICAgICAgIGEKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgY2FzZSB0LmRvdHRlZF9uYW1lOgogICAgICAgICAgICAgIGlmICgxID09PSBiKGQpKQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5hbGlhcyhmKGMoZCwgMCkudmFsdWUpLCBudWxsKQogICAgICAgICAgICAgIGEgPSAiIgogICAgICAgICAgICAgIGZvciAoZSA9IDA7IGUgPCBiKGQpOyBlICs9IDIpIGEgKz0gYyhkLCBlKS52YWx1ZSArICIuIgogICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuYWxpYXMoZihhLnN1YnN0cigwLCBhLmxlbmd0aCAtIDEpKSwgbnVsbCkKICAgICAgICAgICAgY2FzZSB2LlRfU1RBUjoKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLmFsaWFzKGYoIioiKSwgbnVsbCkKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgICAgICJ1bmV4cGVjdGVkIGltcG9ydCBuYW1lIiwKICAgICAgICAgICAgICAgIGEuY19maWxlbmFtZSwKICAgICAgICAgICAgICAgIGQubGluZW5vLAogICAgICAgICAgICAgICkKICAgICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBBKGEsIGIpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChiLnR5cGUgPT0gdC50ZXN0bGlzdF9jb21wIHx8IGIudHlwZSA9PSB0LmFyZ3VtZW50KQogICAgICAgIHJldHVybiBaKGEsIGIsIDApCiAgICAgIH0KICAgICAgZnVuY3Rpb24gQyhhLCBkKSB7CiAgICAgICAgaWYgKGMoZCwgMCkudHlwZSA9PT0gdi5UX01JTlVTICYmIDIgPT09IGIoZCkpIHsKICAgICAgICAgIHZhciBlID0gYyhkLCAxKQogICAgICAgICAgaWYgKAogICAgICAgICAgICBlLnR5cGUgPT09IHQuZmFjdG9yICYmCiAgICAgICAgICAgIDEgPT09IGIoZSkgJiYKICAgICAgICAgICAgKChlID0gYyhlLCAwKSksIGUudHlwZSA9PT0gdC5wb3dlciAmJiAxID09PSBiKGUpKQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHZhciBrID0gYyhlLCAwKQogICAgICAgICAgICBpZiAoay50eXBlID09PSB0LmF0b20gJiYgKChlID0gYyhrLCAwKSksIGUudHlwZSA9PT0gdi5UX05VTUJFUikpCiAgICAgICAgICAgICAgcmV0dXJuIChlLnZhbHVlID0gIi0iICsgZS52YWx1ZSksIFEoYSwgaykKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYSA9IHUoYSwgYyhkLCAxKSkKICAgICAgICBzd2l0Y2ggKGMoZCwgMCkudHlwZSkgewogICAgICAgICAgY2FzZSB2LlRfUExVUzoKICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5VbmFyeU9wKAogICAgICAgICAgICAgIFNrLmFzdG5vZGVzLlVBZGQsCiAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICBkLmxpbmVubywKICAgICAgICAgICAgICBkLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICkKICAgICAgICAgIGNhc2Ugdi5UX01JTlVTOgogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLlVuYXJ5T3AoCiAgICAgICAgICAgICAgU2suYXN0bm9kZXMuVVN1YiwKICAgICAgICAgICAgICBhLAogICAgICAgICAgICAgIGQubGluZW5vLAogICAgICAgICAgICAgIGQuY29sX29mZnNldCwKICAgICAgICAgICAgKQogICAgICAgICAgY2FzZSB2LlRfVElMREU6CiAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuVW5hcnlPcCgKICAgICAgICAgICAgICBTay5hc3Rub2Rlcy5JbnZlcnQsCiAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICBkLmxpbmVubywKICAgICAgICAgICAgICBkLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJ1bmhhbmRsZWQgZmFjdG9yIikKICAgICAgfQogICAgICBmdW5jdGlvbiBLKGEsIGssIGcsIGYpIHsKICAgICAgICB2YXIgbCwgdywgcgogICAgICAgIGQoaywgdC5hcmdsaXN0KQogICAgICAgIGZvciAobCA9IHIgPSB3ID0gMDsgbCA8IGIoayk7IGwrKykgewogICAgICAgICAgdmFyIG4gPSBjKGssIGwpCiAgICAgICAgICBuLnR5cGUgPT0gdC5hcmd1bWVudCAmJgogICAgICAgICAgICAoMSA9PSBiKG4pCiAgICAgICAgICAgICAgPyB3KysKICAgICAgICAgICAgICA6IGMobiwgMSkudHlwZSA9PSB0LmNvbXBfZm9yCiAgICAgICAgICAgICAgPyAodysrLAogICAgICAgICAgICAgICAgZiB8fCBlKGEsIG4sICJpbnZhbGlkIHN5bnRheCIpLAogICAgICAgICAgICAgICAgMSA8IGIoaykgJiYKICAgICAgICAgICAgICAgICAgZShhLCBuLCAiR2VuZXJhdG9yIGV4cHJlc3Npb24gbXVzdCBiZSBwYXJlbnRoZXNpemVkIikpCiAgICAgICAgICAgICAgOiBjKG4sIDApLnR5cGUgPT0gdi5UX1NUQVIKICAgICAgICAgICAgICA/IHcrKwogICAgICAgICAgICAgIDogcisrKQogICAgICAgIH0KICAgICAgICB2YXIgUiA9IFtdCiAgICAgICAgdmFyIFQgPSBbXQogICAgICAgIGZvciAobCA9IGYgPSByID0gdyA9IDA7IGwgPCBiKGspOyBsKyspCiAgICAgICAgICBpZiAoKChuID0gYyhrLCBsKSksIG4udHlwZSA9PSB0LmFyZ3VtZW50KSkgewogICAgICAgICAgICB2YXIgTyA9IGMobiwgMCkKICAgICAgICAgICAgaWYgKDEgPT0gYihuKSkgewogICAgICAgICAgICAgIHIgJiYKICAgICAgICAgICAgICAgIChmCiAgICAgICAgICAgICAgICAgID8gZSgKICAgICAgICAgICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgICAgICAgICBPLAogICAgICAgICAgICAgICAgICAgICAgInBvc2l0aW9uYWwgYXJndW1lbnQgZm9sbG93cyBrZXl3b3JkIGFyZ3VtZW50IHVucGFja2luZyIsCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICA6IGUoYSwgTywgInBvc2l0aW9uYWwgYXJndW1lbnQgZm9sbG93cyBrZXl3b3JkIGFyZ3VtZW50IikpCiAgICAgICAgICAgICAgdmFyIHEgPSB1KGEsIE8pCiAgICAgICAgICAgICAgaWYgKCFxKSByZXR1cm4gbnVsbAogICAgICAgICAgICAgIFJbdysrXSA9IHEKICAgICAgICAgICAgfSBlbHNlIGlmIChPLnR5cGUgPT0gdi5UX1NUQVIpIHsKICAgICAgICAgICAgICBpZiAoZikKICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgIGUoCiAgICAgICAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICAgICAgICBPLAogICAgICAgICAgICAgICAgICAgICJpdGVyYWJsZSBhcmd1bWVudCB1bnBhY2tpbmcgZm9sbG93cyBrZXl3b3JkIGFyZ3VtZW50IHVucGFja2luZyIsCiAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgIG51bGwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICBxID0gdShhLCBjKG4sIDEpKQogICAgICAgICAgICAgIGlmICghcSkgcmV0dXJuIG51bGwKICAgICAgICAgICAgICBuID0gbmV3IFNrLmFzdG5vZGVzLlN0YXJyZWQoCiAgICAgICAgICAgICAgICBxLAogICAgICAgICAgICAgICAgU2suYXN0bm9kZXMuTG9hZCwKICAgICAgICAgICAgICAgIE8ubGluZW5vLAogICAgICAgICAgICAgICAgTy5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICkKICAgICAgICAgICAgICBSW3crK10gPSBuCiAgICAgICAgICAgIH0gZWxzZSBpZiAoTy50eXBlID09IHYuVF9ET1VCTEVTVEFSKSB7CiAgICAgICAgICAgICAgbCsrCiAgICAgICAgICAgICAgcSA9IHUoYSwgYyhuLCAxKSkKICAgICAgICAgICAgICBpZiAoIXEpIHJldHVybiBudWxsCiAgICAgICAgICAgICAgbiA9IG5ldyBTay5hc3Rub2Rlcy5rZXl3b3JkKG51bGwsIHEpCiAgICAgICAgICAgICAgVFtyKytdID0gbgogICAgICAgICAgICAgIGYrKwogICAgICAgICAgICB9IGVsc2UgaWYgKGMobiwgMSkudHlwZSA9PSB0LmNvbXBfZm9yKSB7CiAgICAgICAgICAgICAgcSA9IEEoYSwgbikKICAgICAgICAgICAgICBpZiAoIXEpIHJldHVybiBudWxsCiAgICAgICAgICAgICAgUlt3KytdID0gcQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciBtCiAgICAgICAgICAgICAgcSA9IHUoYSwgTykKICAgICAgICAgICAgICBpZiAoIXEpIHJldHVybiBudWxsCiAgICAgICAgICAgICAgaWYgKHEuY29uc3RydWN0b3IgPT09IFNrLmFzdG5vZGVzLkxhbWJkYSkKICAgICAgICAgICAgICAgIHJldHVybiBlKGEsIE8sICJsYW1iZGEgY2Fubm90IGNvbnRhaW4gYXNzaWdubWVudCIpLCBudWxsCiAgICAgICAgICAgICAgaWYgKHEuY29uc3RydWN0b3IgIT09IFNrLmFzdG5vZGVzLk5hbWUpCiAgICAgICAgICAgICAgICByZXR1cm4gZShhLCBPLCAia2V5d29yZCBjYW4ndCBiZSBhbiBleHByZXNzaW9uIiksIG51bGwKICAgICAgICAgICAgICBpZiAoaChhLCBxLmlkLCBuLCAxKSkgcmV0dXJuIG51bGwKICAgICAgICAgICAgICB2YXIgcCA9IHEuaWQKICAgICAgICAgICAgICBmb3IgKG0gPSAwOyBtIDwgcjsgbSsrKQogICAgICAgICAgICAgICAgaWYgKChxID0gVFttXS5hcmcpICYmIHEgPT09IHApCiAgICAgICAgICAgICAgICAgIHJldHVybiBlKGEsIE8sICJrZXl3b3JkIGFyZ3VtZW50IHJlcGVhdGVkIiksIG51bGwKICAgICAgICAgICAgICBxID0gdShhLCBjKG4sIDIpKQogICAgICAgICAgICAgIGlmICghcSkgcmV0dXJuIG51bGwKICAgICAgICAgICAgICBuID0gbmV3IFNrLmFzdG5vZGVzLmtleXdvcmQocCwgcSkKICAgICAgICAgICAgICBUW3IrK10gPSBuCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLkNhbGwoZywgUiwgVCwgZy5saW5lbm8sIGcuY29sX29mZnNldCkKICAgICAgfQogICAgICBmdW5jdGlvbiBCKGEsIGUsIGspIHsKICAgICAgICBkKGUsIHQudHJhaWxlcikKICAgICAgICBpZiAoYyhlLCAwKS50eXBlID09IHYuVF9MUEFSKQogICAgICAgICAgcmV0dXJuIDIgPT0gYihlKQogICAgICAgICAgICA/IG5ldyBTay5hc3Rub2Rlcy5DYWxsKGssIG51bGwsIG51bGwsIGUubGluZW5vLCBlLmNvbF9vZmZzZXQpCiAgICAgICAgICAgIDogSyhhLCBjKGUsIDEpLCBrLCAhMCkKICAgICAgICBpZiAoYyhlLCAwKS50eXBlID09IHYuVF9ET1QpIHsKICAgICAgICAgIHZhciBnID0gcihjKGUsIDEpKQogICAgICAgICAgcmV0dXJuIGcKICAgICAgICAgICAgPyBuZXcgU2suYXN0bm9kZXMuQXR0cmlidXRlKAogICAgICAgICAgICAgICAgaywKICAgICAgICAgICAgICAgIGcsCiAgICAgICAgICAgICAgICBTay5hc3Rub2Rlcy5Mb2FkLAogICAgICAgICAgICAgICAgZS5saW5lbm8sCiAgICAgICAgICAgICAgICBlLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICA6IG51bGwKICAgICAgICB9CiAgICAgICAgZChjKGUsIDApLCB2LlRfTFNRQikKICAgICAgICBkKGMoZSwgMiksIHYuVF9SU1FCKQogICAgICAgIGUgPSBjKGUsIDEpCiAgICAgICAgaWYgKDEgPT0gYihlKSkKICAgICAgICAgIHJldHVybiAoZyA9IEYoYSwgYyhlLCAwKSkpCiAgICAgICAgICAgID8gbmV3IFNrLmFzdG5vZGVzLlN1YnNjcmlwdCgKICAgICAgICAgICAgICAgIGssCiAgICAgICAgICAgICAgICBnLAogICAgICAgICAgICAgICAgU2suYXN0bm9kZXMuTG9hZCwKICAgICAgICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgICAgICAgZS5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICkKICAgICAgICAgICAgOiBudWxsCiAgICAgICAgdmFyIGYsCiAgICAgICAgICBsID0gMSwKICAgICAgICAgIHcgPSBbXQogICAgICAgIGZvciAoZiA9IDA7IGYgPCBiKGUpOyBmICs9IDIpIHsKICAgICAgICAgIGcgPSBGKGEsIGMoZSwgZikpCiAgICAgICAgICBpZiAoIWcpIHJldHVybiBudWxsCiAgICAgICAgICBnLmtpbmQgIT0gVy5JbmRleF9raW5kICYmIChsID0gMCkKICAgICAgICAgIHdbZiAvIDJdID0gZwogICAgICAgIH0KICAgICAgICBpZiAoIWwpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLlN1YnNjcmlwdCgKICAgICAgICAgICAgaywKICAgICAgICAgICAgbmV3IFNrLmFzdG5vZGVzLkV4dFNsaWNlKHcpLAogICAgICAgICAgICBTay5hc3Rub2Rlcy5Mb2FkLAogICAgICAgICAgICBlLmxpbmVubywKICAgICAgICAgICAgZS5jb2xfb2Zmc2V0LAogICAgICAgICAgKQogICAgICAgIGEgPSBbXQogICAgICAgIGZvciAoZiA9IDA7IGYgPCB3Lmxlbmd0aDsgKytmKQogICAgICAgICAgKGcgPSB3W2ZdKSwKICAgICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoZy5raW5kID09IFcuSW5kZXhfa2luZCAmJiBnLnYuSW5kZXgudmFsdWUpLAogICAgICAgICAgICAoYVtmXSA9IGcudi5JbmRleC52YWx1ZSkKICAgICAgICBnID0gbmV3IFNrLmFzdG5vZGVzLlR1cGxlKGEsIFNrLmFzdG5vZGVzLkxvYWQsIGUubGluZW5vLCBlLmNvbF9vZmZzZXQpCiAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5TdWJzY3JpcHQoCiAgICAgICAgICBrLAogICAgICAgICAgbmV3IFNrLmFzdG5vZGVzLkluZGV4KGcpLAogICAgICAgICAgU2suYXN0bm9kZXMuTG9hZCwKICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgZS5jb2xfb2Zmc2V0LAogICAgICAgICkKICAgICAgfQogICAgICBmdW5jdGlvbiBTKGEsIGspIHsKICAgICAgICBkKGssIHQuZmxvd19zdG10KQogICAgICAgIHZhciBnID0gYyhrLCAwKQogICAgICAgIHN3aXRjaCAoZy50eXBlKSB7CiAgICAgICAgICBjYXNlIHQuYnJlYWtfc3RtdDoKICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5CcmVhaygKICAgICAgICAgICAgICBrLmxpbmVubywKICAgICAgICAgICAgICBrLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgay5lbmRfbGluZW5vLAogICAgICAgICAgICAgIGsuZW5kX2NvbF9vZmZzZXQsCiAgICAgICAgICAgICkKICAgICAgICAgIGNhc2UgdC5jb250aW51ZV9zdG10OgogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLkNvbnRpbnVlKAogICAgICAgICAgICAgIGsubGluZW5vLAogICAgICAgICAgICAgIGsuY29sX29mZnNldCwKICAgICAgICAgICAgICBrLmVuZF9saW5lbm8sCiAgICAgICAgICAgICAgay5lbmRfY29sX29mZnNldCwKICAgICAgICAgICAgKQogICAgICAgICAgY2FzZSB0LnlpZWxkX3N0bXQ6CiAgICAgICAgICAgIHJldHVybiAoYSA9IHUoYSwgYyhnLCAwKSkpCiAgICAgICAgICAgICAgPyBuZXcgU2suYXN0bm9kZXMuRXhwcigKICAgICAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICAgICAgay5saW5lbm8sCiAgICAgICAgICAgICAgICAgIGsuY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgay5lbmRfbGluZW5vLAogICAgICAgICAgICAgICAgICBrLmVuZF9jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIDogbnVsbAogICAgICAgICAgY2FzZSB0LnJldHVybl9zdG10OgogICAgICAgICAgICBpZiAoMSA9PSBiKGcpKQogICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuUmV0dXJuKAogICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgIGsubGluZW5vLAogICAgICAgICAgICAgICAgay5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgay5lbmRfbGluZW5vLAogICAgICAgICAgICAgICAgay5lbmRfY29sX29mZnNldCwKICAgICAgICAgICAgICApCiAgICAgICAgICAgIHZhciBmID0gSShhLCBjKGcsIDEpKQogICAgICAgICAgICByZXR1cm4gZgogICAgICAgICAgICAgID8gbmV3IFNrLmFzdG5vZGVzLlJldHVybigKICAgICAgICAgICAgICAgICAgZiwKICAgICAgICAgICAgICAgICAgay5saW5lbm8sCiAgICAgICAgICAgICAgICAgIGsuY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgay5lbmRfbGluZW5vLAogICAgICAgICAgICAgICAgICBrLmVuZF9jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIDogbnVsbAogICAgICAgICAgY2FzZSB0LnJhaXNlX3N0bXQ6CiAgICAgICAgICAgIGlmICgxID09IGIoZykpCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5SYWlzZSgKICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICBrLmxpbmVubywKICAgICAgICAgICAgICAgIGsuY29sX29mZnNldCwKICAgICAgICAgICAgICAgIGsuZW5kX2xpbmVubywKICAgICAgICAgICAgICAgIGsuZW5kX2NvbF9vZmZzZXQsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBpZiAoMiA8PSBiKGcpKSB7CiAgICAgICAgICAgICAgdmFyIGwgPSBudWxsCiAgICAgICAgICAgICAgZiA9IHUoYSwgYyhnLCAxKSkKICAgICAgICAgICAgICB2YXIgdyA9IG51bGwsCiAgICAgICAgICAgICAgICBoID0gbnVsbAogICAgICAgICAgICAgIDQgPT0gYihnKSAmJiAiZnJvbSIgPT0gYyhnLCAyKS52YWx1ZQogICAgICAgICAgICAgICAgPyAoU2suX19mdXR1cmVfXy5weXRob24zIHx8CiAgICAgICAgICAgICAgICAgICAgZSgKICAgICAgICAgICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgICAgICAgICBjKGcsIDIpLAogICAgICAgICAgICAgICAgICAgICAgInJhaXNlIC4uLiBmcm9tIC4uLiBpcyBub3QgYXZhaWxhYmxlIGluIFB5dGhvbiAyIiwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAobCA9IHUoYSwgYyhnLCAzKSkpKQogICAgICAgICAgICAgICAgOiA0IDw9IGIoZykgJiYKICAgICAgICAgICAgICAgICAgIiwiID09IGMoZywgMikudmFsdWUgJiYKICAgICAgICAgICAgICAgICAgKFNrLl9fZnV0dXJlX18ucHl0aG9uMyAmJgogICAgICAgICAgICAgICAgICAgIGUoYSwgaywgIk9sZCByYWlzZSBzeW50YXggaXMgbm90IGF2YWlsYWJsZSBpbiBQeXRob24gMyIpLAogICAgICAgICAgICAgICAgICAodyA9IHUoYSwgYyhnLCAzKSkpLAogICAgICAgICAgICAgICAgICA2ID09IGIoZykgJiYgKGggPSB1KGEsIGMoZywgNSkpKSkKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLlJhaXNlKAogICAgICAgICAgICAgICAgZiwKICAgICAgICAgICAgICAgIGwsCiAgICAgICAgICAgICAgICB3LAogICAgICAgICAgICAgICAgaCwKICAgICAgICAgICAgICAgIGsubGluZW5vLAogICAgICAgICAgICAgICAgay5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgay5lbmRfbGluZW5vLAogICAgICAgICAgICAgICAgay5lbmRfY29sX29mZnNldCwKICAgICAgICAgICAgICApCiAgICAgICAgICAgIH0KICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHJldHVybiBTay5hc3NlcnRzLmZhaWwoInVuZXhwZWN0ZWQgZmxvd19zdG10OiAiLCBnLnR5cGUpLCBudWxsCiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIEcoYSwgZCkgewogICAgICAgIHZhciBlID0gbnVsbAogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KGQudHlwZSA9PT0gdC50ZnBkZWYgfHwgZC50eXBlID09PSB0LnZmcGRlZikKICAgICAgICB2YXIgayA9IGMoZCwgMCkKICAgICAgICBoKGEsIGssIGsudmFsdWUsIGsubGluZW5vKQogICAgICAgIGsgPSBmKGsudmFsdWUpCiAgICAgICAgMyA9PSBiKGQpICYmIGMoZCwgMSkudHlwZSA9PT0gdi5UX0NPTE9OICYmIChlID0gdShhLCBjKGQsIDIpKSkKICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLmFyZyhrLCBlLCBkLmxpbmVubywgZC5jb2xfb2Zmc2V0KQogICAgICB9CiAgICAgIGZ1bmN0aW9uIHooYSwgZCwgaywgZywgbCkgewogICAgICAgIHZhciB3ID0gaywKICAgICAgICAgIHIgPSAwCiAgICAgICAgZyB8fCBlKGEsIGMoZCwgayksICJuYW1lZCBhcmd1bWVudHMgbXVzdCBmb2xsb3cgYmFyZSAqIikKICAgICAgICBmb3IgKFNrLmFzc2VydHMuYXNzZXJ0KGwpOyB3IDwgYihkKTsgKSB7CiAgICAgICAgICB2YXIgbiA9IGMoZCwgdykKICAgICAgICAgIHN3aXRjaCAobi50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgdC52ZnBkZWY6CiAgICAgICAgICAgIGNhc2UgdC50ZnBkZWY6CiAgICAgICAgICAgICAgdyArIDEgPCBiKGQpICYmIGMoZCwgdyArIDEpLnR5cGUgPT0gdi5UX0VRVUFMCiAgICAgICAgICAgICAgICA/ICgobFtyXSA9IHUoYSwgYyhkLCB3ICsgMikpKSwgKHcgKz0gMikpCiAgICAgICAgICAgICAgICA6IChsW3JdID0gbnVsbCkKICAgICAgICAgICAgICB2YXIgUiA9IDMgPT0gYihuKSA/IHUoYSwgYyhuLCAyKSkgOiBudWxsCiAgICAgICAgICAgICAgbiA9IGMobiwgMCkKICAgICAgICAgICAgICBoKGEsIG4sIG4udmFsdWUsIG4ubGluZW5vKQogICAgICAgICAgICAgIGsgPSBmKG4udmFsdWUpCiAgICAgICAgICAgICAgZ1tyKytdID0gbmV3IFNrLmFzdG5vZGVzLmFyZyhrLCBSLCBuLmxpbmVubywgbi5jb2xfb2Zmc2V0KQogICAgICAgICAgICAgIHcgKz0gMgogICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGNhc2Ugdi5UX0RPVUJMRVNUQVI6CiAgICAgICAgICAgICAgcmV0dXJuIHcKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBlKGEsIG4sICJ1bmV4cGVjdGVkIG5vZGUiKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFAoYSwgZCkgewogICAgICAgIHZhciBlLAogICAgICAgICAgaywKICAgICAgICAgIGcsCiAgICAgICAgICBmID0gW10sCiAgICAgICAgICBsID0gW10sCiAgICAgICAgICBoID0gW10sCiAgICAgICAgICB3ID0gW10sCiAgICAgICAgICByID0gbnVsbCwKICAgICAgICAgIG4gPSBudWxsCiAgICAgICAgaWYgKGQudHlwZSA9PT0gdC5wYXJhbWV0ZXJzKSB7CiAgICAgICAgICBpZiAoMiA9PT0gYihkKSkKICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5hcmd1bWVudHNfKFtdLCBudWxsLCBbXSwgW10sIG51bGwsIFtdKQogICAgICAgICAgZCA9IGMoZCwgMSkKICAgICAgICB9CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoCiAgICAgICAgICBkLnR5cGUgPT09IHQudmFyYXJnc2xpc3QgfHwgZC50eXBlID09PSB0LnR5cGVkYXJnc2xpc3QsCiAgICAgICAgKQogICAgICAgIGZvciAoZSA9IGsgPSBnID0gMDsgZyA8IGIoZCk7ICkgewogICAgICAgICAgdmFyIHEgPSBjKGQsIGcpCiAgICAgICAgICBzd2l0Y2ggKHEudHlwZSkgewogICAgICAgICAgICBjYXNlIHQudGZwZGVmOgogICAgICAgICAgICBjYXNlIHQudmZwZGVmOgogICAgICAgICAgICAgIGlmIChnICsgMSA8IGIoZCkgJiYgYyhkLCBnICsgMSkudHlwZSA9PSB2LlRfRVFVQUwpIHsKICAgICAgICAgICAgICAgIGxbaysrXSA9IHUoYSwgYyhkLCBnICsgMikpCiAgICAgICAgICAgICAgICBnICs9IDIKICAgICAgICAgICAgICAgIHZhciBUID0gMQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoVCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICAgICAibm9uLWRlZmF1bHQgYXJndW1lbnQgZm9sbG93cyBkZWZhdWx0IGFyZ3VtZW50IiwKICAgICAgICAgICAgICAgICAgYS5jX2ZpbGVuYW1lLAogICAgICAgICAgICAgICAgICBkLmxpbmVubywKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICBmW2UrK10gPSBHKGEsIHEpCiAgICAgICAgICAgICAgZyArPSAyCiAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgY2FzZSB2LlRfU1RBUjoKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBnICsgMSA+PSBiKGQpIHx8CiAgICAgICAgICAgICAgICAoZyArIDIgPT0gYihkKSAmJiBjKGQsIGcgKyAxKS50eXBlID09IHYuVF9DT01NQSkKICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgICAgICAgIm5hbWVkIGFyZ3VtZW50cyBtdXN0IGZvbGxvdyBiYXJlICoiLAogICAgICAgICAgICAgICAgICBhLmNfZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgIGQubGluZW5vLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIHEgPSBjKGQsIGcgKyAxKQogICAgICAgICAgICAgIHEudHlwZSA9PSB2LlRfQ09NTUEKICAgICAgICAgICAgICAgID8gKChnICs9IDIpLCAoZyA9IHooYSwgZCwgZywgaCwgdykpKQogICAgICAgICAgICAgICAgOiAoKHIgPSBHKGEsIHEpKSwKICAgICAgICAgICAgICAgICAgKGcgKz0gMyksCiAgICAgICAgICAgICAgICAgIGcgPCBiKGQpICYmCiAgICAgICAgICAgICAgICAgICAgKGMoZCwgZykudHlwZSA9PSB0LnRmcGRlZiB8fCBjKGQsIGcpLnR5cGUgPT0gdC52ZnBkZWYpICYmCiAgICAgICAgICAgICAgICAgICAgKGcgPSB6KGEsIGQsIGcsIGgsIHcpKSkKICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBjYXNlIHYuVF9ET1VCTEVTVEFSOgogICAgICAgICAgICAgIHEgPSBjKGQsIGcgKyAxKQogICAgICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KHEudHlwZSA9PSB0LnRmcGRlZiB8fCBxLnR5cGUgPT0gdC52ZnBkZWYpCiAgICAgICAgICAgICAgbiA9IEcoYSwgcSkKICAgICAgICAgICAgICBnICs9IDMKICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgidW5leHBlY3RlZCBub2RlIGluIHZhcmFyZ3NsaXN0IikKICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5hcmd1bWVudHNfKGYsIHIsIGgsIHcsIG4sIGwpCiAgICAgIH0KICAgICAgZnVuY3Rpb24gVihhLCBrLCBnLCBmKSB7CiAgICAgICAgdmFyIGwgPSBmID8gYyhrLCAxKSA6IGssCiAgICAgICAgICB3ID0gbnVsbCwKICAgICAgICAgIG4gPSAxLAogICAgICAgICAgUiA9IG51bGwKICAgICAgICBpZiAoZiAmJiA1ID4gYS5jX2ZlYXR1cmVfdmVyc2lvbikKICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIGUoCiAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICBsLAogICAgICAgICAgICAgICJBc3luYyBmdW5jdGlvbnMgYXJlIG9ubHkgc3VwcG9ydGVkIGluIFB5dGhvbiAzLjUgYW5kIGdyZWF0ZXIiLAogICAgICAgICAgICApLAogICAgICAgICAgICBudWxsCiAgICAgICAgICApCiAgICAgICAgZChsLCB0LmZ1bmNkZWYpCiAgICAgICAgdmFyIHEgPSByKGMobCwgbikpCiAgICAgICAgaWYgKGgoYSwgcSwgYyhsLCBuKSwgMCkpIHJldHVybiBudWxsCiAgICAgICAgdmFyIFQgPSBQKGEsIGMobCwgbiArIDEpKQogICAgICAgIGlmICghVCkgcmV0dXJuIG51bGwKICAgICAgICBpZiAoYyhsLCBuICsgMikudHlwZSA9PSB2LlRfUkFSUk9XKSB7CiAgICAgICAgICB3ID0gdShhLCBjKGwsIG4gKyAzKSkKICAgICAgICAgIGlmICghdykgcmV0dXJuIG51bGwKICAgICAgICAgIG4gKz0gMgogICAgICAgIH0KICAgICAgICBpZiAoYyhsLCBuICsgMykudHlwZSA9PSB2LlRfVFlQRV9DT01NRU5UKSB7CiAgICAgICAgICBSID0gdi5UX05FV19UWVBFX0NPTU1FTlQoYyhsLCBuICsgMykpCiAgICAgICAgICBpZiAoIVIpIHJldHVybiBudWxsCiAgICAgICAgICBuICs9IDEKICAgICAgICB9CiAgICAgICAgdmFyIE8gPSB4KGEsIGMobCwgbiArIDMpKQogICAgICAgIGlmICghTykgcmV0dXJuIG51bGwKICAgICAgICBpZiAoCiAgICAgICAgICAxIDwgYihjKGwsIG4gKyAzKSkgJiYKICAgICAgICAgICgobiA9IGMoYyhsLCBuICsgMyksIDEpKSwgbi50eXBlID09IHYuVF9UWVBFX0NPTU1FTlQpCiAgICAgICAgKSB7CiAgICAgICAgICBpZiAobnVsbCAhPSBSKQogICAgICAgICAgICByZXR1cm4gZShhLCBsLCAiQ2Fubm90IGhhdmUgdHdvIHR5cGUgY29tbWVudHMgb24gZGVmIiksIG51bGwKICAgICAgICAgIFIgPSB2LlRfTkVXX1RZUEVfQ09NTUVOVChuKQogICAgICAgICAgaWYgKCFSKSByZXR1cm4gbnVsbAogICAgICAgIH0KICAgICAgICByZXR1cm4gZgogICAgICAgICAgPyBuZXcgU2suYXN0bm9kZXMuQXN5bmNGdW5jdGlvbkRlZigKICAgICAgICAgICAgICBxLAogICAgICAgICAgICAgIFQsCiAgICAgICAgICAgICAgTywKICAgICAgICAgICAgICBnLAogICAgICAgICAgICAgIHcsCiAgICAgICAgICAgICAgUiwKICAgICAgICAgICAgICBrLmxpbmVubywKICAgICAgICAgICAgICBrLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgdm9pZCAwLAogICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgKQogICAgICAgICAgOiBuZXcgU2suYXN0bm9kZXMuRnVuY3Rpb25EZWYoCiAgICAgICAgICAgICAgcSwKICAgICAgICAgICAgICBULAogICAgICAgICAgICAgIE8sCiAgICAgICAgICAgICAgZywKICAgICAgICAgICAgICB3LAogICAgICAgICAgICAgIFIsCiAgICAgICAgICAgICAgbC5saW5lbm8sCiAgICAgICAgICAgICAgbC5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgICB2b2lkIDAsCiAgICAgICAgICAgICkKICAgICAgfQogICAgICBmdW5jdGlvbiBYKGEsIGUsIGspIHsKICAgICAgICBkKGUsIHQuY2xhc3NkZWYpCiAgICAgICAgaWYgKDQgPT0gYihlKSkgewogICAgICAgICAgdmFyIGcgPSB4KGEsIGMoZSwgMykpCiAgICAgICAgICB2YXIgZiA9IHIoYyhlLCAxKS52YWx1ZSkKICAgICAgICAgIGgoYSwgYyhlLCAzKSwgZiwgZS5saW5lbm8pCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLkNsYXNzRGVmKAogICAgICAgICAgICBmLAogICAgICAgICAgICBbXSwKICAgICAgICAgICAgW10sCiAgICAgICAgICAgIGcsCiAgICAgICAgICAgIGssCiAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgICBlLmNvbF9vZmZzZXQsCiAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIGlmIChjKGUsIDMpLnR5cGUgPT09IHYuVF9SUEFSKQogICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgKGcgPSB4KGEsIGMoZSwgNSkpKSwKICAgICAgICAgICAgKGYgPSByKGMoZSwgMSkudmFsdWUpKSwKICAgICAgICAgICAgaChhLCBjKGUsIDMpLCBmLCBjKGUsIDMpLmxpbmVubyksCiAgICAgICAgICAgIG5ldyBTay5hc3Rub2Rlcy5DbGFzc0RlZigKICAgICAgICAgICAgICBmLAogICAgICAgICAgICAgIFtdLAogICAgICAgICAgICAgIFtdLAogICAgICAgICAgICAgIGcsCiAgICAgICAgICAgICAgaywKICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgICAgIGUuY29sX29mZnNldCwKICAgICAgICAgICAgKQogICAgICAgICAgKQogICAgICAgIGYgPSByKGMoZSwgMSkpCiAgICAgICAgZiA9IG5ldyBTay5hc3Rub2Rlcy5OYW1lKGYsIFNrLmFzdG5vZGVzLkxvYWQsIGUubGluZW5vLCBlLmNvbF9vZmZzZXQpCiAgICAgICAgdmFyIGwgPSBLKGEsIGMoZSwgMyksIGYsICExKQogICAgICAgIGcgPSB4KGEsIGMoZSwgNikpCiAgICAgICAgZiA9IHIoYyhlLCAxKS52YWx1ZSkKICAgICAgICBoKGEsIGMoZSwgMSksIGYsIGMoZSwgMSkubGluZW5vKQogICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuQ2xhc3NEZWYoCiAgICAgICAgICBmLAogICAgICAgICAgbC5hcmdzLAogICAgICAgICAgbC5rZXl3b3JkcywKICAgICAgICAgIGcsCiAgICAgICAgICBrLAogICAgICAgICAgbnVsbCwKICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgZS5jb2xfb2Zmc2V0LAogICAgICAgICkKICAgICAgfQogICAgICBmdW5jdGlvbiBZKGEsIGUpIHsKICAgICAgICBmdW5jdGlvbiBrKGEsIGUpIHsKICAgICAgICAgIGZvciAoYSA9IDA7IDsgKSB7CiAgICAgICAgICAgIGQoZSwgdC5jb21wX2l0ZXIpCiAgICAgICAgICAgIGlmIChjKGUsIDApLnR5cGUgPT09IHQuY29tcF9mb3IpIHJldHVybiBhCiAgICAgICAgICAgIGUgPSBjKGUsIDApCiAgICAgICAgICAgIGQoZSwgdC5jb21wX2lmKQogICAgICAgICAgICBhKysKICAgICAgICAgICAgaWYgKDIgPT09IGIoZSkpIHJldHVybiBhCiAgICAgICAgICAgIGUgPSBjKGUsIDIpCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBnCiAgICAgICAgdmFyIGYgPSAoZnVuY3Rpb24gKGEsIGUpIHsKICAgICAgICAgIGEgPSAwCiAgICAgICAgICBhOiBmb3IgKDs7KSB7CiAgICAgICAgICAgIGErKwogICAgICAgICAgICBkKGUsIHQuY29tcF9mb3IpCiAgICAgICAgICAgIGlmICg1ID09PSBiKGUpKSBlID0gYyhlLCA0KQogICAgICAgICAgICBlbHNlIHJldHVybiBhCiAgICAgICAgICAgIGI6IGZvciAoOzspIHsKICAgICAgICAgICAgICBkKGUsIHQuY29tcF9pdGVyKQogICAgICAgICAgICAgIGUgPSBjKGUsIDApCiAgICAgICAgICAgICAgaWYgKGUudHlwZSA9PT0gdC5jb21wX2ZvcikgY29udGludWUgYQogICAgICAgICAgICAgIGVsc2UgaWYgKGUudHlwZSA9PT0gdC5jb21wX2lmKQogICAgICAgICAgICAgICAgaWYgKDMgPT09IGIoZSkpIHsKICAgICAgICAgICAgICAgICAgZSA9IGMoZSwgMikKICAgICAgICAgICAgICAgICAgY29udGludWUgYgogICAgICAgICAgICAgICAgfSBlbHNlIHJldHVybiBhCiAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhawogICAgICAgICAgfQogICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJsb2dpYyBlcnJvciBpbiBjb3VudENvbXBGb3JzIikKICAgICAgICB9KShhLCBlKQogICAgICAgIHZhciBsID0gW10KICAgICAgICBmb3IgKGcgPSAwOyBnIDwgZjsgKytnKSB7CiAgICAgICAgICBkKGUsIHQuY29tcF9mb3IpCiAgICAgICAgICB2YXIgaCA9IGMoZSwgMSkKICAgICAgICAgIHZhciBuID0gSChhLCBoLCBTay5hc3Rub2Rlcy5TdG9yZSkKICAgICAgICAgIHZhciByID0gdShhLCBjKGUsIDMpKQogICAgICAgICAgdmFyIHcgPQogICAgICAgICAgICAxID09PSBiKGgpCiAgICAgICAgICAgICAgPyBuZXcgU2suYXN0bm9kZXMuY29tcHJlaGVuc2lvbihuWzBdLCByLCBbXSkKICAgICAgICAgICAgICA6IG5ldyBTay5hc3Rub2Rlcy5jb21wcmVoZW5zaW9uKAogICAgICAgICAgICAgICAgICBuZXcgU2suYXN0bm9kZXMuVHVwbGUoCiAgICAgICAgICAgICAgICAgICAgbiwKICAgICAgICAgICAgICAgICAgICBTay5hc3Rub2Rlcy5TdG9yZSwKICAgICAgICAgICAgICAgICAgICBlLmxpbmVubywKICAgICAgICAgICAgICAgICAgICBlLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgIHIsCiAgICAgICAgICAgICAgICAgIFtdLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgaWYgKDUgPT09IGIoZSkpIHsKICAgICAgICAgICAgZSA9IGMoZSwgNCkKICAgICAgICAgICAgdmFyIHEgPSBrKGEsIGUpCiAgICAgICAgICAgIGggPSBbXQogICAgICAgICAgICBmb3IgKG4gPSAwOyBuIDwgcTsgKytuKQogICAgICAgICAgICAgIGQoZSwgdC5jb21wX2l0ZXIpLAogICAgICAgICAgICAgICAgKGUgPSBjKGUsIDApKSwKICAgICAgICAgICAgICAgIGQoZSwgdC5jb21wX2lmKSwKICAgICAgICAgICAgICAgIChyID0gdShhLCBjKGUsIDEpKSksCiAgICAgICAgICAgICAgICAoaFtuXSA9IHIpLAogICAgICAgICAgICAgICAgMyA9PT0gYihlKSAmJiAoZSA9IGMoZSwgMikpCiAgICAgICAgICAgIGUudHlwZSA9PT0gdC5jb21wX2l0ZXIgJiYgKGUgPSBjKGUsIDApKQogICAgICAgICAgICB3LmlmcyA9IGgKICAgICAgICAgIH0KICAgICAgICAgIGxbZ10gPSB3CiAgICAgICAgfQogICAgICAgIHJldHVybiBsCiAgICAgIH0KICAgICAgZnVuY3Rpb24gYWEoYSwgZSkgewogICAgICAgIHZhciBrID0gW10KICAgICAgICBhOiB7CiAgICAgICAgICB2YXIgZyA9IGUKICAgICAgICAgIHZhciBmID0gMAogICAgICAgICAgYjogZm9yICg7OykgewogICAgICAgICAgICB2YXIgbCA9IDAKICAgICAgICAgICAgZisrCiAgICAgICAgICAgIGQoZywgdC5jb21wX2ZvcikKICAgICAgICAgICAgYyhnLCAwKS50eXBlID09IHYuVF9BU1lOQyAmJiAobCA9IDEpCiAgICAgICAgICAgIGlmIChiKGcpID09IDUgKyBsKSBnID0gYyhnLCA0ICsgbCkKICAgICAgICAgICAgZWxzZSBicmVhayBhCiAgICAgICAgICAgIGM6IGZvciAoOzspIHsKICAgICAgICAgICAgICBkKGcsIHQuY29tcF9pdGVyKQogICAgICAgICAgICAgIGcgPSBjKGcsIDApCiAgICAgICAgICAgICAgaWYgKGcudHlwZSA9PT0gdC5jb21wX2ZvcikgY29udGludWUgYgogICAgICAgICAgICAgIGVsc2UgaWYgKGcudHlwZSA9PT0gdC5jb21wX2lmKQogICAgICAgICAgICAgICAgaWYgKDMgPT09IGIoZykpIHsKICAgICAgICAgICAgICAgICAgZyA9IGMoZywgMikKICAgICAgICAgICAgICAgICAgY29udGludWUgYwogICAgICAgICAgICAgICAgfSBlbHNlIGJyZWFrIGEKICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICB9CiAgICAgICAgICBmID0gdm9pZCAwCiAgICAgICAgfQogICAgICAgIGZvciAoZyA9IDA7IGcgPCBmOyBnKyspIHsKICAgICAgICAgIHZhciBoID0gMAogICAgICAgICAgYyhlLCAwKS50eXBlID09IHYuVF9BU1lOQyAmJiAoaCA9IDEpCiAgICAgICAgICB2YXIgbiA9IGMoZSwgMSArIGgpCiAgICAgICAgICB2YXIgciA9IEgoYSwgbiwgU2suYXN0bm9kZXMuU3RvcmUpCiAgICAgICAgICBpZiAoIXIpIHJldHVybiBudWxsCiAgICAgICAgICBsID0gdShhLCBjKGUsIDMgKyBoKSkKICAgICAgICAgIGlmICghbCkgcmV0dXJuIG51bGwKICAgICAgICAgIHZhciB3ID0gclswXQogICAgICAgICAgciA9CiAgICAgICAgICAgIDEgPT0gYihuKQogICAgICAgICAgICAgID8gbmV3IFNrLmFzdG5vZGVzLmNvbXByZWhlbnNpb24odywgbCwgbnVsbCwgaCkKICAgICAgICAgICAgICA6IG5ldyBTay5hc3Rub2Rlcy5jb21wcmVoZW5zaW9uKAogICAgICAgICAgICAgICAgICBuZXcgU2suYXN0bm9kZXMuVHVwbGUoCiAgICAgICAgICAgICAgICAgICAgciwKICAgICAgICAgICAgICAgICAgICBTay5hc3Rub2Rlcy5TdG9yZSwKICAgICAgICAgICAgICAgICAgICB3LmxpbmVubywKICAgICAgICAgICAgICAgICAgICB3LmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgbi5lbmRfbGluZW5vLAogICAgICAgICAgICAgICAgICAgIG4uZW5kX2NvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgIGwsCiAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgIGgsCiAgICAgICAgICAgICAgICApCiAgICAgICAgICBpZiAoYihlKSA9PSA1ICsgaCkgewogICAgICAgICAgICB3ID0gW10KICAgICAgICAgICAgZSA9IGMoZSwgNCArIGgpCiAgICAgICAgICAgIGE6IGZvciAobCA9IGUsIGggPSAwOyA7ICkgewogICAgICAgICAgICAgIGQobCwgdC5jb21wX2l0ZXIpCiAgICAgICAgICAgICAgaWYgKGMobCwgMCkudHlwZSA9PSB0LmNvbXBfZm9yKSB7CiAgICAgICAgICAgICAgICBuID0gaAogICAgICAgICAgICAgICAgYnJlYWsgYQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBsID0gYyhsLCAwKQogICAgICAgICAgICAgIGQobCwgdC5jb21wX2lmKQogICAgICAgICAgICAgIGgrKwogICAgICAgICAgICAgIGlmICgyID09IGIobCkpIHsKICAgICAgICAgICAgICAgIG4gPSBoCiAgICAgICAgICAgICAgICBicmVhayBhCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGwgPSBjKGwsIDIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKC0xID09IG4pIHJldHVybiBudWxsCiAgICAgICAgICAgIGZvciAoaCA9IDA7IGggPCBuOyBoKyspIHsKICAgICAgICAgICAgICBkKGUsIHQuY29tcF9pdGVyKQogICAgICAgICAgICAgIGUgPSBjKGUsIDApCiAgICAgICAgICAgICAgZChlLCB0LmNvbXBfaWYpCiAgICAgICAgICAgICAgbCA9IHUoYSwgYyhlLCAxKSkKICAgICAgICAgICAgICBpZiAoIWwpIHJldHVybiBudWxsCiAgICAgICAgICAgICAgd1toXSA9IGwKICAgICAgICAgICAgICAzID09IGIoZSkgJiYgKGUgPSBjKGUsIDIpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGUudHlwZSA9PSB0LmNvbXBfaXRlciAmJiAoZSA9IGMoZSwgMCkpCiAgICAgICAgICAgIHIuaWZzID0gdwogICAgICAgICAgfQogICAgICAgICAga1tnXSA9IHIKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGsKICAgICAgfQogICAgICBmdW5jdGlvbiBaKGEsIGQsIGspIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgxIDwgYihkKSkKICAgICAgICB2YXIgZyA9IGMoZCwgMCkKICAgICAgICB2YXIgZiA9IHUoYSwgZykKICAgICAgICBpZiAoZi5jb25zdHJ1Y3RvciA9PT0gU2suYXN0bm9kZXMuU3RhcnJlZCkKICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIGUoYSwgZywgIml0ZXJhYmxlIHVucGFja2luZyBjYW5ub3QgYmUgdXNlZCBpbiBjb21wcmVoZW5zaW9uIiksIG51bGwKICAgICAgICAgICkKICAgICAgICBhID0gYWEoYSwgYyhkLCAxKSkKICAgICAgICByZXR1cm4gMCA9PSBrCiAgICAgICAgICA/IG5ldyBTay5hc3Rub2Rlcy5HZW5lcmF0b3JFeHAoCiAgICAgICAgICAgICAgZiwKICAgICAgICAgICAgICBhLAogICAgICAgICAgICAgIGQubGluZW5vLAogICAgICAgICAgICAgIGQuY29sX29mZnNldCwKICAgICAgICAgICAgICBkLmVuZF9saW5lbm8sCiAgICAgICAgICAgICAgZC5lbmRfY29sX29mZnNldCwKICAgICAgICAgICAgKQogICAgICAgICAgOiAxID09IGsKICAgICAgICAgID8gbmV3IFNrLmFzdG5vZGVzLkxpc3RDb21wKAogICAgICAgICAgICAgIGYsCiAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICBkLmxpbmVubywKICAgICAgICAgICAgICBkLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgZC5lbmRfbGluZW5vLAogICAgICAgICAgICAgIGQuZW5kX2NvbF9vZmZzZXQsCiAgICAgICAgICAgICkKICAgICAgICAgIDogMiA9PSBrCiAgICAgICAgICA/IG5ldyBTay5hc3Rub2Rlcy5TZXRDb21wKAogICAgICAgICAgICAgIGYsCiAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICBkLmxpbmVubywKICAgICAgICAgICAgICBkLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgZC5lbmRfbGluZW5vLAogICAgICAgICAgICAgIGQuZW5kX2NvbF9vZmZzZXQsCiAgICAgICAgICAgICkKICAgICAgICAgIDogbnVsbAogICAgICB9CiAgICAgIGZ1bmN0aW9uIGJhKGEsIGIpIHsKICAgICAgICBkKGIsIHQuYXVnYXNzaWduKQogICAgICAgIGIgPSBjKGIsIDApCiAgICAgICAgc3dpdGNoIChiLnZhbHVlLmNoYXJBdCgwKSkgewogICAgICAgICAgY2FzZSAiKyI6CiAgICAgICAgICAgIHJldHVybiBTay5hc3Rub2Rlcy5BZGQKICAgICAgICAgIGNhc2UgIi0iOgogICAgICAgICAgICByZXR1cm4gU2suYXN0bm9kZXMuU3ViCiAgICAgICAgICBjYXNlICIvIjoKICAgICAgICAgICAgcmV0dXJuICIvIiA9PT0gYi52YWx1ZS5jaGFyQXQoMSkKICAgICAgICAgICAgICA/IFNrLmFzdG5vZGVzLkZsb29yRGl2CiAgICAgICAgICAgICAgOiBTay5hc3Rub2Rlcy5EaXYKICAgICAgICAgIGNhc2UgIiUiOgogICAgICAgICAgICByZXR1cm4gU2suYXN0bm9kZXMuTW9kCiAgICAgICAgICBjYXNlICI8IjoKICAgICAgICAgICAgcmV0dXJuIFNrLmFzdG5vZGVzLkxTaGlmdAogICAgICAgICAgY2FzZSAiPiI6CiAgICAgICAgICAgIHJldHVybiBTay5hc3Rub2Rlcy5SU2hpZnQKICAgICAgICAgIGNhc2UgIiYiOgogICAgICAgICAgICByZXR1cm4gU2suYXN0bm9kZXMuQml0QW5kCiAgICAgICAgICBjYXNlICJeIjoKICAgICAgICAgICAgcmV0dXJuIFNrLmFzdG5vZGVzLkJpdFhvcgogICAgICAgICAgY2FzZSAifCI6CiAgICAgICAgICAgIHJldHVybiBTay5hc3Rub2Rlcy5CaXRPcgogICAgICAgICAgY2FzZSAiKiI6CiAgICAgICAgICAgIHJldHVybiAiKiIgPT09IGIudmFsdWUuY2hhckF0KDEpCiAgICAgICAgICAgICAgPyBTay5hc3Rub2Rlcy5Qb3cKICAgICAgICAgICAgICA6IFNrLmFzdG5vZGVzLk11bHQKICAgICAgICAgIGNhc2UgIkAiOgogICAgICAgICAgICBpZiAoU2suX19mdXR1cmVfXy5weXRob24zKSByZXR1cm4gU2suYXN0bm9kZXMuTWF0TXVsdAogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJpbnZhbGlkIGF1Z2Fzc2lnbiIpCiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIEkoYSwgZCkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KDAgPCBiKGQpKQogICAgICAgIGQudHlwZSA9PT0gdC50ZXN0bGlzdF9jb21wCiAgICAgICAgICA/IDEgPCBiKGQpICYmIFNrLmFzc2VydHMuYXNzZXJ0KGMoZCwgMSkudHlwZSAhPT0gdC5jb21wX2ZvcikKICAgICAgICAgIDogU2suYXNzZXJ0cy5hc3NlcnQoCiAgICAgICAgICAgICAgZC50eXBlID09PSB0LnRlc3RsaXN0IHx8IGQudHlwZSA9PT0gdC50ZXN0bGlzdF9zdGFyX2V4cHIsCiAgICAgICAgICAgICkKICAgICAgICByZXR1cm4gMSA9PT0gYihkKQogICAgICAgICAgPyB1KGEsIGMoZCwgMCkpCiAgICAgICAgICA6IG5ldyBTay5hc3Rub2Rlcy5UdXBsZSgKICAgICAgICAgICAgICBEKGEsIGQpLAogICAgICAgICAgICAgIFNrLmFzdG5vZGVzLkxvYWQsCiAgICAgICAgICAgICAgZC5saW5lbm8sCiAgICAgICAgICAgICAgZC5jb2xfb2Zmc2V0LAogICAgICAgICAgICApCiAgICAgIH0KICAgICAgZnVuY3Rpb24gRShhLCBlKSB7CiAgICAgICAgZChlLCB0LmV4cHJfc3RtdCkKICAgICAgICBpZiAoMSA9PT0gYihlKSkKICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuRXhwcihJKGEsIGMoZSwgMCkpLCBlLmxpbmVubywgZS5jb2xfb2Zmc2V0KQogICAgICAgIGlmIChjKGUsIDEpLnR5cGUgPT09IHQuYXVnYXNzaWduKSB7CiAgICAgICAgICB2YXIgZyA9IGMoZSwgMCkKICAgICAgICAgIHZhciBmID0gSShhLCBnKQogICAgICAgICAgayhhLCBmLCBTay5hc3Rub2Rlcy5TdG9yZSwgZykKICAgICAgICAgIHN3aXRjaCAoZi5jb25zdHJ1Y3RvcikgewogICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLk5hbWU6CiAgICAgICAgICAgICAgdmFyIGwgPSBmLmlkCiAgICAgICAgICAgICAgaChhLCBnLCBsLCBlLmxpbmVubykKICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkF0dHJpYnV0ZToKICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5TdWJzY3JpcHQ6CiAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5HZW5lcmF0b3JFeHA6CiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgICAiYXVnbWVudGVkIGFzc2lnbm1lbnQgdG8gZ2VuZXJhdG9yIGV4cHJlc3Npb24gbm90IHBvc3NpYmxlIiwKICAgICAgICAgICAgICAgIGEuY19maWxlbmFtZSwKICAgICAgICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5ZaWVsZDoKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgICAgICJhdWdtZW50ZWQgYXNzaWdubWVudCB0byB5aWVsZCBleHByZXNzaW9uIG5vdCBwb3NzaWJsZSIsCiAgICAgICAgICAgICAgICBhLmNfZmlsZW5hbWUsCiAgICAgICAgICAgICAgICBlLmxpbmVubywKICAgICAgICAgICAgICApCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgICAiaWxsZWdhbCBleHByZXNzaW9uIGZvciBhdWdtZW50ZWQgYXNzaWdubWVudCIsCiAgICAgICAgICAgICAgICBhLmNfZmlsZW5hbWUsCiAgICAgICAgICAgICAgICBlLmxpbmVubywKICAgICAgICAgICAgICApCiAgICAgICAgICB9CiAgICAgICAgICBnID0gYyhlLCAyKQogICAgICAgICAgbCA9IGcudHlwZSA9PT0gdC50ZXN0bGlzdCA/IEkoYSwgZykgOiB1KGEsIGcpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLkF1Z0Fzc2lnbigKICAgICAgICAgICAgZiwKICAgICAgICAgICAgYmEoYSwgYyhlLCAxKSksCiAgICAgICAgICAgIGwsCiAgICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgICBlLmNvbF9vZmZzZXQsCiAgICAgICAgICApCiAgICAgICAgfQogICAgICAgIGlmIChjKGUsIDEpLnR5cGUgPT09IHQuYW5uYXNzaWduKSB7CiAgICAgICAgICBpZiAoIVNrLl9fZnV0dXJlX18ucHl0aG9uMykKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgIkFubm90YXRlZCBhc3NpZ25tZW50IGlzIG5vdCBzdXBwb3J0ZWQgaW4gUHl0aG9uIDIiLAogICAgICAgICAgICAgIGEuY19maWxlbmFtZSwKICAgICAgICAgICAgICBlLmxpbmVubywKICAgICAgICAgICAgKQogICAgICAgICAgZyA9IGMoZSwgMCkKICAgICAgICAgIHZhciBuID0gYyhlLCAxKQogICAgICAgICAgdmFyIHIgPSAxCiAgICAgICAgICBmb3IgKGYgPSBnOyAxID09IGIoZik7ICkgZiA9IGMoZiwgMCkKICAgICAgICAgIDAgPCBiKGYpICYmIGMoZiwgMCkudHlwZSA9PSB2LlRfTFBBUiAmJiAociA9IDApCiAgICAgICAgICBmID0gSShhLCBnKQogICAgICAgICAgc3dpdGNoIChmLmNvbnN0cnVjdG9yKSB7CiAgICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTmFtZToKICAgICAgICAgICAgICBsID0gZi5pZAogICAgICAgICAgICAgIGgoYSwgZywgbCwgZS5saW5lbm8pCiAgICAgICAgICAgICAgayhhLCBmLCBTay5hc3Rub2Rlcy5TdG9yZSwgZykKICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkF0dHJpYnV0ZToKICAgICAgICAgICAgICBsID0gZi5hdHRyCiAgICAgICAgICAgICAgaChhLCBnLCBsLCBlLmxpbmVubykKICAgICAgICAgICAgICBrKGEsIGYsIFNrLmFzdG5vZGVzLlN0b3JlLCBnKQogICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuU3Vic2NyaXB0OgogICAgICAgICAgICAgIGsoYSwgZiwgU2suYXN0bm9kZXMuU3RvcmUsIGcpCiAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5MaXN0OgogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICAgIm9ubHkgc2luZ2xlIHRhcmdldCAobm90IGxpc3QpIGNhbiBiZSBhbm5vdGF0ZWQiLAogICAgICAgICAgICAgICAgYS5jX2ZpbGVuYW1lLAogICAgICAgICAgICAgICAgZS5saW5lbm8sCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlR1cGxlOgogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICAgIm9ubHkgc2luZ2xlIHRhcmdldCAobm90IHR1cGxlKSBjYW4gYmUgYW5ub3RhdGVkIiwKICAgICAgICAgICAgICAgIGEuY19maWxlbmFtZSwKICAgICAgICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgICAgICJpbGxlZ2FsIHRhcmdldCBmb3IgYW5ub3RhdGlvbiIsCiAgICAgICAgICAgICAgICBhLmNfZmlsZW5hbWUsCiAgICAgICAgICAgICAgICBlLmxpbmVubywKICAgICAgICAgICAgICApCiAgICAgICAgICB9CiAgICAgICAgICBmLmNvbnN0cnVjdG9yICE9IFNrLmFzdG5vZGVzLk5hbWUgJiYgKHIgPSAwKQogICAgICAgICAgZyA9IGMobiwgMSkKICAgICAgICAgIGwgPSB1KGEsIGcpCiAgICAgICAgICBpZiAoMiA9PSBiKG4pKQogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLkFubkFzc2lnbigKICAgICAgICAgICAgICBmLAogICAgICAgICAgICAgIGwsCiAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICByLAogICAgICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgICAgIGUuY29sX29mZnNldCwKICAgICAgICAgICAgKQogICAgICAgICAgZyA9IGMobiwgMykKICAgICAgICAgIGEgPSB1KGEsIGcpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLkFubkFzc2lnbihmLCBsLCBhLCByLCBlLmxpbmVubywgZS5jb2xfb2Zmc2V0KQogICAgICAgIH0KICAgICAgICBkKGMoZSwgMSksIHYuVF9FUVVBTCkKICAgICAgICByID0gW10KICAgICAgICBmb3IgKGYgPSAwOyBmIDwgYihlKSAtIDI7IGYgKz0gMikgewogICAgICAgICAgZyA9IGMoZSwgZikKICAgICAgICAgIGlmIChnLnR5cGUgPT09IHQueWllbGRfZXhwcikKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgImFzc2lnbm1lbnQgdG8geWllbGQgZXhwcmVzc2lvbiBub3QgcG9zc2libGUiLAogICAgICAgICAgICAgIGEuY19maWxlbmFtZSwKICAgICAgICAgICAgICBlLmxpbmVubywKICAgICAgICAgICAgKQogICAgICAgICAgZyA9IEkoYSwgZykKICAgICAgICAgIGsoYSwgZywgU2suYXN0bm9kZXMuU3RvcmUsIGMoZSwgZikpCiAgICAgICAgICByW2YgLyAyXSA9IGcKICAgICAgICB9CiAgICAgICAgZyA9IGMoZSwgYihlKSAtIDEpCiAgICAgICAgYSA9IGcudHlwZSA9PT0gdC50ZXN0bGlzdF9zdGFyX2V4cHIgPyBJKGEsIGcpIDogdShhLCBnKQogICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuQXNzaWduKHIsIGEsIGUubGluZW5vLCBlLmNvbF9vZmZzZXQpCiAgICAgIH0KICAgICAgZnVuY3Rpb24gTihhLCBiKSB7CiAgICAgICAgdmFyIGMgPSBiLmNoYXJBdCgwKSwKICAgICAgICAgIGQgPSAhMSwKICAgICAgICAgIGUgPSAhMQogICAgICAgIGlmICgKICAgICAgICAgIGEuY19mbGFncyAmIFNrLlBhcnNlci5DT19GVVRVUkVfVU5JQ09ERV9MSVRFUkFMUyB8fAogICAgICAgICAgITAgPT09IFNrLl9fZnV0dXJlX18udW5pY29kZV9saXRlcmFscwogICAgICAgICkKICAgICAgICAgIGUgPSAhMAogICAgICAgIGlmICgidSIgPT09IGMgfHwgIlUiID09PSBjKQogICAgICAgICAgKGIgPSBiLnN1YnN0cigxKSksIChjID0gYi5jaGFyQXQoMCkpLCAoZSA9ICEwKQogICAgICAgIGVsc2UgaWYgKCJyIiA9PT0gYyB8fCAiUiIgPT09IGMpCiAgICAgICAgICAoYiA9IGIuc3Vic3RyKDEpKSwgKGMgPSBiLmNoYXJBdCgwKSksIChkID0gITApCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoCiAgICAgICAgICAiYiIgIT09IGMgJiYgIkIiICE9PSBjLAogICAgICAgICAgInRvZG87IGhhdmVuJ3QgZG9uZSBiJycgc3RyaW5ncyB5ZXQiLAogICAgICAgICkKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgKICAgICAgICAgICInIiA9PT0gYyB8fCAoJyInID09PSBjICYmIGIuY2hhckF0KGIubGVuZ3RoIC0gMSkgPT09IGMpLAogICAgICAgICkKICAgICAgICBiID0gYi5zdWJzdHIoMSwgYi5sZW5ndGggLSAyKQogICAgICAgIGUgJiYgKGIgPSB1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoYikpKQogICAgICAgIDQgPD0gYi5sZW5ndGggJiYKICAgICAgICAgIGIuY2hhckF0KDApID09PSBjICYmCiAgICAgICAgICBiLmNoYXJBdCgxKSA9PT0gYyAmJgogICAgICAgICAgKFNrLmFzc2VydHMuYXNzZXJ0KAogICAgICAgICAgICBiLmNoYXJBdChiLmxlbmd0aCAtIDEpID09PSBjICYmIGIuY2hhckF0KGIubGVuZ3RoIC0gMikgPT09IGMsCiAgICAgICAgICApLAogICAgICAgICAgKGIgPSBiLnN1YnN0cigyLCBiLmxlbmd0aCAtIDQpKSkKICAgICAgICBpZiAoZCB8fCAtMSA9PT0gYi5pbmRleE9mKCJcXCIpKSBhID0gZihkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKGIpKSkKICAgICAgICBlbHNlIHsKICAgICAgICAgIGEgPSBiCiAgICAgICAgICBjID0gYS5sZW5ndGgKICAgICAgICAgIGQgPSAiIgogICAgICAgICAgZm9yIChiID0gMDsgYiA8IGM7ICsrYikKICAgICAgICAgICAgaWYgKCgoZSA9IGEuY2hhckF0KGIpKSwgIlxcIiA9PT0gZSkpCiAgICAgICAgICAgICAgaWYgKCgrK2IsIChlID0gYS5jaGFyQXQoYikpLCAibiIgPT09IGUpKSBkICs9ICJcbiIKICAgICAgICAgICAgICBlbHNlIGlmICgiXFwiID09PSBlKSBkICs9ICJcXCIKICAgICAgICAgICAgICBlbHNlIGlmICgidCIgPT09IGUpIGQgKz0gIlx0IgogICAgICAgICAgICAgIGVsc2UgaWYgKCJyIiA9PT0gZSkgZCArPSAiXHIiCiAgICAgICAgICAgICAgZWxzZSBpZiAoImIiID09PSBlKSBkICs9ICJcYiIKICAgICAgICAgICAgICBlbHNlIGlmICgiZiIgPT09IGUpIGQgKz0gIlxmIgogICAgICAgICAgICAgIGVsc2UgaWYgKCJ2IiA9PT0gZSkgZCArPSAiXHYiCiAgICAgICAgICAgICAgZWxzZSBpZiAoIjAiID09PSBlKSBkICs9ICJceDAwIgogICAgICAgICAgICAgIGVsc2UgaWYgKCciJyA9PT0gZSkgZCArPSAnIicKICAgICAgICAgICAgICBlbHNlIGlmICgiJyIgPT09IGUpIGQgKz0gIiciCiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoIlxuIiAhPT0gZSkKICAgICAgICAgICAgICAgICAgaWYgKCJ4IiA9PT0gZSkgewogICAgICAgICAgICAgICAgICAgIHZhciBrID0gYS5jaGFyQXQoKytiKQogICAgICAgICAgICAgICAgICAgIHZhciBnID0gYS5jaGFyQXQoKytiKQogICAgICAgICAgICAgICAgICAgIGQgKz0gdW5lc2NhcGUoCiAgICAgICAgICAgICAgICAgICAgICBlbmNvZGVVUklDb21wb25lbnQoCiAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZy5mcm9tQ2hhckNvZGUocGFyc2VJbnQoayArIGcsIDE2KSksCiAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgidSIgPT09IGUgfHwgIlUiID09PSBlKSB7CiAgICAgICAgICAgICAgICAgICAgayA9IGEuY2hhckF0KCsrYikKICAgICAgICAgICAgICAgICAgICBnID0gYS5jaGFyQXQoKytiKQogICAgICAgICAgICAgICAgICAgIHZhciBsID0gYS5jaGFyQXQoKytiKQogICAgICAgICAgICAgICAgICAgIGUgPSBhLmNoYXJBdCgrK2IpCiAgICAgICAgICAgICAgICAgICAgZCArPSB1bmVzY2FwZSgKICAgICAgICAgICAgICAgICAgICAgIGVuY29kZVVSSUNvbXBvbmVudCgKICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nLmZyb21DaGFyQ29kZSgKICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUludChrICsgZywgMTYpLAogICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KGwgKyBlLCAxNiksCiAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgfSBlbHNlIGQgKz0gIlxcIiArIGUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgZCArPSBlCiAgICAgICAgICBhID0gZGVjb2RlVVJJQ29tcG9uZW50KGVzY2FwZShkKSkKICAgICAgICAgIGEgPSBmKGEpCiAgICAgICAgfQogICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgICAgZnVuY3Rpb24gVShhLCBiLCBjKSB7CiAgICAgICAgYSA9IGIuY2hhckF0KGIubGVuZ3RoIC0gMSkKICAgICAgICBpZiAoImoiID09PSBhIHx8ICJKIiA9PT0gYSkKICAgICAgICAgIHJldHVybiBTay5idWlsdGluLmNvbXBsZXguY29tcGxleF9zdWJ0eXBlX2Zyb21fc3RyaW5nKGIpCiAgICAgICAgaWYgKCJsIiA9PT0gYSB8fCAiTCIgPT09IGEpCiAgICAgICAgICByZXR1cm4gU2subG9uZ0Zyb21TdHIoYi5zdWJzdHIoMCwgYi5sZW5ndGggLSAxKSwgMCkKICAgICAgICBpZiAoLTEgIT09IGIuaW5kZXhPZigiLiIpKSByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKHBhcnNlRmxvYXQoYikpCiAgICAgICAgYyA9IGIKICAgICAgICBhID0gITEKICAgICAgICAiLSIgPT09IGIuY2hhckF0KDApICYmICgoYyA9IGIuc3Vic3RyKDEpKSwgKGEgPSAhMCkpCiAgICAgICAgaWYgKAogICAgICAgICAgIjAiICE9PSBjLmNoYXJBdCgwKSB8fAogICAgICAgICAgKCJ4IiAhPT0gYy5jaGFyQXQoMSkgJiYgIlgiICE9PSBjLmNoYXJBdCgxKSkKICAgICAgICApIHsKICAgICAgICAgIGlmICgtMSAhPT0gYi5pbmRleE9mKCJlIikgfHwgLTEgIT09IGIuaW5kZXhPZigiRSIpKQogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uZmxvYXRfKHBhcnNlRmxvYXQoYikpCiAgICAgICAgICBpZiAoCiAgICAgICAgICAgICIwIiAhPT0gYy5jaGFyQXQoMCkgfHwKICAgICAgICAgICAgKCJiIiAhPT0gYy5jaGFyQXQoMSkgJiYgIkIiICE9PSBjLmNoYXJBdCgxKSkKICAgICAgICAgICkKICAgICAgICAgICAgaWYgKCIwIiA9PT0gYy5jaGFyQXQoMCkpCiAgICAgICAgICAgICAgaWYgKCIwIiA9PT0gYykgYyA9IDAKICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGMgPSBjLnN1YnN0cmluZygxKQogICAgICAgICAgICAgICAgaWYgKCJvIiA9PT0gYy5jaGFyQXQoMCkgfHwgIk8iID09PSBjLmNoYXJBdCgwKSkKICAgICAgICAgICAgICAgICAgYyA9IGMuc3Vic3RyaW5nKDEpCiAgICAgICAgICAgICAgICBjID0gcGFyc2VJbnQoYywgOCkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgYyA9IHBhcnNlSW50KGMsIDEwKQogICAgICAgICAgZWxzZSAoYyA9IGMuc3Vic3RyaW5nKDIpKSwgKGMgPSBwYXJzZUludChjLCAyKSkKICAgICAgICB9IGVsc2UgKGMgPSBjLnN1YnN0cmluZygyKSksIChjID0gcGFyc2VJbnQoYywgMTYpKQogICAgICAgIHJldHVybiBjID4gU2suYnVpbHRpbi5pbnRfLnRocmVzaG9sZCQgJiYKICAgICAgICAgIE1hdGguZmxvb3IoYykgPT09IGMgJiYKICAgICAgICAgIC0xID09PSBiLmluZGV4T2YoImUiKSAmJgogICAgICAgICAgLTEgPT09IGIuaW5kZXhPZigiRSIpCiAgICAgICAgICA/IFNrLmxvbmdGcm9tU3RyKGIsIDApCiAgICAgICAgICA6IGEKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uaW50XygtYykKICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uaW50XyhjKQogICAgICB9CiAgICAgIGZ1bmN0aW9uIEYoYSwgZSkgewogICAgICAgIHZhciBrLCBnCiAgICAgICAgZChlLCB0LnN1YnNjcmlwdCkKICAgICAgICB2YXIgZiA9IGMoZSwgMCkKICAgICAgICB2YXIgbCA9IChrID0gZyA9IG51bGwpCiAgICAgICAgaWYgKGYudHlwZSA9PT0gdi5UX0RPVCkgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5FbGxpcHNpcygpCiAgICAgICAgaWYgKDEgPT09IGIoZSkgJiYgZi50eXBlID09PSB0LnRlc3QpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLkluZGV4KHUoYSwgZikpCiAgICAgICAgZi50eXBlID09PSB0LnRlc3QgJiYgKGcgPSB1KGEsIGYpKQogICAgICAgIGYudHlwZSA9PT0gdi5UX0NPTE9OCiAgICAgICAgICA/IDEgPCBiKGUpICYmICgoZiA9IGMoZSwgMSkpLCBmLnR5cGUgPT09IHQudGVzdCAmJiAoayA9IHUoYSwgZikpKQogICAgICAgICAgOiAyIDwgYihlKSAmJiAoKGYgPSBjKGUsIDIpKSwgZi50eXBlID09PSB0LnRlc3QgJiYgKGsgPSB1KGEsIGYpKSkKICAgICAgICBmID0gYyhlLCBiKGUpIC0gMSkKICAgICAgICBmLnR5cGUgPT09IHQuc2xpY2VvcCAmJgogICAgICAgICAgKDEgPT09IGIoZikKICAgICAgICAgICAgPyAoKGYgPSBjKGYsIDApKSwKICAgICAgICAgICAgICAobCA9IG5ldyBTay5hc3Rub2Rlcy5OYW1lQ29uc3RhbnQoCiAgICAgICAgICAgICAgICBTay5idWlsdGluLm5vbmUubm9uZSQsCiAgICAgICAgICAgICAgICBTay5hc3Rub2Rlcy5Mb2FkLAogICAgICAgICAgICAgICAgZi5saW5lbm8sCiAgICAgICAgICAgICAgICBmLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgKSkpCiAgICAgICAgICAgIDogKChmID0gYyhmLCAxKSksIGYudHlwZSA9PT0gdC50ZXN0ICYmIChsID0gdShhLCBmKSkpKQogICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuU2xpY2UoZywgaywgbCkKICAgICAgfQogICAgICBmdW5jdGlvbiBRKGEsIGspIHsKICAgICAgICB2YXIgZyA9IGMoaywgMCkKICAgICAgICBzd2l0Y2ggKGcudHlwZSkgewogICAgICAgICAgY2FzZSB2LlRfTkFNRToKICAgICAgICAgICAgZyA9IGcudmFsdWUKICAgICAgICAgICAgaWYgKDQgPD0gZy5sZW5ndGggJiYgNSA+PSBnLmxlbmd0aCkgewogICAgICAgICAgICAgIGlmICgiTm9uZSIgPT09IGcpCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLk5hbWVDb25zdGFudCgKICAgICAgICAgICAgICAgICAgU2suYnVpbHRpbi5ub25lLm5vbmUkLAogICAgICAgICAgICAgICAgICBrLmxpbmVubywKICAgICAgICAgICAgICAgICAgay5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIGlmICgiVHJ1ZSIgPT09IGcpCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLk5hbWVDb25zdGFudCgKICAgICAgICAgICAgICAgICAgU2suYnVpbHRpbi5ib29sLnRydWUkLAogICAgICAgICAgICAgICAgICBrLmxpbmVubywKICAgICAgICAgICAgICAgICAgay5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIGlmICgiRmFsc2UiID09PSBnKQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5OYW1lQ29uc3RhbnQoCiAgICAgICAgICAgICAgICAgIFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQsCiAgICAgICAgICAgICAgICAgIGsubGluZW5vLAogICAgICAgICAgICAgICAgICBrLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYSA9IHIoZywgYSkKICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5OYW1lKAogICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgU2suYXN0bm9kZXMuTG9hZCwKICAgICAgICAgICAgICBrLmxpbmVubywKICAgICAgICAgICAgICBrLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgay5lbmRfbGluZW5vLAogICAgICAgICAgICAgIGsuZW5kX2NvbF9vZmZzZXQsCiAgICAgICAgICAgICkKICAgICAgICAgIGNhc2Ugdi5UX1NUUklORzoKICAgICAgICAgICAgZChjKGssIDApLCB2LlRfU1RSSU5HKQogICAgICAgICAgICB2YXIgZiA9IG5ldyBTay5idWlsdGluLnN0cigiIikKICAgICAgICAgICAgZm9yIChnID0gMDsgZyA8IGIoayk7ICsrZykKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZiA9IGYuc3EkY29uY2F0KE4oYSwgYyhrLCBnKS52YWx1ZSkpCiAgICAgICAgICAgICAgfSBjYXRjaCAoY2EpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICAgICAiaW52YWxpZCBzdHJpbmcgKHBvc3NpYmx5IGNvbnRhaW5zIGEgdW5pY29kZSBjaGFyYWN0ZXIpIiwKICAgICAgICAgICAgICAgICAgYS5jX2ZpbGVuYW1lLAogICAgICAgICAgICAgICAgICBjKGssIGcpLmxpbmVubywKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuU3RyKAogICAgICAgICAgICAgIGYsCiAgICAgICAgICAgICAgay5saW5lbm8sCiAgICAgICAgICAgICAgay5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgIGEuZW5kX2xpbmVubywKICAgICAgICAgICAgICBrLmVuZF9jb2xfb2Zmc2V0LAogICAgICAgICAgICApCiAgICAgICAgICBjYXNlIHYuVF9OVU1CRVI6CiAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuTnVtKAogICAgICAgICAgICAgIFUoYSwgZy52YWx1ZSwgay5saW5lbm8pLAogICAgICAgICAgICAgIGsubGluZW5vLAogICAgICAgICAgICAgIGsuY29sX29mZnNldCwKICAgICAgICAgICAgKQogICAgICAgICAgY2FzZSB2LlRfRUxMSVBTSVM6CiAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuRWxsaXBzaXMoCiAgICAgICAgICAgICAgay5saW5lbm8sCiAgICAgICAgICAgICAgay5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgIGsuZW5kX2xpbmVubywKICAgICAgICAgICAgICBrLmVuZF9jb2xfb2Zmc2V0LAogICAgICAgICAgICApCiAgICAgICAgICBjYXNlIHYuVF9MUEFSOgogICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgIChnID0gYyhrLCAxKSksCiAgICAgICAgICAgICAgZy50eXBlID09IHYuVF9SUEFSCiAgICAgICAgICAgICAgICA/IG5ldyBTay5hc3Rub2Rlcy5UdXBsZSgKICAgICAgICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICAgICAgICBTay5hc3Rub2Rlcy5Mb2FkLAogICAgICAgICAgICAgICAgICAgIGsubGluZW5vLAogICAgICAgICAgICAgICAgICAgIGsuY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgICBrLmVuZF9saW5lbm8sCiAgICAgICAgICAgICAgICAgICAgay5lbmRfY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgOiBnLnR5cGUgPT0gdC55aWVsZF9leHByCiAgICAgICAgICAgICAgICA/IHUoYSwgZykKICAgICAgICAgICAgICAgIDogMSA9PSBiKGcpCiAgICAgICAgICAgICAgICA/IEkoYSwgZykKICAgICAgICAgICAgICAgIDogYyhnLCAxKS50eXBlID09IHQuY29tcF9mb3IKICAgICAgICAgICAgICAgID8gcShBKGEsIGcpLCBrKQogICAgICAgICAgICAgICAgOiBxKEkoYSwgZyksIGspCiAgICAgICAgICAgICkKICAgICAgICAgIGNhc2Ugdi5UX0xTUUI6CiAgICAgICAgICAgIGcgPSBjKGssIDEpCiAgICAgICAgICAgIGlmIChnLnR5cGUgPT0gdi5UX1JTUUIpCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5MaXN0KAogICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICBTay5hc3Rub2Rlcy5Mb2FkLAogICAgICAgICAgICAgICAgay5saW5lbm8sCiAgICAgICAgICAgICAgICBrLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICBrLmVuZF9saW5lbm8sCiAgICAgICAgICAgICAgICBrLmVuZF9jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICkKICAgICAgICAgICAgZChnLCB0LnRlc3RsaXN0X2NvbXApCiAgICAgICAgICAgIGlmICgxID09IGIoZykgfHwgYyhnLCAxKS50eXBlID09IHYuVF9DT01NQSkKICAgICAgICAgICAgICByZXR1cm4gKGEgPSBEKGEsIGcpKQogICAgICAgICAgICAgICAgPyBuZXcgU2suYXN0bm9kZXMuTGlzdCgKICAgICAgICAgICAgICAgICAgICBhLAogICAgICAgICAgICAgICAgICAgIFNrLmFzdG5vZGVzLkxvYWQsCiAgICAgICAgICAgICAgICAgICAgay5saW5lbm8sCiAgICAgICAgICAgICAgICAgICAgay5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgICAgIGsuZW5kX2xpbmVubywKICAgICAgICAgICAgICAgICAgICBrLmVuZF9jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICA6IG51bGwKICAgICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoZy50eXBlID09IHQudGVzdGxpc3RfY29tcCkKICAgICAgICAgICAgYSA9IFooYSwgZywgMSkKICAgICAgICAgICAgcmV0dXJuIHEoYSwgaykKICAgICAgICAgIGNhc2Ugdi5UX0xCUkFDRToKICAgICAgICAgICAgZyA9IGMoaywgMSkKICAgICAgICAgICAgaWYgKGcudHlwZSA9PSB2LlRfUkJSQUNFKQogICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuRGljdCgKICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgay5saW5lbm8sCiAgICAgICAgICAgICAgICBrLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICBrLmVuZF9saW5lbm8sCiAgICAgICAgICAgICAgICBrLmVuZF9jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICkKICAgICAgICAgICAgZiA9IGMoZywgMCkudHlwZSA9PSB2LlRfRE9VQkxFU1RBUgogICAgICAgICAgICBpZiAoMSA9PSBiKGcpIHx8ICgxIDwgYihnKSAmJiBjKGcsIDEpLnR5cGUgPT0gdi5UX0NPTU1BKSkgewogICAgICAgICAgICAgIHZhciBsID0gW10KICAgICAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydChnLnR5cGUgPT09IHQuZGljdG9yc2V0bWFrZXIpCiAgICAgICAgICAgICAgZm9yIChmID0gMDsgZiA8IGIoZyk7IGYgKz0gMikgewogICAgICAgICAgICAgICAgdmFyIGggPSB1KGEsIGMoZywgZikpCiAgICAgICAgICAgICAgICBsW2YgLyAyXSA9IGgKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYSA9IG5ldyBTay5hc3Rub2Rlcy5TZXQobCwgZy5saW5lbm8sIGcuY29sX29mZnNldCkKICAgICAgICAgICAgfSBlbHNlIGlmICgxIDwgYihnKSAmJiBjKGcsIDEpLnR5cGUgPT0gdC5jb21wX2ZvcikKICAgICAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydChnLnR5cGUgPT09IHQuZGljdG9yc2V0bWFrZXIpLAogICAgICAgICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoMSA8IGIoZykpLAogICAgICAgICAgICAgICAgKGYgPSB1KGEsIGMoZywgMCkpKSwKICAgICAgICAgICAgICAgIChhID0gWShhLCBjKGcsIDEpKSksCiAgICAgICAgICAgICAgICAoYSA9IG5ldyBTay5hc3Rub2Rlcy5TZXRDb21wKGYsIGEsIGcubGluZW5vLCBnLmNvbF9vZmZzZXQpKQogICAgICAgICAgICBlbHNlIGlmIChiKGcpID4gMyAtIGYgJiYgYyhnLCAzIC0gZikudHlwZSA9PSB0LmNvbXBfZm9yKSB7CiAgICAgICAgICAgICAgaWYgKGYpCiAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICBlKAogICAgICAgICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgICAgICAgaywKICAgICAgICAgICAgICAgICAgICAiZGljdCB1bnBhY2tpbmcgY2Fubm90IGJlIHVzZWQgaW4gZGljdCBjb21wcmVoZW5zaW9uIiwKICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgbnVsbAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KDMgPCBiKGcpKQogICAgICAgICAgICAgIGQoYyhnLCAxKSwgdi5UX0NPTE9OKQogICAgICAgICAgICAgIGYgPSB1KGEsIGMoZywgMCkpCiAgICAgICAgICAgICAgbCA9IHUoYSwgYyhnLCAyKSkKICAgICAgICAgICAgICBhID0gWShhLCBjKGcsIDMpKQogICAgICAgICAgICAgIGEgPSBuZXcgU2suYXN0bm9kZXMuRGljdENvbXAoZiwgbCwgYSwgZy5saW5lbm8sIGcuY29sX29mZnNldCkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB2YXIgbgogICAgICAgICAgICAgIGwgPSBbXQogICAgICAgICAgICAgIGggPSBbXQogICAgICAgICAgICAgIGZvciAobiA9IGYgPSAwOyBuIDwgYihnKTsgbisrKSB7CiAgICAgICAgICAgICAgICB2YXIgbSA9IGEKICAgICAgICAgICAgICAgIHZhciB3ID0gZywKICAgICAgICAgICAgICAgICAgcCA9IG4KICAgICAgICAgICAgICAgIGlmIChjKHcsIHApLnR5cGUgPT0gdi5UX0RPVUJMRVNUQVIpCiAgICAgICAgICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KDIgPD0gYih3KSAtIHApLAogICAgICAgICAgICAgICAgICAgIChuID0gdShtLCBjKHcsIHAgKyAxKSkpLAogICAgICAgICAgICAgICAgICAgIChtID0geyBrZXk6IG51bGwsIHZhbHVlOiBuLCBpOiBwICsgMiB9KQogICAgICAgICAgICAgICAgZWxzZSBpZiAoCiAgICAgICAgICAgICAgICAgIChTay5hc3NlcnRzLmFzc2VydCgzIDw9IGIodykgLSBwKSwgKG4gPSB1KG0sIGModywgcCkpKSkKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICB2YXIgeCA9IG4KICAgICAgICAgICAgICAgICAgZChjKHcsIHAgKyAxKSwgdi5UX0NPTE9OKQogICAgICAgICAgICAgICAgICBtID0gKG4gPSB1KG0sIGModywgcCArIDIpKSkKICAgICAgICAgICAgICAgICAgICA/IHsga2V5OiB4LCB2YWx1ZTogbiwgaTogcCArIDMgfQogICAgICAgICAgICAgICAgICAgIDogITEKICAgICAgICAgICAgICAgIH0gZWxzZSBtID0gMAogICAgICAgICAgICAgICAgbiA9IG0uaQogICAgICAgICAgICAgICAgbFtmXSA9IG0ua2V5CiAgICAgICAgICAgICAgICBoW2ZdID0gbS52YWx1ZQogICAgICAgICAgICAgICAgZisrCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGEgPSBuZXcgU2suYXN0bm9kZXMuRGljdCgKICAgICAgICAgICAgICAgIGwsCiAgICAgICAgICAgICAgICBoLAogICAgICAgICAgICAgICAgZy5saW5lbm8sCiAgICAgICAgICAgICAgICBnLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICBnLmVuZF9saW5lbm8sCiAgICAgICAgICAgICAgICBnLmVuZF9jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcShhLCBrKQogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgcmV0dXJuIFNrLmFzc2VydC5mYWlsKCJ1bmhhbmRsZWQgYXRvbSAiICsgZy50eXBlKSwgbnVsbAogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiB5KGEsIGUpIHsKICAgICAgICB2YXIgaywKICAgICAgICAgIGcgPSAwCiAgICAgICAgZChlLCB0LmF0b21fZXhwcikKICAgICAgICB2YXIgZiA9IGIoZSkKICAgICAgICBjKGUsIDApLnR5cGUgPT09IHYuVF9BV0FJVCAmJiAoKGcgPSAxKSwgU2suYXNzZXJ0cy5hc3NlcnQoMSA8IGYpKQogICAgICAgIHZhciBsID0gUShhLCBjKGUsIGcpKQogICAgICAgIGlmICghbCkgcmV0dXJuIG51bGwKICAgICAgICBpZiAoMSA9PT0gZikgcmV0dXJuIGwKICAgICAgICBpZiAoZyAmJiAyID09PSBmKQogICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5Bd2FpdChsLCBlLmxpbmVubywgZS5jb2xfb2Zmc2V0KQogICAgICAgIGZvciAoayA9IGcgKyAxOyBrIDwgZjsgaysrKSB7CiAgICAgICAgICB2YXIgaCA9IGMoZSwgaykKICAgICAgICAgIGlmIChoLnR5cGUgIT09IHQudHJhaWxlcikgYnJlYWsKICAgICAgICAgIGggPSBCKGEsIGgsIGwpCiAgICAgICAgICBpZiAoIWgpIHJldHVybiBudWxsCiAgICAgICAgICBoLmxpbmVubyA9IGwubGluZW5vCiAgICAgICAgICBoLmNvbF9vZmZzZXQgPSBsLmNvbF9vZmZzZXQKICAgICAgICAgIGwgPSBoCiAgICAgICAgfQogICAgICAgIHJldHVybiBnID8gbmV3IFNrLmFzdG5vZGVzLkF3YWl0KGwsIGUubGluZSwgZS5jb2xfb2Zmc2V0KSA6IGwKICAgICAgfQogICAgICBmdW5jdGlvbiB1KGEsIGUpIHsKICAgICAgICBhOiBmb3IgKDs7KSB7CiAgICAgICAgICBzd2l0Y2ggKGUudHlwZSkgewogICAgICAgICAgICBjYXNlIHQudGVzdDoKICAgICAgICAgICAgY2FzZSB0LnRlc3Rfbm9jb25kOgogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGMoZSwgMCkudHlwZSA9PT0gdC5sYW1iZGVmIHx8CiAgICAgICAgICAgICAgICBjKGUsIDApLnR5cGUgPT09IHQubGFtYmRlZl9ub2NvbmQKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIHZhciBrID0gYyhlLCAwKQogICAgICAgICAgICAgICAgMyA9PT0gYihrKQogICAgICAgICAgICAgICAgICA/ICgoZSA9IG5ldyBTay5hc3Rub2Rlcy5hcmd1bWVudHNfKFtdLCBudWxsLCBudWxsLCBbXSkpLAogICAgICAgICAgICAgICAgICAgIChhID0gdShhLCBjKGssIDIpKSkpCiAgICAgICAgICAgICAgICAgIDogKChlID0gUChhLCBjKGssIDEpKSksIChhID0gdShhLCBjKGssIDMpKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLkxhbWJkYShlLCBhLCBrLmxpbmVubywgay5jb2xfb2Zmc2V0KQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoMSA8IGIoZSkpCiAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydCg1ID09PSBiKGUpKSwKICAgICAgICAgICAgICAgICAgbmV3IFNrLmFzdG5vZGVzLklmRXhwKAogICAgICAgICAgICAgICAgICAgIHUoYSwgYyhlLCAyKSksCiAgICAgICAgICAgICAgICAgICAgdShhLCBjKGUsIDApKSwKICAgICAgICAgICAgICAgICAgICB1KGEsIGMoZSwgNCkpLAogICAgICAgICAgICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgICAgICAgICAgIGUuY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICBjYXNlIHQub3JfdGVzdDoKICAgICAgICAgICAgY2FzZSB0LmFuZF90ZXN0OgogICAgICAgICAgICAgIGlmICgxID09PSBiKGUpKSB7CiAgICAgICAgICAgICAgICBlID0gYyhlLCAwKQogICAgICAgICAgICAgICAgY29udGludWUgYQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB2YXIgZyA9IFtdCiAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IGIoZSk7IGsgKz0gMikgZ1trIC8gMl0gPSB1KGEsIGMoZSwgaykpCiAgICAgICAgICAgICAgaWYgKCJhbmQiID09PSBjKGUsIDEpLnZhbHVlKQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTay5hc3Rub2Rlcy5Cb29sT3AoCiAgICAgICAgICAgICAgICAgIFNrLmFzdG5vZGVzLkFuZCwKICAgICAgICAgICAgICAgICAgZywKICAgICAgICAgICAgICAgICAgZS5saW5lbm8sCiAgICAgICAgICAgICAgICAgIGUuY29sX29mZnNldCwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgib3IiID09PSBjKGUsIDEpLnZhbHVlKQogICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuQm9vbE9wKAogICAgICAgICAgICAgICAgU2suYXN0bm9kZXMuT3IsCiAgICAgICAgICAgICAgICBnLAogICAgICAgICAgICAgICAgZS5saW5lbm8sCiAgICAgICAgICAgICAgICBlLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBjYXNlIHQubm90X3Rlc3Q6CiAgICAgICAgICAgICAgaWYgKDEgPT09IGIoZSkpIHsKICAgICAgICAgICAgICAgIGUgPSBjKGUsIDApCiAgICAgICAgICAgICAgICBjb250aW51ZSBhCiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLlVuYXJ5T3AoCiAgICAgICAgICAgICAgICAgIFNrLmFzdG5vZGVzLk5vdCwKICAgICAgICAgICAgICAgICAgdShhLCBjKGUsIDEpKSwKICAgICAgICAgICAgICAgICAgZS5saW5lbm8sCiAgICAgICAgICAgICAgICAgIGUuY29sX29mZnNldCwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgY2FzZSB0LmNvbXBhcmlzb246CiAgICAgICAgICAgICAgaWYgKDEgPT09IGIoZSkpIHsKICAgICAgICAgICAgICAgIGUgPSBjKGUsIDApCiAgICAgICAgICAgICAgICBjb250aW51ZSBhCiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBmID0gW10KICAgICAgICAgICAgICAgIGcgPSBbXQogICAgICAgICAgICAgICAgZm9yIChrID0gMTsgayA8IGIoZSk7IGsgKz0gMikKICAgICAgICAgICAgICAgICAgKGZbKGsgLSAxKSAvIDJdID0gbihhLCBjKGUsIGspKSksCiAgICAgICAgICAgICAgICAgICAgKGdbKGsgLSAxKSAvIDJdID0gdShhLCBjKGUsIGsgKyAxKSkpCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLkNvbXBhcmUoCiAgICAgICAgICAgICAgICAgIHUoYSwgYyhlLCAwKSksCiAgICAgICAgICAgICAgICAgIGYsCiAgICAgICAgICAgICAgICAgIGcsCiAgICAgICAgICAgICAgICAgIGUubGluZW5vLAogICAgICAgICAgICAgICAgICBlLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIHQuc3Rhcl9leHByOgogICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICBkKGUsIHQuc3Rhcl9leHByKSwKICAgICAgICAgICAgICAgIG5ldyBTay5hc3Rub2Rlcy5TdGFycmVkKAogICAgICAgICAgICAgICAgICB1KGEsIGMoZSwgMSkpLAogICAgICAgICAgICAgICAgICBTay5hc3Rub2Rlcy5Mb2FkLAogICAgICAgICAgICAgICAgICBlLmxpbmVubywKICAgICAgICAgICAgICAgICAgZS5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICkKICAgICAgICAgICAgY2FzZSB0LmV4cHI6CiAgICAgICAgICAgIGNhc2UgdC54b3JfZXhwcjoKICAgICAgICAgICAgY2FzZSB0LmFuZF9leHByOgogICAgICAgICAgICBjYXNlIHQuc2hpZnRfZXhwcjoKICAgICAgICAgICAgY2FzZSB0LmFyaXRoX2V4cHI6CiAgICAgICAgICAgIGNhc2UgdC50ZXJtOgogICAgICAgICAgICAgIGlmICgxID09PSBiKGUpKSB7CiAgICAgICAgICAgICAgICBlID0gYyhlLCAwKQogICAgICAgICAgICAgICAgY29udGludWUgYQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB2YXIgaCA9IGUsCiAgICAgICAgICAgICAgICByID0gbmV3IFNrLmFzdG5vZGVzLkJpbk9wKAogICAgICAgICAgICAgICAgICB1KGEsIGMoaCwgMCkpLAogICAgICAgICAgICAgICAgICBsKGMoaCwgMSkpLAogICAgICAgICAgICAgICAgICB1KGEsIGMoaCwgMikpLAogICAgICAgICAgICAgICAgICBoLmxpbmVubywKICAgICAgICAgICAgICAgICAgaC5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIHEgPSAoYihoKSAtIDEpIC8gMgogICAgICAgICAgICAgIGZvciAoZSA9IDE7IGUgPCBxOyArK2UpCiAgICAgICAgICAgICAgICAoayA9IGMoaCwgMiAqIGUgKyAxKSksCiAgICAgICAgICAgICAgICAgIChnID0gbChrKSksCiAgICAgICAgICAgICAgICAgIChmID0gdShhLCBjKGgsIDIgKiBlICsgMikpKSwKICAgICAgICAgICAgICAgICAgKHIgPSBuZXcgU2suYXN0bm9kZXMuQmluT3AociwgZywgZiwgay5saW5lbm8sIGsuY29sX29mZnNldCkpCiAgICAgICAgICAgICAgcmV0dXJuIHIKICAgICAgICAgICAgY2FzZSB0LnlpZWxkX2V4cHI6CiAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIChnID0gITEpLAogICAgICAgICAgICAgICAgKGYgPSBudWxsKSwKICAgICAgICAgICAgICAgIDEgPCBiKGUpICYmIChrID0gYyhlLCAxKSksCiAgICAgICAgICAgICAgICBrICYmCiAgICAgICAgICAgICAgICAgICgoZiA9IGMoaywgYihrKSAtIDEpKSwKICAgICAgICAgICAgICAgICAgMiA9PSBiKGspID8gKChnID0gITApLCAoZiA9IHUoYSwgZikpKSA6IChmID0gSShhLCBmKSkpLAogICAgICAgICAgICAgICAgZwogICAgICAgICAgICAgICAgICA/IG5ldyBTay5hc3Rub2Rlcy5ZaWVsZEZyb20oZiwgZS5saW5lbm8sIGUuY29sX29mZnNldCkKICAgICAgICAgICAgICAgICAgOiBuZXcgU2suYXN0bm9kZXMuWWllbGQoZiwgZS5saW5lbm8sIGUuY29sX29mZnNldCkKICAgICAgICAgICAgICApCiAgICAgICAgICAgIGNhc2UgdC5mYWN0b3I6CiAgICAgICAgICAgICAgaWYgKDEgPT09IGIoZSkpIHsKICAgICAgICAgICAgICAgIGUgPSBjKGUsIDApCiAgICAgICAgICAgICAgICBjb250aW51ZSBhCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBDKGEsIGUpCiAgICAgICAgICAgIGNhc2UgdC5wb3dlcjoKICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgKGsgPSBlKSwKICAgICAgICAgICAgICAgIGQoaywgdC5wb3dlciksCiAgICAgICAgICAgICAgICAoZSA9IHkoYSwgYyhrLCAwKSkpLAogICAgICAgICAgICAgICAgMSAhPT0gYihrKSAmJgogICAgICAgICAgICAgICAgICBjKGssIGIoaykgLSAxKS50eXBlID09PSB0LmZhY3RvciAmJgogICAgICAgICAgICAgICAgICAoKGEgPSB1KGEsIGMoaywgYihrKSAtIDEpKSksCiAgICAgICAgICAgICAgICAgIChlID0gbmV3IFNrLmFzdG5vZGVzLkJpbk9wKAogICAgICAgICAgICAgICAgICAgIGUsCiAgICAgICAgICAgICAgICAgICAgU2suYXN0bm9kZXMuUG93LAogICAgICAgICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgICAgICAgay5saW5lbm8sCiAgICAgICAgICAgICAgICAgICAgay5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgICApKSksCiAgICAgICAgICAgICAgICBlCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgidW5oYW5kbGVkIGV4cHIiLCAibi50eXBlOiAlZCIsIGUudHlwZSkKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrCiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIEwoYSwgbCkgewogICAgICAgIGwudHlwZSA9PT0gdC5zdG10ICYmIChTay5hc3NlcnRzLmFzc2VydCgxID09PSBiKGwpKSwgKGwgPSBjKGwsIDApKSkKICAgICAgICBsLnR5cGUgPT09IHQuc2ltcGxlX3N0bXQgJiYKICAgICAgICAgIChTay5hc3NlcnRzLmFzc2VydCgxID09PSBnKGwpKSwgKGwgPSBjKGwsIDApKSkKICAgICAgICBpZiAobC50eXBlID09PSB0LnNtYWxsX3N0bXQpCiAgICAgICAgICBzd2l0Y2ggKCgobCA9IGMobCwgMCkpLCBsLnR5cGUpKSB7CiAgICAgICAgICAgIGNhc2UgdC5leHByX3N0bXQ6CiAgICAgICAgICAgICAgcmV0dXJuIEUoYSwgbCkKICAgICAgICAgICAgY2FzZSB0LmRlbF9zdG10OgogICAgICAgICAgICAgIHZhciBoID0gbAogICAgICAgICAgICAgIGQoaCwgdC5kZWxfc3RtdCkKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLkRlbGV0ZSgKICAgICAgICAgICAgICAgIEgoYSwgYyhoLCAxKSwgU2suYXN0bm9kZXMuRGVsKSwKICAgICAgICAgICAgICAgIGgubGluZW5vLAogICAgICAgICAgICAgICAgaC5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICkKICAgICAgICAgICAgY2FzZSB0LnBhc3Nfc3RtdDoKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLlBhc3MobC5saW5lbm8sIGwuY29sX29mZnNldCkKICAgICAgICAgICAgY2FzZSB0LmZsb3dfc3RtdDoKICAgICAgICAgICAgICByZXR1cm4gUyhhLCBsKQogICAgICAgICAgICBjYXNlIHQuaW1wb3J0X3N0bXQ6CiAgICAgICAgICAgICAgdmFyIG4gPSBsLAogICAgICAgICAgICAgICAgcgogICAgICAgICAgICAgIGQobiwgdC5pbXBvcnRfc3RtdCkKICAgICAgICAgICAgICB2YXIgcSA9IG4ubGluZW5vCiAgICAgICAgICAgICAgbCA9IG4uY29sX29mZnNldAogICAgICAgICAgICAgIG4gPSBjKG4sIDApCiAgICAgICAgICAgICAgaWYgKG4udHlwZSA9PT0gdC5pbXBvcnRfbmFtZSkgewogICAgICAgICAgICAgICAgbiA9IGMobiwgMSkKICAgICAgICAgICAgICAgIGQobiwgdC5kb3R0ZWRfYXNfbmFtZXMpCiAgICAgICAgICAgICAgICB2YXIgbSA9IFtdCiAgICAgICAgICAgICAgICBmb3IgKHIgPSAwOyByIDwgYihuKTsgciArPSAyKSBtW3IgLyAyXSA9IEooYSwgYyhuLCByKSkKICAgICAgICAgICAgICAgIGEgPSBuZXcgU2suYXN0bm9kZXMuSW1wb3J0KG0sIHEsIGwpCiAgICAgICAgICAgICAgfSBlbHNlIGlmIChuLnR5cGUgPT09IHQuaW1wb3J0X2Zyb20pIHsKICAgICAgICAgICAgICAgIHZhciBwID0gbnVsbAogICAgICAgICAgICAgICAgaCA9IDAKICAgICAgICAgICAgICAgIGZvciAobSA9IDE7IG0gPCBiKG4pOyArK20pCiAgICAgICAgICAgICAgICAgIGlmIChjKG4sIG0pLnR5cGUgPT09IHQuZG90dGVkX25hbWUpIHsKICAgICAgICAgICAgICAgICAgICBwID0gSihhLCBjKG4sIG0pKQogICAgICAgICAgICAgICAgICAgIG0rKwogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYyhuLCBtKS50eXBlID09PSB2LlRfRE9UKSBoKysKICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoYyhuLCBtKS50eXBlID09PSB2LlRfRUxMSVBTSVMpIGggKz0gMwogICAgICAgICAgICAgICAgICBlbHNlIGJyZWFrCiAgICAgICAgICAgICAgICArK20KICAgICAgICAgICAgICAgIHN3aXRjaCAoYyhuLCBtKS50eXBlKSB7CiAgICAgICAgICAgICAgICAgIGNhc2Ugdi5UX1NUQVI6CiAgICAgICAgICAgICAgICAgICAgbiA9IGMobiwgbSkKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICBjYXNlIHYuVF9MUEFSOgogICAgICAgICAgICAgICAgICAgIG4gPSBjKG4sIG0gKyAxKQogICAgICAgICAgICAgICAgICAgIGIobikKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICBjYXNlIHQuaW1wb3J0X2FzX25hbWVzOgogICAgICAgICAgICAgICAgICAgIG4gPSBjKG4sIG0pCiAgICAgICAgICAgICAgICAgICAgbSA9IGIobikKICAgICAgICAgICAgICAgICAgICBpZiAoMCA9PT0gbSAlIDIpCiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgICAgICAgICAgICAgInRyYWlsaW5nIGNvbW1hIG5vdCBhbGxvd2VkIHdpdGhvdXQgc3Vycm91bmRpbmcgcGFyZW50aGVzZXMiLAogICAgICAgICAgICAgICAgICAgICAgICBhLmNfZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIG4ubGluZW5vLAogICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgICAgICAgICAiVW5leHBlY3RlZCBub2RlLXR5cGUgaW4gZnJvbS1pbXBvcnQiLAogICAgICAgICAgICAgICAgICAgICAgYS5jX2ZpbGVuYW1lLAogICAgICAgICAgICAgICAgICAgICAgbi5saW5lbm8sCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbSA9IFtdCiAgICAgICAgICAgICAgICBpZiAobi50eXBlID09PSB2LlRfU1RBUikgbVswXSA9IEooYSwgbikKICAgICAgICAgICAgICAgIGVsc2UgZm9yIChyID0gMDsgciA8IGIobik7IHIgKz0gMikgbVtyIC8gMl0gPSBKKGEsIGMobiwgcikpCiAgICAgICAgICAgICAgICBhID0gcCA/IHAubmFtZS52IDogIiIKICAgICAgICAgICAgICAgIGEgPSBuZXcgU2suYXN0bm9kZXMuSW1wb3J0RnJvbShmKGEpLCBtLCBoLCBxLCBsKQogICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgICAgICJ1bmtub3duIGltcG9ydCBzdGF0ZW1lbnQiLAogICAgICAgICAgICAgICAgICBhLmNfZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgIG4ubGluZW5vLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgIGNhc2UgdC5nbG9iYWxfc3RtdDoKICAgICAgICAgICAgICBhID0gbAogICAgICAgICAgICAgIGwgPSBbXQogICAgICAgICAgICAgIGQoYSwgdC5nbG9iYWxfc3RtdCkKICAgICAgICAgICAgICBmb3IgKGggPSAxOyBoIDwgYihhKTsgaCArPSAyKSBsWyhoIC0gMSkgLyAyXSA9IGYoYyhhLCBoKS52YWx1ZSkKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLkdsb2JhbChsLCBhLmxpbmVubywgYS5jb2xfb2Zmc2V0KQogICAgICAgICAgICBjYXNlIHQubm9ubG9jYWxfc3RtdDoKICAgICAgICAgICAgICBlKGEsIGwsICJOb3QgaW1wbGVtZW50ZWQ6IG5vbmxvY2FsIikKICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBjYXNlIHQuYXNzZXJ0X3N0bXQ6CiAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIChoID0gbCksCiAgICAgICAgICAgICAgICBkKGgsIHQuYXNzZXJ0X3N0bXQpLAogICAgICAgICAgICAgICAgMiA9PT0gYihoKQogICAgICAgICAgICAgICAgICA/IChhID0gbmV3IFNrLmFzdG5vZGVzLkFzc2VydCgKICAgICAgICAgICAgICAgICAgICAgIHUoYSwgYyhoLCAxKSksCiAgICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICAgaC5saW5lbm8sCiAgICAgICAgICAgICAgICAgICAgICBoLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgKSkKICAgICAgICAgICAgICAgICAgOiA0ID09PSBiKGgpCiAgICAgICAgICAgICAgICAgID8gKGEgPSBuZXcgU2suYXN0bm9kZXMuQXNzZXJ0KAogICAgICAgICAgICAgICAgICAgICAgdShhLCBjKGgsIDEpKSwKICAgICAgICAgICAgICAgICAgICAgIHUoYSwgYyhoLCAzKSksCiAgICAgICAgICAgICAgICAgICAgICBoLmxpbmVubywKICAgICAgICAgICAgICAgICAgICAgIGguY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgICApKQogICAgICAgICAgICAgICAgICA6IChTay5hc3NlcnRzLmZhaWwoImltcHJvcGVyIG51bWJlciBvZiBwYXJ0cyB0byBhc3NlcnQgc3RtdCIpLAogICAgICAgICAgICAgICAgICAgIChhID0gdm9pZCAwKSksCiAgICAgICAgICAgICAgICBhCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBjYXNlIHQucHJpbnRfc3RtdDoKICAgICAgICAgICAgICBoID0gbAogICAgICAgICAgICAgIFNrLl9fZnV0dXJlX18ucHJpbnRfZnVuY3Rpb24gJiYKICAgICAgICAgICAgICAgIGUoYSwgaCwgIk1pc3NpbmcgcGFyZW50aGVzZXMgaW4gY2FsbCB0byAncHJpbnQnIikKICAgICAgICAgICAgICBuID0gMQogICAgICAgICAgICAgIHEgPSBudWxsCiAgICAgICAgICAgICAgZChoLCB0LnByaW50X3N0bXQpCiAgICAgICAgICAgICAgMiA8PSBiKGgpICYmCiAgICAgICAgICAgICAgICBjKGgsIDEpLnR5cGUgPT09IHYuVF9SSUdIVFNISUZUICYmCiAgICAgICAgICAgICAgICAoKHEgPSB1KGEsIGMoaCwgMikpKSwgKG4gPSA0KSkKICAgICAgICAgICAgICBsID0gW10KICAgICAgICAgICAgICBmb3IgKHAgPSAwOyBuIDwgYihoKTsgbiArPSAyLCArK3ApIGxbcF0gPSB1KGEsIGMoaCwgbikpCiAgICAgICAgICAgICAgYSA9IGMoaCwgYihoKSAtIDEpLnR5cGUgPT09IHYuVF9DT01NQSA/ICExIDogITAKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLlByaW50KHEsIGwsIGEsIGgubGluZW5vLCBoLmNvbF9vZmZzZXQpCiAgICAgICAgICAgIGNhc2UgdC5kZWJ1Z2dlcl9zdG10OgogICAgICAgICAgICAgIHJldHVybiBuZXcgU2suYXN0bm9kZXMuRGVidWdnZXIobC5saW5lbm8sIGwuY29sX29mZnNldCkKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoInVuaGFuZGxlZCBzbWFsbF9zdG10IikKICAgICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgICBzd2l0Y2ggKCgoaCA9IGMobCwgMCkpLCBkKGwsIHQuY29tcG91bmRfc3RtdCksIGgudHlwZSkpIHsKICAgICAgICAgICAgY2FzZSB0LmlmX3N0bXQ6CiAgICAgICAgICAgICAgZChoLCB0LmlmX3N0bXQpCiAgICAgICAgICAgICAgaWYgKDQgPT09IGIoaCkpCiAgICAgICAgICAgICAgICBhID0gbmV3IFNrLmFzdG5vZGVzLklmKAogICAgICAgICAgICAgICAgICB1KGEsIGMoaCwgMSkpLAogICAgICAgICAgICAgICAgICB4KGEsIGMoaCwgMykpLAogICAgICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICAgICAgaC5saW5lbm8sCiAgICAgICAgICAgICAgICAgIGguY29sX29mZnNldCwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICBlbHNlIGlmICgoKGwgPSBjKGgsIDQpLnZhbHVlLmNoYXJBdCgyKSksICJzIiA9PT0gbCkpCiAgICAgICAgICAgICAgICBhID0gbmV3IFNrLmFzdG5vZGVzLklmKAogICAgICAgICAgICAgICAgICB1KGEsIGMoaCwgMSkpLAogICAgICAgICAgICAgICAgICB4KGEsIGMoaCwgMykpLAogICAgICAgICAgICAgICAgICB4KGEsIGMoaCwgNikpLAogICAgICAgICAgICAgICAgICBoLmxpbmVubywKICAgICAgICAgICAgICAgICAgaC5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIGVsc2UgaWYgKCJpIiA9PT0gbCkgewogICAgICAgICAgICAgICAgcSA9IGIoaCkgLSA0CiAgICAgICAgICAgICAgICBuID0gITEKICAgICAgICAgICAgICAgIGwgPSBbXQogICAgICAgICAgICAgICAgYyhoLCBxICsgMSkudHlwZSA9PT0gdi5UX05BTUUgJiYKICAgICAgICAgICAgICAgICAgInMiID09PSBjKGgsIHEgKyAxKS52YWx1ZS5jaGFyQXQoMikgJiYKICAgICAgICAgICAgICAgICAgKChuID0gITApLCAocSAtPSAzKSkKICAgICAgICAgICAgICAgIHEgLz0gNAogICAgICAgICAgICAgICAgbiAmJgogICAgICAgICAgICAgICAgICAoKGwgPSBbCiAgICAgICAgICAgICAgICAgICAgbmV3IFNrLmFzdG5vZGVzLklmKAogICAgICAgICAgICAgICAgICAgICAgdShhLCBjKGgsIGIoaCkgLSA2KSksCiAgICAgICAgICAgICAgICAgICAgICB4KGEsIGMoaCwgYihoKSAtIDQpKSwKICAgICAgICAgICAgICAgICAgICAgIHgoYSwgYyhoLCBiKGgpIC0gMSkpLAogICAgICAgICAgICAgICAgICAgICAgYyhoLCBiKGgpIC0gNikubGluZW5vLAogICAgICAgICAgICAgICAgICAgICAgYyhoLCBiKGgpIC0gNikuY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICBdKSwKICAgICAgICAgICAgICAgICAgcS0tKQogICAgICAgICAgICAgICAgZm9yIChwID0gMDsgcCA8IHE7ICsrcCkKICAgICAgICAgICAgICAgICAgKG4gPSA1ICsgNCAqIChxIC0gcCAtIDEpKSwKICAgICAgICAgICAgICAgICAgICAobCA9IFsKICAgICAgICAgICAgICAgICAgICAgIG5ldyBTay5hc3Rub2Rlcy5JZigKICAgICAgICAgICAgICAgICAgICAgICAgdShhLCBjKGgsIG4pKSwKICAgICAgICAgICAgICAgICAgICAgICAgeChhLCBjKGgsIG4gKyAyKSksCiAgICAgICAgICAgICAgICAgICAgICAgIGwsCiAgICAgICAgICAgICAgICAgICAgICAgIGMoaCwgbikubGluZW5vLAogICAgICAgICAgICAgICAgICAgICAgICBjKGgsIG4pLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICBhID0gbmV3IFNrLmFzdG5vZGVzLklmKAogICAgICAgICAgICAgICAgICB1KGEsIGMoaCwgMSkpLAogICAgICAgICAgICAgICAgICB4KGEsIGMoaCwgMykpLAogICAgICAgICAgICAgICAgICBsLAogICAgICAgICAgICAgICAgICBoLmxpbmVubywKICAgICAgICAgICAgICAgICAgaC5jb2xfb2Zmc2V0LAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJ1bmV4cGVjdGVkIHRva2VuIGluICdpZicgc3RhdGVtZW50IiksCiAgICAgICAgICAgICAgICAgIChhID0gdm9pZCAwKQogICAgICAgICAgICAgIHJldHVybiBhCiAgICAgICAgICAgIGNhc2UgdC53aGlsZV9zdG10OgogICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICBkKGgsIHQud2hpbGVfc3RtdCksCiAgICAgICAgICAgICAgICA0ID09PSBiKGgpCiAgICAgICAgICAgICAgICAgID8gKGEgPSBuZXcgU2suYXN0bm9kZXMuV2hpbGUoCiAgICAgICAgICAgICAgICAgICAgICB1KGEsIGMoaCwgMSkpLAogICAgICAgICAgICAgICAgICAgICAgeChhLCBjKGgsIDMpKSwKICAgICAgICAgICAgICAgICAgICAgIFtdLAogICAgICAgICAgICAgICAgICAgICAgaC5saW5lbm8sCiAgICAgICAgICAgICAgICAgICAgICBoLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgKSkKICAgICAgICAgICAgICAgICAgOiA3ID09PSBiKGgpCiAgICAgICAgICAgICAgICAgID8gKGEgPSBuZXcgU2suYXN0bm9kZXMuV2hpbGUoCiAgICAgICAgICAgICAgICAgICAgICB1KGEsIGMoaCwgMSkpLAogICAgICAgICAgICAgICAgICAgICAgeChhLCBjKGgsIDMpKSwKICAgICAgICAgICAgICAgICAgICAgIHgoYSwgYyhoLCA2KSksCiAgICAgICAgICAgICAgICAgICAgICBoLmxpbmVubywKICAgICAgICAgICAgICAgICAgICAgIGguY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgICApKQogICAgICAgICAgICAgICAgICA6IChTay5hc3NlcnRzLmZhaWwoIndyb25nIG51bWJlciBvZiB0b2tlbnMgZm9yICd3aGlsZScgc3RtdCIpLAogICAgICAgICAgICAgICAgICAgIChhID0gdm9pZCAwKSksCiAgICAgICAgICAgICAgICBhCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBjYXNlIHQuZm9yX3N0bXQ6CiAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIChsID0gW10pLAogICAgICAgICAgICAgICAgZChoLCB0LmZvcl9zdG10KSwKICAgICAgICAgICAgICAgIDkgPT09IGIoaCkgJiYgKGwgPSB4KGEsIGMoaCwgOCkpKSwKICAgICAgICAgICAgICAgIChuID0gYyhoLCAxKSksCiAgICAgICAgICAgICAgICAocSA9IEgoYSwgbiwgU2suYXN0bm9kZXMuU3RvcmUpKSwKICAgICAgICAgICAgICAgIChxID0KICAgICAgICAgICAgICAgICAgMSA9PT0gYihuKQogICAgICAgICAgICAgICAgICAgID8gcVswXQogICAgICAgICAgICAgICAgICAgIDogbmV3IFNrLmFzdG5vZGVzLlR1cGxlKAogICAgICAgICAgICAgICAgICAgICAgICBxLAogICAgICAgICAgICAgICAgICAgICAgICBTay5hc3Rub2Rlcy5TdG9yZSwKICAgICAgICAgICAgICAgICAgICAgICAgaC5saW5lbm8sCiAgICAgICAgICAgICAgICAgICAgICAgIGguY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgICAgICkpLAogICAgICAgICAgICAgICAgbmV3IFNrLmFzdG5vZGVzLkZvcigKICAgICAgICAgICAgICAgICAgcSwKICAgICAgICAgICAgICAgICAgSShhLCBjKGgsIDMpKSwKICAgICAgICAgICAgICAgICAgeChhLCBjKGgsIDUpKSwKICAgICAgICAgICAgICAgICAgbCwKICAgICAgICAgICAgICAgICAgaC5saW5lbm8sCiAgICAgICAgICAgICAgICAgIGguY29sX29mZnNldCwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICApCiAgICAgICAgICAgIGNhc2UgdC50cnlfc3RtdDoKICAgICAgICAgICAgICBsID0gW10KICAgICAgICAgICAgICByID0gYihoKQogICAgICAgICAgICAgIHEgPSAociAtIDMpIC8gMwogICAgICAgICAgICAgIHAgPSBbXQogICAgICAgICAgICAgIG0gPSBudWxsCiAgICAgICAgICAgICAgZChoLCB0LnRyeV9zdG10KQogICAgICAgICAgICAgIG4gPSB4KGEsIGMoaCwgMikpCiAgICAgICAgICAgICAgaWYgKGMoaCwgciAtIDMpLnR5cGUgPT09IHYuVF9OQU1FKQogICAgICAgICAgICAgICAgImZpbmFsbHkiID09PSBjKGgsIHIgLSAzKS52YWx1ZQogICAgICAgICAgICAgICAgICA/ICg5IDw9IHIgJiYKICAgICAgICAgICAgICAgICAgICAgIGMoaCwgciAtIDYpLnR5cGUgPT09IHYuVF9OQU1FICYmCiAgICAgICAgICAgICAgICAgICAgICAoKHAgPSB4KGEsIGMoaCwgciAtIDQpKSksIHEtLSksCiAgICAgICAgICAgICAgICAgICAgKG0gPSB4KGEsIGMoaCwgciAtIDEpKSkpCiAgICAgICAgICAgICAgICAgIDogKHAgPSB4KGEsIGMoaCwgciAtIDEpKSksCiAgICAgICAgICAgICAgICAgIHEtLQogICAgICAgICAgICAgIGVsc2UgaWYgKGMoaCwgciAtIDMpLnR5cGUgIT09IHQuZXhjZXB0X2NsYXVzZSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICAgICAibWFsZm9ybWVkICd0cnknIHN0YXRlbWVudCIsCiAgICAgICAgICAgICAgICAgIGEuY19maWxlbmFtZSwKICAgICAgICAgICAgICAgICAgaC5saW5lbm8sCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgaWYgKDAgPCBxKQogICAgICAgICAgICAgICAgZm9yIChyID0gMDsgciA8IHE7IHIrKykgewogICAgICAgICAgICAgICAgICB2YXIgRCA9IHIKICAgICAgICAgICAgICAgICAgdmFyIEEgPSBhLAogICAgICAgICAgICAgICAgICAgIHcgPSBjKGgsIDMgKyAzICogciksCiAgICAgICAgICAgICAgICAgICAgQiA9IGMoaCwgNSArIDMgKiByKQogICAgICAgICAgICAgICAgICBkKHcsIHQuZXhjZXB0X2NsYXVzZSkKICAgICAgICAgICAgICAgICAgZChCLCB0LnN1aXRlKQogICAgICAgICAgICAgICAgICBpZiAoMSA9PT0gYih3KSkKICAgICAgICAgICAgICAgICAgICB2YXIgQyA9IG5ldyBTay5hc3Rub2Rlcy5FeGNlcHRIYW5kbGVyKAogICAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB4KEEsIEIpLAogICAgICAgICAgICAgICAgICAgICAgdy5saW5lbm8sCiAgICAgICAgICAgICAgICAgICAgICB3LmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgMiA9PT0gYih3KQogICAgICAgICAgICAgICAgICAgICAgPyAoQyA9IG5ldyBTay5hc3Rub2Rlcy5FeGNlcHRIYW5kbGVyKAogICAgICAgICAgICAgICAgICAgICAgICAgIHUoQSwgYyh3LCAxKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICB4KEEsIEIpLAogICAgICAgICAgICAgICAgICAgICAgICAgIHcubGluZW5vLAogICAgICAgICAgICAgICAgICAgICAgICAgIHcuY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgICAgICAgKSkKICAgICAgICAgICAgICAgICAgICAgIDogNCA9PT0gYih3KQogICAgICAgICAgICAgICAgICAgICAgPyAoU2suX19mdXR1cmVfXy5weXRob24zICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgIiwiID09IGModywgMikudmFsdWUgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICBlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiT2xkLXN0eWxlICdleGNlcHQnIGNsYXVzZXMgYXJlIG5vdCBzdXBwb3J0ZWQgaW4gUHl0aG9uIDMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgIHUoQSwgYyh3LCAxKSksCiAgICAgICAgICAgICAgICAgICAgICAgIChDID0gdShBLCBjKHcsIDMpKSksCiAgICAgICAgICAgICAgICAgICAgICAgIGsoQSwgQywgU2suYXN0bm9kZXMuU3RvcmUsIGModywgMykpLAogICAgICAgICAgICAgICAgICAgICAgICAoQyA9IG5ldyBTay5hc3Rub2Rlcy5FeGNlcHRIYW5kbGVyKAogICAgICAgICAgICAgICAgICAgICAgICAgIHUoQSwgYyh3LCAxKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgQywKICAgICAgICAgICAgICAgICAgICAgICAgICB4KEEsIEIpLAogICAgICAgICAgICAgICAgICAgICAgICAgIHcubGluZW5vLAogICAgICAgICAgICAgICAgICAgICAgICAgIHcuY29sX29mZnNldCwKICAgICAgICAgICAgICAgICAgICAgICAgKSkpCiAgICAgICAgICAgICAgICAgICAgICA6IChTay5hc3NlcnRzLmZhaWwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgIndyb25nIG51bWJlciBvZiBjaGlsZHJlbiBmb3IgZXhjZXB0IGNsYXVzZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgIChDID0gdm9pZCAwKSkKICAgICAgICAgICAgICAgICAgbFtEXSA9IEMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydCghIW0gfHwgMCAhPSBsLmxlbmd0aCkKICAgICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLlRyeShuLCBsLCBwLCBtLCBoLmxpbmVubywgaC5jb2xfb2Zmc2V0KQogICAgICAgICAgICBjYXNlIHQud2l0aF9zdG10OgogICAgICAgICAgICAgIGwgPSBbXQogICAgICAgICAgICAgIGQoaCwgdC53aXRoX3N0bXQpCiAgICAgICAgICAgICAgZm9yIChxID0gMTsgcSA8IGIoaCkgLSAyOyBxICs9IDIpCiAgICAgICAgICAgICAgICAobiA9IHZvaWQgMCksCiAgICAgICAgICAgICAgICAgIChtID0gYSksCiAgICAgICAgICAgICAgICAgIChyID0gYyhoLCBxKSksCiAgICAgICAgICAgICAgICAgIGQociwgdC53aXRoX2l0ZW0pLAogICAgICAgICAgICAgICAgICAocCA9IHUobSwgYyhyLCAwKSkpLAogICAgICAgICAgICAgICAgICAzID09IGIocikgJiYKICAgICAgICAgICAgICAgICAgICAoKG4gPSB1KG0sIGMociwgMikpKSwgayhtLCBuLCBTay5hc3Rub2Rlcy5TdG9yZSwgcikpLAogICAgICAgICAgICAgICAgICAobiA9IG5ldyBTay5hc3Rub2Rlcy53aXRoaXRlbShwLCBuKSksCiAgICAgICAgICAgICAgICAgIChsWyhxIC0gMSkgLyAyXSA9IG4pCiAgICAgICAgICAgICAgYSA9IHgoYSwgYyhoLCBiKGgpIC0gMSkpCiAgICAgICAgICAgICAgYSA9IG5ldyBTay5hc3Rub2Rlcy5XaXRoKGwsIGEsIGgubGluZW5vLCBoLmNvbF9vZmZzZXQpCiAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgY2FzZSB0LmZ1bmNkZWY6CiAgICAgICAgICAgICAgcmV0dXJuIFYoYSwgaCwgW10sICExKQogICAgICAgICAgICBjYXNlIHQuY2xhc3NkZWY6CiAgICAgICAgICAgICAgcmV0dXJuIFgoYSwgaCwgW10pCiAgICAgICAgICAgIGNhc2UgdC5kZWNvcmF0ZWQ6CiAgICAgICAgICAgICAgcSA9IG51bGwKICAgICAgICAgICAgICBkKGgsIHQuZGVjb3JhdGVkKQogICAgICAgICAgICAgIG4gPSBjKGgsIDApCiAgICAgICAgICAgICAgZChuLCB0LmRlY29yYXRvcnMpCiAgICAgICAgICAgICAgbCA9IFtdCiAgICAgICAgICAgICAgZm9yIChwID0gMDsgcCA8IGIobik7ICsrcCkgewogICAgICAgICAgICAgICAgbSA9IGwKICAgICAgICAgICAgICAgIHIgPSBwCiAgICAgICAgICAgICAgICBEID0gYQogICAgICAgICAgICAgICAgQyA9IGMobiwgcCkKICAgICAgICAgICAgICAgIGQoQywgdC5kZWNvcmF0b3IpCiAgICAgICAgICAgICAgICBkKGMoQywgMCksIHYuVF9BVCkKICAgICAgICAgICAgICAgIGQoYyhDLCBiKEMpIC0gMSksIHYuVF9ORVdMSU5FKQogICAgICAgICAgICAgICAgdmFyIHksCiAgICAgICAgICAgICAgICAgIHogPSBjKEMsIDEpCiAgICAgICAgICAgICAgICBkKHosIHQuZG90dGVkX25hbWUpCiAgICAgICAgICAgICAgICBBID0gei5saW5lbm8KICAgICAgICAgICAgICAgIHcgPSB6LmNvbF9vZmZzZXQKICAgICAgICAgICAgICAgIEIgPSBmKGMoeiwgMCkudmFsdWUpCiAgICAgICAgICAgICAgICB2YXIgRyA9IG5ldyBTay5hc3Rub2Rlcy5OYW1lKEIsIFNrLmFzdG5vZGVzLkxvYWQsIEEsIHcpCiAgICAgICAgICAgICAgICBmb3IgKHkgPSAyOyB5IDwgYih6KTsgeSArPSAyKQogICAgICAgICAgICAgICAgICAoQiA9IGYoYyh6LCB5KS52YWx1ZSkpLAogICAgICAgICAgICAgICAgICAgIChHID0gbmV3IFNrLmFzdG5vZGVzLkF0dHJpYnV0ZSgKICAgICAgICAgICAgICAgICAgICAgIEcsCiAgICAgICAgICAgICAgICAgICAgICBCLAogICAgICAgICAgICAgICAgICAgICAgU2suYXN0bm9kZXMuTG9hZCwKICAgICAgICAgICAgICAgICAgICAgIEEsCiAgICAgICAgICAgICAgICAgICAgICB3LAogICAgICAgICAgICAgICAgICAgICkpCiAgICAgICAgICAgICAgICBBID0gRwogICAgICAgICAgICAgICAgRCA9CiAgICAgICAgICAgICAgICAgIDMgPT09IGIoQykKICAgICAgICAgICAgICAgICAgICA/IEEKICAgICAgICAgICAgICAgICAgICA6IDUgPT09IGIoQykKICAgICAgICAgICAgICAgICAgICA/IG5ldyBTay5hc3Rub2Rlcy5DYWxsKAogICAgICAgICAgICAgICAgICAgICAgICBBLAogICAgICAgICAgICAgICAgICAgICAgICBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIEMubGluZW5vLAogICAgICAgICAgICAgICAgICAgICAgICBDLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgOiBLKEQsIGMoQywgMyksIEEpCiAgICAgICAgICAgICAgICBtW3JdID0gRAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgKICAgICAgICAgICAgICAgIGMoaCwgMSkudHlwZSA9PSB0LmZ1bmNkZWYgfHwKICAgICAgICAgICAgICAgICAgYyhoLCAxKS50eXBlID09IHQuYXN5bmNfZnVuY2RlZiB8fAogICAgICAgICAgICAgICAgICBjKGgsIDEpLnR5cGUgPT0gdC5jbGFzc2RlZiwKICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgYyhoLCAxKS50eXBlID09IHQuZnVuY2RlZgogICAgICAgICAgICAgICAgPyAoKHEgPSBjKGgsIDEpKSwgKHEgPSBWKGEsIHEsIGwsICExKSkpCiAgICAgICAgICAgICAgICA6IGMoaCwgMSkudHlwZSA9PSB0LmNsYXNzZGVmCiAgICAgICAgICAgICAgICA/IChxID0gWChhLCBjKGgsIDEpLCBsKSkKICAgICAgICAgICAgICAgIDogYyhoLCAxKS50eXBlID09IHQuYXN5bmNfZnVuY2RlZiAmJgogICAgICAgICAgICAgICAgICAoKHEgPSBjKGgsIDEpKSwKICAgICAgICAgICAgICAgICAgZChxLCB0LmFzeW5jX2Z1bmNkZWYpLAogICAgICAgICAgICAgICAgICBkKGMocSwgMCksIHYuVF9OQU1FKSwKICAgICAgICAgICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoKCJhc3luYyIgPT09IGMocSwgMCkpLnZhbHVlKSwKICAgICAgICAgICAgICAgICAgZChjKHEsIDEpLCB0LmZ1bmNkZWYpLAogICAgICAgICAgICAgICAgICAocSA9IFYoYSwgcSwgbCwgITApKSkKICAgICAgICAgICAgICBxICYmICgocS5saW5lbm8gPSBoLmxpbmVubyksIChxLmNvbF9vZmZzZXQgPSBoLmNvbF9vZmZzZXQpKQogICAgICAgICAgICAgIHJldHVybiBxCiAgICAgICAgICAgIGNhc2UgdC5hc3luY19zdG10OgogICAgICAgICAgICAgIGUoYSwgaCwgIk5vdCBpbXBsZW1lbnRlZDogYXN5bmMiKQogICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoInVuaGFuZGxlZCBjb21wb3VuZF9zdG10IikKICAgICAgICAgIH0KICAgICAgfQogICAgICB2YXIgdCA9IFNrLlBhcnNlVGFibGVzLnN5bSwKICAgICAgICB2ID0gU2sudG9rZW4udG9rZW5zLAogICAgICAgIFcgPSB7IFNsaWNlX2tpbmQ6IDEsIEV4dFNsaWNlX2tpbmQ6IDIsIEluZGV4X2tpbmQ6IDMgfSwKICAgICAgICBNID0ge30KICAgICAgTVt2LlRfVkJBUl0gPSBTay5hc3Rub2Rlcy5CaXRPcgogICAgICBNW3YuVF9DSVJDVU1GTEVYXSA9IFNrLmFzdG5vZGVzLkJpdFhvcgogICAgICBNW3YuVF9BTVBFUl0gPSBTay5hc3Rub2Rlcy5CaXRBbmQKICAgICAgTVt2LlRfTEVGVFNISUZUXSA9IFNrLmFzdG5vZGVzLkxTaGlmdAogICAgICBNW3YuVF9SSUdIVFNISUZUXSA9IFNrLmFzdG5vZGVzLlJTaGlmdAogICAgICBNW3YuVF9QTFVTXSA9IFNrLmFzdG5vZGVzLkFkZAogICAgICBNW3YuVF9NSU5VU10gPSBTay5hc3Rub2Rlcy5TdWIKICAgICAgTVt2LlRfU1RBUl0gPSBTay5hc3Rub2Rlcy5NdWx0CiAgICAgIE1bdi5UX1NMQVNIXSA9IFNrLmFzdG5vZGVzLkRpdgogICAgICBNW3YuVF9ET1VCTEVTTEFTSF0gPSBTay5hc3Rub2Rlcy5GbG9vckRpdgogICAgICBNW3YuVF9QRVJDRU5UXSA9IFNrLmFzdG5vZGVzLk1vZAogICAgICBTay5zZXR1cE9wZXJhdG9ycyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgYSA/IChNW3YuVF9BVF0gPSBTay5hc3Rub2Rlcy5NYXRNdWx0KSA6IE1bdi5UX0FUXSAmJiBkZWxldGUgTVt2LlRfQVRdCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5zZXR1cE9wZXJhdG9ycyIsIFNrLnNldHVwT3BlcmF0b3JzKQogICAgICBTay5hc3RGcm9tUGFyc2UgPSBmdW5jdGlvbiAoZSwgaywgZikgewogICAgICAgIHZhciBsLAogICAgICAgICAgaCA9IG5ldyBhKCJ1dGYtOCIsIGssIGYpLAogICAgICAgICAgbiA9IFtdLAogICAgICAgICAgciA9IDAKICAgICAgICBzd2l0Y2ggKGUudHlwZSkgewogICAgICAgICAgY2FzZSB0LmZpbGVfaW5wdXQ6CiAgICAgICAgICAgIGZvciAobCA9IDA7IGwgPCBiKGUpIC0gMTsgKytsKSB7CiAgICAgICAgICAgICAgdmFyIHEgPSBjKGUsIGwpCiAgICAgICAgICAgICAgaWYgKGUudHlwZSAhPT0gdi5UX05FV0xJTkUpCiAgICAgICAgICAgICAgICBpZiAoKGQocSwgdC5zdG10KSwgKGYgPSBnKHEpKSwgMSA9PT0gZikpIG5bcisrXSA9IEwoaCwgcSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgZm9yIChxID0gYyhxLCAwKSwgZChxLCB0LnNpbXBsZV9zdG10KSwgayA9IDA7IGsgPCBmOyArK2spCiAgICAgICAgICAgICAgICAgICAgbltyKytdID0gTChoLCBjKHEsIDIgKiBrKSkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbmV3IFNrLmFzdG5vZGVzLk1vZHVsZShuKQogICAgICAgICAgY2FzZSB0LmV2YWxfaW5wdXQ6CiAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgidG9kbzsiKQogICAgICAgICAgY2FzZSB0LnNpbmdsZV9pbnB1dDoKICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJ0b2RvOyIpCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoInRvZG87IikKICAgICAgICB9CiAgICAgIH0KICAgICAgU2suYXN0RHVtcCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICB2YXIgYiwKICAgICAgICAgICAgICBjID0gIiIKICAgICAgICAgICAgZm9yIChiID0gMDsgYiA8IGE7ICsrYikgYyArPSAiICIKICAgICAgICAgICAgcmV0dXJuIGMKICAgICAgICAgIH0sCiAgICAgICAgICBjID0gZnVuY3Rpb24gKGEsIGQpIHsKICAgICAgICAgICAgdmFyIGUKICAgICAgICAgICAgaWYgKG51bGwgPT09IGEpIHJldHVybiBkICsgIk5vbmUiCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICBhLnByb3RvdHlwZSAmJgogICAgICAgICAgICAgIHZvaWQgMCAhPT0gYS5wcm90b3R5cGUuX2FzdG5hbWUgJiYKICAgICAgICAgICAgICBhLnByb3RvdHlwZS5faXNlbnVtCiAgICAgICAgICAgICkKICAgICAgICAgICAgICByZXR1cm4gZCArIGEucHJvdG90eXBlLl9hc3RuYW1lICsgIigpIgogICAgICAgICAgICBpZiAodm9pZCAwICE9PSBhLl9hc3RuYW1lKSB7CiAgICAgICAgICAgICAgdmFyIGsgPSBiKGEuX2FzdG5hbWUubGVuZ3RoICsgMSkKICAgICAgICAgICAgICB2YXIgZyA9IFtdCiAgICAgICAgICAgICAgZm9yIChlID0gMDsgZSA8IGEuX2ZpZWxkcy5sZW5ndGg7IGUgKz0gMikgewogICAgICAgICAgICAgICAgdmFyIGYgPSBhLl9maWVsZHNbZV0KICAgICAgICAgICAgICAgIHZhciBsID0gYS5fZmllbGRzW2UgKyAxXShhKQogICAgICAgICAgICAgICAgdmFyIGggPSBiKGYubGVuZ3RoICsgMSkKICAgICAgICAgICAgICAgIGcucHVzaChbZiwgYyhsLCBkICsgayArIGgpXSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbCA9IFtdCiAgICAgICAgICAgICAgZm9yIChlID0gMDsgZSA8IGcubGVuZ3RoOyArK2UpCiAgICAgICAgICAgICAgICAoaCA9IGdbZV0pLCBsLnB1c2goaFswXSArICI9IiArIGhbMV0ucmVwbGFjZSgvXlxzKy8sICIiKSkKICAgICAgICAgICAgICBlID0gbC5qb2luKCIsXG4iICsgZCArIGspCiAgICAgICAgICAgICAgcmV0dXJuIGQgKyBhLl9hc3RuYW1lICsgIigiICsgZSArICIpIgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChTay5pc0FycmF5TGlrZShhKSkgewogICAgICAgICAgICAgIGsgPSBbXQogICAgICAgICAgICAgIGZvciAoZSA9IDA7IGUgPCBhLmxlbmd0aDsgKytlKSAoZyA9IGFbZV0pLCBrLnB1c2goYyhnLCBkICsgIiAiKSkKICAgICAgICAgICAgICBhID0gay5qb2luKCIsXG4iKQogICAgICAgICAgICAgIHJldHVybiBkICsgIlsiICsgYS5yZXBsYWNlKC9eXHMrLywgIiIpICsgIl0iCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYSA9CiAgICAgICAgICAgICAgITAgPT09IGEKICAgICAgICAgICAgICAgID8gIlRydWUiCiAgICAgICAgICAgICAgICA6ICExID09PSBhCiAgICAgICAgICAgICAgICA/ICJGYWxzZSIKICAgICAgICAgICAgICAgIDogYSBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubG5nCiAgICAgICAgICAgICAgICA/IGEudHAkc3RyKCkudgogICAgICAgICAgICAgICAgOiBhIGluc3RhbmNlb2YgU2suYnVpbHRpbi5zdHIKICAgICAgICAgICAgICAgID8gYS4kcigpLnYKICAgICAgICAgICAgICAgIDogIiIgKyBhCiAgICAgICAgICAgIHJldHVybiBkICsgYQogICAgICAgICAgfQogICAgICAgIHJldHVybiBjKGEsICIiKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYXN0RnJvbVBhcnNlIiwgU2suYXN0RnJvbVBhcnNlKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmFzdER1bXAiLCBTay5hc3REdW1wKQogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwKSB7CiAgICAgIGZ1bmN0aW9uIGEoYSwgYiwgYykgewogICAgICAgIHRoaXMuX19uYW1lID0gYQogICAgICAgIHRoaXMuX19mbGFncyA9IGIKICAgICAgICB0aGlzLl9fc2NvcGUgPSAoYiA+PiAxMSkgJiA3CiAgICAgICAgdGhpcy5fX25hbWVzcGFjZXMgPSBjIHx8IFtdCiAgICAgIH0KICAgICAgZnVuY3Rpb24gYihhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgdGhpcy5zeW1GbGFncyA9IHt9CiAgICAgICAgdGhpcy5uYW1lID0gYgogICAgICAgIHRoaXMudmFybmFtZXMgPSBbXQogICAgICAgIHRoaXMuY2hpbGRyZW4gPSBbXQogICAgICAgIHRoaXMuYmxvY2tUeXBlID0gYwogICAgICAgIHRoaXMucmV0dXJuc1ZhbHVlID0gdGhpcy52YXJrZXl3b3JkcyA9IHRoaXMudmFyYXJncyA9IHRoaXMuZ2VuZXJhdG9yID0gdGhpcy5jaGlsZEhhc0ZyZWUgPSB0aGlzLmhhc0ZyZWUgPSB0aGlzLmlzTmVzdGVkID0gITEKICAgICAgICB0aGlzLmxpbmVubyA9IGUKICAgICAgICB0aGlzLnRhYmxlID0gYQogICAgICAgIGEuY3VyICYmCiAgICAgICAgICAoYS5jdXIubmVzdGVkIHx8ICJmdW5jdGlvbiIgPT09IGEuY3VyLmJsb2NrVHlwZSkgJiYKICAgICAgICAgICh0aGlzLmlzTmVzdGVkID0gITApCiAgICAgICAgZC5zY29wZUlkID0gZisrCiAgICAgICAgYS5zdHNzW2Quc2NvcGVJZF0gPSB0aGlzCiAgICAgICAgdGhpcy5zeW1ib2xzID0ge30KICAgICAgfQogICAgICBmdW5jdGlvbiBjKGEpIHsKICAgICAgICB0aGlzLmZpbGVuYW1lID0gYQogICAgICAgIHRoaXMudG9wID0gdGhpcy5jdXIgPSBudWxsCiAgICAgICAgdGhpcy5zdGFjayA9IFtdCiAgICAgICAgdGhpcy5jdXJDbGFzcyA9IHRoaXMuZ2xvYmFsID0gbnVsbAogICAgICAgIHRoaXMudG1wbmFtZSA9IDAKICAgICAgICB0aGlzLnN0c3MgPSB7fQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGQoYSwgYikgewogICAgICAgIHZhciBjCiAgICAgICAgZm9yIChjID0gMDsgYyA8IGIubGVuZ3RoOyBjKyspIGEoYltjXSkKICAgICAgfQogICAgICBmdW5jdGlvbiBlKGEsIGIpIHsKICAgICAgICBmb3IgKHZhciBjIGluIGIpIGFbY10gPSBiW2NdCiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5TWU1UQUJfQ09OU1RTIiwgewogICAgICAgIERFRl9HTE9CQUw6IDEsCiAgICAgICAgREVGX0xPQ0FMOiAyLAogICAgICAgIERFRl9QQVJBTTogNCwKICAgICAgICBVU0U6IDgsCiAgICAgICAgREVGX1NUQVI6IDE2LAogICAgICAgIERFRl9ET1VCTEVTVEFSOiAzMiwKICAgICAgICBERUZfSU5UVVBMRTogNjQsCiAgICAgICAgREVGX0ZSRUU6IDEyOCwKICAgICAgICBERUZfRlJFRV9HTE9CQUw6IDI1NiwKICAgICAgICBERUZfRlJFRV9DTEFTUzogNTEyLAogICAgICAgIERFRl9JTVBPUlQ6IDEwMjQsCiAgICAgICAgREVGX0JPVU5EOiAxMDMwLAogICAgICAgIFNDT1BFX09GRjogMTEsCiAgICAgICAgU0NPUEVfTUFTSzogNywKICAgICAgICBMT0NBTDogMSwKICAgICAgICBHTE9CQUxfRVhQTElDSVQ6IDIsCiAgICAgICAgR0xPQkFMX0lNUExJQ0lUOiAzLAogICAgICAgIEZSRUU6IDQsCiAgICAgICAgQ0VMTDogNSwKICAgICAgICBPUFRfSU1QT1JUX1NUQVI6IDEsCiAgICAgICAgT1BUX0VYRUM6IDIsCiAgICAgICAgT1BUX0JBUkVfRVhFQzogNCwKICAgICAgICBPUFRfVE9QTEVWRUw6IDgsCiAgICAgICAgR0VORVJBVE9SOiAyLAogICAgICAgIEdFTkVSQVRPUl9FWFBSRVNTSU9OOiAyLAogICAgICAgIE1vZHVsZUJsb2NrOiAibW9kdWxlIiwKICAgICAgICBGdW5jdGlvbkJsb2NrOiAiZnVuY3Rpb24iLAogICAgICAgIENsYXNzQmxvY2s6ICJjbGFzcyIsCiAgICAgIH0pCiAgICAgIGEucHJvdG90eXBlLmdldF9uYW1lID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLl9fbmFtZQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmlzX3JlZmVyZW5jZWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuICEhKHRoaXMuX19mbGFncyAmIDgpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuaXNfcGFyYW1ldGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAhISh0aGlzLl9fZmxhZ3MgJiA0KQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmlzX2dsb2JhbCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gMyA9PT0gdGhpcy5fX3Njb3BlIHx8IDIgPT0gdGhpcy5fX3Njb3BlCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuaXNfZGVjbGFyZWRfZ2xvYmFsID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAyID09IHRoaXMuX19zY29wZQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmlzX2xvY2FsID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAhISh0aGlzLl9fZmxhZ3MgJiAxMDMwKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmlzX2ZyZWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIDQgPT0gdGhpcy5fX3Njb3BlCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuaXNfaW1wb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuICEhKHRoaXMuX19mbGFncyAmIDEwMjQpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuaXNfYXNzaWduZWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuICEhKHRoaXMuX19mbGFncyAmIDIpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuaXNfbmFtZXNwYWNlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLl9fbmFtZXNwYWNlcyAmJiAwIDwgdGhpcy5fX25hbWVzcGFjZXMubGVuZ3RoCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuZ2V0X25hbWVzcGFjZXMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX19uYW1lc3BhY2VzCiAgICAgIH0KICAgICAgdmFyIGYgPSAwCiAgICAgIGIucHJvdG90eXBlLmdldF90eXBlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLmJsb2NrVHlwZQogICAgICB9CiAgICAgIGIucHJvdG90eXBlLmdldF9uYW1lID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLm5hbWUKICAgICAgfQogICAgICBiLnByb3RvdHlwZS5nZXRfbGluZW5vID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLmxpbmVubwogICAgICB9CiAgICAgIGIucHJvdG90eXBlLmlzX25lc3RlZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy5pc05lc3RlZAogICAgICB9CiAgICAgIGIucHJvdG90eXBlLmhhc19jaGlsZHJlbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gMCA8IHRoaXMuY2hpbGRyZW4ubGVuZ3RoCiAgICAgIH0KICAgICAgYi5wcm90b3R5cGUuZ2V0X2lkZW50aWZpZXJzID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pZGVudHNNYXRjaGluZyhmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gITAKICAgICAgICB9KQogICAgICB9CiAgICAgIGIucHJvdG90eXBlLmxvb2t1cCA9IGZ1bmN0aW9uIChiKSB7CiAgICAgICAgaWYgKHRoaXMuc3ltYm9scy5oYXNPd25Qcm9wZXJ0eShiKSkgYiA9IHRoaXMuc3ltYm9sc1tiXQogICAgICAgIGVsc2UgewogICAgICAgICAgdmFyIGMgPSB0aGlzLnN5bUZsYWdzW2JdCiAgICAgICAgICB2YXIgZCA9IHRoaXMuX19jaGVja19jaGlsZHJlbihiKQogICAgICAgICAgYiA9IHRoaXMuc3ltYm9sc1tiXSA9IG5ldyBhKGIsIGMsIGQpCiAgICAgICAgfQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgYi5wcm90b3R5cGUuX19jaGVja19jaGlsZHJlbiA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIsCiAgICAgICAgICBjID0gW10KICAgICAgICBmb3IgKGIgPSAwOyBiIDwgdGhpcy5jaGlsZHJlbi5sZW5ndGg7ICsrYikgewogICAgICAgICAgdmFyIGQgPSB0aGlzLmNoaWxkcmVuW2JdCiAgICAgICAgICBkLm5hbWUgPT09IGEgJiYgYy5wdXNoKGQpCiAgICAgICAgfQogICAgICAgIHJldHVybiBjCiAgICAgIH0KICAgICAgYi5wcm90b3R5cGUuX2lkZW50c01hdGNoaW5nID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiwKICAgICAgICAgIGMgPSBbXQogICAgICAgIGZvciAoYiBpbiB0aGlzLnN5bUZsYWdzKQogICAgICAgICAgdGhpcy5zeW1GbGFncy5oYXNPd25Qcm9wZXJ0eShiKSAmJiBhKHRoaXMuc3ltRmxhZ3NbYl0pICYmIGMucHVzaChiKQogICAgICAgIGMuc29ydCgpCiAgICAgICAgcmV0dXJuIGMKICAgICAgfQogICAgICBiLnByb3RvdHlwZS5nZXRfcGFyYW1ldGVycyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgKICAgICAgICAgICJmdW5jdGlvbiIgPT0gdGhpcy5nZXRfdHlwZSgpLAogICAgICAgICAgImdldF9wYXJhbWV0ZXJzIG9ubHkgdmFsaWQgZm9yIGZ1bmN0aW9uIHNjb3BlcyIsCiAgICAgICAgKQogICAgICAgIHRoaXMuX2Z1bmNQYXJhbXMgfHwKICAgICAgICAgICh0aGlzLl9mdW5jUGFyYW1zID0gdGhpcy5faWRlbnRzTWF0Y2hpbmcoZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgcmV0dXJuIGEgJiA0CiAgICAgICAgICB9KSkKICAgICAgICByZXR1cm4gdGhpcy5fZnVuY1BhcmFtcwogICAgICB9CiAgICAgIGIucHJvdG90eXBlLmdldF9sb2NhbHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoCiAgICAgICAgICAiZnVuY3Rpb24iID09IHRoaXMuZ2V0X3R5cGUoKSwKICAgICAgICAgICJnZXRfbG9jYWxzIG9ubHkgdmFsaWQgZm9yIGZ1bmN0aW9uIHNjb3BlcyIsCiAgICAgICAgKQogICAgICAgIHRoaXMuX2Z1bmNMb2NhbHMgfHwKICAgICAgICAgICh0aGlzLl9mdW5jTG9jYWxzID0gdGhpcy5faWRlbnRzTWF0Y2hpbmcoZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgcmV0dXJuIGEgJiAxMDMwCiAgICAgICAgICB9KSkKICAgICAgICByZXR1cm4gdGhpcy5fZnVuY0xvY2FscwogICAgICB9CiAgICAgIGIucHJvdG90eXBlLmdldF9nbG9iYWxzID0gZnVuY3Rpb24gKCkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KAogICAgICAgICAgImZ1bmN0aW9uIiA9PSB0aGlzLmdldF90eXBlKCksCiAgICAgICAgICAiZ2V0X2dsb2JhbHMgb25seSB2YWxpZCBmb3IgZnVuY3Rpb24gc2NvcGVzIiwKICAgICAgICApCiAgICAgICAgdGhpcy5fZnVuY0dsb2JhbHMgfHwKICAgICAgICAgICh0aGlzLl9mdW5jR2xvYmFscyA9IHRoaXMuX2lkZW50c01hdGNoaW5nKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgIGEgPSAoYSA+PiAxMSkgJiA3CiAgICAgICAgICAgIHJldHVybiAzID09IGEgfHwgMiA9PSBhCiAgICAgICAgICB9KSkKICAgICAgICByZXR1cm4gdGhpcy5fZnVuY0dsb2JhbHMKICAgICAgfQogICAgICBiLnByb3RvdHlwZS5nZXRfZnJlZXMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoCiAgICAgICAgICAiZnVuY3Rpb24iID09IHRoaXMuZ2V0X3R5cGUoKSwKICAgICAgICAgICJnZXRfZnJlZXMgb25seSB2YWxpZCBmb3IgZnVuY3Rpb24gc2NvcGVzIiwKICAgICAgICApCiAgICAgICAgdGhpcy5fZnVuY0ZyZWVzIHx8CiAgICAgICAgICAodGhpcy5fZnVuY0ZyZWVzID0gdGhpcy5faWRlbnRzTWF0Y2hpbmcoZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgcmV0dXJuIDQgPT0gKChhID4+IDExKSAmIDcpCiAgICAgICAgICB9KSkKICAgICAgICByZXR1cm4gdGhpcy5fZnVuY0ZyZWVzCiAgICAgIH0KICAgICAgYi5wcm90b3R5cGUuZ2V0X21ldGhvZHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGEKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgKICAgICAgICAgICJjbGFzcyIgPT0gdGhpcy5nZXRfdHlwZSgpLAogICAgICAgICAgImdldF9tZXRob2RzIG9ubHkgdmFsaWQgZm9yIGNsYXNzIHNjb3BlcyIsCiAgICAgICAgKQogICAgICAgIGlmICghdGhpcy5fY2xhc3NNZXRob2RzKSB7CiAgICAgICAgICB2YXIgYiA9IFtdCiAgICAgICAgICBmb3IgKGEgPSAwOyBhIDwgdGhpcy5jaGlsZHJlbi5sZW5ndGg7ICsrYSkKICAgICAgICAgICAgYi5wdXNoKHRoaXMuY2hpbGRyZW5bYV0ubmFtZSkKICAgICAgICAgIGIuc29ydCgpCiAgICAgICAgICB0aGlzLl9jbGFzc01ldGhvZHMgPSBiCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLl9jbGFzc01ldGhvZHMKICAgICAgfQogICAgICBiLnByb3RvdHlwZS5nZXRTY29wZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgYSA9IHRoaXMuc3ltRmxhZ3NbYV0KICAgICAgICByZXR1cm4gdm9pZCAwID09PSBhID8gMCA6IChhID4+IDExKSAmIDcKICAgICAgfQogICAgICBjLnByb3RvdHlwZS5nZXRTdHNGb3JBc3QgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KHZvaWQgMCAhPT0gYS5zY29wZUlkLCAiYXN0IHdhc24ndCBhZGRlZCB0byBzdD8iKQogICAgICAgIGEgPSB0aGlzLnN0c3NbYS5zY29wZUlkXQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KHZvaWQgMCAhPT0gYSwgInVua25vd24gc3ltIHRhYiBlbnRyeSIpCiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgICBjLnByb3RvdHlwZS5TRVFTdG10ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiwgYwogICAgICAgIGlmIChudWxsICE9PSBhKSB7CiAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgKICAgICAgICAgICAgU2suaXNBcnJheUxpa2UoYSksCiAgICAgICAgICAgICJTRVE6IG5vZGVzIGlzbid0IGFycmF5PyBnb3QgIiArIGEudG9TdHJpbmcoKSwKICAgICAgICAgICkKICAgICAgICAgIHZhciBkID0gYS5sZW5ndGgKICAgICAgICAgIGZvciAoYyA9IDA7IGMgPCBkOyArK2MpIChiID0gYVtjXSkgJiYgdGhpcy52aXNpdFN0bXQoYikKICAgICAgICB9CiAgICAgIH0KICAgICAgYy5wcm90b3R5cGUuU0VRRXhwciA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIsIGMKICAgICAgICBpZiAobnVsbCAhPT0gYSkgewogICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoCiAgICAgICAgICAgIFNrLmlzQXJyYXlMaWtlKGEpLAogICAgICAgICAgICAiU0VROiBub2RlcyBpc24ndCBhcnJheT8gZ290ICIgKyBhLnRvU3RyaW5nKCksCiAgICAgICAgICApCiAgICAgICAgICB2YXIgZCA9IGEubGVuZ3RoCiAgICAgICAgICBmb3IgKGMgPSAwOyBjIDwgZDsgKytjKSAoYiA9IGFbY10pICYmIHRoaXMudmlzaXRFeHByKGIpCiAgICAgICAgfQogICAgICB9CiAgICAgIGMucHJvdG90eXBlLmVudGVyQmxvY2sgPSBmdW5jdGlvbiAoYSwgYywgZCwgZSkgewogICAgICAgIGEgPSBTay5maXhSZXNlcnZlZE5hbWVzKGEpCiAgICAgICAgdmFyIGsgPSBudWxsCiAgICAgICAgdGhpcy5jdXIgJiYgKChrID0gdGhpcy5jdXIpLCB0aGlzLnN0YWNrLnB1c2godGhpcy5jdXIpKQogICAgICAgIHRoaXMuY3VyID0gbmV3IGIodGhpcywgYSwgYywgZCwgZSkKICAgICAgICAidG9wIiA9PT0gYSAmJiAodGhpcy5nbG9iYWwgPSB0aGlzLmN1ci5zeW1GbGFncykKICAgICAgICBrICYmIGsuY2hpbGRyZW4ucHVzaCh0aGlzLmN1cikKICAgICAgfQogICAgICBjLnByb3RvdHlwZS5leGl0QmxvY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5jdXIgPSBudWxsCiAgICAgICAgMCA8IHRoaXMuc3RhY2subGVuZ3RoICYmICh0aGlzLmN1ciA9IHRoaXMuc3RhY2sucG9wKCkpCiAgICAgIH0KICAgICAgYy5wcm90b3R5cGUudmlzaXRQYXJhbXMgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjCiAgICAgICAgZm9yIChjID0gMDsgYyA8IGEubGVuZ3RoOyArK2MpCiAgICAgICAgICBpZiAoKChiID0gYVtjXSksIGIuY29uc3RydWN0b3IgPT09IFNrLmFzdG5vZGVzLmFyZykpCiAgICAgICAgICAgIHRoaXMuYWRkRGVmKGIuYXJnLCA0LCBiLmxpbmVubykKICAgICAgICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgImludmFsaWQgZXhwcmVzc2lvbiBpbiBwYXJhbWV0ZXIgbGlzdCIsCiAgICAgICAgICAgICAgdGhpcy5maWxlbmFtZSwKICAgICAgICAgICAgKQogICAgICB9CiAgICAgIGMucHJvdG90eXBlLnZpc2l0QXJndW1lbnRzID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBhLmFyZ3MgJiYgdGhpcy52aXNpdFBhcmFtcyhhLmFyZ3MsICEwKQogICAgICAgIGEua3dvbmx5YXJncyAmJiB0aGlzLnZpc2l0UGFyYW1zKGEua3dvbmx5YXJncywgITApCiAgICAgICAgYS52YXJhcmcgJiYgKHRoaXMuYWRkRGVmKGEudmFyYXJnLmFyZywgNCwgYiksICh0aGlzLmN1ci52YXJhcmdzID0gITApKQogICAgICAgIGEua3dhcmcgJiYgKHRoaXMuYWRkRGVmKGEua3dhcmcuYXJnLCA0LCBiKSwgKHRoaXMuY3VyLnZhcmtleXdvcmRzID0gITApKQogICAgICB9CiAgICAgIGMucHJvdG90eXBlLm5ld1RtcG5hbWUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHRoaXMuYWRkRGVmKG5ldyBTay5idWlsdGluLnN0cigiX1siICsgKyt0aGlzLnRtcG5hbWUgKyAiXSIpLCAyLCBhKQogICAgICB9CiAgICAgIGMucHJvdG90eXBlLmFkZERlZiA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgdmFyIGQgPSBTay5tYW5nbGVOYW1lKHRoaXMuY3VyQ2xhc3MsIG5ldyBTay5idWlsdGluLnN0cihhKSkudgogICAgICAgIGQgPSBTay5maXhSZXNlcnZlZE5hbWVzKGQpCiAgICAgICAgdmFyIGUgPSB0aGlzLmN1ci5zeW1GbGFnc1tkXQogICAgICAgIGlmICh2b2lkIDAgIT09IGUpIHsKICAgICAgICAgIGlmIChiICYgNCAmJiBlICYgNCkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgImR1cGxpY2F0ZSBhcmd1bWVudCAnIiArIGEudiArICInIGluIGZ1bmN0aW9uIGRlZmluaXRpb24iLAogICAgICAgICAgICAgIHRoaXMuZmlsZW5hbWUsCiAgICAgICAgICAgICAgYywKICAgICAgICAgICAgKQogICAgICAgICAgZSB8PSBiCiAgICAgICAgfSBlbHNlIGUgPSBiCiAgICAgICAgdGhpcy5jdXIuc3ltRmxhZ3NbZF0gPSBlCiAgICAgICAgYiAmIDQKICAgICAgICAgID8gdGhpcy5jdXIudmFybmFtZXMucHVzaChkKQogICAgICAgICAgOiBiICYgMSAmJgogICAgICAgICAgICAoKGUgPSBiKSwKICAgICAgICAgICAgKGEgPSB0aGlzLmdsb2JhbFtkXSksCiAgICAgICAgICAgIHZvaWQgMCAhPT0gYSAmJiAoZSB8PSBhKSwKICAgICAgICAgICAgKHRoaXMuZ2xvYmFsW2RdID0gZSkpCiAgICAgIH0KICAgICAgYy5wcm90b3R5cGUudmlzaXRTbGljZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBzd2l0Y2ggKGEuY29uc3RydWN0b3IpIHsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuU2xpY2U6CiAgICAgICAgICAgIGEubG93ZXIgJiYgdGhpcy52aXNpdEV4cHIoYS5sb3dlcikKICAgICAgICAgICAgYS51cHBlciAmJiB0aGlzLnZpc2l0RXhwcihhLnVwcGVyKQogICAgICAgICAgICBhLnN0ZXAgJiYgdGhpcy52aXNpdEV4cHIoYS5zdGVwKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5FeHRTbGljZToKICAgICAgICAgICAgZm9yIChiID0gMDsgYiA8IGEuZGltcy5sZW5ndGg7ICsrYikgdGhpcy52aXNpdFNsaWNlKGEuZGltc1tiXSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuSW5kZXg6CiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGEudmFsdWUpCiAgICAgICAgfQogICAgICB9CiAgICAgIGMucHJvdG90eXBlLnZpc2l0U3RtdCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCh2b2lkIDAgIT09IGEsICJ2aXNpdFN0bXQgY2FsbGVkIHdpdGggdW5kZWZpbmVkIikKICAgICAgICBzd2l0Y2ggKGEuY29uc3RydWN0b3IpIHsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuRnVuY3Rpb25EZWY6CiAgICAgICAgICAgIHRoaXMuYWRkRGVmKGEubmFtZSwgMiwgYS5saW5lbm8pCiAgICAgICAgICAgIGEuYXJncy5kZWZhdWx0cyAmJiB0aGlzLlNFUUV4cHIoYS5hcmdzLmRlZmF1bHRzKQogICAgICAgICAgICBhLmRlY29yYXRvcl9saXN0ICYmIHRoaXMuU0VRRXhwcihhLmRlY29yYXRvcl9saXN0KQogICAgICAgICAgICB0aGlzLmVudGVyQmxvY2soYS5uYW1lLnYsICJmdW5jdGlvbiIsIGEsIGEubGluZW5vKQogICAgICAgICAgICB0aGlzLnZpc2l0QXJndW1lbnRzKGEuYXJncywgYS5saW5lbm8pCiAgICAgICAgICAgIHRoaXMuU0VRU3RtdChhLmJvZHkpCiAgICAgICAgICAgIHRoaXMuZXhpdEJsb2NrKCkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQ2xhc3NEZWY6CiAgICAgICAgICAgIHRoaXMuYWRkRGVmKGEubmFtZSwgMiwgYS5saW5lbm8pCiAgICAgICAgICAgIHRoaXMuU0VRRXhwcihhLmJhc2VzKQogICAgICAgICAgICBhLmRlY29yYXRvcl9saXN0ICYmIHRoaXMuU0VRRXhwcihhLmRlY29yYXRvcl9saXN0KQogICAgICAgICAgICB0aGlzLmVudGVyQmxvY2soYS5uYW1lLnYsICJjbGFzcyIsIGEsIGEubGluZW5vKQogICAgICAgICAgICB0aGlzLmN1ckNsYXNzID0gYS5uYW1lCiAgICAgICAgICAgIHRoaXMuU0VRU3RtdChhLmJvZHkpCiAgICAgICAgICAgIHRoaXMuZXhpdEJsb2NrKCkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuUmV0dXJuOgogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgYS52YWx1ZSAmJgogICAgICAgICAgICAgICh0aGlzLnZpc2l0RXhwcihhLnZhbHVlKSwKICAgICAgICAgICAgICAodGhpcy5jdXIucmV0dXJuc1ZhbHVlID0gITApLAogICAgICAgICAgICAgIHRoaXMuY3VyLmdlbmVyYXRvcikKICAgICAgICAgICAgKQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICAgIidyZXR1cm4nIHdpdGggYXJndW1lbnQgaW5zaWRlIGdlbmVyYXRvciIsCiAgICAgICAgICAgICAgICB0aGlzLmZpbGVuYW1lLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuRGVsZXRlOgogICAgICAgICAgICB0aGlzLlNFUUV4cHIoYS50YXJnZXRzKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5Bc3NpZ246CiAgICAgICAgICAgIHRoaXMuU0VRRXhwcihhLnRhcmdldHMpCiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGEudmFsdWUpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkFubkFzc2lnbjoKICAgICAgICAgICAgaWYgKGEudGFyZ2V0LmNvbnN0cnVjdG9yID09IFNrLmFzdG5vZGVzLk5hbWUpIHsKICAgICAgICAgICAgICB2YXIgYyA9IGEudGFyZ2V0CiAgICAgICAgICAgICAgdmFyIGUgPSBTay5tYW5nbGVOYW1lKHRoaXMuY3VyQ2xhc3MsIGMuaWQpLnYKICAgICAgICAgICAgICBlID0gU2suZml4UmVzZXJ2ZWROYW1lcyhlKQogICAgICAgICAgICAgIGMgPSB0aGlzLmN1ci5zeW1GbGFnc1tlXQogICAgICAgICAgICAgIGlmIChjICYgMjA0OSAmJiB0aGlzLmdsb2JhbCAhPSB0aGlzLmN1ci5zeW1GbGFncyAmJiBhLnNpbXBsZSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICAgICAiYW5ub3RhdGVkIG5hbWUgJyIgKyBlICsgIicgY2FuJ3QgYmUgZ2xvYmFsIiwKICAgICAgICAgICAgICAgICAgdGhpcy5maWxlbmFtZSwKICAgICAgICAgICAgICAgICAgYS5saW5lbm8sCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgYS5zaW1wbGUKICAgICAgICAgICAgICAgID8gdGhpcy5hZGREZWYobmV3IFNrLmJ1aWx0aW4uc3RyKGUpLCA0MDk4LCBhLmxpbmVubykKICAgICAgICAgICAgICAgIDogYS52YWx1ZSAmJiB0aGlzLmFkZERlZihuZXcgU2suYnVpbHRpbi5zdHIoZSksIDIsIGEubGluZW5vKQogICAgICAgICAgICB9IGVsc2UgdGhpcy52aXNpdEV4cHIoYS50YXJnZXQpCiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGEuYW5ub3RhdGlvbikKICAgICAgICAgICAgYS52YWx1ZSAmJiB0aGlzLnZpc2l0RXhwcihhLnZhbHVlKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5BdWdBc3NpZ246CiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGEudGFyZ2V0KQogICAgICAgICAgICB0aGlzLnZpc2l0RXhwcihhLnZhbHVlKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5QcmludDoKICAgICAgICAgICAgYS5kZXN0ICYmIHRoaXMudmlzaXRFeHByKGEuZGVzdCkKICAgICAgICAgICAgdGhpcy5TRVFFeHByKGEudmFsdWVzKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5Gb3I6CiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGEudGFyZ2V0KQogICAgICAgICAgICB0aGlzLnZpc2l0RXhwcihhLml0ZXIpCiAgICAgICAgICAgIHRoaXMuU0VRU3RtdChhLmJvZHkpCiAgICAgICAgICAgIGEub3JlbHNlICYmIHRoaXMuU0VRU3RtdChhLm9yZWxzZSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuV2hpbGU6CiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGEudGVzdCkKICAgICAgICAgICAgdGhpcy5TRVFTdG10KGEuYm9keSkKICAgICAgICAgICAgYS5vcmVsc2UgJiYgdGhpcy5TRVFTdG10KGEub3JlbHNlKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5JZjoKICAgICAgICAgICAgdGhpcy52aXNpdEV4cHIoYS50ZXN0KQogICAgICAgICAgICB0aGlzLlNFUVN0bXQoYS5ib2R5KQogICAgICAgICAgICBhLm9yZWxzZSAmJiB0aGlzLlNFUVN0bXQoYS5vcmVsc2UpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlJhaXNlOgogICAgICAgICAgICBhLmV4YyAmJgogICAgICAgICAgICAgICh0aGlzLnZpc2l0RXhwcihhLmV4YyksCiAgICAgICAgICAgICAgYS5pbnN0ICYmCiAgICAgICAgICAgICAgICAodGhpcy52aXNpdEV4cHIoYS5pbnN0KSwgYS50YmFjayAmJiB0aGlzLnZpc2l0RXhwcihhLnRiYWNrKSksCiAgICAgICAgICAgICAgYS5jYXVzZSAmJiB0aGlzLnZpc2l0RXhwcihhLmNhdXNlKSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQXNzZXJ0OgogICAgICAgICAgICB0aGlzLnZpc2l0RXhwcihhLnRlc3QpCiAgICAgICAgICAgIGEubXNnICYmIHRoaXMudmlzaXRFeHByKGEubXNnKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5JbXBvcnQ6CiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkltcG9ydEZyb206CiAgICAgICAgICAgIHRoaXMudmlzaXRBbGlhcyhhLm5hbWVzLCBhLmxpbmVubykKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuR2xvYmFsOgogICAgICAgICAgICB2YXIgZiA9IGEubmFtZXMubGVuZ3RoCiAgICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCBmOyArK2IpIHsKICAgICAgICAgICAgICBlID0gU2subWFuZ2xlTmFtZSh0aGlzLmN1ckNsYXNzLCBhLm5hbWVzW2JdKS52CiAgICAgICAgICAgICAgZSA9IFNrLmZpeFJlc2VydmVkTmFtZXMoZSkKICAgICAgICAgICAgICBjID0gdGhpcy5jdXIuc3ltRmxhZ3NbZV0KICAgICAgICAgICAgICBpZiAoYyAmIDEwKSB7CiAgICAgICAgICAgICAgICBpZiAoYyAmIDIpCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICAgICAgICJuYW1lICciICsgZSArICInIGlzIGFzc2lnbmVkIHRvIGJlZm9yZSBnbG9iYWwgZGVjbGFyYXRpb24iLAogICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgICAgYS5saW5lbm8sCiAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlN5bnRheEVycm9yKAogICAgICAgICAgICAgICAgICAibmFtZSAnIiArIGUgKyAiJyBpcyB1c2VkIHByaW9yIHRvIGdsb2JhbCBkZWNsYXJhdGlvbiIsCiAgICAgICAgICAgICAgICAgIHRoaXMuZmlsZW5hbWUsCiAgICAgICAgICAgICAgICAgIGEubGluZW5vLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLmFkZERlZihuZXcgU2suYnVpbHRpbi5zdHIoZSksIDEsIGEubGluZW5vKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkV4cHI6CiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGEudmFsdWUpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlBhc3M6CiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkJyZWFrOgogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5Db250aW51ZToKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuRGVidWdnZXI6CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLldpdGg6CiAgICAgICAgICAgIGQodGhpcy52aXNpdF93aXRoaXRlbS5iaW5kKHRoaXMpLCBhLml0ZW1zKQogICAgICAgICAgICBkKHRoaXMudmlzaXRTdG10LmJpbmQodGhpcyksIGEuYm9keSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuVHJ5OgogICAgICAgICAgICB0aGlzLlNFUVN0bXQoYS5ib2R5KQogICAgICAgICAgICB0aGlzLnZpc2l0RXhjZXB0aGFuZGxlcnMoYS5oYW5kbGVycykKICAgICAgICAgICAgdGhpcy5TRVFTdG10KGEub3JlbHNlKQogICAgICAgICAgICB0aGlzLlNFUVN0bXQoYS5maW5hbGJvZHkpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoCiAgICAgICAgICAgICAgIlVuaGFuZGxlZCB0eXBlICIgKyBhLmNvbnN0cnVjdG9yLm5hbWUgKyAiIGluIHZpc2l0U3RtdCIsCiAgICAgICAgICAgICkKICAgICAgICB9CiAgICAgIH0KICAgICAgYy5wcm90b3R5cGUudmlzaXRfd2l0aGl0ZW0gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHRoaXMudmlzaXRFeHByKGEuY29udGV4dF9leHByKQogICAgICAgIGEub3B0aW9uYWxfdmFycyAmJiB0aGlzLnZpc2l0RXhwcihhLm9wdGlvbmFsX3ZhcnMpCiAgICAgIH0KICAgICAgYy5wcm90b3R5cGUudmlzaXRFeHByID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCh2b2lkIDAgIT09IGEsICJ2aXNpdEV4cHIgY2FsbGVkIHdpdGggdW5kZWZpbmVkIikKICAgICAgICBzd2l0Y2ggKGEuY29uc3RydWN0b3IpIHsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQm9vbE9wOgogICAgICAgICAgICB0aGlzLlNFUUV4cHIoYS52YWx1ZXMpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkJpbk9wOgogICAgICAgICAgICB0aGlzLnZpc2l0RXhwcihhLmxlZnQpCiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGEucmlnaHQpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlVuYXJ5T3A6CiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGEub3BlcmFuZCkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTGFtYmRhOgogICAgICAgICAgICB0aGlzLmFkZERlZihuZXcgU2suYnVpbHRpbi5zdHIoImxhbWJkYSIpLCAyLCBhLmxpbmVubykKICAgICAgICAgICAgYS5hcmdzLmRlZmF1bHRzICYmIHRoaXMuU0VRRXhwcihhLmFyZ3MuZGVmYXVsdHMpCiAgICAgICAgICAgIHRoaXMuZW50ZXJCbG9jaygibGFtYmRhIiwgImZ1bmN0aW9uIiwgYSwgYS5saW5lbm8pCiAgICAgICAgICAgIHRoaXMudmlzaXRBcmd1bWVudHMoYS5hcmdzLCBhLmxpbmVubykKICAgICAgICAgICAgdGhpcy52aXNpdEV4cHIoYS5ib2R5KQogICAgICAgICAgICB0aGlzLmV4aXRCbG9jaygpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLklmRXhwOgogICAgICAgICAgICB0aGlzLnZpc2l0RXhwcihhLnRlc3QpCiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGEuYm9keSkKICAgICAgICAgICAgdGhpcy52aXNpdEV4cHIoYS5vcmVsc2UpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkRpY3Q6CiAgICAgICAgICAgIHRoaXMuU0VRRXhwcihhLmtleXMpCiAgICAgICAgICAgIHRoaXMuU0VRRXhwcihhLnZhbHVlcykKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuRGljdENvbXA6CiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlNldENvbXA6CiAgICAgICAgICAgIHRoaXMudmlzaXRDb21wcmVoZW5zaW9uKGEuZ2VuZXJhdG9ycywgMCkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTGlzdENvbXA6CiAgICAgICAgICAgIHRoaXMubmV3VG1wbmFtZShhLmxpbmVubykKICAgICAgICAgICAgdGhpcy52aXNpdEV4cHIoYS5lbHQpCiAgICAgICAgICAgIHRoaXMudmlzaXRDb21wcmVoZW5zaW9uKGEuZ2VuZXJhdG9ycywgMCkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuR2VuZXJhdG9yRXhwOgogICAgICAgICAgICB0aGlzLnZpc2l0R2VuZXhwKGEpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLllpZWxkOgogICAgICAgICAgICBhLnZhbHVlICYmIHRoaXMudmlzaXRFeHByKGEudmFsdWUpCiAgICAgICAgICAgIHRoaXMuY3VyLmdlbmVyYXRvciA9ICEwCiAgICAgICAgICAgIGlmICh0aGlzLmN1ci5yZXR1cm5zVmFsdWUpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgICAiJ3JldHVybicgd2l0aCBhcmd1bWVudCBpbnNpZGUgZ2VuZXJhdG9yIiwKICAgICAgICAgICAgICAgIHRoaXMuZmlsZW5hbWUsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5Db21wYXJlOgogICAgICAgICAgICB0aGlzLnZpc2l0RXhwcihhLmxlZnQpCiAgICAgICAgICAgIHRoaXMuU0VRRXhwcihhLmNvbXBhcmF0b3JzKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5DYWxsOgogICAgICAgICAgICB0aGlzLnZpc2l0RXhwcihhLmZ1bmMpCiAgICAgICAgICAgIGlmIChhLmFyZ3MpCiAgICAgICAgICAgICAgZm9yIChsZXQgYiBvZiBhLmFyZ3MpCiAgICAgICAgICAgICAgICBiLmNvbnN0cnVjdG9yID09PSBTay5hc3Rub2Rlcy5TdGFycmVkCiAgICAgICAgICAgICAgICAgID8gdGhpcy52aXNpdEV4cHIoYi52YWx1ZSkKICAgICAgICAgICAgICAgICAgOiB0aGlzLnZpc2l0RXhwcihiKQogICAgICAgICAgICBpZiAoYS5rZXl3b3JkcykgZm9yIChsZXQgYiBvZiBhLmtleXdvcmRzKSB0aGlzLnZpc2l0RXhwcihiLnZhbHVlKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5OdW06CiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlN0cjoKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQXR0cmlidXRlOgogICAgICAgICAgICB0aGlzLnZpc2l0RXhwcihhLnZhbHVlKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5TdWJzY3JpcHQ6CiAgICAgICAgICAgIHRoaXMudmlzaXRFeHByKGEudmFsdWUpCiAgICAgICAgICAgIHRoaXMudmlzaXRTbGljZShhLnNsaWNlKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5OYW1lOgogICAgICAgICAgICB0aGlzLmFkZERlZihhLmlkLCBhLmN0eCA9PT0gU2suYXN0bm9kZXMuTG9hZCA/IDggOiAyLCBhLmxpbmVubykKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTmFtZUNvbnN0YW50OgogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5MaXN0OgogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5UdXBsZToKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuU2V0OgogICAgICAgICAgICB0aGlzLlNFUUV4cHIoYS5lbHRzKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5TdGFycmVkOgogICAgICAgICAgICB0aGlzLnZpc2l0RXhwcihhLnZhbHVlKQogICAgICAgICAgICBicmVhawogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKAogICAgICAgICAgICAgICJVbmhhbmRsZWQgdHlwZSAiICsgYS5jb25zdHJ1Y3Rvci5uYW1lICsgIiBpbiB2aXNpdEV4cHIiLAogICAgICAgICAgICApCiAgICAgICAgfQogICAgICB9CiAgICAgIGMucHJvdG90eXBlLnZpc2l0Q29tcHJlaGVuc2lvbiA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIGMsCiAgICAgICAgICBkID0gYS5sZW5ndGgKICAgICAgICBmb3IgKGMgPSBiOyBjIDwgZDsgKytjKQogICAgICAgICAgKGIgPSBhW2NdKSwKICAgICAgICAgICAgdGhpcy52aXNpdEV4cHIoYi50YXJnZXQpLAogICAgICAgICAgICB0aGlzLnZpc2l0RXhwcihiLml0ZXIpLAogICAgICAgICAgICB0aGlzLlNFUUV4cHIoYi5pZnMpCiAgICAgIH0KICAgICAgYy5wcm90b3R5cGUudmlzaXRBbGlhcyA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIGMsIGQKICAgICAgICBmb3IgKGQgPSAwOyBkIDwgYS5sZW5ndGg7ICsrZCkgewogICAgICAgICAgdmFyIGUgPSBhW2RdCiAgICAgICAgICB2YXIgZiA9IChjID0gbnVsbCA9PT0gZS5hc25hbWUgPyBlLm5hbWUudiA6IGUuYXNuYW1lLnYpCiAgICAgICAgICBlID0gYy5pbmRleE9mKCIuIikKICAgICAgICAgIDstMSAhPT0gZSAmJiAoZiA9IGMuc3Vic3RyKDAsIGUpKQogICAgICAgICAgaWYgKCIqIiAhPT0gYykgdGhpcy5hZGREZWYobmV3IFNrLmJ1aWx0aW4uc3RyKGYpLCAxMDI0LCBiKQogICAgICAgICAgZWxzZSBpZiAoIm1vZHVsZSIgIT09IHRoaXMuY3VyLmJsb2NrVHlwZSkKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgImltcG9ydCAqIG9ubHkgYWxsb3dlZCBhdCBtb2R1bGUgbGV2ZWwiLAogICAgICAgICAgICAgIHRoaXMuZmlsZW5hbWUsCiAgICAgICAgICAgICkKICAgICAgICB9CiAgICAgIH0KICAgICAgYy5wcm90b3R5cGUudmlzaXRHZW5leHAgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0gYS5nZW5lcmF0b3JzWzBdCiAgICAgICAgdGhpcy52aXNpdEV4cHIoYi5pdGVyKQogICAgICAgIHRoaXMuZW50ZXJCbG9jaygiZ2VuZXhwciIsICJmdW5jdGlvbiIsIGEsIGEubGluZW5vKQogICAgICAgIHRoaXMuY3VyLmdlbmVyYXRvciA9ICEwCiAgICAgICAgdGhpcy5hZGREZWYobmV3IFNrLmJ1aWx0aW4uc3RyKCIuMCIpLCA0LCBhLmxpbmVubykKICAgICAgICB0aGlzLnZpc2l0RXhwcihiLnRhcmdldCkKICAgICAgICB0aGlzLlNFUUV4cHIoYi5pZnMpCiAgICAgICAgdGhpcy52aXNpdENvbXByZWhlbnNpb24oYS5nZW5lcmF0b3JzLCAxKQogICAgICAgIHRoaXMudmlzaXRFeHByKGEuZWx0KQogICAgICAgIHRoaXMuZXhpdEJsb2NrKCkKICAgICAgfQogICAgICBjLnByb3RvdHlwZS52aXNpdEV4Y2VwdGhhbmRsZXJzID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiwgYwogICAgICAgIGZvciAoYiA9IDA7IChjID0gYVtiXSk7ICsrYikKICAgICAgICAgIGMudHlwZSAmJiB0aGlzLnZpc2l0RXhwcihjLnR5cGUpLAogICAgICAgICAgICBjLm5hbWUgJiYgdGhpcy52aXNpdEV4cHIoYy5uYW1lKSwKICAgICAgICAgICAgdGhpcy5TRVFTdG10KGMuYm9keSkKICAgICAgfQogICAgICBjLnByb3RvdHlwZS5hbmFseXplQmxvY2sgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgewogICAgICAgIHZhciBrID0ge30KICAgICAgICB2YXIgZiA9IHt9LAogICAgICAgICAgbCA9IHt9LAogICAgICAgICAgZyA9IHt9LAogICAgICAgICAgaCA9IHt9CiAgICAgICAgImNsYXNzIiA9PSBhLmJsb2NrVHlwZSAmJiAoZShsLCBkKSwgYiAmJiBlKGcsIGIpKQogICAgICAgIGZvciAocCBpbiBhLnN5bUZsYWdzKSB7CiAgICAgICAgICB2YXIgbSA9IGEuc3ltRmxhZ3NbcF0KICAgICAgICAgIHRoaXMuYW5hbHl6ZU5hbWUoYSwgZiwgcCwgbSwgYiwgaywgYywgZCkKICAgICAgICB9CiAgICAgICAgImNsYXNzIiAhPT0gYS5ibG9ja1R5cGUgJiYKICAgICAgICAgICgiZnVuY3Rpb24iID09PSBhLmJsb2NrVHlwZSAmJiBlKGcsIGspLCBiICYmIGUoZywgYiksIGUobCwgZCkpCiAgICAgICAgayA9IHt9CiAgICAgICAgdmFyIHAgPSBhLmNoaWxkcmVuLmxlbmd0aAogICAgICAgIGZvciAobSA9IDA7IG0gPCBwOyArK20pCiAgICAgICAgICBpZiAoCiAgICAgICAgICAgICgoZCA9IGEuY2hpbGRyZW5bbV0pLAogICAgICAgICAgICB0aGlzLmFuYWx5emVDaGlsZEJsb2NrKGQsIGcsIGgsIGwsIGspLAogICAgICAgICAgICBkLmhhc0ZyZWUgfHwgZC5jaGlsZEhhc0ZyZWUpCiAgICAgICAgICApCiAgICAgICAgICAgIGEuY2hpbGRIYXNGcmVlID0gITAKICAgICAgICBlKGgsIGspCiAgICAgICAgImZ1bmN0aW9uIiA9PT0gYS5ibG9ja1R5cGUgJiYgdGhpcy5hbmFseXplQ2VsbHMoZiwgaCkKICAgICAgICBiID0gdGhpcy51cGRhdGVTeW1ib2xzKGEuc3ltRmxhZ3MsIGYsIGIsIGgsICJjbGFzcyIgPT09IGEuYmxvY2tUeXBlKQogICAgICAgIGEuaGFzRnJlZSA9IGEuaGFzRnJlZSB8fCBiCiAgICAgICAgZShjLCBoKQogICAgICB9CiAgICAgIGMucHJvdG90eXBlLmFuYWx5emVDaGlsZEJsb2NrID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGYpIHsKICAgICAgICB2YXIgayA9IHt9CiAgICAgICAgZShrLCBiKQogICAgICAgIGIgPSB7fQogICAgICAgIGUoYiwgYykKICAgICAgICBjID0ge30KICAgICAgICBlKGMsIGQpCiAgICAgICAgdGhpcy5hbmFseXplQmxvY2soYSwgaywgYiwgYykKICAgICAgICBlKGYsIGIpCiAgICAgIH0KICAgICAgYy5wcm90b3R5cGUuYW5hbHl6ZUNlbGxzID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB2YXIgYwogICAgICAgIGZvciAoYyBpbiBhKSB7CiAgICAgICAgICB2YXIgZCA9IGFbY10KICAgICAgICAgIDEgPT09IGQgJiYgdm9pZCAwICE9PSBiW2NdICYmICgoYVtjXSA9IDUpLCBkZWxldGUgYltjXSkKICAgICAgICB9CiAgICAgIH0KICAgICAgYy5wcm90b3R5cGUudXBkYXRlU3ltYm9scyA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgdmFyIGssCiAgICAgICAgICBmID0gITEKICAgICAgICBmb3IgKGsgaW4gYSkgewogICAgICAgICAgdmFyIGwgPSBhW2tdCiAgICAgICAgICB2YXIgZyA9IGJba10KICAgICAgICAgIGwgfD0gZyA8PCAxMQogICAgICAgICAgYVtrXSA9IGwKICAgICAgICB9CiAgICAgICAgZm9yIChrIGluIGQpCiAgICAgICAgICAoYiA9IGFba10pLAogICAgICAgICAgICB2b2lkIDAgIT09IGIKICAgICAgICAgICAgICA/IGUgJiYgYiAmIDEwMzEgJiYgKChiIHw9IDUxMiksIChhW2tdID0gYikpCiAgICAgICAgICAgICAgOiB2b2lkIDAgIT09IGNba10gJiYgKChhW2tdID0gODE5MiksIChmID0gITApKQogICAgICAgIHJldHVybiBmCiAgICAgIH0KICAgICAgYy5wcm90b3R5cGUuYW5hbHl6ZU5hbWUgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSwgZiwgcSwgbSkgewogICAgICAgIGlmIChkICYgMSkgewogICAgICAgICAgaWYgKGQgJiA0KQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgICAibmFtZSAnIiArIGMgKyAiJyBpcyBsb2NhbCBhbmQgZ2xvYmFsIiwKICAgICAgICAgICAgICB0aGlzLmZpbGVuYW1lLAogICAgICAgICAgICAgIGEubGluZW5vLAogICAgICAgICAgICApCiAgICAgICAgICBiW2NdID0gMgogICAgICAgICAgbVtjXSA9IG51bGwKICAgICAgICAgIGUgJiYgdm9pZCAwICE9PSBlW2NdICYmIGRlbGV0ZSBlW2NdCiAgICAgICAgfSBlbHNlCiAgICAgICAgICBkICYgMTAzMAogICAgICAgICAgICA/ICgoYltjXSA9IDEpLCAoZltjXSA9IG51bGwpLCBkZWxldGUgbVtjXSkKICAgICAgICAgICAgOiBlICYmIHZvaWQgMCAhPT0gZVtjXQogICAgICAgICAgICA/ICgoYltjXSA9IDQpLCAoYS5oYXNGcmVlID0gITApLCAocVtjXSA9IG51bGwpKQogICAgICAgICAgICA6ICgobSAmJiB2b2lkIDAgIT09IG1bY10pIHx8ICFhLmlzTmVzdGVkIHx8IChhLmhhc0ZyZWUgPSAhMCksCiAgICAgICAgICAgICAgKGJbY10gPSAzKSkKICAgICAgfQogICAgICBjLnByb3RvdHlwZS5hbmFseXplID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuYW5hbHl6ZUJsb2NrKHRoaXMudG9wLCBudWxsLCB7fSwge30pCiAgICAgIH0KICAgICAgU2suc3ltYm9sdGFibGUgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBkID0gbmV3IGMoYikKICAgICAgICBkLmVudGVyQmxvY2soInRvcCIsICJtb2R1bGUiLCBhLCAwKQogICAgICAgIGQudG9wID0gZC5jdXIKICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYS5ib2R5Lmxlbmd0aDsgKytiKSBkLnZpc2l0U3RtdChhLmJvZHlbYl0pCiAgICAgICAgZC5leGl0QmxvY2soKQogICAgICAgIGQuYW5hbHl6ZSgpCiAgICAgICAgcmV0dXJuIGQKICAgICAgfQogICAgICBTay5kdW1wU3ltdGFiID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgIHJldHVybiBhID8gIlRydWUiIDogIkZhbHNlIgogICAgICAgICAgfSwKICAgICAgICAgIGMgPSBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICB2YXIgYiwKICAgICAgICAgICAgICBjID0gW10KICAgICAgICAgICAgZm9yIChiID0gMDsgYiA8IGEubGVuZ3RoOyArK2IpCiAgICAgICAgICAgICAgYy5wdXNoKG5ldyBTay5idWlsdGluLnN0cihhW2JdKS4kcigpLnYpCiAgICAgICAgICAgIHJldHVybiAiWyIgKyBjLmpvaW4oIiwgIikgKyAiXSIKICAgICAgICAgIH0sCiAgICAgICAgICBkID0gZnVuY3Rpb24gKGEsIGUpIHsKICAgICAgICAgICAgdmFyIGssIGYKICAgICAgICAgICAgdm9pZCAwID09PSBlICYmIChlID0gIiIpCiAgICAgICAgICAgIHZhciBsID0gZSArICJTeW1fdHlwZTogIiArIGEuZ2V0X3R5cGUoKSArICJcbiIKICAgICAgICAgICAgbCArPSBlICsgIlN5bV9uYW1lOiAiICsgYS5nZXRfbmFtZSgpICsgIlxuIgogICAgICAgICAgICBsICs9IGUgKyAiU3ltX2xpbmVubzogIiArIGEuZ2V0X2xpbmVubygpICsgIlxuIgogICAgICAgICAgICBsICs9IGUgKyAiU3ltX25lc3RlZDogIiArIGIoYS5pc19uZXN0ZWQoKSkgKyAiXG4iCiAgICAgICAgICAgIGwgKz0gZSArICJTeW1faGFzY2hpbGRyZW46ICIgKyBiKGEuaGFzX2NoaWxkcmVuKCkpICsgIlxuIgogICAgICAgICAgICAiY2xhc3MiID09PSBhLmdldF90eXBlKCkKICAgICAgICAgICAgICA/IChsICs9IGUgKyAiQ2xhc3NfbWV0aG9kczogIiArIGMoYS5nZXRfbWV0aG9kcygpKSArICJcbiIpCiAgICAgICAgICAgICAgOiAiZnVuY3Rpb24iID09PSBhLmdldF90eXBlKCkgJiYKICAgICAgICAgICAgICAgICgobCArPSBlICsgIkZ1bmNfcGFyYW1zOiAiICsgYyhhLmdldF9wYXJhbWV0ZXJzKCkpICsgIlxuIiksCiAgICAgICAgICAgICAgICAobCArPSBlICsgIkZ1bmNfbG9jYWxzOiAiICsgYyhhLmdldF9sb2NhbHMoKSkgKyAiXG4iKSwKICAgICAgICAgICAgICAgIChsICs9IGUgKyAiRnVuY19nbG9iYWxzOiAiICsgYyhhLmdldF9nbG9iYWxzKCkpICsgIlxuIiksCiAgICAgICAgICAgICAgICAobCArPSBlICsgIkZ1bmNfZnJlZXM6ICIgKyBjKGEuZ2V0X2ZyZWVzKCkpICsgIlxuIikpCiAgICAgICAgICAgIGwgKz0gZSArICItLSBJZGVudGlmaWVycyAtLVxuIgogICAgICAgICAgICB2YXIgZyA9IGEuZ2V0X2lkZW50aWZpZXJzKCkKICAgICAgICAgICAgdmFyIGggPSBnLmxlbmd0aAogICAgICAgICAgICBmb3IgKGYgPSAwOyBmIDwgaDsgKytmKSB7CiAgICAgICAgICAgICAgdmFyIG4gPSBhLmxvb2t1cChnW2ZdKQogICAgICAgICAgICAgIGwgKz0gZSArICJuYW1lOiAiICsgbi5nZXRfbmFtZSgpICsgIlxuIgogICAgICAgICAgICAgIGwgKz0gZSArICIgIGlzX3JlZmVyZW5jZWQ6ICIgKyBiKG4uaXNfcmVmZXJlbmNlZCgpKSArICJcbiIKICAgICAgICAgICAgICBsICs9IGUgKyAiICBpc19pbXBvcnRlZDogIiArIGIobi5pc19pbXBvcnRlZCgpKSArICJcbiIKICAgICAgICAgICAgICBsICs9IGUgKyAiICBpc19wYXJhbWV0ZXI6ICIgKyBiKG4uaXNfcGFyYW1ldGVyKCkpICsgIlxuIgogICAgICAgICAgICAgIGwgKz0gZSArICIgIGlzX2dsb2JhbDogIiArIGIobi5pc19nbG9iYWwoKSkgKyAiXG4iCiAgICAgICAgICAgICAgbCArPQogICAgICAgICAgICAgICAgZSArICIgIGlzX2RlY2xhcmVkX2dsb2JhbDogIiArIGIobi5pc19kZWNsYXJlZF9nbG9iYWwoKSkgKyAiXG4iCiAgICAgICAgICAgICAgbCArPSBlICsgIiAgaXNfbG9jYWw6ICIgKyBiKG4uaXNfbG9jYWwoKSkgKyAiXG4iCiAgICAgICAgICAgICAgbCArPSBlICsgIiAgaXNfZnJlZTogIiArIGIobi5pc19mcmVlKCkpICsgIlxuIgogICAgICAgICAgICAgIGwgKz0gZSArICIgIGlzX2Fzc2lnbmVkOiAiICsgYihuLmlzX2Fzc2lnbmVkKCkpICsgIlxuIgogICAgICAgICAgICAgIGwgKz0gZSArICIgIGlzX25hbWVzcGFjZTogIiArIGIobi5pc19uYW1lc3BhY2UoKSkgKyAiXG4iCiAgICAgICAgICAgICAgdmFyIHIgPSBuLmdldF9uYW1lc3BhY2VzKCkKICAgICAgICAgICAgICB2YXIgbSA9IHIubGVuZ3RoCiAgICAgICAgICAgICAgbCArPSBlICsgIiAgbmFtZXNwYWNlczogW1xuIgogICAgICAgICAgICAgIHZhciBwID0gW10KICAgICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgbTsgKytrKSAobiA9IHJba10pLCBwLnB1c2goZChuLCBlICsgIiAgICAiKSkKICAgICAgICAgICAgICBsICs9IHAuam9pbigiXG4iKQogICAgICAgICAgICAgIGwgKz0gZSArICIgIF1cbiIKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbAogICAgICAgICAgfQogICAgICAgIHJldHVybiBkKGEudG9wLCAiIikKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLnN5bWJvbHRhYmxlIiwgU2suc3ltYm9sdGFibGUpCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suZHVtcFN5bXRhYiIsIFNrLmR1bXBTeW10YWIpCiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHApIHsKICAgICAgZnVuY3Rpb24gYShhLCBiLCBjLCBkLCBlKSB7CiAgICAgICAgdGhpcy5maWxlbmFtZSA9IGEKICAgICAgICB0aGlzLnN0ID0gYgogICAgICAgIHRoaXMuZmxhZ3MgPSBjCiAgICAgICAgdGhpcy5jYW5TdXNwZW5kID0gZAogICAgICAgIHRoaXMuaW50ZXJhY3RpdmUgPSAhMQogICAgICAgIHRoaXMubmVzdGxldmVsID0gMAogICAgICAgIHRoaXMudSA9IG51bGwKICAgICAgICB0aGlzLnN0YWNrID0gW10KICAgICAgICB0aGlzLnJlc3VsdCA9IFtdCiAgICAgICAgdGhpcy5hbGxVbml0cyA9IFtdCiAgICAgICAgdGhpcy5zb3VyY2UgPSBlID8gZS5zcGxpdCgiXG4iKSA6ICExCiAgICAgIH0KICAgICAgZnVuY3Rpb24gYigpIHsKICAgICAgICB0aGlzLm5hbWUgPSB0aGlzLnN0ZSA9IG51bGwKICAgICAgICB0aGlzLmRvZXNTdXNwZW5kID0gdGhpcy5jYW5TdXNwZW5kID0gITEKICAgICAgICB0aGlzLnByaXZhdGVfID0gbnVsbAogICAgICAgIHRoaXMubGluZW5vID0gdGhpcy5maXJzdGxpbmVubyA9IDAKICAgICAgICB0aGlzLmxpbmVub1NldCA9ICExCiAgICAgICAgdGhpcy5sb2NhbG5hbWVzID0gW10KICAgICAgICB0aGlzLmxvY2FsdGVtcHMgPSBbXQogICAgICAgIHRoaXMudGVtcHNUb1NhdmUgPSBbXQogICAgICAgIHRoaXMuYmxvY2tudW0gPSAwCiAgICAgICAgdGhpcy5ibG9ja3MgPSBbXQogICAgICAgIHRoaXMuY3VyYmxvY2sgPSAwCiAgICAgICAgdGhpcy5jb25zdHMgPSB7fQogICAgICAgIHRoaXMuc2NvcGVuYW1lID0gbnVsbAogICAgICAgIHRoaXMuc3VmZml4Q29kZSA9IHRoaXMuc3dpdGNoQ29kZSA9IHRoaXMudmFyRGVjbHNDb2RlID0gdGhpcy5wcmVmaXhDb2RlID0KICAgICAgICAgICIiCiAgICAgICAgdGhpcy5icmVha0Jsb2NrcyA9IFtdCiAgICAgICAgdGhpcy5jb250aW51ZUJsb2NrcyA9IFtdCiAgICAgICAgdGhpcy5leGNlcHRCbG9ja3MgPSBbXQogICAgICAgIHRoaXMuZmluYWxseUJsb2NrcyA9IFtdCiAgICAgIH0KICAgICAgZnVuY3Rpb24gYyhhKSB7CiAgICAgICAgcmV0dXJuICEwICE9PSBnW2FdID8gYSA6IGEgKyAiXyRydyQiCiAgICAgIH0KICAgICAgZnVuY3Rpb24gZChhKSB7CiAgICAgICAgcmV0dXJuIGhbYV0gPyBhICsgIl8kcm4kIiA6IGEKICAgICAgfQogICAgICBmdW5jdGlvbiBlKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IGIudgogICAgICAgIGlmICgKICAgICAgICAgIG51bGwgPT09IGEgfHwKICAgICAgICAgIG51bGwgPT09IGMgfHwKICAgICAgICAgICJfIiAhPT0gYy5jaGFyQXQoMCkgfHwKICAgICAgICAgICJfIiAhPT0gYy5jaGFyQXQoMSkgfHwKICAgICAgICAgICgiXyIgPT09IGMuY2hhckF0KGMubGVuZ3RoIC0gMSkgJiYgIl8iID09PSBjLmNoYXJBdChjLmxlbmd0aCAtIDIpKQogICAgICAgICkKICAgICAgICAgIHJldHVybiBiCiAgICAgICAgdmFyIGQgPSBhLnYKICAgICAgICBkLnJlcGxhY2UoL18vZywgIiIpCiAgICAgICAgaWYgKCIiID09PSBkKSByZXR1cm4gYgogICAgICAgIGQgPSBhLnYKICAgICAgICBkLnJlcGxhY2UoL15fKi8sICIiKQogICAgICAgIHJldHVybiAoZCA9IG5ldyBTay5idWlsdGluLnN0cigiXyIgKyBkICsgYykpCiAgICAgIH0KICAgICAgdmFyIGYKICAgICAgU2suZ2Vuc3ltY291bnQgPSAwCiAgICAgIGIucHJvdG90eXBlLmFjdGl2YXRlU2NvcGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzCiAgICAgICAgZiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBiLAogICAgICAgICAgICBjID0gYS5ibG9ja3NbYS5jdXJibG9ja10KICAgICAgICAgIGlmIChudWxsID09PSBjLl9uZXh0KQogICAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYXJndW1lbnRzLmxlbmd0aDsgKytiKSBjLnB1c2goYXJndW1lbnRzW2JdKQogICAgICAgIH0KICAgICAgfQogICAgICBhLnByb3RvdHlwZS5nZXRTb3VyY2VMaW5lID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCh0aGlzLnNvdXJjZSkKICAgICAgICByZXR1cm4gdGhpcy5zb3VyY2VbYSAtIDFdCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuYW5ub3RhdGVTb3VyY2UgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiCiAgICAgICAgaWYgKHRoaXMuc291cmNlKSB7CiAgICAgICAgICB2YXIgYyA9IGEubGluZW5vCiAgICAgICAgICB2YXIgZCA9IGEuY29sX29mZnNldAogICAgICAgICAgZigiXG4vL1xuLy8gbGluZSAiLCBjLCAiOlxuLy8gIiwgdGhpcy5nZXRTb3VyY2VMaW5lKGMpLCAiXG4vLyAiKQogICAgICAgICAgZm9yIChiID0gMDsgYiA8IGQ7ICsrYikgZigiICIpCiAgICAgICAgICBmKCJeXG4vL1xuIikKICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KHZvaWQgMCAhPT0gYS5saW5lbm8gJiYgdm9pZCAwICE9PSBhLmNvbF9vZmZzZXQpCiAgICAgICAgICBmKCIkY3VyckxpbmVObyA9ICIsIGMsICI7XG4kY3VyckNvbE5vID0gIiwgZCwgIjtcblxuIikKICAgICAgICB9CiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuZ2Vuc3ltID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gKGEgPSAiJCIgKyAoYSB8fCAiIikgKyBTay5nZW5zeW1jb3VudCsrKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLm5pY2VOYW1lID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5nZW5zeW0oCiAgICAgICAgICBhLnJlcGxhY2UoIjwiLCAiIikucmVwbGFjZSgiPiIsICIiKS5yZXBsYWNlKCIgIiwgIl8iKSwKICAgICAgICApCiAgICAgIH0KICAgICAgdmFyIGcgPSB7CiAgICAgICAgICBhYnN0cmFjdDogITAsCiAgICAgICAgICBhczogITAsCiAgICAgICAgICBib29sZWFuOiAhMCwKICAgICAgICAgIGJyZWFrOiAhMCwKICAgICAgICAgIGJ5dGU6ICEwLAogICAgICAgICAgY2FzZTogITAsCiAgICAgICAgICBjYXRjaDogITAsCiAgICAgICAgICBjaGFyOiAhMCwKICAgICAgICAgIGNsYXNzOiAhMCwKICAgICAgICAgIGNvbnRpbnVlOiAhMCwKICAgICAgICAgIGNvbnN0OiAhMCwKICAgICAgICAgIGRlYnVnZ2VyOiAhMCwKICAgICAgICAgIGRlZmF1bHQ6ICEwLAogICAgICAgICAgZGVsZXRlOiAhMCwKICAgICAgICAgIGRvOiAhMCwKICAgICAgICAgIGRvdWJsZTogITAsCiAgICAgICAgICBlbHNlOiAhMCwKICAgICAgICAgIGVudW06ICEwLAogICAgICAgICAgZXhwb3J0OiAhMCwKICAgICAgICAgIGV4dGVuZHM6ICEwLAogICAgICAgICAgZmFsc2U6ICEwLAogICAgICAgICAgZmluYWw6ICEwLAogICAgICAgICAgZmluYWxseTogITAsCiAgICAgICAgICBmbG9hdDogITAsCiAgICAgICAgICBmb3I6ICEwLAogICAgICAgICAgZnVuY3Rpb246ICEwLAogICAgICAgICAgZ290bzogITAsCiAgICAgICAgICBpZjogITAsCiAgICAgICAgICBpbXBsZW1lbnRzOiAhMCwKICAgICAgICAgIGltcG9ydDogITAsCiAgICAgICAgICBpbjogITAsCiAgICAgICAgICBpbnN0YW5jZW9mOiAhMCwKICAgICAgICAgIGludDogITAsCiAgICAgICAgICBpbnRlcmZhY2U6ICEwLAogICAgICAgICAgaXM6ICEwLAogICAgICAgICAgbG9uZzogITAsCiAgICAgICAgICBuYW1lc3BhY2U6ICEwLAogICAgICAgICAgbmF0aXZlOiAhMCwKICAgICAgICAgIG5ldzogITAsCiAgICAgICAgICBudWxsOiAhMCwKICAgICAgICAgIHBhY2thZ2U6ICEwLAogICAgICAgICAgcHJpdmF0ZTogITAsCiAgICAgICAgICBwcm90ZWN0ZWQ6ICEwLAogICAgICAgICAgcHVibGljOiAhMCwKICAgICAgICAgIHJldHVybjogITAsCiAgICAgICAgICBzaG9ydDogITAsCiAgICAgICAgICBzdGF0aWM6ICEwLAogICAgICAgICAgc3VwZXI6ICExLAogICAgICAgICAgc3dpdGNoOiAhMCwKICAgICAgICAgIHN5bmNocm9uaXplZDogITAsCiAgICAgICAgICB0aGlzOiAhMCwKICAgICAgICAgIHRocm93OiAhMCwKICAgICAgICAgIHRocm93czogITAsCiAgICAgICAgICB0cmFuc2llbnQ6ICEwLAogICAgICAgICAgdHJ1ZTogITAsCiAgICAgICAgICB0cnk6ICEwLAogICAgICAgICAgdHlwZW9mOiAhMCwKICAgICAgICAgIHVzZTogITAsCiAgICAgICAgICB2YXI6ICEwLAogICAgICAgICAgdm9pZDogITAsCiAgICAgICAgICB2b2xhdGlsZTogITAsCiAgICAgICAgICB3aGlsZTogITAsCiAgICAgICAgICB3aXRoOiAhMCwKICAgICAgICB9LAogICAgICAgIGggPSB7CiAgICAgICAgICBfX2RlZmluZUdldHRlcl9fOiAhMCwKICAgICAgICAgIF9fZGVmaW5lU2V0dGVyX186ICEwLAogICAgICAgICAgYXBwbHk6ICEwLAogICAgICAgICAgY2FsbDogITAsCiAgICAgICAgICBldmFsOiAhMCwKICAgICAgICAgIGhhc093blByb3BlcnR5OiAhMCwKICAgICAgICAgIGlzUHJvdG90eXBlT2Y6ICEwLAogICAgICAgICAgX19sb29rdXBHZXR0ZXJfXzogITAsCiAgICAgICAgICBfX2xvb2t1cFNldHRlcl9fOiAhMCwKICAgICAgICAgIF9fbm9TdWNoTWV0aG9kX186ICEwLAogICAgICAgICAgcHJvcGVydHlJc0VudW1lcmFibGU6ICEwLAogICAgICAgICAgdG9Tb3VyY2U6ICEwLAogICAgICAgICAgdG9Mb2NhbGVTdHJpbmc6ICEwLAogICAgICAgICAgdG9TdHJpbmc6ICEwLAogICAgICAgICAgdW53YXRjaDogITAsCiAgICAgICAgICB2YWx1ZU9mOiAhMCwKICAgICAgICAgIHdhdGNoOiAhMCwKICAgICAgICAgIGxlbmd0aDogITAsCiAgICAgICAgICBuYW1lOiAhMCwKICAgICAgICB9CiAgICAgIGEucHJvdG90eXBlLm1ha2VDb25zdGFudCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIsCiAgICAgICAgICBjID0gIiIKICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYXJndW1lbnRzLmxlbmd0aDsgKytiKSBjICs9IGFyZ3VtZW50c1tiXQogICAgICAgIGZvciAoZCBpbiB0aGlzLnUuY29uc3RzKQogICAgICAgICAgaWYgKAogICAgICAgICAgICB0aGlzLnUuY29uc3RzLmhhc093blByb3BlcnR5KGQpICYmCiAgICAgICAgICAgICgoYiA9IHRoaXMudS5jb25zdHNbZF0pLCBiID09IGMpCiAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiBkCiAgICAgICAgdmFyIGQgPSB0aGlzLnUuc2NvcGVuYW1lICsgIi4iICsgdGhpcy5nZW5zeW0oImNvbnN0IikKICAgICAgICB0aGlzLnUuY29uc3RzW2RdID0gYwogICAgICAgIHJldHVybiBkCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuX2dyID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB2YXIgYywKICAgICAgICAgIGQgPSB0aGlzLmdlbnN5bShhKQogICAgICAgIHRoaXMudS5sb2NhbHRlbXBzLnB1c2goZCkKICAgICAgICBmKCJ2YXIgIiwgZCwgIj0iKQogICAgICAgIGZvciAoYyA9IDE7IGMgPCBhcmd1bWVudHMubGVuZ3RoOyArK2MpIGYoYXJndW1lbnRzW2NdKQogICAgICAgIGYoIjsiKQogICAgICAgIHJldHVybiBkCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUub3V0cHV0SW50ZXJydXB0VGVzdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgYSA9ICIiCiAgICAgICAgaWYgKAogICAgICAgICAgbnVsbCAhPT0gU2suZXhlY0xpbWl0IHx8CiAgICAgICAgICAobnVsbCAhPT0gU2sueWllbGRMaW1pdCAmJiB0aGlzLnUuY2FuU3VzcGVuZCkKICAgICAgICApCiAgICAgICAgICAoYSArPSAidmFyICRkYXRlTm93ID0gRGF0ZS5ub3coKTsiKSwKICAgICAgICAgICAgbnVsbCAhPT0gU2suZXhlY0xpbWl0ICYmCiAgICAgICAgICAgICAgKGEgKz0KICAgICAgICAgICAgICAgICJpZiAoJGRhdGVOb3cgLSBTay5leGVjU3RhcnQgPiBTay5leGVjTGltaXQpIHt0aHJvdyBuZXcgU2suYnVpbHRpbi5UaW1lTGltaXRFcnJvcihTay50aW1lb3V0TXNnKCkpfSIpLAogICAgICAgICAgICBudWxsICE9PSBTay55aWVsZExpbWl0ICYmCiAgICAgICAgICAgICAgdGhpcy51LmNhblN1c3BlbmQgJiYKICAgICAgICAgICAgICAoKGEgPQogICAgICAgICAgICAgICAgYSArCiAgICAgICAgICAgICAgICAiaWYgKCRkYXRlTm93IC0gU2subGFzdFlpZWxkID4gU2sueWllbGRMaW1pdCkgeyIgKwogICAgICAgICAgICAgICAgKCJ2YXIgJHN1c3AgPSAkc2F2ZVN1c3BlbnNpb24oe2RhdGE6IHt0eXBlOiAnU2sueWllbGQnfSwgcmVzdW1lOiBmdW5jdGlvbigpIHt9fSwgJyIgKwogICAgICAgICAgICAgICAgICB0aGlzLmZpbGVuYW1lICsKICAgICAgICAgICAgICAgICAgIicsJGN1cnJMaW5lTm8sJGN1cnJDb2xObyk7IikpLAogICAgICAgICAgICAgIChhICs9ICIkc3VzcC4kYmxrID0gJGJsazskc3VzcC5vcHRpb25hbCA9IHRydWU7cmV0dXJuICRzdXNwO30iKSwKICAgICAgICAgICAgICAodGhpcy51LmRvZXNTdXNwZW5kID0gITApKQogICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuX2p1bXBmYWxzZSA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgYSA9IHRoaXMuX2dyKAogICAgICAgICAgImpmYWxzZSIsCiAgICAgICAgICAiKCIsCiAgICAgICAgICBhLAogICAgICAgICAgIj09PWZhbHNlfHwhU2subWlzY2V2YWwuaXNUcnVlKCIsCiAgICAgICAgICBhLAogICAgICAgICAgIikpIiwKICAgICAgICApCiAgICAgICAgZigiaWYoIiwgYSwgIil7Lyp0ZXN0IGZhaWxlZCAqLyRibGs9IiwgYiwgIjtjb250aW51ZTt9IikKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5fanVtcHVuZGVmID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBmKCJpZigiLCBhLCAiPT09dW5kZWZpbmVkKXskYmxrPSIsIGIsICI7Y29udGludWU7fSIpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuX2p1bXBub3R1bmRlZiA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgZigiaWYoIiwgYSwgIiE9PXVuZGVmaW5lZCl7JGJsaz0iLCBiLCAiO2NvbnRpbnVlO30iKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLl9qdW1wdHJ1ZSA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgYSA9IHRoaXMuX2dyKCJqdHJ1ZSIsICIoIiwgYSwgIj09PXRydWV8fFNrLm1pc2NldmFsLmlzVHJ1ZSgiLCBhLCAiKSkiKQogICAgICAgIGYoImlmKCIsIGEsICIpey8qdGVzdCBwYXNzZWQgKi8kYmxrPSIsIGIsICI7Y29udGludWU7fSIpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuX2p1bXAgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIG51bGwgPT09IHRoaXMudS5ibG9ja3NbdGhpcy51LmN1cmJsb2NrXS5fbmV4dCAmJgogICAgICAgICAgKGYoIiRibGs9IiwgYSwgIjsiKSwgKHRoaXMudS5ibG9ja3NbdGhpcy51LmN1cmJsb2NrXS5fbmV4dCA9IGEpKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLl9jaGVja1N1c3BlbnNpb24gPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICh0aGlzLnUuY2FuU3VzcGVuZCkgewogICAgICAgICAgdmFyIGIgPSB0aGlzLm5ld0Jsb2NrKCJmdW5jdGlvbiByZXR1cm4gb3IgcmVzdW1lIHN1c3BlbnNpb24iKQogICAgICAgICAgdGhpcy5fanVtcChiKQogICAgICAgICAgdGhpcy5zZXRCbG9jayhiKQogICAgICAgICAgYSA9IGEgfHwgeyBsaW5lbm86ICIkY3VyckxpbmVObyIsIGNvbF9vZmZzZXQ6ICIkY3VyckNvbE5vIiB9CiAgICAgICAgICBmKAogICAgICAgICAgICAiaWYgKCRyZXQgJiYgJHJldC4kaXNTdXNwZW5zaW9uKSB7IHJldHVybiAkc2F2ZVN1c3BlbnNpb24oJHJldCwnIiArCiAgICAgICAgICAgICAgdGhpcy5maWxlbmFtZSArCiAgICAgICAgICAgICAgIicsIiArCiAgICAgICAgICAgICAgYS5saW5lbm8gKwogICAgICAgICAgICAgICIsIiArCiAgICAgICAgICAgICAgYS5jb2xfb2Zmc2V0ICsKICAgICAgICAgICAgICAiKTsgfSIsCiAgICAgICAgICApCiAgICAgICAgICB0aGlzLnUuZG9lc1N1c3BlbmQgPSAhMAogICAgICAgICAgdGhpcy51LnRlbXBzVG9TYXZlID0gdGhpcy51LnRlbXBzVG9TYXZlLmNvbmNhdCh0aGlzLnUubG9jYWx0ZW1wcykKICAgICAgICB9IGVsc2UKICAgICAgICAgIGYoCiAgICAgICAgICAgICJpZiAoJHJldCAmJiAkcmV0LiRpc1N1c3BlbnNpb24pIHsgJHJldCA9IFNrLm1pc2NldmFsLnJldHJ5T3B0aW9uYWxTdXNwZW5zaW9uT3JUaHJvdygkcmV0KTsgfSIsCiAgICAgICAgICApCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY3VucGFja3N0YXJzdG9hcnJheSA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgaWYgKCFhIHx8IDAgPT0gYS5sZW5ndGgpIHJldHVybiAiW10iCiAgICAgICAgbGV0IGMgPSAhMQogICAgICAgIGZvciAobGV0IGQgb2YgYSkgewogICAgICAgICAgaWYgKGIgJiYgYykKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgIkV4dGVuZGVkIGFyZ3VtZW50IHVucGFja2luZyBpcyBub3QgcGVybWl0dGVkIGluIFB5dGhvbiAyIiwKICAgICAgICAgICAgKQogICAgICAgICAgZC5jb25zdHJ1Y3RvciA9PT0gU2suYXN0bm9kZXMuU3RhcnJlZCAmJiAoYyA9ICEwKQogICAgICAgIH0KICAgICAgICBpZiAoYykgewogICAgICAgICAgYiA9IHRoaXMuX2dyKCJ1bnBhY2siLCAiW10iKQogICAgICAgICAgZm9yIChsZXQgYyBvZiBhKQogICAgICAgICAgICBjLmNvbnN0cnVjdG9yICE9PSBTay5hc3Rub2Rlcy5TdGFycmVkCiAgICAgICAgICAgICAgPyBmKGIsICIucHVzaCgiLCB0aGlzLnZleHByKGMpLCAiKTsiKQogICAgICAgICAgICAgIDogKGYoCiAgICAgICAgICAgICAgICAgICIkcmV0ID0gU2subWlzY2V2YWwuaXRlckZvcihTay5hYnN0ci5pdGVyKCIsCiAgICAgICAgICAgICAgICAgIHRoaXMudmV4cHIoYy52YWx1ZSksCiAgICAgICAgICAgICAgICAgICIpLCBmdW5jdGlvbihlKSB7ICIsCiAgICAgICAgICAgICAgICAgIGIsCiAgICAgICAgICAgICAgICAgICIucHVzaChlKTsgfSk7IiwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICB0aGlzLl9jaGVja1N1c3BlbnNpb24oKSkKICAgICAgICAgIHJldHVybiBiCiAgICAgICAgfQogICAgICAgIHJldHVybiAiWyIgKyBhLm1hcCgoYSkgPT4gdGhpcy52ZXhwcihhKSkuam9pbigiLCIpICsgIl0iCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY3R1cGxlbGlzdG9yc2V0ID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgidHVwbGUiID09PSBjIHx8ICJsaXN0IiA9PT0gYyB8fCAic2V0IiA9PT0gYykKICAgICAgICB2YXIgZCA9ICExCiAgICAgICAgZm9yIChrIG9mIGEuZWx0cykKICAgICAgICAgIGlmIChrLmNvbnN0cnVjdG9yID09PSBTay5hc3Rub2Rlcy5TdGFycmVkKSB7CiAgICAgICAgICAgIGQgPSAhMAogICAgICAgICAgICBicmVhawogICAgICAgICAgfQogICAgICAgIGlmIChhLmN0eCA9PT0gU2suYXN0bm9kZXMuU3RvcmUpIHsKICAgICAgICAgIGlmIChkKQogICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgICAiVHVwbGUgdW5wYWNraW5nIHdpdGggc3RhcnMgaXMgbm90IHN1cHBvcnRlZCIsCiAgICAgICAgICAgICkKICAgICAgICAgIGQgPSB0aGlzLl9ncigKICAgICAgICAgICAgIml0ZW1zIiwKICAgICAgICAgICAgIlNrLmFic3RyLnNlcXVlbmNlVW5wYWNrKCIgKyBiICsgIiwiICsgYS5lbHRzLmxlbmd0aCArICIpIiwKICAgICAgICAgICkKICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCBhLmVsdHMubGVuZ3RoOyArK2IpCiAgICAgICAgICAgIHRoaXMudmV4cHIoYS5lbHRzW2JdLCBkICsgIlsiICsgYiArICJdIikKICAgICAgICB9IGVsc2UgaWYgKGEuY3R4ID09PSBTay5hc3Rub2Rlcy5Mb2FkIHx8ICJzZXQiID09PSBjKSB7CiAgICAgICAgICBpZiAoZCkgewogICAgICAgICAgICBpZiAoIVNrLl9fZnV0dXJlX18ucHl0aG9uMykKICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgICAgICJMaXN0IHBhY2tpbmcgd2l0aCBzdGFycyBpcyBub3Qgc3VwcG9ydGVkIGluIFB5dGhvbiAyIiwKICAgICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ncigKICAgICAgICAgICAgICAibG9hZCIgKyBjLAogICAgICAgICAgICAgICJuZXcgU2suYnVpbHRpbnNbJyIsCiAgICAgICAgICAgICAgYywKICAgICAgICAgICAgICAiJ10oIiwKICAgICAgICAgICAgICB0aGlzLmN1bnBhY2tzdGFyc3RvYXJyYXkoYS5lbHRzKSwKICAgICAgICAgICAgICAiKSIsCiAgICAgICAgICAgICkKICAgICAgICAgIH0KICAgICAgICAgIGlmICgidHVwbGUiID09PSBjKSB7CiAgICAgICAgICAgIHZhciBlID0gITAKICAgICAgICAgICAgZCA9IFtdCiAgICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCBhLmVsdHMubGVuZ3RoOyArK2IpIHsKICAgICAgICAgICAgICB2YXIgayA9IHRoaXMudmV4cHIoYS5lbHRzW2JdKQogICAgICAgICAgICAgIGUgJiYgLTEgPT0gay5pbmRleE9mKCIkY29uc3QiKSAmJiAoZSA9ICExKQogICAgICAgICAgICAgIGQucHVzaChrKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlKSByZXR1cm4gdGhpcy5tYWtlQ29uc3RhbnQoIm5ldyBTay5idWlsdGluLnR1cGxlKFsiICsgZCArICJdKSIpCiAgICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCBkLmxlbmd0aDsgKytiKSBkW2JdID0gdGhpcy5fZ3IoImVsZW0iLCBkW2JdKQogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ3IoImxvYWQiICsgYywgIm5ldyBTay5idWlsdGluc1snIiwgYywgIiddKFsiLCBkLCAiXSkiKQogICAgICAgICAgfQogICAgICAgICAgZCA9IFtdCiAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYS5lbHRzLmxlbmd0aDsgKytiKQogICAgICAgICAgICBkLnB1c2godGhpcy5fZ3IoImVsZW0iLCB0aGlzLnZleHByKGEuZWx0c1tiXSkpKQogICAgICAgICAgcmV0dXJuIHRoaXMuX2dyKCJsb2FkIiArIGMsICJuZXcgU2suYnVpbHRpbnNbJyIsIGMsICInXShbIiwgZCwgIl0pIikKICAgICAgICB9CiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY2RpY3QgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiCiAgICAgICAgdmFyIGMgPSBbXQogICAgICAgIGlmIChudWxsICE9PSBhLmtleXMpCiAgICAgICAgICBmb3IgKAogICAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydChhLnZhbHVlcy5sZW5ndGggPT09IGEua2V5cy5sZW5ndGgpLCBiID0gMDsKICAgICAgICAgICAgYiA8IGEudmFsdWVzLmxlbmd0aDsKICAgICAgICAgICAgKytiCiAgICAgICAgICApIHsKICAgICAgICAgICAgdmFyIGQgPSB0aGlzLnZleHByKGEudmFsdWVzW2JdKQogICAgICAgICAgICBjLnB1c2godGhpcy52ZXhwcihhLmtleXNbYl0pKQogICAgICAgICAgICBjLnB1c2goZCkKICAgICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5fZ3IoImxvYWRkaWN0IiwgIm5ldyBTay5idWlsdGluc1snZGljdCddKFsiLCBjLCAiXSkiKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNsaXN0Y29tcCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoYSBpbnN0YW5jZW9mIFNrLmFzdG5vZGVzLkxpc3RDb21wKQogICAgICAgIHZhciBiID0gdGhpcy5fZ3IoIl9jb21wciIsICJuZXcgU2suYnVpbHRpbnNbJ2xpc3QnXShbXSkiKQogICAgICAgIHJldHVybiB0aGlzLmNjb21wZ2VuKCJsaXN0IiwgYiwgYS5nZW5lcmF0b3JzLCAwLCBhLmVsdCwgbnVsbCwgYSkKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jZGljdGNvbXAgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KGEgaW5zdGFuY2VvZiBTay5hc3Rub2Rlcy5EaWN0Q29tcCkKICAgICAgICB2YXIgYiA9IHRoaXMuX2dyKCJfZGNvbXByIiwgIm5ldyBTay5idWlsdGlucy5kaWN0KFtdKSIpCiAgICAgICAgcmV0dXJuIHRoaXMuY2NvbXBnZW4oImRpY3QiLCBiLCBhLmdlbmVyYXRvcnMsIDAsIGEudmFsdWUsIGEua2V5LCBhKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNzZXRjb21wID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChhIGluc3RhbmNlb2YgU2suYXN0bm9kZXMuU2V0Q29tcCkKICAgICAgICB2YXIgYiA9IHRoaXMuX2dyKCJfc2V0Y29tcHIiLCAibmV3IFNrLmJ1aWx0aW5zLnNldChbXSkiKQogICAgICAgIHJldHVybiB0aGlzLmNjb21wZ2VuKCJzZXQiLCBiLCBhLmdlbmVyYXRvcnMsIDAsIGEuZWx0LCBudWxsLCBhKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNjb21wZ2VuID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUsIGcsIGgpIHsKICAgICAgICB2YXIgayA9IHRoaXMubmV3QmxvY2soYSArICIgY29tcCBzdGFydCIpLAogICAgICAgICAgbCA9IHRoaXMubmV3QmxvY2soYSArICIgY29tcCBza2lwIiksCiAgICAgICAgICBuID0gdGhpcy5uZXdCbG9jayhhICsgIiBjb21wIGFuY2hvciIpLAogICAgICAgICAgciA9IGNbZF0sCiAgICAgICAgICBxID0gdGhpcy52ZXhwcihyLml0ZXIpCiAgICAgICAgcSA9IHRoaXMuX2dyKCJpdGVyIiwgIlNrLmFic3RyLml0ZXIoIiwgcSwgIikiKQogICAgICAgIHZhciBtCiAgICAgICAgdGhpcy5fanVtcChrKQogICAgICAgIHRoaXMuc2V0QmxvY2soaykKICAgICAgICBmKCIkcmV0ID0gU2suYWJzdHIuaXRlcm5leHQoIiwgcSwgIiwgdHJ1ZSk7IikKICAgICAgICB0aGlzLl9jaGVja1N1c3BlbnNpb24oaCkKICAgICAgICBxID0gdGhpcy5fZ3IoIm5leHQiLCAiJHJldCIpCiAgICAgICAgdGhpcy5fanVtcHVuZGVmKHEsIG4pCiAgICAgICAgdGhpcy52ZXhwcihyLnRhcmdldCwgcSkKICAgICAgICB2YXIgcCA9IHIuaWZzID8gci5pZnMubGVuZ3RoIDogMAogICAgICAgIGZvciAobSA9IDA7IG0gPCBwOyArK20pCiAgICAgICAgICAocSA9IHRoaXMudmV4cHIoci5pZnNbbV0pKSwgdGhpcy5fanVtcGZhbHNlKHEsIGspCiAgICAgICAgKytkIDwgYy5sZW5ndGggJiYgdGhpcy5jY29tcGdlbihhLCBiLCBjLCBkLCBlLCBnLCBoKQogICAgICAgIGQgPj0gYy5sZW5ndGggJiYKICAgICAgICAgICgoYyA9IHRoaXMudmV4cHIoZSkpLAogICAgICAgICAgImRpY3QiID09PSBhCiAgICAgICAgICAgID8gKChhID0gdGhpcy52ZXhwcihnKSksIGYoYiwgIi5tcCRhc3Nfc3Vic2NyaXB0KCIsIGEsICIsIiwgYywgIik7IikpCiAgICAgICAgICAgIDogImxpc3QiID09PSBhCiAgICAgICAgICAgID8gZihiLCAiLnYucHVzaCgiLCBjLCAiKTsiKQogICAgICAgICAgICA6ICJzZXQiID09PSBhICYmIGYoYiwgIi52Lm1wJGFzc19zdWJzY3JpcHQoIiwgYywgIiwgdHJ1ZSk7IiksCiAgICAgICAgICB0aGlzLl9qdW1wKGwpLAogICAgICAgICAgdGhpcy5zZXRCbG9jayhsKSkKICAgICAgICB0aGlzLl9qdW1wKGspCiAgICAgICAgdGhpcy5zZXRCbG9jayhuKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY3lpZWxkID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAodGhpcy51LnN0ZS5ibG9ja1R5cGUgIT09IFNrLlNZTVRBQl9DT05TVFMuRnVuY3Rpb25CbG9jaykKICAgICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcigiJ3lpZWxkJyBvdXRzaWRlIGZ1bmN0aW9uIikKICAgICAgICB2YXIgYiA9ICJudWxsIgogICAgICAgIGEudmFsdWUgJiYgKGIgPSB0aGlzLnZleHByKGEudmFsdWUpKQogICAgICAgIGEgPSB0aGlzLm5ld0Jsb2NrKCJhZnRlciB5aWVsZCIpCiAgICAgICAgZigicmV0dXJuIFsvKnJlc3VtZSovIiwgYSwgIiwvKnJldCovIiwgYiwgIl07IikKICAgICAgICB0aGlzLnNldEJsb2NrKGEpCiAgICAgICAgcmV0dXJuICIkZ2VuLmdpJHNlbnR2YWx1ZSIKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jY29tcGFyZSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChhLm9wcy5sZW5ndGggPT09IGEuY29tcGFyYXRvcnMubGVuZ3RoKQogICAgICAgIHZhciBjID0gdGhpcy52ZXhwcihhLmxlZnQpCiAgICAgICAgdmFyIGQgPSBhLm9wcy5sZW5ndGgKICAgICAgICB2YXIgZSA9IHRoaXMubmV3QmxvY2soImRvbmUiKQogICAgICAgIHZhciBrID0gdGhpcy5fZ3IoImNvbXBhcmVyZXMiLCAibnVsbCIpCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGQ7ICsrYikgewogICAgICAgICAgdmFyIGcgPSB0aGlzLnZleHByKGEuY29tcGFyYXRvcnNbYl0pCiAgICAgICAgICBmKAogICAgICAgICAgICAiJHJldCA9IFNrLmJ1aWx0aW4uYm9vbChTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woIiwKICAgICAgICAgICAgYywKICAgICAgICAgICAgIiwiLAogICAgICAgICAgICBnLAogICAgICAgICAgICAiLCciLAogICAgICAgICAgICBhLm9wc1tiXS5wcm90b3R5cGUuX2FzdG5hbWUsCiAgICAgICAgICAgICInLCB0cnVlKSk7IiwKICAgICAgICAgICkKICAgICAgICAgIHRoaXMuX2NoZWNrU3VzcGVuc2lvbihhKQogICAgICAgICAgZihrLCAiPSRyZXQ7IikKICAgICAgICAgIHRoaXMuX2p1bXBmYWxzZSgiJHJldCIsIGUpCiAgICAgICAgICBjID0gZwogICAgICAgIH0KICAgICAgICB0aGlzLl9qdW1wKGUpCiAgICAgICAgdGhpcy5zZXRCbG9jayhlKQogICAgICAgIHJldHVybiBrCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY2NhbGwgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0gdGhpcy52ZXhwcihhLmZ1bmMpCiAgICAgICAgbGV0IGMgPSB0aGlzLmN1bnBhY2tzdGFyc3RvYXJyYXkoYS5hcmdzLCAhU2suX19mdXR1cmVfXy5weXRob24zKQogICAgICAgIHZhciBkID0gInVuZGVmaW5lZCIKICAgICAgICBpZiAoYS5rZXl3b3JkcyAmJiAwIDwgYS5rZXl3b3Jkcy5sZW5ndGgpIHsKICAgICAgICAgIGxldCBjID0gITEKICAgICAgICAgIGQgPSBbXQogICAgICAgICAgZm9yIChsZXQgYiBvZiBhLmtleXdvcmRzKSB7CiAgICAgICAgICAgIGlmIChjICYmICFTay5fX2Z1dHVyZV9fLnB5dGhvbjMpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKAogICAgICAgICAgICAgICAgIkFkdmFuY2VkIHVucGFja2luZyBvZiBmdW5jdGlvbiBhcmd1bWVudHMgaXMgbm90IHN1cHBvcnRlZCBpbiBQeXRob24gMiIsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBiLmFyZwogICAgICAgICAgICAgID8gKGQucHVzaCgiJyIgKyBiLmFyZy52ICsgIiciKSwgZC5wdXNoKHRoaXMudmV4cHIoYi52YWx1ZSkpKQogICAgICAgICAgICAgIDogKGMgPSAhMCkKICAgICAgICAgIH0KICAgICAgICAgIGQgPSAiWyIgKyBkLmpvaW4oIiwiKSArICJdIgogICAgICAgICAgaWYgKGMpIHsKICAgICAgICAgICAgZCA9IHRoaXMuX2dyKCJrZXl3b3JkQXJncyIsIGQpCiAgICAgICAgICAgIGZvciAobGV0IGMgb2YgYS5rZXl3b3JkcykKICAgICAgICAgICAgICBjLmFyZyB8fAogICAgICAgICAgICAgICAgKGYoCiAgICAgICAgICAgICAgICAgICIkcmV0ID0gU2suYWJzdHIubWFwcGluZ1VucGFja0ludG9LZXl3b3JkQXJyYXkoIiwKICAgICAgICAgICAgICAgICAgZCwKICAgICAgICAgICAgICAgICAgIiwiLAogICAgICAgICAgICAgICAgICB0aGlzLnZleHByKGMudmFsdWUpLAogICAgICAgICAgICAgICAgICAiLCIsCiAgICAgICAgICAgICAgICAgIGIsCiAgICAgICAgICAgICAgICAgICIpOyIsCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKCkpCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFNrLl9fZnV0dXJlX18uc3VwZXJfYXJncyAmJgogICAgICAgICAgYS5mdW5jLmlkICYmCiAgICAgICAgICAic3VwZXIiID09PSBhLmZ1bmMuaWQudiAmJgogICAgICAgICAgIltdIiA9PT0gYyAmJgogICAgICAgICAgKGYoCiAgICAgICAgICAgICdpZiAodHlwZW9mIHNlbGYgPT09ICJ1bmRlZmluZWQiIHx8IHNlbGYudG9TdHJpbmcoKS5pbmRleE9mKCJXaW5kb3ciKSA+IDApIHsgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uUnVudGltZUVycm9yKCJzdXBlcigpOiBubyBhcmd1bWVudHMiKSB9OycsCiAgICAgICAgICApLAogICAgICAgICAgKGMgPSAiWyRnYmwuX19jbGFzc19fLHNlbGZdIikpCiAgICAgICAgInVuZGVmaW5lZCIgIT09IGQKICAgICAgICAgID8gZigKICAgICAgICAgICAgICAiJHJldCA9IFNrLm1pc2NldmFsLmFwcGx5T3JTdXNwZW5kKCIsCiAgICAgICAgICAgICAgYiwKICAgICAgICAgICAgICAiLHVuZGVmaW5lZCx1bmRlZmluZWQsIiwKICAgICAgICAgICAgICBkLAogICAgICAgICAgICAgICIsIiwKICAgICAgICAgICAgICBjLAogICAgICAgICAgICAgICIpOyIsCiAgICAgICAgICAgICkKICAgICAgICAgIDogIltdIiAhPSBjCiAgICAgICAgICA/IGYoIiRyZXQgPSBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kQXJyYXkoIiwgYiwgIiwgIiwgYywgIik7IikKICAgICAgICAgIDogZigiJHJldCA9IFNrLm1pc2NldmFsLmNhbGxzaW1PclN1c3BlbmRBcnJheSgiLCBiLCAiKTsiKQogICAgICAgIHRoaXMuX2NoZWNrU3VzcGVuc2lvbihhKQogICAgICAgIHJldHVybiB0aGlzLl9ncigiY2FsbCIsICIkcmV0IikKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jc2xpY2UgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KGEgaW5zdGFuY2VvZiBTay5hc3Rub2Rlcy5TbGljZSkKICAgICAgICBpZiAoU2suX19mdXR1cmVfXy5weXRob24zKSB7CiAgICAgICAgICB2YXIgYiA9IGEubG93ZXIgPyB0aGlzLnZleHByKGEubG93ZXIpIDogIlNrLmJ1aWx0aW4ubm9uZS5ub25lJCIKICAgICAgICAgIHZhciBjID0gYS51cHBlciA/IHRoaXMudmV4cHIoYS51cHBlcikgOiAiU2suYnVpbHRpbi5ub25lLm5vbmUkIgogICAgICAgIH0gZWxzZQogICAgICAgICAgKGIgPSBhLmxvd2VyCiAgICAgICAgICAgID8gdGhpcy52ZXhwcihhLmxvd2VyKQogICAgICAgICAgICA6IGEuc3RlcAogICAgICAgICAgICA/ICJTay5idWlsdGluLm5vbmUubm9uZSQiCiAgICAgICAgICAgIDogIm5ldyBTay5idWlsdGluLmludF8oMCkiKSwKICAgICAgICAgICAgKGMgPSBhLnVwcGVyCiAgICAgICAgICAgICAgPyB0aGlzLnZleHByKGEudXBwZXIpCiAgICAgICAgICAgICAgOiBhLnN0ZXAKICAgICAgICAgICAgICA/ICJTay5idWlsdGluLm5vbmUubm9uZSQiCiAgICAgICAgICAgICAgOiAibmV3IFNrLmJ1aWx0aW4uaW50XygyMTQ3NDgzNjQ3KSIpCiAgICAgICAgYSA9IGEuc3RlcCA/IHRoaXMudmV4cHIoYS5zdGVwKSA6ICJTay5idWlsdGluLm5vbmUubm9uZSQiCiAgICAgICAgcmV0dXJuIHRoaXMuX2dyKAogICAgICAgICAgInNsaWNlIiwKICAgICAgICAgICJuZXcgU2suYnVpbHRpbnNbJ3NsaWNlJ10oIiwKICAgICAgICAgIGIsCiAgICAgICAgICAiLCIsCiAgICAgICAgICBjLAogICAgICAgICAgIiwiLAogICAgICAgICAgYSwKICAgICAgICAgICIpIiwKICAgICAgICApCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuZXNsaWNlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KGEgaW5zdGFuY2VvZiBBcnJheSkKICAgICAgICB2YXIgYyA9IFtdCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGEubGVuZ3RoOyBiKyspIGMucHVzaCh0aGlzLnZzbGljZXN1YihhW2JdKSkKICAgICAgICByZXR1cm4gdGhpcy5fZ3IoImV4dHNsaWNlIiwgIm5ldyBTay5idWlsdGluc1sndHVwbGUnXShbIiwgYywgIl0pIikKICAgICAgfQogICAgICBhLnByb3RvdHlwZS52c2xpY2VzdWIgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHN3aXRjaCAoYS5jb25zdHJ1Y3RvcikgewogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5JbmRleDoKICAgICAgICAgICAgdmFyIGIgPSB0aGlzLnZleHByKGEudmFsdWUpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlNsaWNlOgogICAgICAgICAgICBiID0gdGhpcy5jc2xpY2UoYSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuRWxsaXBzaXM6CiAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgidG9kbyBjb21waWxlLmpzIEVsbGlwc2lzOyIpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkV4dFNsaWNlOgogICAgICAgICAgICBiID0gdGhpcy5lc2xpY2UoYS5kaW1zKQogICAgICAgICAgICBicmVhawogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJpbnZhbGlkIHN1YnNjcmlwdCBraW5kIikKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGIKICAgICAgfQogICAgICBhLnByb3RvdHlwZS52c2xpY2UgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgewogICAgICAgIGEgPSB0aGlzLnZzbGljZXN1YihhKQogICAgICAgIHJldHVybiB0aGlzLmNoYW5kbGVzdWJzY3IoYiwgYywgYSwgZCkKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jaGFuZGxlc3Vic2NyID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsKICAgICAgICBpZiAoYSA9PT0gU2suYXN0bm9kZXMuTG9hZCB8fCBhID09PSBTay5hc3Rub2Rlcy5BdWdMb2FkKQogICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgZigiJHJldCA9IFNrLmFic3RyLm9iamVjdEdldEl0ZW0oIiwgYiwgIiwiLCBjLCAiLCB0cnVlKTsiKSwKICAgICAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKCksCiAgICAgICAgICAgIHRoaXMuX2dyKCJsc3Vic2NyIiwgIiRyZXQiKQogICAgICAgICAgKQogICAgICAgIGEgPT09IFNrLmFzdG5vZGVzLlN0b3JlIHx8IGEgPT09IFNrLmFzdG5vZGVzLkF1Z1N0b3JlCiAgICAgICAgICA/IChmKCIkcmV0ID0gU2suYWJzdHIub2JqZWN0U2V0SXRlbSgiLCBiLCAiLCIsIGMsICIsIiwgZCwgIiwgdHJ1ZSk7IiksCiAgICAgICAgICAgIHRoaXMuX2NoZWNrU3VzcGVuc2lvbigpKQogICAgICAgICAgOiBhID09PSBTay5hc3Rub2Rlcy5EZWwKICAgICAgICAgID8gZigiU2suYWJzdHIub2JqZWN0RGVsSXRlbSgiLCBiLCAiLCIsIGMsICIpOyIpCiAgICAgICAgICA6IFNrLmFzc2VydHMuZmFpbCgiaGFuZGxlc3Vic2NyIGZhaWwiKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNib29sb3AgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiLCBjCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoYSBpbnN0YW5jZW9mIFNrLmFzdG5vZGVzLkJvb2xPcCkKICAgICAgICB2YXIgZCA9IGEub3AgPT09IFNrLmFzdG5vZGVzLkFuZCA/IHRoaXMuX2p1bXBmYWxzZSA6IHRoaXMuX2p1bXB0cnVlCiAgICAgICAgdmFyIGUgPSB0aGlzLm5ld0Jsb2NrKCJlbmQgb2YgYm9vbG9wIikKICAgICAgICB2YXIgayA9IGEudmFsdWVzCiAgICAgICAgdmFyIGcgPSBrLmxlbmd0aAogICAgICAgIGZvciAoYiA9IDA7IGIgPCBnOyArK2IpCiAgICAgICAgICAoYSA9IHRoaXMudmV4cHIoa1tiXSkpLAogICAgICAgICAgICAwID09PSBiICYmIChjID0gdGhpcy5fZ3IoImJvb2xvcHN1Y2MiLCBhKSksCiAgICAgICAgICAgIGYoYywgIj0iLCBhLCAiOyIpLAogICAgICAgICAgICBkLmNhbGwodGhpcywgYSwgZSkKICAgICAgICB0aGlzLl9qdW1wKGUpCiAgICAgICAgdGhpcy5zZXRCbG9jayhlKQogICAgICAgIHJldHVybiBjCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUudmV4cHIgPSBmdW5jdGlvbiAoYSwgYiwgZywgaCkgewogICAgICAgIHZhciBrCiAgICAgICAgYS5saW5lbm8gPiB0aGlzLnUubGluZW5vICYmCiAgICAgICAgICAoKHRoaXMudS5saW5lbm8gPSBhLmxpbmVubyksICh0aGlzLnUubGluZW5vU2V0ID0gITEpKQogICAgICAgIHN3aXRjaCAoYS5jb25zdHJ1Y3RvcikgewogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5Cb29sT3A6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNib29sb3AoYSkKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQmluT3A6CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9ncigKICAgICAgICAgICAgICAiYmlub3AiLAogICAgICAgICAgICAgICJTay5hYnN0ci5udW1iZXJCaW5PcCgiLAogICAgICAgICAgICAgIHRoaXMudmV4cHIoYS5sZWZ0KSwKICAgICAgICAgICAgICAiLCIsCiAgICAgICAgICAgICAgdGhpcy52ZXhwcihhLnJpZ2h0KSwKICAgICAgICAgICAgICAiLCciLAogICAgICAgICAgICAgIGEub3AucHJvdG90eXBlLl9hc3RuYW1lLAogICAgICAgICAgICAgICInKSIsCiAgICAgICAgICAgICkKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuVW5hcnlPcDoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dyKAogICAgICAgICAgICAgICJ1bmFyeW9wIiwKICAgICAgICAgICAgICAiU2suYWJzdHIubnVtYmVyVW5hcnlPcCgiLAogICAgICAgICAgICAgIHRoaXMudmV4cHIoYS5vcGVyYW5kKSwKICAgICAgICAgICAgICAiLCciLAogICAgICAgICAgICAgIGEub3AucHJvdG90eXBlLl9hc3RuYW1lLAogICAgICAgICAgICAgICInKSIsCiAgICAgICAgICAgICkKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTGFtYmRhOgogICAgICAgICAgICByZXR1cm4gdGhpcy5jbGFtYmRhKGEpCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLklmRXhwOgogICAgICAgICAgICByZXR1cm4gdGhpcy5jaWZleHAoYSkKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuRGljdDoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2RpY3QoYSkKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTGlzdENvbXA6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaXN0Y29tcChhKQogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5EaWN0Q29tcDoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2RpY3Rjb21wKGEpCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlNldENvbXA6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNzZXRjb21wKGEpCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkdlbmVyYXRvckV4cDoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2dlbmV4cChhKQogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5ZaWVsZDoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3lpZWxkKGEpCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkNvbXBhcmU6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNjb21wYXJlKGEpCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkNhbGw6CiAgICAgICAgICAgIHJldHVybiAoYiA9IHRoaXMuY2NhbGwoYSkpLCB0aGlzLmFubm90YXRlU291cmNlKGEpLCBiCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLk51bToKICAgICAgICAgICAgaWYgKCJudW1iZXIiID09PSB0eXBlb2YgYS5uKSByZXR1cm4gYS5uCiAgICAgICAgICAgIGlmIChhLm4gaW5zdGFuY2VvZiBTay5idWlsdGluLmludF8pCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubWFrZUNvbnN0YW50KCJuZXcgU2suYnVpbHRpbi5pbnRfKCIgKyBhLm4udiArICIpIikKICAgICAgICAgICAgaWYgKGEubiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uZmxvYXRfKQogICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAoYSA9IDAgPT09IGEubi52ICYmIC1JbmZpbml0eSA9PT0gMSAvIGEubi52ID8gIi0wIiA6IGEubi52KSwKICAgICAgICAgICAgICAgIHRoaXMubWFrZUNvbnN0YW50KCJuZXcgU2suYnVpbHRpbi5mbG9hdF8oIiArIGEgKyAiKSIpCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBpZiAoYS5uIGluc3RhbmNlb2YgU2suYnVpbHRpbi5sbmcpCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubWFrZUNvbnN0YW50KAogICAgICAgICAgICAgICAgIlNrLmxvbmdGcm9tU3RyKCciICsgYS5uLnRwJHN0cigpLnYgKyAiJykiLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgaWYgKGEubiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uY29tcGxleCkKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tYWtlQ29uc3RhbnQoCiAgICAgICAgICAgICAgICAibmV3IFNrLmJ1aWx0aW4uY29tcGxleChuZXcgU2suYnVpbHRpbi5mbG9hdF8oIiArCiAgICAgICAgICAgICAgICAgICgwID09PSBhLm4ucmVhbC52ICYmIC1JbmZpbml0eSA9PT0gMSAvIGEubi5yZWFsLnYKICAgICAgICAgICAgICAgICAgICA/ICItMCIKICAgICAgICAgICAgICAgICAgICA6IGEubi5yZWFsLnYpICsKICAgICAgICAgICAgICAgICAgIiksIG5ldyBTay5idWlsdGluLmZsb2F0XygiICsKICAgICAgICAgICAgICAgICAgKDAgPT09IGEubi5pbWFnLnYgJiYgLUluZmluaXR5ID09PSAxIC8gYS5uLmltYWcudgogICAgICAgICAgICAgICAgICAgID8gIi0wIgogICAgICAgICAgICAgICAgICAgIDogYS5uLmltYWcudikgKwogICAgICAgICAgICAgICAgICAiKSkiLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJ1bmhhbmRsZWQgTnVtIHR5cGUiKQogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5TdHI6CiAgICAgICAgICAgIHJldHVybiB0aGlzLm1ha2VDb25zdGFudCgibmV3IFNrLmJ1aWx0aW4uc3RyKCIsIGEucy4kcigpLnYsICIpIikKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQXR0cmlidXRlOgogICAgICAgICAgICBhLmN0eCAhPT0gU2suYXN0bm9kZXMuQXVnTG9hZCAmJgogICAgICAgICAgICAgIGEuY3R4ICE9PSBTay5hc3Rub2Rlcy5BdWdTdG9yZSAmJgogICAgICAgICAgICAgIChrID0gdGhpcy52ZXhwcihhLnZhbHVlKSkKICAgICAgICAgICAgaCA9IGEuYXR0ci4kcigpLnYKICAgICAgICAgICAgaCA9IGguc3Vic3RyaW5nKDEsIGgubGVuZ3RoIC0gMSkKICAgICAgICAgICAgaCA9IGUodGhpcy51LnByaXZhdGVfLCBuZXcgU2suYnVpbHRpbi5zdHIoaCkpLnYKICAgICAgICAgICAgaCA9IGMoaCkKICAgICAgICAgICAgaCA9IGQoaCkKICAgICAgICAgICAgaCA9IHRoaXMubWFrZUNvbnN0YW50KCJuZXcgU2suYnVpbHRpbi5zdHIoJyIgKyBoICsgIicpIikKICAgICAgICAgICAgc3dpdGNoIChhLmN0eCkgewogICAgICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQXVnTG9hZDoKICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgIGYoIiRyZXQgPSBTay5hYnN0ci5nYXR0cigiLCBnLCAiLCIsIGgsICIsIHRydWUpOyIpLAogICAgICAgICAgICAgICAgICB0aGlzLl9jaGVja1N1c3BlbnNpb24oYSksCiAgICAgICAgICAgICAgICAgIHRoaXMuX2dyKCJsYXR0ciIsICIkcmV0IikKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkxvYWQ6CiAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICBmKCIkcmV0ID0gU2suYWJzdHIuZ2F0dHIoIiwgaywgIiwiLCBoLCAiLCB0cnVlKTsiKSwKICAgICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKGEpLAogICAgICAgICAgICAgICAgICB0aGlzLl9ncigibGF0dHIiLCAiJHJldCIpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5BdWdTdG9yZToKICAgICAgICAgICAgICAgIGYoIiRyZXQgPSB1bmRlZmluZWQ7IikKICAgICAgICAgICAgICAgIGYoImlmKCIsIGIsICIhPT11bmRlZmluZWQpeyIpCiAgICAgICAgICAgICAgICBmKCIkcmV0ID0gU2suYWJzdHIuc2F0dHIoIiwgZywgIiwiLCBoLCAiLCIsIGIsICIsIHRydWUpOyIpCiAgICAgICAgICAgICAgICBmKCJ9IikKICAgICAgICAgICAgICAgIHRoaXMuX2NoZWNrU3VzcGVuc2lvbihhKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlN0b3JlOgogICAgICAgICAgICAgICAgZigiJHJldCA9IFNrLmFic3RyLnNhdHRyKCIsIGssICIsIiwgaCwgIiwiLCBiLCAiLCB0cnVlKTsiKQogICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKGEpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuRGVsOgogICAgICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJ0b2RvIERlbDsiKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJpbnZhbGlkIGF0dHJpYnV0ZSBleHByZXNzaW9uIikKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5TdWJzY3JpcHQ6CiAgICAgICAgICAgIHN3aXRjaCAoYS5jdHgpIHsKICAgICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkF1Z0xvYWQ6CiAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICBmKCIkcmV0ID0gU2suYWJzdHIub2JqZWN0R2V0SXRlbSgiLCBnLCAiLCIsIGgsICIsIHRydWUpOyIpLAogICAgICAgICAgICAgICAgICB0aGlzLl9jaGVja1N1c3BlbnNpb24oYSksCiAgICAgICAgICAgICAgICAgIHRoaXMuX2dyKCJnaXRlbSIsICIkcmV0IikKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkxvYWQ6CiAgICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5TdG9yZToKICAgICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkRlbDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnZzbGljZShhLnNsaWNlLCBhLmN0eCwgdGhpcy52ZXhwcihhLnZhbHVlKSwgYikKICAgICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkF1Z1N0b3JlOgogICAgICAgICAgICAgICAgZigiJHJldD11bmRlZmluZWQ7IikKICAgICAgICAgICAgICAgIGYoImlmKCIsIGIsICIhPT11bmRlZmluZWQpeyIpCiAgICAgICAgICAgICAgICBmKCIkcmV0PVNrLmFic3RyLm9iamVjdFNldEl0ZW0oIiwgZywgIiwiLCBoLCAiLCIsIGIsICIsIHRydWUpIikKICAgICAgICAgICAgICAgIGYoIn0iKQogICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKGEpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoImludmFsaWQgc3Vic2NyaXB0IGV4cHJlc3Npb24iKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLk5hbWU6CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5hbWVvcChhLmlkLCBhLmN0eCwgYikKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTmFtZUNvbnN0YW50OgogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgYS5jdHggPT09IFNrLmFzdG5vZGVzLlN0b3JlIHx8CiAgICAgICAgICAgICAgYS5jdHggPT09IFNrLmFzdG5vZGVzLkF1Z1N0b3JlIHx8CiAgICAgICAgICAgICAgYS5jdHggPT09IFNrLmFzdG5vZGVzLkRlbAogICAgICAgICAgICApCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgICAiY2FuIG5vdCBhc3NpZ24gdG8gYSBjb25zdGFudCBuYW1lIiwKICAgICAgICAgICAgICApCiAgICAgICAgICAgIHN3aXRjaCAoYS52YWx1ZSkgewogICAgICAgICAgICAgIGNhc2UgU2suYnVpbHRpbi5ub25lLm5vbmUkOgogICAgICAgICAgICAgICAgcmV0dXJuICJTay5idWlsdGluLm5vbmUubm9uZSQiCiAgICAgICAgICAgICAgY2FzZSBTay5idWlsdGluLmJvb2wudHJ1ZSQ6CiAgICAgICAgICAgICAgICByZXR1cm4gIlNrLmJ1aWx0aW4uYm9vbC50cnVlJCIKICAgICAgICAgICAgICBjYXNlIFNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQ6CiAgICAgICAgICAgICAgICByZXR1cm4gIlNrLmJ1aWx0aW4uYm9vbC5mYWxzZSQiCiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgiaW52YWxpZCBuYW1lZCBjb25zdGFudCIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTGlzdDoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3R1cGxlbGlzdG9yc2V0KGEsIGIsICJsaXN0IikKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuVHVwbGU6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN0dXBsZWxpc3RvcnNldChhLCBiLCAidHVwbGUiKQogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5TZXQ6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN0dXBsZWxpc3RvcnNldChhLCBiLCAic2V0IikKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuU3RhcnJlZDoKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgidW5oYW5kbGVkIGNhc2UgIiArIGEuY29uc3RydWN0b3IubmFtZSArICIgdmV4cHIiKQogICAgICAgIH0KICAgICAgfQogICAgICBhLnByb3RvdHlwZS52c2VxZXhwciA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIGMKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCh2b2lkIDAgPT09IGIgfHwgYS5sZW5ndGggPT09IGIubGVuZ3RoKQogICAgICAgIHZhciBkID0gW10KICAgICAgICBmb3IgKGMgPSAwOyBjIDwgYS5sZW5ndGg7ICsrYykKICAgICAgICAgIGQucHVzaCh0aGlzLnZleHByKGFbY10sIHZvaWQgMCA9PT0gYiA/IHZvaWQgMCA6IGJbY10pKQogICAgICAgIHJldHVybiBkCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY2F1Z2Fzc2lnbiA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoYSBpbnN0YW5jZW9mIFNrLmFzdG5vZGVzLkF1Z0Fzc2lnbikKICAgICAgICB2YXIgYiA9IGEudGFyZ2V0CiAgICAgICAgc3dpdGNoIChiLmNvbnN0cnVjdG9yKSB7CiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkF0dHJpYnV0ZToKICAgICAgICAgICAgdmFyIGMgPSB0aGlzLnZleHByKGIudmFsdWUpCiAgICAgICAgICAgIGIgPSBuZXcgU2suYXN0bm9kZXMuQXR0cmlidXRlKAogICAgICAgICAgICAgIGIudmFsdWUsCiAgICAgICAgICAgICAgYi5hdHRyLAogICAgICAgICAgICAgIFNrLmFzdG5vZGVzLkF1Z0xvYWQsCiAgICAgICAgICAgICAgYi5saW5lbm8sCiAgICAgICAgICAgICAgYi5jb2xfb2Zmc2V0LAogICAgICAgICAgICApCiAgICAgICAgICAgIHZhciBkID0gdGhpcy52ZXhwcihiLCB2b2lkIDAsIGMpCiAgICAgICAgICAgIHZhciBlID0gdGhpcy52ZXhwcihhLnZhbHVlKQogICAgICAgICAgICBhID0gdGhpcy5fZ3IoCiAgICAgICAgICAgICAgImlucGxiaW5vcGF0dHIiLAogICAgICAgICAgICAgICJTay5hYnN0ci5udW1iZXJJbnBsYWNlQmluT3AoIiwKICAgICAgICAgICAgICBkLAogICAgICAgICAgICAgICIsIiwKICAgICAgICAgICAgICBlLAogICAgICAgICAgICAgICIsJyIsCiAgICAgICAgICAgICAgYS5vcC5wcm90b3R5cGUuX2FzdG5hbWUsCiAgICAgICAgICAgICAgIicpIiwKICAgICAgICAgICAgKQogICAgICAgICAgICBiLmN0eCA9IFNrLmFzdG5vZGVzLkF1Z1N0b3JlCiAgICAgICAgICAgIHJldHVybiB0aGlzLnZleHByKGIsIGEsIGMpCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlN1YnNjcmlwdDoKICAgICAgICAgICAgYyA9IHRoaXMudmV4cHIoYi52YWx1ZSkKICAgICAgICAgICAgdmFyIGsgPSB0aGlzLnZzbGljZXN1YihiLnNsaWNlKQogICAgICAgICAgICBiID0gbmV3IFNrLmFzdG5vZGVzLlN1YnNjcmlwdCgKICAgICAgICAgICAgICBiLnZhbHVlLAogICAgICAgICAgICAgIGssCiAgICAgICAgICAgICAgU2suYXN0bm9kZXMuQXVnTG9hZCwKICAgICAgICAgICAgICBiLmxpbmVubywKICAgICAgICAgICAgICBiLmNvbF9vZmZzZXQsCiAgICAgICAgICAgICkKICAgICAgICAgICAgZCA9IHRoaXMudmV4cHIoYiwgdm9pZCAwLCBjLCBrKQogICAgICAgICAgICBlID0gdGhpcy52ZXhwcihhLnZhbHVlKQogICAgICAgICAgICBhID0gdGhpcy5fZ3IoCiAgICAgICAgICAgICAgImlucGxiaW5vcHN1YnNjciIsCiAgICAgICAgICAgICAgIlNrLmFic3RyLm51bWJlcklucGxhY2VCaW5PcCgiLAogICAgICAgICAgICAgIGQsCiAgICAgICAgICAgICAgIiwiLAogICAgICAgICAgICAgIGUsCiAgICAgICAgICAgICAgIiwnIiwKICAgICAgICAgICAgICBhLm9wLnByb3RvdHlwZS5fYXN0bmFtZSwKICAgICAgICAgICAgICAiJykiLAogICAgICAgICAgICApCiAgICAgICAgICAgIGIuY3R4ID0gU2suYXN0bm9kZXMuQXVnU3RvcmUKICAgICAgICAgICAgcmV0dXJuIHRoaXMudmV4cHIoYiwgYSwgYywgaykKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTmFtZToKICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAoYyA9IHRoaXMubmFtZW9wKGIuaWQsIFNrLmFzdG5vZGVzLkxvYWQpKSwKICAgICAgICAgICAgICAoZSA9IHRoaXMudmV4cHIoYS52YWx1ZSkpLAogICAgICAgICAgICAgIChhID0gdGhpcy5fZ3IoCiAgICAgICAgICAgICAgICAiaW5wbGJpbm9wIiwKICAgICAgICAgICAgICAgICJTay5hYnN0ci5udW1iZXJJbnBsYWNlQmluT3AoIiwKICAgICAgICAgICAgICAgIGMsCiAgICAgICAgICAgICAgICAiLCIsCiAgICAgICAgICAgICAgICBlLAogICAgICAgICAgICAgICAgIiwnIiwKICAgICAgICAgICAgICAgIGEub3AucHJvdG90eXBlLl9hc3RuYW1lLAogICAgICAgICAgICAgICAgIicpIiwKICAgICAgICAgICAgICApKSwKICAgICAgICAgICAgICB0aGlzLm5hbWVvcChiLmlkLCBTay5hc3Rub2Rlcy5TdG9yZSwgYSkKICAgICAgICAgICAgKQogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJ1bmhhbmRsZWQgY2FzZSBpbiBhdWdhc3NpZ24iKQogICAgICAgIH0KICAgICAgfQogICAgICBhLnByb3RvdHlwZS5leHByQ29uc3RhbnQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHN3aXRjaCAoYS5jb25zdHJ1Y3RvcikgewogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5OdW06CiAgICAgICAgICAgIHJldHVybiBTay5taXNjZXZhbC5pc1RydWUoYS5uKSA/IDEgOiAwCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlN0cjoKICAgICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmlzVHJ1ZShhLnMpID8gMSA6IDAKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHJldHVybiAtMQogICAgICAgIH0KICAgICAgfQogICAgICBhLnByb3RvdHlwZS5uZXdCbG9jayA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIgPSB0aGlzLnUuYmxvY2tudW0rKwogICAgICAgIHRoaXMudS5ibG9ja3NbYl0gPSBbXQogICAgICAgIHRoaXMudS5ibG9ja3NbYl0uX25hbWUgPSBhIHx8ICI8dW5uYW1lZD4iCiAgICAgICAgdGhpcy51LmJsb2Nrc1tiXS5fbmV4dCA9IG51bGwKICAgICAgICByZXR1cm4gYgogICAgICB9CiAgICAgIGEucHJvdG90eXBlLnNldEJsb2NrID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgwIDw9IGEgJiYgYSA8IHRoaXMudS5ibG9ja251bSkKICAgICAgICB0aGlzLnUuY3VyYmxvY2sgPSBhCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUucHVzaEJyZWFrQmxvY2sgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KDAgPD0gYSAmJiBhIDwgdGhpcy51LmJsb2NrbnVtKQogICAgICAgIHRoaXMudS5icmVha0Jsb2Nrcy5wdXNoKGEpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUucG9wQnJlYWtCbG9jayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLnUuYnJlYWtCbG9ja3MucG9wKCkKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5wdXNoQ29udGludWVCbG9jayA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoMCA8PSBhICYmIGEgPCB0aGlzLnUuYmxvY2tudW0pCiAgICAgICAgdGhpcy51LmNvbnRpbnVlQmxvY2tzLnB1c2goYSkKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5wb3BDb250aW51ZUJsb2NrID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMudS5jb250aW51ZUJsb2Nrcy5wb3AoKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLnB1c2hFeGNlcHRCbG9jayA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoMCA8PSBhICYmIGEgPCB0aGlzLnUuYmxvY2tudW0pCiAgICAgICAgdGhpcy51LmV4Y2VwdEJsb2Nrcy5wdXNoKGEpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUucG9wRXhjZXB0QmxvY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy51LmV4Y2VwdEJsb2Nrcy5wb3AoKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLnB1c2hGaW5hbGx5QmxvY2sgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KDAgPD0gYSAmJiBhIDwgdGhpcy51LmJsb2NrbnVtKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KAogICAgICAgICAgdGhpcy51LmJyZWFrQmxvY2tzLmxlbmd0aCA9PT0gdGhpcy51LmNvbnRpbnVlQmxvY2tzLmxlbmd0aCwKICAgICAgICApCiAgICAgICAgdGhpcy51LmZpbmFsbHlCbG9ja3MucHVzaCh7CiAgICAgICAgICBibGs6IGEsCiAgICAgICAgICBicmVha0RlcHRoOiB0aGlzLnUuYnJlYWtCbG9ja3MubGVuZ3RoLAogICAgICAgIH0pCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUucG9wRmluYWxseUJsb2NrID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMudS5maW5hbGx5QmxvY2tzLnBvcCgpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUucGVla0ZpbmFsbHlCbG9jayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gMCA8IHRoaXMudS5maW5hbGx5QmxvY2tzLmxlbmd0aAogICAgICAgICAgPyB0aGlzLnUuZmluYWxseUJsb2Nrc1t0aGlzLnUuZmluYWxseUJsb2Nrcy5sZW5ndGggLSAxXQogICAgICAgICAgOiB2b2lkIDAKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5zZXR1cEV4Y2VwdCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgZigiJGV4Yy5wdXNoKCIsIGEsICIpOyIpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuZW5kRXhjZXB0ID0gZnVuY3Rpb24gKCkgewogICAgICAgIGYoIiRleGMucG9wKCk7IikKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5vdXRwdXRMb2NhbHMgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiLAogICAgICAgICAgYyA9IHt9CiAgICAgICAgZm9yIChiID0gMDsgYS5hcmduYW1lcyAmJiBiIDwgYS5hcmduYW1lcy5sZW5ndGg7ICsrYikKICAgICAgICAgIGNbYS5hcmduYW1lc1tiXV0gPSAhMAogICAgICAgIGEubG9jYWxuYW1lcy5zb3J0KCkKICAgICAgICB2YXIgZCA9IFtdCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGEubG9jYWxuYW1lcy5sZW5ndGg7ICsrYikgewogICAgICAgICAgdmFyIGUgPSBhLmxvY2FsbmFtZXNbYl0KICAgICAgICAgIHZvaWQgMCA9PT0gY1tlXSAmJiAoZC5wdXNoKGUpLCAoY1tlXSA9ICEwKSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIDAgPCBkLmxlbmd0aCA/ICJ2YXIgIiArIGQuam9pbigiLCIpICsgIjsgLyogbG9jYWxzICovIiA6ICIiCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUub3V0cHV0U3VzcGVuc2lvbkhlbHBlcnMgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiLAogICAgICAgICAgYyA9IFtdLAogICAgICAgICAgZCA9IGEubG9jYWxuYW1lcy5jb25jYXQoYS50ZW1wc1RvU2F2ZSksCiAgICAgICAgICBlID0ge30sCiAgICAgICAgICBmID0KICAgICAgICAgICAgYS5zdGUuYmxvY2tUeXBlID09PSBTay5TWU1UQUJfQ09OU1RTLkZ1bmN0aW9uQmxvY2sgJiYKICAgICAgICAgICAgYS5zdGUuY2hpbGRIYXNGcmVlLAogICAgICAgICAgayA9CiAgICAgICAgICAgICgwIDwgZC5sZW5ndGggPyAidmFyICIgKyBkLmpvaW4oIiwiKSArICI7IiA6ICIiKSArCiAgICAgICAgICAgICJ2YXIgJHdha2VGcm9tU3VzcGVuc2lvbiA9IGZ1bmN0aW9uKCkge3ZhciBzdXNwID0gIiArCiAgICAgICAgICAgIGEuc2NvcGVuYW1lICsKICAgICAgICAgICAgIi4kd2FraW5nU3VzcGVuc2lvbjsgIiArCiAgICAgICAgICAgIGEuc2NvcGVuYW1lICsKICAgICAgICAgICAgIi4kd2FraW5nU3VzcGVuc2lvbiA9IHVuZGVmaW5lZDskYmxrPXN1c3AuJGJsazsgJGxvYz1zdXNwLiRsb2M7ICRnYmw9c3VzcC4kZ2JsOyAkZXhjPXN1c3AuJGV4YzsgJGVycj1zdXNwLiRlcnI7ICRwb3N0ZmluYWxseT1zdXNwLiRwb3N0ZmluYWxseTskY3VyckxpbmVObz1zdXNwLiRsaW5lbm87ICRjdXJyQ29sTm89c3VzcC4kY29sbm87IFNrLmxhc3RZaWVsZD1EYXRlLm5vdygpOyIgKwogICAgICAgICAgICAoZiA/ICIkY2VsbD1zdXNwLiRjZWxsOyIgOiAiIikKICAgICAgICBmb3IgKGIgPSAwOyBiIDwgZC5sZW5ndGg7IGIrKykgewogICAgICAgICAgdmFyIGcgPSBkW2JdCiAgICAgICAgICB2b2lkIDAgPT09IGVbZ10gJiYgKChrICs9IGcgKyAiPXN1c3AuJHRtcHMuIiArIGcgKyAiOyIpLCAoZVtnXSA9ICEwKSkKICAgICAgICB9CiAgICAgICAgayArPQogICAgICAgICAgInRyeSB7ICRyZXQ9c3VzcC5jaGlsZC5yZXN1bWUoKTsgfSBjYXRjaChlcnIpIHsgaWYgKCEoZXJyIGluc3RhbmNlb2YgU2suYnVpbHRpbi5CYXNlRXhjZXB0aW9uKSkgeyBlcnIgPSBuZXcgU2suYnVpbHRpbi5FeHRlcm5hbEVycm9yKGVycik7IH0gZXJyLnRyYWNlYmFjay5wdXNoKHtsaW5lbm86ICRjdXJyTGluZU5vLCBjb2xubzogJGN1cnJDb2xObywgZmlsZW5hbWU6ICciICsKICAgICAgICAgIHRoaXMuZmlsZW5hbWUgKwogICAgICAgICAgIid9KTsgaWYoJGV4Yy5sZW5ndGg+MCkgeyAkZXJyPWVycjsgJGJsaz0kZXhjLnBvcCgpOyB9IGVsc2UgeyB0aHJvdyBlcnI7IH0gfX07IgogICAgICAgIGsgKz0KICAgICAgICAgICJ2YXIgJHNhdmVTdXNwZW5zaW9uID0gZnVuY3Rpb24oJGNoaWxkLCAkZmlsZW5hbWUsICRsaW5lbm8sICRjb2xubykge3ZhciBzdXNwID0gbmV3IFNrLm1pc2NldmFsLlN1c3BlbnNpb24oKTsgc3VzcC5jaGlsZD0kY2hpbGQ7c3VzcC5yZXN1bWU9ZnVuY3Rpb24oKXsiICsKICAgICAgICAgIGEuc2NvcGVuYW1lICsKICAgICAgICAgICIuJHdha2luZ1N1c3BlbnNpb249c3VzcDsgcmV0dXJuICIgKwogICAgICAgICAgYS5zY29wZW5hbWUgKwogICAgICAgICAgIigiICsKICAgICAgICAgIChhLnN0ZS5nZW5lcmF0b3IgPyAiJGdlbiIgOiAiIikgKwogICAgICAgICAgIik7IH07c3VzcC5kYXRhPXN1c3AuY2hpbGQuZGF0YTtzdXNwLiRibGs9JGJsaztzdXNwLiRsb2M9JGxvYztzdXNwLiRnYmw9JGdibDtzdXNwLiRleGM9JGV4YztzdXNwLiRlcnI9JGVycjtzdXNwLiRwb3N0ZmluYWxseT0kcG9zdGZpbmFsbHk7c3VzcC4kZmlsZW5hbWU9JGZpbGVuYW1lO3N1c3AuJGxpbmVubz0kbGluZW5vO3N1c3AuJGNvbG5vPSRjb2xubztzdXNwLm9wdGlvbmFsPXN1c3AuY2hpbGQub3B0aW9uYWw7IiArCiAgICAgICAgICAoZiA/ICJzdXNwLiRjZWxsPSRjZWxsOyIgOiAiIikKICAgICAgICBlID0ge30KICAgICAgICBmb3IgKGIgPSAwOyBiIDwgZC5sZW5ndGg7IGIrKykKICAgICAgICAgIChnID0gZFtiXSksCiAgICAgICAgICAgIHZvaWQgMCA9PT0gZVtnXSAmJiAoYy5wdXNoKCciJyArIGcgKyAnIjonICsgZyksIChlW2ddID0gITApKQogICAgICAgIHJldHVybiAoayArPSAic3VzcC4kdG1wcz17IiArIGMuam9pbigiLCIpICsgIn07cmV0dXJuIHN1c3A7fTsiKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLm91dHB1dEFsbFVuaXRzID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBhLAogICAgICAgICAgYiwKICAgICAgICAgIGMgPSAiIgogICAgICAgIGZvciAoYiA9IDA7IGIgPCB0aGlzLmFsbFVuaXRzLmxlbmd0aDsgKytiKSB7CiAgICAgICAgICB2YXIgZCA9IHRoaXMuYWxsVW5pdHNbYl0KICAgICAgICAgIGMgKz0gZC5wcmVmaXhDb2RlCiAgICAgICAgICBjICs9IHRoaXMub3V0cHV0TG9jYWxzKGQpCiAgICAgICAgICBkLmRvZXNTdXNwZW5kICYmIChjICs9IHRoaXMub3V0cHV0U3VzcGVuc2lvbkhlbHBlcnMoZCkpCiAgICAgICAgICBjICs9IGQudmFyRGVjbHNDb2RlCiAgICAgICAgICBjICs9IGQuc3dpdGNoQ29kZQogICAgICAgICAgdmFyIGUgPSBkLmJsb2NrcwogICAgICAgICAgdmFyIGYgPSBPYmplY3QuY3JlYXRlKG51bGwpCiAgICAgICAgICBmb3IgKGEgPSAwOyBhIDwgZS5sZW5ndGg7ICsrYSkgewogICAgICAgICAgICB2YXIgZyA9IGEKICAgICAgICAgICAgaWYgKCEoZyBpbiBmKSkKICAgICAgICAgICAgICBmb3IgKDs7KQogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAoKGZbZ10gPSAhMCksCiAgICAgICAgICAgICAgICAgIChjICs9ICJjYXNlICIgKyBnICsgIjogLyogLS0tICIgKyBlW2ddLl9uYW1lICsgIiAtLS0gKi8iKSwKICAgICAgICAgICAgICAgICAgKGMgKz0gZVtnXS5qb2luKCIiKSksCiAgICAgICAgICAgICAgICAgIG51bGwgIT09IGVbZ10uX25leHQpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgIGlmIChlW2ddLl9uZXh0IGluIGYpIHsKICAgICAgICAgICAgICAgICAgICBjICs9ICIvKiBqdW1wICovIGNvbnRpbnVlOyIKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAgICAgICAoYyArPSAiLyogYWxsb3dpbmcgY2FzZSBmYWxsdGhyb3VnaCAqLyIpLCAoZyA9IGVbZ10uX25leHQpCiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgYyArPQogICAgICAgICAgICAgICAgICAgICJ0aHJvdyBuZXcgU2suYnVpbHRpbi5TeXN0ZW1FcnJvcignaW50ZXJuYWwgZXJyb3I6IHVudGVybWluYXRlZCBibG9jaycpOyIKICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGMgKz0gZC5zdWZmaXhDb2RlCiAgICAgICAgfQogICAgICAgIHJldHVybiBjCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY2lmID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KGEgaW5zdGFuY2VvZiBTay5hc3Rub2Rlcy5JZikKICAgICAgICB2YXIgYyA9IHRoaXMuZXhwckNvbnN0YW50KGEudGVzdCkKICAgICAgICBpZiAoMCA9PT0gYykgYS5vcmVsc2UgJiYgMCA8IGEub3JlbHNlLmxlbmd0aCAmJiB0aGlzLnZzZXFzdG10KGEub3JlbHNlKQogICAgICAgIGVsc2UgaWYgKDEgPT09IGMpIHRoaXMudnNlcXN0bXQoYS5ib2R5KQogICAgICAgIGVsc2UgewogICAgICAgICAgdmFyIGQgPSB0aGlzLm5ld0Jsb2NrKCJlbmQgb2YgaWYiKQogICAgICAgICAgYS5vcmVsc2UgJiYKICAgICAgICAgICAgMCA8IGEub3JlbHNlLmxlbmd0aCAmJgogICAgICAgICAgICAoYiA9IHRoaXMubmV3QmxvY2soIm5leHQgYnJhbmNoIG9mIGlmIikpCiAgICAgICAgICBjID0gdGhpcy52ZXhwcihhLnRlc3QpCiAgICAgICAgICBhLm9yZWxzZSAmJiAwIDwgYS5vcmVsc2UubGVuZ3RoCiAgICAgICAgICAgID8gKHRoaXMuX2p1bXBmYWxzZShjLCBiKSwKICAgICAgICAgICAgICB0aGlzLnZzZXFzdG10KGEuYm9keSksCiAgICAgICAgICAgICAgdGhpcy5fanVtcChkKSwKICAgICAgICAgICAgICB0aGlzLnNldEJsb2NrKGIpLAogICAgICAgICAgICAgIHRoaXMudnNlcXN0bXQoYS5vcmVsc2UpKQogICAgICAgICAgICA6ICh0aGlzLl9qdW1wZmFsc2UoYywgZCksIHRoaXMudnNlcXN0bXQoYS5ib2R5KSkKICAgICAgICAgIHRoaXMuX2p1bXAoZCkKICAgICAgICAgIHRoaXMuc2V0QmxvY2soZCkKICAgICAgICB9CiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY3doaWxlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoMCA9PT0gdGhpcy5leHByQ29uc3RhbnQoYS50ZXN0KSkgYS5vcmVsc2UgJiYgdGhpcy52c2Vxc3RtdChhLm9yZWxzZSkKICAgICAgICBlbHNlIHsKICAgICAgICAgIHZhciBiID0gdGhpcy5uZXdCbG9jaygid2hpbGUgdGVzdCIpCiAgICAgICAgICB0aGlzLl9qdW1wKGIpCiAgICAgICAgICB0aGlzLnNldEJsb2NrKGIpCiAgICAgICAgICB2YXIgYyA9IHRoaXMubmV3QmxvY2soImFmdGVyIHdoaWxlIikKICAgICAgICAgIHZhciBkID0gMCA8IGEub3JlbHNlLmxlbmd0aCA/IHRoaXMubmV3QmxvY2soIndoaWxlIG9yZWxzZSIpIDogbnVsbAogICAgICAgICAgdmFyIGUgPSB0aGlzLm5ld0Jsb2NrKCJ3aGlsZSBib2R5IikKICAgICAgICAgIHRoaXMuYW5ub3RhdGVTb3VyY2UoYSkKICAgICAgICAgIHRoaXMuX2p1bXBmYWxzZSh0aGlzLnZleHByKGEudGVzdCksIGQgPyBkIDogYykKICAgICAgICAgIHRoaXMuX2p1bXAoZSkKICAgICAgICAgIHRoaXMucHVzaEJyZWFrQmxvY2soYykKICAgICAgICAgIHRoaXMucHVzaENvbnRpbnVlQmxvY2soYikKICAgICAgICAgIHRoaXMuc2V0QmxvY2soZSkKICAgICAgICAgIDsoU2suZGVidWdnaW5nIHx8IFNrLmtpbGxhYmxlV2hpbGUpICYmCiAgICAgICAgICAgIHRoaXMudS5jYW5TdXNwZW5kICYmCiAgICAgICAgICAgICgoZSA9IHRoaXMubmV3QmxvY2soImRlYnVnIGJyZWFrcG9pbnQgZm9yIGxpbmUgIiArIGEubGluZW5vKSksCiAgICAgICAgICAgIGYoCiAgICAgICAgICAgICAgImlmIChTay5icmVha3BvaW50cygnIiArCiAgICAgICAgICAgICAgICB0aGlzLmZpbGVuYW1lICsKICAgICAgICAgICAgICAgICInLCIgKwogICAgICAgICAgICAgICAgYS5saW5lbm8gKwogICAgICAgICAgICAgICAgIiwiICsKICAgICAgICAgICAgICAgIGEuY29sX29mZnNldCArCiAgICAgICAgICAgICAgICAiKSkgeyIsCiAgICAgICAgICAgICAgInZhciAkc3VzcCA9ICRzYXZlU3VzcGVuc2lvbih7ZGF0YToge3R5cGU6ICdTay5kZWxheSd9LCByZXN1bWU6IGZ1bmN0aW9uKCkge319LCAnIiArCiAgICAgICAgICAgICAgICB0aGlzLmZpbGVuYW1lICsKICAgICAgICAgICAgICAgICInLCIgKwogICAgICAgICAgICAgICAgYS5saW5lbm8gKwogICAgICAgICAgICAgICAgIiwiICsKICAgICAgICAgICAgICAgIGEuY29sX29mZnNldCArCiAgICAgICAgICAgICAgICAiKTsiLAogICAgICAgICAgICAgICIkc3VzcC4kYmxrID0gIiArIGUgKyAiOyIsCiAgICAgICAgICAgICAgIiRzdXNwLm9wdGlvbmFsID0gdHJ1ZTsiLAogICAgICAgICAgICAgICJyZXR1cm4gJHN1c3A7IiwKICAgICAgICAgICAgICAifSIsCiAgICAgICAgICAgICksCiAgICAgICAgICAgIHRoaXMuX2p1bXAoZSksCiAgICAgICAgICAgIHRoaXMuc2V0QmxvY2soZSksCiAgICAgICAgICAgICh0aGlzLnUuZG9lc1N1c3BlbmQgPSAhMCkpCiAgICAgICAgICB0aGlzLnZzZXFzdG10KGEuYm9keSkKICAgICAgICAgIHRoaXMuX2p1bXAoYikKICAgICAgICAgIHRoaXMucG9wQ29udGludWVCbG9jaygpCiAgICAgICAgICB0aGlzLnBvcEJyZWFrQmxvY2soKQogICAgICAgICAgMCA8IGEub3JlbHNlLmxlbmd0aCAmJgogICAgICAgICAgICAodGhpcy5zZXRCbG9jayhkKSwgdGhpcy52c2Vxc3RtdChhLm9yZWxzZSksIHRoaXMuX2p1bXAoYykpCiAgICAgICAgICB0aGlzLnNldEJsb2NrKGMpCiAgICAgICAgfQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNmb3IgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0gdGhpcy5uZXdCbG9jaygiZm9yIHN0YXJ0IiksCiAgICAgICAgICBjID0gdGhpcy5uZXdCbG9jaygiZm9yIGNsZWFudXAiKSwKICAgICAgICAgIGQgPSB0aGlzLm5ld0Jsb2NrKCJmb3IgZW5kIikKICAgICAgICB0aGlzLnB1c2hCcmVha0Jsb2NrKGQpCiAgICAgICAgdGhpcy5wdXNoQ29udGludWVCbG9jayhiKQogICAgICAgIHZhciBlID0gdGhpcy52ZXhwcihhLml0ZXIpCiAgICAgICAgaWYgKHRoaXMudS5zdGUuZ2VuZXJhdG9yKSB7CiAgICAgICAgICB2YXIgayA9ICIkbG9jLiIgKyB0aGlzLmdlbnN5bSgiaXRlciIpCiAgICAgICAgICBmKGssICI9U2suYWJzdHIuaXRlcigiLCBlLCAiKTsiKQogICAgICAgIH0gZWxzZQogICAgICAgICAgKGsgPSB0aGlzLl9ncigiaXRlciIsICJTay5hYnN0ci5pdGVyKCIsIGUsICIpIikpLAogICAgICAgICAgICB0aGlzLnUudGVtcHNUb1NhdmUucHVzaChrKQogICAgICAgIHRoaXMuX2p1bXAoYikKICAgICAgICB0aGlzLnNldEJsb2NrKGIpCiAgICAgICAgZigKICAgICAgICAgICIkcmV0ID0gU2suYWJzdHIuaXRlcm5leHQoIiwKICAgICAgICAgIGssCiAgICAgICAgICB0aGlzLnUuY2FuU3VzcGVuZCA/ICIsIHRydWUiIDogIiwgZmFsc2UiLAogICAgICAgICAgIik7IiwKICAgICAgICApCiAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKGEpCiAgICAgICAgayA9IHRoaXMuX2dyKCJuZXh0IiwgIiRyZXQiKQogICAgICAgIHRoaXMuX2p1bXB1bmRlZihrLCBjKQogICAgICAgIHRoaXMudmV4cHIoYS50YXJnZXQsIGspCiAgICAgICAgOyhTay5kZWJ1Z2dpbmcgfHwgU2sua2lsbGFibGVGb3IpICYmCiAgICAgICAgICB0aGlzLnUuY2FuU3VzcGVuZCAmJgogICAgICAgICAgKChrID0gdGhpcy5uZXdCbG9jaygiZGVidWcgYnJlYWtwb2ludCBmb3IgbGluZSAiICsgYS5saW5lbm8pKSwKICAgICAgICAgIGYoCiAgICAgICAgICAgICJpZiAoU2suYnJlYWtwb2ludHMoJyIgKwogICAgICAgICAgICAgIHRoaXMuZmlsZW5hbWUgKwogICAgICAgICAgICAgICInLCIgKwogICAgICAgICAgICAgIGEubGluZW5vICsKICAgICAgICAgICAgICAiLCIgKwogICAgICAgICAgICAgIGEuY29sX29mZnNldCArCiAgICAgICAgICAgICAgIikpIHsiLAogICAgICAgICAgICAidmFyICRzdXNwID0gJHNhdmVTdXNwZW5zaW9uKHtkYXRhOiB7dHlwZTogJ1NrLmRlbGF5J30sIHJlc3VtZTogZnVuY3Rpb24oKSB7fX0sICciICsKICAgICAgICAgICAgICB0aGlzLmZpbGVuYW1lICsKICAgICAgICAgICAgICAiJywiICsKICAgICAgICAgICAgICBhLmxpbmVubyArCiAgICAgICAgICAgICAgIiwiICsKICAgICAgICAgICAgICBhLmNvbF9vZmZzZXQgKwogICAgICAgICAgICAgICIpOyIsCiAgICAgICAgICAgICIkc3VzcC4kYmxrID0gIiArIGsgKyAiOyIsCiAgICAgICAgICAgICIkc3VzcC5vcHRpb25hbCA9IHRydWU7IiwKICAgICAgICAgICAgInJldHVybiAkc3VzcDsiLAogICAgICAgICAgICAifSIsCiAgICAgICAgICApLAogICAgICAgICAgdGhpcy5fanVtcChrKSwKICAgICAgICAgIHRoaXMuc2V0QmxvY2soayksCiAgICAgICAgICAodGhpcy51LmRvZXNTdXNwZW5kID0gITApKQogICAgICAgIHRoaXMudnNlcXN0bXQoYS5ib2R5KQogICAgICAgIHRoaXMuX2p1bXAoYikKICAgICAgICB0aGlzLnNldEJsb2NrKGMpCiAgICAgICAgdGhpcy5wb3BDb250aW51ZUJsb2NrKCkKICAgICAgICB0aGlzLnBvcEJyZWFrQmxvY2soKQogICAgICAgIHRoaXMudnNlcXN0bXQoYS5vcmVsc2UpCiAgICAgICAgdGhpcy5fanVtcChkKQogICAgICAgIHRoaXMuc2V0QmxvY2soZCkKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jcmFpc2UgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmIChhLmV4YykgewogICAgICAgICAgdmFyIGIgPSB0aGlzLl9ncigiZXhjIiwgdGhpcy52ZXhwcihhLmV4YykpLAogICAgICAgICAgICBjID0gdGhpcy5uZXdCbG9jaygiZXhjZXB0aW9uIG5vdyBpbnN0YW50aWF0ZWQiKSwKICAgICAgICAgICAgZCA9IHRoaXMuX2dyKAogICAgICAgICAgICAgICJpc2NsYXNzIiwKICAgICAgICAgICAgICBiICsKICAgICAgICAgICAgICAgICIgaW5zdGFuY2VvZiBTay5idWlsdGluLnR5cGUgfHwgIiArCiAgICAgICAgICAgICAgICBiICsKICAgICAgICAgICAgICAgICIucHJvdG90eXBlIGluc3RhbmNlb2YgU2suYnVpbHRpbi5CYXNlRXhjZXB0aW9uIiwKICAgICAgICAgICAgKQogICAgICAgICAgdGhpcy5fanVtcGZhbHNlKGQsIGMpCiAgICAgICAgICBhLmluc3QKICAgICAgICAgICAgPyAoKGQgPSB0aGlzLl9ncigiaW5zdCIsIHRoaXMudmV4cHIoYS5pbnN0KSkpLAogICAgICAgICAgICAgIGYoCiAgICAgICAgICAgICAgICAiaWYoISgiLAogICAgICAgICAgICAgICAgZCwKICAgICAgICAgICAgICAgICIgaW5zdGFuY2VvZiBTay5idWlsdGluLnR1cGxlKSkgeyIsCiAgICAgICAgICAgICAgICBkLAogICAgICAgICAgICAgICAgIj0gbmV3IFNrLmJ1aWx0aW4udHVwbGUoWyIsCiAgICAgICAgICAgICAgICBkLAogICAgICAgICAgICAgICAgIl0pOyIsCiAgICAgICAgICAgICAgICAifSIsCiAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICBmKCIkcmV0ID0gU2subWlzY2V2YWwuY2FsbHNpbU9yU3VzcGVuZEFycmF5KCIsIGIsICIsIiwgZCwgIi52KTsiKSkKICAgICAgICAgICAgOiBmKCIkcmV0ID0gU2subWlzY2V2YWwuY2FsbHNpbU9yU3VzcGVuZCgiLCBiLCAiKTsiKQogICAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKGEpCiAgICAgICAgICBmKGIsICI9JHJldDsiKQogICAgICAgICAgdGhpcy5fanVtcChjKQogICAgICAgICAgdGhpcy5zZXRCbG9jayhjKQogICAgICAgICAgZigidGhyb3cgIiwgYiwgIjsiKQogICAgICAgIH0gZWxzZSBmKCJ0aHJvdyAkZXJyOyIpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUub3V0cHV0RmluYWxseUNhc2NhZGUgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICgwID09IHRoaXMudS5maW5hbGx5QmxvY2tzLmxlbmd0aCkKICAgICAgICAgIGYoCiAgICAgICAgICAgICJpZigkcG9zdGZpbmFsbHkhPT11bmRlZmluZWQpIHsgaWYgKCRwb3N0ZmluYWxseS5yZXR1cm5pbmcpIHsgcmV0dXJuICRwb3N0ZmluYWxseS5yZXR1cm5pbmc7IH0gZWxzZSB7ICRibGs9JHBvc3RmaW5hbGx5LmdvdG9CbG9jazsgJHBvc3RmaW5hbGx5PXVuZGVmaW5lZDsgY29udGludWU7IH0gfSIsCiAgICAgICAgICApCiAgICAgICAgZWxzZSB7CiAgICAgICAgICB2YXIgYiA9IHRoaXMucGVla0ZpbmFsbHlCbG9jaygpCiAgICAgICAgICBmKAogICAgICAgICAgICAiaWYoJHBvc3RmaW5hbGx5IT09dW5kZWZpbmVkKSB7IiwKICAgICAgICAgICAgImlmICgkcG9zdGZpbmFsbHkucmV0dXJuaW5nIiwKICAgICAgICAgICAgYi5icmVha0RlcHRoID09IGEuYnJlYWtEZXB0aCA/ICJ8fCAkcG9zdGZpbmFsbHkuaXNCcmVhayIgOiAiIiwKICAgICAgICAgICAgIikgeyIsCiAgICAgICAgICAgICIkYmxrPSIsCiAgICAgICAgICAgIGIuYmxrLAogICAgICAgICAgICAiO2NvbnRpbnVlOyIsCiAgICAgICAgICAgICJ9IGVsc2UgeyIsCiAgICAgICAgICAgICIkYmxrPSRwb3N0ZmluYWxseS5nb3RvQmxvY2s7JHBvc3RmaW5hbGx5PXVuZGVmaW5lZDtjb250aW51ZTsiLAogICAgICAgICAgICAifSIsCiAgICAgICAgICAgICJ9IiwKICAgICAgICAgICkKICAgICAgICB9CiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY3RyeSA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIsCiAgICAgICAgICBjID0gYS5oYW5kbGVycy5sZW5ndGgKICAgICAgICBpZiAoYS5maW5hbGJvZHkpIHsKICAgICAgICAgIHZhciBkID0gdGhpcy5uZXdCbG9jaygiZmluYWxib2R5IikKICAgICAgICAgIHZhciBlID0gdGhpcy5uZXdCbG9jaygiZmluYWxleGgiKQogICAgICAgICAgdmFyIGsgPSB0aGlzLl9ncigiZmluYWxseV9yZXJhaXNlIiwgInVuZGVmaW5lZCIpCiAgICAgICAgICB0aGlzLnUudGVtcHNUb1NhdmUucHVzaChrKQogICAgICAgICAgdGhpcy5wdXNoRmluYWxseUJsb2NrKGQpCiAgICAgICAgICB2YXIgZyA9IHRoaXMucGVla0ZpbmFsbHlCbG9jaygpCiAgICAgICAgICB0aGlzLnNldHVwRXhjZXB0KGUpCiAgICAgICAgfQogICAgICAgIHZhciBoID0gW10KICAgICAgICBmb3IgKGIgPSAwOyBiIDwgYzsgKytiKSBoLnB1c2godGhpcy5uZXdCbG9jaygiZXhjZXB0XyIgKyBiICsgIl8iKSkKICAgICAgICB2YXIgbSA9IHRoaXMubmV3QmxvY2soInVuaGFuZGxlZCIpCiAgICAgICAgdmFyIHAgPSB0aGlzLm5ld0Jsb2NrKCJvcmVsc2UiKQogICAgICAgIHZhciBDID0gdGhpcy5uZXdCbG9jaygiZW5kIikKICAgICAgICAwICE9IGgubGVuZ3RoICYmIHRoaXMuc2V0dXBFeGNlcHQoaFswXSkKICAgICAgICB0aGlzLnZzZXFzdG10KGEuYm9keSkKICAgICAgICAwICE9IGgubGVuZ3RoICYmIHRoaXMuZW5kRXhjZXB0KCkKICAgICAgICB0aGlzLl9qdW1wKHApCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGM7ICsrYikgewogICAgICAgICAgdGhpcy5zZXRCbG9jayhoW2JdKQogICAgICAgICAgdmFyIEsgPSBhLmhhbmRsZXJzW2JdCiAgICAgICAgICBpZiAoIUsudHlwZSAmJiBiIDwgYyAtIDEpCiAgICAgICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcigiZGVmYXVsdCAnZXhjZXB0OicgbXVzdCBiZSBsYXN0IikKICAgICAgICAgIGlmIChLLnR5cGUpIHsKICAgICAgICAgICAgdmFyIEIgPSB0aGlzLnZleHByKEsudHlwZSkKICAgICAgICAgICAgdmFyIFMgPSBiID09IGMgLSAxID8gbSA6IGhbYiArIDFdCiAgICAgICAgICAgIEIgPSB0aGlzLl9ncigKICAgICAgICAgICAgICAiaW5zdGFuY2UiLAogICAgICAgICAgICAgICJTay5taXNjZXZhbC5pc1RydWUoU2suYnVpbHRpbi5pc2luc3RhbmNlKCRlcnIsICIsCiAgICAgICAgICAgICAgQiwKICAgICAgICAgICAgICAiKSkiLAogICAgICAgICAgICApCiAgICAgICAgICAgIHRoaXMuX2p1bXBmYWxzZShCLCBTKQogICAgICAgICAgfQogICAgICAgICAgSy5uYW1lICYmIHRoaXMudmV4cHIoSy5uYW1lLCAiJGVyciIpCiAgICAgICAgICB0aGlzLnZzZXFzdG10KEsuYm9keSkKICAgICAgICAgIHRoaXMuX2p1bXAoQykKICAgICAgICB9CiAgICAgICAgdGhpcy5zZXRCbG9jayhtKQogICAgICAgIGYoInRocm93ICRlcnI7IikKICAgICAgICB0aGlzLnNldEJsb2NrKHApCiAgICAgICAgdGhpcy52c2Vxc3RtdChhLm9yZWxzZSkKICAgICAgICB0aGlzLl9qdW1wKEMpCiAgICAgICAgdGhpcy5zZXRCbG9jayhDKQogICAgICAgIGEuZmluYWxib2R5ICYmCiAgICAgICAgICAodGhpcy5lbmRFeGNlcHQoKSwKICAgICAgICAgIHRoaXMuX2p1bXAoZCksCiAgICAgICAgICB0aGlzLnNldEJsb2NrKGUpLAogICAgICAgICAgZihrLCAiPSRlcnI7IiksCiAgICAgICAgICB0aGlzLl9qdW1wKGQpLAogICAgICAgICAgdGhpcy5zZXRCbG9jayhkKSwKICAgICAgICAgIHRoaXMucG9wRmluYWxseUJsb2NrKCksCiAgICAgICAgICB0aGlzLnZzZXFzdG10KGEuZmluYWxib2R5KSwKICAgICAgICAgIGYoImlmKCIsIGssICIhPT11bmRlZmluZWQpIHsgdGhyb3cgIiwgaywgIjt9IiksCiAgICAgICAgICB0aGlzLm91dHB1dEZpbmFsbHlDYXNjYWRlKGcpKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmN3aXRoID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB2YXIgYyA9IHRoaXMubmV3QmxvY2soIndpdGhleGgiKSwKICAgICAgICAgIGQgPSB0aGlzLm5ld0Jsb2NrKCJ3aXRodGlkeXVwIiksCiAgICAgICAgICBlID0gdGhpcy5uZXdCbG9jaygid2l0aGNhcnJ5b24iKQogICAgICAgIHZhciBrID0gdGhpcy5fZ3IoIm1nciIsIHRoaXMudmV4cHIoYS5pdGVtc1tiXS5jb250ZXh0X2V4cHIpKQogICAgICAgIGYoIiRyZXQgPSBTay5hYnN0ci5nYXR0cigiLCBrLCAiLFNrLmJ1aWx0aW4uc3RyLiRleGl0LCB0cnVlKTsiKQogICAgICAgIHRoaXMuX2NoZWNrU3VzcGVuc2lvbihhKQogICAgICAgIHZhciBnID0gdGhpcy5fZ3IoImV4aXQiLCAiJHJldCIpCiAgICAgICAgdGhpcy51LnRlbXBzVG9TYXZlLnB1c2goZykKICAgICAgICBmKCIkcmV0ID0gU2suYWJzdHIuZ2F0dHIoIiwgaywgIixTay5idWlsdGluLnN0ci4kZW50ZXIsIHRydWUpOyIpCiAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKGEpCiAgICAgICAgZigiJHJldCA9IFNrLm1pc2NldmFsLmNhbGxzaW1PclN1c3BlbmRBcnJheSgkcmV0KTsiKQogICAgICAgIHRoaXMuX2NoZWNrU3VzcGVuc2lvbihhKQogICAgICAgIGsgPSB0aGlzLl9ncigidmFsdWUiLCAiJHJldCIpCiAgICAgICAgdGhpcy5wdXNoRmluYWxseUJsb2NrKGQpCiAgICAgICAgdmFyIGggPSB0aGlzLnUuZmluYWxseUJsb2Nrc1t0aGlzLnUuZmluYWxseUJsb2Nrcy5sZW5ndGggLSAxXQogICAgICAgIHRoaXMuc2V0dXBFeGNlcHQoYykKICAgICAgICBhLml0ZW1zW2JdLm9wdGlvbmFsX3ZhcnMgJiYKICAgICAgICAgIHRoaXMubmFtZW9wKGEuaXRlbXNbYl0ub3B0aW9uYWxfdmFycy5pZCwgU2suYXN0bm9kZXMuU3RvcmUsIGspCiAgICAgICAgYiArIDEgPCBhLml0ZW1zLmxlbmd0aCA/IHRoaXMuY3dpdGgoYSwgYiArIDEpIDogdGhpcy52c2Vxc3RtdChhLmJvZHkpCiAgICAgICAgdGhpcy5lbmRFeGNlcHQoKQogICAgICAgIHRoaXMuX2p1bXAoZCkKICAgICAgICB0aGlzLnNldEJsb2NrKGMpCiAgICAgICAgZigKICAgICAgICAgICIkcmV0ID0gU2subWlzY2V2YWwuYXBwbHlPclN1c3BlbmQoIiwKICAgICAgICAgIGcsCiAgICAgICAgICAiLHVuZGVmaW5lZCxTay5idWlsdGluLmdldEV4Y0luZm8oJGVyciksdW5kZWZpbmVkLFtdKTsiLAogICAgICAgICkKICAgICAgICB0aGlzLl9jaGVja1N1c3BlbnNpb24oYSkKICAgICAgICB0aGlzLl9qdW1wdHJ1ZSgiJHJldCIsIGUpCiAgICAgICAgZigidGhyb3cgJGVycjsiKQogICAgICAgIHRoaXMuc2V0QmxvY2soZCkKICAgICAgICB0aGlzLnBvcEZpbmFsbHlCbG9jaygpCiAgICAgICAgZigKICAgICAgICAgICIkcmV0ID0gU2subWlzY2V2YWwuY2FsbHNpbU9yU3VzcGVuZEFycmF5KCIsCiAgICAgICAgICBnLAogICAgICAgICAgIixbU2suYnVpbHRpbi5ub25lLm5vbmUkLFNrLmJ1aWx0aW4ubm9uZS5ub25lJCxTay5idWlsdGluLm5vbmUubm9uZSRdKTsiLAogICAgICAgICkKICAgICAgICB0aGlzLl9jaGVja1N1c3BlbnNpb24oYSkKICAgICAgICB0aGlzLm91dHB1dEZpbmFsbHlDYXNjYWRlKGgpCiAgICAgICAgdGhpcy5fanVtcChlKQogICAgICAgIHRoaXMuc2V0QmxvY2soZSkKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jYXNzZXJ0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiA9IHRoaXMudmV4cHIoYS50ZXN0KSwKICAgICAgICAgIGMgPSB0aGlzLm5ld0Jsb2NrKCJlbmQiKQogICAgICAgIHRoaXMuX2p1bXB0cnVlKGIsIGMpCiAgICAgICAgZigKICAgICAgICAgICJ0aHJvdyBuZXcgU2suYnVpbHRpbi5Bc3NlcnRpb25FcnJvcigiLAogICAgICAgICAgYS5tc2cgPyB0aGlzLnZleHByKGEubXNnKSA6ICIiLAogICAgICAgICAgIik7IiwKICAgICAgICApCiAgICAgICAgdGhpcy5zZXRCbG9jayhjKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNpbXBvcnRhcyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7CiAgICAgICAgYSA9IGEudgogICAgICAgIHZhciBkID0gYS5pbmRleE9mKCIuIiksCiAgICAgICAgICBlID0gYwogICAgICAgIGlmICgtMSAhPT0gZCkKICAgICAgICAgIGZvciAoYSA9IGEuc3Vic3RyKGQgKyAxKTsgLTEgIT09IGQ7ICkKICAgICAgICAgICAgKGQgPSBhLmluZGV4T2YoIi4iKSksCiAgICAgICAgICAgICAgKGMgPSAtMSAhPT0gZCA/IGEuc3Vic3RyKDAsIGQpIDogYSksCiAgICAgICAgICAgICAgKGUgPSB0aGlzLl9ncigKICAgICAgICAgICAgICAgICJsYXR0ciIsCiAgICAgICAgICAgICAgICAiU2suYWJzdHIuZ2F0dHIoIiwKICAgICAgICAgICAgICAgIGUsCiAgICAgICAgICAgICAgICAiLCBuZXcgU2suYnVpbHRpbi5zdHIoJyIsCiAgICAgICAgICAgICAgICBjLAogICAgICAgICAgICAgICAgIicpKSIsCiAgICAgICAgICAgICAgKSksCiAgICAgICAgICAgICAgKGEgPSBhLnN1YnN0cihkICsgMSkpCiAgICAgICAgcmV0dXJuIHRoaXMubmFtZW9wKGIsIFNrLmFzdG5vZGVzLlN0b3JlLCBlKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNpbXBvcnQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiLAogICAgICAgICAgYyA9IGEubmFtZXMubGVuZ3RoCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGM7ICsrYikgewogICAgICAgICAgdmFyIGQgPSBhLm5hbWVzW2JdCiAgICAgICAgICBmKAogICAgICAgICAgICAiJHJldCA9IFNrLmJ1aWx0aW4uX19pbXBvcnRfXygiLAogICAgICAgICAgICBkLm5hbWUuJHIoKS52LAogICAgICAgICAgICAiLCRnYmwsJGxvYyxbXSwiLAogICAgICAgICAgICBTay5fX2Z1dHVyZV9fLmFic29sdXRlX2ltcG9ydCA/IDAgOiAtMSwKICAgICAgICAgICAgIik7IiwKICAgICAgICAgICkKICAgICAgICAgIHRoaXMuX2NoZWNrU3VzcGVuc2lvbihhKQogICAgICAgICAgdmFyIGUgPSB0aGlzLl9ncigibW9kdWxlIiwgIiRyZXQiKQogICAgICAgICAgaWYgKGQuYXNuYW1lKSB0aGlzLmNpbXBvcnRhcyhkLm5hbWUsIGQuYXNuYW1lLCBlKQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhciBrID0gZC5uYW1lCiAgICAgICAgICAgIGQgPSBrLnYuaW5kZXhPZigiLiIpCiAgICAgICAgICAgIDstMSAhPT0gZCAmJiAoayA9IG5ldyBTay5idWlsdGluLnN0cihrLnYuc3Vic3RyKDAsIGQpKSkKICAgICAgICAgICAgdGhpcy5uYW1lb3AoaywgU2suYXN0bm9kZXMuU3RvcmUsIGUpCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNmcm9taW1wb3J0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYiwKICAgICAgICAgIGQgPSBhLm5hbWVzLmxlbmd0aAogICAgICAgIHZhciBlID0gW10KICAgICAgICB2YXIgayA9IGEubGV2ZWwKICAgICAgICAwICE9IGsgfHwgU2suX19mdXR1cmVfXy5hYnNvbHV0ZV9pbXBvcnQgfHwgKGsgPSAtMSkKICAgICAgICBmb3IgKGIgPSAwOyBiIDwgZDsgKytiKSBlW2JdID0gIiciICsgYyhhLm5hbWVzW2JdLm5hbWUudikgKyAiJyIKICAgICAgICBmKAogICAgICAgICAgIiRyZXQgPSBTay5idWlsdGluLl9faW1wb3J0X18oIiwKICAgICAgICAgIGEubW9kdWxlLiRyKCkudiwKICAgICAgICAgICIsJGdibCwkbG9jLFsiLAogICAgICAgICAgZSwKICAgICAgICAgICJdLCIsCiAgICAgICAgICBrLAogICAgICAgICAgIik7IiwKICAgICAgICApCiAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKGEpCiAgICAgICAgayA9IHRoaXMuX2dyKCJtb2R1bGUiLCAiJHJldCIpCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGQ7ICsrYikgewogICAgICAgICAgZSA9IGEubmFtZXNbYl0KICAgICAgICAgIHZhciBnID0gIiciICsgYyhlLm5hbWUudikgKyAiJyIKICAgICAgICAgIGlmICgwID09PSBiICYmICIqIiA9PT0gZS5uYW1lLnYpIHsKICAgICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoMSA9PT0gZCkKICAgICAgICAgICAgZigiU2suaW1wb3J0U3RhcigiLCBrLCAiLCRsb2MsICRnYmwpOyIpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICB9CiAgICAgICAgICB2YXIgaCA9IHRoaXMuX2dyKAogICAgICAgICAgICAiaXRlbSIsCiAgICAgICAgICAgICJTay5hYnN0ci5nYXR0cigiLAogICAgICAgICAgICBrLAogICAgICAgICAgICAiLCBuZXcgU2suYnVpbHRpbi5zdHIoIiwKICAgICAgICAgICAgZywKICAgICAgICAgICAgIikpIiwKICAgICAgICAgICkKICAgICAgICAgIGcgPSBlLm5hbWUKICAgICAgICAgIGUuYXNuYW1lICYmIChnID0gZS5hc25hbWUpCiAgICAgICAgICB0aGlzLm5hbWVvcChnLCBTay5hc3Rub2Rlcy5TdG9yZSwgaCkKICAgICAgICB9CiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuYnVpbGRjb2Rlb2JqID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUsIGcpIHsKICAgICAgICB2YXIgayA9IFtdLAogICAgICAgICAgaCwKICAgICAgICAgIGwgPSBbXSwKICAgICAgICAgIG4gPSBbXSwKICAgICAgICAgIG0gPSBbXSwKICAgICAgICAgIHIgPSBudWxsLAogICAgICAgICAgcSA9IG51bGwKICAgICAgICBjICYmIChsID0gdGhpcy52c2VxZXhwcihjKSkKICAgICAgICBkICYmIGQuZGVmYXVsdHMgJiYgKG4gPSB0aGlzLnZzZXFleHByKGQuZGVmYXVsdHMpKQogICAgICAgIGQgJiYKICAgICAgICAgIGQua3dfZGVmYXVsdHMgJiYKICAgICAgICAgIChtID0gZC5rd19kZWZhdWx0cy5tYXAoKGEpID0+IChhID8gdGhpcy52ZXhwcihhKSA6ICJ1bmRlZmluZWQiKSkpCiAgICAgICAgZCAmJiBkLnZhcmFyZyAmJiAociA9IGQudmFyYXJnKQogICAgICAgIGQgJiYgZC5rd2FyZyAmJiAocSA9IGQua3dhcmcpCiAgICAgICAgaWYgKAogICAgICAgICAgIVNrLl9fZnV0dXJlX18ucHl0aG9uMyAmJgogICAgICAgICAgZCAmJgogICAgICAgICAgZC5rd29ubHlhcmdzICYmCiAgICAgICAgICAwICE9IGQua3dvbmx5YXJncy5sZW5ndGgKICAgICAgICApCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5TeW50YXhFcnJvcigKICAgICAgICAgICAgIktleXdvcmQtb25seSBhcmd1bWVudHMgYXJlIG5vdCBzdXBwb3J0ZWQgaW4gUHl0aG9uIDIiLAogICAgICAgICAgKQogICAgICAgIGMgPSB0aGlzLmVudGVyU2NvcGUoYiwgYSwgYS5saW5lbm8sIHRoaXMuY2FuU3VzcGVuZCkKICAgICAgICBhID0gdGhpcy51LnN0ZS5nZW5lcmF0b3IKICAgICAgICB2YXIgcCA9IHRoaXMudS5zdGUuaGFzRnJlZQogICAgICAgIHZhciBEID0gdGhpcy51LnN0ZS5jaGlsZEhhc0ZyZWUKICAgICAgICB2YXIgeiA9IHRoaXMubmV3QmxvY2soImNvZGVvYmogZW50cnkiKQogICAgICAgIHRoaXMudS5wcmVmaXhDb2RlID0KICAgICAgICAgICJ2YXIgIiArIGMgKyAiPShmdW5jdGlvbiAiICsgdGhpcy5uaWNlTmFtZShiLnYpICsgIiQoIgogICAgICAgIHZhciBQID0gW10KICAgICAgICBpZiAoYSkgewogICAgICAgICAgaWYgKHEpCiAgICAgICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcigKICAgICAgICAgICAgICBiLnYgKyAiKCk6IGtleXdvcmQgYXJndW1lbnRzIGluIGdlbmVyYXRvcnMgbm90IHN1cHBvcnRlZCIsCiAgICAgICAgICAgICkKICAgICAgICAgIGlmIChyKQogICAgICAgICAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoCiAgICAgICAgICAgICAgYi52ICsKICAgICAgICAgICAgICAgICIoKTogdmFyaWFibGUgbnVtYmVyIG9mIGFyZ3VtZW50cyBpbiBnZW5lcmF0b3JzIG5vdCBzdXBwb3J0ZWQiLAogICAgICAgICAgICApCiAgICAgICAgICBQLnB1c2goIiRnZW4iKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBxICYmIChQLnB1c2goIiRrd2EiKSwgdGhpcy51LnRlbXBzVG9TYXZlLnB1c2goIiRrd2EiKSkKICAgICAgICAgIGZvciAoaCA9IDA7IGQgJiYgaCA8IGQuYXJncy5sZW5ndGg7ICsraCkKICAgICAgICAgICAgUC5wdXNoKHRoaXMubmFtZW9wKGQuYXJnc1toXS5hcmcsIFNrLmFzdG5vZGVzLlBhcmFtKSkKICAgICAgICAgIGZvciAoaCA9IDA7IGQgJiYgZC5rd29ubHlhcmdzICYmIGggPCBkLmt3b25seWFyZ3MubGVuZ3RoOyArK2gpCiAgICAgICAgICAgIFAucHVzaCh0aGlzLm5hbWVvcChkLmt3b25seWFyZ3NbaF0uYXJnLCBTay5hc3Rub2Rlcy5QYXJhbSkpCiAgICAgICAgICByICYmIFAucHVzaCh0aGlzLm5hbWVvcChkLnZhcmFyZy5hcmcsIFNrLmFzdG5vZGVzLlBhcmFtKSkKICAgICAgICB9CiAgICAgICAgcCAmJiAoUC5wdXNoKCIkZnJlZSIpLCB0aGlzLnUudGVtcHNUb1NhdmUucHVzaCgiJGZyZWUiKSkKICAgICAgICB0aGlzLnUucHJlZml4Q29kZSArPSBQLmpvaW4oIiwiKQogICAgICAgIHRoaXMudS5wcmVmaXhDb2RlICs9ICIpeyIKICAgICAgICBhICYmICh0aGlzLnUucHJlZml4Q29kZSArPSAiXG4vLyBnZW5lcmF0b3JcbiIpCiAgICAgICAgcCAmJiAodGhpcy51LnByZWZpeENvZGUgKz0gIlxuLy8gaGFzIGZyZWVcbiIpCiAgICAgICAgRCAmJiAodGhpcy51LnByZWZpeENvZGUgKz0gIlxuLy8gaGFzIGNlbGxcbiIpCiAgICAgICAgUCA9ICJ7fSIKICAgICAgICBhICYmICgoeiA9ICIkZ2VuLmdpJHJlc3VtZWF0IiksIChQID0gIiRnZW4uZ2kkbG9jYWxzIikpCiAgICAgICAgaCA9ICIsJGNlbGw9e30iCiAgICAgICAgRCAmJiBhICYmIChoID0gIiwkY2VsbD0kZ2VuLmdpJGNlbGxzIikKICAgICAgICB0aGlzLnUudmFyRGVjbHNDb2RlICs9CiAgICAgICAgICAidmFyICRibGs9IiArCiAgICAgICAgICB6ICsKICAgICAgICAgICIsJGV4Yz1bXSwkbG9jPSIgKwogICAgICAgICAgUCArCiAgICAgICAgICBoICsKICAgICAgICAgICIsJGdibD10aGlzLCRlcnI9dW5kZWZpbmVkLCRyZXQ9dW5kZWZpbmVkLCRwb3N0ZmluYWxseT11bmRlZmluZWQsJGN1cnJMaW5lTm89dW5kZWZpbmVkLCRjdXJyQ29sTm89dW5kZWZpbmVkOyIKICAgICAgICBudWxsICE9PSBTay5leGVjTGltaXQgJiYKICAgICAgICAgICh0aGlzLnUudmFyRGVjbHNDb2RlICs9CiAgICAgICAgICAgICJpZiAodHlwZW9mIFNrLmV4ZWNTdGFydCA9PT0gJ3VuZGVmaW5lZCcpIHtTay5leGVjU3RhcnQgPSBEYXRlLm5vdygpfSIpCiAgICAgICAgbnVsbCAhPT0gU2sueWllbGRMaW1pdCAmJgogICAgICAgICAgdGhpcy51LmNhblN1c3BlbmQgJiYKICAgICAgICAgICh0aGlzLnUudmFyRGVjbHNDb2RlICs9CiAgICAgICAgICAgICJpZiAodHlwZW9mIFNrLmxhc3RZaWVsZCA9PT0gJ3VuZGVmaW5lZCcpIHtTay5sYXN0WWllbGQgPSBEYXRlLm5vdygpfSIpCiAgICAgICAgdGhpcy51LnZhckRlY2xzQ29kZSArPQogICAgICAgICAgImlmICgiICsKICAgICAgICAgIGMgKwogICAgICAgICAgIi4kd2FraW5nU3VzcGVuc2lvbiE9PXVuZGVmaW5lZCkgeyAkd2FrZUZyb21TdXNwZW5zaW9uKCk7IH0gZWxzZSB7IgogICAgICAgIGlmIChhICYmIDAgPCBuLmxlbmd0aCkKICAgICAgICAgIGZvciAoRCA9IGQuYXJncy5sZW5ndGggLSBuLmxlbmd0aCwgaCA9IDA7IGggPCBuLmxlbmd0aDsgKytoKQogICAgICAgICAgICAoeiA9IHRoaXMubmFtZW9wKGQuYXJnc1toICsgRF0uYXJnLCBTay5hc3Rub2Rlcy5QYXJhbSkpLAogICAgICAgICAgICAgICh0aGlzLnUudmFyRGVjbHNDb2RlICs9CiAgICAgICAgICAgICAgICAiaWYoIiArCiAgICAgICAgICAgICAgICB6ICsKICAgICAgICAgICAgICAgICI9PT11bmRlZmluZWQpIiArCiAgICAgICAgICAgICAgICB6ICsKICAgICAgICAgICAgICAgICI9IiArCiAgICAgICAgICAgICAgICBjICsKICAgICAgICAgICAgICAgICIuJGRlZmF1bHRzWyIgKwogICAgICAgICAgICAgICAgaCArCiAgICAgICAgICAgICAgICAiXTsiKQogICAgICAgIGZvciAoaCA9IDA7IGQgJiYgaCA8IGQuYXJncy5sZW5ndGg7ICsraCkKICAgICAgICAgICh6ID0gZC5hcmdzW2hdLmFyZyksCiAgICAgICAgICAgIHRoaXMuaXNDZWxsKHopICYmCiAgICAgICAgICAgICAgKHRoaXMudS52YXJEZWNsc0NvZGUgKz0gIiRjZWxsLiIgKyB6LnYgKyAiPSIgKyB6LnYgKyAiOyIpCiAgICAgICAgZm9yIChoID0gMDsgZCAmJiBkLmt3b25seWFyZ3MgJiYgaCA8IGQua3dvbmx5YXJncy5sZW5ndGg7ICsraCkKICAgICAgICAgICh6ID0gZC5rd29ubHlhcmdzW2hdLmFyZyksCiAgICAgICAgICAgIHRoaXMuaXNDZWxsKHopICYmCiAgICAgICAgICAgICAgKHRoaXMudS52YXJEZWNsc0NvZGUgKz0gIiRjZWxsLiIgKyB6LnYgKyAiPSIgKyB6LnYgKyAiOyIpCiAgICAgICAgciAmJgogICAgICAgICAgdGhpcy5pc0NlbGwoci5hcmcpICYmCiAgICAgICAgICAodGhpcy51LnZhckRlY2xzQ29kZSArPSAiJGNlbGwuIiArIHIuYXJnLnYgKyAiPSIgKyByLmFyZy52ICsgIjsiKQogICAgICAgIHEgJiYKICAgICAgICAgICh0aGlzLnUubG9jYWxuYW1lcy5wdXNoKHEuYXJnLnYpLAogICAgICAgICAgKHRoaXMudS52YXJEZWNsc0NvZGUgKz0gcS5hcmcudiArICI9bmV3IFNrLmJ1aWx0aW5zWydkaWN0J10oJGt3YSk7IiksCiAgICAgICAgICB0aGlzLmlzQ2VsbChxLmFyZykgJiYKICAgICAgICAgICAgKHRoaXMudS52YXJEZWNsc0NvZGUgKz0gIiRjZWxsLiIgKyBxLmFyZy52ICsgIj0iICsgcS5hcmcudiArICI7IikpCiAgICAgICAgdGhpcy51LnZhckRlY2xzQ29kZSArPSAifSIKICAgICAgICBTay5weXRob24zICYmCiAgICAgICAgICBnICYmCiAgICAgICAgICAodGhpcy51LnZhckRlY2xzQ29kZSArPSAiJGdibC5fX2NsYXNzX189dGhpcy4iICsgZy52ICsgIjsiKQogICAgICAgIHRoaXMudS5zd2l0Y2hDb2RlID0gIndoaWxlKHRydWUpe3RyeXsiCiAgICAgICAgdGhpcy51LnN3aXRjaENvZGUgKz0gdGhpcy5vdXRwdXRJbnRlcnJ1cHRUZXN0KCkKICAgICAgICB0aGlzLnUuc3dpdGNoQ29kZSArPSAic3dpdGNoKCRibGspeyIKICAgICAgICB0aGlzLnUuc3VmZml4Q29kZSA9CiAgICAgICAgICAifSB9Y2F0Y2goZXJyKXsgaWYgKCEoZXJyIGluc3RhbmNlb2YgU2suYnVpbHRpbi5CYXNlRXhjZXB0aW9uKSkgeyBlcnIgPSBuZXcgU2suYnVpbHRpbi5FeHRlcm5hbEVycm9yKGVycik7IH0gZXJyLnRyYWNlYmFjay5wdXNoKHtsaW5lbm86ICRjdXJyTGluZU5vLCBjb2xubzogJGN1cnJDb2xObywgZmlsZW5hbWU6ICciICsKICAgICAgICAgIHRoaXMuZmlsZW5hbWUgKwogICAgICAgICAgIid9KTsgaWYgKCRleGMubGVuZ3RoPjApIHsgJGVyciA9IGVycjsgJGJsaz0kZXhjLnBvcCgpOyBjb250aW51ZTsgfSBlbHNlIHsgdGhyb3cgZXJyOyB9fSB9fSk7IgogICAgICAgIGUuY2FsbCh0aGlzLCBjKQogICAgICAgIGlmIChkKSB7CiAgICAgICAgICBmb3IgKGxldCBhIG9mIGQuYXJncykgay5wdXNoKGEuYXJnLnYpCiAgICAgICAgICBmb3IgKGxldCBhIG9mIGQua3dvbmx5YXJncyB8fCBbXSkgay5wdXNoKGEuYXJnLnYpCiAgICAgICAgICB0aGlzLnUuYXJnbmFtZXMgPSBrCiAgICAgICAgfQogICAgICAgIHRoaXMuZXhpdFNjb3BlKCkKICAgICAgICAwIDwgbi5sZW5ndGggJiYgZihjLCAiLiRkZWZhdWx0cz1bIiwgbi5qb2luKCIsIiksICJdOyIpCiAgICAgICAgZCAmJgogICAgICAgICAgZC5rd29ubHlhcmdzICYmCiAgICAgICAgICAwIDwgZC5rd29ubHlhcmdzLmxlbmd0aCAmJgogICAgICAgICAgKGYoYywgIi5jb19hcmdjb3VudD0iLCBkLmFyZ3MubGVuZ3RoLCAiOyIpLAogICAgICAgICAgZihjLCAiLmNvX2t3b25seWFyZ2NvdW50PSIsIGQua3dvbmx5YXJncy5sZW5ndGgsICI7IiksCiAgICAgICAgICBmKGMsICIuJGt3ZGVmcz1bIiwgbS5qb2luKCIsIiksICJdOyIpKQogICAgICAgIDAgPCBrLmxlbmd0aAogICAgICAgICAgPyBmKGMsICIuY29fdmFybmFtZXM9WyciLCBrLmpvaW4oIicsJyIpLCAiJ107IikKICAgICAgICAgIDogZihjLCAiLmNvX3Zhcm5hbWVzPVtdOyIpCiAgICAgICAgcSAmJiBmKGMsICIuY29fa3dhcmdzPTE7IikKICAgICAgICByICYmIGYoYywgIi5jb192YXJhcmdzPTE7IikKICAgICAgICBlID0gIiIKICAgICAgICBwICYmICgoZSA9ICIsJGNlbGwiKSwgKGcgPSB0aGlzLnUuc3RlLmhhc0ZyZWUpICYmIChlICs9ICIsJGZyZWUiKSkKICAgICAgICBpZiAoYSkKICAgICAgICAgIHJldHVybiBkICYmIDAgPCBkLmFyZ3MubGVuZ3RoCiAgICAgICAgICAgID8gdGhpcy5fZ3IoCiAgICAgICAgICAgICAgICAiZ2VuZXIiLAogICAgICAgICAgICAgICAgIm5ldyBTay5idWlsdGluc1snZnVuY3Rpb24nXSgoZnVuY3Rpb24oKXt2YXIgJG9yaWdhcmdzPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7U2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbihcIiIsCiAgICAgICAgICAgICAgICBiLnYsCiAgICAgICAgICAgICAgICAnIixhcmd1bWVudHMubGVuZ3RoLCcsCiAgICAgICAgICAgICAgICBkLmFyZ3MubGVuZ3RoIC0gbi5sZW5ndGgsCiAgICAgICAgICAgICAgICAiLCIsCiAgICAgICAgICAgICAgICBkLmFyZ3MubGVuZ3RoLAogICAgICAgICAgICAgICAgIik7cmV0dXJuIG5ldyBTay5idWlsdGluc1snZ2VuZXJhdG9yJ10oIiwKICAgICAgICAgICAgICAgIGMsCiAgICAgICAgICAgICAgICAiLCRnYmwsJG9yaWdhcmdzIiwKICAgICAgICAgICAgICAgIGUsCiAgICAgICAgICAgICAgICAiKTt9KSkiLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgOiB0aGlzLl9ncigKICAgICAgICAgICAgICAgICJnZW5lciIsCiAgICAgICAgICAgICAgICAibmV3IFNrLmJ1aWx0aW5zWydmdW5jdGlvbiddKChmdW5jdGlvbigpe1NrLmJ1aWx0aW4ucHlDaGVja0FyZ3NMZW4oXCIiLAogICAgICAgICAgICAgICAgYi52LAogICAgICAgICAgICAgICAgIlwiLGFyZ3VtZW50cy5sZW5ndGgsMCwwKTtyZXR1cm4gbmV3IFNrLmJ1aWx0aW5zWydnZW5lcmF0b3InXSgiLAogICAgICAgICAgICAgICAgYywKICAgICAgICAgICAgICAgICIsJGdibCxbXSIsCiAgICAgICAgICAgICAgICBlLAogICAgICAgICAgICAgICAgIik7fSkpIiwKICAgICAgICAgICAgICApCiAgICAgICAgaWYgKDAgPCBsLmxlbmd0aCkgewogICAgICAgICAgZigiJHJldCA9IG5ldyBTay5idWlsdGluc1snZnVuY3Rpb24nXSgiLCBjLCAiLCRnYmwiLCBlLCAiKTsiKQogICAgICAgICAgZm9yIChsZXQgYSBvZiBsKQogICAgICAgICAgICBmKCIkcmV0ID0gU2subWlzY2V2YWwuY2FsbHNpbU9yU3VzcGVuZEFycmF5KCIsIGEsICIsWyRyZXRdKTsiKSwKICAgICAgICAgICAgICB0aGlzLl9jaGVja1N1c3BlbnNpb24oKQogICAgICAgICAgcmV0dXJuIHRoaXMuX2dyKCJmdW5jb2JqIiwgIiRyZXQiKQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5fZ3IoCiAgICAgICAgICAiZnVuY29iaiIsCiAgICAgICAgICAibmV3IFNrLmJ1aWx0aW5zWydmdW5jdGlvbiddKCIsCiAgICAgICAgICBjLAogICAgICAgICAgIiwkZ2JsIiwKICAgICAgICAgIGUsCiAgICAgICAgICAiKSIsCiAgICAgICAgKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNmdW5jdGlvbiA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoYSBpbnN0YW5jZW9mIFNrLmFzdG5vZGVzLkZ1bmN0aW9uRGVmKQogICAgICAgIGIgPSB0aGlzLmJ1aWxkY29kZW9iaigKICAgICAgICAgIGEsCiAgICAgICAgICBhLm5hbWUsCiAgICAgICAgICBhLmRlY29yYXRvcl9saXN0LAogICAgICAgICAgYS5hcmdzLAogICAgICAgICAgZnVuY3Rpb24gKGIpIHsKICAgICAgICAgICAgdGhpcy52c2Vxc3RtdChhLmJvZHkpCiAgICAgICAgICAgIGYoInJldHVybiBTay5idWlsdGluLm5vbmUubm9uZSQ7IikKICAgICAgICAgIH0sCiAgICAgICAgICBiLAogICAgICAgICkKICAgICAgICB0aGlzLm5hbWVvcChhLm5hbWUsIFNrLmFzdG5vZGVzLlN0b3JlLCBiKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNsYW1iZGEgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KGEgaW5zdGFuY2VvZiBTay5hc3Rub2Rlcy5MYW1iZGEpCiAgICAgICAgcmV0dXJuIHRoaXMuYnVpbGRjb2Rlb2JqKAogICAgICAgICAgYSwKICAgICAgICAgIG5ldyBTay5idWlsdGluLnN0cigiPGxhbWJkYT4iKSwKICAgICAgICAgIG51bGwsCiAgICAgICAgICBhLmFyZ3MsCiAgICAgICAgICBmdW5jdGlvbiAoYikgewogICAgICAgICAgICBiID0gdGhpcy52ZXhwcihhLmJvZHkpCiAgICAgICAgICAgIGYoInJldHVybiAiLCBiLCAiOyIpCiAgICAgICAgICB9LAogICAgICAgICkKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jaWZleHAgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0gdGhpcy5uZXdCbG9jaygibmV4dCBvZiBpZmV4cCIpLAogICAgICAgICAgYyA9IHRoaXMubmV3QmxvY2soImVuZCBvZiBpZmV4cCIpLAogICAgICAgICAgZCA9IHRoaXMuX2dyKCJyZXMiLCAibnVsbCIpLAogICAgICAgICAgZSA9IHRoaXMudmV4cHIoYS50ZXN0KQogICAgICAgIHRoaXMuX2p1bXBmYWxzZShlLCBiKQogICAgICAgIGYoZCwgIj0iLCB0aGlzLnZleHByKGEuYm9keSksICI7IikKICAgICAgICB0aGlzLl9qdW1wKGMpCiAgICAgICAgdGhpcy5zZXRCbG9jayhiKQogICAgICAgIGYoZCwgIj0iLCB0aGlzLnZleHByKGEub3JlbHNlKSwgIjsiKQogICAgICAgIHRoaXMuX2p1bXAoYykKICAgICAgICB0aGlzLnNldEJsb2NrKGMpCiAgICAgICAgcmV0dXJuIGQKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jZ2VuZXhwZ2VuID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICB2YXIgZCA9IHRoaXMubmV3QmxvY2soInN0YXJ0IGZvciAiICsgYiksCiAgICAgICAgICBlID0gdGhpcy5uZXdCbG9jaygic2tpcCBmb3IgIiArIGIpCiAgICAgICAgdGhpcy5uZXdCbG9jaygiaWYgY2xlYW51cCBmb3IgIiArIGIpCiAgICAgICAgdmFyIGcgPSB0aGlzLm5ld0Jsb2NrKCJlbmQgZm9yICIgKyBiKSwKICAgICAgICAgIGsgPSBhW2JdCiAgICAgICAgaWYgKDAgPT09IGIpIHZhciBoID0gIiRsb2MuJGl0ZXIwIgogICAgICAgIGVsc2UgewogICAgICAgICAgdmFyIGwgPSB0aGlzLnZleHByKGsuaXRlcikKICAgICAgICAgIGggPSAiJGxvYy4iICsgdGhpcy5nZW5zeW0oIml0ZXIiKQogICAgICAgICAgZihoLCAiPSIsICJTay5hYnN0ci5pdGVyKCIsIGwsICIpOyIpCiAgICAgICAgfQogICAgICAgIHRoaXMuX2p1bXAoZCkKICAgICAgICB0aGlzLnNldEJsb2NrKGQpCiAgICAgICAgdGhpcy5hbm5vdGF0ZVNvdXJjZShjKQogICAgICAgIGYoCiAgICAgICAgICAiJHJldCA9IFNrLmFic3RyLml0ZXJuZXh0KCIsCiAgICAgICAgICBoLAogICAgICAgICAgdGhpcy51LmNhblN1c3BlbmQgPyAiLCB0cnVlIiA6ICIsIGZhbHNlIiwKICAgICAgICAgICIpOyIsCiAgICAgICAgKQogICAgICAgIHRoaXMuX2NoZWNrU3VzcGVuc2lvbihjKQogICAgICAgIGwgPSB0aGlzLl9ncigibmV4dCIsICIkcmV0IikKICAgICAgICB0aGlzLl9qdW1wdW5kZWYobCwgZykKICAgICAgICB0aGlzLnZleHByKGsudGFyZ2V0LCBsKQogICAgICAgIHZhciBtID0gay5pZnMgPyBrLmlmcy5sZW5ndGggOiAwCiAgICAgICAgZm9yIChoID0gMDsgaCA8IG07ICsraCkKICAgICAgICAgIHRoaXMuYW5ub3RhdGVTb3VyY2Uoay5pZnNbaF0pLAogICAgICAgICAgICAobCA9IHRoaXMudmV4cHIoay5pZnNbaF0pKSwKICAgICAgICAgICAgdGhpcy5fanVtcGZhbHNlKGwsIGQpCiAgICAgICAgKytiIDwgYS5sZW5ndGggJiYgdGhpcy5jZ2VuZXhwZ2VuKGEsIGIsIGMpCiAgICAgICAgYiA+PSBhLmxlbmd0aCAmJgogICAgICAgICAgKHRoaXMuYW5ub3RhdGVTb3VyY2UoYyksCiAgICAgICAgICAoYSA9IHRoaXMudmV4cHIoYykpLAogICAgICAgICAgZigicmV0dXJuIFsiLCBlLCAiLypyZXN1bWUqLywiLCBhLCAiLypyZXQqL107IiksCiAgICAgICAgICB0aGlzLnNldEJsb2NrKGUpKQogICAgICAgIHRoaXMuX2p1bXAoZCkKICAgICAgICB0aGlzLnNldEJsb2NrKGcpCiAgICAgICAgMSA9PT0gYiAmJiBmKCJyZXR1cm4gU2suYnVpbHRpbi5ub25lLm5vbmUkOyIpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY2dlbmV4cCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIgPSB0aGlzLmJ1aWxkY29kZW9iaigKICAgICAgICAgIGEsCiAgICAgICAgICBuZXcgU2suYnVpbHRpbi5zdHIoIjxnZW5leHByPiIpLAogICAgICAgICAgbnVsbCwKICAgICAgICAgIG51bGwsCiAgICAgICAgICBmdW5jdGlvbiAoYikgewogICAgICAgICAgICB0aGlzLmNnZW5leHBnZW4oYS5nZW5lcmF0b3JzLCAwLCBhLmVsdCkKICAgICAgICAgIH0sCiAgICAgICAgKQogICAgICAgIGIgPSB0aGlzLl9ncigiZ2VuZXIiLCAiU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KCIsIGIsICIpOyIpCiAgICAgICAgZigKICAgICAgICAgIGIsCiAgICAgICAgICAiLmdpJGxvY2Fscy4kaXRlcjA9U2suYWJzdHIuaXRlcigiLAogICAgICAgICAgdGhpcy52ZXhwcihhLmdlbmVyYXRvcnNbMF0uaXRlciksCiAgICAgICAgICAiKTsiLAogICAgICAgICkKICAgICAgICByZXR1cm4gYgogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNjbGFzcyA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoYSBpbnN0YW5jZW9mIFNrLmFzdG5vZGVzLkNsYXNzRGVmKQogICAgICAgIHZhciBiID0gdGhpcy52c2VxZXhwcihhLmRlY29yYXRvcl9saXN0KQogICAgICAgIHZhciBjID0gdGhpcy52c2VxZXhwcihhLmJhc2VzKQogICAgICAgIHZhciBkID0gdGhpcy5lbnRlclNjb3BlKGEubmFtZSwgYSwgYS5saW5lbm8pCiAgICAgICAgdmFyIGUgPSB0aGlzLm5ld0Jsb2NrKCJjbGFzcyBlbnRyeSIpCiAgICAgICAgdGhpcy51LnByZWZpeENvZGUgPQogICAgICAgICAgInZhciAiICsKICAgICAgICAgIGQgKwogICAgICAgICAgIj0oZnVuY3Rpb24gJCIgKwogICAgICAgICAgYS5uYW1lLnYgKwogICAgICAgICAgIiRjbGFzc19vdXRlcigkZ2xvYmFscywkbG9jYWxzLCRjZWxsKXt2YXIgJGdibD0kZ2xvYmFscywkbG9jPSRsb2NhbHM7JGZyZWU9JGdsb2JhbHM7IgogICAgICAgIHRoaXMudS5zd2l0Y2hDb2RlICs9ICIoZnVuY3Rpb24gJCIgKyBhLm5hbWUudiArICIkX2Nsb3N1cmUoJGNlbGwpeyIKICAgICAgICB0aGlzLnUuc3dpdGNoQ29kZSArPQogICAgICAgICAgInZhciAkYmxrPSIgKwogICAgICAgICAgZSArCiAgICAgICAgICAiLCRleGM9W10sJHJldD11bmRlZmluZWQsJHBvc3RmaW5hbGx5PXVuZGVmaW5lZCwkY3VyckxpbmVObz11bmRlZmluZWQsJGN1cnJDb2xObz11bmRlZmluZWQ7IgogICAgICAgIG51bGwgIT09IFNrLmV4ZWNMaW1pdCAmJgogICAgICAgICAgKHRoaXMudS5zd2l0Y2hDb2RlICs9CiAgICAgICAgICAgICJpZiAodHlwZW9mIFNrLmV4ZWNTdGFydCA9PT0gJ3VuZGVmaW5lZCcpIHtTay5leGVjU3RhcnQgPSBEYXRlLm5vdygpfSIpCiAgICAgICAgbnVsbCAhPT0gU2sueWllbGRMaW1pdCAmJgogICAgICAgICAgdGhpcy51LmNhblN1c3BlbmQgJiYKICAgICAgICAgICh0aGlzLnUuc3dpdGNoQ29kZSArPQogICAgICAgICAgICAiaWYgKHR5cGVvZiBTay5sYXN0WWllbGQgPT09ICd1bmRlZmluZWQnKSB7U2subGFzdFlpZWxkID0gRGF0ZS5ub3coKX0iKQogICAgICAgIHRoaXMudS5zd2l0Y2hDb2RlICs9ICJ3aGlsZSh0cnVlKXt0cnl7IgogICAgICAgIHRoaXMudS5zd2l0Y2hDb2RlICs9IHRoaXMub3V0cHV0SW50ZXJydXB0VGVzdCgpCiAgICAgICAgdGhpcy51LnN3aXRjaENvZGUgKz0gInN3aXRjaCgkYmxrKXsiCiAgICAgICAgdGhpcy51LnN1ZmZpeENvZGUgPQogICAgICAgICAgIn19Y2F0Y2goZXJyKXsgaWYgKCEoZXJyIGluc3RhbmNlb2YgU2suYnVpbHRpbi5CYXNlRXhjZXB0aW9uKSkgeyBlcnIgPSBuZXcgU2suYnVpbHRpbi5FeHRlcm5hbEVycm9yKGVycik7IH0gZXJyLnRyYWNlYmFjay5wdXNoKHtsaW5lbm86ICRjdXJyTGluZU5vLCBjb2xubzogJGN1cnJDb2xObywgZmlsZW5hbWU6ICciICsKICAgICAgICAgIHRoaXMuZmlsZW5hbWUgKwogICAgICAgICAgIid9KTsgaWYgKCRleGMubGVuZ3RoPjApIHsgJGVyciA9IGVycjsgJGJsaz0kZXhjLnBvcCgpOyBjb250aW51ZTsgfSBlbHNlIHsgdGhyb3cgZXJyOyB9fX0iCiAgICAgICAgdGhpcy51LnN1ZmZpeENvZGUgKz0gIn0pLmNhbGwobnVsbCwgJGNlbGwpO30pOyIKICAgICAgICB0aGlzLnUucHJpdmF0ZV8gPSBhLm5hbWUKICAgICAgICB0aGlzLmNib2R5KGEuYm9keSwgYS5uYW1lKQogICAgICAgIGYoInJldHVybjsiKQogICAgICAgIHRoaXMuZXhpdFNjb3BlKCkKICAgICAgICBmKAogICAgICAgICAgIiRyZXQgPSBTay5taXNjZXZhbC5idWlsZENsYXNzKCRnYmwsIiwKICAgICAgICAgIGQsCiAgICAgICAgICAiLCIsCiAgICAgICAgICBhLm5hbWUuJHIoKS52LAogICAgICAgICAgIixbIiwKICAgICAgICAgIGMsCiAgICAgICAgICAiXSwgJGNlbGwpOyIsCiAgICAgICAgKQogICAgICAgIGZvciAobGV0IGEgb2YgYikKICAgICAgICAgIGYoIiRyZXQgPSBTay5taXNjZXZhbC5jYWxsc2ltT3JTdXNwZW5kQXJyYXkoIiwgYSwgIiwgWyRyZXRdKTsiKSwKICAgICAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKCkKICAgICAgICB0aGlzLm5hbWVvcChhLm5hbWUsIFNrLmFzdG5vZGVzLlN0b3JlLCAiJHJldCIpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY2NvbnRpbnVlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBhID0gdGhpcy5wZWVrRmluYWxseUJsb2NrKCkKICAgICAgICBpZiAoMCA9PSB0aGlzLnUuY29udGludWVCbG9ja3MubGVuZ3RoKQogICAgICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKCInY29udGludWUnIG91dHNpZGUgbG9vcCIpCiAgICAgICAgdmFyIGIgPSB0aGlzLnUuY29udGludWVCbG9ja3NbdGhpcy51LmNvbnRpbnVlQmxvY2tzLmxlbmd0aCAtIDFdCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoCiAgICAgICAgICB0aGlzLnUuYnJlYWtCbG9ja3MubGVuZ3RoID09PSB0aGlzLnUuY29udGludWVCbG9ja3MubGVuZ3RoLAogICAgICAgICkKICAgICAgICBhICYmIGEuYnJlYWtEZXB0aCA9PSB0aGlzLnUuY29udGludWVCbG9ja3MubGVuZ3RoCiAgICAgICAgICA/IGYoIiRwb3N0ZmluYWxseT17aXNCcmVhazp0cnVlLGdvdG9CbG9jazoiLCBiLCAifTsiKQogICAgICAgICAgOiB0aGlzLl9qdW1wKGIpCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuY2JyZWFrID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBhID0gdGhpcy5wZWVrRmluYWxseUJsb2NrKCkKICAgICAgICBpZiAoMCA9PT0gdGhpcy51LmJyZWFrQmxvY2tzLmxlbmd0aCkKICAgICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcigiJ2JyZWFrJyBvdXRzaWRlIGxvb3AiKQogICAgICAgIHZhciBiID0gdGhpcy51LmJyZWFrQmxvY2tzW3RoaXMudS5icmVha0Jsb2Nrcy5sZW5ndGggLSAxXQogICAgICAgIGEgJiYgYS5icmVha0RlcHRoID09IHRoaXMudS5icmVha0Jsb2Nrcy5sZW5ndGgKICAgICAgICAgID8gZigiJHBvc3RmaW5hbGx5PXtpc0JyZWFrOnRydWUsZ290b0Jsb2NrOiIsIGIsICJ9OyIpCiAgICAgICAgICA6IHRoaXMuX2p1bXAoYikKICAgICAgfQogICAgICBhLnByb3RvdHlwZS52c3RtdCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdGhpcy51LmxpbmVubyA9IGEubGluZW5vCiAgICAgICAgdGhpcy51LmxpbmVub1NldCA9ICExCiAgICAgICAgdGhpcy51LmxvY2FsdGVtcHMgPSBbXQogICAgICAgIGlmIChTay5kZWJ1Z2dpbmcgJiYgdGhpcy51LmNhblN1c3BlbmQpIHsKICAgICAgICAgIHZhciBjID0gdGhpcy5uZXdCbG9jaygiZGVidWcgYnJlYWtwb2ludCBmb3IgbGluZSAiICsgYS5saW5lbm8pCiAgICAgICAgICBmKAogICAgICAgICAgICAiaWYgKFNrLmJyZWFrcG9pbnRzKCciICsKICAgICAgICAgICAgICB0aGlzLmZpbGVuYW1lICsKICAgICAgICAgICAgICAiJywiICsKICAgICAgICAgICAgICBhLmxpbmVubyArCiAgICAgICAgICAgICAgIiwiICsKICAgICAgICAgICAgICBhLmNvbF9vZmZzZXQgKwogICAgICAgICAgICAgICIpKSB7IiwKICAgICAgICAgICAgInZhciAkc3VzcCA9ICRzYXZlU3VzcGVuc2lvbih7ZGF0YToge3R5cGU6ICdTay5kZWJ1Zyd9LCByZXN1bWU6IGZ1bmN0aW9uKCkge319LCAnIiArCiAgICAgICAgICAgICAgdGhpcy5maWxlbmFtZSArCiAgICAgICAgICAgICAgIicsIiArCiAgICAgICAgICAgICAgYS5saW5lbm8gKwogICAgICAgICAgICAgICIsIiArCiAgICAgICAgICAgICAgYS5jb2xfb2Zmc2V0ICsKICAgICAgICAgICAgICAiKTsiLAogICAgICAgICAgICAiJHN1c3AuJGJsayA9ICIgKyBjICsgIjsiLAogICAgICAgICAgICAiJHN1c3Aub3B0aW9uYWwgPSB0cnVlOyIsCiAgICAgICAgICAgICJyZXR1cm4gJHN1c3A7IiwKICAgICAgICAgICAgIn0iLAogICAgICAgICAgKQogICAgICAgICAgdGhpcy5fanVtcChjKQogICAgICAgICAgdGhpcy5zZXRCbG9jayhjKQogICAgICAgICAgdGhpcy51LmRvZXNTdXNwZW5kID0gITAKICAgICAgICB9CiAgICAgICAgdGhpcy5hbm5vdGF0ZVNvdXJjZShhKQogICAgICAgIHN3aXRjaCAoYS5jb25zdHJ1Y3RvcikgewogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5GdW5jdGlvbkRlZjoKICAgICAgICAgICAgdGhpcy5jZnVuY3Rpb24oYSwgYikKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQ2xhc3NEZWY6CiAgICAgICAgICAgIHRoaXMuY2NsYXNzKGEpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlJldHVybjoKICAgICAgICAgICAgaWYgKHRoaXMudS5zdGUuYmxvY2tUeXBlICE9PSBTay5TWU1UQUJfQ09OU1RTLkZ1bmN0aW9uQmxvY2spCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKCIncmV0dXJuJyBvdXRzaWRlIGZ1bmN0aW9uIikKICAgICAgICAgICAgYyA9IGEudmFsdWUgPyB0aGlzLnZleHByKGEudmFsdWUpIDogIlNrLmJ1aWx0aW4ubm9uZS5ub25lJCIKICAgICAgICAgICAgMCA9PSB0aGlzLnUuZmluYWxseUJsb2Nrcy5sZW5ndGgKICAgICAgICAgICAgICA/IGYoInJldHVybiAiLCBjLCAiOyIpCiAgICAgICAgICAgICAgOiAoZigiJHBvc3RmaW5hbGx5PXtyZXR1cm5pbmc6IiwgYywgIn07IiksCiAgICAgICAgICAgICAgICB0aGlzLl9qdW1wKHRoaXMucGVla0ZpbmFsbHlCbG9jaygpLmJsaykpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkRlbGV0ZToKICAgICAgICAgICAgdGhpcy52c2VxZXhwcihhLnRhcmdldHMpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkFzc2lnbjoKICAgICAgICAgICAgdmFyIGQgPSBhLnRhcmdldHMubGVuZ3RoCiAgICAgICAgICAgIGMgPSB0aGlzLnZleHByKGEudmFsdWUpCiAgICAgICAgICAgIGZvciAoYiA9IDA7IGIgPCBkOyArK2IpIHRoaXMudmV4cHIoYS50YXJnZXRzW2JdLCBjKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5Bbm5Bc3NpZ246CiAgICAgICAgICAgIGMgPSB0aGlzLnZleHByKGEudmFsdWUpCiAgICAgICAgICAgIHRoaXMudmV4cHIoYS50YXJnZXQsIGMpCiAgICAgICAgICAgIHRoaXMudmV4cHIoYS5hbm5vdGF0aW9uKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5BdWdBc3NpZ246CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNhdWdhc3NpZ24oYSkKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuUHJpbnQ6CiAgICAgICAgICAgIHRoaXMuY3ByaW50KGEpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkZvcjoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2ZvcihhKQogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5XaGlsZToKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3doaWxlKGEpCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLklmOgogICAgICAgICAgICByZXR1cm4gdGhpcy5jaWYoYSkKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuUmFpc2U6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyYWlzZShhKQogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5Ucnk6CiAgICAgICAgICAgIHJldHVybiB0aGlzLmN0cnkoYSkKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuV2l0aDoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3dpdGgoYSwgMCkKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQXNzZXJ0OgogICAgICAgICAgICByZXR1cm4gdGhpcy5jYXNzZXJ0KGEpCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkltcG9ydDoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2ltcG9ydChhKQogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5JbXBvcnRGcm9tOgogICAgICAgICAgICByZXR1cm4gdGhpcy5jZnJvbWltcG9ydChhKQogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5HbG9iYWw6CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkV4cHI6CiAgICAgICAgICAgIHRoaXMudmV4cHIoYS52YWx1ZSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuUGFzczoKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuQnJlYWs6CiAgICAgICAgICAgIHRoaXMuY2JyZWFrKGEpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkNvbnRpbnVlOgogICAgICAgICAgICB0aGlzLmNjb250aW51ZShhKQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5EZWJ1Z2dlcjoKICAgICAgICAgICAgZigiZGVidWdnZXI7IikKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIFNrLmFzc2VydHMuZmFpbCgidW5oYW5kbGVkIGNhc2UgaW4gdnN0bXQ6ICIgKyBKU09OLnN0cmluZ2lmeShhKSkKICAgICAgICB9CiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUudnNlcXN0bXQgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGEubGVuZ3RoOyArK2IpIHRoaXMudnN0bXQoYVtiXSkKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5pc0NlbGwgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIGEgPSBlKHRoaXMudS5wcml2YXRlXywgYSkudgogICAgICAgIHJldHVybiB0aGlzLnUuc3RlLmdldFNjb3BlKGEpID09PSBTay5TWU1UQUJfQ09OU1RTLkNFTEwKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5uYW1lb3AgPSBmdW5jdGlvbiAoYSwgYiwgZykgewogICAgICAgIGlmICgKICAgICAgICAgIChiID09PSBTay5hc3Rub2Rlcy5TdG9yZSB8fAogICAgICAgICAgICBiID09PSBTay5hc3Rub2Rlcy5BdWdTdG9yZSB8fAogICAgICAgICAgICBiID09PSBTay5hc3Rub2Rlcy5EZWwpICYmCiAgICAgICAgICAiX19kZWJ1Z19fIiA9PT0gYS52CiAgICAgICAgKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uU3ludGF4RXJyb3IoImNhbiBub3QgYXNzaWduIHRvIF9fZGVidWdfXyIpCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoIk5vbmUiICE9PSBhLnYpCiAgICAgICAgaWYgKCJOb3RJbXBsZW1lbnRlZCIgPT09IGEudikKICAgICAgICAgIHJldHVybiAiU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZC5Ob3RJbXBsZW1lbnRlZCQiCiAgICAgICAgdmFyIGsgPSBlKHRoaXMudS5wcml2YXRlXywgYSkudgogICAgICAgIGsgPSBkKGspCiAgICAgICAgdmFyIGggPSAzCiAgICAgICAgdmFyIGwgPSB0aGlzLnUuc3RlLmdldFNjb3BlKGspCiAgICAgICAgdmFyIG0gPSBudWxsCiAgICAgICAgc3dpdGNoIChsKSB7CiAgICAgICAgICBjYXNlIFNrLlNZTVRBQl9DT05TVFMuRlJFRToKICAgICAgICAgICAgbSA9ICIkZnJlZSIKICAgICAgICAgICAgaCA9IDIKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suU1lNVEFCX0NPTlNUUy5DRUxMOgogICAgICAgICAgICBtID0gIiRjZWxsIgogICAgICAgICAgICBoID0gMgogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSBTay5TWU1UQUJfQ09OU1RTLkxPQ0FMOgogICAgICAgICAgICB0aGlzLnUuc3RlLmJsb2NrVHlwZSAhPT0gU2suU1lNVEFCX0NPTlNUUy5GdW5jdGlvbkJsb2NrIHx8CiAgICAgICAgICAgICAgdGhpcy51LnN0ZS5nZW5lcmF0b3IgfHwKICAgICAgICAgICAgICAoaCA9IDApCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIFNrLlNZTVRBQl9DT05TVFMuR0xPQkFMX0lNUExJQ0lUOgogICAgICAgICAgICB0aGlzLnUuc3RlLmJsb2NrVHlwZSA9PT0gU2suU1lNVEFCX0NPTlNUUy5GdW5jdGlvbkJsb2NrICYmIChoID0gMSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgU2suU1lNVEFCX0NPTlNUUy5HTE9CQUxfRVhQTElDSVQ6CiAgICAgICAgICAgIGggPSAxCiAgICAgICAgfQogICAgICAgIGsgPSBjKGspCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQobCB8fCAiXyIgPT09IGEudi5jaGFyQXQoMSkpCiAgICAgICAgYSA9IGsKICAgICAgICB0aGlzLnUuc3RlLmdlbmVyYXRvciB8fAogICAgICAgIHRoaXMudS5zdGUuYmxvY2tUeXBlICE9PSBTay5TWU1UQUJfQ09OU1RTLkZ1bmN0aW9uQmxvY2sKICAgICAgICAgID8gKGsgPSAiJGxvYy4iICsgaykKICAgICAgICAgIDogKDAgPT09IGggfHwgMyA9PT0gaCkgJiYgdGhpcy51LmxvY2FsbmFtZXMucHVzaChrKQogICAgICAgIHN3aXRjaCAoaCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBzd2l0Y2ggKGIpIHsKICAgICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkxvYWQ6CiAgICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5QYXJhbToKICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgIGYoCiAgICAgICAgICAgICAgICAgICAgImlmICgiLAogICAgICAgICAgICAgICAgICAgIGssCiAgICAgICAgICAgICAgICAgICAgIiA9PT0gdW5kZWZpbmVkKSB7IHRocm93IG5ldyBTay5idWlsdGluLlVuYm91bmRMb2NhbEVycm9yKCdsb2NhbCB2YXJpYWJsZSBcXCciLAogICAgICAgICAgICAgICAgICAgIGssCiAgICAgICAgICAgICAgICAgICAgIlxcJyByZWZlcmVuY2VkIGJlZm9yZSBhc3NpZ25tZW50Jyk7IH1cbiIsCiAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgIGsKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlN0b3JlOgogICAgICAgICAgICAgICAgZihrLCAiPSIsIGcsICI7IikKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5EZWw6CiAgICAgICAgICAgICAgICBmKCJkZWxldGUgIiwgaywgIjsiKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJ1bmhhbmRsZWQiKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHN3aXRjaCAoYikgewogICAgICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuTG9hZDoKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ncigKICAgICAgICAgICAgICAgICAgImxvYWRuYW1lIiwKICAgICAgICAgICAgICAgICAgaywKICAgICAgICAgICAgICAgICAgIiE9PXVuZGVmaW5lZD8iLAogICAgICAgICAgICAgICAgICBrLAogICAgICAgICAgICAgICAgICAiOlNrLm1pc2NldmFsLmxvYWRuYW1lKCciLAogICAgICAgICAgICAgICAgICBhLAogICAgICAgICAgICAgICAgICAiJywkZ2JsKTsiLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuU3RvcmU6CiAgICAgICAgICAgICAgICBmKGssICI9IiwgZywgIjsiKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkRlbDoKICAgICAgICAgICAgICAgIGYoImRlbGV0ZSAiLCBrLCAiOyIpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuUGFyYW06CiAgICAgICAgICAgICAgICByZXR1cm4gawogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoInVuaGFuZGxlZCIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgc3dpdGNoIChiKSB7CiAgICAgICAgICAgICAgY2FzZSBTay5hc3Rub2Rlcy5Mb2FkOgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dyKAogICAgICAgICAgICAgICAgICAibG9hZGdibCIsCiAgICAgICAgICAgICAgICAgICJTay5taXNjZXZhbC5sb2FkbmFtZSgnIiwKICAgICAgICAgICAgICAgICAgYSwKICAgICAgICAgICAgICAgICAgIicsJGdibCkiLAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgIGNhc2UgU2suYXN0bm9kZXMuU3RvcmU6CiAgICAgICAgICAgICAgICBmKCIkZ2JsLiIsIGEsICI9IiwgZywgIjsiKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkRlbDoKICAgICAgICAgICAgICAgIGYoImRlbGV0ZSAkZ2JsLiIsIGEpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoInVuaGFuZGxlZCBjYXNlIGluIG5hbWUgb3BfZ2xvYmFsIikKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICBzd2l0Y2ggKGIpIHsKICAgICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLkxvYWQ6CiAgICAgICAgICAgICAgICByZXR1cm4gbSArICIuIiArIGEKICAgICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlN0b3JlOgogICAgICAgICAgICAgICAgZihtLCAiLiIsIGEsICI9IiwgZywgIjsiKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLlBhcmFtOgogICAgICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJ1bmhhbmRsZWQgY2FzZSBpbiBuYW1lIG9wX2RlcmVmIikKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhawogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgU2suYXNzZXJ0cy5mYWlsKCJ1bmhhbmRsZWQgY2FzZSIpCiAgICAgICAgfQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmVudGVyU2NvcGUgPSBmdW5jdGlvbiAoYSwgYywgZCwgZSkgewogICAgICAgIHZhciBmID0gbmV3IGIoKQogICAgICAgIGYuc3RlID0gdGhpcy5zdC5nZXRTdHNGb3JBc3QoYykKICAgICAgICBmLm5hbWUgPSBhCiAgICAgICAgZi5maXJzdGxpbmVubyA9IGQKICAgICAgICBmLmNhblN1c3BlbmQgPSBlIHx8ICExCiAgICAgICAgdGhpcy51ICYmIHRoaXMudS5wcml2YXRlXyAmJiAoZi5wcml2YXRlXyA9IHRoaXMudS5wcml2YXRlXykKICAgICAgICB0aGlzLnN0YWNrLnB1c2godGhpcy51KQogICAgICAgIHRoaXMuYWxsVW5pdHMucHVzaChmKQogICAgICAgIGEgPSB0aGlzLmdlbnN5bSgic2NvcGUiKQogICAgICAgIGYuc2NvcGVuYW1lID0gYQogICAgICAgIHRoaXMudSA9IGYKICAgICAgICB0aGlzLnUuYWN0aXZhdGVTY29wZSgpCiAgICAgICAgdGhpcy5uZXN0bGV2ZWwrKwogICAgICAgIHJldHVybiBhCiAgICAgIH0KICAgICAgYS5wcm90b3R5cGUuZXhpdFNjb3BlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBhID0gdGhpcy51CiAgICAgICAgdGhpcy5uZXN0bGV2ZWwtLQogICAgICAgIDsodGhpcy51ID0gMCA8PSB0aGlzLnN0YWNrLmxlbmd0aCAtIDEgPyB0aGlzLnN0YWNrLnBvcCgpIDogbnVsbCkgJiYKICAgICAgICAgIHRoaXMudS5hY3RpdmF0ZVNjb3BlKCkKICAgICAgICBpZiAoIjxtb2R1bGU+IiAhPT0gYS5uYW1lLnYpIHsKICAgICAgICAgIHZhciBiID0gYS5uYW1lLiRyKCkudgogICAgICAgICAgYiA9IGIuc3Vic3RyaW5nKDEsIGIubGVuZ3RoIC0gMSkKICAgICAgICAgIGIgPSBjKGIpCiAgICAgICAgICBiID0gZChiKQogICAgICAgICAgZihhLnNjb3BlbmFtZSwgIi5jb19uYW1lPW5ldyBTay5idWlsdGluc1snc3RyJ10oJyIsIGIsICInKTsiKQogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBlIGluIGEuY29uc3RzKQogICAgICAgICAgYS5jb25zdHMuaGFzT3duUHJvcGVydHkoZSkgJiYKICAgICAgICAgICAgKGEuc3VmZml4Q29kZSArPSBlICsgIiA9ICIgKyBhLmNvbnN0c1tlXSArICI7IikKICAgICAgfQogICAgICBhLnByb3RvdHlwZS5jYm9keSA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIGMKICAgICAgICBmb3IgKGMgPSAwOyBjIDwgYS5sZW5ndGg7ICsrYykgdGhpcy52c3RtdChhW2NdLCBiKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNwcmludCA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChhIGluc3RhbmNlb2YgU2suYXN0bm9kZXMuUHJpbnQpCiAgICAgICAgYS5kZXN0ICYmIHRoaXMudmV4cHIoYS5kZXN0KQogICAgICAgIHZhciBjID0gYS52YWx1ZXMubGVuZ3RoCiAgICAgICAgZm9yIChiID0gMDsgYiA8IGM7ICsrYikKICAgICAgICAgIGYoCiAgICAgICAgICAgICIkcmV0ID0gU2subWlzY2V2YWwucHJpbnRfKCIsCiAgICAgICAgICAgICJuZXcgU2suYnVpbHRpbnNbJ3N0ciddKCIsCiAgICAgICAgICAgIHRoaXMudmV4cHIoYS52YWx1ZXNbYl0pLAogICAgICAgICAgICAiKS52KTsiLAogICAgICAgICAgKSwKICAgICAgICAgICAgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKGEpCiAgICAgICAgYS5ubCAmJgogICAgICAgICAgKGYoIiRyZXQgPSBTay5taXNjZXZhbC5wcmludF8oIiwgJyJcXG4iKTsnKSwgdGhpcy5fY2hlY2tTdXNwZW5zaW9uKGEpKQogICAgICB9CiAgICAgIGEucHJvdG90eXBlLmNtb2QgPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiID0gdGhpcy5lbnRlclNjb3BlKAogICAgICAgICAgICBuZXcgU2suYnVpbHRpbi5zdHIoIjxtb2R1bGU+IiksCiAgICAgICAgICAgIGEsCiAgICAgICAgICAgIDAsCiAgICAgICAgICAgIHRoaXMuY2FuU3VzcGVuZCwKICAgICAgICAgICksCiAgICAgICAgICBjID0gdGhpcy5uZXdCbG9jaygibW9kdWxlIGVudHJ5IikKICAgICAgICB0aGlzLnUucHJlZml4Q29kZSA9ICJ2YXIgIiArIGIgKyAiPShmdW5jdGlvbigkZm9yY2VnYmwpeyIKICAgICAgICB0aGlzLnUudmFyRGVjbHNDb2RlID0KICAgICAgICAgICJ2YXIgJGdibCA9ICRmb3JjZWdibCB8fCB7fSwgJGJsaz0iICsKICAgICAgICAgIGMgKwogICAgICAgICAgIiwkZXhjPVtdLCRsb2M9JGdibCwkY2VsbD17fSwkZXJyPXVuZGVmaW5lZDskbG9jLl9fZmlsZV9fPW5ldyBTay5idWlsdGlucy5zdHIoJyIgKwogICAgICAgICAgdGhpcy5maWxlbmFtZSArCiAgICAgICAgICAiJyk7dmFyICRyZXQ9dW5kZWZpbmVkLCRwb3N0ZmluYWxseT11bmRlZmluZWQsJGN1cnJMaW5lTm89dW5kZWZpbmVkLCRjdXJyQ29sTm89dW5kZWZpbmVkOyIKICAgICAgICBudWxsICE9PSBTay5leGVjTGltaXQgJiYKICAgICAgICAgICh0aGlzLnUudmFyRGVjbHNDb2RlICs9CiAgICAgICAgICAgICJpZiAodHlwZW9mIFNrLmV4ZWNTdGFydCA9PT0gJ3VuZGVmaW5lZCcpIHtTay5leGVjU3RhcnQgPSBEYXRlLm5vdygpfSIpCiAgICAgICAgbnVsbCAhPT0gU2sueWllbGRMaW1pdCAmJgogICAgICAgICAgdGhpcy51LmNhblN1c3BlbmQgJiYKICAgICAgICAgICh0aGlzLnUudmFyRGVjbHNDb2RlICs9CiAgICAgICAgICAgICJpZiAodHlwZW9mIFNrLmxhc3RZaWVsZCA9PT0gJ3VuZGVmaW5lZCcpIHtTay5sYXN0WWllbGQgPSBEYXRlLm5vdygpfSIpCiAgICAgICAgdGhpcy51LnZhckRlY2xzQ29kZSArPQogICAgICAgICAgImlmICgiICsKICAgICAgICAgIGIgKwogICAgICAgICAgIi4kd2FraW5nU3VzcGVuc2lvbiE9PXVuZGVmaW5lZCkgeyAkd2FrZUZyb21TdXNwZW5zaW9uKCk7IH1pZiAoU2sucmV0YWluR2xvYmFscykgeyAgICBpZiAoU2suZ2xvYmFscykgeyAkZ2JsID0gU2suZ2xvYmFsczsgU2suZ2xvYmFscyA9ICRnYmw7ICRsb2MgPSAkZ2JsOyB9ICAgIGlmIChTay5nbG9iYWxzKSB7ICRnYmwgPSBTay5nbG9iYWxzOyBTay5nbG9iYWxzID0gJGdibDsgJGxvYyA9ICRnYmw7ICRsb2MuX19maWxlX189bmV3IFNrLmJ1aWx0aW5zLnN0cignIiArCiAgICAgICAgICB0aGlzLmZpbGVuYW1lICsKICAgICAgICAgICInKTt9ICAgIGVsc2UgeyBTay5nbG9iYWxzID0gJGdibDsgfX0gZWxzZSB7IFNrLmdsb2JhbHMgPSAkZ2JsOyB9IgogICAgICAgIHRoaXMudS5zd2l0Y2hDb2RlID0gIndoaWxlKHRydWUpe3RyeXsiCiAgICAgICAgdGhpcy51LnN3aXRjaENvZGUgKz0gdGhpcy5vdXRwdXRJbnRlcnJ1cHRUZXN0KCkKICAgICAgICB0aGlzLnUuc3dpdGNoQ29kZSArPSAic3dpdGNoKCRibGspeyIKICAgICAgICB0aGlzLnUuc3VmZml4Q29kZSA9ICJ9IgogICAgICAgIHRoaXMudS5zdWZmaXhDb2RlICs9CiAgICAgICAgICAifWNhdGNoKGVycil7IGlmICghKGVyciBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4uQmFzZUV4Y2VwdGlvbikpIHsgZXJyID0gbmV3IFNrLmJ1aWx0aW4uRXh0ZXJuYWxFcnJvcihlcnIpOyB9IGVyci50cmFjZWJhY2sucHVzaCh7bGluZW5vOiAkY3VyckxpbmVObywgY29sbm86ICRjdXJyQ29sTm8sIGZpbGVuYW1lOiAnIiArCiAgICAgICAgICB0aGlzLmZpbGVuYW1lICsKICAgICAgICAgICInfSk7IGlmICgkZXhjLmxlbmd0aD4wKSB7ICRlcnIgPSBlcnI7ICRibGs9JGV4Yy5wb3AoKTsgY29udGludWU7IH0gZWxzZSB7IHRocm93IGVycjsgfX0gfSB9KTsiCiAgICAgICAgc3dpdGNoIChhLmNvbnN0cnVjdG9yKSB7CiAgICAgICAgICBjYXNlIFNrLmFzdG5vZGVzLk1vZHVsZToKICAgICAgICAgICAgdGhpcy5jYm9keShhLmJvZHkpCiAgICAgICAgICAgIGYoInJldHVybiAkbG9jOyIpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBTay5hc3NlcnRzLmZhaWwoInRvZG87IHVuaGFuZGxlZCBjYXNlIGluIGNvbXBpbGVyTW9kIikKICAgICAgICB9CiAgICAgICAgdGhpcy5leGl0U2NvcGUoKQogICAgICAgIHRoaXMucmVzdWx0LnB1c2godGhpcy5vdXRwdXRBbGxVbml0cygpKQogICAgICAgIHJldHVybiBiCiAgICAgIH0KICAgICAgU2suY29tcGlsZSA9IGZ1bmN0aW9uIChiLCBjLCBkLCBlKSB7CiAgICAgICAgZCA9IFNrLl9fZnV0dXJlX18KICAgICAgICBTay5fX2Z1dHVyZV9fID0gT2JqZWN0LmNyZWF0ZShTay5fX2Z1dHVyZV9fKQogICAgICAgIHZhciBmID0gU2sucGFyc2UoYywgYiksCiAgICAgICAgICBnID0gU2suYXN0RnJvbVBhcnNlKGYuY3N0LCBjLCBmLmZsYWdzKQogICAgICAgIGYgPSBmLmZsYWdzCiAgICAgICAgdmFyIGggPSBTay5zeW1ib2x0YWJsZShnLCBjKQogICAgICAgIGIgPSBuZXcgYShjLCBoLCBmLCBlLCBiKQogICAgICAgIGMgPSBiLmNtb2QoZykKICAgICAgICBTay5fX2Z1dHVyZV9fID0gZAogICAgICAgIHJldHVybiB7CiAgICAgICAgICBmdW5jbmFtZTogIiRjb21waWxlZG1vZCIsCiAgICAgICAgICBjb2RlOgogICAgICAgICAgICAiJGNvbXBpbGVkbW9kID0gZnVuY3Rpb24oKSB7IiArCiAgICAgICAgICAgIGIucmVzdWx0LmpvaW4oIiIpICsKICAgICAgICAgICAgIlxucmV0dXJuICIgKwogICAgICAgICAgICBjICsKICAgICAgICAgICAgIjt9KCk7IiwKICAgICAgICB9CiAgICAgIH0KICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5jb21waWxlIiwgU2suY29tcGlsZSkKICAgICAgU2sucmVzZXRDb21waWxlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBTay5nZW5zeW1jb3VudCA9IDAKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLnJlc2V0Q29tcGlsZXIiLCBTay5yZXNldENvbXBpbGVyKQogICAgICBTay5maXhSZXNlcnZlZFdvcmRzID0gYwogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmZpeFJlc2VydmVkV29yZHMiLCBTay5maXhSZXNlcnZlZFdvcmRzKQogICAgICBTay5maXhSZXNlcnZlZE5hbWVzID0gZAogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmZpeFJlc2VydmVkTmFtZXMiLCBTay5maXhSZXNlcnZlZE5hbWVzKQogICAgICBTay51bmZpeFJlc2VydmVkID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gYS5yZXBsYWNlKC9fXCRyW3duXVwkJC8sICIiKQogICAgICB9CiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2sudW5maXhSZXNlcnZlZCIsIFNrLnVuZml4UmVzZXJ2ZWQpCiAgICAgIFNrLm1hbmdsZU5hbWUgPSBlCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2subWFuZ2xlTmFtZSIsIFNrLm1hbmdsZU5hbWUpCiAgICB9LAogICAgZnVuY3Rpb24gKG0sIHApIHsKICAgICAgU2suc3lzbW9kdWxlcyA9IG5ldyBTay5idWlsdGluLmRpY3QoW10pCiAgICAgIFNrLnJlYWxzeXNwYXRoID0gdm9pZCAwCiAgICAgIFNrLmltcG9ydFNlYXJjaFBhdGhGb3JOYW1lID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICB2YXIgZCA9IGEucmVwbGFjZSgvXC4vZywgIi8iKSwKICAgICAgICAgIGUgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwuY2hhaW4oCiAgICAgICAgICAgICAgU2subWlzY2V2YWwudHJ5Q2F0Y2goCiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBTay5yZWFkKGEpCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZnVuY3Rpb24gKGEpIHt9LAogICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgZnVuY3Rpb24gKGMpIHsKICAgICAgICAgICAgICAgIGlmICh2b2lkIDAgIT09IGMpCiAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2subWlzY2V2YWwuQnJlYWsoewogICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lOiBhLAogICAgICAgICAgICAgICAgICAgIGNvZGU6IGMsCiAgICAgICAgICAgICAgICAgICAgcGFja2FnZVBhdGg6IGIsCiAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKQogICAgICAgICAgfQogICAgICAgIHZvaWQgMCA9PT0gYyAmJiAoYyA9IFNrLnJlYWxzeXNwYXRoKQogICAgICAgIHJldHVybiBTay5taXNjZXZhbC5pdGVyRm9yKGMudHAkaXRlcigpLCBmdW5jdGlvbiAoYSkgewogICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmNoYWluKGUoYS52ICsgIi8iICsgZCArIGIsICExKSwgZnVuY3Rpb24gKGMpIHsKICAgICAgICAgICAgcmV0dXJuIGMgPyBjIDogZShhLnYgKyAiLyIgKyBkICsgIi9fX2luaXRfXyIgKyBiLCBhLnYgKyAiLyIgKyBkKQogICAgICAgICAgfSkKICAgICAgICB9KQogICAgICB9CiAgICAgIFNrLmRvT25lVGltZUluaXRpYWxpemF0aW9uID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB2YXIgYgogICAgICAgIFNrLmJ1aWx0aW4udHlwZS5iYXNlc1N0cl8gPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fYmFzZXNfXyIpCiAgICAgICAgU2suYnVpbHRpbi50eXBlLm1yb1N0cl8gPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fbXJvX18iKQogICAgICAgIGZvciAoZiBpbiBTay5idWlsdGluKQogICAgICAgICAgaWYgKAogICAgICAgICAgICAoKGEgPSBTay5idWlsdGluW2ZdKSwKICAgICAgICAgICAgKGEucHJvdG90eXBlIGluc3RhbmNlb2YgU2suYnVpbHRpbi5vYmplY3QgfHwKICAgICAgICAgICAgICBhID09PSBTay5idWlsdGluLm9iamVjdCkgJiYKICAgICAgICAgICAgICAhYS5zayRhYnN0cmFjdCkKICAgICAgICAgICkgewogICAgICAgICAgICB2YXIgYyA9IGEKICAgICAgICAgICAgdmFyIGQgPSBbXQogICAgICAgICAgICBmb3IgKGEgPSBjLnRwJGJhc2U7IHZvaWQgMCAhPT0gYTsgYSA9IGEudHAkYmFzZSkgZC5wdXNoKGEpCiAgICAgICAgICAgIGMudHAkbXJvID0gbmV3IFNrLmJ1aWx0aW4udHVwbGUoW2NdKQogICAgICAgICAgICBjLnRwJGJhc2UgfHwgKGMudHAkYmFzZSA9IGRbMF0pCiAgICAgICAgICAgIGMuJGQgPSBuZXcgU2suYnVpbHRpbi5kaWN0KFtdKQogICAgICAgICAgICBjLiRkLm1wJGFzc19zdWJzY3JpcHQoCiAgICAgICAgICAgICAgU2suYnVpbHRpbi50eXBlLmJhc2VzU3RyXywKICAgICAgICAgICAgICBuZXcgU2suYnVpbHRpbi50dXBsZShkKSwKICAgICAgICAgICAgKQogICAgICAgICAgICBjLiRkLm1wJGFzc19zdWJzY3JpcHQoU2suYnVpbHRpbi50eXBlLm1yb1N0cl8sIGMudHAkbXJvKQogICAgICAgICAgfQogICAgICAgIGQgPSBbCiAgICAgICAgICBTay5idWlsdGluLm9iamVjdCwKICAgICAgICAgIFNrLmJ1aWx0aW4udHlwZSwKICAgICAgICAgIFNrLmJ1aWx0aW4uZnVuYywKICAgICAgICAgIFNrLmJ1aWx0aW4ubWV0aG9kLAogICAgICAgIF0KICAgICAgICBmb3IgKGMgPSAwOyBjIDwgZC5sZW5ndGg7IGMrKykgewogICAgICAgICAgdmFyIGUgPSBkW2NdCiAgICAgICAgICB2YXIgZiA9IGUucHJvdG90eXBlCiAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgZS5weXRob25GdW5jdGlvbnMubGVuZ3RoOyBiKyspIHsKICAgICAgICAgICAgYSA9IGUucHl0aG9uRnVuY3Rpb25zW2JdCiAgICAgICAgICAgIGlmIChmW2FdIGluc3RhbmNlb2YgU2suYnVpbHRpbi5mdW5jKSBicmVhawogICAgICAgICAgICBmW2FdLmNvX2t3YXJncyA9IG51bGwKICAgICAgICAgICAgZlthXSA9IG5ldyBTay5idWlsdGluLmZ1bmMoZlthXSkKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgZyBpbiBTay5pbnRlcm5hbFB5LmZpbGVzKQogICAgICAgICAgKGYgPSBnLnNwbGl0KCIuIilbMF0uc3BsaXQoIi8iKVsxXSksCiAgICAgICAgICAgIChhID0gU2suaW1wb3J0QnVpbHRpbldpdGhCb2R5KGYsICExLCBTay5pbnRlcm5hbFB5LmZpbGVzW2ddLCAhMCkpLAogICAgICAgICAgICAoYSA9IFNrLm1pc2NldmFsLnJldHJ5T3B0aW9uYWxTdXNwZW5zaW9uT3JUaHJvdyhhKSksCiAgICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KAogICAgICAgICAgICAgIHZvaWQgMCAhPT0gYS4kZFtmXSwKICAgICAgICAgICAgICAiU2hvdWxkIGhhdmUgaW1wb3J0ZWQgbmFtZSAiICsgZiwKICAgICAgICAgICAgKSwKICAgICAgICAgICAgKFNrLmJ1aWx0aW5zW2ZdID0gYS4kZFtmXSkKICAgICAgfQogICAgICBTay5pbXBvcnRTZXRVcFBhdGggPSBmdW5jdGlvbiAoYSkgewogICAgICAgIHZhciBiCiAgICAgICAgaWYgKCFTay5yZWFsc3lzcGF0aCkgewogICAgICAgICAgdmFyIGMgPSBbCiAgICAgICAgICAgIG5ldyBTay5idWlsdGluLnN0cigic3JjL2J1aWx0aW4iKSwKICAgICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uc3RyKCJzcmMvbGliIiksCiAgICAgICAgICAgIG5ldyBTay5idWlsdGluLnN0cigiLiIpLAogICAgICAgICAgXQogICAgICAgICAgZm9yIChiID0gMDsgYiA8IFNrLnN5c3BhdGgubGVuZ3RoOyArK2IpCiAgICAgICAgICAgIGMucHVzaChuZXcgU2suYnVpbHRpbi5zdHIoU2suc3lzcGF0aFtiXSkpCiAgICAgICAgICBTay5yZWFsc3lzcGF0aCA9IG5ldyBTay5idWlsdGluLmxpc3QoYykKICAgICAgICAgIFNrLmRvT25lVGltZUluaXRpYWxpemF0aW9uKGEpCiAgICAgICAgfQogICAgICB9CiAgICAgIFNrLmltcG9ydE1vZHVsZUludGVybmFsXyA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCBlLCBmLCBnKSB7CiAgICAgICAgdmFyIGgsCiAgICAgICAgICBrLAogICAgICAgICAgbCwKICAgICAgICAgIG0gPSBudWxsLAogICAgICAgICAgbiA9IHZvaWQgMCAhPT0gZSA/IGUudHAkZ2V0YXR0cihTay5idWlsdGluLnN0ci4kbmFtZSkgOiB2b2lkIDAsCiAgICAgICAgICBwID0gdm9pZCAwICE9PSBuID8gbi52ICsgIi4iIDogIiIsCiAgICAgICAgICBEID0gdm9pZCAwICE9PSBlID8gZS50cCRnZXRhdHRyKFNrLmJ1aWx0aW4uc3RyLiRwYXRoKSA6IHZvaWQgMAogICAgICAgIFNrLmltcG9ydFNldFVwUGF0aChnKQogICAgICAgIGlmIChlICYmICFuKSB7CiAgICAgICAgICBpZiAoZikgcmV0dXJuCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5WYWx1ZUVycm9yKAogICAgICAgICAgICAiQXR0ZW1wdGVkIHRvIGltcG9ydCByZWxhdGl2ZSB0byBpbnZhbGlkIHBhY2thZ2UgKG5vIG5hbWUpIiwKICAgICAgICAgICkKICAgICAgICB9CiAgICAgICAgdm9pZCAwID09PSBjICYmIChjID0gcCArIGEpCiAgICAgICAgdmFyIHggPSBhLnNwbGl0KCIuIikKICAgICAgICB0cnkgewogICAgICAgICAgdmFyIEggPSBTay5zeXNtb2R1bGVzLm1wJHN1YnNjcmlwdChjKQogICAgICAgICAgcmV0dXJuIDEgPCB4Lmxlbmd0aCA/IFNrLnN5c21vZHVsZXMubXAkc3Vic2NyaXB0KHAgKyB4WzBdKSA6IEgKICAgICAgICB9IGNhdGNoIChBKSB7fQogICAgICAgIGlmICgxIDwgeC5sZW5ndGgpIHsKICAgICAgICAgIHZhciBKID0geC5zbGljZSgwLCB4Lmxlbmd0aCAtIDEpLmpvaW4oIi4iKQogICAgICAgICAgbSA9IFNrLmltcG9ydE1vZHVsZUludGVybmFsXyhKLCBiLCB2b2lkIDAsIHZvaWQgMCwgZSwgZiwgZykKICAgICAgICB9CiAgICAgICAgSCA9IFNrLm1pc2NldmFsLmNoYWluKAogICAgICAgICAgbSwKICAgICAgICAgIGZ1bmN0aW9uIChiKSB7CiAgICAgICAgICAgIHZhciBjID0gYQogICAgICAgICAgICBtID0gYgogICAgICAgICAgICBpZiAoMSA8IHgubGVuZ3RoKSB7CiAgICAgICAgICAgICAgaWYgKCFtKSByZXR1cm4KICAgICAgICAgICAgICBrID0gU2suc3lzbW9kdWxlcy5tcCRzdWJzY3JpcHQocCArIEopCiAgICAgICAgICAgICAgYyA9IHhbeC5sZW5ndGggLSAxXQogICAgICAgICAgICAgIEQgPSBrLnRwJGdldGF0dHIoU2suYnVpbHRpbi5zdHIuJHBhdGgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgbCA9IG5ldyBTay5idWlsdGluLm1vZHVsZSgpCiAgICAgICAgICAgIGQKICAgICAgICAgICAgICA/ICgoaCA9IGEgKyAiLnB5IiksIChiID0gU2suY29tcGlsZShkLCBoLCAiZXhlYyIsIGcpKSkKICAgICAgICAgICAgICA6IChiID0gU2subWlzY2V2YWwuY2hhaW4oCiAgICAgICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgIFNrLm9uQmVmb3JlSW1wb3J0ICYmCiAgICAgICAgICAgICAgICAgICAgICAiZnVuY3Rpb24iID09PSB0eXBlb2YgU2sub25CZWZvcmVJbXBvcnQKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gU2sub25CZWZvcmVJbXBvcnQoYSkKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKGIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoITEgPT09IGIpCiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5JbXBvcnRFcnJvcigKICAgICAgICAgICAgICAgICAgICAgICAgIkltcG9ydGluZyAiICsgYSArICIgaXMgbm90IGFsbG93ZWQiLAogICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIGlmICgic3RyaW5nIiA9PT0gdHlwZW9mIGIpCiAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5JbXBvcnRFcnJvcihiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBTay5pbXBvcnRTZWFyY2hQYXRoRm9yTmFtZShjLCAiLmpzIiwgRCkKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYQogICAgICAgICAgICAgICAgICAgICAgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY25hbWU6ICIkYnVpbHRpbm1vZHVsZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogYS5jb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVuYW1lOiBhLmZpbGVuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgIHBhY2thZ2VQYXRoOiBhLnBhY2thZ2VQYXRoLAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICA6IFNrLm1pc2NldmFsLmNoYWluKAogICAgICAgICAgICAgICAgICAgICAgICAgIFNrLmltcG9ydFNlYXJjaFBhdGhGb3JOYW1lKGMsICIucHkiLCBEKSwKICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoYikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChhID0gYikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTay5jb21waWxlKGEuY29kZSwgYS5maWxlbmFtZSwgImV4ZWMiLCBnKQogICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKGIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiKSByZXR1cm4gKGIucGFja2FnZVBhdGggPSBhLnBhY2thZ2VQYXRoKSwgYgogICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICkpCiAgICAgICAgICAgIHJldHVybiBiCiAgICAgICAgICB9LAogICAgICAgICAgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgaWYgKGEpIHsKICAgICAgICAgICAgICBTay5zeXNtb2R1bGVzLm1wJGFzc19zdWJzY3JpcHQoYywgbCkKICAgICAgICAgICAgICB2YXIgZCA9IChsLiRqcyA9IGEuY29kZSkKICAgICAgICAgICAgICBudWxsID09IGggJiYgKGggPSBhLmZpbGVuYW1lKQogICAgICAgICAgICAgIDsobnVsbCAhPSBTay5kYXRlU2V0ICYmIFNrLmRhdGVTZXQpIHx8CiAgICAgICAgICAgICAgICAoKGQgPSAiU2suZXhlY1N0YXJ0ID0gU2subGFzdFlpZWxkID0gbmV3IERhdGUoKTtcbiIgKyBhLmNvZGUpLAogICAgICAgICAgICAgICAgKFNrLmRhdGVTZXQgPSAhMCkpCiAgICAgICAgICAgICAgaWYgKGIpIHsKICAgICAgICAgICAgICAgIHZhciBlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgdmFyIGIsCiAgICAgICAgICAgICAgICAgICAgYyA9IFNrLmpzX2JlYXV0aWZ5KGEpLnNwbGl0KCJcbiIpCiAgICAgICAgICAgICAgICAgIGZvciAoYiA9IDE7IGIgPD0gYy5sZW5ndGg7ICsrYikgewogICAgICAgICAgICAgICAgICAgIHZhciBkID0gKCIiICsgYikubGVuZ3RoCiAgICAgICAgICAgICAgICAgICAgZm9yIChhID0gIiI7IDUgPiBkOyArK2QpIGEgKz0gIiAiCiAgICAgICAgICAgICAgICAgICAgY1tiIC0gMV0gPSAiLyogIiArIGEgKyBiICsgIiAqLyAiICsgY1tiIC0gMV0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICByZXR1cm4gYy5qb2luKCJcbiIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBkID0gZShkKQogICAgICAgICAgICAgICAgU2suZGVidWdvdXQoZCkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZCArPSAiXG4iICsgYS5mdW5jbmFtZSArICI7IgogICAgICAgICAgICAgIGQgPSBTay5nbG9iYWwuZXZhbChkKQogICAgICAgICAgICAgIGwuJGQgPSB7CiAgICAgICAgICAgICAgICBfX25hbWVfXzogbmV3IFNrLmJ1aWx0aW4uc3RyKGMpLAogICAgICAgICAgICAgICAgX19kb2NfXzogU2suYnVpbHRpbi5ub25lLm5vbmUkLAogICAgICAgICAgICAgICAgX19wYWNrYWdlX186IGEucGFja2FnZVBhdGgKICAgICAgICAgICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5zdHIoYykKICAgICAgICAgICAgICAgICAgOiBKCiAgICAgICAgICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uc3RyKHAgKyBKKQogICAgICAgICAgICAgICAgICA6IG4KICAgICAgICAgICAgICAgICAgPyBuCiAgICAgICAgICAgICAgICAgIDogU2suYnVpbHRpbi5ub25lLm5vbmUkLAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBhLnBhY2thZ2VQYXRoICYmCiAgICAgICAgICAgICAgICAobC4kZC5fX3BhdGhfXyA9IG5ldyBTay5idWlsdGluLnR1cGxlKFsKICAgICAgICAgICAgICAgICAgbmV3IFNrLmJ1aWx0aW4uc3RyKGEucGFja2FnZVBhdGgpLAogICAgICAgICAgICAgICAgXSkpCiAgICAgICAgICAgICAgcmV0dXJuIGQobC4kZCkKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIGZ1bmN0aW9uIChiKSB7CiAgICAgICAgICAgIHZhciBjCiAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IGIpIHsKICAgICAgICAgICAgICBpZiAoZiAmJiAhbSkgcmV0dXJuCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uSW1wb3J0RXJyb3IoIk5vIG1vZHVsZSBuYW1lZCAiICsgYSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYiAhPT0gbC4kZCkgewogICAgICAgICAgICAgIGZvciAoYyBpbiBsLiRkKSBiW2NdIHx8IChiW2NdID0gbC4kZFtjXSkKICAgICAgICAgICAgICBsLiRkID0gYgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChTay5vbkFmdGVySW1wb3J0ICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBTay5vbkFmdGVySW1wb3J0KQogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBTay5vbkFmdGVySW1wb3J0KGEpCiAgICAgICAgICAgICAgfSBjYXRjaCAoSykge30KICAgICAgICAgICAgaWYgKG0pCiAgICAgICAgICAgICAgcmV0dXJuIGsudHAkc2V0YXR0cihuZXcgU2suYnVpbHRpbi5zdHIoeFt4Lmxlbmd0aCAtIDFdKSwgbCksIG0KICAgICAgICAgICAgZSAmJiBlLnRwJHNldGF0dHIobmV3IFNrLmJ1aWx0aW4uc3RyKGEpLCBsKQogICAgICAgICAgICByZXR1cm4gbAogICAgICAgICAgfSwKICAgICAgICApCiAgICAgICAgcmV0dXJuIGcgPyBIIDogU2subWlzY2V2YWwucmV0cnlPcHRpb25hbFN1c3BlbnNpb25PclRocm93KEgpCiAgICAgIH0KICAgICAgU2suaW1wb3J0TW9kdWxlID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICByZXR1cm4gU2suaW1wb3J0TW9kdWxlSW50ZXJuYWxfKGEsIGIsIHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsICExLCBjKQogICAgICB9CiAgICAgIFNrLmltcG9ydE1haW4gPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIFNrLmRhdGVTZXQgPSAhMQogICAgICAgIFNrLmZpbGVzTG9hZGVkID0gITEKICAgICAgICBTay5zeXNtb2R1bGVzID0gbmV3IFNrLmJ1aWx0aW4uZGljdChbXSkKICAgICAgICBTay5yZWFsc3lzcGF0aCA9IHZvaWQgMAogICAgICAgIFNrLnJlc2V0Q29tcGlsZXIoKQogICAgICAgIHJldHVybiBTay5pbXBvcnRNb2R1bGVJbnRlcm5hbF8oYSwgYiwgIl9fbWFpbl9fIiwgdm9pZCAwLCB2b2lkIDAsICExLCBjKQogICAgICB9CiAgICAgIFNrLmltcG9ydE1haW5XaXRoQm9keSA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7CiAgICAgICAgU2suZGF0ZVNldCA9ICExCiAgICAgICAgU2suZmlsZXNMb2FkZWQgPSAhMQogICAgICAgIFNrLnN5c21vZHVsZXMgPSBuZXcgU2suYnVpbHRpbi5kaWN0KFtdKQogICAgICAgIFNrLnJlYWxzeXNwYXRoID0gdm9pZCAwCiAgICAgICAgU2sucmVzZXRDb21waWxlcigpCiAgICAgICAgcmV0dXJuIFNrLmltcG9ydE1vZHVsZUludGVybmFsXyhhLCBiLCAiX19tYWluX18iLCBjLCB2b2lkIDAsICExLCBkKQogICAgICB9CiAgICAgIFNrLmltcG9ydEJ1aWx0aW5XaXRoQm9keSA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7CiAgICAgICAgcmV0dXJuIFNrLmltcG9ydE1vZHVsZUludGVybmFsXygKICAgICAgICAgIGEsCiAgICAgICAgICBiLAogICAgICAgICAgIl9fYnVpbHRpbl9fLiIgKyBhLAogICAgICAgICAgYywKICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICExLAogICAgICAgICAgZCwKICAgICAgICApCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5fX2ltcG9ydF9fID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUpIHsKICAgICAgICB2YXIgZiA9IFNrLmdsb2JhbHMsCiAgICAgICAgICBnCiAgICAgICAgdm9pZCAwID09PSBlICYmIChlID0gU2suX19mdXR1cmVfXy5hYnNvbHV0ZV9pbXBvcnQgPyAwIDogLTEpCiAgICAgICAgaWYgKAogICAgICAgICAgMCAhPT0gZSAmJgogICAgICAgICAgYi5fX3BhY2thZ2VfXyAmJgogICAgICAgICAgYi5fX3BhY2thZ2VfXyAhPT0gU2suYnVpbHRpbi5ub25lLm5vbmUkCiAgICAgICAgKSB7CiAgICAgICAgICBpZiAoKGcgPSBiLl9fcGFja2FnZV9fLnYpICYmIDAgPCBlKSB7CiAgICAgICAgICAgIGIgPSBnLnNwbGl0KCIuIikKICAgICAgICAgICAgaWYgKGUgLSAxID49IGIubGVuZ3RoKQogICAgICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlZhbHVlRXJyb3IoCiAgICAgICAgICAgICAgICAiQXR0ZW1wdGVkIHJlbGF0aXZlIGltcG9ydCBiZXlvbmQgdG9wbGV2ZWwgcGFja2FnZSIsCiAgICAgICAgICAgICAgKQogICAgICAgICAgICBiLmxlbmd0aCAtPSBlIC0gMQogICAgICAgICAgICBnID0gYi5qb2luKCIuIikKICAgICAgICAgIH0KICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZhciBoID0gU2suc3lzbW9kdWxlcy5tcCRzdWJzY3JpcHQoZykKICAgICAgICAgIH0gY2F0Y2ggKGspIHsKICAgICAgICAgICAgZyA9IHZvaWQgMAogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoMCA8IGUgJiYgdm9pZCAwID09PSBoKQogICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVmFsdWVFcnJvcigKICAgICAgICAgICAgIkF0dGVtcHRlZCByZWxhdGl2ZSBpbXBvcnQgaW4gbm9uLXBhY2thZ2UiLAogICAgICAgICAgKQogICAgICAgIGEuc3BsaXQoIi4iKQogICAgICAgIHJldHVybiBTay5taXNjZXZhbC5jaGFpbigKICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKDAgIT09IGUgJiYgdm9pZCAwICE9PSBoKQogICAgICAgICAgICAgIHJldHVybiAiIiA9PT0gYQogICAgICAgICAgICAgICAgPyBoCiAgICAgICAgICAgICAgICA6IFNrLmltcG9ydE1vZHVsZUludGVybmFsXygKICAgICAgICAgICAgICAgICAgICBhLAogICAgICAgICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgICAgICAgICBnICsgIi4iICsgYSwKICAgICAgICAgICAgICAgICAgICB2b2lkIDAsCiAgICAgICAgICAgICAgICAgICAgaCwKICAgICAgICAgICAgICAgICAgICAtMSA9PSBlLAogICAgICAgICAgICAgICAgICAgICEwLAogICAgICAgICAgICAgICAgICApCiAgICAgICAgICB9LAogICAgICAgICAgZnVuY3Rpb24gKGIpIHsKICAgICAgICAgICAgcmV0dXJuIHZvaWQgMCA9PT0gYgogICAgICAgICAgICAgID8gKChnID0gaCA9IHZvaWQgMCksCiAgICAgICAgICAgICAgICBTay5pbXBvcnRNb2R1bGVJbnRlcm5hbF8oCiAgICAgICAgICAgICAgICAgIGEsCiAgICAgICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgICAgICAgdm9pZCAwLAogICAgICAgICAgICAgICAgICB2b2lkIDAsCiAgICAgICAgICAgICAgICAgIHZvaWQgMCwKICAgICAgICAgICAgICAgICAgITEsCiAgICAgICAgICAgICAgICAgICEwLAogICAgICAgICAgICAgICAgKSkKICAgICAgICAgICAgICA6IGIKICAgICAgICAgIH0sCiAgICAgICAgICBmdW5jdGlvbiAoYikgewogICAgICAgICAgICBpZiAoZCAmJiAwICE9PSBkLmxlbmd0aCkgewogICAgICAgICAgICAgIHZhciBjCiAgICAgICAgICAgICAgdmFyIGUgPSBTay5zeXNtb2R1bGVzLm1wJHN1YnNjcmlwdCgKICAgICAgICAgICAgICAgIChnIHx8ICIiKSArIChnICYmIGEgPyAiLiIgOiAiIikgKyBhLAogICAgICAgICAgICAgICkKICAgICAgICAgICAgICBmb3IgKGIgPSAwOyBiIDwgZC5sZW5ndGg7IGIrKykgewogICAgICAgICAgICAgICAgdmFyIGYgPSBkW2JdCiAgICAgICAgICAgICAgICAiKiIgIT0gZiAmJgogICAgICAgICAgICAgICAgICB2b2lkIDAgPT09IGUudHAkZ2V0YXR0cihuZXcgU2suYnVpbHRpbi5zdHIoZikpICYmCiAgICAgICAgICAgICAgICAgIChjID0gU2subWlzY2V2YWwuY2hhaW4oCiAgICAgICAgICAgICAgICAgICAgYywKICAgICAgICAgICAgICAgICAgICBTay5pbXBvcnRNb2R1bGVJbnRlcm5hbF8uYmluZCgKICAgICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgICBmLAogICAgICAgICAgICAgICAgICAgICAgdm9pZCAwLAogICAgICAgICAgICAgICAgICAgICAgdm9pZCAwLAogICAgICAgICAgICAgICAgICAgICAgdm9pZCAwLAogICAgICAgICAgICAgICAgICAgICAgZSwKICAgICAgICAgICAgICAgICAgICAgICEwLAogICAgICAgICAgICAgICAgICAgICAgITAsCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgKSkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmNoYWluKGMsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KGUpCiAgICAgICAgICAgICAgICByZXR1cm4gZQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGIKICAgICAgICAgIH0sCiAgICAgICAgICBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICBmICE9PSBTay5nbG9iYWxzICYmIChTay5nbG9iYWxzID0gZikKICAgICAgICAgICAgcmV0dXJuIGEKICAgICAgICAgIH0sCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmltcG9ydFN0YXIgPSBmdW5jdGlvbiAoYSwgYiwgYykgewogICAgICAgIGlmICgoYyA9IGEudHAkZ2V0YXR0cihuZXcgU2suYnVpbHRpbi5zdHIoIl9fYWxsX18iKSkpKQogICAgICAgICAgZm9yICgKICAgICAgICAgICAgbGV0IGQgPSBTay5hYnN0ci5pdGVyKGMpLCBlID0gZC50cCRpdGVybmV4dCgpOwogICAgICAgICAgICB2b2lkIDAgIT09IGU7CiAgICAgICAgICAgIGUgPSBkLnRwJGl0ZXJuZXh0KCkKICAgICAgICAgICkKICAgICAgICAgICAgYltlLnZdID0gU2suYWJzdHIuZ2F0dHIoYSwgZSkKICAgICAgICBlbHNlIHsKICAgICAgICAgIGMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhhLiRkKQogICAgICAgICAgZm9yIChsZXQgZCBpbiBjKSAiXyIgIT0gY1tkXS5jaGFyQXQoMCkgJiYgKGJbY1tkXV0gPSBhLiRkW2NbZF1dKQogICAgICAgIH0KICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmltcG9ydE1haW4iLCBTay5pbXBvcnRNYWluKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmltcG9ydE1haW5XaXRoQm9keSIsIFNrLmltcG9ydE1haW5XaXRoQm9keSkKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5pbXBvcnRCdWlsdGluV2l0aEJvZHkiLCBTay5pbXBvcnRCdWlsdGluV2l0aEJvZHkpCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi5fX2ltcG9ydF9fIiwgU2suYnVpbHRpbi5fX2ltcG9ydF9fKQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmltcG9ydFN0YXIiLCBTay5pbXBvcnRTdGFyKQogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4udGltU29ydCA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdGhpcy5saXN0ID0gbmV3IFNrLmJ1aWx0aW4ubGlzdChhLnYpCiAgICAgICAgdGhpcy5NSU5fR0FMTE9QID0gNwogICAgICAgIHRoaXMubGlzdGxlbmd0aCA9IGIgPyBiIDogYS5zcSRsZW5ndGgoKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udGltU29ydC5wcm90b3R5cGUubHQgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHJldHVybiBTay5taXNjZXZhbC5yaWNoQ29tcGFyZUJvb2woYSwgYiwgIkx0IikKICAgICAgfQogICAgICBTay5idWlsdGluLnRpbVNvcnQucHJvdG90eXBlLmxlID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gIXRoaXMubHQoYiwgYSkKICAgICAgfQogICAgICBTay5idWlsdGluLnRpbVNvcnQucHJvdG90eXBlLnNldGl0ZW0gPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHRoaXMubGlzdC52W2FdID0gYgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udGltU29ydC5wcm90b3R5cGUuYmluYXJ5X3NvcnQgPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjCiAgICAgICAgZm9yIChjID0gYS5iYXNlICsgYjsgYyA8IGEuYmFzZSArIGEubGVuOyBjKyspIHsKICAgICAgICAgIHZhciBkID0gYS5iYXNlCiAgICAgICAgICB2YXIgZSA9IGMKICAgICAgICAgIGZvciAoYiA9IGEuZ2V0aXRlbShlKTsgZCA8IGU7ICkgewogICAgICAgICAgICB2YXIgZiA9IGQgKyAoKGUgLSBkKSA+PiAxKQogICAgICAgICAgICB0aGlzLmx0KGIsIGEuZ2V0aXRlbShmKSkgPyAoZSA9IGYpIDogKGQgPSBmICsgMSkKICAgICAgICAgIH0KICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KGQgPT09IGUpCiAgICAgICAgICBmb3IgKGYgPSBjOyBmID4gZDsgZi0tKSBhLnNldGl0ZW0oZiwgYS5nZXRpdGVtKGYgLSAxKSkKICAgICAgICAgIGEuc2V0aXRlbShkLCBiKQogICAgICAgIH0KICAgICAgfQogICAgICBTay5idWlsdGluLnRpbVNvcnQucHJvdG90eXBlLmNvdW50X3J1biA9IGZ1bmN0aW9uIChhKSB7CiAgICAgICAgdmFyIGIKICAgICAgICBpZiAoMSA+PSBhLmxlbikgewogICAgICAgICAgdmFyIGMgPSBhLmxlbgogICAgICAgICAgdmFyIGQgPSAhMQogICAgICAgIH0gZWxzZSBpZiAoKChjID0gMiksIHRoaXMubHQoYS5nZXRpdGVtKGEuYmFzZSArIDEpLCBhLmdldGl0ZW0oYS5iYXNlKSkpKQogICAgICAgICAgZm9yIChkID0gITAsIGIgPSBhLmJhc2UgKyAyOyBiIDwgYS5iYXNlICsgYS5sZW47IGIrKykKICAgICAgICAgICAgaWYgKHRoaXMubHQoYS5nZXRpdGVtKGIpLCBhLmdldGl0ZW0oYiAtIDEpKSkgYysrCiAgICAgICAgICAgIGVsc2UgYnJlYWsKICAgICAgICBlbHNlCiAgICAgICAgICBmb3IgKAogICAgICAgICAgICBkID0gITEsIGIgPSBhLmJhc2UgKyAyOwogICAgICAgICAgICBiIDwgYS5iYXNlICsgYS5sZW4gJiYgIXRoaXMubHQoYS5nZXRpdGVtKGIpLCBhLmdldGl0ZW0oYiAtIDEpKTsKICAgICAgICAgICAgYisrCiAgICAgICAgICApCiAgICAgICAgICAgIGMrKwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBydW46IG5ldyBTay5idWlsdGluLmxpc3RTbGljZShhLmxpc3QsIGEuYmFzZSwgYyksCiAgICAgICAgICBkZXNjZW5kaW5nOiBkLAogICAgICAgIH0KICAgICAgfQogICAgICBTay5idWlsdGluLnRpbVNvcnQucHJvdG90eXBlLnNvcnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGEsCiAgICAgICAgICBiID0gbmV3IFNrLmJ1aWx0aW4ubGlzdFNsaWNlKHRoaXMubGlzdCwgMCwgdGhpcy5saXN0bGVuZ3RoKQogICAgICAgIGlmICghKDIgPiBiLmxlbikpIHsKICAgICAgICAgIHRoaXMubWVyZ2VfaW5pdCgpCiAgICAgICAgICBmb3IgKGEgPSB0aGlzLm1lcmdlX2NvbXB1dGVfbWlucnVuKGIubGVuKTsgMCA8IGIubGVuOyApIHsKICAgICAgICAgICAgdmFyIGMgPSB0aGlzLmNvdW50X3J1bihiKQogICAgICAgICAgICBjLmRlc2NlbmRpbmcgJiYgYy5ydW4ucmV2ZXJzZSgpCiAgICAgICAgICAgIGlmIChjLnJ1bi5sZW4gPCBhKSB7CiAgICAgICAgICAgICAgdmFyIGQgPSBjLnJ1bi5sZW4KICAgICAgICAgICAgICBjLnJ1bi5sZW4gPSBhIDwgYi5sZW4gPyBhIDogYi5sZW4KICAgICAgICAgICAgICB0aGlzLmJpbmFyeV9zb3J0KGMucnVuLCBkKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGIuYWR2YW5jZShjLnJ1bi5sZW4pCiAgICAgICAgICAgIHRoaXMucGVuZGluZy5wdXNoKGMucnVuKQogICAgICAgICAgICB0aGlzLm1lcmdlX2NvbGxhcHNlKCkKICAgICAgICAgIH0KICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KGIuYmFzZSA9PSB0aGlzLmxpc3RsZW5ndGgpCiAgICAgICAgICB0aGlzLm1lcmdlX2ZvcmNlX2NvbGxhcHNlKCkKICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KDEgPT0gdGhpcy5wZW5kaW5nLmxlbmd0aCkKICAgICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KDAgPT09IHRoaXMucGVuZGluZ1swXS5iYXNlKQogICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQodGhpcy5wZW5kaW5nWzBdLmxlbiA9PSB0aGlzLmxpc3RsZW5ndGgpCiAgICAgICAgfQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udGltU29ydC5wcm90b3R5cGUuZ2FsbG9wID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsKICAgICAgICB2YXIgZQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KDAgPD0gYyAmJiBjIDwgYi5sZW4pCiAgICAgICAgdmFyIGYgPSB0aGlzCiAgICAgICAgZCA9IGQKICAgICAgICAgID8gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICByZXR1cm4gZi5sZShhLCBiKQogICAgICAgICAgICB9CiAgICAgICAgICA6IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGYubHQoYSwgYikKICAgICAgICAgICAgfQogICAgICAgIHZhciBnID0gYi5iYXNlICsgYwogICAgICAgIHZhciBoID0gMAogICAgICAgIHZhciBrID0gMQogICAgICAgIGlmIChkKGIuZ2V0aXRlbShnKSwgYSkpIHsKICAgICAgICAgIGZvciAoZSA9IGIubGVuIC0gYzsgayA8IGU7ICkKICAgICAgICAgICAgaWYgKGQoYi5nZXRpdGVtKGcgKyBrKSwgYSkpIHsKICAgICAgICAgICAgICBoID0gawogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBrID0gKGsgPDwgMSkgKyAxCiAgICAgICAgICAgICAgfSBjYXRjaCAobCkgewogICAgICAgICAgICAgICAgayA9IGUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBicmVhawogICAgICAgICAgayA+IGUgJiYgKGsgPSBlKQogICAgICAgICAgaCArPSBjCiAgICAgICAgICBrICs9IGMKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZm9yIChlID0gYyArIDE7IGsgPCBlICYmICFkKGIuZ2V0aXRlbShnIC0gayksIGEpOyApIHsKICAgICAgICAgICAgaCA9IGsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBrID0gKGsgPDwgMSkgKyAxCiAgICAgICAgICAgIH0gY2F0Y2ggKGwpIHsKICAgICAgICAgICAgICBrID0gZQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBrID4gZSAmJiAoayA9IGUpCiAgICAgICAgICBnID0gYyAtIGgKICAgICAgICAgIGggPSBjIC0gawogICAgICAgICAgayA9IGcKICAgICAgICB9CiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoLTEgPD0gaCA8IGsgPD0gYi5sZW4pCiAgICAgICAgZm9yIChoICs9IDE7IGggPCBrOyApCiAgICAgICAgICAoYyA9IGggKyAoKGsgLSBoKSA+PiAxKSksCiAgICAgICAgICAgIGQoYi5nZXRpdGVtKGIuYmFzZSArIGMpLCBhKSA/IChoID0gYyArIDEpIDogKGsgPSBjKQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KGggPT0gaykKICAgICAgICByZXR1cm4gawogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udGltU29ydC5wcm90b3R5cGUubWVyZ2VfaW5pdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLm1pbl9nYWxsb3AgPSB0aGlzLk1JTl9HQUxMT1AKICAgICAgICB0aGlzLnBlbmRpbmcgPSBbXQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4udGltU29ydC5wcm90b3R5cGUubWVyZ2VfbG8gPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIHZhciBjLCBkLCBlCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoMCA8IGEubGVuICYmIDAgPCBiLmxlbiAmJiBhLmJhc2UgKyBhLmxlbiA9PSBiLmJhc2UpCiAgICAgICAgdmFyIGYgPSB0aGlzLm1pbl9nYWxsb3AKICAgICAgICB2YXIgZyA9IGEuYmFzZQogICAgICAgIGEgPSBhLmNvcHlpdGVtcygpCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmICgodGhpcy5zZXRpdGVtKGcsIGIucG9wbGVmdCgpKSwgZysrLCAxICE9IGEubGVuICYmIDAgIT09IGIubGVuKSkKICAgICAgICAgICAgZm9yICg7OykgewogICAgICAgICAgICAgIGZvciAoZCA9IGMgPSAwOyA7ICkKICAgICAgICAgICAgICAgIGlmICh0aGlzLmx0KGIuZ2V0aXRlbShiLmJhc2UpLCBhLmdldGl0ZW0oYS5iYXNlKSkpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zZXRpdGVtKGcsIGIucG9wbGVmdCgpKQogICAgICAgICAgICAgICAgICBnKysKICAgICAgICAgICAgICAgICAgaWYgKDAgPT09IGIubGVuKSByZXR1cm4KICAgICAgICAgICAgICAgICAgZCsrCiAgICAgICAgICAgICAgICAgIGMgPSAwCiAgICAgICAgICAgICAgICAgIGlmIChkID49IGYpIGJyZWFrCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLnNldGl0ZW0oZywgYS5wb3BsZWZ0KCkpCiAgICAgICAgICAgICAgICAgIGcrKwogICAgICAgICAgICAgICAgICBpZiAoMSA9PSBhLmxlbikgcmV0dXJuCiAgICAgICAgICAgICAgICAgIGMrKwogICAgICAgICAgICAgICAgICBkID0gMAogICAgICAgICAgICAgICAgICBpZiAoYyA+PSBmKSBicmVhawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGZvciAoZiArPSAxOyA7ICkgewogICAgICAgICAgICAgICAgdGhpcy5taW5fZ2FsbG9wID0gZiAtPSAxIDwgZgogICAgICAgICAgICAgICAgYyA9IHRoaXMuZ2FsbG9wKGIuZ2V0aXRlbShiLmJhc2UpLCBhLCAwLCAhMCkKICAgICAgICAgICAgICAgIGZvciAoZSA9IGEuYmFzZTsgZSA8IGEuYmFzZSArIGM7IGUrKykKICAgICAgICAgICAgICAgICAgdGhpcy5zZXRpdGVtKGcsIGEuZ2V0aXRlbShlKSksIGcrKwogICAgICAgICAgICAgICAgYS5hZHZhbmNlKGMpCiAgICAgICAgICAgICAgICBpZiAoMSA+PSBhLmxlbikgcmV0dXJuCiAgICAgICAgICAgICAgICB0aGlzLnNldGl0ZW0oZywgYi5wb3BsZWZ0KCkpCiAgICAgICAgICAgICAgICBnKysKICAgICAgICAgICAgICAgIGlmICgwID09PSBiLmxlbikgcmV0dXJuCiAgICAgICAgICAgICAgICBkID0gdGhpcy5nYWxsb3AoYS5nZXRpdGVtKGEuYmFzZSksIGIsIDAsICExKQogICAgICAgICAgICAgICAgZm9yIChlID0gYi5iYXNlOyBlIDwgYi5iYXNlICsgZDsgZSsrKQogICAgICAgICAgICAgICAgICB0aGlzLnNldGl0ZW0oZywgYi5nZXRpdGVtKGUpKSwgZysrCiAgICAgICAgICAgICAgICBiLmFkdmFuY2UoZCkKICAgICAgICAgICAgICAgIGlmICgwID09PSBiLmxlbikgcmV0dXJuCiAgICAgICAgICAgICAgICB0aGlzLnNldGl0ZW0oZywgYS5wb3BsZWZ0KCkpCiAgICAgICAgICAgICAgICBnKysKICAgICAgICAgICAgICAgIGlmICgxID09IGEubGVuKSByZXR1cm4KICAgICAgICAgICAgICAgIGlmIChjIDwgdGhpcy5NSU5fR0FMTE9QICYmIGQgPCB0aGlzLk1JTl9HQUxMT1ApIGJyZWFrCiAgICAgICAgICAgICAgICBmKysKICAgICAgICAgICAgICAgIHRoaXMubWluX2dhbGxvcCA9IGYKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoMCA8PSBhLmxlbiAmJiAwIDw9IGIubGVuKQogICAgICAgICAgZm9yIChlID0gYi5iYXNlOyBlIDwgYi5iYXNlICsgYi5sZW47IGUrKykKICAgICAgICAgICAgdGhpcy5zZXRpdGVtKGcsIGIuZ2V0aXRlbShlKSksIGcrKwogICAgICAgICAgZm9yIChlID0gYS5iYXNlOyBlIDwgYS5iYXNlICsgYS5sZW47IGUrKykKICAgICAgICAgICAgdGhpcy5zZXRpdGVtKGcsIGEuZ2V0aXRlbShlKSksIGcrKwogICAgICAgIH0KICAgICAgfQogICAgICBTay5idWlsdGluLnRpbVNvcnQucHJvdG90eXBlLm1lcmdlX2hpID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB2YXIgYywgZCwgZQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KDAgPCBhLmxlbiAmJiAwIDwgYi5sZW4gJiYgYS5iYXNlICsgYS5sZW4gPT0gYi5iYXNlKQogICAgICAgIHZhciBmID0gdGhpcy5taW5fZ2FsbG9wCiAgICAgICAgdmFyIGcgPSBiLmJhc2UgKyBiLmxlbgogICAgICAgIGIgPSBiLmNvcHlpdGVtcygpCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmICgoZy0tLCB0aGlzLnNldGl0ZW0oZywgYS5wb3ByaWdodCgpKSwgMCAhPT0gYS5sZW4gJiYgMSAhPSBiLmxlbikpCiAgICAgICAgICAgIGZvciAoOzspIHsKICAgICAgICAgICAgICBmb3IgKGQgPSBjID0gMDsgOyApIHsKICAgICAgICAgICAgICAgIHZhciBoID0gYS5nZXRpdGVtKGEuYmFzZSArIGEubGVuIC0gMSkKICAgICAgICAgICAgICAgIHZhciBrID0gYi5nZXRpdGVtKGIuYmFzZSArIGIubGVuIC0gMSkKICAgICAgICAgICAgICAgIGlmICh0aGlzLmx0KGssIGgpKSB7CiAgICAgICAgICAgICAgICAgIGctLQogICAgICAgICAgICAgICAgICB0aGlzLnNldGl0ZW0oZywgaCkKICAgICAgICAgICAgICAgICAgYS5sZW4tLQogICAgICAgICAgICAgICAgICBpZiAoMCA9PT0gYS5sZW4pIHJldHVybgogICAgICAgICAgICAgICAgICBjKysKICAgICAgICAgICAgICAgICAgZCA9IDAKICAgICAgICAgICAgICAgICAgaWYgKGMgPj0gZikgYnJlYWsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGctLQogICAgICAgICAgICAgICAgICB0aGlzLnNldGl0ZW0oZywgaykKICAgICAgICAgICAgICAgICAgYi5sZW4tLQogICAgICAgICAgICAgICAgICBpZiAoMSA9PSBiLmxlbikgcmV0dXJuCiAgICAgICAgICAgICAgICAgIGQrKwogICAgICAgICAgICAgICAgICBjID0gMAogICAgICAgICAgICAgICAgICBpZiAoZCA+PSBmKSBicmVhawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBmb3IgKGYgKz0gMTsgOyApIHsKICAgICAgICAgICAgICAgIHRoaXMubWluX2dhbGxvcCA9IGYgLT0gMSA8IGYKICAgICAgICAgICAgICAgIGsgPSBiLmdldGl0ZW0oYi5iYXNlICsgYi5sZW4gLSAxKQogICAgICAgICAgICAgICAgdmFyIGwgPSB0aGlzLmdhbGxvcChrLCBhLCBhLmxlbiAtIDEsICEwKQogICAgICAgICAgICAgICAgYyA9IGEubGVuIC0gbAogICAgICAgICAgICAgICAgZm9yIChlID0gYS5iYXNlICsgYS5sZW4gLSAxOyBlID4gYS5iYXNlICsgbCAtIDE7IGUtLSkKICAgICAgICAgICAgICAgICAgZy0tLCB0aGlzLnNldGl0ZW0oZywgYS5nZXRpdGVtKGUpKQogICAgICAgICAgICAgICAgYS5sZW4gLT0gYwogICAgICAgICAgICAgICAgaWYgKDAgPT09IGEubGVuKSByZXR1cm4KICAgICAgICAgICAgICAgIGctLQogICAgICAgICAgICAgICAgdGhpcy5zZXRpdGVtKGcsIGIucG9wcmlnaHQoKSkKICAgICAgICAgICAgICAgIGlmICgxID09IGIubGVuKSByZXR1cm4KICAgICAgICAgICAgICAgIGggPSBhLmdldGl0ZW0oYS5iYXNlICsgYS5sZW4gLSAxKQogICAgICAgICAgICAgICAgbCA9IHRoaXMuZ2FsbG9wKGgsIGIsIGIubGVuIC0gMSwgITEpCiAgICAgICAgICAgICAgICBkID0gYi5sZW4gLSBsCiAgICAgICAgICAgICAgICBmb3IgKGUgPSBiLmJhc2UgKyBiLmxlbiAtIDE7IGUgPiBiLmJhc2UgKyBsIC0gMTsgZS0tKQogICAgICAgICAgICAgICAgICBnLS0sIHRoaXMuc2V0aXRlbShnLCBiLmdldGl0ZW0oZSkpCiAgICAgICAgICAgICAgICBiLmxlbiAtPSBkCiAgICAgICAgICAgICAgICBpZiAoMSA+PSBiLmxlbikgcmV0dXJuCiAgICAgICAgICAgICAgICBnLS0KICAgICAgICAgICAgICAgIHRoaXMuc2V0aXRlbShnLCBhLnBvcHJpZ2h0KCkpCiAgICAgICAgICAgICAgICBpZiAoMCA9PT0gYS5sZW4pIHJldHVybgogICAgICAgICAgICAgICAgaWYgKGMgPCB0aGlzLk1JTl9HQUxMT1AgJiYgZCA8IHRoaXMuTUlOX0dBTExPUCkgYnJlYWsKICAgICAgICAgICAgICAgIGYrKwogICAgICAgICAgICAgICAgdGhpcy5taW5fZ2FsbG9wID0gZgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgwIDw9IGEubGVuICYmIDAgPD0gYi5sZW4pCiAgICAgICAgICBmb3IgKGUgPSBhLmJhc2UgKyBhLmxlbiAtIDE7IGUgPiBhLmJhc2UgLSAxOyBlLS0pCiAgICAgICAgICAgIGctLSwgdGhpcy5zZXRpdGVtKGcsIGEuZ2V0aXRlbShlKSkKICAgICAgICAgIGZvciAoZSA9IGIuYmFzZSArIGIubGVuIC0gMTsgZSA+IGIuYmFzZSAtIDE7IGUtLSkKICAgICAgICAgICAgZy0tLCB0aGlzLnNldGl0ZW0oZywgYi5nZXRpdGVtKGUpKQogICAgICAgIH0KICAgICAgfQogICAgICBTay5idWlsdGluLnRpbVNvcnQucHJvdG90eXBlLm1lcmdlX2F0ID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICAwID4gYSAmJiAoYSA9IHRoaXMucGVuZGluZy5sZW5ndGggKyBhKQogICAgICAgIHZhciBiID0gdGhpcy5wZW5kaW5nW2FdCiAgICAgICAgdmFyIGMgPSB0aGlzLnBlbmRpbmdbYSArIDFdCiAgICAgICAgU2suYXNzZXJ0cy5hc3NlcnQoMCA8IGIubGVuICYmIDAgPCBjLmxlbikKICAgICAgICBTay5hc3NlcnRzLmFzc2VydChiLmJhc2UgKyBiLmxlbiA9PSBjLmJhc2UpCiAgICAgICAgdGhpcy5wZW5kaW5nW2FdID0gbmV3IFNrLmJ1aWx0aW4ubGlzdFNsaWNlKAogICAgICAgICAgdGhpcy5saXN0LAogICAgICAgICAgYi5iYXNlLAogICAgICAgICAgYi5sZW4gKyBjLmxlbiwKICAgICAgICApCiAgICAgICAgdGhpcy5wZW5kaW5nLnNwbGljZShhICsgMSwgMSkKICAgICAgICBhID0gdGhpcy5nYWxsb3AoYy5nZXRpdGVtKGMuYmFzZSksIGIsIDAsICEwKQogICAgICAgIGIuYWR2YW5jZShhKQogICAgICAgIDAgIT09IGIubGVuICYmCiAgICAgICAgICAoKGMubGVuID0gdGhpcy5nYWxsb3AoCiAgICAgICAgICAgIGIuZ2V0aXRlbShiLmJhc2UgKyBiLmxlbiAtIDEpLAogICAgICAgICAgICBjLAogICAgICAgICAgICBjLmxlbiAtIDEsCiAgICAgICAgICAgICExLAogICAgICAgICAgKSksCiAgICAgICAgICAwICE9PSBjLmxlbiAmJgogICAgICAgICAgICAoYi5sZW4gPD0gYy5sZW4gPyB0aGlzLm1lcmdlX2xvKGIsIGMpIDogdGhpcy5tZXJnZV9oaShiLCBjKSkpCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi50aW1Tb3J0LnByb3RvdHlwZS5tZXJnZV9jb2xsYXBzZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmb3IgKHZhciBhID0gdGhpcy5wZW5kaW5nOyAxIDwgYS5sZW5ndGg7ICkKICAgICAgICAgIGlmICgKICAgICAgICAgICAgMyA8PSBhLmxlbmd0aCAmJgogICAgICAgICAgICBhW2EubGVuZ3RoIC0gM10ubGVuIDw9IGFbYS5sZW5ndGggLSAyXS5sZW4gKyBhW2EubGVuZ3RoIC0gMV0ubGVuCiAgICAgICAgICApCiAgICAgICAgICAgIGFbYS5sZW5ndGggLSAzXS5sZW4gPCBhW2EubGVuZ3RoIC0gMV0ubGVuCiAgICAgICAgICAgICAgPyB0aGlzLm1lcmdlX2F0KC0zKQogICAgICAgICAgICAgIDogdGhpcy5tZXJnZV9hdCgtMikKICAgICAgICAgIGVsc2UgaWYgKGFbYS5sZW5ndGggLSAyXS5sZW4gPD0gYVthLmxlbmd0aCAtIDFdLmxlbikgdGhpcy5tZXJnZV9hdCgtMikKICAgICAgICAgIGVsc2UgYnJlYWsKICAgICAgfQogICAgICBTay5idWlsdGluLnRpbVNvcnQucHJvdG90eXBlLm1lcmdlX2ZvcmNlX2NvbGxhcHNlID0gZnVuY3Rpb24gKCkgewogICAgICAgIGZvciAodmFyIGEgPSB0aGlzLnBlbmRpbmc7IDEgPCBhLmxlbmd0aDsgKQogICAgICAgICAgMyA8PSBhLmxlbmd0aCAmJiBhW2EubGVuZ3RoIC0gM10ubGVuIDwgYVthLmxlbmd0aCAtIDFdLmxlbgogICAgICAgICAgICA/IHRoaXMubWVyZ2VfYXQoLTMpCiAgICAgICAgICAgIDogdGhpcy5tZXJnZV9hdCgtMikKICAgICAgfQogICAgICBTay5idWlsdGluLnRpbVNvcnQucHJvdG90eXBlLm1lcmdlX2NvbXB1dGVfbWlucnVuID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBmb3IgKHZhciBiID0gMDsgNjQgPD0gYTsgKSAoYiB8PSBhICYgMSksIChhID4+PSAxKQogICAgICAgIHJldHVybiBhICsgYgogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubGlzdFNsaWNlID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICB0aGlzLmxpc3QgPSBhCiAgICAgICAgdGhpcy5iYXNlID0gYgogICAgICAgIHRoaXMubGVuID0gYwogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubGlzdFNsaWNlLnByb3RvdHlwZS5jb3B5aXRlbXMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLmJhc2UsCiAgICAgICAgICBiID0gdGhpcy5iYXNlICsgdGhpcy5sZW4KICAgICAgICBTay5hc3NlcnRzLmFzc2VydCgwIDw9IGEgPD0gYikKICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4ubGlzdFNsaWNlKAogICAgICAgICAgbmV3IFNrLmJ1aWx0aW4ubGlzdCh0aGlzLmxpc3Qudi5zbGljZShhLCBiKSksCiAgICAgICAgICAwLAogICAgICAgICAgdGhpcy5sZW4sCiAgICAgICAgKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubGlzdFNsaWNlLnByb3RvdHlwZS5hZHZhbmNlID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICB0aGlzLmJhc2UgKz0gYQogICAgICAgIHRoaXMubGVuIC09IGEKICAgICAgICBTay5hc3NlcnRzLmFzc2VydCh0aGlzLmJhc2UgPD0gdGhpcy5saXN0LnNxJGxlbmd0aCgpKQogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4ubGlzdFNsaWNlLnByb3RvdHlwZS5nZXRpdGVtID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5saXN0LnZbYV0KICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3RTbGljZS5wcm90b3R5cGUuc2V0aXRlbSA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdGhpcy5saXN0LnZbYV0gPSBiCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5saXN0U2xpY2UucHJvdG90eXBlLnBvcGxlZnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGEgPSB0aGlzLmxpc3Qudlt0aGlzLmJhc2VdCiAgICAgICAgdGhpcy5iYXNlKysKICAgICAgICB0aGlzLmxlbi0tCiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3RTbGljZS5wcm90b3R5cGUucG9wcmlnaHQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5sZW4tLQogICAgICAgIHJldHVybiB0aGlzLmxpc3Qudlt0aGlzLmJhc2UgKyB0aGlzLmxlbl0KICAgICAgfQogICAgICBTay5idWlsdGluLmxpc3RTbGljZS5wcm90b3R5cGUucmV2ZXJzZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBmb3IgKAogICAgICAgICAgdmFyIGEsIGIsIGMgPSB0aGlzLmxpc3QsIGQgPSB0aGlzLmJhc2UsIGUgPSBkICsgdGhpcy5sZW4gLSAxOwogICAgICAgICAgZCA8IGU7CgogICAgICAgICkKICAgICAgICAgIChhID0gYy52W2VdKSwgKGIgPSBjLnZbZF0pLCAoYy52W2RdID0gYSksIChjLnZbZV0gPSBiKSwgZCsrLCBlLS0KICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLmJ1aWx0aW4ubGlzdFNsaWNlIiwgU2suYnVpbHRpbi5saXN0U2xpY2UpCiAgICAgIFNrLmV4cG9ydFN5bWJvbCgiU2suYnVpbHRpbi50aW1Tb3J0IiwgU2suYnVpbHRpbi50aW1Tb3J0KQogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4uc29ydGVkID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHsKICAgICAgICB2YXIgZQogICAgICAgIGlmICh2b2lkIDAgPT09IGQpIGQgPSAhMQogICAgICAgIGVsc2UgewogICAgICAgICAgaWYgKGQgaW5zdGFuY2VvZiBTay5idWlsdGluLmZsb2F0XykKICAgICAgICAgICAgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJhbiBpbnRlZ2VyIGlzIHJlcXVpcmVkLCBnb3QgZmxvYXQiKQogICAgICAgICAgaWYgKAogICAgICAgICAgICBkIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfIHx8CiAgICAgICAgICAgIGQucHJvdG90eXBlIGluc3RhbmNlb2YgU2suYnVpbHRpbi5pbnRfCiAgICAgICAgICApCiAgICAgICAgICAgIGQgPSBTay5taXNjZXZhbC5pc1RydWUoZCkKICAgICAgICAgIGVsc2UgdGhyb3cgbmV3IFNrLmJ1aWx0aW4uVHlwZUVycm9yKCJhbiBpbnRlZ2VyIGlzIHJlcXVpcmVkIikKICAgICAgICB9CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gYyB8fCBjIGluc3RhbmNlb2YgU2suYnVpbHRpbi5ub25lKQogICAgICAgICAgYiBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubm9uZSB8fCB2b2lkIDAgPT09IGIgfHwgKGUgPSBiKSwKICAgICAgICAgICAgKGEgPSBuZXcgU2suYnVpbHRpbi5saXN0KGEpKQogICAgICAgIGVsc2UgewogICAgICAgICAgZSA9CiAgICAgICAgICAgIGIgaW5zdGFuY2VvZiBTay5idWlsdGluLm5vbmUgfHwgdm9pZCAwID09PSBiCiAgICAgICAgICAgICAgPyBmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgICByZXR1cm4gU2subWlzY2V2YWwucmljaENvbXBhcmVCb29sKGFbMF0sIGJbMF0sICJMdCIpCiAgICAgICAgICAgICAgICAgICAgPyBuZXcgU2suYnVpbHRpbi5pbnRfKC0xKQogICAgICAgICAgICAgICAgICAgIDogbmV3IFNrLmJ1aWx0aW4uaW50XygwKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIDogZnVuY3Rpb24gKGEsIGMpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIFNrLm1pc2NldmFsLmNhbGxzaW1BcnJheShiLCBbYVswXSwgY1swXV0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICB2YXIgZiA9IGEudHAkaXRlcigpCiAgICAgICAgICB2YXIgZyA9IGYudHAkaXRlcm5leHQoKQogICAgICAgICAgZm9yIChhID0gW107IHZvaWQgMCAhPT0gZzsgKQogICAgICAgICAgICBhLnB1c2goW1NrLm1pc2NldmFsLmNhbGxzaW1BcnJheShjLCBbZ10pLCBnXSksIChnID0gZi50cCRpdGVybmV4dCgpKQogICAgICAgICAgYSA9IG5ldyBTay5idWlsdGluLmxpc3QoYSkKICAgICAgICB9CiAgICAgICAgdm9pZCAwICE9PSBlID8gYS5saXN0X3NvcnRfKGEsIGUpIDogYS5saXN0X3NvcnRfKGEpCiAgICAgICAgZCAmJiBhLmxpc3RfcmV2ZXJzZV8oYSkKICAgICAgICBpZiAodm9pZCAwICE9PSBjICYmICEoYyBpbnN0YW5jZW9mIFNrLmJ1aWx0aW4ubm9uZSkpIHsKICAgICAgICAgIGYgPSBhLnRwJGl0ZXIoKQogICAgICAgICAgZyA9IGYudHAkaXRlcm5leHQoKQogICAgICAgICAgZm9yIChhID0gW107IHZvaWQgMCAhPT0gZzsgKSBhLnB1c2goZ1sxXSksIChnID0gZi50cCRpdGVybmV4dCgpKQogICAgICAgICAgYSA9IG5ldyBTay5idWlsdGluLmxpc3QoYSkKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEKICAgICAgfQogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4udHlwZV9pc19zdWJ0eXBlX2Jhc2VfY2hhaW4gPSBmdW5jdGlvbiAoYSwgYikgewogICAgICAgIGRvIHsKICAgICAgICAgIGlmIChhID09IGIpIHJldHVybiAhMAogICAgICAgICAgYSA9IGEudHAkYmFzZQogICAgICAgIH0gd2hpbGUgKHZvaWQgMCAhPT0gYSkKICAgICAgICByZXR1cm4gYiA9PSBTay5idWlsdGluLm9iamVjdAogICAgICB9CiAgICAgIFNrLmJ1aWx0aW4uUHlUeXBlX0lzU3VidHlwZSA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgdmFyIGMgPSBhLnRwJG1ybwogICAgICAgIGlmIChjKSB7CiAgICAgICAgICBTay5hc3NlcnRzLmFzc2VydChjIGluc3RhbmNlb2YgU2suYnVpbHRpbi50dXBsZSkKICAgICAgICAgIGZvciAoYSA9IDA7IGEgPCBjLnYubGVuZ3RoOyBhKyspIGlmIChjLnZbYV0gPT0gYikgcmV0dXJuICEwCiAgICAgICAgICByZXR1cm4gITEKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFNrLmJ1aWx0aW4udHlwZV9pc19zdWJ0eXBlX2Jhc2VfY2hhaW4oYSwgYikKICAgICAgfQogICAgICBTay5idWlsdGluLnN1cGVyXyA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgU2suYnVpbHRpbi5weUNoZWNrQXJnc0xlbigic3VwZXIiLCBhcmd1bWVudHMubGVuZ3RoLCAxKQogICAgICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTay5idWlsdGluLnN1cGVyXykpCiAgICAgICAgICByZXR1cm4gbmV3IFNrLmJ1aWx0aW4uc3VwZXJfKGEsIGIpCiAgICAgICAgU2subWlzY2V2YWwuY2FsbHNpbUFycmF5KFNrLmJ1aWx0aW4uc3VwZXJfLl9faW5pdF9fLCBbdGhpcywgYSwgYl0pCiAgICAgICAgcmV0dXJuIHRoaXMKICAgICAgfQogICAgICBTay5idWlsdGluLnN1cGVyXy5fX2luaXRfXyA9IG5ldyBTay5idWlsdGluLmZ1bmMoZnVuY3Rpb24gKGEsIGIsIGMpIHsKICAgICAgICBhLm9iaiA9IGMKICAgICAgICBhLnR5cGUgPSBiCiAgICAgICAgaWYgKCFiLnRwJG1ybykKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLlR5cGVFcnJvcigKICAgICAgICAgICAgIm11c3QgYmUgdHlwZSwgbm90ICIgKyBiLm9iJHR5cGUudHAkbmFtZSwKICAgICAgICAgICkKICAgICAgICBhLm9ial90eXBlID0gYi50cCRtcm8udlsxXQogICAgICAgIGlmICghYykKICAgICAgICAgIHRocm93IG5ldyBTay5idWlsdGluLk5vdEltcGxlbWVudGVkRXJyb3IoCiAgICAgICAgICAgICJ1bmJvdW5kIHN1cGVyIG5vdCBzdXBwb3J0ZWQgYmVjYXVzZSBza3VscHRzIGltcGxlbWVudGF0aW9uIG9mIHR5cGUgZGVzY3JpcHRvcnMgYXJlbid0IGJyaWxsaWFudCB5ZXQsIHNlZSB0aGlzIHF1ZXN0aW9uIGZvciBtb3JlIGluZm9ybWF0aW9uIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8zMDE5MDM0MS8xMTcyNDIiLAogICAgICAgICAgKQogICAgICAgIGlmICghU2suYnVpbHRpbi5QeVR5cGVfSXNTdWJ0eXBlKGEub2JqLm9iJHR5cGUsIGEudHlwZSkpCiAgICAgICAgICB0aHJvdyBuZXcgU2suYnVpbHRpbi5UeXBlRXJyb3IoCiAgICAgICAgICAgICJzdXBlcih0eXBlLCBvYmopOiBvYmogbXVzdCBiZSBhbiBpbnN0YW5jZSBvZiBzdWJ0eXBlIG9mIHR5cGUiLAogICAgICAgICAgKQogICAgICAgIHJldHVybiBTay5idWlsdGluLm5vbmUubm9uZSQKICAgICAgfSkKICAgICAgU2suYWJzdHIuc2V0VXBJbmhlcml0YW5jZSgic3VwZXIiLCBTay5idWlsdGluLnN1cGVyXywgU2suYnVpbHRpbi5vYmplY3QpCiAgICAgIFNrLmJ1aWx0aW4uc3VwZXJfLnByb3RvdHlwZS50cCRnZXRhdHRyID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICB2YXIgYywKICAgICAgICAgIGQsCiAgICAgICAgICBlID0gYS4kanNzdHIoKQogICAgICAgIHZhciBmID0gdGhpcy5vYmpfdHlwZQogICAgICAgIFNrLmFzc2VydHMuYXNzZXJ0KHZvaWQgMCAhPT0gZiwgIm9iamVjdCBoYXMgbm8gb2IkdHlwZSEiKQogICAgICAgIGlmICgoZCA9IHRoaXMub2JqLiRkIHx8IHRoaXMub2JqLmNvbnN0cnVjdG9yLiRkKSkKICAgICAgICAgIGlmICgKICAgICAgICAgICAgKGQubXAkbG9va3VwCiAgICAgICAgICAgICAgPyAoYyA9IGQubXAkbG9va3VwKGEpKQogICAgICAgICAgICAgIDogZC5tcCRzdWJzY3JpcHQKICAgICAgICAgICAgICA/IChjID0gU2suYnVpbHRpbi5fdHJ5R2V0U3Vic2NyaXB0KGQsIGEpKQogICAgICAgICAgICAgIDogIm9iamVjdCIgPT09IHR5cGVvZiBkICYmIChjID0gZFtlXSksCiAgICAgICAgICAgIHZvaWQgMCAhPT0gYykKICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIGMKICAgICAgICBjID0gU2suYnVpbHRpbi50eXBlLnR5cGVMb29rdXAoZiwgYSkKICAgICAgICBpZiAodm9pZCAwICE9PSBjICYmIG51bGwgIT09IGMgJiYgKGEgPSBjLnRwJGRlc2NyX2dldCkpCiAgICAgICAgICByZXR1cm4gYS5jYWxsKGMsIHRoaXMub2JqLCB0aGlzLm9ial90eXBlLCBiKQogICAgICAgIGlmICh2b2lkIDAgIT09IGMpIHJldHVybiBjCiAgICAgIH0KICAgICAgU2suYnVpbHRpbi5zdXBlcl8ucHJvdG90eXBlLiRyID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmoKICAgICAgICAgID8gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICAgICAgICI8c3VwZXI6IDxjbGFzcyAnIiArCiAgICAgICAgICAgICAgICAodGhpcy50eXBlID8gdGhpcy50eXBlLnRwJG5hbWUgOiAiTlVMTCIpICsKICAgICAgICAgICAgICAgICInPiwgPCIgKwogICAgICAgICAgICAgICAgdGhpcy5vYmoudHAkbmFtZSArCiAgICAgICAgICAgICAgICAiIG9iamVjdD4+IiwKICAgICAgICAgICAgKQogICAgICAgICAgOiBuZXcgU2suYnVpbHRpbi5zdHIoCiAgICAgICAgICAgICAgIjxzdXBlcjogPGNsYXNzICciICsKICAgICAgICAgICAgICAgICh0aGlzLnR5cGUgPyB0aGlzLnR5cGUudHAkbmFtZSA6ICJOVUxMIikgKwogICAgICAgICAgICAgICAgIic+LCBOVUxMPiIsCiAgICAgICAgICAgICkKICAgICAgfQogICAgICBTay5idWlsdGluLnN1cGVyXy5fX2RvY19fID0gbmV3IFNrLmJ1aWx0aW4uc3RyKAogICAgICAgICJzdXBlcih0eXBlLCBvYmopIC0+IGJvdW5kIHN1cGVyIG9iamVjdDsgcmVxdWlyZXMgaXNpbnN0YW5jZShvYmosIHR5cGUpXG5zdXBlcih0eXBlKSAtPiB1bmJvdW5kIHN1cGVyIG9iamVjdFxuc3VwZXIodHlwZSwgdHlwZTIpIC0+IGJvdW5kIHN1cGVyIG9iamVjdDsgcmVxdWlyZXMgaXNzdWJjbGFzcyh0eXBlMiwgdHlwZSlcblR5cGljYWwgdXNlIHRvIGNhbGwgYSBjb29wZXJhdGl2ZSBzdXBlcmNsYXNzIG1ldGhvZDpcbmNsYXNzIEMoQik6XG4gICAgZGVmIG1ldGgoc2VsZiwgYXJnKTpcbiAgICAgICAgc3VwZXIoQywgc2VsZikubWV0aChhcmcpIiwKICAgICAgKQogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW5zID0gewogICAgICAgIHJhbmdlOiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4ucmFuZ2UpLAogICAgICAgIHJvdW5kOiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4ucm91bmQpLAogICAgICAgIGxlbjogbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLmxlbiksCiAgICAgICAgbWluOiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4ubWluKSwKICAgICAgICBtYXg6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5tYXgpLAogICAgICAgIHN1bTogbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLnN1bSksCiAgICAgICAgYWJzOiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4uYWJzKSwKICAgICAgICBmYWJzOiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4uZmFicyksCiAgICAgICAgb3JkOiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4ub3JkKSwKICAgICAgICBjaHI6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5jaHIpLAogICAgICAgIGhleDogbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLmhleCksCiAgICAgICAgb2N0OiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4ub2N0KSwKICAgICAgICBiaW46IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5iaW4pLAogICAgICAgIGRpcjogbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLmRpciksCiAgICAgICAgcmVwcjogbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLnJlcHIpLAogICAgICAgIG9wZW46IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5vcGVuKSwKICAgICAgICBpc2luc3RhbmNlOiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4uaXNpbnN0YW5jZSksCiAgICAgICAgaGFzaDogbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLmhhc2gpLAogICAgICAgIGdldGF0dHI6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5nZXRhdHRyKSwKICAgICAgICBoYXNhdHRyOiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4uaGFzYXR0ciksCiAgICAgICAgaWQ6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5pZCksCiAgICAgICAgcmVkdWNlOiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4ucmVkdWNlKSwKICAgICAgICBzb3J0ZWQ6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5zb3J0ZWQpLAogICAgICAgIGFueTogbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLmFueSksCiAgICAgICAgYWxsOiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4uYWxsKSwKICAgICAgICBBdHRyaWJ1dGVFcnJvcjogU2suYnVpbHRpbi5BdHRyaWJ1dGVFcnJvciwKICAgICAgICBWYWx1ZUVycm9yOiBTay5idWlsdGluLlZhbHVlRXJyb3IsCiAgICAgICAgRXhjZXB0aW9uOiBTay5idWlsdGluLkV4Y2VwdGlvbiwKICAgICAgICBaZXJvRGl2aXNpb25FcnJvcjogU2suYnVpbHRpbi5aZXJvRGl2aXNpb25FcnJvciwKICAgICAgICBBc3NlcnRpb25FcnJvcjogU2suYnVpbHRpbi5Bc3NlcnRpb25FcnJvciwKICAgICAgICBJbXBvcnRFcnJvcjogU2suYnVpbHRpbi5JbXBvcnRFcnJvciwKICAgICAgICBJbmRlbnRhdGlvbkVycm9yOiBTay5idWlsdGluLkluZGVudGF0aW9uRXJyb3IsCiAgICAgICAgSW5kZXhFcnJvcjogU2suYnVpbHRpbi5JbmRleEVycm9yLAogICAgICAgIEtleUVycm9yOiBTay5idWlsdGluLktleUVycm9yLAogICAgICAgIFR5cGVFcnJvcjogU2suYnVpbHRpbi5UeXBlRXJyb3IsCiAgICAgICAgTmFtZUVycm9yOiBTay5idWlsdGluLk5hbWVFcnJvciwKICAgICAgICBJT0Vycm9yOiBTay5idWlsdGluLklPRXJyb3IsCiAgICAgICAgTm90SW1wbGVtZW50ZWRFcnJvcjogU2suYnVpbHRpbi5Ob3RJbXBsZW1lbnRlZEVycm9yLAogICAgICAgIFN0YW5kYXJkRXJyb3I6IFNrLmJ1aWx0aW4uU3RhbmRhcmRFcnJvciwKICAgICAgICBTeXN0ZW1FeGl0OiBTay5idWlsdGluLlN5c3RlbUV4aXQsCiAgICAgICAgT3ZlcmZsb3dFcnJvcjogU2suYnVpbHRpbi5PdmVyZmxvd0Vycm9yLAogICAgICAgIE9wZXJhdGlvbkVycm9yOiBTay5idWlsdGluLk9wZXJhdGlvbkVycm9yLAogICAgICAgIE5lZ2F0aXZlUG93ZXJFcnJvcjogU2suYnVpbHRpbi5OZWdhdGl2ZVBvd2VyRXJyb3IsCiAgICAgICAgUnVudGltZUVycm9yOiBTay5idWlsdGluLlJ1bnRpbWVFcnJvciwKICAgICAgICBTdG9wSXRlcmF0aW9uOiBTay5idWlsdGluLlN0b3BJdGVyYXRpb24sCiAgICAgICAgZmxvYXRfJHJ3JDogU2suYnVpbHRpbi5mbG9hdF8sCiAgICAgICAgaW50XyRydyQ6IFNrLmJ1aWx0aW4uaW50XywKICAgICAgICBib29sOiBTay5idWlsdGluLmJvb2wsCiAgICAgICAgY29tcGxleDogU2suYnVpbHRpbi5jb21wbGV4LAogICAgICAgIGVudW1lcmF0ZTogU2suYnVpbHRpbi5lbnVtZXJhdGUsCiAgICAgICAgZGljdDogU2suYnVpbHRpbi5kaWN0LAogICAgICAgIGZpbGU6IFNrLmJ1aWx0aW4uZmlsZSwKICAgICAgICBmdW5jdGlvbjogU2suYnVpbHRpbi5mdW5jLAogICAgICAgIGdlbmVyYXRvcjogU2suYnVpbHRpbi5nZW5lcmF0b3IsCiAgICAgICAgbGlzdDogU2suYnVpbHRpbi5saXN0LAogICAgICAgIGxvbmdfJHJ3JDogU2suYnVpbHRpbi5sbmcsCiAgICAgICAgbWV0aG9kOiBTay5idWlsdGluLm1ldGhvZCwKICAgICAgICBvYmplY3Q6IFNrLmJ1aWx0aW4ub2JqZWN0LAogICAgICAgIHNsaWNlOiBTay5idWlsdGluLnNsaWNlLAogICAgICAgIHN0cjogU2suYnVpbHRpbi5zdHIsCiAgICAgICAgc2V0OiBTay5idWlsdGluLnNldCwKICAgICAgICB0dXBsZTogU2suYnVpbHRpbi50dXBsZSwKICAgICAgICB0eXBlOiBTay5idWlsdGluLnR5cGUsCiAgICAgICAgaW5wdXQ6IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5pbnB1dCksCiAgICAgICAgcmF3X2lucHV0OiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4ucmF3X2lucHV0KSwKICAgICAgICBzZXRhdHRyOiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4uc2V0YXR0ciksCiAgICAgICAganNldmFsOiBTay5idWlsdGluLmpzZXZhbCwKICAgICAgICBqc21pbGxpczogU2suYnVpbHRpbi5qc21pbGxpcywKICAgICAgICBxdWl0OiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4ucXVpdCksCiAgICAgICAgZXhpdDogbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLnF1aXQpLAogICAgICAgIHByaW50OiBTay5idWlsdGluLnByaW50LAogICAgICAgIGRpdm1vZDogbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLmRpdm1vZCksCiAgICAgICAgZm9ybWF0OiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4uZm9ybWF0KSwKICAgICAgICBnbG9iYWxzOiBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4uZ2xvYmFscyksCiAgICAgICAgaXNzdWJjbGFzczogbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLmlzc3ViY2xhc3MpLAogICAgICAgIGl0ZXI6IFNrLmJ1aWx0aW4uaXRlciwKICAgICAgICBieXRlYXJyYXk6IFNrLmJ1aWx0aW4uYnl0ZWFycmF5LAogICAgICAgIGNhbGxhYmxlOiBTay5idWlsdGluLmNhbGxhYmxlLAogICAgICAgIGRlbGF0dHI6IFNrLmJ1aWx0aW4uZGVsYXR0ciwKICAgICAgICBldmFsXyRybiQ6IFNrLmJ1aWx0aW4uZXZhbF8sCiAgICAgICAgZXhlY2ZpbGU6IFNrLmJ1aWx0aW4uZXhlY2ZpbGUsCiAgICAgICAgZnJvemVuc2V0OiBTay5idWlsdGluLmZyb3plbnNldCwKICAgICAgICBoZWxwOiBTay5idWlsdGluLmhlbHAsCiAgICAgICAgbG9jYWxzOiBTay5idWlsdGluLmxvY2FscywKICAgICAgICBtZW1vcnl2aWV3OiBTay5idWlsdGluLm1lbW9yeXZpZXcsCiAgICAgICAgbmV4dDogU2suYnVpbHRpbi5uZXh0XywKICAgICAgICBwb3c6IFNrLmJ1aWx0aW4ucG93LAogICAgICAgIHJlbG9hZDogU2suYnVpbHRpbi5yZWxvYWQsCiAgICAgICAgcmV2ZXJzZWQ6IFNrLmJ1aWx0aW4ucmV2ZXJzZWQsCiAgICAgICAgc3VwZXI6IFNrLmJ1aWx0aW4uc3VwZXJfLAogICAgICAgIHVuaWNocjogU2suYnVpbHRpbi51bmljaHIsCiAgICAgICAgdmFyczogU2suYnVpbHRpbi52YXJzLAogICAgICAgIHhyYW5nZTogU2suYnVpbHRpbi54cmFuZ2UsCiAgICAgICAgYXBwbHlfJHJuJDogU2suYnVpbHRpbi5hcHBseV8sCiAgICAgICAgYnVmZmVyOiBTay5idWlsdGluLmJ1ZmZlciwKICAgICAgICBjb2VyY2U6IFNrLmJ1aWx0aW4uY29lcmNlLAogICAgICAgIGludGVybjogU2suYnVpbHRpbi5pbnRlcm4sCiAgICAgIH0KICAgICAgU2suc2V0dXBPYmplY3RzID0gZnVuY3Rpb24gKGEpIHsKICAgICAgICBhCiAgICAgICAgICA/ICgoU2suYnVpbHRpbnMuZmlsdGVyID0gU2suYnVpbHRpbi5maWx0ZXJfKSwKICAgICAgICAgICAgKFNrLmJ1aWx0aW5zLm1hcCA9IFNrLmJ1aWx0aW4ubWFwXyksCiAgICAgICAgICAgIChTay5idWlsdGlucy56aXAgPSBTay5idWlsdGluLnppcF8pLAogICAgICAgICAgICAoU2suYnVpbHRpbnMucmFuZ2UgPSBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4ueHJhbmdlKSksCiAgICAgICAgICAgIGRlbGV0ZSBTay5idWlsdGlucy54cmFuZ2UsCiAgICAgICAgICAgIGRlbGV0ZSBTay5idWlsdGlucy5TdGFuZGFyZEVycm9yKQogICAgICAgICAgOiAoKFNrLmJ1aWx0aW5zLmZpbHRlciA9IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5maWx0ZXIpKSwKICAgICAgICAgICAgKFNrLmJ1aWx0aW5zLm1hcCA9IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi5tYXApKSwKICAgICAgICAgICAgKFNrLmJ1aWx0aW5zLnppcCA9IG5ldyBTay5idWlsdGluLmZ1bmMoU2suYnVpbHRpbi56aXApKSwKICAgICAgICAgICAgKFNrLmJ1aWx0aW5zLnJhbmdlID0gbmV3IFNrLmJ1aWx0aW4uZnVuYyhTay5idWlsdGluLnJhbmdlKSksCiAgICAgICAgICAgIChTay5idWlsdGlucy54cmFuZ2UgPSBuZXcgU2suYnVpbHRpbi5mdW5jKFNrLmJ1aWx0aW4ueHJhbmdlKSksCiAgICAgICAgICAgIChTay5idWlsdGlucy5TdGFuZGFyZEVycm9yID0gU2suYnVpbHRpbi5TdGFuZGFyZEVycm9yKSkKICAgICAgfQogICAgICBTay5leHBvcnRTeW1ib2woIlNrLnNldHVwT2JqZWN0cyIsIFNrLnNldHVwT2JqZWN0cykKICAgICAgU2suZXhwb3J0U3ltYm9sKCJTay5idWlsdGlucyIsIFNrLmJ1aWx0aW5zKQogICAgfSwKICAgIGZ1bmN0aW9uIChtLCBwKSB7CiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRlbXB0eXN0ciA9IG5ldyBTay5idWlsdGluLnN0cigiIikKICAgICAgU2suYnVpbHRpbi5ib29sLnRydWUkID0gT2JqZWN0LmNyZWF0ZShTay5idWlsdGluLmJvb2wucHJvdG90eXBlLCB7CiAgICAgICAgdjogeyB2YWx1ZTogMSwgZW51bWVyYWJsZTogITAgfSwKICAgICAgfSkKICAgICAgU2suYnVpbHRpbi5ib29sLmZhbHNlJCA9IE9iamVjdC5jcmVhdGUoU2suYnVpbHRpbi5ib29sLnByb3RvdHlwZSwgewogICAgICAgIHY6IHsgdmFsdWU6IDAsIGVudW1lcmFibGU6ICEwIH0sCiAgICAgIH0pCiAgICAgIFNrLmJ1aWx0aW4uaW50Xy5jb192YXJuYW1lcyA9IFsibnVtYmVyIiwgImJhc2UiXQogICAgICBTay5idWlsdGluLmludF8uJGRlZmF1bHRzID0gWzAsIFNrLmJ1aWx0aW4ubm9uZS5ub25lJF0KICAgICAgU2suYnVpbHRpbi5sbmcuY29fdmFybmFtZXMgPSBbIm51bWJlciIsICJiYXNlIl0KICAgICAgU2suYnVpbHRpbi5sbmcuJGRlZmF1bHRzID0gWzAsIFNrLmJ1aWx0aW4ubm9uZS5ub25lJF0KICAgICAgU2suYnVpbHRpbi5zb3J0ZWQuY29fdmFybmFtZXMgPSBbImxpc3QiLCAiY21wIiwgImtleSIsICJyZXZlcnNlIl0KICAgICAgU2suYnVpbHRpbi5zb3J0ZWQuJGRlZmF1bHRzID0gWwogICAgICAgIFNrLmJ1aWx0aW4ubm9uZS5ub25lJCwKICAgICAgICBTay5idWlsdGluLm5vbmUubm9uZSQsCiAgICAgICAgU2suYnVpbHRpbi5ib29sLmZhbHNlJCwKICAgICAgXQogICAgICBTay5idWlsdGluLmRpY3QuJGZyb21rZXlzLmNvX25hbWUgPSBuZXcgU2suYnVpbHRpbi5zdHIoImZyb21rZXlzIikKICAgICAgU2suYnVpbHRpbi5kaWN0LnByb3RvdHlwZS5mcm9ta2V5cyA9IG5ldyBTay5idWlsdGluLmZ1bmMoCiAgICAgICAgU2suYnVpbHRpbi5kaWN0LiRmcm9ta2V5cywKICAgICAgKQogICAgICBTay5idWlsdGluLnN0ci4kZW1wdHkgPSBuZXcgU2suYnVpbHRpbi5zdHIoIiIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRkZWZhdWx0X2ZhY3RvcnkgPSBuZXcgU2suYnVpbHRpbi5zdHIoImRlZmF1bHRfZmFjdG9yeSIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRpbWFnID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJpbWFnIikKICAgICAgU2suYnVpbHRpbi5zdHIuJHJlYWwgPSBuZXcgU2suYnVpbHRpbi5zdHIoInJlYWwiKQogICAgICBTay5idWlsdGluLnN0ci4kYWJzID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX2Fic19fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGNhbGwgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fY2FsbF9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGNtcCA9IG5ldyBTay5idWlsdGluLnN0cigiX19jbXBfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRjb21wbGV4ID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX2NvbXBsZXhfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRjb250YWlucyA9IG5ldyBTay5idWlsdGluLnN0cigiX19jb250YWluc19fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGNvcHkgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fY29weV9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGRpY3QgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fZGljdF9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGRpciA9IG5ldyBTay5idWlsdGluLnN0cigiX19kaXJfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRlbnRlciA9IG5ldyBTay5idWlsdGluLnN0cigiX19lbnRlcl9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGVxID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX2VxX18iKQogICAgICBTay5idWlsdGluLnN0ci4kZXhpdCA9IG5ldyBTay5idWlsdGluLnN0cigiX19leGl0X18iKQogICAgICBTay5idWlsdGluLnN0ci4kaW5kZXggPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9faW5kZXhfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRpbml0ID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX2luaXRfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRpbnRfID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX2ludF9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGl0ZXIgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9faXRlcl9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGZsb2F0XyA9IG5ldyBTay5idWlsdGluLnN0cigiX19mbG9hdF9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGZvcm1hdCA9IG5ldyBTay5idWlsdGluLnN0cigiX19mb3JtYXRfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRnZSA9IG5ldyBTay5idWlsdGluLnN0cigiX19nZV9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGdldGF0dHIgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fZ2V0YXR0cl9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGdldGF0dHJpYnV0ZSA9IG5ldyBTay5idWlsdGluLnN0cigiX19nZXRhdHRyaWJ1dGVfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRnZXRpdGVtID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX2dldGl0ZW1fXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRndCA9IG5ldyBTay5idWlsdGluLnN0cigiX19ndF9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGxlID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX2xlX18iKQogICAgICBTay5idWlsdGluLnN0ci4kbGVuID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX2xlbl9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJGx0ID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX2x0X18iKQogICAgICBTay5idWlsdGluLnN0ci4kbmFtZSA9IG5ldyBTay5idWlsdGluLnN0cigiX19uYW1lX18iKQogICAgICBTay5idWlsdGluLnN0ci4kbmUgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fbmVfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRuZXcgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fbmV3X18iKQogICAgICBTay5idWlsdGluLnN0ci4kbmV4dDIgPSBuZXcgU2suYnVpbHRpbi5zdHIoIm5leHQiKQogICAgICBTay5idWlsdGluLnN0ci4kbmV4dDMgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fbmV4dF9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJHBhdGggPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fcGF0aF9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJHJlcHIgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fcmVwcl9fIikKICAgICAgU2suYnVpbHRpbi5zdHIuJHJldmVyc2VkID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX3JldmVyc2VkX18iKQogICAgICBTay5idWlsdGluLnN0ci4kcm91bmQgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fcm91bmRfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRzZXRhdHRyID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX3NldGF0dHJfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRzZXRpdGVtID0gbmV3IFNrLmJ1aWx0aW4uc3RyKCJfX3NldGl0ZW1fXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiRzdHIgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fc3RyX18iKQogICAgICBTay5idWlsdGluLnN0ci4kdHJ1bmMgPSBuZXcgU2suYnVpbHRpbi5zdHIoIl9fdHJ1bmNfXyIpCiAgICAgIFNrLmJ1aWx0aW4uc3RyLiR3cml0ZSA9IG5ldyBTay5idWlsdGluLnN0cigid3JpdGUiKQogICAgICBTay5taXNjZXZhbC5vcDJtZXRob2RfID0gewogICAgICAgIEVxOiBTay5idWlsdGluLnN0ci4kZXEsCiAgICAgICAgTm90RXE6IFNrLmJ1aWx0aW4uc3RyLiRuZSwKICAgICAgICBHdDogU2suYnVpbHRpbi5zdHIuJGd0LAogICAgICAgIEd0RTogU2suYnVpbHRpbi5zdHIuJGdlLAogICAgICAgIEx0OiBTay5idWlsdGluLnN0ci4kbHQsCiAgICAgICAgTHRFOiBTay5idWlsdGluLnN0ci4kbGUsCiAgICAgIH0KICAgICAgbSA9ICJpbnRfIGxuZyBzb3J0ZWQgcmFuZ2Ugcm91bmQgbGVuIG1pbiBtYXggc3VtIHppcCBhYnMgZmFicyBvcmQgY2hyIGhleCBvY3QgYmluIGRpciByZXByIG9wZW4gaXNpbnN0YW5jZSBoYXNoIGdldGF0dHIgaGFzYXR0ciBpZCBtYXAgZmlsdGVyIHJlZHVjZSBzb3J0ZWQgYW55IGFsbCBpbnB1dCByYXdfaW5wdXQgc2V0YXR0ciBxdWl0IHF1aXQgZGl2bW9kIGZvcm1hdCBnbG9iYWxzIGlzc3ViY2xhc3MiLnNwbGl0KAogICAgICAgICIgIiwKICAgICAgKQogICAgICBmb3IgKHAgPSAwOyBwIDwgbS5sZW5ndGg7IHArKykKICAgICAgICBTay5idWlsdGluW21bcF1dLmNvX25hbWUgPSBuZXcgU2suYnVpbHRpbi5zdHIobVtwXSkKICAgIH0sCiAgICBmdW5jdGlvbiAobSwgcCkgewogICAgICBTay5pbnRlcm5hbFB5ID0gewogICAgICAgIGZpbGVzOiB7CiAgICAgICAgICAic3JjL2NsYXNzbWV0aG9kLnB5IjoKICAgICAgICAgICAgJ2NsYXNzIGNsYXNzbWV0aG9kKG9iamVjdCk6XG4gICAgIkVtdWxhdGUgUHlDbGFzc01ldGhvZF9UeXBlKCkgaW4gT2JqZWN0cy9mdW5jb2JqZWN0LmMiXG5cbiAgICBkZWYgX19pbml0X18oc2VsZiwgZik6XG4gICAgICAgIHNlbGYuZiA9IGZcblxuICAgIGRlZiBfX2dldF9fKHNlbGYsIG9iaiwga2xhc3M9Tm9uZSk6XG4gICAgICAgIGlmIGtsYXNzIGlzIE5vbmU6XG4gICAgICAgICAgICBrbGFzcyA9IHR5cGUob2JqKVxuICAgICAgICBkZWYgbmV3ZnVuYygqYXJncyk6XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5mKGtsYXNzLCAqYXJncylcbiAgICAgICAgcmV0dXJuIG5ld2Z1bmNcbicsCiAgICAgICAgICAic3JjL3Byb3BlcnR5LnB5IjoKICAgICAgICAgICAgJ2NsYXNzIHByb3BlcnR5KG9iamVjdCk6XG4gICAgIkVtdWxhdGUgUHlQcm9wZXJ0eV9UeXBlKCkgaW4gT2JqZWN0cy9kZXNjcm9iamVjdC5jIlxuXG4gICAgZGVmIF9faW5pdF9fKHNlbGYsIGZnZXQ9Tm9uZSwgZnNldD1Ob25lLCBmZGVsPU5vbmUsIGRvYz1Ob25lKTpcbiAgICAgICAgc2VsZi5mZ2V0ID0gZmdldFxuICAgICAgICBzZWxmLmZzZXQgPSBmc2V0XG4gICAgICAgIHNlbGYuZmRlbCA9IGZkZWxcbiAgICAgICAgaWYgZG9jIGlzIE5vbmUgYW5kIGZnZXQgaXMgbm90IE5vbmU6XG4gICAgICAgICAgICBpZiBoYXNhdHRyKGZnZXQsIFwnX19kb2NfX1wnKTpcbiAgICAgICAgICAgICAgICBkb2MgPSBmZ2V0Ll9fZG9jX19cbiAgICAgICAgICAgIGVsc2U6XG4gICAgICAgICAgICAgICAgZG9jID0gTm9uZVxuICAgICAgICBzZWxmLl9fZG9jX18gPSBkb2NcblxuICAgIGRlZiBfX2dldF9fKHNlbGYsIG9iaiwgb2JqdHlwZT1Ob25lKTpcbiAgICAgICAgaWYgb2JqIGlzIE5vbmU6XG4gICAgICAgICAgICByZXR1cm4gc2VsZlxuICAgICAgICBpZiBzZWxmLmZnZXQgaXMgTm9uZTpcbiAgICAgICAgICAgIHJhaXNlIEF0dHJpYnV0ZUVycm9yKCJ1bnJlYWRhYmxlIGF0dHJpYnV0ZSIpXG4gICAgICAgIHJldHVybiBzZWxmLmZnZXQob2JqKVxuXG4gICAgZGVmIF9fc2V0X18oc2VsZiwgb2JqLCB2YWx1ZSk6XG4gICAgICAgIGlmIHNlbGYuZnNldCBpcyBOb25lOlxuICAgICAgICAgICAgcmFpc2UgQXR0cmlidXRlRXJyb3IoImNhblwndCBzZXQgYXR0cmlidXRlIilcbiAgICAgICAgc2VsZi5mc2V0KG9iaiwgdmFsdWUpXG5cbiAgICBkZWYgX19kZWxldGVfXyhzZWxmLCBvYmopOlxuICAgICAgICBpZiBzZWxmLmZkZWwgaXMgTm9uZTpcbiAgICAgICAgICAgIHJhaXNlIEF0dHJpYnV0ZUVycm9yKCJjYW5cJ3QgZGVsZXRlIGF0dHJpYnV0ZSIpXG4gICAgICAgIHNlbGYuZmRlbChvYmopXG5cbiAgICBkZWYgZ2V0dGVyKHNlbGYsIGZnZXQpOlxuICAgICAgICByZXR1cm4gdHlwZShzZWxmKShmZ2V0LCBzZWxmLmZzZXQsIHNlbGYuZmRlbCwgc2VsZi5fX2RvY19fKVxuXG4gICAgZGVmIHNldHRlcihzZWxmLCBmc2V0KTpcbiAgICAgICAgcmV0dXJuIHR5cGUoc2VsZikoc2VsZi5mZ2V0LCBmc2V0LCBzZWxmLmZkZWwsIHNlbGYuX19kb2NfXylcblxuICAgIGRlZiBkZWxldGVyKHNlbGYsIGZkZWwpOlxuICAgICAgICByZXR1cm4gdHlwZShzZWxmKShzZWxmLmZnZXQsIHNlbGYuZnNldCwgZmRlbCwgc2VsZi5fX2RvY19fKVxuJywKICAgICAgICAgICJzcmMvc3RhdGljbWV0aG9kLnB5IjoKICAgICAgICAgICAgJ2NsYXNzIHN0YXRpY21ldGhvZChvYmplY3QpOlxuICAgICJFbXVsYXRlIFB5U3RhdGljTWV0aG9kX1R5cGUoKSBpbiBPYmplY3RzL2Z1bmNvYmplY3QuYyJcblxuICAgIGRlZiBfX2luaXRfXyhzZWxmLCBmKTpcbiAgICAgICAgc2VsZi5mID0gZlxuXG4gICAgZGVmIF9fZ2V0X18oc2VsZiwgb2JqLCBvYmp0eXBlPU5vbmUpOlxuICAgICAgICByZXR1cm4gc2VsZi5mXG4nLAogICAgICAgIH0sCiAgICAgIH0KICAgIH0sCiAgXSkKfS5jYWxsKHRoaXMgfHwgd2luZG93KSkKCi8vIyBzb3VyY2VNYXBwaW5nVVJMPXNrdWxwdC5taW4uanMubWFwCg==")}}]);
//# sourceMappingURL=b94b02e2-51253d823995af5d283e.js.map