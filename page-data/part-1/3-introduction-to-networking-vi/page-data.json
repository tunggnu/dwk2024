{"componentChunkName":"component---src-templates-course-content-template-js","path":"/part-1/3-introduction-to-networking-vi","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"Mục tiêu học tập"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sau phần này bạn"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"có thể sử dụng Service để truy cập ứng dụng từ bên ngoài cụm"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"có thể sử dụng Ingress để truy cập ứng dụng từ bên ngoài cụm"}]},{"type":"text","value":"\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Quay lại với việc phát triển! Khởi động lại và theo dõi log thật thú vị. Tiếp theo, chúng ta sẽ mở một endpoint cho ứng dụng và truy cập nó qua HTTP."}]},{"type":"element","tagName":"h4","properties":{"id":"ứng-dụng-mạng-dơn-giản","style":"position:relative;"},"children":[{"type":"text","value":"Ứng dụng mạng đơn giản"},{"type":"element","tagName":"a","properties":{"href":"#%E1%BB%A9ng-d%E1%BB%A5ng-m%E1%BA%A1ng-d%C6%A1n-gi%E1%BA%A3n","ariaLabel":"ứng dụng mạng dơn giản permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Hãy phát triển ứng dụng của chúng ta sao cho nó có một máy chủ HTTP phản hồi với hai giá trị băm: một giá trị băm được lưu cho đến khi tiến trình kết thúc và một giá trị băm dành riêng cho mỗi yêu cầu. Nội dung phản hồi có thể là \"Application abc123. Request 94k9m2\". Bạn có thể chọn bất kỳ cổng nào để lắng nghe."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tôi đã chuẩn bị sẵn một ví dụ "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/kubernetes-hy/material-example/tree/master/app2","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"tại đây"}]},{"type":"text","value":". Mặc định, nó sẽ lắng nghe ở cổng 3000."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ kubectl apply -f https://raw.githubusercontent.com/kubernetes-hy/material-example/master/app2/manifests/deployment.yaml\n  deployment.apps/hashresponse-dep được tạo"}]}]}]},{"type":"element","tagName":"h3","properties":{"id":"kết-nối-từ-ben-ngoai-cụm","style":"position:relative;"},"children":[{"type":"text","value":"Kết nối từ bên ngoài cụm"},{"type":"element","tagName":"a","properties":{"href":"#k%E1%BA%BFt-n%E1%BB%91i-t%E1%BB%AB-ben-ngoai-c%E1%BB%A5m","ariaLabel":"kết nối từ ben ngoai cụm permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Chúng ta có thể xác nhận rằng hashresponse-dep đang hoạt động bằng lệnh "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"port-forward"}]},{"type":"text","value":". Hãy xem tên của pod trước rồi chuyển tiếp cổng đến đó:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ kubectl get po\n  NAME                                READY   STATUS    RESTARTS   AGE\n  hashgenerator-dep-5cbbf97d5-z2ct9   1/1     Running   0          20h\n  hashresponse-dep-57bcc888d7-dj5vk   1/1     Running   0          19h\n\n$ kubectl port-forward hashresponse-dep-57bcc888d7-dj5vk 3003:3000\n  Đang chuyển tiếp từ 127.0.0.1:3003 -> 3000\n  Đang chuyển tiếp từ [::1]:3003 -> 3000"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bây giờ chúng ta có thể xem phản hồi từ "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:3003","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost:3003"}]},{"type":"text","value":" và xác nhận rằng nó hoạt động như mong đợi."}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 1.05: Project v0.3"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Hãy làm cho project phản hồi lại một điều gì đó khi nhận được yêu cầu GET gửi đến project. Một trang html đơn giản là đủ hoặc bạn có thể triển khai thứ gì đó phức tạp hơn như một single-page-application."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Xem "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/tasks/inject-data-application/define-environment-variable-container/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"tại đây"}]},{"type":"text","value":" để biết cách định nghĩa biến môi trường cho container."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sử dụng "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl port-forward"}]},{"type":"text","value":" để xác nhận rằng project có thể truy cập và hoạt động trong cụm bằng cách dùng trình duyệt để truy cập project."}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kết nối bên ngoài với Docker sử dụng cờ -p "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-p 3003:3000"}]},{"type":"text","value":" hoặc trong Docker compose là khai báo ports. Đáng tiếc, Kubernetes không đơn giản như vậy. Chúng ta sẽ sử dụng hoặc "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Service"}]},{"type":"text","value":" hoặc "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Ingress"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"h4","properties":{"id":"trước-hết","style":"position:relative;"},"children":[{"type":"text","value":"Trước hết"},{"type":"element","tagName":"a","properties":{"href":"#tr%C6%B0%E1%BB%9Bc-h%E1%BA%BFt","ariaLabel":"trước hết permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vì chúng ta đang chạy cụm bên trong Docker với k3d nên sẽ cần một số chuẩn bị."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Mở một đường dẫn từ bên ngoài cụm đến pod sẽ không đủ nếu chúng ta không có cách truy cập vào cụm bên trong các container!"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ docker ps\n  CONTAINER ID    IMAGE                      COMMAND                  CREATED             STATUS              PORTS                             NAMES\n  b60f6c246ebb    ghcr.io/k3d-io/k3d-proxy:5 \"/bin/sh -c nginx-pr…\"   2 giờ trước         Đang chạy 2 giờ     80/tcp, 0.0.0.0:58264->6443/tcp   k3d-k3s-default-serverlb\n  553041f96fc6    rancher/k3s:latest         \"/bin/k3s agent\"         2 giờ trước         Đang chạy 2 giờ                                        k3d-k3s-default-agent-1\n  aebd23c2ef99    rancher/k3s:latest         \"/bin/k3s agent\"         2 giờ trước         Đang chạy 2 giờ                                        k3d-k3s-default-agent-0\n  a34e49184d37    rancher/k3s:latest         \"/bin/k3s server --t…\"   2 giờ trước         Đang chạy 2 giờ                                        k3d-k3s-default-server-0"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kéo sang phải một chút, chúng ta thấy K3d đã chuẩn bị sẵn cổng 6443 để truy cập API. Ngoài ra, cổng 80 cũng đã mở. Tất cả các yêu cầu đến load balancer này sẽ được chuyển tiếp đến cùng cổng của tất cả các node server trong cụm. Tuy nhiên, cho mục đích kiểm thử, chúng ta sẽ muốn "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"mở một cổng riêng cho một node cụ thể"}]},{"type":"text","value":". Hãy xóa cụm cũ và tạo một cụm mới với một số cổng được mở."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tài liệu "},{"type":"element","tagName":"a","properties":{"href":"https://k3d.io/v5.3.0/usage/commands/k3d_cluster_create/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"K3d"}]},{"type":"text","value":" cho biết cách mở cổng, chúng ta sẽ mở cổng local 8081 tới 80 ở k3d-k3s-default-serverlb và local 8082 tới 30080 ở k3d-k3s-default-agent-0. Cổng 30080 được chọn gần như ngẫu nhiên, nhưng cần nằm trong khoảng 30000-32767 cho bước tiếp theo:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ k3d cluster delete\n  INFO[0000] Đang xóa cụm 'k3s-default'\n  ...\n  INFO[0002] Đã xóa thành công cụm k3s-default!\n\n$ k3d cluster create --port 8082:30080@agent:0 -p 8081:80@loadbalancer --agents 2\n  INFO[0000] Đã tạo mạng 'k3d-k3s-default'\n  ...\n  INFO[0021] Đã tạo cụm 'k3s-default' thành công!\n  INFO[0021] Bây giờ bạn có thể sử dụng như sau:\n  kubectl cluster-info\n\n$ kubectl apply -f https://raw.githubusercontent.com/kubernetes-hy/material-example/master/app2/manifests/deployment.yaml\n  deployment.apps/hashresponse-dep được tạo"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ở trên, \"agent:0\" và \"loadbalancer\" dựa trên tài liệu "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/rancher/k3d/blob/main/docs/usage/exposing_services.md","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"K3d"}]},{"type":"text","value":" và đọc mã nguồn từ "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/rancher/k3d/blob/11cc7979228f304025d61254eb0c0cb2745b9444/cmd/util/filter.go#L119","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"đây"}]},{"type":"text","value":" và "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/rancher/k3d/blob/main/pkg/types/types.go#L65","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"đây"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bây giờ chúng ta có thể truy cập qua cổng 8081 tới node server (thực ra là tất cả các node) và 8082 tới cổng 30080 của một node agent. Chúng sẽ được dùng để trình diễn các phương pháp giao tiếp khác nhau với các server."}]},{"type":"element","tagName":"text-box","properties":{"name":"Giới hạn của môi trường cục bộ","variant":"hint"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Thiết lập này không hoàn hảo, trong tương lai chúng ta sẽ chỉ có một số lượng cổng giới hạn. Tuy nhiên, điều này là đủ cho các trường hợp sử dụng của chúng ta."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Hệ điều hành của bạn có thể hỗ trợ sử dụng mạng host nên không cần mở cổng. Tuy nhiên, tôi chưa có kinh nghiệm với điều này."}]}]},{"type":"element","tagName":"h4","properties":{"id":"service-la-gi","style":"position:relative;"},"children":[{"type":"text","value":"Service là gì?"},{"type":"element","tagName":"a","properties":{"href":"#service-la-gi","ariaLabel":"service la gi permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Giống như "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Deployment"}]},{"type":"text","value":" lo việc triển khai cho chúng ta. "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Service"}]},{"type":"text","value":" sẽ lo việc phục vụ ứng dụng cho các kết nối từ bên ngoài (và cả bên trong!) cụm."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tạo một file service.yaml trong thư mục manifests và chúng ta cần service thực hiện các việc sau:"}]},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Khai báo rằng chúng ta muốn một Service"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Khai báo cổng sẽ lắng nghe"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Khai báo ứng dụng mà yêu cầu sẽ được chuyển đến"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Khai báo cổng mà yêu cầu sẽ được chuyển đến"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Điều này sẽ thành một file yaml như sau"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"service.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Service\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" hashresponse"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"svc\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" NodePort\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" hashresponse "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Đây là app đã khai báo trong deployment."}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"ports"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" http\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"nodePort"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"30080"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Đây là cổng sẽ mở ra ngoài. Giá trị nodePort phải nằm trong khoảng 30000-32767"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"protocol"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" TCP\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"port"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1234"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Đây là cổng dùng trong cụm, có thể là bất kỳ giá trị nào"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"targetPort"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3000"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Đây là cổng đích"}]}]}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ kubectl apply -f manifests/service.yaml\n  service/hashresponse-svc được tạo"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vì chúng ta đã publish 8082 thành 30080 nên giờ có thể truy cập qua "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:8082","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost:8082"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Chúng ta vừa định nghĩa một nodeport với "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"type: NodePort"}]},{"type":"text","value":". "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"NodePort"}]},{"type":"text","value":" đơn giản là các cổng được Kubernetes mở ra cho "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"tất cả các node"}]},{"type":"text","value":" và service sẽ xử lý các yêu cầu trên cổng đó. NodePort không linh hoạt và bạn phải gán một cổng khác nhau cho mỗi ứng dụng. Vì vậy NodePort không được dùng trong môi trường production nhưng rất hữu ích để tìm hiểu."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Thay vì NodePort, chúng ta nên dùng "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"LoadBalancer"}]},{"type":"text","value":" nhưng loại này \"chỉ\" hoạt động với các nhà cung cấp đám mây vì nó cấu hình một load balancer (có thể tốn phí). Chúng ta sẽ tìm hiểu về nó ở phần 3."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Có một tài nguyên nữa sẽ giúp chúng ta phục vụ ứng dụng, đó là "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Ingress"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 1.06: Project v0.4"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sử dụng NodePort Service để cho phép truy cập vào project."}]}]},{"type":"element","tagName":"h4","properties":{"id":"ingress-la-gi","style":"position:relative;"},"children":[{"type":"text","value":"Ingress là gì?"},{"type":"element","tagName":"a","properties":{"href":"#ingress-la-gi","ariaLabel":"ingress la gi permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tài nguyên truy cập mạng vào "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/services-networking/ingress/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Ingress"}]},{"type":"text","value":" là một loại tài nguyên hoàn toàn khác với "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Service"}]},{"type":"text","value":". Nếu bạn nhớ mô hình "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/OSI_model","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"OSI"}]},{"type":"text","value":", nó hoạt động ở tầng 7 còn service ở tầng 4. Bạn có thể thấy chúng được dùng cùng nhau: đầu tiên là "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"LoadBalancer"}]},{"type":"text","value":" rồi đến Ingress để xử lý định tuyến. Trong trường hợp của chúng ta, vì không có load balancer nên có thể dùng Ingress như điểm dừng đầu tiên. Nếu bạn quen với reverse proxy như Nginx, Ingress sẽ rất quen thuộc."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ingress được triển khai bởi nhiều \"controller\" khác nhau. Điều này nghĩa là ingress không tự động hoạt động trong cụm mà bạn có thể chọn controller phù hợp nhất. K3s đã cài sẵn "},{"type":"element","tagName":"a","properties":{"href":"https://containo.us/traefik/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Traefik"}]},{"type":"text","value":". Các lựa chọn khác gồm Istio và Nginx Ingress Controller, "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"xem thêm tại đây"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Chuyển sang Ingress sẽ yêu cầu tạo một tài nguyên Ingress. Ingress sẽ định tuyến lưu lượng đến "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Service"}]},{"type":"text","value":", nhưng Service kiểu "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"NodePort"}]},{"type":"text","value":" cũ sẽ không dùng được."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ kubectl delete -f manifests/service.yaml\n  service \"hashresponse-svc\" đã bị xóa"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Một Service kiểu "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/services-networking/service/#type-clusterip","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"ClusterIP"}]},{"type":"text","value":" sẽ cấp cho Service một IP nội bộ chỉ truy cập được trong cụm."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sau đây sẽ cho phép lưu lượng TCP từ cổng 2345 đến cổng 3000."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"service.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Service\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" hashresponse"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"svc\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ClusterIP\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" hashresponse\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"ports"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"port"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2345"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"protocol"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" TCP\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"targetPort"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3000"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tài nguyên thứ hai chúng ta cần là "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Ingress"}]},{"type":"text","value":" mới."}]},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Khai báo đây là Ingress"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Định tuyến tất cả lưu lượng đến service của chúng ta"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"ingress.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" networking.k8s.io/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Ingress\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" dwk"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"material"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"ingress\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"rules"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"http"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"paths"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"path"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" /\n            "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"pathType"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Prefix\n            "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"backend"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n              "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n                "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" hashresponse"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"svc\n                "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"port"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n                  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"number"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2345"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sau đó chúng ta có thể apply tất cả và xem kết quả"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ kubectl apply -f manifests/\n  ingress.networking.k8s.io/dwk-material-ingress được tạo\n  service/hashresponse-svc đã được cấu hình\n\n$ kubectl get svc,ing\n  NAME                       TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE\n  service/kubernetes         ClusterIP   10.43.0.1    <none>        443/TCP    5m22s\n  service/hashresponse-svc   ClusterIP   10.43.0.61   <none>        2345/TCP   45s\n\n  NAME                                             CLASS    HOSTS   ADDRESS                            PORTS   AGE\n  ingress.networking.k8s.io/dwk-material-ingress   <none>   *       172.21.0.3,172.21.0.4,172.21.0.5   80      16s"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Chúng ta có thể thấy ingress đang lắng nghe ở cổng 80. Vì chúng ta đã mở cổng này nên có thể truy cập ứng dụng tại "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:8081","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost:8081"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 1.07: External access with Ingress"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ứng dụng \"Log output\" hiện tại ghi ra log một timestamp và một chuỗi ngẫu nhiên."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Thêm một endpoint để lấy trạng thái hiện tại (timestamp và chuỗi) và một ingress để có thể truy cập nó bằng trình duyệt."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bạn chỉ cần lưu chuỗi và timestamp vào bộ nhớ."}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 1.08: Project v0.5"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Chuyển sang sử dụng Ingress thay vì NodePort để truy cập project. Bạn có thể xóa ingress của ứng dụng \"Log output\" để tránh gây nhiễu cho bài tập này. Chúng ta sẽ tìm hiểu thêm về đường dẫn và định tuyến ở bài tiếp theo và khi đó bạn có thể cấu hình project chạy song song với ứng dụng \"Log output\"."}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 1.09: More services"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Phát triển một ứng dụng thứ hai chỉ đơn giản trả về \"pong 0\" cho một yêu cầu GET và tăng bộ đếm (số 0) để bạn có thể thấy đã gửi bao nhiêu yêu cầu. Bộ đếm nên lưu trong bộ nhớ nên có thể bị reset bất cứ lúc nào.\nTạo một deployment mới cho nó và cho nó dùng chung ingress với ứng dụng \"Log output\". Định tuyến các yêu cầu gửi đến '/pingpong' cho ứng dụng này."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Trong các bài tập sau, ứng dụng thứ hai này sẽ được gọi là \"ứng dụng ping-pong\". Nó sẽ được sử dụng cùng với ứng dụng \"Log output\"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ứng dụng ping-pong sẽ cần lắng nghe các yêu cầu tại '/pingpong', vì vậy bạn có thể phải thay đổi mã nguồn của nó. Điều này có thể tránh được bằng cách cấu hình ingress để viết lại đường dẫn, nhưng chúng ta sẽ để đó như một bài tập tùy chọn. Bạn có thể tham khảo "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/services-networking/ingress/#the-ingress-resource","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://kubernetes.io/docs/concepts/services-networking/ingress/#the-ingress-resource"}]}]}]}]},"html":"<div><text-box variant='learningObjectives' name='Mục tiêu học tập'><p>Sau phần này bạn</p><ul>\n<li>có thể sử dụng Service để truy cập ứng dụng từ bên ngoài cụm</li>\n<li>có thể sử dụng Ingress để truy cập ứng dụng từ bên ngoài cụm</li>\n</ul></text-box><p>Quay lại với việc phát triển! Khởi động lại và theo dõi log thật thú vị. Tiếp theo, chúng ta sẽ mở một endpoint cho ứng dụng và truy cập nó qua HTTP.</p><h4 id=\"ứng-dụng-mạng-dơn-giản\" style=\"position:relative;\">Ứng dụng mạng đơn giản<a href=\"#%E1%BB%A9ng-d%E1%BB%A5ng-m%E1%BA%A1ng-d%C6%A1n-gi%E1%BA%A3n\" aria-label=\"ứng dụng mạng dơn giản permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4><p>Hãy phát triển ứng dụng của chúng ta sao cho nó có một máy chủ HTTP phản hồi với hai giá trị băm: một giá trị băm được lưu cho đến khi tiến trình kết thúc và một giá trị băm dành riêng cho mỗi yêu cầu. Nội dung phản hồi có thể là \"Application abc123. Request 94k9m2\". Bạn có thể chọn bất kỳ cổng nào để lắng nghe.</p><p>Tôi đã chuẩn bị sẵn một ví dụ <a href=\"https://github.com/kubernetes-hy/material-example/tree/master/app2\" target=\"_blank\" rel=\"noopener noreferrer\">tại đây</a>. Mặc định, nó sẽ lắng nghe ở cổng 3000.</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ kubectl apply -f https://raw.githubusercontent.com/kubernetes-hy/material-example/master/app2/manifests/deployment.yaml\n  deployment.apps/hashresponse-dep được tạo</code></pre></div><h3 id=\"kết-nối-từ-ben-ngoai-cụm\" style=\"position:relative;\">Kết nối từ bên ngoài cụm<a href=\"#k%E1%BA%BFt-n%E1%BB%91i-t%E1%BB%AB-ben-ngoai-c%E1%BB%A5m\" aria-label=\"kết nối từ ben ngoai cụm permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p>Chúng ta có thể xác nhận rằng hashresponse-dep đang hoạt động bằng lệnh <code class=\"language-text\">port-forward</code>. Hãy xem tên của pod trước rồi chuyển tiếp cổng đến đó:</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ kubectl get po\n  NAME                                READY   STATUS    RESTARTS   AGE\n  hashgenerator-dep-5cbbf97d5-z2ct9   1/1     Running   0          20h\n  hashresponse-dep-57bcc888d7-dj5vk   1/1     Running   0          19h\n\n$ kubectl port-forward hashresponse-dep-57bcc888d7-dj5vk 3003:3000\n  Đang chuyển tiếp từ 127.0.0.1:3003 -&gt; 3000\n  Đang chuyển tiếp từ [::1]:3003 -&gt; 3000</code></pre></div><p>Bây giờ chúng ta có thể xem phản hồi từ <a href=\"http://localhost:3003\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:3003</a> và xác nhận rằng nó hoạt động như mong đợi.</p><exercise name='Exercise 1.05: Project v0.3'><p>Hãy làm cho project phản hồi lại một điều gì đó khi nhận được yêu cầu GET gửi đến project. Một trang html đơn giản là đủ hoặc bạn có thể triển khai thứ gì đó phức tạp hơn như một single-page-application.</p><p>Xem <a href=\"https://kubernetes.io/docs/tasks/inject-data-application/define-environment-variable-container/\" target=\"_blank\" rel=\"noopener noreferrer\">tại đây</a> để biết cách định nghĩa biến môi trường cho container.</p><p>Sử dụng <code class=\"language-text\">kubectl port-forward</code> để xác nhận rằng project có thể truy cập và hoạt động trong cụm bằng cách dùng trình duyệt để truy cập project.</p></exercise><p>Kết nối bên ngoài với Docker sử dụng cờ -p <code class=\"language-text\">-p 3003:3000</code> hoặc trong Docker compose là khai báo ports. Đáng tiếc, Kubernetes không đơn giản như vậy. Chúng ta sẽ sử dụng hoặc <em>Service</em> hoặc <em>Ingress</em>.</p><h4 id=\"trước-hết\" style=\"position:relative;\">Trước hết<a href=\"#tr%C6%B0%E1%BB%9Bc-h%E1%BA%BFt\" aria-label=\"trước hết permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4><p>Vì chúng ta đang chạy cụm bên trong Docker với k3d nên sẽ cần một số chuẩn bị.</p><p>Mở một đường dẫn từ bên ngoài cụm đến pod sẽ không đủ nếu chúng ta không có cách truy cập vào cụm bên trong các container!</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ docker ps\n  CONTAINER ID    IMAGE                      COMMAND                  CREATED             STATUS              PORTS                             NAMES\n  b60f6c246ebb    ghcr.io/k3d-io/k3d-proxy:5 &quot;/bin/sh -c nginx-pr…&quot;   2 giờ trước         Đang chạy 2 giờ     80/tcp, 0.0.0.0:58264-&gt;6443/tcp   k3d-k3s-default-serverlb\n  553041f96fc6    rancher/k3s:latest         &quot;/bin/k3s agent&quot;         2 giờ trước         Đang chạy 2 giờ                                        k3d-k3s-default-agent-1\n  aebd23c2ef99    rancher/k3s:latest         &quot;/bin/k3s agent&quot;         2 giờ trước         Đang chạy 2 giờ                                        k3d-k3s-default-agent-0\n  a34e49184d37    rancher/k3s:latest         &quot;/bin/k3s server --t…&quot;   2 giờ trước         Đang chạy 2 giờ                                        k3d-k3s-default-server-0</code></pre></div><p>Kéo sang phải một chút, chúng ta thấy K3d đã chuẩn bị sẵn cổng 6443 để truy cập API. Ngoài ra, cổng 80 cũng đã mở. Tất cả các yêu cầu đến load balancer này sẽ được chuyển tiếp đến cùng cổng của tất cả các node server trong cụm. Tuy nhiên, cho mục đích kiểm thử, chúng ta sẽ muốn <em>mở một cổng riêng cho một node cụ thể</em>. Hãy xóa cụm cũ và tạo một cụm mới với một số cổng được mở.</p><p>Tài liệu <a href=\"https://k3d.io/v5.3.0/usage/commands/k3d_cluster_create/\" target=\"_blank\" rel=\"noopener noreferrer\">K3d</a> cho biết cách mở cổng, chúng ta sẽ mở cổng local 8081 tới 80 ở k3d-k3s-default-serverlb và local 8082 tới 30080 ở k3d-k3s-default-agent-0. Cổng 30080 được chọn gần như ngẫu nhiên, nhưng cần nằm trong khoảng 30000-32767 cho bước tiếp theo:</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ k3d cluster delete\n  INFO[0000] Đang xóa cụm &#39;k3s-default&#39;\n  ...\n  INFO[0002] Đã xóa thành công cụm k3s-default!\n\n$ k3d cluster create --port 8082:30080@agent:0 -p 8081:80@loadbalancer --agents 2\n  INFO[0000] Đã tạo mạng &#39;k3d-k3s-default&#39;\n  ...\n  INFO[0021] Đã tạo cụm &#39;k3s-default&#39; thành công!\n  INFO[0021] Bây giờ bạn có thể sử dụng như sau:\n  kubectl cluster-info\n\n$ kubectl apply -f https://raw.githubusercontent.com/kubernetes-hy/material-example/master/app2/manifests/deployment.yaml\n  deployment.apps/hashresponse-dep được tạo</code></pre></div><p>Ở trên, \"agent:0\" và \"loadbalancer\" dựa trên tài liệu <a href=\"https://github.com/rancher/k3d/blob/main/docs/usage/exposing_services.md\" target=\"_blank\" rel=\"noopener noreferrer\">K3d</a> và đọc mã nguồn từ <a href=\"https://github.com/rancher/k3d/blob/11cc7979228f304025d61254eb0c0cb2745b9444/cmd/util/filter.go#L119\" target=\"_blank\" rel=\"noopener noreferrer\">đây</a> và <a href=\"https://github.com/rancher/k3d/blob/main/pkg/types/types.go#L65\" target=\"_blank\" rel=\"noopener noreferrer\">đây</a></p><p>Bây giờ chúng ta có thể truy cập qua cổng 8081 tới node server (thực ra là tất cả các node) và 8082 tới cổng 30080 của một node agent. Chúng sẽ được dùng để trình diễn các phương pháp giao tiếp khác nhau với các server.</p><text-box name=\"Giới hạn của môi trường cục bộ\" variant=\"hint\"><p>Thiết lập này không hoàn hảo, trong tương lai chúng ta sẽ chỉ có một số lượng cổng giới hạn. Tuy nhiên, điều này là đủ cho các trường hợp sử dụng của chúng ta.</p><p>Hệ điều hành của bạn có thể hỗ trợ sử dụng mạng host nên không cần mở cổng. Tuy nhiên, tôi chưa có kinh nghiệm với điều này.</p></text-box><h4 id=\"service-la-gi\" style=\"position:relative;\">Service là gì?<a href=\"#service-la-gi\" aria-label=\"service la gi permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4><p>Giống như <em>Deployment</em> lo việc triển khai cho chúng ta. <em>Service</em> sẽ lo việc phục vụ ứng dụng cho các kết nối từ bên ngoài (và cả bên trong!) cụm.</p><p>Tạo một file service.yaml trong thư mục manifests và chúng ta cần service thực hiện các việc sau:</p><ol>\n<li>Khai báo rằng chúng ta muốn một Service</li>\n<li>Khai báo cổng sẽ lắng nghe</li>\n<li>Khai báo ứng dụng mà yêu cầu sẽ được chuyển đến</li>\n<li>Khai báo cổng mà yêu cầu sẽ được chuyển đến</li>\n</ol><p>Điều này sẽ thành một file yaml như sau</p><p><strong>service.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> hashresponse<span class=\"token punctuation\">-</span>svc\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> NodePort\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> hashresponse <span class=\"token comment\"># Đây là app đã khai báo trong deployment.</span>\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http\n      <span class=\"token key atrule\">nodePort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30080</span> <span class=\"token comment\"># Đây là cổng sẽ mở ra ngoài. Giá trị nodePort phải nằm trong khoảng 30000-32767</span>\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1234</span> <span class=\"token comment\"># Đây là cổng dùng trong cụm, có thể là bất kỳ giá trị nào</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span> <span class=\"token comment\"># Đây là cổng đích</span></code></pre></div><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ kubectl apply -f manifests/service.yaml\n  service/hashresponse-svc được tạo</code></pre></div><p>Vì chúng ta đã publish 8082 thành 30080 nên giờ có thể truy cập qua <a href=\"http://localhost:8082\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:8082</a>.</p><p>Chúng ta vừa định nghĩa một nodeport với <code class=\"language-text\">type: NodePort</code>. <a href=\"https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport\" target=\"_blank\" rel=\"noopener noreferrer\">NodePort</a> đơn giản là các cổng được Kubernetes mở ra cho <strong>tất cả các node</strong> và service sẽ xử lý các yêu cầu trên cổng đó. NodePort không linh hoạt và bạn phải gán một cổng khác nhau cho mỗi ứng dụng. Vì vậy NodePort không được dùng trong môi trường production nhưng rất hữu ích để tìm hiểu.</p><p>Thay vì NodePort, chúng ta nên dùng <em>LoadBalancer</em> nhưng loại này \"chỉ\" hoạt động với các nhà cung cấp đám mây vì nó cấu hình một load balancer (có thể tốn phí). Chúng ta sẽ tìm hiểu về nó ở phần 3.</p><p>Có một tài nguyên nữa sẽ giúp chúng ta phục vụ ứng dụng, đó là <em>Ingress</em>.</p><exercise name='Exercise 1.06: Project v0.4'><p>Sử dụng NodePort Service để cho phép truy cập vào project.</p></exercise><h4 id=\"ingress-la-gi\" style=\"position:relative;\">Ingress là gì?<a href=\"#ingress-la-gi\" aria-label=\"ingress la gi permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4><p>Tài nguyên truy cập mạng vào <a href=\"https://kubernetes.io/docs/concepts/services-networking/ingress/\" target=\"_blank\" rel=\"noopener noreferrer\">Ingress</a> là một loại tài nguyên hoàn toàn khác với <em>Service</em>. Nếu bạn nhớ mô hình <a href=\"https://en.wikipedia.org/wiki/OSI_model\" target=\"_blank\" rel=\"noopener noreferrer\">OSI</a>, nó hoạt động ở tầng 7 còn service ở tầng 4. Bạn có thể thấy chúng được dùng cùng nhau: đầu tiên là <em>LoadBalancer</em> rồi đến Ingress để xử lý định tuyến. Trong trường hợp của chúng ta, vì không có load balancer nên có thể dùng Ingress như điểm dừng đầu tiên. Nếu bạn quen với reverse proxy như Nginx, Ingress sẽ rất quen thuộc.</p><p>Ingress được triển khai bởi nhiều \"controller\" khác nhau. Điều này nghĩa là ingress không tự động hoạt động trong cụm mà bạn có thể chọn controller phù hợp nhất. K3s đã cài sẵn <a href=\"https://containo.us/traefik/\" target=\"_blank\" rel=\"noopener noreferrer\">Traefik</a>. Các lựa chọn khác gồm Istio và Nginx Ingress Controller, <a href=\"https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/\" target=\"_blank\" rel=\"noopener noreferrer\">xem thêm tại đây</a>.</p><p>Chuyển sang Ingress sẽ yêu cầu tạo một tài nguyên Ingress. Ingress sẽ định tuyến lưu lượng đến <em>Service</em>, nhưng Service kiểu <em>NodePort</em> cũ sẽ không dùng được.</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ kubectl delete -f manifests/service.yaml\n  service &quot;hashresponse-svc&quot; đã bị xóa</code></pre></div><p>Một Service kiểu <a href=\"https://kubernetes.io/docs/concepts/services-networking/service/#type-clusterip\" target=\"_blank\" rel=\"noopener noreferrer\">ClusterIP</a> sẽ cấp cho Service một IP nội bộ chỉ truy cập được trong cụm.</p><p>Sau đây sẽ cho phép lưu lượng TCP từ cổng 2345 đến cổng 3000.</p><p><strong>service.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> hashresponse<span class=\"token punctuation\">-</span>svc\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ClusterIP\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> hashresponse\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2345</span>\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span></code></pre></div><p>Tài nguyên thứ hai chúng ta cần là <em>Ingress</em> mới.</p><ol>\n<li>Khai báo đây là Ingress</li>\n<li>Định tuyến tất cả lưu lượng đến service của chúng ta</li>\n</ol><p><strong>ingress.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Ingress\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dwk<span class=\"token punctuation\">-</span>material<span class=\"token punctuation\">-</span>ingress\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /\n            <span class=\"token key atrule\">pathType</span><span class=\"token punctuation\">:</span> Prefix\n            <span class=\"token key atrule\">backend</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> hashresponse<span class=\"token punctuation\">-</span>svc\n                <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token key atrule\">number</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2345</span></code></pre></div><p>Sau đó chúng ta có thể apply tất cả và xem kết quả</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ kubectl apply -f manifests/\n  ingress.networking.k8s.io/dwk-material-ingress được tạo\n  service/hashresponse-svc đã được cấu hình\n\n$ kubectl get svc,ing\n  NAME                       TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE\n  service/kubernetes         ClusterIP   10.43.0.1    &lt;none&gt;        443/TCP    5m22s\n  service/hashresponse-svc   ClusterIP   10.43.0.61   &lt;none&gt;        2345/TCP   45s\n\n  NAME                                             CLASS    HOSTS   ADDRESS                            PORTS   AGE\n  ingress.networking.k8s.io/dwk-material-ingress   &lt;none&gt;   *       172.21.0.3,172.21.0.4,172.21.0.5   80      16s</code></pre></div><p>Chúng ta có thể thấy ingress đang lắng nghe ở cổng 80. Vì chúng ta đã mở cổng này nên có thể truy cập ứng dụng tại <a href=\"http://localhost:8081\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:8081</a>.</p><exercise name='Exercise 1.07: External access with Ingress'><p>Ứng dụng \"Log output\" hiện tại ghi ra log một timestamp và một chuỗi ngẫu nhiên.</p><p>Thêm một endpoint để lấy trạng thái hiện tại (timestamp và chuỗi) và một ingress để có thể truy cập nó bằng trình duyệt.</p><p>Bạn chỉ cần lưu chuỗi và timestamp vào bộ nhớ.</p></exercise><exercise name='Exercise 1.08: Project v0.5'><p>Chuyển sang sử dụng Ingress thay vì NodePort để truy cập project. Bạn có thể xóa ingress của ứng dụng \"Log output\" để tránh gây nhiễu cho bài tập này. Chúng ta sẽ tìm hiểu thêm về đường dẫn và định tuyến ở bài tiếp theo và khi đó bạn có thể cấu hình project chạy song song với ứng dụng \"Log output\".</p></exercise><exercise name='Exercise 1.09: More services'><p>Phát triển một ứng dụng thứ hai chỉ đơn giản trả về \"pong 0\" cho một yêu cầu GET và tăng bộ đếm (số 0) để bạn có thể thấy đã gửi bao nhiêu yêu cầu. Bộ đếm nên lưu trong bộ nhớ nên có thể bị reset bất cứ lúc nào.\nTạo một deployment mới cho nó và cho nó dùng chung ingress với ứng dụng \"Log output\". Định tuyến các yêu cầu gửi đến '/pingpong' cho ứng dụng này.</p><p>Trong các bài tập sau, ứng dụng thứ hai này sẽ được gọi là \"ứng dụng ping-pong\". Nó sẽ được sử dụng cùng với ứng dụng \"Log output\".</p><p>Ứng dụng ping-pong sẽ cần lắng nghe các yêu cầu tại '/pingpong', vì vậy bạn có thể phải thay đổi mã nguồn của nó. Điều này có thể tránh được bằng cách cấu hình ingress để viết lại đường dẫn, nhưng chúng ta sẽ để đó như một bài tập tùy chọn. Bạn có thể tham khảo <a href=\"https://kubernetes.io/docs/concepts/services-networking/ingress/#the-ingress-resource\" target=\"_blank\" rel=\"noopener noreferrer\">https://kubernetes.io/docs/concepts/services-networking/ingress/#the-ingress-resource</a></p></exercise></div>","frontmatter":{"path":"/part-1/3-introduction-to-networking-vi","title":"Giới thiệu về Mạng"},"fileAbsolutePath":"/home/runner/work/dwk2024/dwk2024/data/part-1/3-introduction-to-networking-vi.md"},"allPages":{"edges":[{"node":{"id":"7e706a38-3828-5118-bdec-3705a319a1b0","frontmatter":{"path":"/faq-vi","title":"Câu hỏi thường gặp"}}},{"node":{"id":"e1ed6713-5992-5f7f-95a1-17efd97f57d8","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"3102d88f-7297-56fb-af03-27d1079fffd1","frontmatter":{"path":"/","title":"Homepage"}}},{"node":{"id":"5225f2a2-20f9-50ce-93ac-7b38f3105103","frontmatter":{"path":"/faq","title":"FAQ"}}},{"node":{"id":"04c5ddbd-7839-580f-82da-bc9fdbb49f84","frontmatter":{"path":"/known-problems-solutions","title":"Các vấn đề bạn có thể gặp phải"}}},{"node":{"id":"c92ea568-3384-5ff8-8dfa-b9015597780d","frontmatter":{"path":"/known-problems-solutions","title":"Issues you may face"}}},{"node":{"id":"5e6b6ee0-b381-53f0-b84c-af378792b131","frontmatter":{"path":"/registration-and-completion","title":"Registration and Completion"}}},{"node":{"id":"58688080-4aa8-54e6-8b8b-02de1c4f6410","frontmatter":{"path":"/unity-assignment","title":"Unity Assignment"}}},{"node":{"id":"8a3ee5be-7557-5fcd-954b-2351e74cd585","frontmatter":{"path":"/part-0/1-intro-vi","title":"Giới thiệu khóa học"}}},{"node":{"id":"d9c993b6-f6b4-59a1-b119-f3b7218eec6b","frontmatter":{"path":"/sanasto","title":"Sanasto"}}},{"node":{"id":"23082016-7bbd-5215-8485-4ffccbf3ea1a","frontmatter":{"path":"/part-0/1-intro","title":"Course Introduction"}}},{"node":{"id":"771eaa93-2ef2-5e0f-9e1e-55914c67c4ac","frontmatter":{"path":"/part-0","title":"Part 0"}}},{"node":{"id":"fe0342aa-a4c5-5b44-8591-71eb27f1a287","frontmatter":{"path":"/part-1/2-introduction-to-debugging-vi","title":"Giới thiệu về Debugging"}}},{"node":{"id":"1c236933-7ad5-5b61-8c07-07db3822d55a","frontmatter":{"path":"/part-1/2-introduction-to-debugging","title":"Introduction to Debugging"}}},{"node":{"id":"7fc5c062-6b94-53ec-9aaa-adca66ce672e","frontmatter":{"path":"/part-1/5-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"8ed3365b-b788-5806-8ec5-bec3cb0f94c8","frontmatter":{"path":"/part-1","title":"Part 1"}}},{"node":{"id":"3c788edf-62db-5e86-9366-17b53eda9244","frontmatter":{"path":"/part-1/5-summary","title":"Summary"}}},{"node":{"id":"fd467661-6b24-545f-904c-52f4a7ade6b7","frontmatter":{"path":"/part-2/1-networking-between-pods","title":"Networking between pods"}}},{"node":{"id":"46a4a0e4-d131-537d-aa72-5b6726163a7d","frontmatter":{"path":"/part-2/1-networking-between-pods-vi","title":"Kết nối mạng giữa các pod"}}},{"node":{"id":"79f1cddb-6995-51c2-bf98-2adc13de9b13","frontmatter":{"path":"/part-2/6-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"56110eda-875d-5bd9-a400-5bd5a009df7f","frontmatter":{"path":"/part-2/5-monitoring-vi","title":"Giám sát"}}},{"node":{"id":"8f3387b0-ec6e-5a86-982a-e52780d911f9","frontmatter":{"path":"/part-2/5-monitoring","title":"Monitoring"}}},{"node":{"id":"8c3d747d-4f87-5a46-99ac-dfd0af5a893b","frontmatter":{"path":"/part-2","title":"Part 2"}}},{"node":{"id":"06173ac4-c2f8-57df-8dc8-450b5c2bb695","frontmatter":{"path":"/part-2/6-summary","title":"Summary"}}},{"node":{"id":"8d9fd774-9dbe-5cca-8395-9226fcf82c4a","frontmatter":{"path":"/part-3/4-summary","title":"Tóm tắt"}}},{"node":{"id":"29bec4f5-8a0b-580d-ac84-9dbbd1d7152e","frontmatter":{"path":"/part-3","title":"Part 3"}}},{"node":{"id":"b98b2895-6c9d-5234-939d-2f547cbf8a06","frontmatter":{"path":"/part-3/4-summary","title":"Summary"}}},{"node":{"id":"0045695d-e541-5acc-b4b8-551023d01733","frontmatter":{"path":"/part-4/4-summary","title":"Summary"}}},{"node":{"id":"4dd8302d-d170-5d38-8198-4d0947322bbc","frontmatter":{"path":"/part-4/4-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"a917b24d-df2b-5199-ac98-cd0f7560c63f","frontmatter":{"path":"/part-4","title":"Part 4"}}},{"node":{"id":"eb339401-26c8-594c-98fd-2f30a95275cd","frontmatter":{"path":"/part-5/4-beyond-kubernetes-vi","title":"Vượt ra ngoài Kubernetes"}}},{"node":{"id":"2318c18f-86e6-5a4e-958a-d1c38f8615cd","frontmatter":{"path":"/part-5/4-beyond-kubernetes","title":"Beyond Kubernetes"}}},{"node":{"id":"781bd207-902e-59a2-a752-4958c2c93fb0","frontmatter":{"path":"/part-5/5-summary-vi","title":"Tóm tắt và kết thúc"}}},{"node":{"id":"1d8ff75c-065b-565d-9ceb-01b9a276ae7a","frontmatter":{"path":"/part-5/5-summary","title":"Summary and end"}}},{"node":{"id":"829fd216-f995-5a77-b201-bb971aec73b4","frontmatter":{"path":"/part-0/2-kubernetes-in-three-diagrams-vi","title":"Kubernetes qua ba sơ đồ"}}},{"node":{"id":"98132cca-4dc3-5942-a6f4-1da87bc81a23","frontmatter":{"path":"/part-0/2-kubernetes-in-three-diagrams","title":"Kubernetes in three diagrams"}}},{"node":{"id":"8931bcb7-c40e-5d57-aa80-c4333972fbb8","frontmatter":{"path":"/part-1/3-introduction-to-networking-vi","title":"Giới thiệu về Mạng"}}},{"node":{"id":"90b8e83a-9d55-550a-908a-316708ce7f8c","frontmatter":{"path":"/part-1/3-introduction-to-networking","title":"Introduction to Networking"}}},{"node":{"id":"4fe00c0a-bb17-5d4c-8202-750493a755c9","frontmatter":{"path":"/part-1/4-introduction-to-storage-vi","title":"Giới thiệu về Lưu trữ"}}},{"node":{"id":"6cc3be66-6091-58fc-bcbd-1f27f9473f85","frontmatter":{"path":"/part-1/4-introduction-to-storage","title":"Introduction to Storage"}}},{"node":{"id":"d5206d16-d2fe-51fd-8acd-d85ecf0be257","frontmatter":{"path":"/part-2/2-organizing-a-cluster","title":"Organizing a cluster"}}},{"node":{"id":"b53df746-c24f-57e3-a9f3-d6d621697689","frontmatter":{"path":"/part-2/2-organizing-a-cluster-vi","title":"Tổ chức một cụm"}}},{"node":{"id":"15be3d7c-b0b7-5bce-b3bf-8cec39d54630","frontmatter":{"path":"/part-2/3-configuring-applications-vi","title":"Cấu hình ứng dụng"}}},{"node":{"id":"e4534a9d-fb84-5d1f-83f0-35055feb0da7","frontmatter":{"path":"/part-2/3-configuring-applications","title":"Configuring applications"}}},{"node":{"id":"02389078-a12f-561a-8a54-fa99a6950b92","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs-vi","title":"StatefulSet và Job"}}},{"node":{"id":"466aa711-527b-55a0-871b-13468e65d344","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs","title":"StatefulSets and Jobs"}}},{"node":{"id":"bea18f34-dcdc-59b8-ba24-3011680a0c58","frontmatter":{"path":"/part-3/1-introduction-to-gke-vi","title":"Giới thiệu về Google Kubernetes Engine"}}},{"node":{"id":"0049e57f-0bc7-5689-9169-43848a972877","frontmatter":{"path":"/part-3/2-deployment-pipeline-vi","title":"Quy trình Triển khai (Deployment Pipeline)"}}},{"node":{"id":"61f18dc7-1abf-5c75-9b54-0cee11c76a40","frontmatter":{"path":"/part-3/2-deployment-pipeline","title":"Deployment Pipeline"}}},{"node":{"id":"84db9628-b3df-5ca1-9d3d-5924e02ae549","frontmatter":{"path":"/part-3/1-introduction-to-gke","title":"Introduction to Google Kubernetes Engine"}}},{"node":{"id":"7dfec8c7-8ccb-50da-949d-ebd1de395dc4","frontmatter":{"path":"/part-3/3-gke-features-vi","title":"Các tính năng của GKE"}}},{"node":{"id":"423cbc46-2dfa-57e6-9dc5-761a93729600","frontmatter":{"path":"/part-3/3-gke-features","title":"GKE features"}}},{"node":{"id":"6df9c7be-f930-5827-a39c-0c1698b23600","frontmatter":{"path":"/part-4/3-gitops","title":"GitOps"}}},{"node":{"id":"46f9ce68-5ccd-5787-bd59-03852ad6fdcb","frontmatter":{"path":"/part-4/3-gitops","title":"GitOps"}}},{"node":{"id":"0e981ec1-99e0-5005-ba9f-4f626a81b7ce","frontmatter":{"path":"/part-5/1-kubernetes-internals-vi","title":"Bên trong Kubernetes"}}},{"node":{"id":"31927db3-2182-55c7-b680-663754461d14","frontmatter":{"path":"/part-5/1-kubernetes-internals","title":"Kubernetes Internals"}}},{"node":{"id":"ccefb04a-5790-57f6-869b-d255b2203667","frontmatter":{"path":"/part-5/2-custom-resource-definitions","title":"Custom Resource Definitions"}}},{"node":{"id":"da1f8069-17bc-5c8e-9310-117bcedf5acf","frontmatter":{"path":"/part-5/2-custom-resource-definitions-vi","title":"Định nghĩa Tài nguyên Tùy chỉnh (Custom Resource Definitions)"}}},{"node":{"id":"68c64f9f-c9a5-544b-bafb-b061665cacd0","frontmatter":{"path":"/part-5/3-service-mesh-vi","title":"Service Mesh"}}},{"node":{"id":"20ceed4e-761d-54d4-9acf-2669eac533c6","frontmatter":{"path":"/part-5/3-service-mesh","title":"Service Mesh"}}},{"node":{"id":"306c87f3-9adb-5d8b-a3ce-072f8e6cfa43","frontmatter":{"path":"/part-5","title":"Part 5"}}},{"node":{"id":"97ead58a-8493-5fdd-808e-d4a56de573b0","frontmatter":{"path":"/part-1/1-first-deploy","title":"First Deploy"}}},{"node":{"id":"6f4f18ce-5aa9-5bb5-9d74-0a631a78e6b3","frontmatter":{"path":"/part-4/2-messaging-systems","title":"Hệ thống nhắn tin"}}},{"node":{"id":"c179c521-bb62-52bd-808b-d4869df5302a","frontmatter":{"path":"/part-4/1-update-strategies-and-prometheus","title":"Chiến lược cập nhật và Prometheus"}}},{"node":{"id":"898b0354-f1a2-5664-97de-d84b16018395","frontmatter":{"path":"/part-4/1-update-strategies-and-prometheus","title":"Update Strategies and Prometheus"}}},{"node":{"id":"6981a9d7-619d-51a9-9490-74bc77c0f55b","frontmatter":{"path":"/part-4/2-messaging-systems","title":"Messaging Systems"}}},{"node":{"id":"a17c4c44-7396-543f-b6b4-7adf57808aa8","frontmatter":{"path":"/part-1/1-first-deploy-vi","title":"Triển khai đầu tiên"}}}]}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}