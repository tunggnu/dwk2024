{"componentChunkName":"component---src-templates-course-content-template-js","path":"/part-5/1-kubernetes-internals","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"Learning Objectives"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After this section you"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"can explain in broad terms how Kubernetes operates"}]},{"type":"text","value":"\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Instead of thinking about Kubernetes as something completely new I've found that comparing it to an operating system helps. I'm not an expert in operating systems but we've all used them."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kubernetes is a layer on top of which we run our applications. It takes the resources that are accessible from the layers below and manages our applications and resources. It also provides services, such as the DNS, for the applications. With this OS mindset, we can also try to go the other way: You may have used a "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Cron","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"cron"}]},{"type":"text","value":" (or Windows' "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Windows_Task_Scheduler","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"task scheduler"}]},{"type":"text","value":") for scheduling batch jobs such as saving backups of some applications. The same thing in Kubernetes can be done with "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"CronJobs"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now that we'll start talking about the internals we'll learn new insight on Kubernetes and will be able to prevent and solve problems that may result from its nature."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Since this section is mostly a reiteration of Kubernetes documentation, I will include various links to the official version of the documentation. Despite talking about internals, we shall not discuss how to set up our own Kubernetes cluster manually. If you want to get your hands dirty with a setup, you should read and complete "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/kelseyhightower/kubernetes-the-hard-way","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Kubernetes the Hard Way"}]},{"type":"text","value":" by Kelsey Hightower."}]},{"type":"element","tagName":"h3","properties":{"id":"controllers","style":"position:relative;"},"children":[{"type":"text","value":"Controllers"},{"type":"element","tagName":"a","properties":{"href":"#controllers","ariaLabel":"controllers permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/architecture/controller/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Controllers"}]},{"type":"text","value":" watch the state of your cluster and then try to move the current state of the cluster closer to the desired state. When you declare X replicas of a Pod in your deployment.yaml, a controller called "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/controllers/replicationcontroller/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Replication Controller"}]},{"type":"text","value":" makes sure that will be true. There are a number of controllers for different responsibilities."}]},{"type":"element","tagName":"h3","properties":{"id":"kubernetes-control-plane","style":"position:relative;"},"children":[{"type":"text","value":"Kubernetes Control Plane"},{"type":"element","tagName":"a","properties":{"href":"#kubernetes-control-plane","ariaLabel":"kubernetes control plane permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/overview/components/#control-plane-components","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Kubernetes Control Plane"}]},{"type":"text","value":"\nis responsible for managing the Kubernetes cluster. It is the primary orchestrating component that ensures the cluster's desired state matches its actual state. The control plane makes global decisions about the cluster (such as scheduling), as well as detecting and responding to cluster events (such as starting up a new pod when a replica's field of a deployment is unsatisfied)."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The control plane consists of"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"etcd"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"A key-value storage that Kubernetes uses to save all cluster data."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"kube-scheduler"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Decides on which node a Pod should be run on."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"kube-controller-manager"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Is responsible for and runs all of the controllers."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"kube-apiserver"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"This exposes the Kubernetes Control Plane through an API"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There's also cloud-controller-manager that lets you link your cluster into a cloud provider's API. If you wanted to build your own cluster on "},{"type":"element","tagName":"a","properties":{"href":"https://www.hetzner.com/cloud","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Hetzner"}]},{"type":"text","value":", for example, you could use "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/hetznercloud/hcloud-cloud-controller-manager","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"hcloud-cloud-controller-manager"}]},{"type":"text","value":" in your own cluster installed on their VMs."}]},{"type":"element","tagName":"h3","properties":{"id":"node-components","style":"position:relative;"},"children":[{"type":"text","value":"Node Components"},{"type":"element","tagName":"a","properties":{"href":"#node-components","ariaLabel":"node components permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Every node has a number of "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/overview/components/#node-components","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"components"}]},{"type":"text","value":" that maintain the running pods."}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"kubelet"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Makes sure containers are running in a Pod"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"kube-proxy"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"network proxy and maintains the network rules. Enables connections outside and inside of the cluster as well as Services to work as we've been using them."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Each node has also the "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/setup/production-environment/container-runtimes/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Container Runtime"}]},{"type":"text","value":". We have been using Docker as the runtime for this course."}]},{"type":"element","tagName":"img","properties":{"src":"/51120ad23b216a6946e3c4ebef2106bf/kube-diag.svg"},"children":[]},{"type":"element","tagName":"h3","properties":{"id":"addons","style":"position:relative;"},"children":[{"type":"text","value":"Addons"},{"type":"element","tagName":"a","properties":{"href":"#addons","ariaLabel":"addons permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In addition to all of the previously mentioned, Kubernetes has "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/cluster-administration/addons/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Addons"}]},{"type":"text","value":" that use the same Kubernetes resources we've been using and extend Kubernetes. You can view which resources the addons have created in the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kube-system"}]},{"type":"text","value":" namespace."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"shell"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-shell"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"$ kubectl -n kube-system get all\n  NAME                                                            READY   STATUS    RESTARTS   AGE\n  pod/event-exporter-v0.2.5-599d65f456-vh4st                      "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":"/2     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          5h42m\n  pod/fluentd-gcp-scaler-bfd6cf8dd-kmk2x                          "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          5h42m\n  pod/fluentd-gcp-v3.1.1-9sl8g                                    "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":"/2     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          5h41m\n  pod/fluentd-gcp-v3.1.1-9wpqh                                    "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":"/2     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          5h41m\n  pod/fluentd-gcp-v3.1.1-fr48m                                    "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":"/2     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          5h41m\n  pod/heapster-gke-9588c9855-pc4wr                                "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3"}]},{"type":"text","value":"/3     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          5h41m\n  pod/kube-dns-5995c95f64-m7k4j                                   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"4"}]},{"type":"text","value":"/4     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          5h41m\n  pod/kube-dns-5995c95f64-rrjpx                                   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"4"}]},{"type":"text","value":"/4     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          5h42m\n  pod/kube-dns-autoscaler-8687c64fc-xv6p6                         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          5h41m\n  pod/kube-proxy-gke-dwk-cluster-default-pool-700eba89-j735       "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          5h41m\n  pod/kube-proxy-gke-dwk-cluster-default-pool-700eba89-mlht       "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          5h41m\n  pod/kube-proxy-gke-dwk-cluster-default-pool-700eba89-xss7       "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          5h41m\n  pod/l7-default-backend-8f479dd9-jbv9l                           "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          5h42m\n  pod/metrics-server-v0.3.1-5c6fbf777-lz2zh                       "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":"/2     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          5h41m\n  pod/prometheus-to-sd-jw9rs                                      "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":"/2     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          5h41m\n  pod/prometheus-to-sd-qkxvd                                      "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":"/2     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          5h41m\n  pod/prometheus-to-sd-z4ssv                                      "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":"/2     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          5h41m\n  pod/stackdriver-metadata-agent-cluster-level-5d8cd7b6bf-rfd8d   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":"/2     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          5h41m\n\n  NAME                           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"S"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"         AGE\n  service/default-http-backend   NodePort    "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.31"}]},{"type":"text","value":".251.116   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"none"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"        "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]},{"type":"text","value":":31581/TCP    5h42m\n  service/heapster               ClusterIP   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.31"}]},{"type":"text","value":".247.145   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"none"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"        "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]},{"type":"text","value":"/TCP          5h42m\n  service/kube-dns               ClusterIP   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.31"}]},{"type":"text","value":".240.10    "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"none"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"        "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"53"}]},{"type":"text","value":"/UDP,53/TCP   5h42m\n  service/metrics-server         ClusterIP   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.31"}]},{"type":"text","value":".249.74    "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"none"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"        "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"443"}]},{"type":"text","value":"/TCP         5h42m\n\n  NAME                                      DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR                                                              AGE\n  daemonset.apps/fluentd-gcp-v3.1.1         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3"}]},{"type":"text","value":"       "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3"}]},{"type":"text","value":"            "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3"}]},{"type":"text","value":"           beta.kubernetes.io/fluentd-ds-ready"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"true,beta.kubernetes.io/os"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"linux       5h42m\n  daemonset.apps/metadata-proxy-v0.1        "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"       "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"            "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"           beta.kubernetes.io/metadata-proxy-ready"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"true,beta.kubernetes.io/os"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"linux   5h42m\n  daemonset.apps/nvidia-gpu-device-plugin   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"       "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"            "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"           "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"none"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"                                                                     5h42m\n  daemonset.apps/prometheus-to-sd           "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3"}]},{"type":"text","value":"       "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3"}]},{"type":"text","value":"            "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3"}]},{"type":"text","value":"           beta.kubernetes.io/os"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"linux                                                5h42m\n\n  NAME                                                       READY   UP-TO-DATE   AVAILABLE   AGE\n  deployment.apps/event-exporter-v0.2.5                      "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"            "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"           5h42m\n  deployment.apps/fluentd-gcp-scaler                         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"            "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"           5h42m\n  deployment.apps/heapster-gke                               "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"            "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"           5h42m\n  deployment.apps/kube-dns                                   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":"/2     "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":"            "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":"           5h42m\n  deployment.apps/kube-dns-autoscaler                        "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"            "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"           5h42m\n  deployment.apps/l7-default-backend                         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"            "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"           5h42m\n  deployment.apps/metrics-server-v0.3.1                      "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"            "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"           5h42m\n  deployment.apps/stackdriver-metadata-agent-cluster-level   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"            "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"           5h42m\n\n  NAME                                                                  DESIRED   CURRENT   READY   AGE\n  replicaset.apps/event-exporter-v0.2.5-599d65f456                      "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"       5h42m\n  replicaset.apps/fluentd-gcp-scaler-bfd6cf8dd                          "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"       5h42m\n  replicaset.apps/heapster-gke-58bf4cb5f5                               "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"       5h42m\n  replicaset.apps/heapster-gke-9588c9855                                "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"       5h41m\n  replicaset.apps/kube-dns-5995c95f64                                   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":"       5h42m\n  replicaset.apps/kube-dns-autoscaler-8687c64fc                         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"       5h42m\n  replicaset.apps/l7-default-backend-8f479dd9                           "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"       5h42m\n  replicaset.apps/metrics-server-v0.3.1-5c6fbf777                       "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"       5h41m\n  replicaset.apps/metrics-server-v0.3.1-8559697b9c                      "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"       5h42m\n  replicaset.apps/stackdriver-metadata-agent-cluster-level-5d8cd7b6bf   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"       5h41m\n  replicaset.apps/stackdriver-metadata-agent-cluster-level-7bd5ddd849   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"       5h42m"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To get a complete picture of how each part communicates with each other, read the article "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/jamiehannaford/what-happens-when-k8s","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"what happens when k8s"}]},{"type":"text","value":" which explores what happens when you do "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl run nginx --image=nginx --replicas=3"}]},{"type":"text","value":" shedding some more light on the magic that happens behind the scenes."}]},{"type":"element","tagName":"h2","properties":{"id":"self-healing","style":"position:relative;"},"children":[{"type":"text","value":"Self-healing"},{"type":"element","tagName":"a","properties":{"href":"#self-healing","ariaLabel":"self healing permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Back in "},{"type":"element","tagName":"a","properties":{"href":"/part-1"},"children":[{"type":"text","value":"part 1"}]},{"type":"text","value":", we talked a little about the \"self-healing\" nature of Kubernetes and how pods can be deleted and they're automatically recreated."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's see what happens if we delete a node that has a pod in it. Let's first deploy the pod, a web application with ingress from part 1, confirm that it's running and then see which pod has it running."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"shell"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-shell"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"$ kubectl apply -f https://raw.githubusercontent.com/kubernetes-hy/material-example/master/app2/manifests/deployment.yaml "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"\\"}]},{"type":"text","value":"\n                -f https://raw.githubusercontent.com/kubernetes-hy/material-example/master/app2/manifests/ingress.yaml "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"\\"}]},{"type":"text","value":"\n                -f https://raw.githubusercontent.com/kubernetes-hy/material-example/master/app2/manifests/service.yaml\n  deployment.apps/hashresponse-dep created\n  ingress.extensions/dwk-material-ingress created\n  service/hashresponse-svc created\n\n$ "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"curl"}]},{"type":"text","value":" localhost:8081\n9eaxf3: 8k2deb\n\n$ kubectl describe po hashresponse-dep-57bcc888d7-5gkc9 "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"grep"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'Node:'"}]},{"type":"text","value":"\n  Node:         k3d-k3s-default-agent-1/172.30.0.2"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In this case it's in agent-1. Let's make the node go \"offline\" with pause:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"shell"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-shell"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"$ docker "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ps"}]},{"type":"text","value":"\n  CONTAINER ID        IMAGE                      COMMAND                  CREATED             STATUS              PORTS                                           NAMES\n  5c43fe0a936e        rancher/k3d-proxy:v3.0.0   "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"/bin/sh -c nginx-pr…\""}]},{"type":"text","value":"   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10"}]},{"type":"text","value":" days ago         Up "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":" hours          "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0.0"}]},{"type":"text","value":".0.0:8081-"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]},{"type":"text","value":"/tcp, "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0.0"}]},{"type":"text","value":".0.0:50207-"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"6443"}]},{"type":"text","value":"/tcp   k3d-k3s-default-serverlb\n  fea775395132        rancher/k3s:latest         "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"/bin/k3s agent\""}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10"}]},{"type":"text","value":" days ago         Up "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":" hours                                                          k3d-k3s-default-agent-1\n  70b68b040360        rancher/k3s:latest         "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"/bin/k3s agent\""}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10"}]},{"type":"text","value":" days ago         Up "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":" hours          "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0.0"}]},{"type":"text","value":".0.0:8082-"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"30080"}]},{"type":"text","value":"/tcp                         k3d-k3s-default-agent-0\n  28cc6cef76ee        rancher/k3s:latest         "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"/bin/k3s server --t…\""}]},{"type":"text","value":"   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10"}]},{"type":"text","value":" days ago         Up "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":" hours                                                          k3d-k3s-default-server-0\n\n$ docker pause k3d-k3s-default-agent-1\nk3d-k3s-default-agent-1"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now wait for a while and this should be the new state:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"shell"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-shell"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"$ kubectl get po\nNAME                                READY   STATUS        RESTARTS   AGE\nhashresponse-dep-57bcc888d7-5gkc9   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     Terminating   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          15m\nhashresponse-dep-57bcc888d7-4klvg   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     Running       "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          30s\n\n$ "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"curl"}]},{"type":"text","value":" localhost:8081\n6xluh2: ta0ztp"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"What did just happen? Read "},{"type":"element","tagName":"a","properties":{"href":"https://dev.to/duske/how-kubernetes-handles-offline-nodes-53b5","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"this explanation on how kubernetes handles offline nodes"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Well then, what happens if you delete the only control-plane node? Nothing good. In our local cluster it's our single point of failure. See Kubernetes documentation for \""},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/ha-topology/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Options for Highly Available topology"}]},{"type":"text","value":"\" to avoid getting the whole cluster crippled by a single faulty hardware."}]}]},"html":"<div><text-box variant='learningObjectives' name='Learning Objectives'><p>After this section you</p><ul>\n<li>can explain in broad terms how Kubernetes operates</li>\n</ul></text-box><p>Instead of thinking about Kubernetes as something completely new I've found that comparing it to an operating system helps. I'm not an expert in operating systems but we've all used them.</p><p>Kubernetes is a layer on top of which we run our applications. It takes the resources that are accessible from the layers below and manages our applications and resources. It also provides services, such as the DNS, for the applications. With this OS mindset, we can also try to go the other way: You may have used a <a href=\"https://en.wikipedia.org/wiki/Cron\" target=\"_blank\" rel=\"noopener noreferrer\">cron</a> (or Windows' <a href=\"https://en.wikipedia.org/wiki/Windows_Task_Scheduler\" target=\"_blank\" rel=\"noopener noreferrer\">task scheduler</a>) for scheduling batch jobs such as saving backups of some applications. The same thing in Kubernetes can be done with <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/\" target=\"_blank\" rel=\"noopener noreferrer\">CronJobs</a>.</p><p>Now that we'll start talking about the internals we'll learn new insight on Kubernetes and will be able to prevent and solve problems that may result from its nature.</p><p>Since this section is mostly a reiteration of Kubernetes documentation, I will include various links to the official version of the documentation. Despite talking about internals, we shall not discuss how to set up our own Kubernetes cluster manually. If you want to get your hands dirty with a setup, you should read and complete <a href=\"https://github.com/kelseyhightower/kubernetes-the-hard-way\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes the Hard Way</a> by Kelsey Hightower.</p><h3 id=\"controllers\" style=\"position:relative;\">Controllers<a href=\"#controllers\" aria-label=\"controllers permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p><a href=\"https://kubernetes.io/docs/concepts/architecture/controller/\" target=\"_blank\" rel=\"noopener noreferrer\">Controllers</a> watch the state of your cluster and then try to move the current state of the cluster closer to the desired state. When you declare X replicas of a Pod in your deployment.yaml, a controller called <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/replicationcontroller/\" target=\"_blank\" rel=\"noopener noreferrer\">Replication Controller</a> makes sure that will be true. There are a number of controllers for different responsibilities.</p><h3 id=\"kubernetes-control-plane\" style=\"position:relative;\">Kubernetes Control Plane<a href=\"#kubernetes-control-plane\" aria-label=\"kubernetes control plane permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p><a href=\"https://kubernetes.io/docs/concepts/overview/components/#control-plane-components\" target=\"_blank\" rel=\"noopener noreferrer\">Kubernetes Control Plane</a>\nis responsible for managing the Kubernetes cluster. It is the primary orchestrating component that ensures the cluster's desired state matches its actual state. The control plane makes global decisions about the cluster (such as scheduling), as well as detecting and responding to cluster events (such as starting up a new pod when a replica's field of a deployment is unsatisfied).</p><p>The control plane consists of</p><ul>\n<li>\n<p>etcd</p>\n<ul>\n<li>A key-value storage that Kubernetes uses to save all cluster data.</li>\n</ul>\n</li>\n<li>\n<p>kube-scheduler</p>\n<ul>\n<li>Decides on which node a Pod should be run on.</li>\n</ul>\n</li>\n<li>\n<p>kube-controller-manager</p>\n<ul>\n<li>Is responsible for and runs all of the controllers.</li>\n</ul>\n</li>\n<li>\n<p>kube-apiserver</p>\n<ul>\n<li>This exposes the Kubernetes Control Plane through an API</li>\n</ul>\n</li>\n</ul><p>There's also cloud-controller-manager that lets you link your cluster into a cloud provider's API. If you wanted to build your own cluster on <a href=\"https://www.hetzner.com/cloud\" target=\"_blank\" rel=\"noopener noreferrer\">Hetzner</a>, for example, you could use <a href=\"https://github.com/hetznercloud/hcloud-cloud-controller-manager\" target=\"_blank\" rel=\"noopener noreferrer\">hcloud-cloud-controller-manager</a> in your own cluster installed on their VMs.</p><h3 id=\"node-components\" style=\"position:relative;\">Node Components<a href=\"#node-components\" aria-label=\"node components permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p>Every node has a number of <a href=\"https://kubernetes.io/docs/concepts/overview/components/#node-components\" target=\"_blank\" rel=\"noopener noreferrer\">components</a> that maintain the running pods.</p><ul>\n<li>\n<p>kubelet</p>\n<ul>\n<li>Makes sure containers are running in a Pod</li>\n</ul>\n</li>\n<li>\n<p>kube-proxy</p>\n<ul>\n<li>network proxy and maintains the network rules. Enables connections outside and inside of the cluster as well as Services to work as we've been using them.</li>\n</ul>\n</li>\n</ul><p>Each node has also the <a href=\"https://kubernetes.io/docs/setup/production-environment/container-runtimes/\" target=\"_blank\" rel=\"noopener noreferrer\">Container Runtime</a>. We have been using Docker as the runtime for this course.</p><img src=\"/51120ad23b216a6946e3c4ebef2106bf/kube-diag.svg\"><h3 id=\"addons\" style=\"position:relative;\">Addons<a href=\"#addons\" aria-label=\"addons permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p>In addition to all of the previously mentioned, Kubernetes has <a href=\"https://kubernetes.io/docs/concepts/cluster-administration/addons/\" target=\"_blank\" rel=\"noopener noreferrer\">Addons</a> that use the same Kubernetes resources we've been using and extend Kubernetes. You can view which resources the addons have created in the <code class=\"language-text\">kube-system</code> namespace.</p><div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl -n kube-system get all\n  NAME                                                            READY   STATUS    RESTARTS   AGE\n  pod/event-exporter-v0.2.5-599d65f456-vh4st                      <span class=\"token number\">2</span>/2     Running   <span class=\"token number\">0</span>          5h42m\n  pod/fluentd-gcp-scaler-bfd6cf8dd-kmk2x                          <span class=\"token number\">1</span>/1     Running   <span class=\"token number\">0</span>          5h42m\n  pod/fluentd-gcp-v3.1.1-9sl8g                                    <span class=\"token number\">2</span>/2     Running   <span class=\"token number\">0</span>          5h41m\n  pod/fluentd-gcp-v3.1.1-9wpqh                                    <span class=\"token number\">2</span>/2     Running   <span class=\"token number\">0</span>          5h41m\n  pod/fluentd-gcp-v3.1.1-fr48m                                    <span class=\"token number\">2</span>/2     Running   <span class=\"token number\">0</span>          5h41m\n  pod/heapster-gke-9588c9855-pc4wr                                <span class=\"token number\">3</span>/3     Running   <span class=\"token number\">0</span>          5h41m\n  pod/kube-dns-5995c95f64-m7k4j                                   <span class=\"token number\">4</span>/4     Running   <span class=\"token number\">0</span>          5h41m\n  pod/kube-dns-5995c95f64-rrjpx                                   <span class=\"token number\">4</span>/4     Running   <span class=\"token number\">0</span>          5h42m\n  pod/kube-dns-autoscaler-8687c64fc-xv6p6                         <span class=\"token number\">1</span>/1     Running   <span class=\"token number\">0</span>          5h41m\n  pod/kube-proxy-gke-dwk-cluster-default-pool-700eba89-j735       <span class=\"token number\">1</span>/1     Running   <span class=\"token number\">0</span>          5h41m\n  pod/kube-proxy-gke-dwk-cluster-default-pool-700eba89-mlht       <span class=\"token number\">1</span>/1     Running   <span class=\"token number\">0</span>          5h41m\n  pod/kube-proxy-gke-dwk-cluster-default-pool-700eba89-xss7       <span class=\"token number\">1</span>/1     Running   <span class=\"token number\">0</span>          5h41m\n  pod/l7-default-backend-8f479dd9-jbv9l                           <span class=\"token number\">1</span>/1     Running   <span class=\"token number\">0</span>          5h42m\n  pod/metrics-server-v0.3.1-5c6fbf777-lz2zh                       <span class=\"token number\">2</span>/2     Running   <span class=\"token number\">0</span>          5h41m\n  pod/prometheus-to-sd-jw9rs                                      <span class=\"token number\">2</span>/2     Running   <span class=\"token number\">0</span>          5h41m\n  pod/prometheus-to-sd-qkxvd                                      <span class=\"token number\">2</span>/2     Running   <span class=\"token number\">0</span>          5h41m\n  pod/prometheus-to-sd-z4ssv                                      <span class=\"token number\">2</span>/2     Running   <span class=\"token number\">0</span>          5h41m\n  pod/stackdriver-metadata-agent-cluster-level-5d8cd7b6bf-rfd8d   <span class=\"token number\">2</span>/2     Running   <span class=\"token number\">0</span>          5h41m\n\n  NAME                           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class=\"token punctuation\">(</span>S<span class=\"token punctuation\">)</span>         AGE\n  service/default-http-backend   NodePort    <span class=\"token number\">10.31</span>.251.116   <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>        <span class=\"token number\">80</span>:31581/TCP    5h42m\n  service/heapster               ClusterIP   <span class=\"token number\">10.31</span>.247.145   <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>        <span class=\"token number\">80</span>/TCP          5h42m\n  service/kube-dns               ClusterIP   <span class=\"token number\">10.31</span>.240.10    <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>        <span class=\"token number\">53</span>/UDP,53/TCP   5h42m\n  service/metrics-server         ClusterIP   <span class=\"token number\">10.31</span>.249.74    <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>        <span class=\"token number\">443</span>/TCP         5h42m\n\n  NAME                                      DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR                                                              AGE\n  daemonset.apps/fluentd-gcp-v3.1.1         <span class=\"token number\">3</span>         <span class=\"token number\">3</span>         <span class=\"token number\">3</span>       <span class=\"token number\">3</span>            <span class=\"token number\">3</span>           beta.kubernetes.io/fluentd-ds-ready<span class=\"token operator\">=</span>true,beta.kubernetes.io/os<span class=\"token operator\">=</span>linux       5h42m\n  daemonset.apps/metadata-proxy-v0.1        <span class=\"token number\">0</span>         <span class=\"token number\">0</span>         <span class=\"token number\">0</span>       <span class=\"token number\">0</span>            <span class=\"token number\">0</span>           beta.kubernetes.io/metadata-proxy-ready<span class=\"token operator\">=</span>true,beta.kubernetes.io/os<span class=\"token operator\">=</span>linux   5h42m\n  daemonset.apps/nvidia-gpu-device-plugin   <span class=\"token number\">0</span>         <span class=\"token number\">0</span>         <span class=\"token number\">0</span>       <span class=\"token number\">0</span>            <span class=\"token number\">0</span>           <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>                                                                     5h42m\n  daemonset.apps/prometheus-to-sd           <span class=\"token number\">3</span>         <span class=\"token number\">3</span>         <span class=\"token number\">3</span>       <span class=\"token number\">3</span>            <span class=\"token number\">3</span>           beta.kubernetes.io/os<span class=\"token operator\">=</span>linux                                                5h42m\n\n  NAME                                                       READY   UP-TO-DATE   AVAILABLE   AGE\n  deployment.apps/event-exporter-v0.2.5                      <span class=\"token number\">1</span>/1     <span class=\"token number\">1</span>            <span class=\"token number\">1</span>           5h42m\n  deployment.apps/fluentd-gcp-scaler                         <span class=\"token number\">1</span>/1     <span class=\"token number\">1</span>            <span class=\"token number\">1</span>           5h42m\n  deployment.apps/heapster-gke                               <span class=\"token number\">1</span>/1     <span class=\"token number\">1</span>            <span class=\"token number\">1</span>           5h42m\n  deployment.apps/kube-dns                                   <span class=\"token number\">2</span>/2     <span class=\"token number\">2</span>            <span class=\"token number\">2</span>           5h42m\n  deployment.apps/kube-dns-autoscaler                        <span class=\"token number\">1</span>/1     <span class=\"token number\">1</span>            <span class=\"token number\">1</span>           5h42m\n  deployment.apps/l7-default-backend                         <span class=\"token number\">1</span>/1     <span class=\"token number\">1</span>            <span class=\"token number\">1</span>           5h42m\n  deployment.apps/metrics-server-v0.3.1                      <span class=\"token number\">1</span>/1     <span class=\"token number\">1</span>            <span class=\"token number\">1</span>           5h42m\n  deployment.apps/stackdriver-metadata-agent-cluster-level   <span class=\"token number\">1</span>/1     <span class=\"token number\">1</span>            <span class=\"token number\">1</span>           5h42m\n\n  NAME                                                                  DESIRED   CURRENT   READY   AGE\n  replicaset.apps/event-exporter-v0.2.5-599d65f456                      <span class=\"token number\">1</span>         <span class=\"token number\">1</span>         <span class=\"token number\">1</span>       5h42m\n  replicaset.apps/fluentd-gcp-scaler-bfd6cf8dd                          <span class=\"token number\">1</span>         <span class=\"token number\">1</span>         <span class=\"token number\">1</span>       5h42m\n  replicaset.apps/heapster-gke-58bf4cb5f5                               <span class=\"token number\">0</span>         <span class=\"token number\">0</span>         <span class=\"token number\">0</span>       5h42m\n  replicaset.apps/heapster-gke-9588c9855                                <span class=\"token number\">1</span>         <span class=\"token number\">1</span>         <span class=\"token number\">1</span>       5h41m\n  replicaset.apps/kube-dns-5995c95f64                                   <span class=\"token number\">2</span>         <span class=\"token number\">2</span>         <span class=\"token number\">2</span>       5h42m\n  replicaset.apps/kube-dns-autoscaler-8687c64fc                         <span class=\"token number\">1</span>         <span class=\"token number\">1</span>         <span class=\"token number\">1</span>       5h42m\n  replicaset.apps/l7-default-backend-8f479dd9                           <span class=\"token number\">1</span>         <span class=\"token number\">1</span>         <span class=\"token number\">1</span>       5h42m\n  replicaset.apps/metrics-server-v0.3.1-5c6fbf777                       <span class=\"token number\">1</span>         <span class=\"token number\">1</span>         <span class=\"token number\">1</span>       5h41m\n  replicaset.apps/metrics-server-v0.3.1-8559697b9c                      <span class=\"token number\">0</span>         <span class=\"token number\">0</span>         <span class=\"token number\">0</span>       5h42m\n  replicaset.apps/stackdriver-metadata-agent-cluster-level-5d8cd7b6bf   <span class=\"token number\">1</span>         <span class=\"token number\">1</span>         <span class=\"token number\">1</span>       5h41m\n  replicaset.apps/stackdriver-metadata-agent-cluster-level-7bd5ddd849   <span class=\"token number\">0</span>         <span class=\"token number\">0</span>         <span class=\"token number\">0</span>       5h42m</code></pre></div><p>To get a complete picture of how each part communicates with each other, read the article <a href=\"https://github.com/jamiehannaford/what-happens-when-k8s\" target=\"_blank\" rel=\"noopener noreferrer\">what happens when k8s</a> which explores what happens when you do <code class=\"language-text\">kubectl run nginx --image=nginx --replicas=3</code> shedding some more light on the magic that happens behind the scenes.</p><h2 id=\"self-healing\" style=\"position:relative;\">Self-healing<a href=\"#self-healing\" aria-label=\"self healing permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2><p>Back in <a href=\"/part-1\">part 1</a>, we talked a little about the \"self-healing\" nature of Kubernetes and how pods can be deleted and they're automatically recreated.</p><p>Let's see what happens if we delete a node that has a pod in it. Let's first deploy the pod, a web application with ingress from part 1, confirm that it's running and then see which pod has it running.</p><div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl apply -f https://raw.githubusercontent.com/kubernetes-hy/material-example/master/app2/manifests/deployment.yaml <span class=\"token punctuation\">\\</span>\n                -f https://raw.githubusercontent.com/kubernetes-hy/material-example/master/app2/manifests/ingress.yaml <span class=\"token punctuation\">\\</span>\n                -f https://raw.githubusercontent.com/kubernetes-hy/material-example/master/app2/manifests/service.yaml\n  deployment.apps/hashresponse-dep created\n  ingress.extensions/dwk-material-ingress created\n  service/hashresponse-svc created\n\n$ <span class=\"token function\">curl</span> localhost:8081\n9eaxf3: 8k2deb\n\n$ kubectl describe po hashresponse-dep-57bcc888d7-5gkc9 <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token string\">'Node:'</span>\n  Node:         k3d-k3s-default-agent-1/172.30.0.2</code></pre></div><p>In this case it's in agent-1. Let's make the node go \"offline\" with pause:</p><div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ docker <span class=\"token function\">ps</span>\n  CONTAINER ID        IMAGE                      COMMAND                  CREATED             STATUS              PORTS                                           NAMES\n  5c43fe0a936e        rancher/k3d-proxy:v3.0.0   <span class=\"token string\">\"/bin/sh -c nginx-pr…\"</span>   <span class=\"token number\">10</span> days ago         Up <span class=\"token number\">2</span> hours          <span class=\"token number\">0.0</span>.0.0:8081-<span class=\"token operator\">></span><span class=\"token number\">80</span>/tcp, <span class=\"token number\">0.0</span>.0.0:50207-<span class=\"token operator\">></span><span class=\"token number\">6443</span>/tcp   k3d-k3s-default-serverlb\n  fea775395132        rancher/k3s:latest         <span class=\"token string\">\"/bin/k3s agent\"</span>         <span class=\"token number\">10</span> days ago         Up <span class=\"token number\">2</span> hours                                                          k3d-k3s-default-agent-1\n  70b68b040360        rancher/k3s:latest         <span class=\"token string\">\"/bin/k3s agent\"</span>         <span class=\"token number\">10</span> days ago         Up <span class=\"token number\">2</span> hours          <span class=\"token number\">0.0</span>.0.0:8082-<span class=\"token operator\">></span><span class=\"token number\">30080</span>/tcp                         k3d-k3s-default-agent-0\n  28cc6cef76ee        rancher/k3s:latest         <span class=\"token string\">\"/bin/k3s server --t…\"</span>   <span class=\"token number\">10</span> days ago         Up <span class=\"token number\">2</span> hours                                                          k3d-k3s-default-server-0\n\n$ docker pause k3d-k3s-default-agent-1\nk3d-k3s-default-agent-1</code></pre></div><p>Now wait for a while and this should be the new state:</p><div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl get po\nNAME                                READY   STATUS        RESTARTS   AGE\nhashresponse-dep-57bcc888d7-5gkc9   <span class=\"token number\">1</span>/1     Terminating   <span class=\"token number\">0</span>          15m\nhashresponse-dep-57bcc888d7-4klvg   <span class=\"token number\">1</span>/1     Running       <span class=\"token number\">0</span>          30s\n\n$ <span class=\"token function\">curl</span> localhost:8081\n6xluh2: ta0ztp</code></pre></div><p>What did just happen? Read <a href=\"https://dev.to/duske/how-kubernetes-handles-offline-nodes-53b5\" target=\"_blank\" rel=\"noopener noreferrer\">this explanation on how kubernetes handles offline nodes</a></p><p>Well then, what happens if you delete the only control-plane node? Nothing good. In our local cluster it's our single point of failure. See Kubernetes documentation for \"<a href=\"https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/ha-topology/\" target=\"_blank\" rel=\"noopener noreferrer\">Options for Highly Available topology</a>\" to avoid getting the whole cluster crippled by a single faulty hardware.</p></div>","frontmatter":{"path":"/part-5/1-kubernetes-internals","title":"Kubernetes Internals"},"fileAbsolutePath":"/home/runner/work/dwk2024/dwk2024/data/part-5/1-kubernetes-internals.md"},"allPages":{"edges":[{"node":{"id":"5225f2a2-20f9-50ce-93ac-7b38f3105103","frontmatter":{"path":"/faq","title":"FAQ"}}},{"node":{"id":"e1ed6713-5992-5f7f-95a1-17efd97f57d8","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"7e706a38-3828-5118-bdec-3705a319a1b0","frontmatter":{"path":"/faq-vi","title":"Câu hỏi thường gặp"}}},{"node":{"id":"52d4cd1d-eb14-54f3-a18a-ef84b67c320d","frontmatter":{"path":"/index-en","title":"Homepage"}}},{"node":{"id":"04c5ddbd-7839-580f-82da-bc9fdbb49f84","frontmatter":{"path":"/known-problems-solutions-vi","title":"Các vấn đề bạn có thể gặp phải"}}},{"node":{"id":"3102d88f-7297-56fb-af03-27d1079fffd1","frontmatter":{"path":"/","title":"Trang chủ"}}},{"node":{"id":"c92ea568-3384-5ff8-8dfa-b9015597780d","frontmatter":{"path":"/known-problems-solutions","title":"Issues you may face"}}},{"node":{"id":"5e6b6ee0-b381-53f0-b84c-af378792b131","frontmatter":{"path":"/registration-and-completion","title":"Registration and Completion"}}},{"node":{"id":"58688080-4aa8-54e6-8b8b-02de1c4f6410","frontmatter":{"path":"/unity-assignment","title":"Unity Assignment"}}},{"node":{"id":"d9c993b6-f6b4-59a1-b119-f3b7218eec6b","frontmatter":{"path":"/sanasto","title":"Sanasto"}}},{"node":{"id":"8a3ee5be-7557-5fcd-954b-2351e74cd585","frontmatter":{"path":"/part-0/1-intro-vi","title":"Giới thiệu khóa học"}}},{"node":{"id":"23082016-7bbd-5215-8485-4ffccbf3ea1a","frontmatter":{"path":"/part-0/1-intro","title":"Course Introduction"}}},{"node":{"id":"771eaa93-2ef2-5e0f-9e1e-55914c67c4ac","frontmatter":{"path":"/part-0","title":"Part 0"}}},{"node":{"id":"1c236933-7ad5-5b61-8c07-07db3822d55a","frontmatter":{"path":"/part-1/2-introduction-to-debugging","title":"Introduction to Debugging"}}},{"node":{"id":"fe0342aa-a4c5-5b44-8591-71eb27f1a287","frontmatter":{"path":"/part-1/2-introduction-to-debugging-vi","title":"Giới thiệu về Debugging"}}},{"node":{"id":"7fc5c062-6b94-53ec-9aaa-adca66ce672e","frontmatter":{"path":"/part-1/5-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"3c788edf-62db-5e86-9366-17b53eda9244","frontmatter":{"path":"/part-1/5-summary","title":"Summary"}}},{"node":{"id":"8ed3365b-b788-5806-8ec5-bec3cb0f94c8","frontmatter":{"path":"/part-1","title":"Part 1"}}},{"node":{"id":"46a4a0e4-d131-537d-aa72-5b6726163a7d","frontmatter":{"path":"/part-2/1-networking-between-pods-vi","title":"Kết nối mạng giữa các pod"}}},{"node":{"id":"fd467661-6b24-545f-904c-52f4a7ade6b7","frontmatter":{"path":"/part-2/1-networking-between-pods","title":"Networking between pods"}}},{"node":{"id":"56110eda-875d-5bd9-a400-5bd5a009df7f","frontmatter":{"path":"/part-2/5-monitoring-vi","title":"Giám sát"}}},{"node":{"id":"8f3387b0-ec6e-5a86-982a-e52780d911f9","frontmatter":{"path":"/part-2/5-monitoring","title":"Monitoring"}}},{"node":{"id":"06173ac4-c2f8-57df-8dc8-450b5c2bb695","frontmatter":{"path":"/part-2/6-summary","title":"Summary"}}},{"node":{"id":"79f1cddb-6995-51c2-bf98-2adc13de9b13","frontmatter":{"path":"/part-2/6-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"8c3d747d-4f87-5a46-99ac-dfd0af5a893b","frontmatter":{"path":"/part-2","title":"Part 2"}}},{"node":{"id":"8d9fd774-9dbe-5cca-8395-9226fcf82c4a","frontmatter":{"path":"/part-3/4-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"b98b2895-6c9d-5234-939d-2f547cbf8a06","frontmatter":{"path":"/part-3/4-summary","title":"Summary"}}},{"node":{"id":"29bec4f5-8a0b-580d-ac84-9dbbd1d7152e","frontmatter":{"path":"/part-3","title":"Part 3"}}},{"node":{"id":"0045695d-e541-5acc-b4b8-551023d01733","frontmatter":{"path":"/part-4/4-summary","title":"Summary"}}},{"node":{"id":"a917b24d-df2b-5199-ac98-cd0f7560c63f","frontmatter":{"path":"/part-4","title":"Part 4"}}},{"node":{"id":"4dd8302d-d170-5d38-8198-4d0947322bbc","frontmatter":{"path":"/part-4/4-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"eb339401-26c8-594c-98fd-2f30a95275cd","frontmatter":{"path":"/part-5/4-beyond-kubernetes-vi","title":"Vượt ra ngoài Kubernetes"}}},{"node":{"id":"2318c18f-86e6-5a4e-958a-d1c38f8615cd","frontmatter":{"path":"/part-5/4-beyond-kubernetes","title":"Beyond Kubernetes"}}},{"node":{"id":"1d8ff75c-065b-565d-9ceb-01b9a276ae7a","frontmatter":{"path":"/part-5/5-summary","title":"Summary and end"}}},{"node":{"id":"781bd207-902e-59a2-a752-4958c2c93fb0","frontmatter":{"path":"/part-5/5-summary-vi","title":"Tóm tắt và kết thúc"}}},{"node":{"id":"829fd216-f995-5a77-b201-bb971aec73b4","frontmatter":{"path":"/part-0/2-kubernetes-in-three-diagrams-vi","title":"Kubernetes qua ba sơ đồ"}}},{"node":{"id":"98132cca-4dc3-5942-a6f4-1da87bc81a23","frontmatter":{"path":"/part-0/2-kubernetes-in-three-diagrams","title":"Kubernetes in three diagrams"}}},{"node":{"id":"8931bcb7-c40e-5d57-aa80-c4333972fbb8","frontmatter":{"path":"/part-1/3-introduction-to-networking-vi","title":"Giới thiệu về Mạng"}}},{"node":{"id":"90b8e83a-9d55-550a-908a-316708ce7f8c","frontmatter":{"path":"/part-1/3-introduction-to-networking","title":"Introduction to Networking"}}},{"node":{"id":"4fe00c0a-bb17-5d4c-8202-750493a755c9","frontmatter":{"path":"/part-1/4-introduction-to-storage-vi","title":"Giới thiệu về Lưu trữ"}}},{"node":{"id":"6cc3be66-6091-58fc-bcbd-1f27f9473f85","frontmatter":{"path":"/part-1/4-introduction-to-storage","title":"Introduction to Storage"}}},{"node":{"id":"d5206d16-d2fe-51fd-8acd-d85ecf0be257","frontmatter":{"path":"/part-2/2-organizing-a-cluster","title":"Organizing a cluster"}}},{"node":{"id":"b53df746-c24f-57e3-a9f3-d6d621697689","frontmatter":{"path":"/part-2/2-organizing-a-cluster-vi","title":"Tổ chức một cụm"}}},{"node":{"id":"e4534a9d-fb84-5d1f-83f0-35055feb0da7","frontmatter":{"path":"/part-2/3-configuring-applications","title":"Configuring applications"}}},{"node":{"id":"15be3d7c-b0b7-5bce-b3bf-8cec39d54630","frontmatter":{"path":"/part-2/3-configuring-applications-vi","title":"Cấu hình ứng dụng"}}},{"node":{"id":"02389078-a12f-561a-8a54-fa99a6950b92","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs-vi","title":"StatefulSet và Job"}}},{"node":{"id":"466aa711-527b-55a0-871b-13468e65d344","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs","title":"StatefulSets and Jobs"}}},{"node":{"id":"bea18f34-dcdc-59b8-ba24-3011680a0c58","frontmatter":{"path":"/part-3/1-introduction-to-gke-vi","title":"Giới thiệu về Google Kubernetes Engine"}}},{"node":{"id":"0049e57f-0bc7-5689-9169-43848a972877","frontmatter":{"path":"/part-3/2-deployment-pipeline-vi","title":"Quy trình Triển khai (Deployment Pipeline)"}}},{"node":{"id":"61f18dc7-1abf-5c75-9b54-0cee11c76a40","frontmatter":{"path":"/part-3/2-deployment-pipeline","title":"Deployment Pipeline"}}},{"node":{"id":"84db9628-b3df-5ca1-9d3d-5924e02ae549","frontmatter":{"path":"/part-3/1-introduction-to-gke","title":"Introduction to Google Kubernetes Engine"}}},{"node":{"id":"7dfec8c7-8ccb-50da-949d-ebd1de395dc4","frontmatter":{"path":"/part-3/3-gke-features-vi","title":"Các tính năng của GKE"}}},{"node":{"id":"423cbc46-2dfa-57e6-9dc5-761a93729600","frontmatter":{"path":"/part-3/3-gke-features","title":"GKE features"}}},{"node":{"id":"6df9c7be-f930-5827-a39c-0c1698b23600","frontmatter":{"path":"/part-4/3-gitops-vi","title":"Triển khai GitOps"}}},{"node":{"id":"46f9ce68-5ccd-5787-bd59-03852ad6fdcb","frontmatter":{"path":"/part-4/3-gitops","title":"GitOps"}}},{"node":{"id":"da1f8069-17bc-5c8e-9310-117bcedf5acf","frontmatter":{"path":"/part-5/2-custom-resource-definitions-vi","title":"Định nghĩa Tài nguyên Tùy chỉnh (Custom Resource Definitions)"}}},{"node":{"id":"31927db3-2182-55c7-b680-663754461d14","frontmatter":{"path":"/part-5/1-kubernetes-internals","title":"Kubernetes Internals"}}},{"node":{"id":"68c64f9f-c9a5-544b-bafb-b061665cacd0","frontmatter":{"path":"/part-5/3-service-mesh-vi","title":"Service Mesh"}}},{"node":{"id":"0e981ec1-99e0-5005-ba9f-4f626a81b7ce","frontmatter":{"path":"/part-5/1-kubernetes-internals-vi","title":"Bên trong Kubernetes"}}},{"node":{"id":"20ceed4e-761d-54d4-9acf-2669eac533c6","frontmatter":{"path":"/part-5/3-service-mesh","title":"Service Mesh"}}},{"node":{"id":"ccefb04a-5790-57f6-869b-d255b2203667","frontmatter":{"path":"/part-5/2-custom-resource-definitions","title":"Custom Resource Definitions"}}},{"node":{"id":"306c87f3-9adb-5d8b-a3ce-072f8e6cfa43","frontmatter":{"path":"/part-5","title":"Part 5"}}},{"node":{"id":"97ead58a-8493-5fdd-808e-d4a56de573b0","frontmatter":{"path":"/part-1/1-first-deploy","title":"First Deploy"}}},{"node":{"id":"c179c521-bb62-52bd-808b-d4869df5302a","frontmatter":{"path":"/part-4/1-update-strategies-and-prometheus-vi","title":"Chiến lược cập nhật và Prometheus"}}},{"node":{"id":"6f4f18ce-5aa9-5bb5-9d74-0a631a78e6b3","frontmatter":{"path":"/part-4/2-messaging-systems-vi","title":"Hệ thống nhắn tin"}}},{"node":{"id":"898b0354-f1a2-5664-97de-d84b16018395","frontmatter":{"path":"/part-4/1-update-strategies-and-prometheus","title":"Update Strategies and Prometheus"}}},{"node":{"id":"6981a9d7-619d-51a9-9490-74bc77c0f55b","frontmatter":{"path":"/part-4/2-messaging-systems","title":"Messaging Systems"}}},{"node":{"id":"a17c4c44-7396-543f-b6b4-7adf57808aa8","frontmatter":{"path":"/part-1/1-first-deploy-vi","title":"Triển khai đầu tiên"}}}]}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}