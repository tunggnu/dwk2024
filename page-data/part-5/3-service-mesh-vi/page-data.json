{"componentChunkName":"component---src-templates-course-content-template-js","path":"/part-5/3-service-mesh-vi","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"Mục tiêu học tập"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sau phần này, bạn có thể"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Thiết lập một service mesh và sử dụng nó để giám sát lưu lượng mạng"}]},{"type":"text","value":"\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bạn sẽ thường xuyên nghe về một khái niệm gọi là "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Service Mesh"}]},{"type":"text","value":". Service mesh là một hệ thống khá phức tạp, cung cấp rất nhiều tính năng cho ứng dụng. Trong các phần 1 đến 4, chúng ta đã triển khai một số tính năng mà service mesh có thể cung cấp sẵn. Video sau đây của Microsoft Developer là một hướng dẫn tuyệt vời về tất cả các tính năng mà một service mesh có."}]},{"type":"element","tagName":"iframe","properties":{"width":560,"height":315,"src":"https://www.youtube-nocookie.com/embed/izVWk7rYqWI","frameBorder":"0","allow":"accelerometer; encrypted-media; gyroscope; picture-in-picture","allowFullScreen":true},"children":[]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bạn cũng nên đọc bài viết "},{"type":"element","tagName":"a","properties":{"href":"https://linkerd.io/what-is-a-service-mesh/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"What is a service mesh?"}]},{"type":"text","value":" của Linkerd."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Đối với lưu lượng vào, ra và giao tiếp giữa các dịch vụ, một service mesh có thể:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"bảo mật giao tiếp"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"quản lý lưu lượng"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"giám sát lưu lượng, gửi log và metric tới ví dụ như Prometheus"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vì vậy, service mesh là một công cụ "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"cực kỳ"}]},{"type":"text","value":" mạnh mẽ. Nếu chúng ta dùng service mesh như "},{"type":"element","tagName":"a","properties":{"href":"https://istio.io/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Istio"}]},{"type":"text","value":" ngay từ phần 1, có thể đã không cần dùng "},{"type":"element","tagName":"a","properties":{"href":"https://doc.traefik.io/traefik/providers/kubernetes-ingress/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Traefik"}]},{"type":"text","value":", không cần tự làm giải pháp monitoring, và có thể thực hiện canary release mà không cần "},{"type":"element","tagName":"a","properties":{"href":"https://argoproj.github.io/rollouts/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Argo Rollouts"}]},{"type":"text","value":". Tuy nhiên, chúng ta đã làm được tất cả mà không cần service mesh."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Hãy cài đặt một service mesh và thử nghiệm các tính năng. Ở đây, chúng ta chọn "},{"type":"element","tagName":"a","properties":{"href":"https://linkerd.io/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Linkerd"}]},{"type":"text","value":" chủ yếu vì nó nhẹ hơn "},{"type":"element","tagName":"a","properties":{"href":"https://istio.io/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Istio"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Linkerd có một công cụ CLI hỗ trợ, hãy làm theo "},{"type":"element","tagName":"a","properties":{"href":"https://linkerd.io/2/getting-started/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"hướng dẫn bắt đầu"}]},{"type":"text","value":" đến Bước 4."}]},{"type":"element","tagName":"text-box","properties":{"name":"Nguồn tham khảo khác","variant":"hint"},"children":[{"type":"text","value":"\n Thực ra chúng ta chỉ đang làm theo toàn bộ hướng dẫn bắt đầu, bạn có thể đọc qua nếu muốn.\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Hãy xem ứng dụng của chúng ta, lần này là ứng dụng microservice cho việc bình chọn emoji: "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/BuoyantIO/emojivoto","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://github.com/BuoyantIO/emojivoto"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"shell"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-shell"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"$ kubectl apply -f https://raw.githubusercontent.com/BuoyantIO/emojivoto/main/kustomize/deployment/ns.yml "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"\\"}]},{"type":"text","value":"\n                -f https://raw.githubusercontent.com/BuoyantIO/emojivoto/main/kustomize/deployment/web.yml "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"\\"}]},{"type":"text","value":"\n                -f https://raw.githubusercontent.com/BuoyantIO/emojivoto/main/kustomize/deployment/emoji.yml "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"\\"}]},{"type":"text","value":"\n                -f https://raw.githubusercontent.com/BuoyantIO/emojivoto/main/kustomize/deployment/voting.yml "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"\\"}]},{"type":"text","value":"\n                -f https://raw.githubusercontent.com/BuoyantIO/emojivoto/main/kustomize/deployment/vote-bot.yml\n\n$ kubectl get all -n emojivoto\n  NAME                            READY   STATUS    RESTARTS   AGE\n  pod/web-7bcb54cb8b-cjw7d        "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"          3d21h\n  pod/emoji-686f74d889-rcdsh      "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"          3d21h\n  pod/vote-bot-74d97c76c6-pcsfl   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"          3d21h\n  pod/voting-56847f699b-2nzqn     "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"          3d21h\n\n  NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"S"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"             AGE\n  service/web-svc      ClusterIP   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.43"}]},{"type":"text","value":".248.111   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"none"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"        "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]},{"type":"text","value":"/TCP              3d21h\n  service/emoji-svc    ClusterIP   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.43"}]},{"type":"text","value":".110.235   "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"none"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"        "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"8080"}]},{"type":"text","value":"/TCP,8801/TCP   3d21h\n  service/voting-svc   ClusterIP   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.43"}]},{"type":"text","value":".111.57    "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"none"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"        "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"8080"}]},{"type":"text","value":"/TCP,8801/TCP   3d21h\n\n  NAME                       READY   UP-TO-DATE   AVAILABLE   AGE\n  deployment.apps/emoji      "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"            "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"           3d21h\n  deployment.apps/vote-bot   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"            "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"           3d21h\n  deployment.apps/web        "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"            "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"           3d21h\n  deployment.apps/voting     "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"            "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"           3d21h"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ở đây chúng ta thấy deployment \"vote-bot\" tự động tạo lưu lượng truy cập. README cho biết nó sẽ bình chọn Donut 🍩 15% thời gian và phần còn lại chọn ngẫu nhiên."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vì đã có service, chúng ta chỉ thiếu ingress."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"ingress.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" networking.k8s.io/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Ingress\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" web"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"ingress\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"namespace"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" emojivoto\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"rules"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"http"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"paths"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"path"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" /\n            "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"pathType"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Prefix\n            "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"backend"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n              "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n                "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" web"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"svc\n                "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"port"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n                  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"number"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Và ứng dụng sẽ có thể truy cập tại "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:8081","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost:8081"}]},{"type":"text","value":". Tuy nhiên, có điều gì đó lạ đang xảy ra! Bạn có thể phát hiện ra bằng cách xem bảng xếp hạng và biết các lượt bình chọn đi đâu, hoặc tự mình nhấn vào từng emoji."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Hãy xem có cách nào tốt hơn để phát hiện hành vi này và tìm ra vấn đề. Linkerd cung cấp một dashboard thông qua extension tên là "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"viz"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"$ linkerd viz install | kubectl apply -f -\n  ...\n\n$ linkerd viz dashboard"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nó sẽ mở trình duyệt của bạn. Nhấn vào namespace \"emojivoto\" (để vào /namespaces/emojivoto) bạn sẽ thấy các resource trong namespace emojivoto chưa nằm trong service mesh. Nguyên nhân là các pod chưa có "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"sidecar container"}]},{"type":"text","value":". "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/pods/sidecar-containers/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Sidecar containers"}]},{"type":"text","value":" là một mẫu phổ biến, nơi một container mới được thêm vào pod để bổ sung chức năng. Hãy thêm sidecar của Linkerd vào emojivoto."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Trạng thái pod trước khi thêm:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"$ kubectl get po -n emojivoto\n  NAME                        READY   STATUS    RESTARTS   AGE\n  voting-f999bd4d7-r4mct      1/1     Running   0          10m\n  web-79469b946f-ksprv        1/1     Running   0          10m\n  emoji-66ccdb4d86-rhcnf      1/1     Running   0          10m\n  vote-bot-69754c864f-g24jt   1/1     Running   0          10m"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Câu lệnh để thêm Linkerd vào các deployment và apply lại:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"$ kubectl get -n emojivoto deploy -o yaml \\\n    | linkerd inject - \\\n    | kubectl apply -f -"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bạn có thể chạy từng lệnh riêng để xem chúng làm gì. Lệnh đầu tiên, "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl get -n emojivoto deploy -o yaml"}]},{"type":"text","value":", sẽ xuất ra toàn bộ deployment trong namespace emojivoto. "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"linkerd inject -"}]},{"type":"text","value":" sẽ thêm annotation để Linkerd thêm sidecar proxy container. Cuối cùng, "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"kubectl apply"}]},{"type":"text","value":" sẽ áp dụng các deployment đã chỉnh sửa. Bây giờ các pod sẽ như sau:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl get po -n emojivoto\nNAME                        READY   STATUS    RESTARTS   AGE\nvote-bot-6d7677bb68-qxfx9   2/2     Running   0          3m17s\nweb-5f86686c4d-qgxtv        2/2     Running   0          3m17s\nemoji-696d9d8f95-sgzqs      2/2     Running   0          3m17s\nvoting-ff4c54b8d-sf99j      2/2     Running   0          3m18s"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nếu bạn xem lại dashboard, sẽ thấy nhiều thông tin hơn vì các deployment cũ đã được thay thế bằng các deployment đã \"meshed\". Ta cũng nhận thấy tỷ lệ thành công (success rate) không hoàn hảo."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Hai service có tỷ lệ thành công dưới 100%. Vì "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"web"}]},{"type":"text","value":" có thể chỉ chuyển tiếp lỗi từ "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"voting"}]},{"type":"text","value":", bạn có thể nhấn vào bất kỳ service nào để nhanh chóng thấy request nào đang lỗi."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Service mesh là công cụ mạnh mẽ vì giúp bạn kết nối và quan sát các dịch vụ. Đọc tiếp\n"},{"type":"element","tagName":"a","properties":{"href":"https://linkerd.io/2.15/tasks/debugging-your-service/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"bài này"}]},{"type":"text","value":" để xem Linkerd có thể dùng để debug lỗi trong ứng dụng emoji voting như thế nào."}]},{"type":"element","tagName":"exercise","properties":{"name":"Bài tập 5.02: Project, phiên bản Service Mesh"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kích hoạt service mesh Linkerd cho "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Project"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Việc chuyển deployment sang Linkerd khá đơn giản. Đọc "},{"type":"element","tagName":"a","properties":{"href":"https://linkerd.io/2/tasks/adding-your-service/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"hướng dẫn này"}]},{"type":"text","value":", và thêm các manifest đã chỉnh sửa (qua Linkerd inject) vào repository để nộp bài."}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Bài tập 5.03: Học từ tài liệu ngoài"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Để minh họa cách canary release hoạt động trong Service Mesh, hãy làm theo bài tập tại: "},{"type":"element","tagName":"a","properties":{"href":"https://linkerd.io/2/tasks/canary-release/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://linkerd.io/2/tasks/canary-release/"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Chỉ cần làm theo một ví dụ "},{"type":"element","tagName":"a","properties":{"href":"https://linkerd.io/2.15/tasks/flagger/#flagger","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Flagger"}]},{"type":"text","value":" hoặc "},{"type":"element","tagName":"a","properties":{"href":"https://linkerd.io/2.15/tasks/flagger/#argo-rollouts","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Argo Rollouts"}]},{"type":"text","value":", mà bạn đã quen ở "},{"type":"element","tagName":"a","properties":{"href":"/part-4/1-update-strategies-and-prometheus#canary-release"},"children":[{"type":"text","value":"phần 4"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"div","properties":{},"children":[{"type":"text","value":"Sử dụng lệnh "},{"type":"element","tagName":"a","properties":{"href":"https://man7.org/linux/man-pages/man1/script.1.html"},"children":[{"type":"text","value":"script"}]},{"type":"text","value":" trong quá trình làm bài để có file nộp. Hoặc chỉ cần chụp màn hình kết quả cuối cùng."}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ok, chúng ta tạm dừng ở đây. Bạn có cần service mesh cho ứng dụng của mình không? Phần lớn là không... trừ khi bạn làm ở môi trường doanh nghiệp lớn."}]},{"type":"element","tagName":"h3","properties":{"id":"một-diều-nữa-init-containers-va-sidecars","style":"position:relative;"},"children":[{"type":"text","value":"Một điều nữa... init containers và sidecars"},{"type":"element","tagName":"a","properties":{"href":"#m%E1%BB%99t-di%E1%BB%81u-n%E1%BB%AFa-init-containers-va-sidecars","ariaLabel":"một diều nữa init containers va sidecars permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bên dưới, Linkerd dựa rất nhiều vào Init containers và Sidecar containers để thực hiện \"phép thuật\" của mình.\nHãy cùng tìm hiểu kỹ hơn về hai khái niệm quan trọng này."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Một pod có thể có bất kỳ số lượng "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/pods/init-containers/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"init containers"}]},{"type":"text","value":" nào, là các container chạy trước khi container chính của pod khởi động. Có nhiều mục đích cho init container, ví dụ:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"tạo hoặc chỉnh sửa file cấu hình, lấy dữ liệu hoặc cấu hình từ nguồn ngoài, hoặc thực hiện các bước tiền xử lý cần thiết trước khi ứng dụng chính khởi động"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"chờ các dịch vụ, database hoặc thành phần hạ tầng khác sẵn sàng trước khi ứng dụng chính khởi động. Điều này đảm bảo container chính chỉ chạy khi mọi phụ thuộc đã sẵn sàng"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"cài đặt hoặc thiết lập các tiện ích, toolchain hoặc phần mềm cần thiết cho ứng dụng chính lúc runtime nhưng không có sẵn trong image chính, giúp image chính gọn nhẹ và tối ưu"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/pods/sidecar-containers/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Sidecar"}]},{"type":"text","value":" là các container phụ chạy cùng container chính trong cùng một Pod. Chúng được dùng để bổ sung hoặc mở rộng chức năng cho container chính bằng cách cung cấp thêm dịch vụ, như logging, monitoring, bảo mật, đồng bộ dữ liệu... mà không cần thay đổi mã nguồn ứng dụng chính."}]},{"type":"element","tagName":"exercise","properties":{"name":"Bài tập 5.04: Wikipedia với init và sidecar"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Viết một ứng dụng phục vụ các trang Wikipedia. Ứng dụng cần có:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"container chính dựa trên image "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"nginx"}]},{"type":"text","value":", chỉ phục vụ nội dung có trong thư mục www công khai"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"init container dùng curl để tải trang "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Kubernetes","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://en.wikipedia.org/wiki/Kubernetes"}]},{"type":"text","value":" và lưu nội dung vào thư mục www công khai cho container chính"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"một sidecar container chờ ngẫu nhiên từ 5 đến 15 phút, sau đó curl một trang Wikipedia ngẫu nhiên tại URL "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Special:Random","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://en.wikipedia.org/wiki/Special:Random"}]},{"type":"text","value":" và lưu nội dung vào thư mục www công khai cho container chính"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Gợi ý: bạn có thể cần đọc lại "},{"type":"element","tagName":"a","properties":{"href":"/part-1/4-introduction-to-storage#volumes"},"children":[{"type":"text","value":"phần này"}]},{"type":"text","value":" ở phần 1 của khóa học."}]}]}]},"html":"<div><text-box variant='learningObjectives' name='Mục tiêu học tập'><p>Sau phần này, bạn có thể</p><ul>\n<li>Thiết lập một service mesh và sử dụng nó để giám sát lưu lượng mạng</li>\n</ul></text-box><p>Bạn sẽ thường xuyên nghe về một khái niệm gọi là <em>Service Mesh</em>. Service mesh là một hệ thống khá phức tạp, cung cấp rất nhiều tính năng cho ứng dụng. Trong các phần 1 đến 4, chúng ta đã triển khai một số tính năng mà service mesh có thể cung cấp sẵn. Video sau đây của Microsoft Developer là một hướng dẫn tuyệt vời về tất cả các tính năng mà một service mesh có.</p><iframe width=\"560\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/izVWk7rYqWI\" frameborder=\"0\" allow=\"accelerometer; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe><p>Bạn cũng nên đọc bài viết <a href=\"https://linkerd.io/what-is-a-service-mesh/\" target=\"_blank\" rel=\"noopener noreferrer\">What is a service mesh?</a> của Linkerd.</p><p>Đối với lưu lượng vào, ra và giao tiếp giữa các dịch vụ, một service mesh có thể:</p><ul>\n<li>bảo mật giao tiếp</li>\n<li>quản lý lưu lượng</li>\n<li>giám sát lưu lượng, gửi log và metric tới ví dụ như Prometheus</li>\n</ul><p>Vì vậy, service mesh là một công cụ <strong>cực kỳ</strong> mạnh mẽ. Nếu chúng ta dùng service mesh như <a href=\"https://istio.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Istio</a> ngay từ phần 1, có thể đã không cần dùng <a href=\"https://doc.traefik.io/traefik/providers/kubernetes-ingress/\" target=\"_blank\" rel=\"noopener noreferrer\">Traefik</a>, không cần tự làm giải pháp monitoring, và có thể thực hiện canary release mà không cần <a href=\"https://argoproj.github.io/rollouts/\" target=\"_blank\" rel=\"noopener noreferrer\">Argo Rollouts</a>. Tuy nhiên, chúng ta đã làm được tất cả mà không cần service mesh.</p><p>Hãy cài đặt một service mesh và thử nghiệm các tính năng. Ở đây, chúng ta chọn <a href=\"https://linkerd.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Linkerd</a> chủ yếu vì nó nhẹ hơn <a href=\"https://istio.io/\" target=\"_blank\" rel=\"noopener noreferrer\">Istio</a>.</p><p>Linkerd có một công cụ CLI hỗ trợ, hãy làm theo <a href=\"https://linkerd.io/2/getting-started/\" target=\"_blank\" rel=\"noopener noreferrer\">hướng dẫn bắt đầu</a> đến Bước 4.</p><text-box name=\"Nguồn tham khảo khác\" variant=\"hint\">\n Thực ra chúng ta chỉ đang làm theo toàn bộ hướng dẫn bắt đầu, bạn có thể đọc qua nếu muốn.\n</text-box><p>Hãy xem ứng dụng của chúng ta, lần này là ứng dụng microservice cho việc bình chọn emoji: <a href=\"https://github.com/BuoyantIO/emojivoto\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/BuoyantIO/emojivoto</a>.</p><div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl apply -f https://raw.githubusercontent.com/BuoyantIO/emojivoto/main/kustomize/deployment/ns.yml <span class=\"token punctuation\">\\</span>\n                -f https://raw.githubusercontent.com/BuoyantIO/emojivoto/main/kustomize/deployment/web.yml <span class=\"token punctuation\">\\</span>\n                -f https://raw.githubusercontent.com/BuoyantIO/emojivoto/main/kustomize/deployment/emoji.yml <span class=\"token punctuation\">\\</span>\n                -f https://raw.githubusercontent.com/BuoyantIO/emojivoto/main/kustomize/deployment/voting.yml <span class=\"token punctuation\">\\</span>\n                -f https://raw.githubusercontent.com/BuoyantIO/emojivoto/main/kustomize/deployment/vote-bot.yml\n\n$ kubectl get all -n emojivoto\n  NAME                            READY   STATUS    RESTARTS   AGE\n  pod/web-7bcb54cb8b-cjw7d        <span class=\"token number\">1</span>/1     Running   <span class=\"token number\">1</span>          3d21h\n  pod/emoji-686f74d889-rcdsh      <span class=\"token number\">1</span>/1     Running   <span class=\"token number\">1</span>          3d21h\n  pod/vote-bot-74d97c76c6-pcsfl   <span class=\"token number\">1</span>/1     Running   <span class=\"token number\">1</span>          3d21h\n  pod/voting-56847f699b-2nzqn     <span class=\"token number\">1</span>/1     Running   <span class=\"token number\">1</span>          3d21h\n\n  NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class=\"token punctuation\">(</span>S<span class=\"token punctuation\">)</span>             AGE\n  service/web-svc      ClusterIP   <span class=\"token number\">10.43</span>.248.111   <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>        <span class=\"token number\">80</span>/TCP              3d21h\n  service/emoji-svc    ClusterIP   <span class=\"token number\">10.43</span>.110.235   <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>        <span class=\"token number\">8080</span>/TCP,8801/TCP   3d21h\n  service/voting-svc   ClusterIP   <span class=\"token number\">10.43</span>.111.57    <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>        <span class=\"token number\">8080</span>/TCP,8801/TCP   3d21h\n\n  NAME                       READY   UP-TO-DATE   AVAILABLE   AGE\n  deployment.apps/emoji      <span class=\"token number\">1</span>/1     <span class=\"token number\">1</span>            <span class=\"token number\">1</span>           3d21h\n  deployment.apps/vote-bot   <span class=\"token number\">1</span>/1     <span class=\"token number\">1</span>            <span class=\"token number\">1</span>           3d21h\n  deployment.apps/web        <span class=\"token number\">1</span>/1     <span class=\"token number\">1</span>            <span class=\"token number\">1</span>           3d21h\n  deployment.apps/voting     <span class=\"token number\">1</span>/1     <span class=\"token number\">1</span>            <span class=\"token number\">1</span>           3d21h</code></pre></div><p>Ở đây chúng ta thấy deployment \"vote-bot\" tự động tạo lưu lượng truy cập. README cho biết nó sẽ bình chọn Donut 🍩 15% thời gian và phần còn lại chọn ngẫu nhiên.</p><p>Vì đã có service, chúng ta chỉ thiếu ingress.</p><p><strong>ingress.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Ingress\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> web<span class=\"token punctuation\">-</span>ingress\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> emojivoto\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /\n            <span class=\"token key atrule\">pathType</span><span class=\"token punctuation\">:</span> Prefix\n            <span class=\"token key atrule\">backend</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> web<span class=\"token punctuation\">-</span>svc\n                <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token key atrule\">number</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></code></pre></div><p>Và ứng dụng sẽ có thể truy cập tại <a href=\"http://localhost:8081\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:8081</a>. Tuy nhiên, có điều gì đó lạ đang xảy ra! Bạn có thể phát hiện ra bằng cách xem bảng xếp hạng và biết các lượt bình chọn đi đâu, hoặc tự mình nhấn vào từng emoji.</p><p>Hãy xem có cách nào tốt hơn để phát hiện hành vi này và tìm ra vấn đề. Linkerd cung cấp một dashboard thông qua extension tên là <code class=\"language-text\">viz</code>.</p><div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ linkerd viz install | kubectl apply -f -\n  ...\n\n$ linkerd viz dashboard</code></pre></div><p>Nó sẽ mở trình duyệt của bạn. Nhấn vào namespace \"emojivoto\" (để vào /namespaces/emojivoto) bạn sẽ thấy các resource trong namespace emojivoto chưa nằm trong service mesh. Nguyên nhân là các pod chưa có <code class=\"language-text\">sidecar container</code>. <a href=\"https://kubernetes.io/docs/concepts/workloads/pods/sidecar-containers/\" target=\"_blank\" rel=\"noopener noreferrer\">Sidecar containers</a> là một mẫu phổ biến, nơi một container mới được thêm vào pod để bổ sung chức năng. Hãy thêm sidecar của Linkerd vào emojivoto.</p><p>Trạng thái pod trước khi thêm:</p><div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ kubectl get po -n emojivoto\n  NAME                        READY   STATUS    RESTARTS   AGE\n  voting-f999bd4d7-r4mct      1/1     Running   0          10m\n  web-79469b946f-ksprv        1/1     Running   0          10m\n  emoji-66ccdb4d86-rhcnf      1/1     Running   0          10m\n  vote-bot-69754c864f-g24jt   1/1     Running   0          10m</code></pre></div><p>Câu lệnh để thêm Linkerd vào các deployment và apply lại:</p><div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ kubectl get -n emojivoto deploy -o yaml \\\n    | linkerd inject - \\\n    | kubectl apply -f -</code></pre></div><p>Bạn có thể chạy từng lệnh riêng để xem chúng làm gì. Lệnh đầu tiên, <code class=\"language-text\">kubectl get -n emojivoto deploy -o yaml</code>, sẽ xuất ra toàn bộ deployment trong namespace emojivoto. <code class=\"language-text\">linkerd inject -</code> sẽ thêm annotation để Linkerd thêm sidecar proxy container. Cuối cùng, <em>kubectl apply</em> sẽ áp dụng các deployment đã chỉnh sửa. Bây giờ các pod sẽ như sau:</p><div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl get po -n emojivoto\nNAME                        READY   STATUS    RESTARTS   AGE\nvote-bot-6d7677bb68-qxfx9   2/2     Running   0          3m17s\nweb-5f86686c4d-qgxtv        2/2     Running   0          3m17s\nemoji-696d9d8f95-sgzqs      2/2     Running   0          3m17s\nvoting-ff4c54b8d-sf99j      2/2     Running   0          3m18s</code></pre></div><p>Nếu bạn xem lại dashboard, sẽ thấy nhiều thông tin hơn vì các deployment cũ đã được thay thế bằng các deployment đã \"meshed\". Ta cũng nhận thấy tỷ lệ thành công (success rate) không hoàn hảo.</p><p>Hai service có tỷ lệ thành công dưới 100%. Vì <em>web</em> có thể chỉ chuyển tiếp lỗi từ <em>voting</em>, bạn có thể nhấn vào bất kỳ service nào để nhanh chóng thấy request nào đang lỗi.</p><p>Service mesh là công cụ mạnh mẽ vì giúp bạn kết nối và quan sát các dịch vụ. Đọc tiếp\n<a href=\"https://linkerd.io/2.15/tasks/debugging-your-service/\" target=\"_blank\" rel=\"noopener noreferrer\">bài này</a> để xem Linkerd có thể dùng để debug lỗi trong ứng dụng emoji voting như thế nào.</p><exercise name='Bài tập 5.02: Project, phiên bản Service Mesh'><p>Kích hoạt service mesh Linkerd cho <em>Project</em>.</p><p>Việc chuyển deployment sang Linkerd khá đơn giản. Đọc <a href=\"https://linkerd.io/2/tasks/adding-your-service/\" target=\"_blank\" rel=\"noopener noreferrer\">hướng dẫn này</a>, và thêm các manifest đã chỉnh sửa (qua Linkerd inject) vào repository để nộp bài.</p></exercise><exercise name='Bài tập 5.03: Học từ tài liệu ngoài'><p>Để minh họa cách canary release hoạt động trong Service Mesh, hãy làm theo bài tập tại: <a href=\"https://linkerd.io/2/tasks/canary-release/\" target=\"_blank\" rel=\"noopener noreferrer\">https://linkerd.io/2/tasks/canary-release/</a></p><p>Chỉ cần làm theo một ví dụ <a href=\"https://linkerd.io/2.15/tasks/flagger/#flagger\" target=\"_blank\" rel=\"noopener noreferrer\">Flagger</a> hoặc <a href=\"https://linkerd.io/2.15/tasks/flagger/#argo-rollouts\" target=\"_blank\" rel=\"noopener noreferrer\">Argo Rollouts</a>, mà bạn đã quen ở <a href=\"/part-4/1-update-strategies-and-prometheus#canary-release\">phần 4</a>.</p><div>Sử dụng lệnh <a href=\"https://man7.org/linux/man-pages/man1/script.1.html\">script</a> trong quá trình làm bài để có file nộp. Hoặc chỉ cần chụp màn hình kết quả cuối cùng.</div></exercise><p>Ok, chúng ta tạm dừng ở đây. Bạn có cần service mesh cho ứng dụng của mình không? Phần lớn là không... trừ khi bạn làm ở môi trường doanh nghiệp lớn.</p><h3 id=\"một-diều-nữa-init-containers-va-sidecars\" style=\"position:relative;\">Một điều nữa... init containers và sidecars<a href=\"#m%E1%BB%99t-di%E1%BB%81u-n%E1%BB%AFa-init-containers-va-sidecars\" aria-label=\"một diều nữa init containers va sidecars permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p>Bên dưới, Linkerd dựa rất nhiều vào Init containers và Sidecar containers để thực hiện \"phép thuật\" của mình.\nHãy cùng tìm hiểu kỹ hơn về hai khái niệm quan trọng này.</p><p>Một pod có thể có bất kỳ số lượng <a href=\"https://kubernetes.io/docs/concepts/workloads/pods/init-containers/\" target=\"_blank\" rel=\"noopener noreferrer\">init containers</a> nào, là các container chạy trước khi container chính của pod khởi động. Có nhiều mục đích cho init container, ví dụ:</p><ul>\n<li>tạo hoặc chỉnh sửa file cấu hình, lấy dữ liệu hoặc cấu hình từ nguồn ngoài, hoặc thực hiện các bước tiền xử lý cần thiết trước khi ứng dụng chính khởi động</li>\n<li>chờ các dịch vụ, database hoặc thành phần hạ tầng khác sẵn sàng trước khi ứng dụng chính khởi động. Điều này đảm bảo container chính chỉ chạy khi mọi phụ thuộc đã sẵn sàng</li>\n<li>cài đặt hoặc thiết lập các tiện ích, toolchain hoặc phần mềm cần thiết cho ứng dụng chính lúc runtime nhưng không có sẵn trong image chính, giúp image chính gọn nhẹ và tối ưu</li>\n</ul><p><a href=\"https://kubernetes.io/docs/concepts/workloads/pods/sidecar-containers/\" target=\"_blank\" rel=\"noopener noreferrer\">Sidecar</a> là các container phụ chạy cùng container chính trong cùng một Pod. Chúng được dùng để bổ sung hoặc mở rộng chức năng cho container chính bằng cách cung cấp thêm dịch vụ, như logging, monitoring, bảo mật, đồng bộ dữ liệu... mà không cần thay đổi mã nguồn ứng dụng chính.</p><exercise name='Bài tập 5.04: Wikipedia với init và sidecar'><p>Viết một ứng dụng phục vụ các trang Wikipedia. Ứng dụng cần có:</p><ul>\n<li>container chính dựa trên image <em>nginx</em>, chỉ phục vụ nội dung có trong thư mục www công khai</li>\n<li>init container dùng curl để tải trang <a href=\"https://en.wikipedia.org/wiki/Kubernetes\" target=\"_blank\" rel=\"noopener noreferrer\">https://en.wikipedia.org/wiki/Kubernetes</a> và lưu nội dung vào thư mục www công khai cho container chính</li>\n<li>một sidecar container chờ ngẫu nhiên từ 5 đến 15 phút, sau đó curl một trang Wikipedia ngẫu nhiên tại URL <a href=\"https://en.wikipedia.org/wiki/Special:Random\" target=\"_blank\" rel=\"noopener noreferrer\">https://en.wikipedia.org/wiki/Special:Random</a> và lưu nội dung vào thư mục www công khai cho container chính</li>\n</ul><p>Gợi ý: bạn có thể cần đọc lại <a href=\"/part-1/4-introduction-to-storage#volumes\">phần này</a> ở phần 1 của khóa học.</p></exercise></div>","frontmatter":{"path":"/part-5/3-service-mesh-vi","title":"Service Mesh"},"fileAbsolutePath":"/home/runner/work/dwk2024/dwk2024/data/part-5/3-service-mesh-vi.md"},"allPages":{"edges":[{"node":{"id":"7e706a38-3828-5118-bdec-3705a319a1b0","frontmatter":{"path":"/faq-vi","title":"Câu hỏi thường gặp"}}},{"node":{"id":"5225f2a2-20f9-50ce-93ac-7b38f3105103","frontmatter":{"path":"/faq","title":"FAQ"}}},{"node":{"id":"e1ed6713-5992-5f7f-95a1-17efd97f57d8","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"04c5ddbd-7839-580f-82da-bc9fdbb49f84","frontmatter":{"path":"/known-problems-solutions-vi","title":"Các vấn đề bạn có thể gặp phải"}}},{"node":{"id":"3102d88f-7297-56fb-af03-27d1079fffd1","frontmatter":{"path":"/","title":"Trang chủ"}}},{"node":{"id":"c92ea568-3384-5ff8-8dfa-b9015597780d","frontmatter":{"path":"/known-problems-solutions","title":"Issues you may face"}}},{"node":{"id":"52d4cd1d-eb14-54f3-a18a-ef84b67c320d","frontmatter":{"path":"/index-en","title":"Homepage"}}},{"node":{"id":"5e6b6ee0-b381-53f0-b84c-af378792b131","frontmatter":{"path":"/registration-and-completion","title":"Registration and Completion"}}},{"node":{"id":"58688080-4aa8-54e6-8b8b-02de1c4f6410","frontmatter":{"path":"/unity-assignment","title":"Unity Assignment"}}},{"node":{"id":"d9c993b6-f6b4-59a1-b119-f3b7218eec6b","frontmatter":{"path":"/sanasto","title":"Sanasto"}}},{"node":{"id":"8a3ee5be-7557-5fcd-954b-2351e74cd585","frontmatter":{"path":"/part-0/1-intro-vi","title":"Giới thiệu khóa học"}}},{"node":{"id":"23082016-7bbd-5215-8485-4ffccbf3ea1a","frontmatter":{"path":"/part-0/1-intro","title":"Course Introduction"}}},{"node":{"id":"771eaa93-2ef2-5e0f-9e1e-55914c67c4ac","frontmatter":{"path":"/part-0","title":"Part 0"}}},{"node":{"id":"fe0342aa-a4c5-5b44-8591-71eb27f1a287","frontmatter":{"path":"/part-1/2-introduction-to-debugging-vi","title":"Giới thiệu về Debugging"}}},{"node":{"id":"1c236933-7ad5-5b61-8c07-07db3822d55a","frontmatter":{"path":"/part-1/2-introduction-to-debugging","title":"Introduction to Debugging"}}},{"node":{"id":"3c788edf-62db-5e86-9366-17b53eda9244","frontmatter":{"path":"/part-1/5-summary","title":"Summary"}}},{"node":{"id":"8ed3365b-b788-5806-8ec5-bec3cb0f94c8","frontmatter":{"path":"/part-1","title":"Part 1"}}},{"node":{"id":"7fc5c062-6b94-53ec-9aaa-adca66ce672e","frontmatter":{"path":"/part-1/5-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"46a4a0e4-d131-537d-aa72-5b6726163a7d","frontmatter":{"path":"/part-2/1-networking-between-pods-vi","title":"Kết nối mạng giữa các pod"}}},{"node":{"id":"fd467661-6b24-545f-904c-52f4a7ade6b7","frontmatter":{"path":"/part-2/1-networking-between-pods","title":"Networking between pods"}}},{"node":{"id":"56110eda-875d-5bd9-a400-5bd5a009df7f","frontmatter":{"path":"/part-2/5-monitoring-vi","title":"Giám sát"}}},{"node":{"id":"8f3387b0-ec6e-5a86-982a-e52780d911f9","frontmatter":{"path":"/part-2/5-monitoring","title":"Monitoring"}}},{"node":{"id":"06173ac4-c2f8-57df-8dc8-450b5c2bb695","frontmatter":{"path":"/part-2/6-summary","title":"Summary"}}},{"node":{"id":"79f1cddb-6995-51c2-bf98-2adc13de9b13","frontmatter":{"path":"/part-2/6-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"8c3d747d-4f87-5a46-99ac-dfd0af5a893b","frontmatter":{"path":"/part-2","title":"Part 2"}}},{"node":{"id":"8d9fd774-9dbe-5cca-8395-9226fcf82c4a","frontmatter":{"path":"/part-3/4-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"b98b2895-6c9d-5234-939d-2f547cbf8a06","frontmatter":{"path":"/part-3/4-summary","title":"Summary"}}},{"node":{"id":"29bec4f5-8a0b-580d-ac84-9dbbd1d7152e","frontmatter":{"path":"/part-3","title":"Part 3"}}},{"node":{"id":"4dd8302d-d170-5d38-8198-4d0947322bbc","frontmatter":{"path":"/part-4/4-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"0045695d-e541-5acc-b4b8-551023d01733","frontmatter":{"path":"/part-4/4-summary","title":"Summary"}}},{"node":{"id":"a917b24d-df2b-5199-ac98-cd0f7560c63f","frontmatter":{"path":"/part-4","title":"Part 4"}}},{"node":{"id":"eb339401-26c8-594c-98fd-2f30a95275cd","frontmatter":{"path":"/part-5/4-beyond-kubernetes-vi","title":"Vượt ra ngoài Kubernetes"}}},{"node":{"id":"2318c18f-86e6-5a4e-958a-d1c38f8615cd","frontmatter":{"path":"/part-5/4-beyond-kubernetes","title":"Beyond Kubernetes"}}},{"node":{"id":"781bd207-902e-59a2-a752-4958c2c93fb0","frontmatter":{"path":"/part-5/5-summary-vi","title":"Tóm tắt và kết thúc"}}},{"node":{"id":"1d8ff75c-065b-565d-9ceb-01b9a276ae7a","frontmatter":{"path":"/part-5/5-summary","title":"Summary and end"}}},{"node":{"id":"829fd216-f995-5a77-b201-bb971aec73b4","frontmatter":{"path":"/part-0/2-kubernetes-in-three-diagrams-vi","title":"Kubernetes qua ba sơ đồ"}}},{"node":{"id":"98132cca-4dc3-5942-a6f4-1da87bc81a23","frontmatter":{"path":"/part-0/2-kubernetes-in-three-diagrams","title":"Kubernetes in three diagrams"}}},{"node":{"id":"90b8e83a-9d55-550a-908a-316708ce7f8c","frontmatter":{"path":"/part-1/3-introduction-to-networking","title":"Introduction to Networking"}}},{"node":{"id":"8931bcb7-c40e-5d57-aa80-c4333972fbb8","frontmatter":{"path":"/part-1/3-introduction-to-networking-vi","title":"Giới thiệu về Mạng"}}},{"node":{"id":"4fe00c0a-bb17-5d4c-8202-750493a755c9","frontmatter":{"path":"/part-1/4-introduction-to-storage-vi","title":"Giới thiệu về Lưu trữ"}}},{"node":{"id":"6cc3be66-6091-58fc-bcbd-1f27f9473f85","frontmatter":{"path":"/part-1/4-introduction-to-storage","title":"Introduction to Storage"}}},{"node":{"id":"b53df746-c24f-57e3-a9f3-d6d621697689","frontmatter":{"path":"/part-2/2-organizing-a-cluster-vi","title":"Tổ chức một cụm"}}},{"node":{"id":"d5206d16-d2fe-51fd-8acd-d85ecf0be257","frontmatter":{"path":"/part-2/2-organizing-a-cluster","title":"Organizing a cluster"}}},{"node":{"id":"15be3d7c-b0b7-5bce-b3bf-8cec39d54630","frontmatter":{"path":"/part-2/3-configuring-applications-vi","title":"Cấu hình ứng dụng"}}},{"node":{"id":"e4534a9d-fb84-5d1f-83f0-35055feb0da7","frontmatter":{"path":"/part-2/3-configuring-applications","title":"Configuring applications"}}},{"node":{"id":"466aa711-527b-55a0-871b-13468e65d344","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs","title":"StatefulSets and Jobs"}}},{"node":{"id":"02389078-a12f-561a-8a54-fa99a6950b92","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs-vi","title":"StatefulSet và Job"}}},{"node":{"id":"bea18f34-dcdc-59b8-ba24-3011680a0c58","frontmatter":{"path":"/part-3/1-introduction-to-gke-vi","title":"Giới thiệu về Google Kubernetes Engine"}}},{"node":{"id":"84db9628-b3df-5ca1-9d3d-5924e02ae549","frontmatter":{"path":"/part-3/1-introduction-to-gke","title":"Introduction to Google Kubernetes Engine"}}},{"node":{"id":"0049e57f-0bc7-5689-9169-43848a972877","frontmatter":{"path":"/part-3/2-deployment-pipeline-vi","title":"Quy trình Triển khai (Deployment Pipeline)"}}},{"node":{"id":"61f18dc7-1abf-5c75-9b54-0cee11c76a40","frontmatter":{"path":"/part-3/2-deployment-pipeline","title":"Deployment Pipeline"}}},{"node":{"id":"7dfec8c7-8ccb-50da-949d-ebd1de395dc4","frontmatter":{"path":"/part-3/3-gke-features-vi","title":"Các tính năng của GKE"}}},{"node":{"id":"423cbc46-2dfa-57e6-9dc5-761a93729600","frontmatter":{"path":"/part-3/3-gke-features","title":"GKE features"}}},{"node":{"id":"6df9c7be-f930-5827-a39c-0c1698b23600","frontmatter":{"path":"/part-4/3-gitops-vi","title":"Triển khai GitOps"}}},{"node":{"id":"46f9ce68-5ccd-5787-bd59-03852ad6fdcb","frontmatter":{"path":"/part-4/3-gitops","title":"GitOps"}}},{"node":{"id":"31927db3-2182-55c7-b680-663754461d14","frontmatter":{"path":"/part-5/1-kubernetes-internals","title":"Kubernetes Internals"}}},{"node":{"id":"68c64f9f-c9a5-544b-bafb-b061665cacd0","frontmatter":{"path":"/part-5/3-service-mesh-vi","title":"Service Mesh"}}},{"node":{"id":"da1f8069-17bc-5c8e-9310-117bcedf5acf","frontmatter":{"path":"/part-5/2-custom-resource-definitions-vi","title":"Định nghĩa Tài nguyên Tùy chỉnh (Custom Resource Definitions)"}}},{"node":{"id":"0e981ec1-99e0-5005-ba9f-4f626a81b7ce","frontmatter":{"path":"/part-5/1-kubernetes-internals-vi","title":"Bên trong Kubernetes"}}},{"node":{"id":"ccefb04a-5790-57f6-869b-d255b2203667","frontmatter":{"path":"/part-5/2-custom-resource-definitions","title":"Custom Resource Definitions"}}},{"node":{"id":"20ceed4e-761d-54d4-9acf-2669eac533c6","frontmatter":{"path":"/part-5/3-service-mesh","title":"Service Mesh"}}},{"node":{"id":"306c87f3-9adb-5d8b-a3ce-072f8e6cfa43","frontmatter":{"path":"/part-5","title":"Part 5"}}},{"node":{"id":"97ead58a-8493-5fdd-808e-d4a56de573b0","frontmatter":{"path":"/part-1/1-first-deploy","title":"First Deploy"}}},{"node":{"id":"c179c521-bb62-52bd-808b-d4869df5302a","frontmatter":{"path":"/part-4/1-update-strategies-and-prometheus-vi","title":"Chiến lược cập nhật và Prometheus"}}},{"node":{"id":"898b0354-f1a2-5664-97de-d84b16018395","frontmatter":{"path":"/part-4/1-update-strategies-and-prometheus","title":"Update Strategies and Prometheus"}}},{"node":{"id":"6f4f18ce-5aa9-5bb5-9d74-0a631a78e6b3","frontmatter":{"path":"/part-4/2-messaging-systems-vi","title":"Hệ thống nhắn tin"}}},{"node":{"id":"6981a9d7-619d-51a9-9490-74bc77c0f55b","frontmatter":{"path":"/part-4/2-messaging-systems","title":"Messaging Systems"}}},{"node":{"id":"a17c4c44-7396-543f-b6b4-7adf57808aa8","frontmatter":{"path":"/part-1/1-first-deploy-vi","title":"Triển khai đầu tiên"}}}]}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}