{"componentChunkName":"component---src-templates-course-content-template-js","path":"/part-4/3-gitops","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"Learning Objectives"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After this section, you can"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"compare GitOps to other deployment methods"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"compare traditional push deployment to a pull deployment"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"implement GitOps in your Kubernetes cluster"}]},{"type":"text","value":"\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"An average simple deployment pipeline we have used and learned about is something like this."}]},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Developer runs git push with modified code. E.g. to GitHub"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"This triggers a CI/CD service to start running. E.g. to GitHub actions"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"CI/CD service runs tests, builds an image, pushes the image to a registry and deploys the new image. E.g. to Kubernetes"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This is called a push deployment. It is a descriptive name as everything is pushed forward by the previous step. There are some challenges with the push approach. For example, if we have a Kubernetes cluster that is unavailable for external connections i.e. the cluster on your local machine or any cluster we don't want to give outsiders access to. In those cases having CI/CD push the update to the cluster is not possible."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In a pull configuration the setup is reversed. We can have the cluster, running anywhere, "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"pull"}]},{"type":"text","value":" the new image and deploy it automatically. The new image will still be tested and built by the CI/CD. We simply relieve the CI/CD of the burden of deployment and move it to another system that is doing the pulling."}]},{"type":"element","tagName":"text-box","properties":{"name":"Watchtower","variant":"hint"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you completed DevOps with Docker you may have heard about "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/containrrr/watchtower","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"watchtower"}]},{"type":"text","value":" which enabled us to change the last pushes of a deployment pipeline to pulls when running services with docker-compose."}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"GitOps is all about this reversal and promotes good practices for the operations side of things. This is achieved by having the state of the cluster be in a git repository. So besides handling the application deployment it will handle all changes to the cluster. This will require some additional configuration and rethinking past the tradition of server configuration. But when we get there GitOps will be the final nail in the coffin of imperative cluster management."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"ArgoCD"}]},{"type":"text","value":" is the tool of choice. At the end our workflow should look like this:"}]},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Developer runs git push with modified code or configurations."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"CI/CD service (GitHub Actions in our case) starts running."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"CI/CD service builds and pushes new image "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"and"}]},{"type":"text","value":" commits edit to the \"release\" branch (main in our case)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ArgoCD will take the state described in the release branch and set it as the state of our cluster."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let us start by installing ArgoCD by following the "},{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/getting_started/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Getting started"}]},{"type":"text","value":" of the docs:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"kubectl create namespace argocd\nkubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now ArgoCD is up and running in our cluster. We still need to open access to it. There are several "},{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/getting_started/#3-access-the-argo-cd-api-server","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"options"}]},{"type":"text","value":". We shall use the LoadBalancer. So we'll give the command"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"kubectl patch svc argocd-server -n argocd -p "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'{\"spec\": {\"type\": \"LoadBalancer\"}}'"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After a short wait, the cluster has provided us with an external IP:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"$ kubectl get svc -n argocd\nNAME               TYPE           CLUSTER-IP    EXTERNAL-IP   PORT"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"S"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"                      AGE\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":".."}]},{"type":"text","value":".\nargocd-server      LoadBalancer   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.7"}]},{"type":"text","value":".5.82     "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"34.88"}]},{"type":"text","value":".152.2   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]},{"type":"text","value":":32029/TCP,443:30574/TCP   17min"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The initial password for the "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"admin"}]},{"type":"text","value":" account is auto-generated and stored as clear text in the field password in a secret named "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"argocd-initial-admin-secret"}]},{"type":"text","value":" in your Argo CD installation namespace. So we get it by base64 decoding the value that we get with the command"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"kubectl get -n argocd secrets argocd-initial-admin-secret -o yaml"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can now login:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/9960d78be7b36c3c387923af1cf4accc/29114/argo2.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 62.60869565217391%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB7UlEQVQoz3WQyW/TUBDGfQEEBygHDiBo1aKyFhVIN5VWUA4oJxD0xHbkX0O9UJWiilCFCLWBInDI5sRbnl/sZzveEjuLRIlrYBIjX3Ct32H0zftmvjHFIcwyLFdisIAszSKapek20Gz1ur1+Z8Cvdjceaj75JJFcHbk6l3z+quW1O91eEAS+f+AfDOj3/b7v//4T/1EXE8tjsytHLly7+/jF9s7XtXfbW5ns67epN+8zm+kdKNZTmZ/7+/D0/xHU+VvLk4sPTkxMr6y+9Do9YliybqiGbbttx22bTU+FfEEQv3l87j5sPjY2tfTomeZ4xHZls0ksF2pABcXxJN3m6zpf15BqDnU3hBqduXd2+s7x8RuLD5/WNAvpdgjUQ2xeMXIs+sHhPIdpVqpgLepSZ6YWzt1cOjl5G8yRM0JqOGVEKogwiJREmcVqSVSiLgW2kcszR0evH2au1jXYCZkheVGowywQ/5lPXUqcvjILNx9mBoqinGMlGJHnMaQNxXgz3BnaaqopDgED7IfkAjGhJWoWiPAgfrOoWpzcyHNor1DdK7IFXmKQkmNrRQHTFeFbmaerIq804s0CMeBduaYUeMxI5MNnem3rI7CR3oXfBjrMqkgkNvbgKmw0Q2Sr9YkubaSzm5kvqex3yYhazl/MZlHVn92WAAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/9960d78be7b36c3c387923af1cf4accc/a0b58/argo2.webp 230w","/static/9960d78be7b36c3c387923af1cf4accc/bc10c/argo2.webp 460w","/static/9960d78be7b36c3c387923af1cf4accc/966d8/argo2.webp 920w","/static/9960d78be7b36c3c387923af1cf4accc/445df/argo2.webp 1380w","/static/9960d78be7b36c3c387923af1cf4accc/78de1/argo2.webp 1840w","/static/9960d78be7b36c3c387923af1cf4accc/882b9/argo2.webp 1920w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/9960d78be7b36c3c387923af1cf4accc/81c8e/argo2.png 230w","/static/9960d78be7b36c3c387923af1cf4accc/08a84/argo2.png 460w","/static/9960d78be7b36c3c387923af1cf4accc/c0255/argo2.png 920w","/static/9960d78be7b36c3c387923af1cf4accc/b1001/argo2.png 1380w","/static/9960d78be7b36c3c387923af1cf4accc/161ec/argo2.png 1840w","/static/9960d78be7b36c3c387923af1cf4accc/29114/argo2.png 1920w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/9960d78be7b36c3c387923af1cf4accc/c0255/argo2.png","alt":"argo2","title":"argo2","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let us now deploy the simple app in "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/mluukkai/dwk-app1","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://github.com/mluukkai/dwk-app1"}]},{"type":"text","value":" using ArgoCD. We start by clicking "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"New app"}]},{"type":"text","value":" and fill the form that opens:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/5725dd9e9f90f4f0bdc37eb1e7024813/332b4/argo3.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 39.130434782608695%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAhUlEQVQY052RwQ6CMAyG9/4vxJmLwYuEBGLUePAqMVkGKyu0qx0arw6+/Lf+X5qmZkLEeVmI/kZbUaTurkV5qOrWDt6MAGpLBjGqK5f7ozyemvPNeTDWuoAzc5rk5McAkyFiTmouWl8Ndio/+1cIKNtJctzHRx497Nis+lfWH+jRm0LrzW/UEtdBMoJwxAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/5725dd9e9f90f4f0bdc37eb1e7024813/a0b58/argo3.webp 230w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/bc10c/argo3.webp 460w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/966d8/argo3.webp 920w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/445df/argo3.webp 1380w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/ffcc2/argo3.webp 1826w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/5725dd9e9f90f4f0bdc37eb1e7024813/81c8e/argo3.png 230w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/08a84/argo3.png 460w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/c0255/argo3.png 920w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/b1001/argo3.png 1380w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/332b4/argo3.png 1826w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/5725dd9e9f90f4f0bdc37eb1e7024813/c0255/argo3.png","alt":"argo3","title":"argo3","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"At the start, we decided to have a "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"manual sync policy"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/048907e8118485b948585dd05b0b3741/84a78/argo4.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 82.17391304347825%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA4UlEQVQoz51Syw6DMAzj//9wdw47MEZL00eSlrkwJHZgo7OMBFLdGMddYvEhas5LI1i0g5jIgyLCzAnfomeCUpa8j6nimBhKY2dHZOd5MpZ8KCeAEneXg1j8evqi27wCL0mkiyxudqqacfHOL5NDiMxSxSz1n3N7WntgSOHW5/tYah5XgbPVdoLfyWk/HG3/ZIEYti0FEgFdiE20PnRbSagl8I+SJMSn+k9gKMlzMuNzQj3woGHLeXLYS4xp8/ieXAupejnnz8nDY+S1zzXE3zyuaq1LacSyrco4ss7/QeP8C3XusNVNcFqcAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/048907e8118485b948585dd05b0b3741/a0b58/argo4.webp 230w","/static/048907e8118485b948585dd05b0b3741/bc10c/argo4.webp 460w","/static/048907e8118485b948585dd05b0b3741/966d8/argo4.webp 920w","/static/048907e8118485b948585dd05b0b3741/445df/argo4.webp 1380w","/static/048907e8118485b948585dd05b0b3741/2c1a7/argo4.webp 1832w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/048907e8118485b948585dd05b0b3741/81c8e/argo4.png 230w","/static/048907e8118485b948585dd05b0b3741/08a84/argo4.png 460w","/static/048907e8118485b948585dd05b0b3741/c0255/argo4.png 920w","/static/048907e8118485b948585dd05b0b3741/b1001/argo4.png 1380w","/static/048907e8118485b948585dd05b0b3741/84a78/argo4.png 1832w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/048907e8118485b948585dd05b0b3741/c0255/argo4.png","alt":"argo4","title":"argo4","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Note that since the definition (in our case file "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"kustomization.yaml"}]},{"type":"text","value":") is in the repository root, we have defined the "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"path"}]},{"type":"text","value":" to having the value ., that is, the character "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"period"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The app is created but it is missing and not in sync, since we selected the manual sync policy:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/42257e4e900ba4b6ce44a953ffebf40e/b8bf8/argo5.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 55.21739130434783%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB6UlEQVQoz22RbW/SUBTH+wU2TcoAs+FeiBBXnkqDK1AYc5ku8Y3fUd/NqDPZ5sPQ0CVEETInkbi5YYZEGJXC2tLb3nvLPNsSgujJPyc3N/md/3lgorkHXHaNyz2cDsTn+Gy1dqDrBiZkOBw6jnOVKb14nP8TTPbe6kJqJZhZm74dvynknm3nn7zYfrkjr2/lHz/f2nhbWN/cgZ+NN4WrAsOxYFh/dDYmBVL33aGkOyRWD44bbeXopHn4o1FvtlqK2mwrP1uduqJi6kw6+3jJJyzNJ5avBQQXl9z/+gVZVk8zBsjClNqEWphARtSBbNq20tdHYmKrjwD2hJNTfp7lUqVKoacq7dPfMLaN8YQVVPze7IzEAOmNSrN8xhMWL+FdhPQz3Tx37H5P0bXumaZBFUopwNDF8S9lJOZ6UJjhoGGRvZNwcelSRbYtQ+n2Mba6qqobmqYbumEOBiYsaxL2RhZvJURPRIJtzYSkj+UCJRZMDBcil27jYWH8F3wjKs3xOXCe8sfcYYBlSlCvrwEMnnAPQijMD/pP22w46U2vzMeXoH93JFPe2z3ttN8Vy9VvR5Vqbb92CMtHyDJNBLBNyITzYjAt+oRlduGuK5Qq7xXrjZOnr96/lj/ki5/k0mcbTCmYX0g30Tj8B75h5RCeBB0BAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/42257e4e900ba4b6ce44a953ffebf40e/a0b58/argo5.webp 230w","/static/42257e4e900ba4b6ce44a953ffebf40e/bc10c/argo5.webp 460w","/static/42257e4e900ba4b6ce44a953ffebf40e/966d8/argo5.webp 920w","/static/42257e4e900ba4b6ce44a953ffebf40e/445df/argo5.webp 1380w","/static/42257e4e900ba4b6ce44a953ffebf40e/eaa3b/argo5.webp 1728w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/42257e4e900ba4b6ce44a953ffebf40e/81c8e/argo5.png 230w","/static/42257e4e900ba4b6ce44a953ffebf40e/08a84/argo5.png 460w","/static/42257e4e900ba4b6ce44a953ffebf40e/c0255/argo5.png 920w","/static/42257e4e900ba4b6ce44a953ffebf40e/b1001/argo5.png 1380w","/static/42257e4e900ba4b6ce44a953ffebf40e/b8bf8/argo5.png 1728w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/42257e4e900ba4b6ce44a953ffebf40e/c0255/argo5.png","alt":"argo5","title":"argo5","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let us sync it and go to the app page:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/6cd87037fd1633913045859e928ab140/b918a/argo6.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 33.04347826086957%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAABYlAAAWJQFJUiTwAAABFElEQVQY022P2W7EIAxF8/8fV1WV2ofJ2ixsNhhCyD5K3Zn2qUXnARtzOWSALi5Lg4DWjcc6Hdt1XbTOlUe/pLgu53ne7/frv5Wt+74dhx+j0IA+jGnej3PeNu2oVwbJhykt68bNv2RunGhM2vpGYSWgUrYU8ITLRtlK4k8pf3kc8SYrBsh7wxSD4YlaQi3gU9tWOy5bbTkXaPRx7oF4mJuFxuIRlwnr7ZiYDqiW2KOTRDEtyvlKmFqweXA+hmnhoOf79a2ti64UJuusxzBpF55KHbgByVBUFDirHLQNMcQU0yzR5wJyhc1rXhhbUmBtc+s1w0r8vdZYYQl9bDV+XxaG1SRSwxYSbsJ8aHzX8NKKt0F/AUPAg10f8YnVAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/6cd87037fd1633913045859e928ab140/a0b58/argo6.webp 230w","/static/6cd87037fd1633913045859e928ab140/bc10c/argo6.webp 460w","/static/6cd87037fd1633913045859e928ab140/966d8/argo6.webp 920w","/static/6cd87037fd1633913045859e928ab140/445df/argo6.webp 1380w","/static/6cd87037fd1633913045859e928ab140/78de1/argo6.webp 1840w","/static/6cd87037fd1633913045859e928ab140/05d2a/argo6.webp 2780w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/6cd87037fd1633913045859e928ab140/81c8e/argo6.png 230w","/static/6cd87037fd1633913045859e928ab140/08a84/argo6.png 460w","/static/6cd87037fd1633913045859e928ab140/c0255/argo6.png 920w","/static/6cd87037fd1633913045859e928ab140/b1001/argo6.png 1380w","/static/6cd87037fd1633913045859e928ab140/161ec/argo6.png 1840w","/static/6cd87037fd1633913045859e928ab140/b918a/argo6.png 2780w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/6cd87037fd1633913045859e928ab140/c0255/argo6.png","alt":"argo6","title":"argo6","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Something seems to be wrong, the pod has a "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"broken heart"}]},{"type":"text","value":" symbol. We could now start our usual debugging process starting with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl get po"}]},{"type":"text","value":". We see the same info from ArgoCD by clicking the pod:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/8137a058e3e08723c19a069a11382d75/cb1ac/argo7.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 20.869565217391305%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAcUlEQVQI13VOWw6AIAzj/oc1ytgLNrRqTPix6cearI/i7qp2LoDctl1Ucc8H5w9KRFBjc1/MyqIiclTaj+reI7L3AcaHzLzNY4xKxCz5lszpvefTJmp3EAuIFFA+qWZ4LuiEWJcNVUIe9jBTa8j6m30BDr3q3RWpfRUAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/8137a058e3e08723c19a069a11382d75/a0b58/argo7.webp 230w","/static/8137a058e3e08723c19a069a11382d75/bc10c/argo7.webp 460w","/static/8137a058e3e08723c19a069a11382d75/966d8/argo7.webp 920w","/static/8137a058e3e08723c19a069a11382d75/445df/argo7.webp 1380w","/static/8137a058e3e08723c19a069a11382d75/78de1/argo7.webp 1840w","/static/8137a058e3e08723c19a069a11382d75/cb61f/argo7.webp 1936w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/8137a058e3e08723c19a069a11382d75/81c8e/argo7.png 230w","/static/8137a058e3e08723c19a069a11382d75/08a84/argo7.png 460w","/static/8137a058e3e08723c19a069a11382d75/c0255/argo7.png 920w","/static/8137a058e3e08723c19a069a11382d75/b1001/argo7.png 1380w","/static/8137a058e3e08723c19a069a11382d75/161ec/argo7.png 1840w","/static/8137a058e3e08723c19a069a11382d75/cb1ac/argo7.png 1936w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/8137a058e3e08723c19a069a11382d75/c0255/argo7.png","alt":"argo7","title":"argo7","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ok, we have specified an image that does not exist. Let us fix it in GitHub by changing "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"kustomization.yaml"}]},{"type":"text","value":" as follows:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" kustomize.config.k8s.io/v1beta1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Kustomization\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" manifests/deployment.yaml\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" manifests/service.yaml\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"images"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" PROJECT/IMAGE\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"newName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" mluukkai/dwk1"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When we sync the changes in ArgoCD, a new healthy pod is started and our app is up and running!"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can check the external IP either from command line with "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"kubectl"}]},{"type":"text","value":" or by clicking the service:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/6c86f/argo8.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 57.391304347826086%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/ElEQVQoz4VQAW6DMAzk/3/bCyZ1WrcJOgYmiePESZzOQKm6ibanEyImd4ev6cF+D9D149fpR/kBAEgWCZx/ymZCOoE5fLbHrgcMYPHYD+9gB4vjMzZq0CN1xrXGTRQxsEEygT0nfX/MxvogIjml8w1yzsx/Jru4iCOzHqpCnyouhZljLrIc73EWFxGHWEpZR4qU82TsSEG2kLtiTR4ng97XumafU0qDw6h2Imqq7nUPFzF6ul1S78cYPQVK7ENw6FfT3Z1rXArbkmvOxTjkyHWw4mPdPu0nw/zbdN1Z2xoR41tbX17lcWHqoQ0l7bbWlbqkFl6Wtmdu83/8BQAWgkrmLrCcAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/a0b58/argo8.webp 230w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/bc10c/argo8.webp 460w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/966d8/argo8.webp 920w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/445df/argo8.webp 1380w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/9d85b/argo8.webp 1720w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/81c8e/argo8.png 230w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/08a84/argo8.png 460w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/c0255/argo8.png 920w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/b1001/argo8.png 1380w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/6c86f/argo8.png 1720w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/c0255/argo8.png","alt":"argo8","title":"argo8","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let us now change the sync mode to "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"automatic"}]},{"type":"text","value":" by clicking the "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Details"}]},{"type":"text","value":" from the app page in ArgoCD."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now all the configuration changes that we make to GitHub should be automatically applied by ArgoCD. Let us scale up the deployment to have 5 pods:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" apps/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Deployment\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" dwk1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"app"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"dep\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"replicas"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"5"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"matchLabels"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" dwk1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"app\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"template"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"..."}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After a small wait (the default sync frequency of ArgoCD is 180 seconds), app gets synchronized and 5 pods are up and running:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/7a969076cce54007f1e967c1b9c6a1d6/77085/argo9.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 45.65217391304348%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAABYlAAAWJQFJUiTwAAABWUlEQVQoz3VQy1LDMAzM/38Xd2BCSYc8CKkfsSXLTuw2DWkblHJghgHNHjQrrbRSJrwbYlKjpxCO12W6XdZ1NccoY0jLPF8vN47178jmy/K5LCElcDSkNM0zs3E6KUQ/jmNMXF7/E/sxpdOUjpMGEpYkeOVC74K85xswSPSCefTaBY13bInP2h4PlgRQq7FWUCmopS2FqTVWEt65apww1NPYWfcmbdFjoWEnzd66rGGNhFLaagPwIEnepxRP5wP4RgHwNWxtOvPCN2FyR/sx5hZ3FLKH58IMXD6HdGIXtbCNBnZRCVseDLvoepZHvk6B38TWvVLIe9ix7X2rPnonrW+4uzMd+wRnKfjxyC4aCXwRq9Xd/CY2uEN6PGhOslY73vYNbm0VdMbxnziphflQyH+iEJXFzmAp7AtQ4YdH2efAN0v4BZ5SbbN+mHeF33wpIUcqwvCkTQ70BazU8IjWLkqtAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/7a969076cce54007f1e967c1b9c6a1d6/a0b58/argo9.webp 230w","/static/7a969076cce54007f1e967c1b9c6a1d6/bc10c/argo9.webp 460w","/static/7a969076cce54007f1e967c1b9c6a1d6/966d8/argo9.webp 920w","/static/7a969076cce54007f1e967c1b9c6a1d6/445df/argo9.webp 1380w","/static/7a969076cce54007f1e967c1b9c6a1d6/78de1/argo9.webp 1840w","/static/7a969076cce54007f1e967c1b9c6a1d6/96199/argo9.webp 2764w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/7a969076cce54007f1e967c1b9c6a1d6/81c8e/argo9.png 230w","/static/7a969076cce54007f1e967c1b9c6a1d6/08a84/argo9.png 460w","/static/7a969076cce54007f1e967c1b9c6a1d6/c0255/argo9.png 920w","/static/7a969076cce54007f1e967c1b9c6a1d6/b1001/argo9.png 1380w","/static/7a969076cce54007f1e967c1b9c6a1d6/161ec/argo9.png 1840w","/static/7a969076cce54007f1e967c1b9c6a1d6/77085/argo9.png 2764w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/7a969076cce54007f1e967c1b9c6a1d6/c0255/argo9.png","alt":"argo9","title":"argo9","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Besides services, deployments and pods, the app configuration tree shows also some other objects. We see that there is a\n"},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"ReplicaSet"}]},{"type":"text","value":" (in figure "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"rs"}]},{"type":"text","value":") in between deployment and the pods. A ReplicaSet is a Kubernetes object that ensures there is always a stable set of running pods for a specific workload. The ReplicaSet configuration defines a number of identical pods required, and if a pod is evicted or fails, creates more pods to compensate for the loss. Users do not usually define ReplicaSets directly, instead Deployments are used. A Deployment then creates a ReplicaSet that takes care of running the pod replicas."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The changes in app Kubernetes configurations that we make to GitHub are now nicely synched to the cluster. How about the changes in the app?"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In order to deploy a new app version, we should change the image that is used in the deployment. Currently the image is defined in the file "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"kustomization.yaml"}]},{"type":"text","value":":"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" kustomize.config.k8s.io/v1beta1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Kustomization\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" manifests/deployment.yaml\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" manifests/service.yaml\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"images"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" PROJECT/IMAGE\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"newName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" mluukkai/dwk1"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So to deploy a new the app, we should:"}]},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"create a new image with possibly a new tag"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"change the kustomization.yaml to use the new image"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"push changes to GitHub"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Surely this could be done manually but that is not enough for us. Let us now define a GitHub Actions workflow that does all these steps."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The first step is already familiar to us from "},{"type":"element","tagName":"a","properties":{"href":"/part-3/2-deployment-pipeline"},"children":[{"type":"text","value":"part 3"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The step 2 can be done with the command "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"kustomize edit"}]},{"type":"text","value":":"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"text","value":"$ kustomize edit set image PROJECT/IMAGE=node"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"20"}]},{"type":"text","value":"\n$ cat kustomization.yaml\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" kustomize.config.k8s.io/v1beta1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Kustomization\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" manifests/deployment.yaml\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" manifests/service.yaml\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"images"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" PROJECT/IMAGE\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"newName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" node\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"newTag"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"20\""}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As we see, the command "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"changes"}]},{"type":"text","value":" the file "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"kustomization.yaml"}]},{"type":"text","value":". So all that is left is to commit the file to the repository. Fortunately there is a ready made GitHub Action "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/EndBug/add-and-commit","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"add-and-commit"}]},{"type":"text","value":" for that!"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The workflow looks the following:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Build and publish application\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"push"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"jobs"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"build-publish"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Build"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" Push"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" Release\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"runs-on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ubuntu"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"latest\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"steps"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Checkout\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"uses"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" actions/checkout@v4\n\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Login to Docker Hub\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"uses"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" docker/login"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"action@v3\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"with"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"username"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" $"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" secrets.DOCKERHUB_USERNAME "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"password"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" $"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" secrets.DOCKERHUB_TOKEN "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# tag image with the GitHub SHA to get a unique tag"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Build and publish backend\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"run"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"|"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"\n          docker build "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"tag \"mluukkai/dwk1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"$GITHUB_SHA\" .\n          docker push \"mluukkai/dwk1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"$GITHUB_SHA\"\n\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Set up Kustomize\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"uses"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" imranismail/setup"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"kustomize@v2\n\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Use right image\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"run"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" kustomize edit set image PROJECT/IMAGE=mluukkai/dwk1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"$GITHUB_SHA\n\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" commit kustomization.yaml to GitHub\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"uses"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" EndBug/add"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"and"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"commit@v9\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"with"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"add"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'kustomization.yaml'"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"message"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" New version released $"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" github.sha "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There is still one more to do, from the repository settings we must give the GitHub Actions permission to write to our repository:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/099030fe16625510838386413508f6e5/9efb3/gha-perm.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 38.260869565217384%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABYlAAAWJQFJUiTwAAABD0lEQVQY042QaY6EIBSEvf/p5gC27QIogkALGmWdsk0m/pzKBym29ypUhAk2LWyUmPth6oaJTUrpbbWndf7JepstaLNzYU6lqgilFEvxMVLK2DhhYN73HSchRB+C9yEGD+BSvLz3JzarAoVYtI3GtXQkA2m7ruv7fhgmzhkdUYsQ1nPzHk1NlpqaF4XX27ZVJeekbf5pQi8brl51/W67pmkJZeazGvNR2rht348Qc7kCpgt46Nu5lK8vzjkEnmc5C8m5oGwcJw5Wa4/jOE9w5nzf/XuMdUKAjD5CiPlC4tOkXICQEiwK0lobjTzrepeoykN8luh1XV0UEEKiFpbYuP7soUfnO3nO1m0p5fJv/QLGgMjXxrD94AAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/099030fe16625510838386413508f6e5/a0b58/gha-perm.webp 230w","/static/099030fe16625510838386413508f6e5/bc10c/gha-perm.webp 460w","/static/099030fe16625510838386413508f6e5/966d8/gha-perm.webp 920w","/static/099030fe16625510838386413508f6e5/445df/gha-perm.webp 1380w","/static/099030fe16625510838386413508f6e5/78de1/gha-perm.webp 1840w","/static/099030fe16625510838386413508f6e5/eb397/gha-perm.webp 1894w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/099030fe16625510838386413508f6e5/81c8e/gha-perm.png 230w","/static/099030fe16625510838386413508f6e5/08a84/gha-perm.png 460w","/static/099030fe16625510838386413508f6e5/c0255/gha-perm.png 920w","/static/099030fe16625510838386413508f6e5/b1001/gha-perm.png 1380w","/static/099030fe16625510838386413508f6e5/161ec/gha-perm.png 1840w","/static/099030fe16625510838386413508f6e5/9efb3/gha-perm.png 1894w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/099030fe16625510838386413508f6e5/c0255/gha-perm.png","alt":"gha perm","title":"gha perm","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We are now set, all changes to configurations and to the app code are now deployed automatically by ArcoCD with the help of our GitHub Action workflow, so nice!"}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 4.07: GitOps the Project"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"  Move the "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Ping-pong application"}]},{"type":"text","value":" to use GitOps so that when you commit to the repository, the application is automatically updated."}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If an app has many environments such as production, staging and testing, a straightforward way of defining the environments contains lots of copy-paste. When Kustomize is used, the "},{"type":"element","tagName":"a","properties":{"href":"https://kubectl.docs.kubernetes.io/guides/example/multi_base/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"recommended"}]},{"type":"text","value":" way is to define a common "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"base"}]},{"type":"text","value":" for all the environments and then environment specific overlays where the differing parts are defined."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let us look at a simple example. We will create a directory structure that looks like the following:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":".\n├── base\n│   ├── deployment.yaml\n│   └── kustomization.yaml\n└── overlays\n    ├── prod\n    │   ├── deployment.yaml\n    │   └── kustomization.yaml\n    └── staging\n        └── kustomization.yaml"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"base/deployment.yaml"}]},{"type":"text","value":" is as follows"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" apps/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Deployment\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" myapp"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"dep\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"replicas"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"matchLabels"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" myapp\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"template"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"labels"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" myapp\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"containers"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" myapp\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" PROJECT/IMAGE"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"base/kustomization.yaml"}]},{"type":"text","value":" is simple:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" deployment.yaml"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The production environment refines the base by changing the replica count to 3. The "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"overlays/prod/deployment.yaml"}]},{"type":"text","value":" looks like this:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" apps/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Deployment\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" dep\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"replicas"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So only parts that are different are defined."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"overlays/prod/kustomization.yaml"}]},{"type":"text","value":" looks like following:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" ./../../base\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"patches"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"path"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" deployment.yaml\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"namePrefix"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" prod"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"images"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" PROJECT/IMAGE\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"newName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" nginx"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"1.25"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"bookworm"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So it refers to the base and "},{"type":"element","tagName":"a","properties":{"href":"https://kubectl.docs.kubernetes.io/references/kustomize/kustomization/patches/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"patches"}]},{"type":"text","value":" that with the above deployment that sets the number of replicas to 3."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"overlays/staging/kustomization.yaml"}]},{"type":"text","value":" just sets the image:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" ./../../base\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"namePrefix"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" staging"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"images"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" PROJECT/IMAGE\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"newName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" nginx"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"1.25.5"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"alpine"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now the production and staging can be deployed using ArgoCD by pointing to the corresponding overlay directories."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We have so far used the ArgoCD UI for defining applications. There are also other options. One could "},{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/getting_started/#2-download-argo-cd-cli","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"install"}]},{"type":"text","value":" and use "},{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/getting_started/#creating-apps-via-cli","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Argo CLI"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Yet another option is to use "},{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/operator-manual/declarative-setup/#declarative-setup","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"declarative"}]},{"type":"text","value":" approach and do the definition with "},{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/operator-manual/declarative-setup/#applications","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Application"}]},{"type":"text","value":" Custom resource definition:"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For the production version of our app the definition looks like this:"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"application.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" argoproj.io/v1alpha1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Application\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" myapp"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"production\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"namespace"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" argocd\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"project"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" default\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"source"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"repoURL"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" https"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"//github.com/mluukkai/gitopstest\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"path"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" overlays/prod\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"targetRevision"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" HEAD\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"destination"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"server"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" https"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"//kubernetes.default.svc\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"namespace"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" default\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"syncPolicy"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"automated"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"prune"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean","important"]},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selfHeal"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean","important"]},"children":[{"type":"text","value":"true"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The application is then set up to ArgoCD by applying the definition:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"kubectl apply -n argocd -f application.yaml"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"With GitOps we achieve the following:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Better security"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Nobody needs access to the cluster, not even CI/CD services. No need to share access to the cluster with collaborators; they will commit changes like everyone else."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Better transparency"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Everything is declared in the GitHub repository. When a new person joins the team, he/she can check the repository; no need to pass ancient knowledge or hidden techniques as there are none."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Better traceability"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"All changes to the cluster are version controlled. You will know exactly what was the state of the cluster and how it was changed and by whom."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Risk reduction"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"If something breaks simply revert the cluster to a working commit. "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"git revert"}]},{"type":"text","value":" and the whole cluster is in a previous state."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Portability"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Want to change to a new provider? Spin up a cluster and point it to the same repository - your cluster is now there."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There are a few options for the GitOps setup. What we used here was having the configuration for the application in the same repository as the application itself. Another option is to have the configuration separate from the source code. ArgoCD lists many convincing arguments that the use of separate repos is a "},{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/user-guide/best_practices/#separating-config-vs-source-code-repositories","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"best practice"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 4.08: GitOps the Project"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"  Move the Project to use GitOps."}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Create two separate environments, "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"production"}]},{"type":"text","value":" and "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"staging"}]},{"type":"text","value":" that are in their own namespaces"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Each commit to the main branch should result in deployment to the staging environment"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Each "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"tagged"}]},{"type":"text","value":" commit results in deployment to the production environment"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"In staging the broadcaster just logs all the messages, it does not forward those to any external service"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"In staging database is not backed up"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"You may assume that "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"secrets"}]},{"type":"text","value":" are readily applied outside of the ArgoCD"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Bonus: use different repositories for the code and configurations"}]},{"type":"text","value":"\n"}]}]}]},"html":"<div><text-box variant='learningObjectives' name='Learning Objectives'><p>After this section, you can</p><ul>\n<li>compare GitOps to other deployment methods</li>\n<li>compare traditional push deployment to a pull deployment</li>\n<li>implement GitOps in your Kubernetes cluster</li>\n</ul></text-box><p>An average simple deployment pipeline we have used and learned about is something like this.</p><ol>\n<li>Developer runs git push with modified code. E.g. to GitHub</li>\n<li>This triggers a CI/CD service to start running. E.g. to GitHub actions</li>\n<li>CI/CD service runs tests, builds an image, pushes the image to a registry and deploys the new image. E.g. to Kubernetes</li>\n</ol><p>This is called a push deployment. It is a descriptive name as everything is pushed forward by the previous step. There are some challenges with the push approach. For example, if we have a Kubernetes cluster that is unavailable for external connections i.e. the cluster on your local machine or any cluster we don't want to give outsiders access to. In those cases having CI/CD push the update to the cluster is not possible.</p><p>In a pull configuration the setup is reversed. We can have the cluster, running anywhere, <strong>pull</strong> the new image and deploy it automatically. The new image will still be tested and built by the CI/CD. We simply relieve the CI/CD of the burden of deployment and move it to another system that is doing the pulling.</p><text-box name=\"Watchtower\" variant=\"hint\"><p>If you completed DevOps with Docker you may have heard about <a href=\"https://github.com/containrrr/watchtower\" target=\"_blank\" rel=\"noopener noreferrer\">watchtower</a> which enabled us to change the last pushes of a deployment pipeline to pulls when running services with docker-compose.</p></text-box><p>GitOps is all about this reversal and promotes good practices for the operations side of things. This is achieved by having the state of the cluster be in a git repository. So besides handling the application deployment it will handle all changes to the cluster. This will require some additional configuration and rethinking past the tradition of server configuration. But when we get there GitOps will be the final nail in the coffin of imperative cluster management.</p><p><a href=\"https://argo-cd.readthedocs.io/en/stable/\" target=\"_blank\" rel=\"noopener noreferrer\">ArgoCD</a> is the tool of choice. At the end our workflow should look like this:</p><ol>\n<li>Developer runs git push with modified code or configurations.</li>\n<li>CI/CD service (GitHub Actions in our case) starts running.</li>\n<li>CI/CD service builds and pushes new image <em>and</em> commits edit to the \"release\" branch (main in our case)</li>\n<li>ArgoCD will take the state described in the release branch and set it as the state of our cluster.</li>\n</ol><p>Let us start by installing ArgoCD by following the <a href=\"https://argo-cd.readthedocs.io/en/stable/getting_started/\" target=\"_blank\" rel=\"noopener noreferrer\">Getting started</a> of the docs:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl create namespace argocd\nkubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml</code></pre></div><p>Now ArgoCD is up and running in our cluster. We still need to open access to it. There are several <a href=\"https://argo-cd.readthedocs.io/en/stable/getting_started/#3-access-the-argo-cd-api-server\" target=\"_blank\" rel=\"noopener noreferrer\">options</a>. We shall use the LoadBalancer. So we'll give the command</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl patch svc argocd-server -n argocd -p <span class=\"token string\">'{\"spec\": {\"type\": \"LoadBalancer\"}}'</span></code></pre></div><p>After a short wait, the cluster has provided us with an external IP:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ kubectl get svc -n argocd\nNAME               TYPE           CLUSTER-IP    EXTERNAL-IP   PORT<span class=\"token punctuation\">(</span>S<span class=\"token punctuation\">)</span>                      AGE\n<span class=\"token punctuation\">..</span>.\nargocd-server      LoadBalancer   <span class=\"token number\">10.7</span>.5.82     <span class=\"token number\">34.88</span>.152.2   <span class=\"token number\">80</span>:32029/TCP,443:30574/TCP   17min</code></pre></div><p>The initial password for the <em>admin</em> account is auto-generated and stored as clear text in the field password in a secret named <em>argocd-initial-admin-secret</em> in your Argo CD installation namespace. So we get it by base64 decoding the value that we get with the command</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get -n argocd secrets argocd-initial-admin-secret -o yaml</code></pre></div><p>We can now login:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/9960d78be7b36c3c387923af1cf4accc/29114/argo2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 62.60869565217391%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB7UlEQVQoz3WQyW/TUBDGfQEEBygHDiBo1aKyFhVIN5VWUA4oJxD0xHbkX0O9UJWiilCFCLWBInDI5sRbnl/sZzveEjuLRIlrYBIjX3Ct32H0zftmvjHFIcwyLFdisIAszSKapek20Gz1ur1+Z8Cvdjceaj75JJFcHbk6l3z+quW1O91eEAS+f+AfDOj3/b7v//4T/1EXE8tjsytHLly7+/jF9s7XtXfbW5ns67epN+8zm+kdKNZTmZ/7+/D0/xHU+VvLk4sPTkxMr6y+9Do9YliybqiGbbttx22bTU+FfEEQv3l87j5sPjY2tfTomeZ4xHZls0ksF2pABcXxJN3m6zpf15BqDnU3hBqduXd2+s7x8RuLD5/WNAvpdgjUQ2xeMXIs+sHhPIdpVqpgLepSZ6YWzt1cOjl5G8yRM0JqOGVEKogwiJREmcVqSVSiLgW2kcszR0evH2au1jXYCZkheVGowywQ/5lPXUqcvjILNx9mBoqinGMlGJHnMaQNxXgz3BnaaqopDgED7IfkAjGhJWoWiPAgfrOoWpzcyHNor1DdK7IFXmKQkmNrRQHTFeFbmaerIq804s0CMeBduaYUeMxI5MNnem3rI7CR3oXfBjrMqkgkNvbgKmw0Q2Sr9YkubaSzm5kvqex3yYhazl/MZlHVn92WAAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/9960d78be7b36c3c387923af1cf4accc/a0b58/argo2.webp 230w,\n/static/9960d78be7b36c3c387923af1cf4accc/bc10c/argo2.webp 460w,\n/static/9960d78be7b36c3c387923af1cf4accc/966d8/argo2.webp 920w,\n/static/9960d78be7b36c3c387923af1cf4accc/445df/argo2.webp 1380w,\n/static/9960d78be7b36c3c387923af1cf4accc/78de1/argo2.webp 1840w,\n/static/9960d78be7b36c3c387923af1cf4accc/882b9/argo2.webp 1920w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/9960d78be7b36c3c387923af1cf4accc/81c8e/argo2.png 230w,\n/static/9960d78be7b36c3c387923af1cf4accc/08a84/argo2.png 460w,\n/static/9960d78be7b36c3c387923af1cf4accc/c0255/argo2.png 920w,\n/static/9960d78be7b36c3c387923af1cf4accc/b1001/argo2.png 1380w,\n/static/9960d78be7b36c3c387923af1cf4accc/161ec/argo2.png 1840w,\n/static/9960d78be7b36c3c387923af1cf4accc/29114/argo2.png 1920w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/9960d78be7b36c3c387923af1cf4accc/c0255/argo2.png\" alt=\"argo2\" title=\"argo2\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Let us now deploy the simple app in <a href=\"https://github.com/mluukkai/dwk-app1\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/mluukkai/dwk-app1</a> using ArgoCD. We start by clicking <em>New app</em> and fill the form that opens:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/5725dd9e9f90f4f0bdc37eb1e7024813/332b4/argo3.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 39.130434782608695%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAhUlEQVQY052RwQ6CMAyG9/4vxJmLwYuEBGLUePAqMVkGKyu0qx0arw6+/Lf+X5qmZkLEeVmI/kZbUaTurkV5qOrWDt6MAGpLBjGqK5f7ozyemvPNeTDWuoAzc5rk5McAkyFiTmouWl8Ndio/+1cIKNtJctzHRx497Nis+lfWH+jRm0LrzW/UEtdBMoJwxAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/5725dd9e9f90f4f0bdc37eb1e7024813/a0b58/argo3.webp 230w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/bc10c/argo3.webp 460w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/966d8/argo3.webp 920w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/445df/argo3.webp 1380w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/ffcc2/argo3.webp 1826w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/5725dd9e9f90f4f0bdc37eb1e7024813/81c8e/argo3.png 230w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/08a84/argo3.png 460w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/c0255/argo3.png 920w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/b1001/argo3.png 1380w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/332b4/argo3.png 1826w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/5725dd9e9f90f4f0bdc37eb1e7024813/c0255/argo3.png\" alt=\"argo3\" title=\"argo3\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>At the start, we decided to have a <em>manual sync policy</em>.</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/048907e8118485b948585dd05b0b3741/84a78/argo4.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 82.17391304347825%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA4UlEQVQoz51Syw6DMAzj//9wdw47MEZL00eSlrkwJHZgo7OMBFLdGMddYvEhas5LI1i0g5jIgyLCzAnfomeCUpa8j6nimBhKY2dHZOd5MpZ8KCeAEneXg1j8evqi27wCL0mkiyxudqqacfHOL5NDiMxSxSz1n3N7WntgSOHW5/tYah5XgbPVdoLfyWk/HG3/ZIEYti0FEgFdiE20PnRbSagl8I+SJMSn+k9gKMlzMuNzQj3woGHLeXLYS4xp8/ieXAupejnnz8nDY+S1zzXE3zyuaq1LacSyrco4ss7/QeP8C3XusNVNcFqcAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/048907e8118485b948585dd05b0b3741/a0b58/argo4.webp 230w,\n/static/048907e8118485b948585dd05b0b3741/bc10c/argo4.webp 460w,\n/static/048907e8118485b948585dd05b0b3741/966d8/argo4.webp 920w,\n/static/048907e8118485b948585dd05b0b3741/445df/argo4.webp 1380w,\n/static/048907e8118485b948585dd05b0b3741/2c1a7/argo4.webp 1832w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/048907e8118485b948585dd05b0b3741/81c8e/argo4.png 230w,\n/static/048907e8118485b948585dd05b0b3741/08a84/argo4.png 460w,\n/static/048907e8118485b948585dd05b0b3741/c0255/argo4.png 920w,\n/static/048907e8118485b948585dd05b0b3741/b1001/argo4.png 1380w,\n/static/048907e8118485b948585dd05b0b3741/84a78/argo4.png 1832w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/048907e8118485b948585dd05b0b3741/c0255/argo4.png\" alt=\"argo4\" title=\"argo4\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Note that since the definition (in our case file <em>kustomization.yaml</em>) is in the repository root, we have defined the <em>path</em> to having the value ., that is, the character <em>period</em>.</p><p>The app is created but it is missing and not in sync, since we selected the manual sync policy:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/42257e4e900ba4b6ce44a953ffebf40e/b8bf8/argo5.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.21739130434783%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB6UlEQVQoz22RbW/SUBTH+wU2TcoAs+FeiBBXnkqDK1AYc5ku8Y3fUd/NqDPZ5sPQ0CVEETInkbi5YYZEGJXC2tLb3nvLPNsSgujJPyc3N/md/3lgorkHXHaNyz2cDsTn+Gy1dqDrBiZkOBw6jnOVKb14nP8TTPbe6kJqJZhZm74dvynknm3nn7zYfrkjr2/lHz/f2nhbWN/cgZ+NN4WrAsOxYFh/dDYmBVL33aGkOyRWD44bbeXopHn4o1FvtlqK2mwrP1uduqJi6kw6+3jJJyzNJ5avBQQXl9z/+gVZVk8zBsjClNqEWphARtSBbNq20tdHYmKrjwD2hJNTfp7lUqVKoacq7dPfMLaN8YQVVPze7IzEAOmNSrN8xhMWL+FdhPQz3Tx37H5P0bXumaZBFUopwNDF8S9lJOZ6UJjhoGGRvZNwcelSRbYtQ+n2Mba6qqobmqYbumEOBiYsaxL2RhZvJURPRIJtzYSkj+UCJRZMDBcil27jYWH8F3wjKs3xOXCe8sfcYYBlSlCvrwEMnnAPQijMD/pP22w46U2vzMeXoH93JFPe2z3ttN8Vy9VvR5Vqbb92CMtHyDJNBLBNyITzYjAt+oRlduGuK5Qq7xXrjZOnr96/lj/ki5/k0mcbTCmYX0g30Tj8B75h5RCeBB0BAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/42257e4e900ba4b6ce44a953ffebf40e/a0b58/argo5.webp 230w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/bc10c/argo5.webp 460w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/966d8/argo5.webp 920w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/445df/argo5.webp 1380w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/eaa3b/argo5.webp 1728w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/42257e4e900ba4b6ce44a953ffebf40e/81c8e/argo5.png 230w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/08a84/argo5.png 460w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/c0255/argo5.png 920w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/b1001/argo5.png 1380w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/b8bf8/argo5.png 1728w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/42257e4e900ba4b6ce44a953ffebf40e/c0255/argo5.png\" alt=\"argo5\" title=\"argo5\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Let us sync it and go to the app page:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6cd87037fd1633913045859e928ab140/b918a/argo6.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.04347826086957%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAABYlAAAWJQFJUiTwAAABFElEQVQY022P2W7EIAxF8/8fV1WV2ofJ2ixsNhhCyD5K3Zn2qUXnARtzOWSALi5Lg4DWjcc6Hdt1XbTOlUe/pLgu53ne7/frv5Wt+74dhx+j0IA+jGnej3PeNu2oVwbJhykt68bNv2RunGhM2vpGYSWgUrYU8ITLRtlK4k8pf3kc8SYrBsh7wxSD4YlaQi3gU9tWOy5bbTkXaPRx7oF4mJuFxuIRlwnr7ZiYDqiW2KOTRDEtyvlKmFqweXA+hmnhoOf79a2ti64UJuusxzBpF55KHbgByVBUFDirHLQNMcQU0yzR5wJyhc1rXhhbUmBtc+s1w0r8vdZYYQl9bDV+XxaG1SRSwxYSbsJ8aHzX8NKKt0F/AUPAg10f8YnVAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/6cd87037fd1633913045859e928ab140/a0b58/argo6.webp 230w,\n/static/6cd87037fd1633913045859e928ab140/bc10c/argo6.webp 460w,\n/static/6cd87037fd1633913045859e928ab140/966d8/argo6.webp 920w,\n/static/6cd87037fd1633913045859e928ab140/445df/argo6.webp 1380w,\n/static/6cd87037fd1633913045859e928ab140/78de1/argo6.webp 1840w,\n/static/6cd87037fd1633913045859e928ab140/05d2a/argo6.webp 2780w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/6cd87037fd1633913045859e928ab140/81c8e/argo6.png 230w,\n/static/6cd87037fd1633913045859e928ab140/08a84/argo6.png 460w,\n/static/6cd87037fd1633913045859e928ab140/c0255/argo6.png 920w,\n/static/6cd87037fd1633913045859e928ab140/b1001/argo6.png 1380w,\n/static/6cd87037fd1633913045859e928ab140/161ec/argo6.png 1840w,\n/static/6cd87037fd1633913045859e928ab140/b918a/argo6.png 2780w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/6cd87037fd1633913045859e928ab140/c0255/argo6.png\" alt=\"argo6\" title=\"argo6\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Something seems to be wrong, the pod has a <em>broken heart</em> symbol. We could now start our usual debugging process starting with <code class=\"language-text\">kubectl get po</code>. We see the same info from ArgoCD by clicking the pod:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8137a058e3e08723c19a069a11382d75/cb1ac/argo7.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 20.869565217391305%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAcUlEQVQI13VOWw6AIAzj/oc1ytgLNrRqTPix6cearI/i7qp2LoDctl1Ucc8H5w9KRFBjc1/MyqIiclTaj+reI7L3AcaHzLzNY4xKxCz5lszpvefTJmp3EAuIFFA+qWZ4LuiEWJcNVUIe9jBTa8j6m30BDr3q3RWpfRUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/8137a058e3e08723c19a069a11382d75/a0b58/argo7.webp 230w,\n/static/8137a058e3e08723c19a069a11382d75/bc10c/argo7.webp 460w,\n/static/8137a058e3e08723c19a069a11382d75/966d8/argo7.webp 920w,\n/static/8137a058e3e08723c19a069a11382d75/445df/argo7.webp 1380w,\n/static/8137a058e3e08723c19a069a11382d75/78de1/argo7.webp 1840w,\n/static/8137a058e3e08723c19a069a11382d75/cb61f/argo7.webp 1936w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/8137a058e3e08723c19a069a11382d75/81c8e/argo7.png 230w,\n/static/8137a058e3e08723c19a069a11382d75/08a84/argo7.png 460w,\n/static/8137a058e3e08723c19a069a11382d75/c0255/argo7.png 920w,\n/static/8137a058e3e08723c19a069a11382d75/b1001/argo7.png 1380w,\n/static/8137a058e3e08723c19a069a11382d75/161ec/argo7.png 1840w,\n/static/8137a058e3e08723c19a069a11382d75/cb1ac/argo7.png 1936w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/8137a058e3e08723c19a069a11382d75/c0255/argo7.png\" alt=\"argo7\" title=\"argo7\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Ok, we have specified an image that does not exist. Let us fix it in GitHub by changing <em>kustomization.yaml</em> as follows:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kustomize.config.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Kustomization\n<span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> manifests/deployment.yaml\n<span class=\"token punctuation\">-</span> manifests/service.yaml\n<span class=\"token key atrule\">images</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> PROJECT/IMAGE\n  <span class=\"token key atrule\">newName</span><span class=\"token punctuation\">:</span> mluukkai/dwk1</code></pre></div><p>When we sync the changes in ArgoCD, a new healthy pod is started and our app is up and running!</p><p>We can check the external IP either from command line with <em>kubectl</em> or by clicking the service:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/6c86f/argo8.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 57.391304347826086%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/ElEQVQoz4VQAW6DMAzk/3/bCyZ1WrcJOgYmiePESZzOQKm6ibanEyImd4ev6cF+D9D149fpR/kBAEgWCZx/ymZCOoE5fLbHrgcMYPHYD+9gB4vjMzZq0CN1xrXGTRQxsEEygT0nfX/MxvogIjml8w1yzsx/Jru4iCOzHqpCnyouhZljLrIc73EWFxGHWEpZR4qU82TsSEG2kLtiTR4ng97XumafU0qDw6h2Imqq7nUPFzF6ul1S78cYPQVK7ENw6FfT3Z1rXArbkmvOxTjkyHWw4mPdPu0nw/zbdN1Z2xoR41tbX17lcWHqoQ0l7bbWlbqkFl6Wtmdu83/8BQAWgkrmLrCcAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/a0b58/argo8.webp 230w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/bc10c/argo8.webp 460w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/966d8/argo8.webp 920w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/445df/argo8.webp 1380w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/9d85b/argo8.webp 1720w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/81c8e/argo8.png 230w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/08a84/argo8.png 460w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/c0255/argo8.png 920w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/b1001/argo8.png 1380w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/6c86f/argo8.png 1720w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/c0255/argo8.png\" alt=\"argo8\" title=\"argo8\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Let us now change the sync mode to <em>automatic</em> by clicking the <em>Details</em> from the app page in ArgoCD.</p><p>Now all the configuration changes that we make to GitHub should be automatically applied by ArgoCD. Let us scale up the deployment to have 5 pods:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dwk1<span class=\"token punctuation\">-</span>app<span class=\"token punctuation\">-</span>dep\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> dwk1<span class=\"token punctuation\">-</span>app\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">...</span></code></pre></div><p>After a small wait (the default sync frequency of ArgoCD is 180 seconds), app gets synchronized and 5 pods are up and running:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/7a969076cce54007f1e967c1b9c6a1d6/77085/argo9.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 45.65217391304348%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAABYlAAAWJQFJUiTwAAABWUlEQVQoz3VQy1LDMAzM/38Xd2BCSYc8CKkfsSXLTuw2DWkblHJghgHNHjQrrbRSJrwbYlKjpxCO12W6XdZ1NccoY0jLPF8vN47178jmy/K5LCElcDSkNM0zs3E6KUQ/jmNMXF7/E/sxpdOUjpMGEpYkeOVC74K85xswSPSCefTaBY13bInP2h4PlgRQq7FWUCmopS2FqTVWEt65apww1NPYWfcmbdFjoWEnzd66rGGNhFLaagPwIEnepxRP5wP4RgHwNWxtOvPCN2FyR/sx5hZ3FLKH58IMXD6HdGIXtbCNBnZRCVseDLvoepZHvk6B38TWvVLIe9ix7X2rPnonrW+4uzMd+wRnKfjxyC4aCXwRq9Xd/CY2uEN6PGhOslY73vYNbm0VdMbxnziphflQyH+iEJXFzmAp7AtQ4YdH2efAN0v4BZ5SbbN+mHeF33wpIUcqwvCkTQ70BazU8IjWLkqtAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/7a969076cce54007f1e967c1b9c6a1d6/a0b58/argo9.webp 230w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/bc10c/argo9.webp 460w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/966d8/argo9.webp 920w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/445df/argo9.webp 1380w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/78de1/argo9.webp 1840w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/96199/argo9.webp 2764w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/7a969076cce54007f1e967c1b9c6a1d6/81c8e/argo9.png 230w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/08a84/argo9.png 460w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/c0255/argo9.png 920w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/b1001/argo9.png 1380w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/161ec/argo9.png 1840w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/77085/argo9.png 2764w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/7a969076cce54007f1e967c1b9c6a1d6/c0255/argo9.png\" alt=\"argo9\" title=\"argo9\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Besides services, deployments and pods, the app configuration tree shows also some other objects. We see that there is a\n<a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/\" target=\"_blank\" rel=\"noopener noreferrer\">ReplicaSet</a> (in figure <em>rs</em>) in between deployment and the pods. A ReplicaSet is a Kubernetes object that ensures there is always a stable set of running pods for a specific workload. The ReplicaSet configuration defines a number of identical pods required, and if a pod is evicted or fails, creates more pods to compensate for the loss. Users do not usually define ReplicaSets directly, instead Deployments are used. A Deployment then creates a ReplicaSet that takes care of running the pod replicas.</p><p>The changes in app Kubernetes configurations that we make to GitHub are now nicely synched to the cluster. How about the changes in the app?</p><p>In order to deploy a new app version, we should change the image that is used in the deployment. Currently the image is defined in the file <em>kustomization.yaml</em>:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kustomize.config.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Kustomization\n<span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> manifests/deployment.yaml\n<span class=\"token punctuation\">-</span> manifests/service.yaml\n<span class=\"token key atrule\">images</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> PROJECT/IMAGE\n  <span class=\"token key atrule\">newName</span><span class=\"token punctuation\">:</span> mluukkai/dwk1</code></pre></div><p>So to deploy a new the app, we should:</p><ol>\n<li>create a new image with possibly a new tag</li>\n<li>change the kustomization.yaml to use the new image</li>\n<li>push changes to GitHub</li>\n</ol><p>Surely this could be done manually but that is not enough for us. Let us now define a GitHub Actions workflow that does all these steps.</p><p>The first step is already familiar to us from <a href=\"/part-3/2-deployment-pipeline\">part 3</a></p><p>The step 2 can be done with the command <em>kustomize edit</em>:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">$ kustomize edit set image PROJECT/IMAGE=node<span class=\"token punctuation\">:</span><span class=\"token number\">20</span>\n$ cat kustomization.yaml\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kustomize.config.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Kustomization\n<span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> manifests/deployment.yaml\n<span class=\"token punctuation\">-</span> manifests/service.yaml\n<span class=\"token key atrule\">images</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> PROJECT/IMAGE\n  <span class=\"token key atrule\">newName</span><span class=\"token punctuation\">:</span> node\n  <span class=\"token key atrule\">newTag</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"20\"</span></code></pre></div><p>As we see, the command <em>changes</em> the file <em>kustomization.yaml</em>. So all that is left is to commit the file to the repository. Fortunately there is a ready made GitHub Action <a href=\"https://github.com/EndBug/add-and-commit\" target=\"_blank\" rel=\"noopener noreferrer\">add-and-commit</a> for that!</p><p>The workflow looks the following:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and publish application\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build-publish</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build<span class=\"token punctuation\">,</span> Push<span class=\"token punctuation\">,</span> Release\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v4\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Login to Docker Hub\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/login<span class=\"token punctuation\">-</span>action@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKERHUB_USERNAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKERHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\"># tag image with the GitHub SHA to get a unique tag</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and publish backend\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token punctuation\">-</span>\n          docker build <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>tag \"mluukkai/dwk1<span class=\"token punctuation\">:</span>$GITHUB_SHA\" .\n          docker push \"mluukkai/dwk1<span class=\"token punctuation\">:</span>$GITHUB_SHA\"\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up Kustomize\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> imranismail/setup<span class=\"token punctuation\">-</span>kustomize@v2\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Use right image\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> kustomize edit set image PROJECT/IMAGE=mluukkai/dwk1<span class=\"token punctuation\">:</span>$GITHUB_SHA\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> commit kustomization.yaml to GitHub\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> EndBug/add<span class=\"token punctuation\">-</span>and<span class=\"token punctuation\">-</span>commit@v9\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">add</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'kustomization.yaml'</span>\n          <span class=\"token key atrule\">message</span><span class=\"token punctuation\">:</span> New version released $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.sha <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div><p>There is still one more to do, from the repository settings we must give the GitHub Actions permission to write to our repository:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/099030fe16625510838386413508f6e5/9efb3/gha-perm.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 38.260869565217384%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABYlAAAWJQFJUiTwAAABD0lEQVQY042QaY6EIBSEvf/p5gC27QIogkALGmWdsk0m/pzKBym29ypUhAk2LWyUmPth6oaJTUrpbbWndf7JepstaLNzYU6lqgilFEvxMVLK2DhhYN73HSchRB+C9yEGD+BSvLz3JzarAoVYtI3GtXQkA2m7ruv7fhgmzhkdUYsQ1nPzHk1NlpqaF4XX27ZVJeekbf5pQi8brl51/W67pmkJZeazGvNR2rht348Qc7kCpgt46Nu5lK8vzjkEnmc5C8m5oGwcJw5Wa4/jOE9w5nzf/XuMdUKAjD5CiPlC4tOkXICQEiwK0lobjTzrepeoykN8luh1XV0UEEKiFpbYuP7soUfnO3nO1m0p5fJv/QLGgMjXxrD94AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/099030fe16625510838386413508f6e5/a0b58/gha-perm.webp 230w,\n/static/099030fe16625510838386413508f6e5/bc10c/gha-perm.webp 460w,\n/static/099030fe16625510838386413508f6e5/966d8/gha-perm.webp 920w,\n/static/099030fe16625510838386413508f6e5/445df/gha-perm.webp 1380w,\n/static/099030fe16625510838386413508f6e5/78de1/gha-perm.webp 1840w,\n/static/099030fe16625510838386413508f6e5/eb397/gha-perm.webp 1894w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/099030fe16625510838386413508f6e5/81c8e/gha-perm.png 230w,\n/static/099030fe16625510838386413508f6e5/08a84/gha-perm.png 460w,\n/static/099030fe16625510838386413508f6e5/c0255/gha-perm.png 920w,\n/static/099030fe16625510838386413508f6e5/b1001/gha-perm.png 1380w,\n/static/099030fe16625510838386413508f6e5/161ec/gha-perm.png 1840w,\n/static/099030fe16625510838386413508f6e5/9efb3/gha-perm.png 1894w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/099030fe16625510838386413508f6e5/c0255/gha-perm.png\" alt=\"gha perm\" title=\"gha perm\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>We are now set, all changes to configurations and to the app code are now deployed automatically by ArcoCD with the help of our GitHub Action workflow, so nice!</p><exercise name='Exercise 4.07: GitOps the Project'><p>  Move the <em>Ping-pong application</em> to use GitOps so that when you commit to the repository, the application is automatically updated.</p></exercise><p>If an app has many environments such as production, staging and testing, a straightforward way of defining the environments contains lots of copy-paste. When Kustomize is used, the <a href=\"https://kubectl.docs.kubernetes.io/guides/example/multi_base/\" target=\"_blank\" rel=\"noopener noreferrer\">recommended</a> way is to define a common <em>base</em> for all the environments and then environment specific overlays where the differing parts are defined.</p><p>Let us look at a simple example. We will create a directory structure that looks like the following:</p><div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.\n├── base\n│   ├── deployment.yaml\n│   └── kustomization.yaml\n└── overlays\n    ├── prod\n    │   ├── deployment.yaml\n    │   └── kustomization.yaml\n    └── staging\n        └── kustomization.yaml</code></pre></div><p>The <strong>base/deployment.yaml</strong> is as follows</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> myapp<span class=\"token punctuation\">-</span>dep\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> myapp\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> myapp\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> myapp\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> PROJECT/IMAGE</code></pre></div><p>The <strong>base/kustomization.yaml</strong> is simple:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> deployment.yaml</code></pre></div><p>The production environment refines the base by changing the replica count to 3. The <strong>overlays/prod/deployment.yaml</strong> looks like this:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dep\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span></code></pre></div><p>So only parts that are different are defined.</p><p>The <strong>overlays/prod/kustomization.yaml</strong> looks like following:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> ./../../base\n<span class=\"token key atrule\">patches</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> deployment.yaml\n\n<span class=\"token key atrule\">namePrefix</span><span class=\"token punctuation\">:</span> prod<span class=\"token punctuation\">-</span>\n\n<span class=\"token key atrule\">images</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> PROJECT/IMAGE\n    <span class=\"token key atrule\">newName</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span>1.25<span class=\"token punctuation\">-</span>bookworm</code></pre></div><p>So it refers to the base and <a href=\"https://kubectl.docs.kubernetes.io/references/kustomize/kustomization/patches/\" target=\"_blank\" rel=\"noopener noreferrer\">patches</a> that with the above deployment that sets the number of replicas to 3.</p><p>The <strong>overlays/staging/kustomization.yaml</strong> just sets the image:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> ./../../base\n<span class=\"token key atrule\">namePrefix</span><span class=\"token punctuation\">:</span> staging<span class=\"token punctuation\">-</span>\n\n<span class=\"token key atrule\">images</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> PROJECT/IMAGE\n    <span class=\"token key atrule\">newName</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span>1.25.5<span class=\"token punctuation\">-</span>alpine</code></pre></div><p>Now the production and staging can be deployed using ArgoCD by pointing to the corresponding overlay directories.</p><p>We have so far used the ArgoCD UI for defining applications. There are also other options. One could <a href=\"https://argo-cd.readthedocs.io/en/stable/getting_started/#2-download-argo-cd-cli\" target=\"_blank\" rel=\"noopener noreferrer\">install</a> and use <a href=\"https://argo-cd.readthedocs.io/en/stable/getting_started/#creating-apps-via-cli\" target=\"_blank\" rel=\"noopener noreferrer\">Argo CLI</a></p><p>Yet another option is to use <a href=\"https://argo-cd.readthedocs.io/en/stable/operator-manual/declarative-setup/#declarative-setup\" target=\"_blank\" rel=\"noopener noreferrer\">declarative</a> approach and do the definition with <a href=\"https://argo-cd.readthedocs.io/en/stable/operator-manual/declarative-setup/#applications\" target=\"_blank\" rel=\"noopener noreferrer\">Application</a> Custom resource definition:</p><p>For the production version of our app the definition looks like this:</p><p><strong>application.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> argoproj.io/v1alpha1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Application\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> myapp<span class=\"token punctuation\">-</span>production\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> argocd\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">project</span><span class=\"token punctuation\">:</span> default\n  <span class=\"token key atrule\">source</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">repoURL</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">:</span>//github.com/mluukkai/gitopstest\n    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> overlays/prod\n    <span class=\"token key atrule\">targetRevision</span><span class=\"token punctuation\">:</span> HEAD\n  <span class=\"token key atrule\">destination</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">:</span>//kubernetes.default.svc\n    <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> default\n  <span class=\"token key atrule\">syncPolicy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">automated</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">prune</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n      <span class=\"token key atrule\">selfHeal</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div><p>The application is then set up to ArgoCD by applying the definition:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl apply -n argocd -f application.yaml</code></pre></div><p>With GitOps we achieve the following:</p><ul>\n<li>\n<p>Better security</p>\n<ul>\n<li>Nobody needs access to the cluster, not even CI/CD services. No need to share access to the cluster with collaborators; they will commit changes like everyone else.</li>\n</ul>\n</li>\n<li>\n<p>Better transparency</p>\n<ul>\n<li>Everything is declared in the GitHub repository. When a new person joins the team, he/she can check the repository; no need to pass ancient knowledge or hidden techniques as there are none.</li>\n</ul>\n</li>\n<li>\n<p>Better traceability</p>\n<ul>\n<li>All changes to the cluster are version controlled. You will know exactly what was the state of the cluster and how it was changed and by whom.</li>\n</ul>\n</li>\n<li>\n<p>Risk reduction</p>\n<ul>\n<li>If something breaks simply revert the cluster to a working commit. <code class=\"language-text\">git revert</code> and the whole cluster is in a previous state.</li>\n</ul>\n</li>\n<li>\n<p>Portability</p>\n<ul>\n<li>Want to change to a new provider? Spin up a cluster and point it to the same repository - your cluster is now there.</li>\n</ul>\n</li>\n</ul><p>There are a few options for the GitOps setup. What we used here was having the configuration for the application in the same repository as the application itself. Another option is to have the configuration separate from the source code. ArgoCD lists many convincing arguments that the use of separate repos is a <a href=\"https://argo-cd.readthedocs.io/en/stable/user-guide/best_practices/#separating-config-vs-source-code-repositories\" target=\"_blank\" rel=\"noopener noreferrer\">best practice</a>.</p><exercise name='Exercise 4.08: GitOps the Project'><p>  Move the Project to use GitOps.</p><ul>\n<li>Create two separate environments, <em>production</em> and <em>staging</em> that are in their own namespaces</li>\n<li>Each commit to the main branch should result in deployment to the staging environment</li>\n<li>Each <em>tagged</em> commit results in deployment to the production environment</li>\n<li>In staging the broadcaster just logs all the messages, it does not forward those to any external service</li>\n<li>In staging database is not backed up</li>\n<li>You may assume that <em>secrets</em> are readily applied outside of the ArgoCD</li>\n<li>Bonus: use different repositories for the code and configurations</li>\n</ul></exercise></div>","frontmatter":{"path":"/part-4/3-gitops","title":"GitOps"},"fileAbsolutePath":"/home/runner/work/dwk2024/dwk2024/data/part-4/3-GitOps.md"},"allPages":{"edges":[{"node":{"id":"7e706a38-3828-5118-bdec-3705a319a1b0","frontmatter":{"path":"/faq-vi","title":"Câu hỏi thường gặp"}}},{"node":{"id":"5225f2a2-20f9-50ce-93ac-7b38f3105103","frontmatter":{"path":"/faq","title":"FAQ"}}},{"node":{"id":"e1ed6713-5992-5f7f-95a1-17efd97f57d8","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"52d4cd1d-eb14-54f3-a18a-ef84b67c320d","frontmatter":{"path":"/index-en","title":"Homepage"}}},{"node":{"id":"3102d88f-7297-56fb-af03-27d1079fffd1","frontmatter":{"path":"/","title":"Trang chủ"}}},{"node":{"id":"c92ea568-3384-5ff8-8dfa-b9015597780d","frontmatter":{"path":"/known-problems-solutions","title":"Issues you may face"}}},{"node":{"id":"5e6b6ee0-b381-53f0-b84c-af378792b131","frontmatter":{"path":"/registration-and-completion","title":"Registration and Completion"}}},{"node":{"id":"58688080-4aa8-54e6-8b8b-02de1c4f6410","frontmatter":{"path":"/unity-assignment","title":"Unity Assignment"}}},{"node":{"id":"04c5ddbd-7839-580f-82da-bc9fdbb49f84","frontmatter":{"path":"/known-problems-solutions","title":"Các vấn đề bạn có thể gặp phải"}}},{"node":{"id":"d9c993b6-f6b4-59a1-b119-f3b7218eec6b","frontmatter":{"path":"/sanasto","title":"Sanasto"}}},{"node":{"id":"8a3ee5be-7557-5fcd-954b-2351e74cd585","frontmatter":{"path":"/part-0/1-intro-vi","title":"Giới thiệu khóa học"}}},{"node":{"id":"23082016-7bbd-5215-8485-4ffccbf3ea1a","frontmatter":{"path":"/part-0/1-intro","title":"Course Introduction"}}},{"node":{"id":"771eaa93-2ef2-5e0f-9e1e-55914c67c4ac","frontmatter":{"path":"/part-0","title":"Part 0"}}},{"node":{"id":"fe0342aa-a4c5-5b44-8591-71eb27f1a287","frontmatter":{"path":"/part-1/2-introduction-to-debugging-vi","title":"Giới thiệu về Debugging"}}},{"node":{"id":"1c236933-7ad5-5b61-8c07-07db3822d55a","frontmatter":{"path":"/part-1/2-introduction-to-debugging","title":"Introduction to Debugging"}}},{"node":{"id":"7fc5c062-6b94-53ec-9aaa-adca66ce672e","frontmatter":{"path":"/part-1/5-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"3c788edf-62db-5e86-9366-17b53eda9244","frontmatter":{"path":"/part-1/5-summary","title":"Summary"}}},{"node":{"id":"46a4a0e4-d131-537d-aa72-5b6726163a7d","frontmatter":{"path":"/part-2/1-networking-between-pods-vi","title":"Kết nối mạng giữa các pod"}}},{"node":{"id":"fd467661-6b24-545f-904c-52f4a7ade6b7","frontmatter":{"path":"/part-2/1-networking-between-pods","title":"Networking between pods"}}},{"node":{"id":"56110eda-875d-5bd9-a400-5bd5a009df7f","frontmatter":{"path":"/part-2/5-monitoring-vi","title":"Giám sát"}}},{"node":{"id":"8f3387b0-ec6e-5a86-982a-e52780d911f9","frontmatter":{"path":"/part-2/5-monitoring","title":"Monitoring"}}},{"node":{"id":"06173ac4-c2f8-57df-8dc8-450b5c2bb695","frontmatter":{"path":"/part-2/6-summary","title":"Summary"}}},{"node":{"id":"8c3d747d-4f87-5a46-99ac-dfd0af5a893b","frontmatter":{"path":"/part-2","title":"Part 2"}}},{"node":{"id":"79f1cddb-6995-51c2-bf98-2adc13de9b13","frontmatter":{"path":"/part-2/6-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"8ed3365b-b788-5806-8ec5-bec3cb0f94c8","frontmatter":{"path":"/part-1","title":"Part 1"}}},{"node":{"id":"8d9fd774-9dbe-5cca-8395-9226fcf82c4a","frontmatter":{"path":"/part-3/4-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"b98b2895-6c9d-5234-939d-2f547cbf8a06","frontmatter":{"path":"/part-3/4-summary","title":"Summary"}}},{"node":{"id":"4dd8302d-d170-5d38-8198-4d0947322bbc","frontmatter":{"path":"/part-4/4-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"0045695d-e541-5acc-b4b8-551023d01733","frontmatter":{"path":"/part-4/4-summary","title":"Summary"}}},{"node":{"id":"29bec4f5-8a0b-580d-ac84-9dbbd1d7152e","frontmatter":{"path":"/part-3","title":"Part 3"}}},{"node":{"id":"a917b24d-df2b-5199-ac98-cd0f7560c63f","frontmatter":{"path":"/part-4","title":"Part 4"}}},{"node":{"id":"eb339401-26c8-594c-98fd-2f30a95275cd","frontmatter":{"path":"/part-5/4-beyond-kubernetes-vi","title":"Vượt ra ngoài Kubernetes"}}},{"node":{"id":"2318c18f-86e6-5a4e-958a-d1c38f8615cd","frontmatter":{"path":"/part-5/4-beyond-kubernetes","title":"Beyond Kubernetes"}}},{"node":{"id":"1d8ff75c-065b-565d-9ceb-01b9a276ae7a","frontmatter":{"path":"/part-5/5-summary","title":"Summary and end"}}},{"node":{"id":"781bd207-902e-59a2-a752-4958c2c93fb0","frontmatter":{"path":"/part-5/5-summary-vi","title":"Tóm tắt và kết thúc"}}},{"node":{"id":"306c87f3-9adb-5d8b-a3ce-072f8e6cfa43","frontmatter":{"path":"/part-5","title":"Part 5"}}},{"node":{"id":"829fd216-f995-5a77-b201-bb971aec73b4","frontmatter":{"path":"/part-0/2-kubernetes-in-three-diagrams-vi","title":"Kubernetes qua ba sơ đồ"}}},{"node":{"id":"98132cca-4dc3-5942-a6f4-1da87bc81a23","frontmatter":{"path":"/part-0/2-kubernetes-in-three-diagrams","title":"Kubernetes in three diagrams"}}},{"node":{"id":"8931bcb7-c40e-5d57-aa80-c4333972fbb8","frontmatter":{"path":"/part-1/3-introduction-to-networking-vi","title":"Giới thiệu về Mạng"}}},{"node":{"id":"90b8e83a-9d55-550a-908a-316708ce7f8c","frontmatter":{"path":"/part-1/3-introduction-to-networking","title":"Introduction to Networking"}}},{"node":{"id":"4fe00c0a-bb17-5d4c-8202-750493a755c9","frontmatter":{"path":"/part-1/4-introduction-to-storage-vi","title":"Giới thiệu về Lưu trữ"}}},{"node":{"id":"6cc3be66-6091-58fc-bcbd-1f27f9473f85","frontmatter":{"path":"/part-1/4-introduction-to-storage","title":"Introduction to Storage"}}},{"node":{"id":"b53df746-c24f-57e3-a9f3-d6d621697689","frontmatter":{"path":"/part-2/2-organizing-a-cluster-vi","title":"Tổ chức một cụm"}}},{"node":{"id":"d5206d16-d2fe-51fd-8acd-d85ecf0be257","frontmatter":{"path":"/part-2/2-organizing-a-cluster","title":"Organizing a cluster"}}},{"node":{"id":"15be3d7c-b0b7-5bce-b3bf-8cec39d54630","frontmatter":{"path":"/part-2/3-configuring-applications-vi","title":"Cấu hình ứng dụng"}}},{"node":{"id":"e4534a9d-fb84-5d1f-83f0-35055feb0da7","frontmatter":{"path":"/part-2/3-configuring-applications","title":"Configuring applications"}}},{"node":{"id":"02389078-a12f-561a-8a54-fa99a6950b92","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs-vi","title":"StatefulSet và Job"}}},{"node":{"id":"466aa711-527b-55a0-871b-13468e65d344","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs","title":"StatefulSets and Jobs"}}},{"node":{"id":"bea18f34-dcdc-59b8-ba24-3011680a0c58","frontmatter":{"path":"/part-3/1-introduction-to-gke-vi","title":"Giới thiệu về Google Kubernetes Engine"}}},{"node":{"id":"0049e57f-0bc7-5689-9169-43848a972877","frontmatter":{"path":"/part-3/2-deployment-pipeline-vi","title":"Quy trình Triển khai (Deployment Pipeline)"}}},{"node":{"id":"61f18dc7-1abf-5c75-9b54-0cee11c76a40","frontmatter":{"path":"/part-3/2-deployment-pipeline","title":"Deployment Pipeline"}}},{"node":{"id":"7dfec8c7-8ccb-50da-949d-ebd1de395dc4","frontmatter":{"path":"/part-3/3-gke-features-vi","title":"Các tính năng của GKE"}}},{"node":{"id":"423cbc46-2dfa-57e6-9dc5-761a93729600","frontmatter":{"path":"/part-3/3-gke-features","title":"GKE features"}}},{"node":{"id":"84db9628-b3df-5ca1-9d3d-5924e02ae549","frontmatter":{"path":"/part-3/1-introduction-to-gke","title":"Introduction to Google Kubernetes Engine"}}},{"node":{"id":"46f9ce68-5ccd-5787-bd59-03852ad6fdcb","frontmatter":{"path":"/part-4/3-gitops","title":"GitOps"}}},{"node":{"id":"6df9c7be-f930-5827-a39c-0c1698b23600","frontmatter":{"path":"/part-4/3-gitops-vi","title":"Triển khai GitOps"}}},{"node":{"id":"0e981ec1-99e0-5005-ba9f-4f626a81b7ce","frontmatter":{"path":"/part-5/1-kubernetes-internals-vi","title":"Bên trong Kubernetes"}}},{"node":{"id":"31927db3-2182-55c7-b680-663754461d14","frontmatter":{"path":"/part-5/1-kubernetes-internals","title":"Kubernetes Internals"}}},{"node":{"id":"da1f8069-17bc-5c8e-9310-117bcedf5acf","frontmatter":{"path":"/part-5/2-custom-resource-definitions-vi","title":"Định nghĩa Tài nguyên Tùy chỉnh (Custom Resource Definitions)"}}},{"node":{"id":"ccefb04a-5790-57f6-869b-d255b2203667","frontmatter":{"path":"/part-5/2-custom-resource-definitions","title":"Custom Resource Definitions"}}},{"node":{"id":"68c64f9f-c9a5-544b-bafb-b061665cacd0","frontmatter":{"path":"/part-5/3-service-mesh-vi","title":"Service Mesh"}}},{"node":{"id":"20ceed4e-761d-54d4-9acf-2669eac533c6","frontmatter":{"path":"/part-5/3-service-mesh","title":"Service Mesh"}}},{"node":{"id":"97ead58a-8493-5fdd-808e-d4a56de573b0","frontmatter":{"path":"/part-1/1-first-deploy","title":"First Deploy"}}},{"node":{"id":"6f4f18ce-5aa9-5bb5-9d74-0a631a78e6b3","frontmatter":{"path":"/part-4/2-messaging-systems-vi","title":"Hệ thống nhắn tin"}}},{"node":{"id":"c179c521-bb62-52bd-808b-d4869df5302a","frontmatter":{"path":"/part-4/1-update-strategies-and-prometheus-vi","title":"Chiến lược cập nhật và Prometheus"}}},{"node":{"id":"898b0354-f1a2-5664-97de-d84b16018395","frontmatter":{"path":"/part-4/1-update-strategies-and-prometheus","title":"Update Strategies and Prometheus"}}},{"node":{"id":"6981a9d7-619d-51a9-9490-74bc77c0f55b","frontmatter":{"path":"/part-4/2-messaging-systems","title":"Messaging Systems"}}},{"node":{"id":"a17c4c44-7396-543f-b6b4-7adf57808aa8","frontmatter":{"path":"/part-1/1-first-deploy-vi","title":"Triển khai đầu tiên"}}}]}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}