{"componentChunkName":"component---src-templates-course-content-template-js","path":"/part-4/3-gitops-vi","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"Mục tiêu học tập"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sau phần này, bạn có thể"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"so sánh GitOps với các phương pháp triển khai khác"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"so sánh triển khai kiểu push truyền thống với triển khai kiểu pull"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"triển khai GitOps trong cụm Kubernetes của bạn"}]},{"type":"text","value":"\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Một pipeline triển khai đơn giản mà chúng ta đã sử dụng và học qua thường như sau:"}]},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Lập trình viên thực hiện git push với mã đã chỉnh sửa, ví dụ lên GitHub"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Điều này kích hoạt một dịch vụ CI/CD bắt đầu chạy, ví dụ GitHub Actions"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Dịch vụ CI/CD chạy kiểm thử, build image, đẩy image lên registry và triển khai image mới, ví dụ lên Kubernetes"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Cách này gọi là triển khai kiểu push. Tên gọi này rất mô tả vì mọi thứ được đẩy đi bởi bước trước đó. Tuy nhiên, có một số thách thức với cách tiếp cận push. Ví dụ, nếu chúng ta có một cụm Kubernetes không cho phép kết nối từ bên ngoài (ví dụ cụm trên máy cá nhân hoặc bất kỳ cụm nào không muốn cho người ngoài truy cập), khi đó CI/CD không thể push cập nhật vào cụm."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Với cấu hình pull, mọi thứ được đảo ngược. Chúng ta có thể để cụm, chạy ở bất cứ đâu, "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"kéo"}]},{"type":"text","value":" image mới và tự động triển khai nó. Image mới vẫn được kiểm thử và build bởi CI/CD. Chúng ta chỉ đơn giản là chuyển phần triển khai từ CI/CD sang một hệ thống khác thực hiện việc pull."}]},{"type":"element","tagName":"text-box","properties":{"name":"Watchtower","variant":"hint"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nếu bạn đã hoàn thành khóa DevOps với Docker, có thể bạn đã nghe về "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/containrrr/watchtower","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"watchtower"}]},{"type":"text","value":", công cụ cho phép chuyển các bước cuối của pipeline triển khai từ push sang pull khi chạy dịch vụ với docker-compose."}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"GitOps chính là về sự đảo ngược này và thúc đẩy các thực tiễn tốt cho vận hành. Điều này đạt được bằng cách để trạng thái của cụm nằm trong một repository git. Như vậy ngoài việc xử lý triển khai ứng dụng, nó còn xử lý mọi thay đổi của cụm. Điều này đòi hỏi cấu hình bổ sung và thay đổi tư duy so với truyền thống cấu hình máy chủ. Nhưng khi đã làm được, GitOps sẽ là dấu chấm hết cho quản lý cụm kiểu mệnh lệnh."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"ArgoCD"}]},{"type":"text","value":" là công cụ được lựa chọn. Cuối cùng, quy trình làm việc của chúng ta sẽ như sau:"}]},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Lập trình viên git push mã hoặc cấu hình đã chỉnh sửa."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Dịch vụ CI/CD (ở đây là GitHub Actions) bắt đầu chạy."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"CI/CD build và đẩy image mới "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"và"}]},{"type":"text","value":" commit chỉnh sửa vào nhánh \"release\" (ở đây là main)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ArgoCD sẽ lấy trạng thái mô tả trong nhánh release và áp dụng cho cụm."}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bắt đầu bằng việc cài đặt ArgoCD theo "},{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/getting_started/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Getting started"}]},{"type":"text","value":" trong tài liệu:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"kubectl create namespace argocd\nkubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Giờ ArgoCD đã chạy trong cụm. Chúng ta cần mở quyền truy cập cho nó. Có nhiều "},{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/getting_started/#3-access-the-argo-cd-api-server","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"tùy chọn"}]},{"type":"text","value":". Ở đây sẽ dùng LoadBalancer:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"kubectl patch svc argocd-server -n argocd -p "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'{\"spec\": {\"type\": \"LoadBalancer\"}}'"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sau một lúc, cụm sẽ cung cấp external IP:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"$ kubectl get svc -n argocd\nNAME               TYPE           CLUSTER-IP    EXTERNAL-IP   PORT"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"S"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"                      AGE\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":".."}]},{"type":"text","value":".\nargocd-server      LoadBalancer   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.7"}]},{"type":"text","value":".5.82     "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"34.88"}]},{"type":"text","value":".152.2   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]},{"type":"text","value":":32029/TCP,443:30574/TCP   17min"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Mật khẩu ban đầu cho tài khoản "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"admin"}]},{"type":"text","value":" được tạo tự động và lưu dưới dạng văn bản thuần trong trường password của secret "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"argocd-initial-admin-secret"}]},{"type":"text","value":" trong namespace cài đặt ArgoCD. Lấy nó bằng cách giải mã base64 giá trị lấy được từ lệnh:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"kubectl get -n argocd secrets argocd-initial-admin-secret -o yaml"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bây giờ có thể đăng nhập:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/9960d78be7b36c3c387923af1cf4accc/29114/argo2.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 62.60869565217391%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB7UlEQVQoz3WQyW/TUBDGfQEEBygHDiBo1aKyFhVIN5VWUA4oJxD0xHbkX0O9UJWiilCFCLWBInDI5sRbnl/sZzveEjuLRIlrYBIjX3Ct32H0zftmvjHFIcwyLFdisIAszSKapek20Gz1ur1+Z8Cvdjceaj75JJFcHbk6l3z+quW1O91eEAS+f+AfDOj3/b7v//4T/1EXE8tjsytHLly7+/jF9s7XtXfbW5ns67epN+8zm+kdKNZTmZ/7+/D0/xHU+VvLk4sPTkxMr6y+9Do9YliybqiGbbttx22bTU+FfEEQv3l87j5sPjY2tfTomeZ4xHZls0ksF2pABcXxJN3m6zpf15BqDnU3hBqduXd2+s7x8RuLD5/WNAvpdgjUQ2xeMXIs+sHhPIdpVqpgLepSZ6YWzt1cOjl5G8yRM0JqOGVEKogwiJREmcVqSVSiLgW2kcszR0evH2au1jXYCZkheVGowywQ/5lPXUqcvjILNx9mBoqinGMlGJHnMaQNxXgz3BnaaqopDgED7IfkAjGhJWoWiPAgfrOoWpzcyHNor1DdK7IFXmKQkmNrRQHTFeFbmaerIq804s0CMeBduaYUeMxI5MNnem3rI7CR3oXfBjrMqkgkNvbgKmw0Q2Sr9YkubaSzm5kvqex3yYhazl/MZlHVn92WAAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/9960d78be7b36c3c387923af1cf4accc/a0b58/argo2.webp 230w","/static/9960d78be7b36c3c387923af1cf4accc/bc10c/argo2.webp 460w","/static/9960d78be7b36c3c387923af1cf4accc/966d8/argo2.webp 920w","/static/9960d78be7b36c3c387923af1cf4accc/445df/argo2.webp 1380w","/static/9960d78be7b36c3c387923af1cf4accc/78de1/argo2.webp 1840w","/static/9960d78be7b36c3c387923af1cf4accc/882b9/argo2.webp 1920w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/9960d78be7b36c3c387923af1cf4accc/81c8e/argo2.png 230w","/static/9960d78be7b36c3c387923af1cf4accc/08a84/argo2.png 460w","/static/9960d78be7b36c3c387923af1cf4accc/c0255/argo2.png 920w","/static/9960d78be7b36c3c387923af1cf4accc/b1001/argo2.png 1380w","/static/9960d78be7b36c3c387923af1cf4accc/161ec/argo2.png 1840w","/static/9960d78be7b36c3c387923af1cf4accc/29114/argo2.png 1920w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/9960d78be7b36c3c387923af1cf4accc/c0255/argo2.png","alt":"argo2","title":"argo2","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Hãy triển khai ứng dụng đơn giản tại "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/mluukkai/dwk-app1","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://github.com/mluukkai/dwk-app1"}]},{"type":"text","value":" bằng ArgoCD. Bắt đầu bằng cách nhấn "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"New app"}]},{"type":"text","value":" và điền form mở ra:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/5725dd9e9f90f4f0bdc37eb1e7024813/332b4/argo3.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 39.130434782608695%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAhUlEQVQY052RwQ6CMAyG9/4vxJmLwYuEBGLUePAqMVkGKyu0qx0arw6+/Lf+X5qmZkLEeVmI/kZbUaTurkV5qOrWDt6MAGpLBjGqK5f7ozyemvPNeTDWuoAzc5rk5McAkyFiTmouWl8Ndio/+1cIKNtJctzHRx497Nis+lfWH+jRm0LrzW/UEtdBMoJwxAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/5725dd9e9f90f4f0bdc37eb1e7024813/a0b58/argo3.webp 230w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/bc10c/argo3.webp 460w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/966d8/argo3.webp 920w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/445df/argo3.webp 1380w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/ffcc2/argo3.webp 1826w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/5725dd9e9f90f4f0bdc37eb1e7024813/81c8e/argo3.png 230w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/08a84/argo3.png 460w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/c0255/argo3.png 920w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/b1001/argo3.png 1380w","/static/5725dd9e9f90f4f0bdc37eb1e7024813/332b4/argo3.png 1826w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/5725dd9e9f90f4f0bdc37eb1e7024813/c0255/argo3.png","alt":"argo3","title":"argo3","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ban đầu, chúng ta chọn "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"manual sync policy"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/048907e8118485b948585dd05b0b3741/84a78/argo4.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 82.17391304347825%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA4UlEQVQoz51Syw6DMAzj//9wdw47MEZL00eSlrkwJHZgo7OMBFLdGMddYvEhas5LI1i0g5jIgyLCzAnfomeCUpa8j6nimBhKY2dHZOd5MpZ8KCeAEneXg1j8evqi27wCL0mkiyxudqqacfHOL5NDiMxSxSz1n3N7WntgSOHW5/tYah5XgbPVdoLfyWk/HG3/ZIEYti0FEgFdiE20PnRbSagl8I+SJMSn+k9gKMlzMuNzQj3woGHLeXLYS4xp8/ieXAupejnnz8nDY+S1zzXE3zyuaq1LacSyrco4ss7/QeP8C3XusNVNcFqcAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/048907e8118485b948585dd05b0b3741/a0b58/argo4.webp 230w","/static/048907e8118485b948585dd05b0b3741/bc10c/argo4.webp 460w","/static/048907e8118485b948585dd05b0b3741/966d8/argo4.webp 920w","/static/048907e8118485b948585dd05b0b3741/445df/argo4.webp 1380w","/static/048907e8118485b948585dd05b0b3741/2c1a7/argo4.webp 1832w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/048907e8118485b948585dd05b0b3741/81c8e/argo4.png 230w","/static/048907e8118485b948585dd05b0b3741/08a84/argo4.png 460w","/static/048907e8118485b948585dd05b0b3741/c0255/argo4.png 920w","/static/048907e8118485b948585dd05b0b3741/b1001/argo4.png 1380w","/static/048907e8118485b948585dd05b0b3741/84a78/argo4.png 1832w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/048907e8118485b948585dd05b0b3741/c0255/argo4.png","alt":"argo4","title":"argo4","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Lưu ý vì file định nghĩa (ở đây là "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"kustomization.yaml"}]},{"type":"text","value":") nằm ở thư mục gốc repo, nên "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"path"}]},{"type":"text","value":" được đặt là ., tức là dấu chấm."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ứng dụng được tạo nhưng đang thiếu và chưa đồng bộ, vì ta chọn manual sync:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/42257e4e900ba4b6ce44a953ffebf40e/b8bf8/argo5.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 55.21739130434783%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB6UlEQVQoz22RbW/SUBTH+wU2TcoAs+FeiBBXnkqDK1AYc5ku8Y3fUd/NqDPZ5sPQ0CVEETInkbi5YYZEGJXC2tLb3nvLPNsSgujJPyc3N/md/3lgorkHXHaNyz2cDsTn+Gy1dqDrBiZkOBw6jnOVKb14nP8TTPbe6kJqJZhZm74dvynknm3nn7zYfrkjr2/lHz/f2nhbWN/cgZ+NN4WrAsOxYFh/dDYmBVL33aGkOyRWD44bbeXopHn4o1FvtlqK2mwrP1uduqJi6kw6+3jJJyzNJ5avBQQXl9z/+gVZVk8zBsjClNqEWphARtSBbNq20tdHYmKrjwD2hJNTfp7lUqVKoacq7dPfMLaN8YQVVPze7IzEAOmNSrN8xhMWL+FdhPQz3Tx37H5P0bXumaZBFUopwNDF8S9lJOZ6UJjhoGGRvZNwcelSRbYtQ+n2Mba6qqobmqYbumEOBiYsaxL2RhZvJURPRIJtzYSkj+UCJRZMDBcil27jYWH8F3wjKs3xOXCe8sfcYYBlSlCvrwEMnnAPQijMD/pP22w46U2vzMeXoH93JFPe2z3ttN8Vy9VvR5Vqbb92CMtHyDJNBLBNyITzYjAt+oRlduGuK5Qq7xXrjZOnr96/lj/ki5/k0mcbTCmYX0g30Tj8B75h5RCeBB0BAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/42257e4e900ba4b6ce44a953ffebf40e/a0b58/argo5.webp 230w","/static/42257e4e900ba4b6ce44a953ffebf40e/bc10c/argo5.webp 460w","/static/42257e4e900ba4b6ce44a953ffebf40e/966d8/argo5.webp 920w","/static/42257e4e900ba4b6ce44a953ffebf40e/445df/argo5.webp 1380w","/static/42257e4e900ba4b6ce44a953ffebf40e/eaa3b/argo5.webp 1728w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/42257e4e900ba4b6ce44a953ffebf40e/81c8e/argo5.png 230w","/static/42257e4e900ba4b6ce44a953ffebf40e/08a84/argo5.png 460w","/static/42257e4e900ba4b6ce44a953ffebf40e/c0255/argo5.png 920w","/static/42257e4e900ba4b6ce44a953ffebf40e/b1001/argo5.png 1380w","/static/42257e4e900ba4b6ce44a953ffebf40e/b8bf8/argo5.png 1728w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/42257e4e900ba4b6ce44a953ffebf40e/c0255/argo5.png","alt":"argo5","title":"argo5","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Hãy đồng bộ và vào trang app:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/6cd87037fd1633913045859e928ab140/b918a/argo6.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 33.04347826086957%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAABYlAAAWJQFJUiTwAAABFElEQVQY022P2W7EIAxF8/8fV1WV2ofJ2ixsNhhCyD5K3Zn2qUXnARtzOWSALi5Lg4DWjcc6Hdt1XbTOlUe/pLgu53ne7/frv5Wt+74dhx+j0IA+jGnej3PeNu2oVwbJhykt68bNv2RunGhM2vpGYSWgUrYU8ITLRtlK4k8pf3kc8SYrBsh7wxSD4YlaQi3gU9tWOy5bbTkXaPRx7oF4mJuFxuIRlwnr7ZiYDqiW2KOTRDEtyvlKmFqweXA+hmnhoOf79a2ti64UJuusxzBpF55KHbgByVBUFDirHLQNMcQU0yzR5wJyhc1rXhhbUmBtc+s1w0r8vdZYYQl9bDV+XxaG1SRSwxYSbsJ8aHzX8NKKt0F/AUPAg10f8YnVAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/6cd87037fd1633913045859e928ab140/a0b58/argo6.webp 230w","/static/6cd87037fd1633913045859e928ab140/bc10c/argo6.webp 460w","/static/6cd87037fd1633913045859e928ab140/966d8/argo6.webp 920w","/static/6cd87037fd1633913045859e928ab140/445df/argo6.webp 1380w","/static/6cd87037fd1633913045859e928ab140/78de1/argo6.webp 1840w","/static/6cd87037fd1633913045859e928ab140/05d2a/argo6.webp 2780w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/6cd87037fd1633913045859e928ab140/81c8e/argo6.png 230w","/static/6cd87037fd1633913045859e928ab140/08a84/argo6.png 460w","/static/6cd87037fd1633913045859e928ab140/c0255/argo6.png 920w","/static/6cd87037fd1633913045859e928ab140/b1001/argo6.png 1380w","/static/6cd87037fd1633913045859e928ab140/161ec/argo6.png 1840w","/static/6cd87037fd1633913045859e928ab140/b918a/argo6.png 2780w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/6cd87037fd1633913045859e928ab140/c0255/argo6.png","alt":"argo6","title":"argo6","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Có vẻ có gì đó sai, pod có biểu tượng "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"broken heart"}]},{"type":"text","value":". Có thể bắt đầu debug như thường lệ với "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl get po"}]},{"type":"text","value":". Thông tin tương tự cũng xem được từ ArgoCD khi nhấn vào pod:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/8137a058e3e08723c19a069a11382d75/cb1ac/argo7.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 20.869565217391305%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAcUlEQVQI13VOWw6AIAzj/oc1ytgLNrRqTPix6cearI/i7qp2LoDctl1Ucc8H5w9KRFBjc1/MyqIiclTaj+reI7L3AcaHzLzNY4xKxCz5lszpvefTJmp3EAuIFFA+qWZ4LuiEWJcNVUIe9jBTa8j6m30BDr3q3RWpfRUAAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/8137a058e3e08723c19a069a11382d75/a0b58/argo7.webp 230w","/static/8137a058e3e08723c19a069a11382d75/bc10c/argo7.webp 460w","/static/8137a058e3e08723c19a069a11382d75/966d8/argo7.webp 920w","/static/8137a058e3e08723c19a069a11382d75/445df/argo7.webp 1380w","/static/8137a058e3e08723c19a069a11382d75/78de1/argo7.webp 1840w","/static/8137a058e3e08723c19a069a11382d75/cb61f/argo7.webp 1936w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/8137a058e3e08723c19a069a11382d75/81c8e/argo7.png 230w","/static/8137a058e3e08723c19a069a11382d75/08a84/argo7.png 460w","/static/8137a058e3e08723c19a069a11382d75/c0255/argo7.png 920w","/static/8137a058e3e08723c19a069a11382d75/b1001/argo7.png 1380w","/static/8137a058e3e08723c19a069a11382d75/161ec/argo7.png 1840w","/static/8137a058e3e08723c19a069a11382d75/cb1ac/argo7.png 1936w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/8137a058e3e08723c19a069a11382d75/c0255/argo7.png","alt":"argo7","title":"argo7","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Chúng ta đã chỉ định một image không tồn tại. Hãy sửa trên GitHub bằng cách đổi "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"kustomization.yaml"}]},{"type":"text","value":" như sau:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" kustomize.config.k8s.io/v1beta1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Kustomization\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" manifests/deployment.yaml\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" manifests/service.yaml\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"images"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" PROJECT/IMAGE\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"newName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" mluukkai/dwk1"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Khi đồng bộ lại trên ArgoCD, một pod mới khỏe mạnh sẽ được tạo và app đã chạy!"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Có thể kiểm tra external IP bằng "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"kubectl"}]},{"type":"text","value":" hoặc nhấn vào service:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/6c86f/argo8.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 57.391304347826086%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/ElEQVQoz4VQAW6DMAzk/3/bCyZ1WrcJOgYmiePESZzOQKm6ibanEyImd4ev6cF+D9D149fpR/kBAEgWCZx/ymZCOoE5fLbHrgcMYPHYD+9gB4vjMzZq0CN1xrXGTRQxsEEygT0nfX/MxvogIjml8w1yzsx/Jru4iCOzHqpCnyouhZljLrIc73EWFxGHWEpZR4qU82TsSEG2kLtiTR4ng97XumafU0qDw6h2Imqq7nUPFzF6ul1S78cYPQVK7ENw6FfT3Z1rXArbkmvOxTjkyHWw4mPdPu0nw/zbdN1Z2xoR41tbX17lcWHqoQ0l7bbWlbqkFl6Wtmdu83/8BQAWgkrmLrCcAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/a0b58/argo8.webp 230w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/bc10c/argo8.webp 460w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/966d8/argo8.webp 920w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/445df/argo8.webp 1380w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/9d85b/argo8.webp 1720w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/81c8e/argo8.png 230w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/08a84/argo8.png 460w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/c0255/argo8.png 920w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/b1001/argo8.png 1380w","/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/6c86f/argo8.png 1720w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/c0255/argo8.png","alt":"argo8","title":"argo8","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bây giờ hãy đổi chế độ đồng bộ sang "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"automatic"}]},{"type":"text","value":" bằng cách nhấn "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Details"}]},{"type":"text","value":" trên trang app trong ArgoCD."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Từ giờ mọi thay đổi cấu hình trên GitHub sẽ được ArgoCD tự động áp dụng. Hãy thử scale deployment lên 5 pod:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" apps/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Deployment\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" dwk1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"app"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"dep\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"replicas"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"5"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"matchLabels"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" dwk1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"app\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"template"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"..."}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sau một lúc (chu kỳ đồng bộ mặc định của ArgoCD là 180 giây), app sẽ được đồng bộ và có 5 pod chạy:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/7a969076cce54007f1e967c1b9c6a1d6/77085/argo9.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 45.65217391304348%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAABYlAAAWJQFJUiTwAAABWUlEQVQoz3VQy1LDMAzM/38Xd2BCSYc8CKkfsSXLTuw2DWkblHJghgHNHjQrrbRSJrwbYlKjpxCO12W6XdZ1NccoY0jLPF8vN47178jmy/K5LCElcDSkNM0zs3E6KUQ/jmNMXF7/E/sxpdOUjpMGEpYkeOVC74K85xswSPSCefTaBY13bInP2h4PlgRQq7FWUCmopS2FqTVWEt65apww1NPYWfcmbdFjoWEnzd66rGGNhFLaagPwIEnepxRP5wP4RgHwNWxtOvPCN2FyR/sx5hZ3FLKH58IMXD6HdGIXtbCNBnZRCVseDLvoepZHvk6B38TWvVLIe9ix7X2rPnonrW+4uzMd+wRnKfjxyC4aCXwRq9Xd/CY2uEN6PGhOslY73vYNbm0VdMbxnziphflQyH+iEJXFzmAp7AtQ4YdH2efAN0v4BZ5SbbN+mHeF33wpIUcqwvCkTQ70BazU8IjWLkqtAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/7a969076cce54007f1e967c1b9c6a1d6/a0b58/argo9.webp 230w","/static/7a969076cce54007f1e967c1b9c6a1d6/bc10c/argo9.webp 460w","/static/7a969076cce54007f1e967c1b9c6a1d6/966d8/argo9.webp 920w","/static/7a969076cce54007f1e967c1b9c6a1d6/445df/argo9.webp 1380w","/static/7a969076cce54007f1e967c1b9c6a1d6/78de1/argo9.webp 1840w","/static/7a969076cce54007f1e967c1b9c6a1d6/96199/argo9.webp 2764w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/7a969076cce54007f1e967c1b9c6a1d6/81c8e/argo9.png 230w","/static/7a969076cce54007f1e967c1b9c6a1d6/08a84/argo9.png 460w","/static/7a969076cce54007f1e967c1b9c6a1d6/c0255/argo9.png 920w","/static/7a969076cce54007f1e967c1b9c6a1d6/b1001/argo9.png 1380w","/static/7a969076cce54007f1e967c1b9c6a1d6/161ec/argo9.png 1840w","/static/7a969076cce54007f1e967c1b9c6a1d6/77085/argo9.png 2764w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/7a969076cce54007f1e967c1b9c6a1d6/c0255/argo9.png","alt":"argo9","title":"argo9","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ngoài service, deployment và pod, cây cấu hình app còn hiển thị các đối tượng khác. Ta thấy có "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"ReplicaSet"}]},{"type":"text","value":" (ký hiệu "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"rs"}]},{"type":"text","value":") nằm giữa deployment và pod. ReplicaSet là đối tượng Kubernetes đảm bảo luôn có số lượng pod ổn định cho một workload. ReplicaSet định nghĩa số pod giống hệt cần chạy, nếu pod bị loại bỏ hoặc lỗi sẽ tạo thêm pod bù vào. Người dùng thường không định nghĩa ReplicaSet trực tiếp mà dùng Deployment, Deployment sẽ tạo ReplicaSet để quản lý pod."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Các thay đổi cấu hình Kubernetes của app trên GitHub giờ đã được đồng bộ đẹp đẽ vào cụm. Vậy còn thay đổi mã nguồn app thì sao?"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Để triển khai phiên bản app mới, cần đổi image dùng trong deployment. Hiện image được định nghĩa trong "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"kustomization.yaml"}]},{"type":"text","value":":"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" kustomize.config.k8s.io/v1beta1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Kustomization\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" manifests/deployment.yaml\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" manifests/service.yaml\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"images"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" PROJECT/IMAGE\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"newName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" mluukkai/dwk1"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vậy để triển khai app mới, cần:"}]},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"tạo image mới với tag mới (nếu có)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"đổi kustomization.yaml để dùng image mới"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"push thay đổi lên GitHub"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Có thể làm thủ công nhưng như vậy là chưa đủ. Hãy định nghĩa workflow GitHub Actions tự động hóa các bước này."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bước đầu đã quen thuộc từ "},{"type":"element","tagName":"a","properties":{"href":"/part-3/2-deployment-pipeline"},"children":[{"type":"text","value":"phần 3"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bước 2 có thể làm với lệnh "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"kustomize edit"}]},{"type":"text","value":":"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"text","value":"$ kustomize edit set image PROJECT/IMAGE=node"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"20"}]},{"type":"text","value":"\n$ cat kustomization.yaml\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" kustomize.config.k8s.io/v1beta1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Kustomization\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" manifests/deployment.yaml\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" manifests/service.yaml\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"images"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" PROJECT/IMAGE\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"newName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" node\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"newTag"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"20\""}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Như thấy, lệnh này "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"thay đổi"}]},{"type":"text","value":" file "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"kustomization.yaml"}]},{"type":"text","value":". Việc còn lại là commit file vào repo. May mắn là đã có GitHub Action "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/EndBug/add-and-commit","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"add-and-commit"}]},{"type":"text","value":" cho việc này!"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Workflow như sau:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Build and publish application\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"push"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"jobs"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"build-publish"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Build"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" Push"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":" Release\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"runs-on"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ubuntu"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"latest\n\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"steps"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Checkout\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"uses"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" actions/checkout@v4\n\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Login to Docker Hub\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"uses"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" docker/login"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"action@v3\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"with"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"username"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" $"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" secrets.DOCKERHUB_USERNAME "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"password"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" $"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" secrets.DOCKERHUB_TOKEN "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\n\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# tag image với GitHub SHA để có tag duy nhất"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Build and publish backend\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"run"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"|"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"\n          docker build "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"tag \"mluukkai/dwk1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"$GITHUB_SHA\" .\n          docker push \"mluukkai/dwk1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"$GITHUB_SHA\"\n\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Set up Kustomize\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"uses"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" imranismail/setup"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"kustomize@v2\n\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Use right image\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"run"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" kustomize edit set image PROJECT/IMAGE=mluukkai/dwk1"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"$GITHUB_SHA\n\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" commit kustomization.yaml to GitHub\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"uses"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" EndBug/add"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"and"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"commit@v9\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"with"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"add"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"kustomization.yaml\""}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"message"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" New version released $"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" github.sha "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Còn một việc nữa, trong cài đặt repo cần cấp quyền ghi cho GitHub Actions:"}]},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/099030fe16625510838386413508f6e5/9efb3/gha-perm.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 38.260869565217384%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABYlAAAWJQFJUiTwAAABD0lEQVQY042QaY6EIBSEvf/p5gC27QIogkALGmWdsk0m/pzKBym29ypUhAk2LWyUmPth6oaJTUrpbbWndf7JepstaLNzYU6lqgilFEvxMVLK2DhhYN73HSchRB+C9yEGD+BSvLz3JzarAoVYtI3GtXQkA2m7ruv7fhgmzhkdUYsQ1nPzHk1NlpqaF4XX27ZVJeekbf5pQi8brl51/W67pmkJZeazGvNR2rht348Qc7kCpgt46Nu5lK8vzjkEnmc5C8m5oGwcJw5Wa4/jOE9w5nzf/XuMdUKAjD5CiPlC4tOkXICQEiwK0lobjTzrepeoykN8luh1XV0UEEKiFpbYuP7soUfnO3nO1m0p5fJv/QLGgMjXxrD94AAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"picture","properties":{},"children":[{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/099030fe16625510838386413508f6e5/a0b58/gha-perm.webp 230w","/static/099030fe16625510838386413508f6e5/bc10c/gha-perm.webp 460w","/static/099030fe16625510838386413508f6e5/966d8/gha-perm.webp 920w","/static/099030fe16625510838386413508f6e5/445df/gha-perm.webp 1380w","/static/099030fe16625510838386413508f6e5/78de1/gha-perm.webp 1840w","/static/099030fe16625510838386413508f6e5/eb397/gha-perm.webp 1894w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/webp"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"source","properties":{"srcSet":["/static/099030fe16625510838386413508f6e5/81c8e/gha-perm.png 230w","/static/099030fe16625510838386413508f6e5/08a84/gha-perm.png 460w","/static/099030fe16625510838386413508f6e5/c0255/gha-perm.png 920w","/static/099030fe16625510838386413508f6e5/b1001/gha-perm.png 1380w","/static/099030fe16625510838386413508f6e5/161ec/gha-perm.png 1840w","/static/099030fe16625510838386413508f6e5/9efb3/gha-perm.png 1894w"],"sizes":["(max-width:","920px)","100vw,","920px"],"type":"image/png"},"children":[]},{"type":"text","value":"\n        "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"src":"/static/099030fe16625510838386413508f6e5/c0255/gha-perm.png","alt":"gha perm","title":"gha perm","loading":"lazy","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"},"children":[]},{"type":"text","value":"\n      "}]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Giờ mọi thay đổi cấu hình và mã nguồn app đều được ArgoCD tự động triển khai nhờ workflow GitHub Action, thật tuyệt!"}]},{"type":"element","tagName":"exercise","properties":{"name":"Bài tập 4.07: GitOps cho Project"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Chuyển ứng dụng "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Ping-pong"}]},{"type":"text","value":" sang dùng GitOps để mỗi khi bạn commit lên repo, ứng dụng sẽ tự động được cập nhật."}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nếu một app có nhiều môi trường như production, staging, testing, cách định nghĩa môi trường đơn giản sẽ dẫn đến nhiều copy-paste. Khi dùng Kustomize, "},{"type":"element","tagName":"a","properties":{"href":"https://kubectl.docs.kubernetes.io/guides/example/multi_base/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"khuyến nghị"}]},{"type":"text","value":" là định nghĩa một "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"base"}]},{"type":"text","value":" chung cho mọi môi trường và các overlay riêng cho từng môi trường, nơi chỉ định phần khác biệt."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ví dụ đơn giản như sau. Tạo cấu trúc thư mục:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":".\n├── base\n│   ├── deployment.yaml\n│   └── kustomization.yaml\n└── overlays\n    ├── prod\n    │   ├── deployment.yaml\n    │   └── kustomization.yaml\n    └── staging\n        └── kustomization.yaml"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"base/deployment.yaml"}]},{"type":"text","value":" như sau:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" apps/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Deployment\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" myapp"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"dep\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"replicas"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"matchLabels"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" myapp\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"template"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"labels"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" myapp\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"containers"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" myapp\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" PROJECT/IMAGE"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"base/kustomization.yaml"}]},{"type":"text","value":" rất đơn giản:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" deployment.yaml"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Môi trường production sửa base bằng cách đổi số replica thành 3. "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"overlays/prod/deployment.yaml"}]},{"type":"text","value":" như sau:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" apps/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Deployment\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" dep\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"replicas"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Chỉ cần định nghĩa phần khác biệt."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"overlays/prod/kustomization.yaml"}]},{"type":"text","value":" như sau:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" ./../../base\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"patches"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"path"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" deployment.yaml\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"namePrefix"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" prod"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"images"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" PROJECT/IMAGE\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"newName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" nginx"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"1.25"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"bookworm"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nó tham chiếu base và "},{"type":"element","tagName":"a","properties":{"href":"https://kubectl.docs.kubernetes.io/references/kustomize/kustomization/patches/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"patches"}]},{"type":"text","value":" deployment để đặt số replica thành 3."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"overlays/staging/kustomization.yaml"}]},{"type":"text","value":" chỉ đặt image:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" ./../../base\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"namePrefix"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" staging"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"images"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" PROJECT/IMAGE\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"newName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" nginx"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"1.25.5"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"alpine"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Giờ production và staging có thể triển khai bằng ArgoCD bằng cách trỏ đến thư mục overlay tương ứng."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Chúng ta đã dùng giao diện ArgoCD để định nghĩa ứng dụng. Ngoài ra còn các cách khác. Có thể "},{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/getting_started/#2-download-argo-cd-cli","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"cài đặt"}]},{"type":"text","value":" và dùng "},{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/getting_started/#creating-apps-via-cli","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Argo CLI"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Một lựa chọn nữa là dùng cách "},{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/operator-manual/declarative-setup/#declarative-setup","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"khai báo"}]},{"type":"text","value":" với "},{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/operator-manual/declarative-setup/#applications","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Application"}]},{"type":"text","value":" Custom Resource Definition:"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Với phiên bản production, định nghĩa như sau:"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"application.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" argoproj.io/v1alpha1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Application\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" myapp"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"production\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"namespace"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" argocd\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"project"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" default\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"source"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"repoURL"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" https"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"//github.com/mluukkai/gitopstest\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"path"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" overlays/prod\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"targetRevision"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" HEAD\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"destination"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"server"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" https"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"//kubernetes.default.svc\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"namespace"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" default\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"syncPolicy"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"automated"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"prune"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean","important"]},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selfHeal"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean","important"]},"children":[{"type":"text","value":"true"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Khai báo application cho ArgoCD bằng lệnh:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"kubectl apply -n argocd -f application.yaml"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Với GitOps, chúng ta đạt được:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bảo mật tốt hơn"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Không ai cần truy cập cụm, kể cả dịch vụ CI/CD. Không cần chia sẻ quyền truy cập cụm cho cộng tác viên; họ chỉ cần commit như mọi người khác."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Minh bạch hơn"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Mọi thứ đều được khai báo trong repository GitHub. Khi có người mới vào nhóm, chỉ cần xem repo; không cần truyền đạt kiến thức cũ hay mẹo ẩn nào cả."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Truy vết tốt hơn"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Mọi thay đổi với cụm đều được kiểm soát phiên bản. Bạn sẽ biết chính xác trạng thái cụm và ai đã thay đổi, thay đổi như thế nào."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Giảm rủi ro"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Nếu có sự cố, chỉ cần revert cụm về commit hoạt động. "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"git revert"}]},{"type":"text","value":" và toàn bộ cụm trở lại trạng thái trước đó."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Dễ di chuyển"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Muốn đổi nhà cung cấp? Tạo cụm mới và trỏ về cùng repo - cụm của bạn đã ở đó."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Có một số lựa chọn cho setup GitOps. Ở đây chúng ta để cấu hình ứng dụng cùng repo với mã nguồn. Một lựa chọn khác là tách cấu hình khỏi mã nguồn. ArgoCD liệt kê nhiều lý do thuyết phục rằng tách repo là "},{"type":"element","tagName":"a","properties":{"href":"https://argo-cd.readthedocs.io/en/stable/user-guide/best_practices/#separating-config-vs-source-code-repositories","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"best practice"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"exercise","properties":{"name":"Bài tập 4.08: GitOps cho Project"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Chuyển Project sang dùng GitOps."}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Tạo hai môi trường riêng biệt, "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"production"}]},{"type":"text","value":" và "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"staging"}]},{"type":"text","value":" ở namespace riêng"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Mỗi commit lên nhánh main sẽ triển khai lên môi trường staging"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Mỗi commit "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"tagged"}]},{"type":"text","value":" sẽ triển khai lên môi trường production"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Ở staging, broadcaster chỉ log các tin nhắn, không chuyển tiếp ra ngoài"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Ở staging, database không cần backup"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Bạn có thể giả định "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"secrets"}]},{"type":"text","value":" đã được apply sẵn ngoài ArgoCD"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Bonus: dùng repo riêng biệt cho code và cấu hình"}]},{"type":"text","value":"\n"}]}]}]},"html":"<div><text-box variant='learningObjectives' name='Mục tiêu học tập'><p>Sau phần này, bạn có thể</p><ul>\n<li>so sánh GitOps với các phương pháp triển khai khác</li>\n<li>so sánh triển khai kiểu push truyền thống với triển khai kiểu pull</li>\n<li>triển khai GitOps trong cụm Kubernetes của bạn</li>\n</ul></text-box><p>Một pipeline triển khai đơn giản mà chúng ta đã sử dụng và học qua thường như sau:</p><ol>\n<li>Lập trình viên thực hiện git push với mã đã chỉnh sửa, ví dụ lên GitHub</li>\n<li>Điều này kích hoạt một dịch vụ CI/CD bắt đầu chạy, ví dụ GitHub Actions</li>\n<li>Dịch vụ CI/CD chạy kiểm thử, build image, đẩy image lên registry và triển khai image mới, ví dụ lên Kubernetes</li>\n</ol><p>Cách này gọi là triển khai kiểu push. Tên gọi này rất mô tả vì mọi thứ được đẩy đi bởi bước trước đó. Tuy nhiên, có một số thách thức với cách tiếp cận push. Ví dụ, nếu chúng ta có một cụm Kubernetes không cho phép kết nối từ bên ngoài (ví dụ cụm trên máy cá nhân hoặc bất kỳ cụm nào không muốn cho người ngoài truy cập), khi đó CI/CD không thể push cập nhật vào cụm.</p><p>Với cấu hình pull, mọi thứ được đảo ngược. Chúng ta có thể để cụm, chạy ở bất cứ đâu, <strong>kéo</strong> image mới và tự động triển khai nó. Image mới vẫn được kiểm thử và build bởi CI/CD. Chúng ta chỉ đơn giản là chuyển phần triển khai từ CI/CD sang một hệ thống khác thực hiện việc pull.</p><text-box name=\"Watchtower\" variant=\"hint\"><p>Nếu bạn đã hoàn thành khóa DevOps với Docker, có thể bạn đã nghe về <a href=\"https://github.com/containrrr/watchtower\" target=\"_blank\" rel=\"noopener noreferrer\">watchtower</a>, công cụ cho phép chuyển các bước cuối của pipeline triển khai từ push sang pull khi chạy dịch vụ với docker-compose.</p></text-box><p>GitOps chính là về sự đảo ngược này và thúc đẩy các thực tiễn tốt cho vận hành. Điều này đạt được bằng cách để trạng thái của cụm nằm trong một repository git. Như vậy ngoài việc xử lý triển khai ứng dụng, nó còn xử lý mọi thay đổi của cụm. Điều này đòi hỏi cấu hình bổ sung và thay đổi tư duy so với truyền thống cấu hình máy chủ. Nhưng khi đã làm được, GitOps sẽ là dấu chấm hết cho quản lý cụm kiểu mệnh lệnh.</p><p><a href=\"https://argo-cd.readthedocs.io/en/stable/\" target=\"_blank\" rel=\"noopener noreferrer\">ArgoCD</a> là công cụ được lựa chọn. Cuối cùng, quy trình làm việc của chúng ta sẽ như sau:</p><ol>\n<li>Lập trình viên git push mã hoặc cấu hình đã chỉnh sửa.</li>\n<li>Dịch vụ CI/CD (ở đây là GitHub Actions) bắt đầu chạy.</li>\n<li>CI/CD build và đẩy image mới <em>và</em> commit chỉnh sửa vào nhánh \"release\" (ở đây là main)</li>\n<li>ArgoCD sẽ lấy trạng thái mô tả trong nhánh release và áp dụng cho cụm.</li>\n</ol><p>Bắt đầu bằng việc cài đặt ArgoCD theo <a href=\"https://argo-cd.readthedocs.io/en/stable/getting_started/\" target=\"_blank\" rel=\"noopener noreferrer\">Getting started</a> trong tài liệu:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl create namespace argocd\nkubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml</code></pre></div><p>Giờ ArgoCD đã chạy trong cụm. Chúng ta cần mở quyền truy cập cho nó. Có nhiều <a href=\"https://argo-cd.readthedocs.io/en/stable/getting_started/#3-access-the-argo-cd-api-server\" target=\"_blank\" rel=\"noopener noreferrer\">tùy chọn</a>. Ở đây sẽ dùng LoadBalancer:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl patch svc argocd-server -n argocd -p <span class=\"token string\">'{\"spec\": {\"type\": \"LoadBalancer\"}}'</span></code></pre></div><p>Sau một lúc, cụm sẽ cung cấp external IP:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ kubectl get svc -n argocd\nNAME               TYPE           CLUSTER-IP    EXTERNAL-IP   PORT<span class=\"token punctuation\">(</span>S<span class=\"token punctuation\">)</span>                      AGE\n<span class=\"token punctuation\">..</span>.\nargocd-server      LoadBalancer   <span class=\"token number\">10.7</span>.5.82     <span class=\"token number\">34.88</span>.152.2   <span class=\"token number\">80</span>:32029/TCP,443:30574/TCP   17min</code></pre></div><p>Mật khẩu ban đầu cho tài khoản <em>admin</em> được tạo tự động và lưu dưới dạng văn bản thuần trong trường password của secret <em>argocd-initial-admin-secret</em> trong namespace cài đặt ArgoCD. Lấy nó bằng cách giải mã base64 giá trị lấy được từ lệnh:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get -n argocd secrets argocd-initial-admin-secret -o yaml</code></pre></div><p>Bây giờ có thể đăng nhập:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/9960d78be7b36c3c387923af1cf4accc/29114/argo2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 62.60869565217391%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB7UlEQVQoz3WQyW/TUBDGfQEEBygHDiBo1aKyFhVIN5VWUA4oJxD0xHbkX0O9UJWiilCFCLWBInDI5sRbnl/sZzveEjuLRIlrYBIjX3Ct32H0zftmvjHFIcwyLFdisIAszSKapek20Gz1ur1+Z8Cvdjceaj75JJFcHbk6l3z+quW1O91eEAS+f+AfDOj3/b7v//4T/1EXE8tjsytHLly7+/jF9s7XtXfbW5ns67epN+8zm+kdKNZTmZ/7+/D0/xHU+VvLk4sPTkxMr6y+9Do9YliybqiGbbttx22bTU+FfEEQv3l87j5sPjY2tfTomeZ4xHZls0ksF2pABcXxJN3m6zpf15BqDnU3hBqduXd2+s7x8RuLD5/WNAvpdgjUQ2xeMXIs+sHhPIdpVqpgLepSZ6YWzt1cOjl5G8yRM0JqOGVEKogwiJREmcVqSVSiLgW2kcszR0evH2au1jXYCZkheVGowywQ/5lPXUqcvjILNx9mBoqinGMlGJHnMaQNxXgz3BnaaqopDgED7IfkAjGhJWoWiPAgfrOoWpzcyHNor1DdK7IFXmKQkmNrRQHTFeFbmaerIq804s0CMeBduaYUeMxI5MNnem3rI7CR3oXfBjrMqkgkNvbgKmw0Q2Sr9YkubaSzm5kvqex3yYhazl/MZlHVn92WAAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/9960d78be7b36c3c387923af1cf4accc/a0b58/argo2.webp 230w,\n/static/9960d78be7b36c3c387923af1cf4accc/bc10c/argo2.webp 460w,\n/static/9960d78be7b36c3c387923af1cf4accc/966d8/argo2.webp 920w,\n/static/9960d78be7b36c3c387923af1cf4accc/445df/argo2.webp 1380w,\n/static/9960d78be7b36c3c387923af1cf4accc/78de1/argo2.webp 1840w,\n/static/9960d78be7b36c3c387923af1cf4accc/882b9/argo2.webp 1920w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/9960d78be7b36c3c387923af1cf4accc/81c8e/argo2.png 230w,\n/static/9960d78be7b36c3c387923af1cf4accc/08a84/argo2.png 460w,\n/static/9960d78be7b36c3c387923af1cf4accc/c0255/argo2.png 920w,\n/static/9960d78be7b36c3c387923af1cf4accc/b1001/argo2.png 1380w,\n/static/9960d78be7b36c3c387923af1cf4accc/161ec/argo2.png 1840w,\n/static/9960d78be7b36c3c387923af1cf4accc/29114/argo2.png 1920w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/9960d78be7b36c3c387923af1cf4accc/c0255/argo2.png\" alt=\"argo2\" title=\"argo2\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Hãy triển khai ứng dụng đơn giản tại <a href=\"https://github.com/mluukkai/dwk-app1\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/mluukkai/dwk-app1</a> bằng ArgoCD. Bắt đầu bằng cách nhấn <em>New app</em> và điền form mở ra:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/5725dd9e9f90f4f0bdc37eb1e7024813/332b4/argo3.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 39.130434782608695%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAhUlEQVQY052RwQ6CMAyG9/4vxJmLwYuEBGLUePAqMVkGKyu0qx0arw6+/Lf+X5qmZkLEeVmI/kZbUaTurkV5qOrWDt6MAGpLBjGqK5f7ozyemvPNeTDWuoAzc5rk5McAkyFiTmouWl8Ndio/+1cIKNtJctzHRx497Nis+lfWH+jRm0LrzW/UEtdBMoJwxAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/5725dd9e9f90f4f0bdc37eb1e7024813/a0b58/argo3.webp 230w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/bc10c/argo3.webp 460w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/966d8/argo3.webp 920w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/445df/argo3.webp 1380w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/ffcc2/argo3.webp 1826w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/5725dd9e9f90f4f0bdc37eb1e7024813/81c8e/argo3.png 230w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/08a84/argo3.png 460w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/c0255/argo3.png 920w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/b1001/argo3.png 1380w,\n/static/5725dd9e9f90f4f0bdc37eb1e7024813/332b4/argo3.png 1826w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/5725dd9e9f90f4f0bdc37eb1e7024813/c0255/argo3.png\" alt=\"argo3\" title=\"argo3\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Ban đầu, chúng ta chọn <em>manual sync policy</em>.</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/048907e8118485b948585dd05b0b3741/84a78/argo4.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 82.17391304347825%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA4UlEQVQoz51Syw6DMAzj//9wdw47MEZL00eSlrkwJHZgo7OMBFLdGMddYvEhas5LI1i0g5jIgyLCzAnfomeCUpa8j6nimBhKY2dHZOd5MpZ8KCeAEneXg1j8evqi27wCL0mkiyxudqqacfHOL5NDiMxSxSz1n3N7WntgSOHW5/tYah5XgbPVdoLfyWk/HG3/ZIEYti0FEgFdiE20PnRbSagl8I+SJMSn+k9gKMlzMuNzQj3woGHLeXLYS4xp8/ieXAupejnnz8nDY+S1zzXE3zyuaq1LacSyrco4ss7/QeP8C3XusNVNcFqcAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/048907e8118485b948585dd05b0b3741/a0b58/argo4.webp 230w,\n/static/048907e8118485b948585dd05b0b3741/bc10c/argo4.webp 460w,\n/static/048907e8118485b948585dd05b0b3741/966d8/argo4.webp 920w,\n/static/048907e8118485b948585dd05b0b3741/445df/argo4.webp 1380w,\n/static/048907e8118485b948585dd05b0b3741/2c1a7/argo4.webp 1832w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/048907e8118485b948585dd05b0b3741/81c8e/argo4.png 230w,\n/static/048907e8118485b948585dd05b0b3741/08a84/argo4.png 460w,\n/static/048907e8118485b948585dd05b0b3741/c0255/argo4.png 920w,\n/static/048907e8118485b948585dd05b0b3741/b1001/argo4.png 1380w,\n/static/048907e8118485b948585dd05b0b3741/84a78/argo4.png 1832w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/048907e8118485b948585dd05b0b3741/c0255/argo4.png\" alt=\"argo4\" title=\"argo4\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Lưu ý vì file định nghĩa (ở đây là <em>kustomization.yaml</em>) nằm ở thư mục gốc repo, nên <em>path</em> được đặt là ., tức là dấu chấm.</p><p>Ứng dụng được tạo nhưng đang thiếu và chưa đồng bộ, vì ta chọn manual sync:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/42257e4e900ba4b6ce44a953ffebf40e/b8bf8/argo5.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 55.21739130434783%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB6UlEQVQoz22RbW/SUBTH+wU2TcoAs+FeiBBXnkqDK1AYc5ku8Y3fUd/NqDPZ5sPQ0CVEETInkbi5YYZEGJXC2tLb3nvLPNsSgujJPyc3N/md/3lgorkHXHaNyz2cDsTn+Gy1dqDrBiZkOBw6jnOVKb14nP8TTPbe6kJqJZhZm74dvynknm3nn7zYfrkjr2/lHz/f2nhbWN/cgZ+NN4WrAsOxYFh/dDYmBVL33aGkOyRWD44bbeXopHn4o1FvtlqK2mwrP1uduqJi6kw6+3jJJyzNJ5avBQQXl9z/+gVZVk8zBsjClNqEWphARtSBbNq20tdHYmKrjwD2hJNTfp7lUqVKoacq7dPfMLaN8YQVVPze7IzEAOmNSrN8xhMWL+FdhPQz3Tx37H5P0bXumaZBFUopwNDF8S9lJOZ6UJjhoGGRvZNwcelSRbYtQ+n2Mba6qqobmqYbumEOBiYsaxL2RhZvJURPRIJtzYSkj+UCJRZMDBcil27jYWH8F3wjKs3xOXCe8sfcYYBlSlCvrwEMnnAPQijMD/pP22w46U2vzMeXoH93JFPe2z3ttN8Vy9VvR5Vqbb92CMtHyDJNBLBNyITzYjAt+oRlduGuK5Qq7xXrjZOnr96/lj/ki5/k0mcbTCmYX0g30Tj8B75h5RCeBB0BAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/42257e4e900ba4b6ce44a953ffebf40e/a0b58/argo5.webp 230w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/bc10c/argo5.webp 460w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/966d8/argo5.webp 920w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/445df/argo5.webp 1380w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/eaa3b/argo5.webp 1728w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/42257e4e900ba4b6ce44a953ffebf40e/81c8e/argo5.png 230w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/08a84/argo5.png 460w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/c0255/argo5.png 920w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/b1001/argo5.png 1380w,\n/static/42257e4e900ba4b6ce44a953ffebf40e/b8bf8/argo5.png 1728w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/42257e4e900ba4b6ce44a953ffebf40e/c0255/argo5.png\" alt=\"argo5\" title=\"argo5\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Hãy đồng bộ và vào trang app:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6cd87037fd1633913045859e928ab140/b918a/argo6.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.04347826086957%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAABYlAAAWJQFJUiTwAAABFElEQVQY022P2W7EIAxF8/8fV1WV2ofJ2ixsNhhCyD5K3Zn2qUXnARtzOWSALi5Lg4DWjcc6Hdt1XbTOlUe/pLgu53ne7/frv5Wt+74dhx+j0IA+jGnej3PeNu2oVwbJhykt68bNv2RunGhM2vpGYSWgUrYU8ITLRtlK4k8pf3kc8SYrBsh7wxSD4YlaQi3gU9tWOy5bbTkXaPRx7oF4mJuFxuIRlwnr7ZiYDqiW2KOTRDEtyvlKmFqweXA+hmnhoOf79a2ti64UJuusxzBpF55KHbgByVBUFDirHLQNMcQU0yzR5wJyhc1rXhhbUmBtc+s1w0r8vdZYYQl9bDV+XxaG1SRSwxYSbsJ8aHzX8NKKt0F/AUPAg10f8YnVAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/6cd87037fd1633913045859e928ab140/a0b58/argo6.webp 230w,\n/static/6cd87037fd1633913045859e928ab140/bc10c/argo6.webp 460w,\n/static/6cd87037fd1633913045859e928ab140/966d8/argo6.webp 920w,\n/static/6cd87037fd1633913045859e928ab140/445df/argo6.webp 1380w,\n/static/6cd87037fd1633913045859e928ab140/78de1/argo6.webp 1840w,\n/static/6cd87037fd1633913045859e928ab140/05d2a/argo6.webp 2780w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/6cd87037fd1633913045859e928ab140/81c8e/argo6.png 230w,\n/static/6cd87037fd1633913045859e928ab140/08a84/argo6.png 460w,\n/static/6cd87037fd1633913045859e928ab140/c0255/argo6.png 920w,\n/static/6cd87037fd1633913045859e928ab140/b1001/argo6.png 1380w,\n/static/6cd87037fd1633913045859e928ab140/161ec/argo6.png 1840w,\n/static/6cd87037fd1633913045859e928ab140/b918a/argo6.png 2780w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/6cd87037fd1633913045859e928ab140/c0255/argo6.png\" alt=\"argo6\" title=\"argo6\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Có vẻ có gì đó sai, pod có biểu tượng <em>broken heart</em>. Có thể bắt đầu debug như thường lệ với <code class=\"language-text\">kubectl get po</code>. Thông tin tương tự cũng xem được từ ArgoCD khi nhấn vào pod:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/8137a058e3e08723c19a069a11382d75/cb1ac/argo7.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 20.869565217391305%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAcUlEQVQI13VOWw6AIAzj/oc1ytgLNrRqTPix6cearI/i7qp2LoDctl1Ucc8H5w9KRFBjc1/MyqIiclTaj+reI7L3AcaHzLzNY4xKxCz5lszpvefTJmp3EAuIFFA+qWZ4LuiEWJcNVUIe9jBTa8j6m30BDr3q3RWpfRUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/8137a058e3e08723c19a069a11382d75/a0b58/argo7.webp 230w,\n/static/8137a058e3e08723c19a069a11382d75/bc10c/argo7.webp 460w,\n/static/8137a058e3e08723c19a069a11382d75/966d8/argo7.webp 920w,\n/static/8137a058e3e08723c19a069a11382d75/445df/argo7.webp 1380w,\n/static/8137a058e3e08723c19a069a11382d75/78de1/argo7.webp 1840w,\n/static/8137a058e3e08723c19a069a11382d75/cb61f/argo7.webp 1936w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/8137a058e3e08723c19a069a11382d75/81c8e/argo7.png 230w,\n/static/8137a058e3e08723c19a069a11382d75/08a84/argo7.png 460w,\n/static/8137a058e3e08723c19a069a11382d75/c0255/argo7.png 920w,\n/static/8137a058e3e08723c19a069a11382d75/b1001/argo7.png 1380w,\n/static/8137a058e3e08723c19a069a11382d75/161ec/argo7.png 1840w,\n/static/8137a058e3e08723c19a069a11382d75/cb1ac/argo7.png 1936w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/8137a058e3e08723c19a069a11382d75/c0255/argo7.png\" alt=\"argo7\" title=\"argo7\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Chúng ta đã chỉ định một image không tồn tại. Hãy sửa trên GitHub bằng cách đổi <em>kustomization.yaml</em> như sau:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kustomize.config.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Kustomization\n<span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> manifests/deployment.yaml\n  <span class=\"token punctuation\">-</span> manifests/service.yaml\n<span class=\"token key atrule\">images</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> PROJECT/IMAGE\n    <span class=\"token key atrule\">newName</span><span class=\"token punctuation\">:</span> mluukkai/dwk1</code></pre></div><p>Khi đồng bộ lại trên ArgoCD, một pod mới khỏe mạnh sẽ được tạo và app đã chạy!</p><p>Có thể kiểm tra external IP bằng <em>kubectl</em> hoặc nhấn vào service:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/6c86f/argo8.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 57.391304347826086%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/ElEQVQoz4VQAW6DMAzk/3/bCyZ1WrcJOgYmiePESZzOQKm6ibanEyImd4ev6cF+D9D149fpR/kBAEgWCZx/ymZCOoE5fLbHrgcMYPHYD+9gB4vjMzZq0CN1xrXGTRQxsEEygT0nfX/MxvogIjml8w1yzsx/Jru4iCOzHqpCnyouhZljLrIc73EWFxGHWEpZR4qU82TsSEG2kLtiTR4ng97XumafU0qDw6h2Imqq7nUPFzF6ul1S78cYPQVK7ENw6FfT3Z1rXArbkmvOxTjkyHWw4mPdPu0nw/zbdN1Z2xoR41tbX17lcWHqoQ0l7bbWlbqkFl6Wtmdu83/8BQAWgkrmLrCcAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/a0b58/argo8.webp 230w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/bc10c/argo8.webp 460w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/966d8/argo8.webp 920w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/445df/argo8.webp 1380w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/9d85b/argo8.webp 1720w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/81c8e/argo8.png 230w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/08a84/argo8.png 460w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/c0255/argo8.png 920w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/b1001/argo8.png 1380w,\n/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/6c86f/argo8.png 1720w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/7ef3a0e2bba7ab9bfce7ebf6e8cf60c6/c0255/argo8.png\" alt=\"argo8\" title=\"argo8\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Bây giờ hãy đổi chế độ đồng bộ sang <em>automatic</em> bằng cách nhấn <em>Details</em> trên trang app trong ArgoCD.</p><p>Từ giờ mọi thay đổi cấu hình trên GitHub sẽ được ArgoCD tự động áp dụng. Hãy thử scale deployment lên 5 pod:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dwk1<span class=\"token punctuation\">-</span>app<span class=\"token punctuation\">-</span>dep\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> dwk1<span class=\"token punctuation\">-</span>app\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">...</span></code></pre></div><p>Sau một lúc (chu kỳ đồng bộ mặc định của ArgoCD là 180 giây), app sẽ được đồng bộ và có 5 pod chạy:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/7a969076cce54007f1e967c1b9c6a1d6/77085/argo9.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 45.65217391304348%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAABYlAAAWJQFJUiTwAAABWUlEQVQoz3VQy1LDMAzM/38Xd2BCSYc8CKkfsSXLTuw2DWkblHJghgHNHjQrrbRSJrwbYlKjpxCO12W6XdZ1NccoY0jLPF8vN47178jmy/K5LCElcDSkNM0zs3E6KUQ/jmNMXF7/E/sxpdOUjpMGEpYkeOVC74K85xswSPSCefTaBY13bInP2h4PlgRQq7FWUCmopS2FqTVWEt65apww1NPYWfcmbdFjoWEnzd66rGGNhFLaagPwIEnepxRP5wP4RgHwNWxtOvPCN2FyR/sx5hZ3FLKH58IMXD6HdGIXtbCNBnZRCVseDLvoepZHvk6B38TWvVLIe9ix7X2rPnonrW+4uzMd+wRnKfjxyC4aCXwRq9Xd/CY2uEN6PGhOslY73vYNbm0VdMbxnziphflQyH+iEJXFzmAp7AtQ4YdH2efAN0v4BZ5SbbN+mHeF33wpIUcqwvCkTQ70BazU8IjWLkqtAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/7a969076cce54007f1e967c1b9c6a1d6/a0b58/argo9.webp 230w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/bc10c/argo9.webp 460w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/966d8/argo9.webp 920w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/445df/argo9.webp 1380w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/78de1/argo9.webp 1840w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/96199/argo9.webp 2764w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/7a969076cce54007f1e967c1b9c6a1d6/81c8e/argo9.png 230w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/08a84/argo9.png 460w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/c0255/argo9.png 920w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/b1001/argo9.png 1380w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/161ec/argo9.png 1840w,\n/static/7a969076cce54007f1e967c1b9c6a1d6/77085/argo9.png 2764w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/7a969076cce54007f1e967c1b9c6a1d6/c0255/argo9.png\" alt=\"argo9\" title=\"argo9\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Ngoài service, deployment và pod, cây cấu hình app còn hiển thị các đối tượng khác. Ta thấy có <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/\" target=\"_blank\" rel=\"noopener noreferrer\">ReplicaSet</a> (ký hiệu <em>rs</em>) nằm giữa deployment và pod. ReplicaSet là đối tượng Kubernetes đảm bảo luôn có số lượng pod ổn định cho một workload. ReplicaSet định nghĩa số pod giống hệt cần chạy, nếu pod bị loại bỏ hoặc lỗi sẽ tạo thêm pod bù vào. Người dùng thường không định nghĩa ReplicaSet trực tiếp mà dùng Deployment, Deployment sẽ tạo ReplicaSet để quản lý pod.</p><p>Các thay đổi cấu hình Kubernetes của app trên GitHub giờ đã được đồng bộ đẹp đẽ vào cụm. Vậy còn thay đổi mã nguồn app thì sao?</p><p>Để triển khai phiên bản app mới, cần đổi image dùng trong deployment. Hiện image được định nghĩa trong <em>kustomization.yaml</em>:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kustomize.config.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Kustomization\n<span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> manifests/deployment.yaml\n  <span class=\"token punctuation\">-</span> manifests/service.yaml\n<span class=\"token key atrule\">images</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> PROJECT/IMAGE\n    <span class=\"token key atrule\">newName</span><span class=\"token punctuation\">:</span> mluukkai/dwk1</code></pre></div><p>Vậy để triển khai app mới, cần:</p><ol>\n<li>tạo image mới với tag mới (nếu có)</li>\n<li>đổi kustomization.yaml để dùng image mới</li>\n<li>push thay đổi lên GitHub</li>\n</ol><p>Có thể làm thủ công nhưng như vậy là chưa đủ. Hãy định nghĩa workflow GitHub Actions tự động hóa các bước này.</p><p>Bước đầu đã quen thuộc từ <a href=\"/part-3/2-deployment-pipeline\">phần 3</a></p><p>Bước 2 có thể làm với lệnh <em>kustomize edit</em>:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">$ kustomize edit set image PROJECT/IMAGE=node<span class=\"token punctuation\">:</span><span class=\"token number\">20</span>\n$ cat kustomization.yaml\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kustomize.config.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Kustomization\n<span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> manifests/deployment.yaml\n<span class=\"token punctuation\">-</span> manifests/service.yaml\n<span class=\"token key atrule\">images</span><span class=\"token punctuation\">:</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> PROJECT/IMAGE\n  <span class=\"token key atrule\">newName</span><span class=\"token punctuation\">:</span> node\n  <span class=\"token key atrule\">newTag</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"20\"</span></code></pre></div><p>Như thấy, lệnh này <em>thay đổi</em> file <em>kustomization.yaml</em>. Việc còn lại là commit file vào repo. May mắn là đã có GitHub Action <a href=\"https://github.com/EndBug/add-and-commit\" target=\"_blank\" rel=\"noopener noreferrer\">add-and-commit</a> cho việc này!</p><p>Workflow như sau:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and publish application\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build-publish</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build<span class=\"token punctuation\">,</span> Push<span class=\"token punctuation\">,</span> Release\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v4\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Login to Docker Hub\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/login<span class=\"token punctuation\">-</span>action@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKERHUB_USERNAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKERHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\"># tag image với GitHub SHA để có tag duy nhất</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and publish backend\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token punctuation\">-</span>\n          docker build <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>tag \"mluukkai/dwk1<span class=\"token punctuation\">:</span>$GITHUB_SHA\" .\n          docker push \"mluukkai/dwk1<span class=\"token punctuation\">:</span>$GITHUB_SHA\"\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up Kustomize\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> imranismail/setup<span class=\"token punctuation\">-</span>kustomize@v2\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Use right image\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> kustomize edit set image PROJECT/IMAGE=mluukkai/dwk1<span class=\"token punctuation\">:</span>$GITHUB_SHA\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> commit kustomization.yaml to GitHub\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> EndBug/add<span class=\"token punctuation\">-</span>and<span class=\"token punctuation\">-</span>commit@v9\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">add</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"kustomization.yaml\"</span>\n          <span class=\"token key atrule\">message</span><span class=\"token punctuation\">:</span> New version released $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.sha <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div><p>Còn một việc nữa, trong cài đặt repo cần cấp quyền ghi cho GitHub Actions:</p><span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; margin-bottom: 1rem;\">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/099030fe16625510838386413508f6e5/9efb3/gha-perm.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 38.260869565217384%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABYlAAAWJQFJUiTwAAABD0lEQVQY042QaY6EIBSEvf/p5gC27QIogkALGmWdsk0m/pzKBym29ypUhAk2LWyUmPth6oaJTUrpbbWndf7JepstaLNzYU6lqgilFEvxMVLK2DhhYN73HSchRB+C9yEGD+BSvLz3JzarAoVYtI3GtXQkA2m7ruv7fhgmzhkdUYsQ1nPzHk1NlpqaF4XX27ZVJeekbf5pQi8brl51/W67pmkJZeazGvNR2rht348Qc7kCpgt46Nu5lK8vzjkEnmc5C8m5oGwcJw5Wa4/jOE9w5nzf/XuMdUKAjD5CiPlC4tOkXICQEiwK0lobjTzrepeoykN8luh1XV0UEEKiFpbYuP7soUfnO3nO1m0p5fJv/QLGgMjXxrD94AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"/static/099030fe16625510838386413508f6e5/a0b58/gha-perm.webp 230w,\n/static/099030fe16625510838386413508f6e5/bc10c/gha-perm.webp 460w,\n/static/099030fe16625510838386413508f6e5/966d8/gha-perm.webp 920w,\n/static/099030fe16625510838386413508f6e5/445df/gha-perm.webp 1380w,\n/static/099030fe16625510838386413508f6e5/78de1/gha-perm.webp 1840w,\n/static/099030fe16625510838386413508f6e5/eb397/gha-perm.webp 1894w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/webp\">\n        <source srcset=\"/static/099030fe16625510838386413508f6e5/81c8e/gha-perm.png 230w,\n/static/099030fe16625510838386413508f6e5/08a84/gha-perm.png 460w,\n/static/099030fe16625510838386413508f6e5/c0255/gha-perm.png 920w,\n/static/099030fe16625510838386413508f6e5/b1001/gha-perm.png 1380w,\n/static/099030fe16625510838386413508f6e5/161ec/gha-perm.png 1840w,\n/static/099030fe16625510838386413508f6e5/9efb3/gha-perm.png 1894w\" sizes=\"(max-width: 920px) 100vw, 920px\" type=\"image/png\">\n        <img class=\"gatsby-resp-image-image\" src=\"/static/099030fe16625510838386413508f6e5/c0255/gha-perm.png\" alt=\"gha perm\" title=\"gha perm\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span><p>Giờ mọi thay đổi cấu hình và mã nguồn app đều được ArgoCD tự động triển khai nhờ workflow GitHub Action, thật tuyệt!</p><exercise name='Bài tập 4.07: GitOps cho Project'><p>Chuyển ứng dụng <em>Ping-pong</em> sang dùng GitOps để mỗi khi bạn commit lên repo, ứng dụng sẽ tự động được cập nhật.</p></exercise><p>Nếu một app có nhiều môi trường như production, staging, testing, cách định nghĩa môi trường đơn giản sẽ dẫn đến nhiều copy-paste. Khi dùng Kustomize, <a href=\"https://kubectl.docs.kubernetes.io/guides/example/multi_base/\" target=\"_blank\" rel=\"noopener noreferrer\">khuyến nghị</a> là định nghĩa một <em>base</em> chung cho mọi môi trường và các overlay riêng cho từng môi trường, nơi chỉ định phần khác biệt.</p><p>Ví dụ đơn giản như sau. Tạo cấu trúc thư mục:</p><div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.\n├── base\n│   ├── deployment.yaml\n│   └── kustomization.yaml\n└── overlays\n    ├── prod\n    │   ├── deployment.yaml\n    │   └── kustomization.yaml\n    └── staging\n        └── kustomization.yaml</code></pre></div><p><strong>base/deployment.yaml</strong> như sau:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> myapp<span class=\"token punctuation\">-</span>dep\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> myapp\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> myapp\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> myapp\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> PROJECT/IMAGE</code></pre></div><p><strong>base/kustomization.yaml</strong> rất đơn giản:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> deployment.yaml</code></pre></div><p>Môi trường production sửa base bằng cách đổi số replica thành 3. <strong>overlays/prod/deployment.yaml</strong> như sau:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dep\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span></code></pre></div><p>Chỉ cần định nghĩa phần khác biệt.</p><p><strong>overlays/prod/kustomization.yaml</strong> như sau:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> ./../../base\n<span class=\"token key atrule\">patches</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> deployment.yaml\n\n<span class=\"token key atrule\">namePrefix</span><span class=\"token punctuation\">:</span> prod<span class=\"token punctuation\">-</span>\n\n<span class=\"token key atrule\">images</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> PROJECT/IMAGE\n    <span class=\"token key atrule\">newName</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span>1.25<span class=\"token punctuation\">-</span>bookworm</code></pre></div><p>Nó tham chiếu base và <a href=\"https://kubectl.docs.kubernetes.io/references/kustomize/kustomization/patches/\" target=\"_blank\" rel=\"noopener noreferrer\">patches</a> deployment để đặt số replica thành 3.</p><p><strong>overlays/staging/kustomization.yaml</strong> chỉ đặt image:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> ./../../base\n<span class=\"token key atrule\">namePrefix</span><span class=\"token punctuation\">:</span> staging<span class=\"token punctuation\">-</span>\n\n<span class=\"token key atrule\">images</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> PROJECT/IMAGE\n    <span class=\"token key atrule\">newName</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span>1.25.5<span class=\"token punctuation\">-</span>alpine</code></pre></div><p>Giờ production và staging có thể triển khai bằng ArgoCD bằng cách trỏ đến thư mục overlay tương ứng.</p><p>Chúng ta đã dùng giao diện ArgoCD để định nghĩa ứng dụng. Ngoài ra còn các cách khác. Có thể <a href=\"https://argo-cd.readthedocs.io/en/stable/getting_started/#2-download-argo-cd-cli\" target=\"_blank\" rel=\"noopener noreferrer\">cài đặt</a> và dùng <a href=\"https://argo-cd.readthedocs.io/en/stable/getting_started/#creating-apps-via-cli\" target=\"_blank\" rel=\"noopener noreferrer\">Argo CLI</a></p><p>Một lựa chọn nữa là dùng cách <a href=\"https://argo-cd.readthedocs.io/en/stable/operator-manual/declarative-setup/#declarative-setup\" target=\"_blank\" rel=\"noopener noreferrer\">khai báo</a> với <a href=\"https://argo-cd.readthedocs.io/en/stable/operator-manual/declarative-setup/#applications\" target=\"_blank\" rel=\"noopener noreferrer\">Application</a> Custom Resource Definition:</p><p>Với phiên bản production, định nghĩa như sau:</p><p><strong>application.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> argoproj.io/v1alpha1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Application\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> myapp<span class=\"token punctuation\">-</span>production\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> argocd\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">project</span><span class=\"token punctuation\">:</span> default\n  <span class=\"token key atrule\">source</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">repoURL</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">:</span>//github.com/mluukkai/gitopstest\n    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> overlays/prod\n    <span class=\"token key atrule\">targetRevision</span><span class=\"token punctuation\">:</span> HEAD\n  <span class=\"token key atrule\">destination</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">:</span>//kubernetes.default.svc\n    <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> default\n  <span class=\"token key atrule\">syncPolicy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">automated</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">prune</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n      <span class=\"token key atrule\">selfHeal</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div><p>Khai báo application cho ArgoCD bằng lệnh:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl apply -n argocd -f application.yaml</code></pre></div><p>Với GitOps, chúng ta đạt được:</p><ul>\n<li>\n<p>Bảo mật tốt hơn</p>\n<ul>\n<li>Không ai cần truy cập cụm, kể cả dịch vụ CI/CD. Không cần chia sẻ quyền truy cập cụm cho cộng tác viên; họ chỉ cần commit như mọi người khác.</li>\n</ul>\n</li>\n<li>\n<p>Minh bạch hơn</p>\n<ul>\n<li>Mọi thứ đều được khai báo trong repository GitHub. Khi có người mới vào nhóm, chỉ cần xem repo; không cần truyền đạt kiến thức cũ hay mẹo ẩn nào cả.</li>\n</ul>\n</li>\n<li>\n<p>Truy vết tốt hơn</p>\n<ul>\n<li>Mọi thay đổi với cụm đều được kiểm soát phiên bản. Bạn sẽ biết chính xác trạng thái cụm và ai đã thay đổi, thay đổi như thế nào.</li>\n</ul>\n</li>\n<li>\n<p>Giảm rủi ro</p>\n<ul>\n<li>Nếu có sự cố, chỉ cần revert cụm về commit hoạt động. <code class=\"language-text\">git revert</code> và toàn bộ cụm trở lại trạng thái trước đó.</li>\n</ul>\n</li>\n<li>\n<p>Dễ di chuyển</p>\n<ul>\n<li>Muốn đổi nhà cung cấp? Tạo cụm mới và trỏ về cùng repo - cụm của bạn đã ở đó.</li>\n</ul>\n</li>\n</ul><p>Có một số lựa chọn cho setup GitOps. Ở đây chúng ta để cấu hình ứng dụng cùng repo với mã nguồn. Một lựa chọn khác là tách cấu hình khỏi mã nguồn. ArgoCD liệt kê nhiều lý do thuyết phục rằng tách repo là <a href=\"https://argo-cd.readthedocs.io/en/stable/user-guide/best_practices/#separating-config-vs-source-code-repositories\" target=\"_blank\" rel=\"noopener noreferrer\">best practice</a>.</p><exercise name='Bài tập 4.08: GitOps cho Project'><p>Chuyển Project sang dùng GitOps.</p><ul>\n<li>Tạo hai môi trường riêng biệt, <em>production</em> và <em>staging</em> ở namespace riêng</li>\n<li>Mỗi commit lên nhánh main sẽ triển khai lên môi trường staging</li>\n<li>Mỗi commit <em>tagged</em> sẽ triển khai lên môi trường production</li>\n<li>Ở staging, broadcaster chỉ log các tin nhắn, không chuyển tiếp ra ngoài</li>\n<li>Ở staging, database không cần backup</li>\n<li>Bạn có thể giả định <em>secrets</em> đã được apply sẵn ngoài ArgoCD</li>\n<li>Bonus: dùng repo riêng biệt cho code và cấu hình</li>\n</ul></exercise></div>","frontmatter":{"path":"/part-4/3-gitops-vi","title":"Triển khai GitOps"},"fileAbsolutePath":"/home/runner/work/dwk2024/dwk2024/data/part-4/3-GitOps-vi.md"},"allPages":{"edges":[{"node":{"id":"7e706a38-3828-5118-bdec-3705a319a1b0","frontmatter":{"path":"/faq-vi","title":"Câu hỏi thường gặp"}}},{"node":{"id":"5225f2a2-20f9-50ce-93ac-7b38f3105103","frontmatter":{"path":"/faq","title":"FAQ"}}},{"node":{"id":"e1ed6713-5992-5f7f-95a1-17efd97f57d8","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"52d4cd1d-eb14-54f3-a18a-ef84b67c320d","frontmatter":{"path":"/index-en","title":"Homepage"}}},{"node":{"id":"3102d88f-7297-56fb-af03-27d1079fffd1","frontmatter":{"path":"/","title":"Trang chủ"}}},{"node":{"id":"c92ea568-3384-5ff8-8dfa-b9015597780d","frontmatter":{"path":"/known-problems-solutions","title":"Issues you may face"}}},{"node":{"id":"5e6b6ee0-b381-53f0-b84c-af378792b131","frontmatter":{"path":"/registration-and-completion","title":"Registration and Completion"}}},{"node":{"id":"58688080-4aa8-54e6-8b8b-02de1c4f6410","frontmatter":{"path":"/unity-assignment","title":"Unity Assignment"}}},{"node":{"id":"04c5ddbd-7839-580f-82da-bc9fdbb49f84","frontmatter":{"path":"/known-problems-solutions","title":"Các vấn đề bạn có thể gặp phải"}}},{"node":{"id":"d9c993b6-f6b4-59a1-b119-f3b7218eec6b","frontmatter":{"path":"/sanasto","title":"Sanasto"}}},{"node":{"id":"8a3ee5be-7557-5fcd-954b-2351e74cd585","frontmatter":{"path":"/part-0/1-intro-vi","title":"Giới thiệu khóa học"}}},{"node":{"id":"23082016-7bbd-5215-8485-4ffccbf3ea1a","frontmatter":{"path":"/part-0/1-intro","title":"Course Introduction"}}},{"node":{"id":"771eaa93-2ef2-5e0f-9e1e-55914c67c4ac","frontmatter":{"path":"/part-0","title":"Part 0"}}},{"node":{"id":"fe0342aa-a4c5-5b44-8591-71eb27f1a287","frontmatter":{"path":"/part-1/2-introduction-to-debugging-vi","title":"Giới thiệu về Debugging"}}},{"node":{"id":"1c236933-7ad5-5b61-8c07-07db3822d55a","frontmatter":{"path":"/part-1/2-introduction-to-debugging","title":"Introduction to Debugging"}}},{"node":{"id":"7fc5c062-6b94-53ec-9aaa-adca66ce672e","frontmatter":{"path":"/part-1/5-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"3c788edf-62db-5e86-9366-17b53eda9244","frontmatter":{"path":"/part-1/5-summary","title":"Summary"}}},{"node":{"id":"46a4a0e4-d131-537d-aa72-5b6726163a7d","frontmatter":{"path":"/part-2/1-networking-between-pods-vi","title":"Kết nối mạng giữa các pod"}}},{"node":{"id":"fd467661-6b24-545f-904c-52f4a7ade6b7","frontmatter":{"path":"/part-2/1-networking-between-pods","title":"Networking between pods"}}},{"node":{"id":"56110eda-875d-5bd9-a400-5bd5a009df7f","frontmatter":{"path":"/part-2/5-monitoring-vi","title":"Giám sát"}}},{"node":{"id":"8f3387b0-ec6e-5a86-982a-e52780d911f9","frontmatter":{"path":"/part-2/5-monitoring","title":"Monitoring"}}},{"node":{"id":"06173ac4-c2f8-57df-8dc8-450b5c2bb695","frontmatter":{"path":"/part-2/6-summary","title":"Summary"}}},{"node":{"id":"8c3d747d-4f87-5a46-99ac-dfd0af5a893b","frontmatter":{"path":"/part-2","title":"Part 2"}}},{"node":{"id":"79f1cddb-6995-51c2-bf98-2adc13de9b13","frontmatter":{"path":"/part-2/6-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"8ed3365b-b788-5806-8ec5-bec3cb0f94c8","frontmatter":{"path":"/part-1","title":"Part 1"}}},{"node":{"id":"8d9fd774-9dbe-5cca-8395-9226fcf82c4a","frontmatter":{"path":"/part-3/4-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"b98b2895-6c9d-5234-939d-2f547cbf8a06","frontmatter":{"path":"/part-3/4-summary","title":"Summary"}}},{"node":{"id":"4dd8302d-d170-5d38-8198-4d0947322bbc","frontmatter":{"path":"/part-4/4-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"0045695d-e541-5acc-b4b8-551023d01733","frontmatter":{"path":"/part-4/4-summary","title":"Summary"}}},{"node":{"id":"29bec4f5-8a0b-580d-ac84-9dbbd1d7152e","frontmatter":{"path":"/part-3","title":"Part 3"}}},{"node":{"id":"a917b24d-df2b-5199-ac98-cd0f7560c63f","frontmatter":{"path":"/part-4","title":"Part 4"}}},{"node":{"id":"eb339401-26c8-594c-98fd-2f30a95275cd","frontmatter":{"path":"/part-5/4-beyond-kubernetes-vi","title":"Vượt ra ngoài Kubernetes"}}},{"node":{"id":"2318c18f-86e6-5a4e-958a-d1c38f8615cd","frontmatter":{"path":"/part-5/4-beyond-kubernetes","title":"Beyond Kubernetes"}}},{"node":{"id":"1d8ff75c-065b-565d-9ceb-01b9a276ae7a","frontmatter":{"path":"/part-5/5-summary","title":"Summary and end"}}},{"node":{"id":"781bd207-902e-59a2-a752-4958c2c93fb0","frontmatter":{"path":"/part-5/5-summary-vi","title":"Tóm tắt và kết thúc"}}},{"node":{"id":"306c87f3-9adb-5d8b-a3ce-072f8e6cfa43","frontmatter":{"path":"/part-5","title":"Part 5"}}},{"node":{"id":"829fd216-f995-5a77-b201-bb971aec73b4","frontmatter":{"path":"/part-0/2-kubernetes-in-three-diagrams-vi","title":"Kubernetes qua ba sơ đồ"}}},{"node":{"id":"98132cca-4dc3-5942-a6f4-1da87bc81a23","frontmatter":{"path":"/part-0/2-kubernetes-in-three-diagrams","title":"Kubernetes in three diagrams"}}},{"node":{"id":"8931bcb7-c40e-5d57-aa80-c4333972fbb8","frontmatter":{"path":"/part-1/3-introduction-to-networking-vi","title":"Giới thiệu về Mạng"}}},{"node":{"id":"90b8e83a-9d55-550a-908a-316708ce7f8c","frontmatter":{"path":"/part-1/3-introduction-to-networking","title":"Introduction to Networking"}}},{"node":{"id":"4fe00c0a-bb17-5d4c-8202-750493a755c9","frontmatter":{"path":"/part-1/4-introduction-to-storage-vi","title":"Giới thiệu về Lưu trữ"}}},{"node":{"id":"6cc3be66-6091-58fc-bcbd-1f27f9473f85","frontmatter":{"path":"/part-1/4-introduction-to-storage","title":"Introduction to Storage"}}},{"node":{"id":"b53df746-c24f-57e3-a9f3-d6d621697689","frontmatter":{"path":"/part-2/2-organizing-a-cluster-vi","title":"Tổ chức một cụm"}}},{"node":{"id":"d5206d16-d2fe-51fd-8acd-d85ecf0be257","frontmatter":{"path":"/part-2/2-organizing-a-cluster","title":"Organizing a cluster"}}},{"node":{"id":"15be3d7c-b0b7-5bce-b3bf-8cec39d54630","frontmatter":{"path":"/part-2/3-configuring-applications-vi","title":"Cấu hình ứng dụng"}}},{"node":{"id":"e4534a9d-fb84-5d1f-83f0-35055feb0da7","frontmatter":{"path":"/part-2/3-configuring-applications","title":"Configuring applications"}}},{"node":{"id":"02389078-a12f-561a-8a54-fa99a6950b92","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs-vi","title":"StatefulSet và Job"}}},{"node":{"id":"466aa711-527b-55a0-871b-13468e65d344","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs","title":"StatefulSets and Jobs"}}},{"node":{"id":"bea18f34-dcdc-59b8-ba24-3011680a0c58","frontmatter":{"path":"/part-3/1-introduction-to-gke-vi","title":"Giới thiệu về Google Kubernetes Engine"}}},{"node":{"id":"0049e57f-0bc7-5689-9169-43848a972877","frontmatter":{"path":"/part-3/2-deployment-pipeline-vi","title":"Quy trình Triển khai (Deployment Pipeline)"}}},{"node":{"id":"61f18dc7-1abf-5c75-9b54-0cee11c76a40","frontmatter":{"path":"/part-3/2-deployment-pipeline","title":"Deployment Pipeline"}}},{"node":{"id":"7dfec8c7-8ccb-50da-949d-ebd1de395dc4","frontmatter":{"path":"/part-3/3-gke-features-vi","title":"Các tính năng của GKE"}}},{"node":{"id":"423cbc46-2dfa-57e6-9dc5-761a93729600","frontmatter":{"path":"/part-3/3-gke-features","title":"GKE features"}}},{"node":{"id":"84db9628-b3df-5ca1-9d3d-5924e02ae549","frontmatter":{"path":"/part-3/1-introduction-to-gke","title":"Introduction to Google Kubernetes Engine"}}},{"node":{"id":"46f9ce68-5ccd-5787-bd59-03852ad6fdcb","frontmatter":{"path":"/part-4/3-gitops","title":"GitOps"}}},{"node":{"id":"6df9c7be-f930-5827-a39c-0c1698b23600","frontmatter":{"path":"/part-4/3-gitops-vi","title":"Triển khai GitOps"}}},{"node":{"id":"0e981ec1-99e0-5005-ba9f-4f626a81b7ce","frontmatter":{"path":"/part-5/1-kubernetes-internals-vi","title":"Bên trong Kubernetes"}}},{"node":{"id":"31927db3-2182-55c7-b680-663754461d14","frontmatter":{"path":"/part-5/1-kubernetes-internals","title":"Kubernetes Internals"}}},{"node":{"id":"da1f8069-17bc-5c8e-9310-117bcedf5acf","frontmatter":{"path":"/part-5/2-custom-resource-definitions-vi","title":"Định nghĩa Tài nguyên Tùy chỉnh (Custom Resource Definitions)"}}},{"node":{"id":"ccefb04a-5790-57f6-869b-d255b2203667","frontmatter":{"path":"/part-5/2-custom-resource-definitions","title":"Custom Resource Definitions"}}},{"node":{"id":"68c64f9f-c9a5-544b-bafb-b061665cacd0","frontmatter":{"path":"/part-5/3-service-mesh-vi","title":"Service Mesh"}}},{"node":{"id":"20ceed4e-761d-54d4-9acf-2669eac533c6","frontmatter":{"path":"/part-5/3-service-mesh","title":"Service Mesh"}}},{"node":{"id":"97ead58a-8493-5fdd-808e-d4a56de573b0","frontmatter":{"path":"/part-1/1-first-deploy","title":"First Deploy"}}},{"node":{"id":"6f4f18ce-5aa9-5bb5-9d74-0a631a78e6b3","frontmatter":{"path":"/part-4/2-messaging-systems-vi","title":"Hệ thống nhắn tin"}}},{"node":{"id":"c179c521-bb62-52bd-808b-d4869df5302a","frontmatter":{"path":"/part-4/1-update-strategies-and-prometheus-vi","title":"Chiến lược cập nhật và Prometheus"}}},{"node":{"id":"898b0354-f1a2-5664-97de-d84b16018395","frontmatter":{"path":"/part-4/1-update-strategies-and-prometheus","title":"Update Strategies and Prometheus"}}},{"node":{"id":"6981a9d7-619d-51a9-9490-74bc77c0f55b","frontmatter":{"path":"/part-4/2-messaging-systems","title":"Messaging Systems"}}},{"node":{"id":"a17c4c44-7396-543f-b6b4-7adf57808aa8","frontmatter":{"path":"/part-1/1-first-deploy-vi","title":"Triển khai đầu tiên"}}}]}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}