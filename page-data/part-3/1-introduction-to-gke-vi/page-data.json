{"componentChunkName":"component---src-templates-course-content-template-js","path":"/part-3/1-introduction-to-gke-vi","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"Mục tiêu học tập"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sau phần này bạn có thể"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Tạo cụm (cluster) của riêng bạn trên GKE"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Triển khai ứng dụng lên Google Kubernetes Engine"}]},{"type":"text","value":"\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Chúng ta đã sử dụng bản phân phối Kubernetes là K3s bằng các container Docker thông qua k3d. Trong môi trường sản xuất, gánh nặng duy trì một cụm Kubernetes thường được giao cho bên thứ ba. Một dịch vụ "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Kubernetes được quản lý"}]},{"type":"text","value":" thường là lựa chọn tốt nhất vì công việc bổ sung trong bảo trì vượt quá lợi ích của việc tự vận hành cụm. Trong một số trường hợp khá hiếm, việc tự thiết lập và duy trì cụm Kubernetes là hợp lý. Một ví dụ là công ty/tổ chức của bạn đã có sẵn phần cứng và/hoặc muốn độc lập với các nhà cung cấp, ví dụ như một trường Đại học. Một lý do chính khác để tự vận hành cụm Kubernetes là các quy định pháp lý không cho phép các lựa chọn khác."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tự duy trì cụm Kubernetes là một cách để tăng chi phí. Cách khác là vận hành các máy chủ không sử dụng đến. Để tránh chi phí này, các giải pháp "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Serverless_computing","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Serverless"}]},{"type":"text","value":" có thể tiết kiệm hơn. Một cụm Kubernetes có kích thước không phù hợp có thể trở nên rất tốn kém rất nhanh. Một lựa chọn tuyệt vời để bắt đầu là môi trường cao cấp cho các workload serverless, như Google Cloud Run hoặc AWS Fargate. Ở đó bạn có thể chạy bất kỳ container nào, so với các giải pháp cũ như Cloud Functions hoặc AWS Lambda, vốn có hỗ trợ rất khác nhau cho các ngôn ngữ, môi trường và công cụ."}]},{"type":"comment","value":"-\n<text-box variant='hint' name='Đăng ký cho sinh viên Đại học Mở'>\n  Nếu bạn là sinh viên tại Phần Lan, có số an sinh xã hội Phần Lan hoặc là sinh viên Đại học Helsinki, hãy đăng ký khóa học ngay. Làm theo <a href=\"/registration-and-completion\">hướng dẫn</a> để nhận Google Cloud Platform Education Grant.\n</text-box>\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Hãy tập trung vào chi phí của Google Kubernetes Engine (GKE) trước. Lưu ý rằng GKE đắt hơn một chút so với các đối thủ."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Công cụ tính giá tại đây "},{"type":"element","tagName":"a","properties":{"href":"https://cloud.google.com/products/calculator","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://cloud.google.com/products/calculator"}]},{"type":"text","value":" cho chúng ta cái nhìn về giá cả. Tôi đã thử một lựa chọn rẻ: 5 node trong 1 cụm zonal, mỗi node 1 vCPU. Địa điểm trung tâm dữ liệu ở Phần Lan và tôi không cần ổ đĩa lưu trữ lâu dài. Nếu chúng ta muốn ít hơn 5 node thì tại sao lại dùng Kubernetes? Tổng chi phí cho ví dụ này khoảng 250 USD mỗi tháng. Thêm các dịch vụ bổ sung như Load balancer sẽ tăng chi phí. Nếu bạn thấy việc tính phí của Google Cloud Platform khó hiểu, bạn không đơn độc: Coursera có khóa học ~5 giờ \""},{"type":"element","tagName":"a","properties":{"href":"https://www.coursera.org/learn/gcp-cost-management","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Hiểu về chi phí Google Cloud Platform của bạn"}]},{"type":"text","value":"\"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Trong phần 3 này, chúng ta sẽ sử dụng GKE bằng các khoản tín dụng miễn phí do Google cung cấp. Bạn có trách nhiệm đảm bảo rằng tín dụng đủ dùng cho cả phần này và nếu dùng hết, tôi không thể giúp bạn."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sau khi nhận tín dụng, chúng ta có thể tạo một dự án với tài khoản thanh toán. Giao diện Google Cloud có thể gây nhầm lẫn. Trên "},{"type":"element","tagName":"a","properties":{"href":"https://console.cloud.google.com/cloud-resource-manager","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"trang tài nguyên"}]},{"type":"text","value":" chúng ta có thể tạo một dự án mới và đặt tên là \"dwk-gke\" cho mục đích của khóa học này."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Cài đặt Google Cloud SDK. Hướng dẫn "},{"type":"element","tagName":"a","properties":{"href":"https://cloud.google.com/sdk/install","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"tại đây"}]},{"type":"text","value":". Sau đó đăng nhập và đặt dự án vừa tạo làm dự án sử dụng."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"shell"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-shell"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"$ gcloud -v\n  Google Cloud SDK "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"471.0"}]},{"type":"text","value":".0\n  bq "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2.1"}]},{"type":"text","value":".3\n  core "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2024.03"}]},{"type":"text","value":".29\n  gcloud-crc32c "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1.0"}]},{"type":"text","value":".0\n  gsutil "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"5.27"}]},{"type":"text","value":"\n\n$ gcloud auth login\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":".."}]},{"type":"text","value":".\n  Bạn đã đăng nhập thành công\n\n$ gcloud config "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"set"}]},{"type":"text","value":" project dwk-gke\n  Đã cập nhật thuộc tính "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":"core/project"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"."}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bây giờ chúng ta có thể tạo một cụm, với lệnh "},{"type":"element","tagName":"a","properties":{"href":"https://cloud.google.com/sdk/gcloud/reference/container/clusters/create","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"gcloud container clusters create"}]},{"type":"text","value":". Bạn có thể chọn bất kỳ vùng nào từ danh sách "},{"type":"element","tagName":"a","properties":{"href":"https://cloud.google.com/about/locations/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"tại đây"}]},{"type":"text","value":". Tôi chọn Phần Lan. Lưu ý rằng một khu vực (ví dụ europe-north1) có thể có nhiều vùng (ví dụ -a). Hãy thêm một tham số nữa: "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"--cluster-version=1.29"}]},{"type":"text","value":". Tham số này sẽ yêu cầu GKE sử dụng phiên bản sẽ là mặc định vào tháng 4/2024. Lịch phát hành GKE xem "},{"type":"element","tagName":"a","properties":{"href":"https://cloud.google.com/kubernetes-engine/docs/release-schedule","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"tại đây"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"shell"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-shell"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"$ gcloud container clusters create dwk-cluster --zone"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"europe-north1-b --cluster-version"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1.29"}]},{"type":"text","value":" --disk-size"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"32"}]},{"type":"text","value":" --num-nodes"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3"}]},{"type":"text","value":" --machine-type"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"e2-micro\n\nERROR: "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"gcloud.container.clusters.create"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":" ResponseError: "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"code"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"403"}]},{"type":"text","value":", "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"message"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"Kubernetes Engine API chưa được sử dụng trong dự án dwk-gke-xxxxxx hoặc đã bị vô hiệu hóa. Kích hoạt nó bằng cách truy cập https://console.developers.google.com/apis/api/container.googleapis.com/overview?project"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"dwk-gke-xxxxxx rồi thử lại."}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bạn có thể truy cập liên kết được cung cấp và bật Kubernetes Engine API, lưu ý rằng url được xuất ra là dành riêng cho tên dự án của bạn. Hoặc, bạn chỉ cần thực hiện lệnh sau trên dòng lệnh:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"shell"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-shell"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"$ gcloud services "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"enable"}]},{"type":"text","value":" container.googleapis.com\n  Hoạt động "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"operations/acf.p2-385245615727-2f855eed-e785-49ac-91da-896925a691ab\""}]},{"type":"text","value":" đã hoàn thành thành công.\n\n$ gcloud container clusters create dwk-cluster --zone"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"europe-north1-b --cluster-version"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1.29"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":".."}]},{"type":"text","value":".\n  Đang tạo cụm dwk-cluster tại europe-north1-b"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":".."}]},{"type":"text","value":".\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":".."}]},{"type":"text","value":".\n  Đã tạo kubeconfig cho dwk-cluster.\n  NAME         LOCATION         MASTER_VERSION   MASTER_IP       MACHINE_TYPE  NODE_VERSION     NUM_NODES  STATUS\n  dwk-cluster  europe-north1-b  "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1.29"}]},{"type":"text","value":".8-gke.2200  "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"35.228"}]},{"type":"text","value":".176.118  e2-medium     "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1.29"}]},{"type":"text","value":".8-gke.2200  "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3"}]},{"type":"text","value":"          RUNNING"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nếu lệnh không hoạt động, bạn cần cài đặt "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"gke-gcloud-auth-plugin"}]},{"type":"text","value":" bằng cách làm theo "},{"type":"element","tagName":"a","properties":{"href":"https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-access-for-kubectl#install_plugin","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"hướng dẫn này"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nó đã đặt kubeconfig trỏ đúng hướng. Nhưng nếu cần làm lại, chúng ta có thể đặt kubeconfig như sau:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"shell"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-shell"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"$ gcloud container clusters get-credentials dwk-cluster --zone"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"europe-north1-b\n  Đang lấy endpoint và dữ liệu xác thực của cụm.\n  Đã tạo kubeconfig cho dwk-cluster."}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bạn có thể kiểm tra thông tin cụm với "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl cluster-info"}]},{"type":"text","value":" để xác nhận nó đang trỏ đúng."}]},{"type":"element","tagName":"h3","properties":{"id":"triển-khai-len-gke","style":"position:relative;"},"children":[{"type":"text","value":"Triển khai lên GKE"},{"type":"element","tagName":"a","properties":{"href":"#tri%E1%BB%83n-khai-len-gke","ariaLabel":"triển khai len gke permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Cụm mà chúng ta có bây giờ "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"gần như"}]},{"type":"text","value":" giống với cụm chạy cục bộ. Hãy áp dụng "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/kubernetes-hy/material-example/tree/master/app6","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"ứng dụng này"}]},{"type":"text","value":" tạo một chuỗi ngẫu nhiên và sau đó phục vụ một hình ảnh dựa trên chuỗi ngẫu nhiên đó. Điều này sẽ tạo 6 bản sao của tiến trình \"seedimage\"."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"shell"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-shell"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"$ kubectl apply -f https://raw.githubusercontent.com/kubernetes-hy/material-example/e11a700350aede132b62d3b5fd63c05d6b976394/app6/manifests/deployment.yaml"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Việc expose service là nơi bắt đầu có sự khác biệt. Thay vì Ingress, chúng ta sẽ dùng service kiểu "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"LoadBalancer"}]},{"type":"text","value":". Lưu ý bước tiếp theo sẽ làm tăng "},{"type":"element","tagName":"a","properties":{"href":"https://cloud.google.com/compute/all-pricing#lb","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"chi phí của cụm"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Áp dụng file sau:"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"service.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Service\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" seedimage"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"svc\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" LoadBalancer "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Đây là phần duy nhất có thể lạ"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" seedimage\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"ports"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"port"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"protocol"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" TCP\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"targetPort"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3000"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Một service kiểu load balancer sẽ yêu cầu Google cung cấp cho chúng ta một load balancer. Chúng ta có thể chờ đến khi service nhận được IP bên ngoài:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"shell"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-shell"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"$ kubectl get svc --watch\n  NAME            TYPE           CLUSTER-IP      EXTERNAL-IP    PORT"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"S"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"        AGE\n  kubernetes      ClusterIP      "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.31"}]},{"type":"text","value":".240.1     "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":"none"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":"         "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"443"}]},{"type":"text","value":"/TCP        144m\n  seedimage-svc   LoadBalancer   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.31"}]},{"type":"text","value":".241.224   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"35.228"}]},{"type":"text","value":".41.16   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]},{"type":"text","value":":30215/TCP   94s"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nếu bây giờ truy cập "},{"type":"element","tagName":"a","properties":{"href":"http://35.228.41.16","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://35.228.41.16"}]},{"type":"text","value":" bằng trình duyệt, chúng ta sẽ thấy ứng dụng đang chạy. Làm mới trang sẽ thấy load balancer đôi khi trả về hình ảnh khác nhau. Lưu ý rằng chỉ có cổng 80, nên https sẽ không hoạt động."}]},{"type":"element","tagName":"div","properties":{"className":["highlight-box"],"markdown":"1"},"children":[{"type":"text","value":"\nĐể tránh tiêu tốn tín dụng, hãy xóa cụm khi không cần dùng"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"shell"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-shell"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"$ gcloud container clusters delete dwk-cluster --zone"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"europe-north1-b"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Và khi tiếp tục, hãy tạo lại cụm."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"shell"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-shell"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"$ gcloud container clusters create dwk-cluster --zone"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"europe-north1-b --cluster-version"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1.29"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Đóng cụm cũng sẽ xóa mọi thứ bạn đã triển khai trên cụm. Vì vậy nếu bạn nghỉ vài ngày trong lúc làm bài tập, có thể phải làm lại. May mắn là chúng ta dùng cách tiếp cận khai báo nên chỉ cần áp dụng lại các file yaml là tiếp tục được."}]},{"type":"element","tagName":"h3","properties":{"id":"lưu-trữ-dữ-liệu-tren-gke","style":"position:relative;"},"children":[{"type":"text","value":"Lưu trữ dữ liệu trên GKE"},{"type":"element","tagName":"a","properties":{"href":"#l%C6%B0u-tr%E1%BB%AF-d%E1%BB%AF-li%E1%BB%87u-tren-gke","ariaLabel":"lưu trữ dữ liệu tren gke permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Google Kubernetes Engine sẽ tự động cung cấp một ổ đĩa lâu dài cho "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/storage/persistent-volumes/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"PersistentVolumeClaim"}]},{"type":"text","value":" - chỉ cần không đặt storage class. Nếu muốn, bạn có thể đọc thêm "},{"type":"element","tagName":"a","properties":{"href":"https://cloud.google.com/kubernetes-engine/docs/concepts/persistent-volumes","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"tại đây"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"exercise","properties":{"name":"Bài tập 3.01: Pingpong GKE"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Triển khai ứng dụng Ping-pong lên GKE."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Trong bài tập này, hãy sử dụng service kiểu LoadBalancer để expose service."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nếu log của Postgres báo"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"shell"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-shell"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"initdb: error: directory "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"/var/lib/postgresql/data\""}]},{"type":"text","value":" exists but is not empty\nIt contains a lost+found directory, perhaps due to it being a "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"mount"}]},{"type":"text","value":" point.\nUsing a "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"mount"}]},{"type":"text","value":" point directly as the data directory is not recommended.\nCreate a subdirectory under the "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"mount"}]},{"type":"text","value":" point."}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"bạn có thể thêm cấu hình "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"subPath"}]},{"type":"text","value":":"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"statefulset.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# ..."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"volumeMounts"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" data\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"mountPath"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" /var/lib/postgresql/data\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"subPath"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" postgres\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# ..."}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Điều này sẽ tạo thư mục Postgres nơi dữ liệu sẽ được lưu. subPath cũng giúp dùng một volume cho nhiều mục đích."}]}]},{"type":"element","tagName":"h3","properties":{"id":"từ-service-sang-ingress","style":"position:relative;"},"children":[{"type":"text","value":"Từ Service sang Ingress"},{"type":"element","tagName":"a","properties":{"href":"#t%E1%BB%AB-service-sang-ingress","ariaLabel":"từ service sang ingress permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Service khá đơn giản. Hãy thử dùng Ingress vì nó cung cấp thêm công cụ đổi lại sự phức tạp."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Service kiểu "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"NodePort"}]},{"type":"text","value":" là bắt buộc khi dùng Ingress trên GKE. Dù là NodePort, GKE không expose nó ra ngoài cụm. Hãy kiểm tra điều này bằng cách tiếp tục ví dụ trước."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"service.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Service\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" seedimage"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"svc\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"type"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" NodePort\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" seedimage\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"ports"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"port"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"protocol"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" TCP\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"targetPort"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"3000"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"ingress.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" networking.k8s.io/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Ingress\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" seedimage"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"ing\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"rules"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"http"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"paths"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"path"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" /\n            "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"pathType"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Prefix\n            "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"backend"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n              "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"service"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n                "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" seedimage"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"svc\n                "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"port"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n                  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"number"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"80"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Khi bạn đã áp dụng các file này, bạn có thể xem port từ danh sách ingress:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"$ kubectl get ing\n  NAME            CLASS    HOSTS   ADDRESS         PORTS   AGE\n  seedimage-ing   <none>   *       34.120.61.234   80      2m13s"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bây giờ địa chỉ ở đây sẽ là cách truy cập ứng dụng. Sẽ mất một lúc để triển khai, phản hồi có thể là 404 hoặc 502 khi nó đang khởi tạo. Ingress thực hiện kiểm tra sức khỏe bằng cách gửi GET tới / và mong đợi phản hồi HTTP 200."}]},{"type":"element","tagName":"exercise","properties":{"name":"Bài tập 3.02: Quay lại với Ingress"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Triển khai các ứng dụng \"Log output\" và \"Ping-pong\" lên GKE và expose chúng bằng Ingress."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"\"Ping-pong\" sẽ phải phản hồi tại đường dẫn /pingpong. Điều này có thể yêu cầu bạn chỉnh sửa lại một số phần của mã nguồn."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Lưu ý rằng Ingress mong đợi một service trả về phản hồi thành công tại đường dẫn / ngay cả khi service đó được ánh xạ tới đường dẫn khác!"}]}]}]}]},"html":"<div><text-box variant='learningObjectives' name='Mục tiêu học tập'><p>Sau phần này bạn có thể</p><ul>\n<li>Tạo cụm (cluster) của riêng bạn trên GKE</li>\n<li>Triển khai ứng dụng lên Google Kubernetes Engine</li>\n</ul></text-box><p>Chúng ta đã sử dụng bản phân phối Kubernetes là K3s bằng các container Docker thông qua k3d. Trong môi trường sản xuất, gánh nặng duy trì một cụm Kubernetes thường được giao cho bên thứ ba. Một dịch vụ <em>Kubernetes được quản lý</em> thường là lựa chọn tốt nhất vì công việc bổ sung trong bảo trì vượt quá lợi ích của việc tự vận hành cụm. Trong một số trường hợp khá hiếm, việc tự thiết lập và duy trì cụm Kubernetes là hợp lý. Một ví dụ là công ty/tổ chức của bạn đã có sẵn phần cứng và/hoặc muốn độc lập với các nhà cung cấp, ví dụ như một trường Đại học. Một lý do chính khác để tự vận hành cụm Kubernetes là các quy định pháp lý không cho phép các lựa chọn khác.</p><p>Tự duy trì cụm Kubernetes là một cách để tăng chi phí. Cách khác là vận hành các máy chủ không sử dụng đến. Để tránh chi phí này, các giải pháp <a href=\"https://en.wikipedia.org/wiki/Serverless_computing\" target=\"_blank\" rel=\"noopener noreferrer\">Serverless</a> có thể tiết kiệm hơn. Một cụm Kubernetes có kích thước không phù hợp có thể trở nên rất tốn kém rất nhanh. Một lựa chọn tuyệt vời để bắt đầu là môi trường cao cấp cho các workload serverless, như Google Cloud Run hoặc AWS Fargate. Ở đó bạn có thể chạy bất kỳ container nào, so với các giải pháp cũ như Cloud Functions hoặc AWS Lambda, vốn có hỗ trợ rất khác nhau cho các ngôn ngữ, môi trường và công cụ.</p><!---\n<text-box variant='hint' name='Đăng ký cho sinh viên Đại học Mở'>\n  Nếu bạn là sinh viên tại Phần Lan, có số an sinh xã hội Phần Lan hoặc là sinh viên Đại học Helsinki, hãy đăng ký khóa học ngay. Làm theo <a href=\"/registration-and-completion\">hướng dẫn</a> để nhận Google Cloud Platform Education Grant.\n</text-box>\n--><p>Hãy tập trung vào chi phí của Google Kubernetes Engine (GKE) trước. Lưu ý rằng GKE đắt hơn một chút so với các đối thủ.</p><p>Công cụ tính giá tại đây <a href=\"https://cloud.google.com/products/calculator\" target=\"_blank\" rel=\"noopener noreferrer\">https://cloud.google.com/products/calculator</a> cho chúng ta cái nhìn về giá cả. Tôi đã thử một lựa chọn rẻ: 5 node trong 1 cụm zonal, mỗi node 1 vCPU. Địa điểm trung tâm dữ liệu ở Phần Lan và tôi không cần ổ đĩa lưu trữ lâu dài. Nếu chúng ta muốn ít hơn 5 node thì tại sao lại dùng Kubernetes? Tổng chi phí cho ví dụ này khoảng 250 USD mỗi tháng. Thêm các dịch vụ bổ sung như Load balancer sẽ tăng chi phí. Nếu bạn thấy việc tính phí của Google Cloud Platform khó hiểu, bạn không đơn độc: Coursera có khóa học ~5 giờ \"<a href=\"https://www.coursera.org/learn/gcp-cost-management\" target=\"_blank\" rel=\"noopener noreferrer\">Hiểu về chi phí Google Cloud Platform của bạn</a>\".</p><p>Trong phần 3 này, chúng ta sẽ sử dụng GKE bằng các khoản tín dụng miễn phí do Google cung cấp. Bạn có trách nhiệm đảm bảo rằng tín dụng đủ dùng cho cả phần này và nếu dùng hết, tôi không thể giúp bạn.</p><p>Sau khi nhận tín dụng, chúng ta có thể tạo một dự án với tài khoản thanh toán. Giao diện Google Cloud có thể gây nhầm lẫn. Trên <a href=\"https://console.cloud.google.com/cloud-resource-manager\" target=\"_blank\" rel=\"noopener noreferrer\">trang tài nguyên</a> chúng ta có thể tạo một dự án mới và đặt tên là \"dwk-gke\" cho mục đích của khóa học này.</p><p>Cài đặt Google Cloud SDK. Hướng dẫn <a href=\"https://cloud.google.com/sdk/install\" target=\"_blank\" rel=\"noopener noreferrer\">tại đây</a>. Sau đó đăng nhập và đặt dự án vừa tạo làm dự án sử dụng.</p><div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ gcloud -v\n  Google Cloud SDK <span class=\"token number\">471.0</span>.0\n  bq <span class=\"token number\">2.1</span>.3\n  core <span class=\"token number\">2024.03</span>.29\n  gcloud-crc32c <span class=\"token number\">1.0</span>.0\n  gsutil <span class=\"token number\">5.27</span>\n\n$ gcloud auth login\n  <span class=\"token punctuation\">..</span>.\n  Bạn đã đăng nhập thành công\n\n$ gcloud config <span class=\"token builtin class-name\">set</span> project dwk-gke\n  Đã cập nhật thuộc tính <span class=\"token punctuation\">[</span>core/project<span class=\"token punctuation\">]</span>.</code></pre></div><p>Bây giờ chúng ta có thể tạo một cụm, với lệnh <a href=\"https://cloud.google.com/sdk/gcloud/reference/container/clusters/create\" target=\"_blank\" rel=\"noopener noreferrer\">gcloud container clusters create</a>. Bạn có thể chọn bất kỳ vùng nào từ danh sách <a href=\"https://cloud.google.com/about/locations/\" target=\"_blank\" rel=\"noopener noreferrer\">tại đây</a>. Tôi chọn Phần Lan. Lưu ý rằng một khu vực (ví dụ europe-north1) có thể có nhiều vùng (ví dụ -a). Hãy thêm một tham số nữa: <code class=\"language-text\">--cluster-version=1.29</code>. Tham số này sẽ yêu cầu GKE sử dụng phiên bản sẽ là mặc định vào tháng 4/2024. Lịch phát hành GKE xem <a href=\"https://cloud.google.com/kubernetes-engine/docs/release-schedule\" target=\"_blank\" rel=\"noopener noreferrer\">tại đây</a>.</p><div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ gcloud container clusters create dwk-cluster --zone<span class=\"token operator\">=</span>europe-north1-b --cluster-version<span class=\"token operator\">=</span><span class=\"token number\">1.29</span> --disk-size<span class=\"token operator\">=</span><span class=\"token number\">32</span> --num-nodes<span class=\"token operator\">=</span><span class=\"token number\">3</span> --machine-type<span class=\"token operator\">=</span>e2-micro\n\nERROR: <span class=\"token punctuation\">(</span>gcloud.container.clusters.create<span class=\"token punctuation\">)</span> ResponseError: <span class=\"token assign-left variable\">code</span><span class=\"token operator\">=</span><span class=\"token number\">403</span>, <span class=\"token assign-left variable\">message</span><span class=\"token operator\">=</span>Kubernetes Engine API chưa được sử dụng trong dự án dwk-gke-xxxxxx hoặc đã bị vô hiệu hóa. Kích hoạt nó bằng cách truy cập https://console.developers.google.com/apis/api/container.googleapis.com/overview?project<span class=\"token operator\">=</span>dwk-gke-xxxxxx rồi thử lại.</code></pre></div><p>Bạn có thể truy cập liên kết được cung cấp và bật Kubernetes Engine API, lưu ý rằng url được xuất ra là dành riêng cho tên dự án của bạn. Hoặc, bạn chỉ cần thực hiện lệnh sau trên dòng lệnh:</p><div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ gcloud services <span class=\"token builtin class-name\">enable</span> container.googleapis.com\n  Hoạt động <span class=\"token string\">\"operations/acf.p2-385245615727-2f855eed-e785-49ac-91da-896925a691ab\"</span> đã hoàn thành thành công.\n\n$ gcloud container clusters create dwk-cluster --zone<span class=\"token operator\">=</span>europe-north1-b --cluster-version<span class=\"token operator\">=</span><span class=\"token number\">1.29</span>\n  <span class=\"token punctuation\">..</span>.\n  Đang tạo cụm dwk-cluster tại europe-north1-b<span class=\"token punctuation\">..</span>.\n  <span class=\"token punctuation\">..</span>.\n  Đã tạo kubeconfig cho dwk-cluster.\n  NAME         LOCATION         MASTER_VERSION   MASTER_IP       MACHINE_TYPE  NODE_VERSION     NUM_NODES  STATUS\n  dwk-cluster  europe-north1-b  <span class=\"token number\">1.29</span>.8-gke.2200  <span class=\"token number\">35.228</span>.176.118  e2-medium     <span class=\"token number\">1.29</span>.8-gke.2200  <span class=\"token number\">3</span>          RUNNING</code></pre></div><p>Nếu lệnh không hoạt động, bạn cần cài đặt <em>gke-gcloud-auth-plugin</em> bằng cách làm theo <a href=\"https://cloud.google.com/kubernetes-engine/docs/how-to/cluster-access-for-kubectl#install_plugin\" target=\"_blank\" rel=\"noopener noreferrer\">hướng dẫn này</a>.</p><p>Nó đã đặt kubeconfig trỏ đúng hướng. Nhưng nếu cần làm lại, chúng ta có thể đặt kubeconfig như sau:</p><div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ gcloud container clusters get-credentials dwk-cluster --zone<span class=\"token operator\">=</span>europe-north1-b\n  Đang lấy endpoint và dữ liệu xác thực của cụm.\n  Đã tạo kubeconfig cho dwk-cluster.</code></pre></div><p>Bạn có thể kiểm tra thông tin cụm với <code class=\"language-text\">kubectl cluster-info</code> để xác nhận nó đang trỏ đúng.</p><h3 id=\"triển-khai-len-gke\" style=\"position:relative;\">Triển khai lên GKE<a href=\"#tri%E1%BB%83n-khai-len-gke\" aria-label=\"triển khai len gke permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p>Cụm mà chúng ta có bây giờ <em>gần như</em> giống với cụm chạy cục bộ. Hãy áp dụng <a href=\"https://github.com/kubernetes-hy/material-example/tree/master/app6\" target=\"_blank\" rel=\"noopener noreferrer\">ứng dụng này</a> tạo một chuỗi ngẫu nhiên và sau đó phục vụ một hình ảnh dựa trên chuỗi ngẫu nhiên đó. Điều này sẽ tạo 6 bản sao của tiến trình \"seedimage\".</p><div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl apply -f https://raw.githubusercontent.com/kubernetes-hy/material-example/e11a700350aede132b62d3b5fd63c05d6b976394/app6/manifests/deployment.yaml</code></pre></div><p>Việc expose service là nơi bắt đầu có sự khác biệt. Thay vì Ingress, chúng ta sẽ dùng service kiểu <a href=\"https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer\" target=\"_blank\" rel=\"noopener noreferrer\">LoadBalancer</a>. Lưu ý bước tiếp theo sẽ làm tăng <a href=\"https://cloud.google.com/compute/all-pricing#lb\" target=\"_blank\" rel=\"noopener noreferrer\">chi phí của cụm</a>.</p><p>Áp dụng file sau:</p><p><strong>service.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> seedimage<span class=\"token punctuation\">-</span>svc\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> LoadBalancer <span class=\"token comment\"># Đây là phần duy nhất có thể lạ</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> seedimage\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span></code></pre></div><p>Một service kiểu load balancer sẽ yêu cầu Google cung cấp cho chúng ta một load balancer. Chúng ta có thể chờ đến khi service nhận được IP bên ngoài:</p><div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl get svc --watch\n  NAME            TYPE           CLUSTER-IP      EXTERNAL-IP    PORT<span class=\"token punctuation\">(</span>S<span class=\"token punctuation\">)</span>        AGE\n  kubernetes      ClusterIP      <span class=\"token number\">10.31</span>.240.1     <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>         <span class=\"token number\">443</span>/TCP        144m\n  seedimage-svc   LoadBalancer   <span class=\"token number\">10.31</span>.241.224   <span class=\"token number\">35.228</span>.41.16   <span class=\"token number\">80</span>:30215/TCP   94s</code></pre></div><p>Nếu bây giờ truy cập <a href=\"http://35.228.41.16\" target=\"_blank\" rel=\"noopener noreferrer\">http://35.228.41.16</a> bằng trình duyệt, chúng ta sẽ thấy ứng dụng đang chạy. Làm mới trang sẽ thấy load balancer đôi khi trả về hình ảnh khác nhau. Lưu ý rằng chỉ có cổng 80, nên https sẽ không hoạt động.</p><div class=\"highlight-box\" markdown=\"1\">\nĐể tránh tiêu tốn tín dụng, hãy xóa cụm khi không cần dùng<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ gcloud container clusters delete dwk-cluster --zone<span class=\"token operator\">=</span>europe-north1-b</code></pre></div><p>Và khi tiếp tục, hãy tạo lại cụm.</p><div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ gcloud container clusters create dwk-cluster --zone<span class=\"token operator\">=</span>europe-north1-b --cluster-version<span class=\"token operator\">=</span><span class=\"token number\">1.29</span></code></pre></div><p>Đóng cụm cũng sẽ xóa mọi thứ bạn đã triển khai trên cụm. Vì vậy nếu bạn nghỉ vài ngày trong lúc làm bài tập, có thể phải làm lại. May mắn là chúng ta dùng cách tiếp cận khai báo nên chỉ cần áp dụng lại các file yaml là tiếp tục được.</p><h3 id=\"lưu-trữ-dữ-liệu-tren-gke\" style=\"position:relative;\">Lưu trữ dữ liệu trên GKE<a href=\"#l%C6%B0u-tr%E1%BB%AF-d%E1%BB%AF-li%E1%BB%87u-tren-gke\" aria-label=\"lưu trữ dữ liệu tren gke permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p>Google Kubernetes Engine sẽ tự động cung cấp một ổ đĩa lâu dài cho <a href=\"https://kubernetes.io/docs/concepts/storage/persistent-volumes/\" target=\"_blank\" rel=\"noopener noreferrer\">PersistentVolumeClaim</a> - chỉ cần không đặt storage class. Nếu muốn, bạn có thể đọc thêm <a href=\"https://cloud.google.com/kubernetes-engine/docs/concepts/persistent-volumes\" target=\"_blank\" rel=\"noopener noreferrer\">tại đây</a>.</p><exercise name='Bài tập 3.01: Pingpong GKE'><p>Triển khai ứng dụng Ping-pong lên GKE.</p><p>Trong bài tập này, hãy sử dụng service kiểu LoadBalancer để expose service.</p><p>Nếu log của Postgres báo</p><div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">initdb: error: directory <span class=\"token string\">\"/var/lib/postgresql/data\"</span> exists but is not empty\nIt contains a lost+found directory, perhaps due to it being a <span class=\"token function\">mount</span> point.\nUsing a <span class=\"token function\">mount</span> point directly as the data directory is not recommended.\nCreate a subdirectory under the <span class=\"token function\">mount</span> point.</code></pre></div><p>bạn có thể thêm cấu hình <em>subPath</em>:</p><p><strong>statefulset.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># ...</span>\n<span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> data\n    <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /var/lib/postgresql/data\n    <span class=\"token key atrule\">subPath</span><span class=\"token punctuation\">:</span> postgres\n<span class=\"token comment\"># ...</span></code></pre></div><p>Điều này sẽ tạo thư mục Postgres nơi dữ liệu sẽ được lưu. subPath cũng giúp dùng một volume cho nhiều mục đích.</p></exercise><h3 id=\"từ-service-sang-ingress\" style=\"position:relative;\">Từ Service sang Ingress<a href=\"#t%E1%BB%AB-service-sang-ingress\" aria-label=\"từ service sang ingress permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p>Service khá đơn giản. Hãy thử dùng Ingress vì nó cung cấp thêm công cụ đổi lại sự phức tạp.</p><p>Service kiểu <em>NodePort</em> là bắt buộc khi dùng Ingress trên GKE. Dù là NodePort, GKE không expose nó ra ngoài cụm. Hãy kiểm tra điều này bằng cách tiếp tục ví dụ trước.</p><p><strong>service.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> seedimage<span class=\"token punctuation\">-</span>svc\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> NodePort\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> seedimage\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span></code></pre></div><p><strong>ingress.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Ingress\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> seedimage<span class=\"token punctuation\">-</span>ing\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /\n            <span class=\"token key atrule\">pathType</span><span class=\"token punctuation\">:</span> Prefix\n            <span class=\"token key atrule\">backend</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> seedimage<span class=\"token punctuation\">-</span>svc\n                <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token key atrule\">number</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></code></pre></div><p>Khi bạn đã áp dụng các file này, bạn có thể xem port từ danh sách ingress:</p><div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ kubectl get ing\n  NAME            CLASS    HOSTS   ADDRESS         PORTS   AGE\n  seedimage-ing   &lt;none&gt;   *       34.120.61.234   80      2m13s</code></pre></div><p>Bây giờ địa chỉ ở đây sẽ là cách truy cập ứng dụng. Sẽ mất một lúc để triển khai, phản hồi có thể là 404 hoặc 502 khi nó đang khởi tạo. Ingress thực hiện kiểm tra sức khỏe bằng cách gửi GET tới / và mong đợi phản hồi HTTP 200.</p><exercise name='Bài tập 3.02: Quay lại với Ingress'><p>Triển khai các ứng dụng \"Log output\" và \"Ping-pong\" lên GKE và expose chúng bằng Ingress.</p><p>\"Ping-pong\" sẽ phải phản hồi tại đường dẫn /pingpong. Điều này có thể yêu cầu bạn chỉnh sửa lại một số phần của mã nguồn.</p><p>Lưu ý rằng Ingress mong đợi một service trả về phản hồi thành công tại đường dẫn / ngay cả khi service đó được ánh xạ tới đường dẫn khác!</p></exercise></div>","frontmatter":{"path":"/part-3/1-introduction-to-gke-vi","title":"Giới thiệu về Google Kubernetes Engine"},"fileAbsolutePath":"/home/runner/work/dwk2024/dwk2024/data/part-3/1-introduction-to-gke-vi.md"},"allPages":{"edges":[{"node":{"id":"5225f2a2-20f9-50ce-93ac-7b38f3105103","frontmatter":{"path":"/faq","title":"FAQ"}}},{"node":{"id":"e1ed6713-5992-5f7f-95a1-17efd97f57d8","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"7e706a38-3828-5118-bdec-3705a319a1b0","frontmatter":{"path":"/faq-vi","title":"Câu hỏi thường gặp"}}},{"node":{"id":"52d4cd1d-eb14-54f3-a18a-ef84b67c320d","frontmatter":{"path":"/index-en","title":"Homepage"}}},{"node":{"id":"04c5ddbd-7839-580f-82da-bc9fdbb49f84","frontmatter":{"path":"/known-problems-solutions-vi","title":"Các vấn đề bạn có thể gặp phải"}}},{"node":{"id":"3102d88f-7297-56fb-af03-27d1079fffd1","frontmatter":{"path":"/","title":"Trang chủ"}}},{"node":{"id":"c92ea568-3384-5ff8-8dfa-b9015597780d","frontmatter":{"path":"/known-problems-solutions","title":"Issues you may face"}}},{"node":{"id":"5e6b6ee0-b381-53f0-b84c-af378792b131","frontmatter":{"path":"/registration-and-completion","title":"Registration and Completion"}}},{"node":{"id":"58688080-4aa8-54e6-8b8b-02de1c4f6410","frontmatter":{"path":"/unity-assignment","title":"Unity Assignment"}}},{"node":{"id":"d9c993b6-f6b4-59a1-b119-f3b7218eec6b","frontmatter":{"path":"/sanasto","title":"Sanasto"}}},{"node":{"id":"8a3ee5be-7557-5fcd-954b-2351e74cd585","frontmatter":{"path":"/part-0/1-intro-vi","title":"Giới thiệu khóa học"}}},{"node":{"id":"23082016-7bbd-5215-8485-4ffccbf3ea1a","frontmatter":{"path":"/part-0/1-intro","title":"Course Introduction"}}},{"node":{"id":"771eaa93-2ef2-5e0f-9e1e-55914c67c4ac","frontmatter":{"path":"/part-0","title":"Part 0"}}},{"node":{"id":"1c236933-7ad5-5b61-8c07-07db3822d55a","frontmatter":{"path":"/part-1/2-introduction-to-debugging","title":"Introduction to Debugging"}}},{"node":{"id":"fe0342aa-a4c5-5b44-8591-71eb27f1a287","frontmatter":{"path":"/part-1/2-introduction-to-debugging-vi","title":"Giới thiệu về Debugging"}}},{"node":{"id":"7fc5c062-6b94-53ec-9aaa-adca66ce672e","frontmatter":{"path":"/part-1/5-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"3c788edf-62db-5e86-9366-17b53eda9244","frontmatter":{"path":"/part-1/5-summary","title":"Summary"}}},{"node":{"id":"8ed3365b-b788-5806-8ec5-bec3cb0f94c8","frontmatter":{"path":"/part-1","title":"Part 1"}}},{"node":{"id":"46a4a0e4-d131-537d-aa72-5b6726163a7d","frontmatter":{"path":"/part-2/1-networking-between-pods-vi","title":"Kết nối mạng giữa các pod"}}},{"node":{"id":"fd467661-6b24-545f-904c-52f4a7ade6b7","frontmatter":{"path":"/part-2/1-networking-between-pods","title":"Networking between pods"}}},{"node":{"id":"56110eda-875d-5bd9-a400-5bd5a009df7f","frontmatter":{"path":"/part-2/5-monitoring-vi","title":"Giám sát"}}},{"node":{"id":"8f3387b0-ec6e-5a86-982a-e52780d911f9","frontmatter":{"path":"/part-2/5-monitoring","title":"Monitoring"}}},{"node":{"id":"06173ac4-c2f8-57df-8dc8-450b5c2bb695","frontmatter":{"path":"/part-2/6-summary","title":"Summary"}}},{"node":{"id":"79f1cddb-6995-51c2-bf98-2adc13de9b13","frontmatter":{"path":"/part-2/6-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"8c3d747d-4f87-5a46-99ac-dfd0af5a893b","frontmatter":{"path":"/part-2","title":"Part 2"}}},{"node":{"id":"8d9fd774-9dbe-5cca-8395-9226fcf82c4a","frontmatter":{"path":"/part-3/4-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"b98b2895-6c9d-5234-939d-2f547cbf8a06","frontmatter":{"path":"/part-3/4-summary","title":"Summary"}}},{"node":{"id":"29bec4f5-8a0b-580d-ac84-9dbbd1d7152e","frontmatter":{"path":"/part-3","title":"Part 3"}}},{"node":{"id":"0045695d-e541-5acc-b4b8-551023d01733","frontmatter":{"path":"/part-4/4-summary","title":"Summary"}}},{"node":{"id":"a917b24d-df2b-5199-ac98-cd0f7560c63f","frontmatter":{"path":"/part-4","title":"Part 4"}}},{"node":{"id":"4dd8302d-d170-5d38-8198-4d0947322bbc","frontmatter":{"path":"/part-4/4-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"eb339401-26c8-594c-98fd-2f30a95275cd","frontmatter":{"path":"/part-5/4-beyond-kubernetes-vi","title":"Vượt ra ngoài Kubernetes"}}},{"node":{"id":"2318c18f-86e6-5a4e-958a-d1c38f8615cd","frontmatter":{"path":"/part-5/4-beyond-kubernetes","title":"Beyond Kubernetes"}}},{"node":{"id":"1d8ff75c-065b-565d-9ceb-01b9a276ae7a","frontmatter":{"path":"/part-5/5-summary","title":"Summary and end"}}},{"node":{"id":"781bd207-902e-59a2-a752-4958c2c93fb0","frontmatter":{"path":"/part-5/5-summary-vi","title":"Tóm tắt và kết thúc"}}},{"node":{"id":"829fd216-f995-5a77-b201-bb971aec73b4","frontmatter":{"path":"/part-0/2-kubernetes-in-three-diagrams-vi","title":"Kubernetes qua ba sơ đồ"}}},{"node":{"id":"98132cca-4dc3-5942-a6f4-1da87bc81a23","frontmatter":{"path":"/part-0/2-kubernetes-in-three-diagrams","title":"Kubernetes in three diagrams"}}},{"node":{"id":"8931bcb7-c40e-5d57-aa80-c4333972fbb8","frontmatter":{"path":"/part-1/3-introduction-to-networking-vi","title":"Giới thiệu về Mạng"}}},{"node":{"id":"90b8e83a-9d55-550a-908a-316708ce7f8c","frontmatter":{"path":"/part-1/3-introduction-to-networking","title":"Introduction to Networking"}}},{"node":{"id":"4fe00c0a-bb17-5d4c-8202-750493a755c9","frontmatter":{"path":"/part-1/4-introduction-to-storage-vi","title":"Giới thiệu về Lưu trữ"}}},{"node":{"id":"6cc3be66-6091-58fc-bcbd-1f27f9473f85","frontmatter":{"path":"/part-1/4-introduction-to-storage","title":"Introduction to Storage"}}},{"node":{"id":"d5206d16-d2fe-51fd-8acd-d85ecf0be257","frontmatter":{"path":"/part-2/2-organizing-a-cluster","title":"Organizing a cluster"}}},{"node":{"id":"b53df746-c24f-57e3-a9f3-d6d621697689","frontmatter":{"path":"/part-2/2-organizing-a-cluster-vi","title":"Tổ chức một cụm"}}},{"node":{"id":"e4534a9d-fb84-5d1f-83f0-35055feb0da7","frontmatter":{"path":"/part-2/3-configuring-applications","title":"Configuring applications"}}},{"node":{"id":"15be3d7c-b0b7-5bce-b3bf-8cec39d54630","frontmatter":{"path":"/part-2/3-configuring-applications-vi","title":"Cấu hình ứng dụng"}}},{"node":{"id":"02389078-a12f-561a-8a54-fa99a6950b92","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs-vi","title":"StatefulSet và Job"}}},{"node":{"id":"466aa711-527b-55a0-871b-13468e65d344","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs","title":"StatefulSets and Jobs"}}},{"node":{"id":"bea18f34-dcdc-59b8-ba24-3011680a0c58","frontmatter":{"path":"/part-3/1-introduction-to-gke-vi","title":"Giới thiệu về Google Kubernetes Engine"}}},{"node":{"id":"0049e57f-0bc7-5689-9169-43848a972877","frontmatter":{"path":"/part-3/2-deployment-pipeline-vi","title":"Quy trình Triển khai (Deployment Pipeline)"}}},{"node":{"id":"61f18dc7-1abf-5c75-9b54-0cee11c76a40","frontmatter":{"path":"/part-3/2-deployment-pipeline","title":"Deployment Pipeline"}}},{"node":{"id":"84db9628-b3df-5ca1-9d3d-5924e02ae549","frontmatter":{"path":"/part-3/1-introduction-to-gke","title":"Introduction to Google Kubernetes Engine"}}},{"node":{"id":"7dfec8c7-8ccb-50da-949d-ebd1de395dc4","frontmatter":{"path":"/part-3/3-gke-features-vi","title":"Các tính năng của GKE"}}},{"node":{"id":"423cbc46-2dfa-57e6-9dc5-761a93729600","frontmatter":{"path":"/part-3/3-gke-features","title":"GKE features"}}},{"node":{"id":"6df9c7be-f930-5827-a39c-0c1698b23600","frontmatter":{"path":"/part-4/3-gitops-vi","title":"Triển khai GitOps"}}},{"node":{"id":"46f9ce68-5ccd-5787-bd59-03852ad6fdcb","frontmatter":{"path":"/part-4/3-gitops","title":"GitOps"}}},{"node":{"id":"da1f8069-17bc-5c8e-9310-117bcedf5acf","frontmatter":{"path":"/part-5/2-custom-resource-definitions-vi","title":"Định nghĩa Tài nguyên Tùy chỉnh (Custom Resource Definitions)"}}},{"node":{"id":"31927db3-2182-55c7-b680-663754461d14","frontmatter":{"path":"/part-5/1-kubernetes-internals","title":"Kubernetes Internals"}}},{"node":{"id":"68c64f9f-c9a5-544b-bafb-b061665cacd0","frontmatter":{"path":"/part-5/3-service-mesh-vi","title":"Service Mesh"}}},{"node":{"id":"0e981ec1-99e0-5005-ba9f-4f626a81b7ce","frontmatter":{"path":"/part-5/1-kubernetes-internals-vi","title":"Bên trong Kubernetes"}}},{"node":{"id":"20ceed4e-761d-54d4-9acf-2669eac533c6","frontmatter":{"path":"/part-5/3-service-mesh","title":"Service Mesh"}}},{"node":{"id":"ccefb04a-5790-57f6-869b-d255b2203667","frontmatter":{"path":"/part-5/2-custom-resource-definitions","title":"Custom Resource Definitions"}}},{"node":{"id":"306c87f3-9adb-5d8b-a3ce-072f8e6cfa43","frontmatter":{"path":"/part-5","title":"Part 5"}}},{"node":{"id":"97ead58a-8493-5fdd-808e-d4a56de573b0","frontmatter":{"path":"/part-1/1-first-deploy","title":"First Deploy"}}},{"node":{"id":"c179c521-bb62-52bd-808b-d4869df5302a","frontmatter":{"path":"/part-4/1-update-strategies-and-prometheus-vi","title":"Chiến lược cập nhật và Prometheus"}}},{"node":{"id":"6f4f18ce-5aa9-5bb5-9d74-0a631a78e6b3","frontmatter":{"path":"/part-4/2-messaging-systems-vi","title":"Hệ thống nhắn tin"}}},{"node":{"id":"898b0354-f1a2-5664-97de-d84b16018395","frontmatter":{"path":"/part-4/1-update-strategies-and-prometheus","title":"Update Strategies and Prometheus"}}},{"node":{"id":"6981a9d7-619d-51a9-9490-74bc77c0f55b","frontmatter":{"path":"/part-4/2-messaging-systems","title":"Messaging Systems"}}},{"node":{"id":"a17c4c44-7396-543f-b6b4-7adf57808aa8","frontmatter":{"path":"/part-1/1-first-deploy-vi","title":"Triển khai đầu tiên"}}}]}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}