{"componentChunkName":"component---src-templates-course-content-template-js","path":"/part-2/3-configuring-applications-vi","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"Mục tiêu học tập"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sau phần này bạn"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"biết cách truyền biến vào pod của mình"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"có các lựa chọn để lưu trữ secret vào hệ thống quản lý phiên bản"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"có kinh nghiệm tra cứu thông tin trong tài liệu Kubernetes"}]},{"type":"text","value":"\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Kubernetes có hai loại tài nguyên để quản lý cấu hình. "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/configuration/secret/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Secret"}]},{"type":"text","value":" dùng cho thông tin nhạy cảm được truyền vào container khi chạy. "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/configuration/configmap/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"ConfigMap"}]},{"type":"text","value":" khá giống secret nhưng có thể chứa bất kỳ loại cấu hình nào. Trường hợp sử dụng ConfigMap rất đa dạng: bạn có thể ánh xạ một ConfigMap thành một file với các giá trị mà server đọc khi chạy. Thay đổi ConfigMap sẽ lập tức thay đổi hành vi của ứng dụng. Cả hai đều có thể dùng để truyền biến môi trường."}]},{"type":"element","tagName":"h3","properties":{"id":"secret","style":"position:relative;"},"children":[{"type":"text","value":"Secret"},{"type":"element","tagName":"a","properties":{"href":"#secret","ariaLabel":"secret permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Hãy sử dụng "},{"type":"element","tagName":"a","properties":{"href":"https://pixabay.com/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"pixabay"}]},{"type":"text","value":" để hiển thị ảnh trên một web app đơn giản. Xác thực với API được thực hiện bằng API key. Theo "},{"type":"element","tagName":"a","properties":{"href":"https://pixabay.com/api/docs/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"tài liệu API"}]},{"type":"text","value":" bạn chỉ cần đăng nhập để lấy key."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Các manifest của ứng dụng ở "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/kubernetes-hy/material-example/tree/master/app4/manifests","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"đây"}]},{"type":"text","value":". Hãy khởi động app với service và ingress:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"shell"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-shell"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"$ kubectl apply -f https://raw.githubusercontent.com/kubernetes-hy/material-example/master/app4/manifests/deployment.yaml "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"\\"}]},{"type":"text","value":"\n                -f https://raw.githubusercontent.com/kubernetes-hy/material-example/master/app4/manifests/ingress.yaml "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"\\"}]},{"type":"text","value":"\n                -f https://raw.githubusercontent.com/kubernetes-hy/material-example/master/app4/manifests/service.yaml"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ứng dụng yêu cầu biến môi trường API_KEY với giá trị là một API key hợp lệ."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Biến môi trường này được định nghĩa là một "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/configuration/secret/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"secret"}]},{"type":"text","value":" trong deployment như sau:"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"deployment.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# ..."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"containers"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" imageagain\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"envFrom"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"secretRef"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" pixabay"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"apikey"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Điều này giả định rằng secret "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"pixabay-apikey"}]},{"type":"text","value":" định nghĩa key dưới tên biến "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"API"}]},{"type":"text","value":"KEY_. Nếu tên biến môi trường trong secret khác, bạn có thể dùng dạng khai báo dài hơn trong deployment:"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"deployment.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# ..."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"containers"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" imageagain\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"env"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" API_KEY "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Tên biến môi trường truyền vào container"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"valueFrom"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"secretKeyRef"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" pixabay"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"apikey\n            "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"key"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" API_KEY "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Tên biến trong secret"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ứng dụng sẽ không chạy ngay và bạn sẽ thấy:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"$ kubectl get pod\nNAME                            READY   STATUS                       RESTARTS       AGE\nimageapi-dep-6cdd4879f7-zwlbr   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"/1     CreateContainerConfigError   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"              13m"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Lý do chính xác có thể xem bằng lệnh "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"describe"}]},{"type":"text","value":":"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"$ kubectl describe pod imageapi-dep-6cdd4879f7-zwlbr\nName:             imageapi-dep-6cdd4879f7-zwlbr\nStatus:           Pending\nIP:               "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.42"}]},{"type":"text","value":".0.89\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":".."}]},{"type":"text","value":".\n\nEvents:\n  Type     Reason     Age     From       Message\n  ----     ------     ----    ----       -------\n  Warning  Failed     21m     kubelet    Error: secret "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"pixabay-apikey\""}]},{"type":"text","value":" not found\n  Normal   Pulled     3m15s   kubelet    Container image "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"jakousa/dwk-app4:b7fc18de2376da80ff0cfc72cf581a9f94d10e64\""}]},{"type":"text","value":" already present on machine"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Hãy sử dụng secret để truyền biến môi trường API key vào ứng dụng."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Secret sử dụng mã hóa "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Base64","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"base64"}]},{"type":"text","value":" để tránh gặp vấn đề với ký tự đặc biệt. Chúng ta cũng nên dùng mã hóa để tránh lộ API_KEY ra ngoài. Đầu tiên, để kiểm thử, hãy tạo và apply một file secret.yaml như sau:"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"secret.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Secret\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" pixabay"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"apikey\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"data"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"API_KEY"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" aHR0cDovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PWRRdzR3OVdnWGNR\n  "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Giá trị đã mã hóa base64, lưu ý giá trị này không dùng được"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bạn có thể tạo key mã hóa base64 bằng "},{"type":"element","tagName":"a","properties":{"href":"https://www.base64encode.org/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"công cụ online này"}]},{"type":"text","value":" hoặc trên terminal với lệnh "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"base64"}]},{"type":"text","value":":"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"$ "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" -n "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'my-string'"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" base64\nbXktc3RyaW5n"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vì container đã được cấu hình lấy biến môi trường từ secret nên nó sẽ tự động nhận giá trị. Giờ bạn có thể xác nhận app hoạt động tại "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:8081","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost:8081"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vì ai cũng có thể giải mã base64 nên ta không nên lưu file này vào hệ thống quản lý phiên bản. Nếu muốn lưu cấu hình lâu dài, ta cần mã hóa giá trị."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Có nhiều giải pháp quản lý secret tùy nền tảng. Các nhà cung cấp đám mây có thể có giải pháp riêng, như Google Cloud "},{"type":"element","tagName":"a","properties":{"href":"https://cloud.google.com/secret-manager","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Secret Manager"}]},{"type":"text","value":" hoặc "},{"type":"element","tagName":"a","properties":{"href":"https://aws.amazon.com/secrets-manager/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"AWS Secrets Manager"}]},{"type":"text","value":". Với Kubernetes, bạn có thể dùng "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/bitnami-labs/sealed-secrets","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"SealedSecrets"}]},{"type":"text","value":". Thực tế, SealedSecrets từng được dùng ở phiên bản trước của khóa học này."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Chúng ta sẽ dùng "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/mozilla/sops","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"SOPS"}]},{"type":"text","value":" để mã hóa file secret.yaml. Công cụ này khá linh hoạt, bạn có thể dùng cho nhiều môi trường khác nhau, kể cả với file Docker compose. Hãy đọc qua Readme, hoặc ít nhất phần "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/mozilla/sops#motivation","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Motivation"}]},{"type":"text","value":". Chúng ta sẽ dùng "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/FiloSottile/age","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"age"}]},{"type":"text","value":" để mã hóa vì nó được khuyến nghị hơn PGP. Hãy cài cả SOPS và age."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tạo một cặp khóa trước:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"$ age-keygen -o key.txt\n  Public key: age17mgq9ygh23q0cr00mjn0dfn8msak0apdy0ymjv5k50qzy75zmfkqzjdam4"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"File key.txt này chứa cả public và secret key. Secret key không được đưa vào hệ thống quản lý phiên bản, đó là khóa cá nhân của bạn. Hãy mã hóa giá trị trong file secret.yaml. Bạn cũng có thể bỏ qua —encrypted-regex nếu muốn."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"$ sops --encrypt "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"\\"}]},{"type":"text","value":"\n       --age age17mgq9ygh23q0cr00mjn0dfn8msak0apdy0ymjv5k50qzy75zmfkqzjdam4 "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"\\"}]},{"type":"text","value":"\n       --encrypted-regex "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'^(data)$'"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"\\"}]},{"type":"text","value":"\n       secret.yaml "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":" secret.enc.yaml"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"File secret.enc.yaml sẽ trông như sau:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Secret\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" pixabay"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"apikey\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"data"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"API_KEY"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ENC"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":"AES256_GCM"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"data"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"geKXBLn4kZ9A2KHnFk4RCeRRnUZn0DjtyxPSAVCtHzoh8r6YsCUX3KiYmeuaYixHv3DRKHXTyjg="},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"iv"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"Lk290gWZnUGr8ygLGoKLaEJ3pzGBySyFJFG/AjwfkJI="},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"tag"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"BOSX7xJ/E07mXz9ZFLCT2Q=="},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"type"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"str"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"sops"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kms"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"gcp_kms"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"azure_kv"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"hc_vault"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"age"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"recipient"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" age17mgq9ygh23q0cr00mjn0dfn8msak0apdy0ymjv5k50qzy75zmfkqzjdam4\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"enc"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"|"}]},{"type":"element","tagName":"span","properties":{"className":["token","scalar","string"]},"children":[{"type":"text","value":"\n        -----BEGIN AGE ENCRYPTED FILE-----\n        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBDczBhbGNxUkc4R0U0SWZI\n        OEVYTEdzNUlVMEY3WnR6aVJ6OEpGeCtJQ1hVCjVSbDBRUnhLQjZYblQ0UHlneDIv\n        UmswM2xKUWxRMHZZQjVJU21UbDNEb3MKLS0tIGhOMy9lQWx4Q0FUdVhoVlZQMjZz\n        dDEreFAvV3Nqc3lIRWh3RGRUczBzdXcKh7S4q8qp5SrDXLQHZTpYlG43vLfBlqcZ\n        BypI8yEuu18rCjl3HJ+9jbB0mrzp60ld6yojUnaggzEaVaCPSH/BMA==\n        -----END AGE ENCRYPTED FILE-----"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"lastmodified"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"2021-10-29T12:20:40Z\""}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"mac"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ENC"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":"AES256_GCM"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"data"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"qhOMGFCDBXWhuildW81qTni1bnaBBsYo7UHlv2PfQf8yVrdXDtg7GylX9KslGvK22/9xxa2dtlDG7cIrYFpYQPAh/WpOzzn9R26nuTwvZ6RscgFzHCR7yIqJexZJJszC5yd3w5RArKR4XpciTeG53ygb+ng6qKdsQsvb9nQeBxk="},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"iv"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"PZLF3Y+OhtLo+/M0C0hqINM/p5K94tb5ZGc/OG8loJI="},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"tag"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"ziFOjWuAW/7kSA5tyAbgNg=="},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":","}]},{"type":"text","value":"type"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"str"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"pgp"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"encrypted_regex"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ^(data)$\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"version"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" 3.7.1"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Chúng ta có thể lưu file này vào hệ thống quản lý phiên bản một cách an toàn, vì chỉ những ai có secret key của "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"age17mgq9ygh23q0cr00mjn0dfn8msak0apdy0ymjv5k50qzy75zmfkqzjdam4"}]},{"type":"text","value":" mới giải mã được. Hãy nhớ dùng khóa của riêng bạn!"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nếu muốn mã hóa file cho cả nhóm, bạn cần thêm danh sách public key khi mã hóa. Bất kỳ ai có private key đều có thể giải mã file. Thực tế, cách tốt nhất là (gần như) không ai giữ private key! Public key dùng để mã hóa từng file, còn private key lưu riêng và chỉ dùng khi cần giải mã."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bạn có thể giải mã file đã mã hóa bằng cách export biến môi trường "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"SOPS"}]},{"type":"text","value":"AGE"},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"KEY"}]},{"type":"text","value":"FILE_ trỏ tới file key.txt và chạy sops với cờ —decrypt."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"shell"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-shell"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"$ "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"export"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"SOPS_AGE_KEY_FILE"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$("}]},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"pwd"}]},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":")"}]}]},{"type":"text","value":"/key.txt\n\n$ sops --decrypt secret.enc.yaml "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":" secret.yaml"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Bạn cũng có thể apply file secret yaml qua pipe trực tiếp, giúp tránh tạo file secret.yaml dạng plain:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"shell"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-shell"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"$ sops --decrypt secret.enc.yaml "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"|"}]},{"type":"text","value":" kubectl apply -f -"}]}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 2.05: Secrets"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Trong tất cả các bài tập sau, nếu bạn sử dụng API key hoặc mật khẩu (ví dụ mật khẩu database), hãy dùng Secret. Bạn có thể dùng "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"SOPS"}]},{"type":"text","value":" để lưu vào git repository. "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Không bao giờ"}]},{"type":"text","value":" lưu file chưa mã hóa vào git repository."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Không có gì cụ thể để nộp, tất cả các bài nộp sau phải tuân thủ quy tắc trên."}]}]},{"type":"element","tagName":"h3","properties":{"id":"configmap","style":"position:relative;"},"children":[{"type":"text","value":"ConfigMap"},{"type":"element","tagName":"a","properties":{"href":"#configmap","ariaLabel":"configmap permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/configuration/configmap/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"ConfigMap"}]},{"type":"text","value":" cũng tương tự nhưng dữ liệu không cần mã hóa và không được mã hóa. Giả sử bạn có một server game nhận file cấu hình "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"serverconfig.txt"}]},{"type":"text","value":" như sau:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"ini"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-ini"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ini"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"maxplayers"}]},{"type":"element","tagName":"span","properties":{"className":["token","attr-value"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"12"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"difficulty"}]},{"type":"element","tagName":"span","properties":{"className":["token","attr-value"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"2"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ta có thể dùng ConfigMap để chứa file này:"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"configmap.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" ConfigMap\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" example"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"configmap\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"data"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"serverconfig.txt"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"|"}]},{"type":"element","tagName":"span","properties":{"className":["token","scalar","string"]},"children":[{"type":"text","value":"\n    maxplayers=12\n    difficulty=2"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Giờ ConfigMap có thể được mount vào container như một volume. Khi thay đổi giá trị, ví dụ \"maxplayers\", rồi apply lại ConfigMap thì thay đổi sẽ được phản ánh vào volume đó."}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 2.06: Documentation and ConfigMaps"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sử dụng tài liệu chính thức của Kubernetes cho bài tập này."}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/configuration/configmap/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://kubernetes.io/docs/concepts/configuration/configmap/"}]},{"type":"text","value":" và"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/"}]}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"sẽ chứa tất cả những gì bạn cần."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tạo một ConfigMap cho ứng dụng \"Log output\". ConfigMap này nên định nghĩa một file "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"information.txt"}]},{"type":"text","value":" và một biến môi trường "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"MESSAGE"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ứng dụng nên mount file này làm volume, đặt biến môi trường và in nội dung của chúng cùng với output thông thường:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"file content: this text is from file\nenv variable: MESSAGE=hello world\n2024-03-30T12:15:17.705Z: 8523ecb1-c716-4cb6-a044-b9e83bb98e43.\nPing / Pongs: 3"}]}]}]}]}]},"html":"<div><text-box variant='learningObjectives' name='Mục tiêu học tập'><p>Sau phần này bạn</p><ul>\n<li>biết cách truyền biến vào pod của mình</li>\n<li>có các lựa chọn để lưu trữ secret vào hệ thống quản lý phiên bản</li>\n<li>có kinh nghiệm tra cứu thông tin trong tài liệu Kubernetes</li>\n</ul></text-box><p>Kubernetes có hai loại tài nguyên để quản lý cấu hình. <a href=\"https://kubernetes.io/docs/concepts/configuration/secret/\" target=\"_blank\" rel=\"noopener noreferrer\">Secret</a> dùng cho thông tin nhạy cảm được truyền vào container khi chạy. <a href=\"https://kubernetes.io/docs/concepts/configuration/configmap/\" target=\"_blank\" rel=\"noopener noreferrer\">ConfigMap</a> khá giống secret nhưng có thể chứa bất kỳ loại cấu hình nào. Trường hợp sử dụng ConfigMap rất đa dạng: bạn có thể ánh xạ một ConfigMap thành một file với các giá trị mà server đọc khi chạy. Thay đổi ConfigMap sẽ lập tức thay đổi hành vi của ứng dụng. Cả hai đều có thể dùng để truyền biến môi trường.</p><h3 id=\"secret\" style=\"position:relative;\">Secret<a href=\"#secret\" aria-label=\"secret permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p>Hãy sử dụng <a href=\"https://pixabay.com/\" target=\"_blank\" rel=\"noopener noreferrer\">pixabay</a> để hiển thị ảnh trên một web app đơn giản. Xác thực với API được thực hiện bằng API key. Theo <a href=\"https://pixabay.com/api/docs/\" target=\"_blank\" rel=\"noopener noreferrer\">tài liệu API</a> bạn chỉ cần đăng nhập để lấy key.</p><p>Các manifest của ứng dụng ở <a href=\"https://github.com/kubernetes-hy/material-example/tree/master/app4/manifests\" target=\"_blank\" rel=\"noopener noreferrer\">đây</a>. Hãy khởi động app với service và ingress:</p><div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl apply -f https://raw.githubusercontent.com/kubernetes-hy/material-example/master/app4/manifests/deployment.yaml <span class=\"token punctuation\">\\</span>\n                -f https://raw.githubusercontent.com/kubernetes-hy/material-example/master/app4/manifests/ingress.yaml <span class=\"token punctuation\">\\</span>\n                -f https://raw.githubusercontent.com/kubernetes-hy/material-example/master/app4/manifests/service.yaml</code></pre></div><p>Ứng dụng yêu cầu biến môi trường API_KEY với giá trị là một API key hợp lệ.</p><p>Biến môi trường này được định nghĩa là một <a href=\"https://kubernetes.io/docs/concepts/configuration/secret/\" target=\"_blank\" rel=\"noopener noreferrer\">secret</a> trong deployment như sau:</p><p><strong>deployment.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># ...</span>\n<span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> imageagain\n    <span class=\"token key atrule\">envFrom</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">secretRef</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> pixabay<span class=\"token punctuation\">-</span>apikey</code></pre></div><p>Điều này giả định rằng secret <em>pixabay-apikey</em> định nghĩa key dưới tên biến <em>API</em>KEY_. Nếu tên biến môi trường trong secret khác, bạn có thể dùng dạng khai báo dài hơn trong deployment:</p><p><strong>deployment.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># ...</span>\n<span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> imageagain\n    <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> API_KEY <span class=\"token comment\"># Tên biến môi trường truyền vào container</span>\n        <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">secretKeyRef</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> pixabay<span class=\"token punctuation\">-</span>apikey\n            <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> API_KEY <span class=\"token comment\"># Tên biến trong secret</span></code></pre></div><p>Ứng dụng sẽ không chạy ngay và bạn sẽ thấy:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ kubectl get pod\nNAME                            READY   STATUS                       RESTARTS       AGE\nimageapi-dep-6cdd4879f7-zwlbr   <span class=\"token number\">0</span>/1     CreateContainerConfigError   <span class=\"token number\">0</span>              13m</code></pre></div><p>Lý do chính xác có thể xem bằng lệnh <code class=\"language-text\">describe</code>:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ kubectl describe pod imageapi-dep-6cdd4879f7-zwlbr\nName:             imageapi-dep-6cdd4879f7-zwlbr\nStatus:           Pending\nIP:               <span class=\"token number\">10.42</span>.0.89\n\n<span class=\"token punctuation\">..</span>.\n\nEvents:\n  Type     Reason     Age     From       Message\n  ----     ------     ----    ----       -------\n  Warning  Failed     21m     kubelet    Error: secret <span class=\"token string\">\"pixabay-apikey\"</span> not found\n  Normal   Pulled     3m15s   kubelet    Container image <span class=\"token string\">\"jakousa/dwk-app4:b7fc18de2376da80ff0cfc72cf581a9f94d10e64\"</span> already present on machine</code></pre></div><p>Hãy sử dụng secret để truyền biến môi trường API key vào ứng dụng.</p><p>Secret sử dụng mã hóa <a href=\"https://en.wikipedia.org/wiki/Base64\" target=\"_blank\" rel=\"noopener noreferrer\">base64</a> để tránh gặp vấn đề với ký tự đặc biệt. Chúng ta cũng nên dùng mã hóa để tránh lộ API_KEY ra ngoài. Đầu tiên, để kiểm thử, hãy tạo và apply một file secret.yaml như sau:</p><p><strong>secret.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Secret\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> pixabay<span class=\"token punctuation\">-</span>apikey\n<span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">API_KEY</span><span class=\"token punctuation\">:</span> aHR0cDovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PWRRdzR3OVdnWGNR\n  <span class=\"token comment\"># Giá trị đã mã hóa base64, lưu ý giá trị này không dùng được</span></code></pre></div><p>Bạn có thể tạo key mã hóa base64 bằng <a href=\"https://www.base64encode.org/\" target=\"_blank\" rel=\"noopener noreferrer\">công cụ online này</a> hoặc trên terminal với lệnh <code class=\"language-text\">base64</code>:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">echo</span> -n <span class=\"token string\">'my-string'</span> <span class=\"token operator\">|</span> base64\nbXktc3RyaW5n</code></pre></div><p>Vì container đã được cấu hình lấy biến môi trường từ secret nên nó sẽ tự động nhận giá trị. Giờ bạn có thể xác nhận app hoạt động tại <a href=\"http://localhost:8081\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:8081</a>.</p><p>Vì ai cũng có thể giải mã base64 nên ta không nên lưu file này vào hệ thống quản lý phiên bản. Nếu muốn lưu cấu hình lâu dài, ta cần mã hóa giá trị.</p><p>Có nhiều giải pháp quản lý secret tùy nền tảng. Các nhà cung cấp đám mây có thể có giải pháp riêng, như Google Cloud <a href=\"https://cloud.google.com/secret-manager\" target=\"_blank\" rel=\"noopener noreferrer\">Secret Manager</a> hoặc <a href=\"https://aws.amazon.com/secrets-manager/\" target=\"_blank\" rel=\"noopener noreferrer\">AWS Secrets Manager</a>. Với Kubernetes, bạn có thể dùng <a href=\"https://github.com/bitnami-labs/sealed-secrets\" target=\"_blank\" rel=\"noopener noreferrer\">SealedSecrets</a>. Thực tế, SealedSecrets từng được dùng ở phiên bản trước của khóa học này.</p><p>Chúng ta sẽ dùng <a href=\"https://github.com/mozilla/sops\" target=\"_blank\" rel=\"noopener noreferrer\">SOPS</a> để mã hóa file secret.yaml. Công cụ này khá linh hoạt, bạn có thể dùng cho nhiều môi trường khác nhau, kể cả với file Docker compose. Hãy đọc qua Readme, hoặc ít nhất phần <a href=\"https://github.com/mozilla/sops#motivation\" target=\"_blank\" rel=\"noopener noreferrer\">Motivation</a>. Chúng ta sẽ dùng <a href=\"https://github.com/FiloSottile/age\" target=\"_blank\" rel=\"noopener noreferrer\">age</a> để mã hóa vì nó được khuyến nghị hơn PGP. Hãy cài cả SOPS và age.</p><p>Tạo một cặp khóa trước:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ age-keygen -o key.txt\n  Public key: age17mgq9ygh23q0cr00mjn0dfn8msak0apdy0ymjv5k50qzy75zmfkqzjdam4</code></pre></div><p>File key.txt này chứa cả public và secret key. Secret key không được đưa vào hệ thống quản lý phiên bản, đó là khóa cá nhân của bạn. Hãy mã hóa giá trị trong file secret.yaml. Bạn cũng có thể bỏ qua —encrypted-regex nếu muốn.</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ sops --encrypt <span class=\"token punctuation\">\\</span>\n       --age age17mgq9ygh23q0cr00mjn0dfn8msak0apdy0ymjv5k50qzy75zmfkqzjdam4 <span class=\"token punctuation\">\\</span>\n       --encrypted-regex <span class=\"token string\">'^(data)$'</span> <span class=\"token punctuation\">\\</span>\n       secret.yaml <span class=\"token operator\">></span> secret.enc.yaml</code></pre></div><p>File secret.enc.yaml sẽ trông như sau:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Secret\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> pixabay<span class=\"token punctuation\">-</span>apikey\n<span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">API_KEY</span><span class=\"token punctuation\">:</span> ENC<span class=\"token punctuation\">[</span>AES256_GCM<span class=\"token punctuation\">,</span>data<span class=\"token punctuation\">:</span>geKXBLn4kZ9A2KHnFk4RCeRRnUZn0DjtyxPSAVCtHzoh8r6YsCUX3KiYmeuaYixHv3DRKHXTyjg=<span class=\"token punctuation\">,</span>iv<span class=\"token punctuation\">:</span>Lk290gWZnUGr8ygLGoKLaEJ3pzGBySyFJFG/AjwfkJI=<span class=\"token punctuation\">,</span>tag<span class=\"token punctuation\">:</span>BOSX7xJ/E07mXz9ZFLCT2Q==<span class=\"token punctuation\">,</span>type<span class=\"token punctuation\">:</span>str<span class=\"token punctuation\">]</span>\n<span class=\"token key atrule\">sops</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">kms</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">gcp_kms</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">azure_kv</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">hc_vault</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">age</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">recipient</span><span class=\"token punctuation\">:</span> age17mgq9ygh23q0cr00mjn0dfn8msak0apdy0ymjv5k50qzy75zmfkqzjdam4\n      <span class=\"token key atrule\">enc</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n        -----BEGIN AGE ENCRYPTED FILE-----\n        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBDczBhbGNxUkc4R0U0SWZI\n        OEVYTEdzNUlVMEY3WnR6aVJ6OEpGeCtJQ1hVCjVSbDBRUnhLQjZYblQ0UHlneDIv\n        UmswM2xKUWxRMHZZQjVJU21UbDNEb3MKLS0tIGhOMy9lQWx4Q0FUdVhoVlZQMjZz\n        dDEreFAvV3Nqc3lIRWh3RGRUczBzdXcKh7S4q8qp5SrDXLQHZTpYlG43vLfBlqcZ\n        BypI8yEuu18rCjl3HJ+9jbB0mrzp60ld6yojUnaggzEaVaCPSH/BMA==\n        -----END AGE ENCRYPTED FILE-----</span>\n  <span class=\"token key atrule\">lastmodified</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2021-10-29T12:20:40Z\"</span>\n  <span class=\"token key atrule\">mac</span><span class=\"token punctuation\">:</span> ENC<span class=\"token punctuation\">[</span>AES256_GCM<span class=\"token punctuation\">,</span>data<span class=\"token punctuation\">:</span>qhOMGFCDBXWhuildW81qTni1bnaBBsYo7UHlv2PfQf8yVrdXDtg7GylX9KslGvK22/9xxa2dtlDG7cIrYFpYQPAh/WpOzzn9R26nuTwvZ6RscgFzHCR7yIqJexZJJszC5yd3w5RArKR4XpciTeG53ygb+ng6qKdsQsvb9nQeBxk=<span class=\"token punctuation\">,</span>iv<span class=\"token punctuation\">:</span>PZLF3Y+OhtLo+/M0C0hqINM/p5K94tb5ZGc/OG8loJI=<span class=\"token punctuation\">,</span>tag<span class=\"token punctuation\">:</span>ziFOjWuAW/7kSA5tyAbgNg==<span class=\"token punctuation\">,</span>type<span class=\"token punctuation\">:</span>str<span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">pgp</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token key atrule\">encrypted_regex</span><span class=\"token punctuation\">:</span> ^(data)$\n  <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> 3.7.1</code></pre></div><p>Chúng ta có thể lưu file này vào hệ thống quản lý phiên bản một cách an toàn, vì chỉ những ai có secret key của <code class=\"language-text\">age17mgq9ygh23q0cr00mjn0dfn8msak0apdy0ymjv5k50qzy75zmfkqzjdam4</code> mới giải mã được. Hãy nhớ dùng khóa của riêng bạn!</p><p>Nếu muốn mã hóa file cho cả nhóm, bạn cần thêm danh sách public key khi mã hóa. Bất kỳ ai có private key đều có thể giải mã file. Thực tế, cách tốt nhất là (gần như) không ai giữ private key! Public key dùng để mã hóa từng file, còn private key lưu riêng và chỉ dùng khi cần giải mã.</p><p>Bạn có thể giải mã file đã mã hóa bằng cách export biến môi trường <em>SOPS</em>AGE<em>KEY</em>FILE_ trỏ tới file key.txt và chạy sops với cờ —decrypt.</p><div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">SOPS_AGE_KEY_FILE</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">pwd</span><span class=\"token variable\">)</span></span>/key.txt\n\n$ sops --decrypt secret.enc.yaml <span class=\"token operator\">></span> secret.yaml</code></pre></div><p>Bạn cũng có thể apply file secret yaml qua pipe trực tiếp, giúp tránh tạo file secret.yaml dạng plain:</p><div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ sops --decrypt secret.enc.yaml <span class=\"token operator\">|</span> kubectl apply -f -</code></pre></div><exercise name='Exercise 2.05: Secrets'><p>Trong tất cả các bài tập sau, nếu bạn sử dụng API key hoặc mật khẩu (ví dụ mật khẩu database), hãy dùng Secret. Bạn có thể dùng <code class=\"language-text\">SOPS</code> để lưu vào git repository. <em>Không bao giờ</em> lưu file chưa mã hóa vào git repository.</p><p>Không có gì cụ thể để nộp, tất cả các bài nộp sau phải tuân thủ quy tắc trên.</p></exercise><h3 id=\"configmap\" style=\"position:relative;\">ConfigMap<a href=\"#configmap\" aria-label=\"configmap permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3><p><a href=\"https://kubernetes.io/docs/concepts/configuration/configmap/\" target=\"_blank\" rel=\"noopener noreferrer\">ConfigMap</a> cũng tương tự nhưng dữ liệu không cần mã hóa và không được mã hóa. Giả sử bạn có một server game nhận file cấu hình <em>serverconfig.txt</em> như sau:</p><div class=\"gatsby-highlight\" data-language=\"ini\"><pre class=\"language-ini\"><code class=\"language-ini\"><span class=\"token constant\">maxplayers</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>12</span>\n<span class=\"token constant\">difficulty</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>2</span></code></pre></div><p>Ta có thể dùng ConfigMap để chứa file này:</p><p><strong>configmap.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> example<span class=\"token punctuation\">-</span>configmap\n<span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">serverconfig.txt</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n    maxplayers=12\n    difficulty=2</span></code></pre></div><p>Giờ ConfigMap có thể được mount vào container như một volume. Khi thay đổi giá trị, ví dụ \"maxplayers\", rồi apply lại ConfigMap thì thay đổi sẽ được phản ánh vào volume đó.</p><exercise name='Exercise 2.06: Documentation and ConfigMaps'><p>Sử dụng tài liệu chính thức của Kubernetes cho bài tập này.</p><ul>\n<li><a href=\"https://kubernetes.io/docs/concepts/configuration/configmap/\" target=\"_blank\" rel=\"noopener noreferrer\">https://kubernetes.io/docs/concepts/configuration/configmap/</a> và</li>\n<li><a href=\"https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/\" target=\"_blank\" rel=\"noopener noreferrer\">https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/</a></li>\n</ul><p>sẽ chứa tất cả những gì bạn cần.</p><p>Tạo một ConfigMap cho ứng dụng \"Log output\". ConfigMap này nên định nghĩa một file <em>information.txt</em> và một biến môi trường <em>MESSAGE</em>.</p><p>Ứng dụng nên mount file này làm volume, đặt biến môi trường và in nội dung của chúng cùng với output thông thường:</p><div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">file content: this text is from file\nenv variable: MESSAGE=hello world\n2024-03-30T12:15:17.705Z: 8523ecb1-c716-4cb6-a044-b9e83bb98e43.\nPing / Pongs: 3</code></pre></div></exercise></div>","frontmatter":{"path":"/part-2/3-configuring-applications-vi","title":"Cấu hình ứng dụng"},"fileAbsolutePath":"/home/runner/work/dwk2024/dwk2024/data/part-2/3-configuring-applications-vi.md"},"allPages":{"edges":[{"node":{"id":"7e706a38-3828-5118-bdec-3705a319a1b0","frontmatter":{"path":"/faq-vi","title":"Câu hỏi thường gặp"}}},{"node":{"id":"e1ed6713-5992-5f7f-95a1-17efd97f57d8","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"3102d88f-7297-56fb-af03-27d1079fffd1","frontmatter":{"path":"/","title":"Trang chủ"}}},{"node":{"id":"5225f2a2-20f9-50ce-93ac-7b38f3105103","frontmatter":{"path":"/faq","title":"FAQ"}}},{"node":{"id":"04c5ddbd-7839-580f-82da-bc9fdbb49f84","frontmatter":{"path":"/known-problems-solutions","title":"Các vấn đề bạn có thể gặp phải"}}},{"node":{"id":"c92ea568-3384-5ff8-8dfa-b9015597780d","frontmatter":{"path":"/known-problems-solutions","title":"Issues you may face"}}},{"node":{"id":"52d4cd1d-eb14-54f3-a18a-ef84b67c320d","frontmatter":{"path":"/index-en","title":"Homepage"}}},{"node":{"id":"5e6b6ee0-b381-53f0-b84c-af378792b131","frontmatter":{"path":"/registration-and-completion","title":"Registration and Completion"}}},{"node":{"id":"58688080-4aa8-54e6-8b8b-02de1c4f6410","frontmatter":{"path":"/unity-assignment","title":"Unity Assignment"}}},{"node":{"id":"d9c993b6-f6b4-59a1-b119-f3b7218eec6b","frontmatter":{"path":"/sanasto","title":"Sanasto"}}},{"node":{"id":"8a3ee5be-7557-5fcd-954b-2351e74cd585","frontmatter":{"path":"/part-0/1-intro-vi","title":"Giới thiệu khóa học"}}},{"node":{"id":"23082016-7bbd-5215-8485-4ffccbf3ea1a","frontmatter":{"path":"/part-0/1-intro","title":"Course Introduction"}}},{"node":{"id":"771eaa93-2ef2-5e0f-9e1e-55914c67c4ac","frontmatter":{"path":"/part-0","title":"Part 0"}}},{"node":{"id":"fe0342aa-a4c5-5b44-8591-71eb27f1a287","frontmatter":{"path":"/part-1/2-introduction-to-debugging-vi","title":"Giới thiệu về Debugging"}}},{"node":{"id":"1c236933-7ad5-5b61-8c07-07db3822d55a","frontmatter":{"path":"/part-1/2-introduction-to-debugging","title":"Introduction to Debugging"}}},{"node":{"id":"7fc5c062-6b94-53ec-9aaa-adca66ce672e","frontmatter":{"path":"/part-1/5-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"3c788edf-62db-5e86-9366-17b53eda9244","frontmatter":{"path":"/part-1/5-summary","title":"Summary"}}},{"node":{"id":"8ed3365b-b788-5806-8ec5-bec3cb0f94c8","frontmatter":{"path":"/part-1","title":"Part 1"}}},{"node":{"id":"fd467661-6b24-545f-904c-52f4a7ade6b7","frontmatter":{"path":"/part-2/1-networking-between-pods","title":"Networking between pods"}}},{"node":{"id":"46a4a0e4-d131-537d-aa72-5b6726163a7d","frontmatter":{"path":"/part-2/1-networking-between-pods-vi","title":"Kết nối mạng giữa các pod"}}},{"node":{"id":"8f3387b0-ec6e-5a86-982a-e52780d911f9","frontmatter":{"path":"/part-2/5-monitoring","title":"Monitoring"}}},{"node":{"id":"56110eda-875d-5bd9-a400-5bd5a009df7f","frontmatter":{"path":"/part-2/5-monitoring-vi","title":"Giám sát"}}},{"node":{"id":"79f1cddb-6995-51c2-bf98-2adc13de9b13","frontmatter":{"path":"/part-2/6-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"06173ac4-c2f8-57df-8dc8-450b5c2bb695","frontmatter":{"path":"/part-2/6-summary","title":"Summary"}}},{"node":{"id":"8c3d747d-4f87-5a46-99ac-dfd0af5a893b","frontmatter":{"path":"/part-2","title":"Part 2"}}},{"node":{"id":"8d9fd774-9dbe-5cca-8395-9226fcf82c4a","frontmatter":{"path":"/part-3/4-summary","title":"Tóm tắt"}}},{"node":{"id":"29bec4f5-8a0b-580d-ac84-9dbbd1d7152e","frontmatter":{"path":"/part-3","title":"Part 3"}}},{"node":{"id":"b98b2895-6c9d-5234-939d-2f547cbf8a06","frontmatter":{"path":"/part-3/4-summary","title":"Summary"}}},{"node":{"id":"4dd8302d-d170-5d38-8198-4d0947322bbc","frontmatter":{"path":"/part-4/4-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"0045695d-e541-5acc-b4b8-551023d01733","frontmatter":{"path":"/part-4/4-summary","title":"Summary"}}},{"node":{"id":"a917b24d-df2b-5199-ac98-cd0f7560c63f","frontmatter":{"path":"/part-4","title":"Part 4"}}},{"node":{"id":"2318c18f-86e6-5a4e-958a-d1c38f8615cd","frontmatter":{"path":"/part-5/4-beyond-kubernetes","title":"Beyond Kubernetes"}}},{"node":{"id":"eb339401-26c8-594c-98fd-2f30a95275cd","frontmatter":{"path":"/part-5/4-beyond-kubernetes-vi","title":"Vượt ra ngoài Kubernetes"}}},{"node":{"id":"781bd207-902e-59a2-a752-4958c2c93fb0","frontmatter":{"path":"/part-5/5-summary-vi","title":"Tóm tắt và kết thúc"}}},{"node":{"id":"1d8ff75c-065b-565d-9ceb-01b9a276ae7a","frontmatter":{"path":"/part-5/5-summary","title":"Summary and end"}}},{"node":{"id":"98132cca-4dc3-5942-a6f4-1da87bc81a23","frontmatter":{"path":"/part-0/2-kubernetes-in-three-diagrams","title":"Kubernetes in three diagrams"}}},{"node":{"id":"829fd216-f995-5a77-b201-bb971aec73b4","frontmatter":{"path":"/part-0/2-kubernetes-in-three-diagrams-vi","title":"Kubernetes qua ba sơ đồ"}}},{"node":{"id":"8931bcb7-c40e-5d57-aa80-c4333972fbb8","frontmatter":{"path":"/part-1/3-introduction-to-networking-vi","title":"Giới thiệu về Mạng"}}},{"node":{"id":"4fe00c0a-bb17-5d4c-8202-750493a755c9","frontmatter":{"path":"/part-1/4-introduction-to-storage-vi","title":"Giới thiệu về Lưu trữ"}}},{"node":{"id":"90b8e83a-9d55-550a-908a-316708ce7f8c","frontmatter":{"path":"/part-1/3-introduction-to-networking","title":"Introduction to Networking"}}},{"node":{"id":"6cc3be66-6091-58fc-bcbd-1f27f9473f85","frontmatter":{"path":"/part-1/4-introduction-to-storage","title":"Introduction to Storage"}}},{"node":{"id":"b53df746-c24f-57e3-a9f3-d6d621697689","frontmatter":{"path":"/part-2/2-organizing-a-cluster-vi","title":"Tổ chức một cụm"}}},{"node":{"id":"d5206d16-d2fe-51fd-8acd-d85ecf0be257","frontmatter":{"path":"/part-2/2-organizing-a-cluster","title":"Organizing a cluster"}}},{"node":{"id":"15be3d7c-b0b7-5bce-b3bf-8cec39d54630","frontmatter":{"path":"/part-2/3-configuring-applications-vi","title":"Cấu hình ứng dụng"}}},{"node":{"id":"e4534a9d-fb84-5d1f-83f0-35055feb0da7","frontmatter":{"path":"/part-2/3-configuring-applications","title":"Configuring applications"}}},{"node":{"id":"02389078-a12f-561a-8a54-fa99a6950b92","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs-vi","title":"StatefulSet và Job"}}},{"node":{"id":"466aa711-527b-55a0-871b-13468e65d344","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs","title":"StatefulSets and Jobs"}}},{"node":{"id":"84db9628-b3df-5ca1-9d3d-5924e02ae549","frontmatter":{"path":"/part-3/1-introduction-to-gke","title":"Introduction to Google Kubernetes Engine"}}},{"node":{"id":"0049e57f-0bc7-5689-9169-43848a972877","frontmatter":{"path":"/part-3/2-deployment-pipeline-vi","title":"Quy trình Triển khai (Deployment Pipeline)"}}},{"node":{"id":"61f18dc7-1abf-5c75-9b54-0cee11c76a40","frontmatter":{"path":"/part-3/2-deployment-pipeline","title":"Deployment Pipeline"}}},{"node":{"id":"7dfec8c7-8ccb-50da-949d-ebd1de395dc4","frontmatter":{"path":"/part-3/3-gke-features-vi","title":"Các tính năng của GKE"}}},{"node":{"id":"423cbc46-2dfa-57e6-9dc5-761a93729600","frontmatter":{"path":"/part-3/3-gke-features","title":"GKE features"}}},{"node":{"id":"bea18f34-dcdc-59b8-ba24-3011680a0c58","frontmatter":{"path":"/part-3/1-introduction-to-gke-vi","title":"Giới thiệu về Google Kubernetes Engine"}}},{"node":{"id":"6df9c7be-f930-5827-a39c-0c1698b23600","frontmatter":{"path":"/part-4/3-gitops","title":"GitOps"}}},{"node":{"id":"46f9ce68-5ccd-5787-bd59-03852ad6fdcb","frontmatter":{"path":"/part-4/3-gitops","title":"GitOps"}}},{"node":{"id":"0e981ec1-99e0-5005-ba9f-4f626a81b7ce","frontmatter":{"path":"/part-5/1-kubernetes-internals-vi","title":"Bên trong Kubernetes"}}},{"node":{"id":"31927db3-2182-55c7-b680-663754461d14","frontmatter":{"path":"/part-5/1-kubernetes-internals","title":"Kubernetes Internals"}}},{"node":{"id":"da1f8069-17bc-5c8e-9310-117bcedf5acf","frontmatter":{"path":"/part-5/2-custom-resource-definitions-vi","title":"Định nghĩa Tài nguyên Tùy chỉnh (Custom Resource Definitions)"}}},{"node":{"id":"68c64f9f-c9a5-544b-bafb-b061665cacd0","frontmatter":{"path":"/part-5/3-service-mesh-vi","title":"Service Mesh"}}},{"node":{"id":"ccefb04a-5790-57f6-869b-d255b2203667","frontmatter":{"path":"/part-5/2-custom-resource-definitions","title":"Custom Resource Definitions"}}},{"node":{"id":"20ceed4e-761d-54d4-9acf-2669eac533c6","frontmatter":{"path":"/part-5/3-service-mesh","title":"Service Mesh"}}},{"node":{"id":"306c87f3-9adb-5d8b-a3ce-072f8e6cfa43","frontmatter":{"path":"/part-5","title":"Part 5"}}},{"node":{"id":"97ead58a-8493-5fdd-808e-d4a56de573b0","frontmatter":{"path":"/part-1/1-first-deploy","title":"First Deploy"}}},{"node":{"id":"c179c521-bb62-52bd-808b-d4869df5302a","frontmatter":{"path":"/part-4/1-update-strategies-and-prometheus","title":"Chiến lược cập nhật và Prometheus"}}},{"node":{"id":"898b0354-f1a2-5664-97de-d84b16018395","frontmatter":{"path":"/part-4/1-update-strategies-and-prometheus","title":"Update Strategies and Prometheus"}}},{"node":{"id":"6981a9d7-619d-51a9-9490-74bc77c0f55b","frontmatter":{"path":"/part-4/2-messaging-systems","title":"Messaging Systems"}}},{"node":{"id":"6f4f18ce-5aa9-5bb5-9d74-0a631a78e6b3","frontmatter":{"path":"/part-4/2-messaging-systems","title":"Hệ thống nhắn tin"}}},{"node":{"id":"a17c4c44-7396-543f-b6b4-7adf57808aa8","frontmatter":{"path":"/part-1/1-first-deploy-vi","title":"Triển khai đầu tiên"}}}]}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}