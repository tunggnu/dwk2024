{"componentChunkName":"component---src-templates-course-content-template-js","path":"/part-2/4-statefulsets-and-jobs-vi","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"Mục tiêu học tập"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sau phần này bạn"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"có thể triển khai một ứng dụng có trạng thái (stateful), ví dụ như cơ sở dữ liệu, lên Kubernetes"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"biết cách sử dụng job và cronjob để thực thi các tác vụ định kỳ hoặc một lần"}]},{"type":"text","value":"\n"}]}]},{"type":"element","tagName":"h2","properties":{"id":"statefulset","style":"position:relative;"},"children":[{"type":"text","value":"StatefulSet"},{"type":"element","tagName":"a","properties":{"href":"#statefulset","ariaLabel":"statefulset permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ở "},{"type":"element","tagName":"a","properties":{"href":"/part-1/4-introduction-to-storage"},"children":[{"type":"text","value":"phần 1"}]},{"type":"text","value":" chúng ta đã học cách sử dụng volume với PersistentVolume và PersistentVolumeClaim. Chúng ta đã dùng "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Deployment"}]},{"type":"text","value":" với chúng và mọi thứ hoạt động tốt cho mục đích kiểm thử. Nếu chỉ có một pod trong deployment thì không vấn đề gì. Khi mở rộng (scaling), mọi thứ có thể khác. Vấn đề là "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Deployment"}]},{"type":"text","value":" tạo và mở rộng các pod là "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"bản sao"}]},{"type":"text","value":" (replica) - chúng là các bản sao mới của cùng một container chạy song song. Vì vậy, volume sẽ được chia sẻ bởi tất cả các pod trong deployment đó. Với volume chỉ đọc thì không sao, nhưng với volume có quyền đọc-ghi, điều này có thể gây ra vấn đề và tệ nhất là gây hỏng dữ liệu."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"StatefulSet"}]},{"type":"text","value":" tương tự như "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Deployment"}]},{"type":"text","value":" nhưng đảm bảo rằng nếu một pod chết thì pod thay thế sẽ giống hệt, với cùng tên và nhận diện mạng. Ngoài ra, nếu pod được mở rộng, mỗi bản sao sẽ có vùng lưu trữ riêng. Vì vậy StatefulSet dành cho "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"ứng dụng có trạng thái"}]},{"type":"text","value":", nơi trạng thái được lưu bên trong ứng dụng, không phải bên ngoài, ví dụ như cơ sở dữ liệu. Bạn có thể dùng StatefulSet để mở rộng server game cần lưu trạng thái, như server Minecraft. Hoặc chạy một cơ sở dữ liệu. Để đảm bảo an toàn dữ liệu khi xóa, StatefulSet sẽ không xóa volume mà nó liên kết."}]},{"type":"element","tagName":"text-box","properties":{"name":"ReplicaSets","variant":"hint"},"children":[{"type":"text","value":"\nDeployment tạo pod bằng một tài nguyên gọi là \"ReplicaSet\". Chúng ta đang sử dụng ReplicaSet thông qua Deployment nên chưa cần nói nhiều về nó.\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Hãy chạy cơ sở dữ liệu key-value "},{"type":"element","tagName":"a","properties":{"href":"https://redis.io","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Redis"}]},{"type":"text","value":" và lưu một số dữ liệu vào đó. Chúng ta sẽ cần một PersistentVolume cũng như một ứng dụng sử dụng Redis."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"StatefulSet yêu cầu một \"Headless Service\" để đảm nhiệm nhận diện mạng. Hãy bắt đầu bằng cách định nghĩa một \"headless service\" với "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"clusterIP: None"}]},{"type":"text","value":", điều này sẽ báo cho Kubernetes không thực hiện proxy hay cân bằng tải, mà cho phép truy cập trực tiếp vào các Pod:"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"service.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Service\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redis"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"svc\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"labels"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redis\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"ports"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"port"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"6379"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" web\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"clusterIP"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" None\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redisapp"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"StatefulSet với hai container, Redis và "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/kubernetes-hy/material-example/tree/master/app5","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"redisfiller"}]},{"type":"text","value":", là một app đơn giản sử dụng Redis:"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"statefulset.yaml"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" apps/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" StatefulSet\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redis"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"stset\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"serviceName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redis"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"svc\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"replicas"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"matchLabels"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redisapp\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"template"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"labels"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redisapp\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"containers"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redisfiller\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" jakousa/dwk"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"app5"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"54203329200143875187753026f4e93a1305ae26\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redis\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redis"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"5.0"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"ports"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" web\n              "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"containerPort"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"6379"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"volumeMounts"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redis"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"data"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"storage\n              "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"mountPath"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" /data\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"volumeClaimTemplates"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redis"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"data"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"storage\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"accessModes"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"ReadWriteOnce\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"storageClassName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" local"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"path\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"requests"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"storage"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" 100Mi"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Lưu ý rằng vì các container giờ nằm trong cùng một pod nên chúng chia sẻ mạng và app "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"redisfiller"}]},{"type":"text","value":" sẽ thấy Redis ở địa chỉ "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"localhost:6379"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"StatefulSet trông rất giống "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Deployment"}]},{"type":"text","value":" nhưng sử dụng "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#volume-claim-templates","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"volumeClaimTemplate"}]},{"type":"text","value":" để tạo volume riêng cho từng pod."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Ở phần 1 chúng ta phải làm khá nhiều để có storage, nhưng giờ chúng ta dùng storage "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"dynamically provisioned"}]},{"type":"text","value":" do K3s cung cấp bằng cách chỉ định "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"storageClassName: local-path"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vì "},{"type":"element","tagName":"a","properties":{"href":"https://docs.k3s.io/storage#setting-up-the-local-storage-provider","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"local-path storage"}]},{"type":"text","value":" được cấp phát động, chúng ta không cần tạo PersistentVolume cho volume, K3s sẽ tự lo việc đó."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Để tìm hiểu thêm, xem "},{"type":"element","tagName":"a","properties":{"href":"https://rancher.com/docs/k3s/latest/en/storage/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"tài liệu Rancher"}]},{"type":"text","value":" và đọc thêm về "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/storage/persistent-volumes/#dynamic","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"dynamic provisioning"}]},{"type":"text","value":". Nếu muốn, bạn có thể xem lại các ví dụ và bài tập ở phần 1 và dùng dynamic provisioning thay cho manual provisioning trong ứng dụng của mình!"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Giờ bạn có thể mở hai terminal và chạy "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"$ kubectl logs -f redis-stset-X redisfiller"}]},{"type":"text","value":" với X là 0 hoặc 1. Để xác nhận mọi thứ hoạt động, bạn có thể xóa một pod và nó sẽ khởi động lại và tiếp tục đúng nơi đã dừng. Ngoài ra, bạn có thể xóa StatefulSet và volume vẫn còn, sẽ được gắn lại khi bạn apply StatefulSet lần nữa."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Hãy nhấn mạnh lại: StatefulSet tạo một volume riêng cho mỗi replica. Ta có thể thấy thực sự có hai PersistentVolumeClaim cho app:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"$ kubectl get pvc\nNAME              STATUS   VOLUME                   CAPACITY   ACCESS MODES   STORAGECLASS   AGE\ndata-redis-ss-0   Bound    pvc-f318ca82-d584-4e10   100Mi      RWO            local-path     53m\ndata-redis-ss-1   Bound    pvc-d8e5b81a-05ec-420b   100Mi      RWO            local-path     53m"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Như vậy, "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"volumeClaimTemplates"}]},{"type":"text","value":" trong định nghĩa StatefulSet được dùng để tạo PersistentVolumeClaim riêng cho từng replica trong set."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Hãy quan sát kỹ hơn cách Headless Service hoạt động. Như đã thấy ở trên, nó được định nghĩa với "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"clusterIP: None"}]},{"type":"text","value":", nên service không có cluster IP và truy cập phải thực hiện trực tiếp tới các pod."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Hãy thử "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"ping"}]},{"type":"text","value":" tới service từ pod busybox:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"$ "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ping"}]},{"type":"text","value":" redis-svc\nPING redis-svc "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.42"}]},{"type":"text","value":".2.25"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":": "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"56"}]},{"type":"text","value":" data bytes\n"},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"64"}]},{"type":"text","value":" bytes from "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.42"}]},{"type":"text","value":".2.25: "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"seq"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"ttl"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"64"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"time"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0.165"}]},{"type":"text","value":" ms"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vậy có thể truy cập service chỉ bằng tên "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"redis-svc"}]},{"type":"text","value":", nó resolve ra IP "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"10.42.2.25"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Dùng lệnh "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Nslookup","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"nslookup"}]},{"type":"text","value":" ta thấy tên miền "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"redis-svc"}]},{"type":"text","value":" resolve ra hai địa chỉ IP khác nhau:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"$ "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"nslookup"}]},{"type":"text","value":" redis-svc\nName:\tredis-svc.default.svc.cluster.local\nAddress: "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.42"}]},{"type":"text","value":".2.25\nName:\tredis-svc.default.svc.cluster.local\nAddress: "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.42"}]},{"type":"text","value":".1.32"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Lệnh ping chỉ chọn địa chỉ IP đầu tiên. Tất cả các replica đều có tên miền riêng:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"$ "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ping"}]},{"type":"text","value":" redis-stset-0.redis-svc\nPING redis-ss-0.redis-svc "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.42"}]},{"type":"text","value":".2.25"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":": "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"56"}]},{"type":"text","value":" data bytes\n"},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"64"}]},{"type":"text","value":" bytes from "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.42"}]},{"type":"text","value":".2.25: "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"seq"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"ttl"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"64"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"time"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0.214"}]},{"type":"text","value":" ms\n\n$ "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"ping"}]},{"type":"text","value":" redis-stsets-1.redis-svc\nPING redis-ss-1.redis-svc "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.42"}]},{"type":"text","value":".1.32"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":": "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"56"}]},{"type":"text","value":" data bytes\n"},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"64"}]},{"type":"text","value":" bytes from "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"10.42"}]},{"type":"text","value":".1.32: "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"seq"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"ttl"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"62"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"time"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0.140"}]},{"type":"text","value":" ms"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Nhận diện của các pod là cố định, nên nếu ví dụ pod "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"redis-stset-0"}]},{"type":"text","value":" chết, nó sẽ luôn có cùng tên khi được lên lịch lại, và vẫn gắn với cùng volume."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Lưu ý rằng bạn có thể định nghĩa StatefulSet và Headless Service trong cùng một file bằng cách ngăn cách chúng bằng ba dấu gạch ngang:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" apps/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" StatefulSet\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redis"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"stset\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"serviceName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redis"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"svc\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"replicas"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"2"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"matchLabels"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redisapp\n  "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# more rows"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"---"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Service\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redis"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"svc\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"labels"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redis\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"ports"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"port"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"6379"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" web\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"clusterIP"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" None\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" redisapp"}]}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 2.07: Ứng dụng có trạng thái"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Chạy một cơ sở dữ liệu Postgres và lưu bộ đếm của ứng dụng Ping-pong vào cơ sở dữ liệu."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Cơ sở dữ liệu Postgres và ứng dụng Ping-pong "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"không được"}]},{"type":"text","value":" nằm trong cùng một pod.\nMột cơ sở dữ liệu Postgres là đủ và nó có thể biến mất cùng với cụm, nhưng nó phải tồn tại ngay cả khi tất cả các pod bị tắt."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Gợi ý:"}]},{"type":"text","value":" nên đảm bảo cơ sở dữ liệu đã sẵn sàng và có thể kết nối trước khi kết nối từ ứng dụng Ping-pong. Để làm vậy, bạn có thể khởi động một pod độc lập chạy image Postgres:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"text","value":"  kubectl run -it --rm --restart"},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"Never --image postgres psql-for-debugging "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"sh"}]},{"type":"text","value":"\n  $ psql postgres://yourpostgresurlhere\n  psql "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"16.2"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"Debian "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"16.2"}]},{"type":"text","value":"-1.pgdg120+2"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"))"}]},{"type":"text","value":"\n  Type "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"help\""}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"for"}]},{"type":"text","value":" help.\n  "},{"type":"element","tagName":"span","properties":{"className":["token","assign-left","variable"]},"children":[{"type":"text","value":"postgres"}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# \\d"}]},{"type":"text","value":"\n  Did not "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"find"}]},{"type":"text","value":" any relations."}]}]}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 2.08: Project v1.2"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tạo một cơ sở dữ liệu và lưu các todo vào đó. Cơ sở dữ liệu cũng nên có pod riêng."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sử dụng Secret và/hoặc ConfigMap để backend truy cập vào cơ sở dữ liệu."}]}]},{"type":"element","tagName":"h2","properties":{"id":"job-va-cronjob","style":"position:relative;"},"children":[{"type":"text","value":"Job và CronJob"},{"type":"element","tagName":"a","properties":{"href":"#job-va-cronjob","ariaLabel":"job va cronjob permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tài nguyên "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/controllers/job/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Job"}]},{"type":"text","value":" được dùng để chạy các workload không phải dịch vụ liên tục, mà chỉ chạy từ đầu đến cuối. Trạng thái của job được lưu lại để có thể theo dõi sau khi thực thi xong. Job có thể cấu hình để chạy nhiều instance cùng lúc, tuần tự hoặc cho đến khi đạt số lần thành công nhất định."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Một ví dụ sử dụng job là tạo backup từ cơ sở dữ liệu. "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Job"}]},{"type":"text","value":" của chúng ta sẽ dùng biến môi trường URL làm địa chỉ lấy dữ liệu dump và gửi nó đến một server lưu trữ. Cơ sở dữ liệu sẽ là Postgres và công cụ tạo backup là "},{"type":"element","tagName":"a","properties":{"href":"https://www.postgresql.org/docs/current/app-pgdump.html","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"pg_dump"}]},{"type":"text","value":". Chỉ cần một script bash đơn giản là đủ."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","shebang","important"]},"children":[{"type":"text","value":"#!/usr/bin/env bash"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"set"}]},{"type":"text","value":" -e\n\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"if"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$URL"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"\n  pg_dump -v "},{"type":"element","tagName":"span","properties":{"className":["token","variable"]},"children":[{"type":"text","value":"$URL"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":" /usr/src/app/backup.sql\n\n  "},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"Not sending the dump actually anywhere\""}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# curl -F ‘data=@/usr/src/app/backup.sql’ https://somewhere"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"fi"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Script trên đã được đóng gói thành image "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/r/jakousa/simple-backup-example","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"jakousa/simple-backup-example"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Vì chúng ta chưa có Postgres, hãy triển khai một cái trước:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Service\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" postgres"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"svc\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"labels"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" postgres\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"ports"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"port"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"5432"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" web\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"clusterIP"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" None\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" postgres\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"---"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" apps/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" StatefulSet\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" postgres"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"ss\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"serviceName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" postgres\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"replicas"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"selector"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"matchLabels"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" postgres\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"template"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"labels"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"app"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" postgres\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"containers"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" postgres\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" postgres"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"13.0"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"ports"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" postgres\n              "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"containerPort"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"5432"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"env"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" POSTGRES_PASSWORD\n              "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"value"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"example\""}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"volumeMounts"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" data\n              "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"mountPath"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" /var/lib/postgresql/data\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"volumeClaimTemplates"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" data\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"accessModes"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"["}]},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"ReadWriteOnce\""}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"]"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"storageClassName"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" local"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"path\n        "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"resources"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"requests"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"storage"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" 100Mi"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Apply file trên và kiểm tra pod đã chạy:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"shell"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-shell"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"$ kubectl get po\n  NAME                                READY   STATUS    RESTARTS   AGE\n  postgres-ss-0                       "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1     Running   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"0"}]},{"type":"text","value":"          65s"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Giờ chúng ta có thể apply job sau sử dụng image trên:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"yaml"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-yaml"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"apiVersion"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" batch/v1\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"kind"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Job\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"metadata"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" backup\n"},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"template"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"spec"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"containers"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n        "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" backup\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"image"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" jakousa/simple"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"backup"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":"example\n          "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"env"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":"\n            "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"-"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"name"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" URL\n              "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"value"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"postgres://postgres:example@postgres-svc:5432/postgres\""}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","key","atrule"]},"children":[{"type":"text","value":"restartPolicy"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" Never "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# Lần này chỉ chạy một lần"}]}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Pod có một số cấu hình sẵn có. Ví dụ, có thể ép nó thử lại nhiều lần bằng cách định nghĩa "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"backoffLimit"}]},{"type":"text","value":"."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"shell"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-shell"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-shell"]},"children":[{"type":"text","value":"$ kubectl get "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"jobs"}]},{"type":"text","value":"\n  NAME     COMPLETIONS   DURATION   AGE\n  backup   "},{"type":"element","tagName":"span","properties":{"className":["token","number"]},"children":[{"type":"text","value":"1"}]},{"type":"text","value":"/1           7s         35s\n\n$ kubectl logs backup-wj9r5\n  "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":".."}]},{"type":"text","value":".\n  pg_dump: saving encoding "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" UTF8\n  pg_dump: saving standard_conforming_strings "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" on\n  pg_dump: saving search_path "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":"\n  pg_dump: implied data-only restore\n  Not sending the dump actually anywhere"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"CronJob"}]},{"type":"text","value":" tương tự Job nhưng chạy theo lịch. Có thể bạn đã từng dùng "},{"type":"element","tagName":"a","properties":{"href":"https://vi.wikipedia.org/wiki/Cron","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"cron"}]},{"type":"text","value":" để lên lịch tác vụ trên server, CronJob về cơ bản cũng giống vậy nhưng cho container."}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 2.09: Todo hàng ngày"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tạo một CronJob tạo một todo mới mỗi giờ để nhắc bạn \"Read < URL >\"."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Trong đó < URL > là một bài viết Wikipedia được job chọn ngẫu nhiên. Không cần phải là hyperlink, người dùng có thể copy-paste URL từ todo."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Special:Random","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://en.wikipedia.org/wiki/Special:Random"}]},{"type":"text","value":" sẽ trả về redirect tới một trang Wikipedia ngẫu nhiên nên bạn có thể dùng nó để lấy một bài viết ngẫu nhiên để đọc. GỢI Ý: Kiểm tra header location"}]}]}]},"html":"<div><text-box variant='learningObjectives' name='Mục tiêu học tập'><p>Sau phần này bạn</p><ul>\n<li>có thể triển khai một ứng dụng có trạng thái (stateful), ví dụ như cơ sở dữ liệu, lên Kubernetes</li>\n<li>biết cách sử dụng job và cronjob để thực thi các tác vụ định kỳ hoặc một lần</li>\n</ul></text-box><h2 id=\"statefulset\" style=\"position:relative;\">StatefulSet<a href=\"#statefulset\" aria-label=\"statefulset permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2><p>Ở <a href=\"/part-1/4-introduction-to-storage\">phần 1</a> chúng ta đã học cách sử dụng volume với PersistentVolume và PersistentVolumeClaim. Chúng ta đã dùng <em>Deployment</em> với chúng và mọi thứ hoạt động tốt cho mục đích kiểm thử. Nếu chỉ có một pod trong deployment thì không vấn đề gì. Khi mở rộng (scaling), mọi thứ có thể khác. Vấn đề là <em>Deployment</em> tạo và mở rộng các pod là <em>bản sao</em> (replica) - chúng là các bản sao mới của cùng một container chạy song song. Vì vậy, volume sẽ được chia sẻ bởi tất cả các pod trong deployment đó. Với volume chỉ đọc thì không sao, nhưng với volume có quyền đọc-ghi, điều này có thể gây ra vấn đề và tệ nhất là gây hỏng dữ liệu.</p><p><a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/\" target=\"_blank\" rel=\"noopener noreferrer\">StatefulSet</a> tương tự như <em>Deployment</em> nhưng đảm bảo rằng nếu một pod chết thì pod thay thế sẽ giống hệt, với cùng tên và nhận diện mạng. Ngoài ra, nếu pod được mở rộng, mỗi bản sao sẽ có vùng lưu trữ riêng. Vì vậy StatefulSet dành cho <em>ứng dụng có trạng thái</em>, nơi trạng thái được lưu bên trong ứng dụng, không phải bên ngoài, ví dụ như cơ sở dữ liệu. Bạn có thể dùng StatefulSet để mở rộng server game cần lưu trạng thái, như server Minecraft. Hoặc chạy một cơ sở dữ liệu. Để đảm bảo an toàn dữ liệu khi xóa, StatefulSet sẽ không xóa volume mà nó liên kết.</p><text-box name=\"ReplicaSets\" variant=\"hint\">\nDeployment tạo pod bằng một tài nguyên gọi là \"ReplicaSet\". Chúng ta đang sử dụng ReplicaSet thông qua Deployment nên chưa cần nói nhiều về nó.\n</text-box><p>Hãy chạy cơ sở dữ liệu key-value <a href=\"https://redis.io\" target=\"_blank\" rel=\"noopener noreferrer\">Redis</a> và lưu một số dữ liệu vào đó. Chúng ta sẽ cần một PersistentVolume cũng như một ứng dụng sử dụng Redis.</p><p>StatefulSet yêu cầu một \"Headless Service\" để đảm nhiệm nhận diện mạng. Hãy bắt đầu bằng cách định nghĩa một \"headless service\" với <code class=\"language-text\">clusterIP: None</code>, điều này sẽ báo cho Kubernetes không thực hiện proxy hay cân bằng tải, mà cho phép truy cập trực tiếp vào các Pod:</p><p><strong>service.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>svc\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redis\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6379</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> web\n  <span class=\"token key atrule\">clusterIP</span><span class=\"token punctuation\">:</span> None\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redisapp</code></pre></div><p>StatefulSet với hai container, Redis và <a href=\"https://github.com/kubernetes-hy/material-example/tree/master/app5\" target=\"_blank\" rel=\"noopener noreferrer\">redisfiller</a>, là một app đơn giản sử dụng Redis:</p><p><strong>statefulset.yaml</strong></p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> StatefulSet\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>stset\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">serviceName</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>svc\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redisapp\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redisapp\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redisfiller\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> jakousa/dwk<span class=\"token punctuation\">-</span>app5<span class=\"token punctuation\">:</span>54203329200143875187753026f4e93a1305ae26\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">:</span><span class=\"token number\">5.0</span>\n          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> web\n              <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6379</span>\n          <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>data<span class=\"token punctuation\">-</span>storage\n              <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /data\n  <span class=\"token key atrule\">volumeClaimTemplates</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>data<span class=\"token punctuation\">-</span>storage\n      <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"ReadWriteOnce\"</span><span class=\"token punctuation\">]</span>\n        <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> local<span class=\"token punctuation\">-</span>path\n        <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 100Mi</code></pre></div><p>Lưu ý rằng vì các container giờ nằm trong cùng một pod nên chúng chia sẻ mạng và app <em>redisfiller</em> sẽ thấy Redis ở địa chỉ <em>localhost:6379</em>.</p><p>StatefulSet trông rất giống <em>Deployment</em> nhưng sử dụng <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#volume-claim-templates\" target=\"_blank\" rel=\"noopener noreferrer\">volumeClaimTemplate</a> để tạo volume riêng cho từng pod.</p><p>Ở phần 1 chúng ta phải làm khá nhiều để có storage, nhưng giờ chúng ta dùng storage <em>dynamically provisioned</em> do K3s cung cấp bằng cách chỉ định <code class=\"language-text\">storageClassName: local-path</code>.</p><p>Vì <a href=\"https://docs.k3s.io/storage#setting-up-the-local-storage-provider\" target=\"_blank\" rel=\"noopener noreferrer\">local-path storage</a> được cấp phát động, chúng ta không cần tạo PersistentVolume cho volume, K3s sẽ tự lo việc đó.</p><p>Để tìm hiểu thêm, xem <a href=\"https://rancher.com/docs/k3s/latest/en/storage/\" target=\"_blank\" rel=\"noopener noreferrer\">tài liệu Rancher</a> và đọc thêm về <a href=\"https://kubernetes.io/docs/concepts/storage/persistent-volumes/#dynamic\" target=\"_blank\" rel=\"noopener noreferrer\">dynamic provisioning</a>. Nếu muốn, bạn có thể xem lại các ví dụ và bài tập ở phần 1 và dùng dynamic provisioning thay cho manual provisioning trong ứng dụng của mình!</p><p>Giờ bạn có thể mở hai terminal và chạy <code class=\"language-text\">$ kubectl logs -f redis-stset-X redisfiller</code> với X là 0 hoặc 1. Để xác nhận mọi thứ hoạt động, bạn có thể xóa một pod và nó sẽ khởi động lại và tiếp tục đúng nơi đã dừng. Ngoài ra, bạn có thể xóa StatefulSet và volume vẫn còn, sẽ được gắn lại khi bạn apply StatefulSet lần nữa.</p><p>Hãy nhấn mạnh lại: StatefulSet tạo một volume riêng cho mỗi replica. Ta có thể thấy thực sự có hai PersistentVolumeClaim cho app:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ kubectl get pvc\nNAME              STATUS   VOLUME                   CAPACITY   ACCESS MODES   STORAGECLASS   AGE\ndata-redis-ss-0   Bound    pvc-f318ca82-d584-4e10   100Mi      RWO            local-path     53m\ndata-redis-ss-1   Bound    pvc-d8e5b81a-05ec-420b   100Mi      RWO            local-path     53m</code></pre></div><p>Như vậy, <code class=\"language-text\">volumeClaimTemplates</code> trong định nghĩa StatefulSet được dùng để tạo PersistentVolumeClaim riêng cho từng replica trong set.</p><p>Hãy quan sát kỹ hơn cách Headless Service hoạt động. Như đã thấy ở trên, nó được định nghĩa với <code class=\"language-text\">clusterIP: None</code>, nên service không có cluster IP và truy cập phải thực hiện trực tiếp tới các pod.</p><p>Hãy thử <em>ping</em> tới service từ pod busybox:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">ping</span> redis-svc\nPING redis-svc <span class=\"token punctuation\">(</span><span class=\"token number\">10.42</span>.2.25<span class=\"token punctuation\">)</span>: <span class=\"token number\">56</span> data bytes\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.42</span>.2.25: <span class=\"token assign-left variable\">seq</span><span class=\"token operator\">=</span><span class=\"token number\">0</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">64</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">0.165</span> ms</code></pre></div><p>Vậy có thể truy cập service chỉ bằng tên <em>redis-svc</em>, nó resolve ra IP <em>10.42.2.25</em>.</p><p>Dùng lệnh <a href=\"https://en.wikipedia.org/wiki/Nslookup\" target=\"_blank\" rel=\"noopener noreferrer\">nslookup</a> ta thấy tên miền <em>redis-svc</em> resolve ra hai địa chỉ IP khác nhau:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">nslookup</span> redis-svc\nName:\tredis-svc.default.svc.cluster.local\nAddress: <span class=\"token number\">10.42</span>.2.25\nName:\tredis-svc.default.svc.cluster.local\nAddress: <span class=\"token number\">10.42</span>.1.32</code></pre></div><p>Lệnh ping chỉ chọn địa chỉ IP đầu tiên. Tất cả các replica đều có tên miền riêng:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">ping</span> redis-stset-0.redis-svc\nPING redis-ss-0.redis-svc <span class=\"token punctuation\">(</span><span class=\"token number\">10.42</span>.2.25<span class=\"token punctuation\">)</span>: <span class=\"token number\">56</span> data bytes\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.42</span>.2.25: <span class=\"token assign-left variable\">seq</span><span class=\"token operator\">=</span><span class=\"token number\">0</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">64</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">0.214</span> ms\n\n$ <span class=\"token function\">ping</span> redis-stsets-1.redis-svc\nPING redis-ss-1.redis-svc <span class=\"token punctuation\">(</span><span class=\"token number\">10.42</span>.1.32<span class=\"token punctuation\">)</span>: <span class=\"token number\">56</span> data bytes\n<span class=\"token number\">64</span> bytes from <span class=\"token number\">10.42</span>.1.32: <span class=\"token assign-left variable\">seq</span><span class=\"token operator\">=</span><span class=\"token number\">0</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">62</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">0.140</span> ms</code></pre></div><p>Nhận diện của các pod là cố định, nên nếu ví dụ pod <em>redis-stset-0</em> chết, nó sẽ luôn có cùng tên khi được lên lịch lại, và vẫn gắn với cùng volume.</p><p>Lưu ý rằng bạn có thể định nghĩa StatefulSet và Headless Service trong cùng một file bằng cách ngăn cách chúng bằng ba dấu gạch ngang:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> StatefulSet\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>stset\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">serviceName</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>svc\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redisapp\n  <span class=\"token comment\"># more rows</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>svc\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redis\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6379</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> web\n  <span class=\"token key atrule\">clusterIP</span><span class=\"token punctuation\">:</span> None\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redisapp</code></pre></div><exercise name='Exercise 2.07: Ứng dụng có trạng thái'><p>Chạy một cơ sở dữ liệu Postgres và lưu bộ đếm của ứng dụng Ping-pong vào cơ sở dữ liệu.</p><p>Cơ sở dữ liệu Postgres và ứng dụng Ping-pong <strong>không được</strong> nằm trong cùng một pod.\nMột cơ sở dữ liệu Postgres là đủ và nó có thể biến mất cùng với cụm, nhưng nó phải tồn tại ngay cả khi tất cả các pod bị tắt.</p><p><strong>Gợi ý:</strong> nên đảm bảo cơ sở dữ liệu đã sẵn sàng và có thể kết nối trước khi kết nối từ ứng dụng Ping-pong. Để làm vậy, bạn có thể khởi động một pod độc lập chạy image Postgres:</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">  kubectl run -it --rm --restart<span class=\"token operator\">=</span>Never --image postgres psql-for-debugging <span class=\"token function\">sh</span>\n  $ psql postgres://yourpostgresurlhere\n  psql <span class=\"token punctuation\">(</span><span class=\"token number\">16.2</span> <span class=\"token punctuation\">(</span>Debian <span class=\"token number\">16.2</span>-1.pgdg120+2<span class=\"token punctuation\">))</span>\n  Type <span class=\"token string\">\"help\"</span> <span class=\"token keyword\">for</span> help.\n  <span class=\"token assign-left variable\">postgres</span><span class=\"token operator\">=</span><span class=\"token comment\"># \\d</span>\n  Did not <span class=\"token function\">find</span> any relations.</code></pre></div></exercise><exercise name='Exercise 2.08: Project v1.2'><p>Tạo một cơ sở dữ liệu và lưu các todo vào đó. Cơ sở dữ liệu cũng nên có pod riêng.</p><p>Sử dụng Secret và/hoặc ConfigMap để backend truy cập vào cơ sở dữ liệu.</p></exercise><h2 id=\"job-va-cronjob\" style=\"position:relative;\">Job và CronJob<a href=\"#job-va-cronjob\" aria-label=\"job va cronjob permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2><p>Tài nguyên <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/job/\" target=\"_blank\" rel=\"noopener noreferrer\">Job</a> được dùng để chạy các workload không phải dịch vụ liên tục, mà chỉ chạy từ đầu đến cuối. Trạng thái của job được lưu lại để có thể theo dõi sau khi thực thi xong. Job có thể cấu hình để chạy nhiều instance cùng lúc, tuần tự hoặc cho đến khi đạt số lần thành công nhất định.</p><p>Một ví dụ sử dụng job là tạo backup từ cơ sở dữ liệu. <em>Job</em> của chúng ta sẽ dùng biến môi trường URL làm địa chỉ lấy dữ liệu dump và gửi nó đến một server lưu trữ. Cơ sở dữ liệu sẽ là Postgres và công cụ tạo backup là <a href=\"https://www.postgresql.org/docs/current/app-pgdump.html\" target=\"_blank\" rel=\"noopener noreferrer\">pg_dump</a>. Chỉ cần một script bash đơn giản là đủ.</p><div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/usr/bin/env bash</span>\n<span class=\"token builtin class-name\">set</span> -e\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$URL</span> <span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">then</span>\n  pg_dump -v <span class=\"token variable\">$URL</span> <span class=\"token operator\">></span> /usr/src/app/backup.sql\n\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Not sending the dump actually anywhere\"</span>\n  <span class=\"token comment\"># curl -F ‘data=@/usr/src/app/backup.sql’ https://somewhere</span>\n<span class=\"token keyword\">fi</span></code></pre></div><p>Script trên đã được đóng gói thành image <a href=\"https://hub.docker.com/r/jakousa/simple-backup-example\" target=\"_blank\" rel=\"noopener noreferrer\">jakousa/simple-backup-example</a>.</p><p>Vì chúng ta chưa có Postgres, hãy triển khai một cái trước:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> postgres<span class=\"token punctuation\">-</span>svc\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> postgres\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5432</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> web\n  <span class=\"token key atrule\">clusterIP</span><span class=\"token punctuation\">:</span> None\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> postgres\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> StatefulSet\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> postgres<span class=\"token punctuation\">-</span>ss\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">serviceName</span><span class=\"token punctuation\">:</span> postgres\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> postgres\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> postgres\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> postgres\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> postgres<span class=\"token punctuation\">:</span><span class=\"token number\">13.0</span>\n          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> postgres\n              <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5432</span>\n          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> POSTGRES_PASSWORD\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"example\"</span>\n          <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> data\n              <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /var/lib/postgresql/data\n  <span class=\"token key atrule\">volumeClaimTemplates</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> data\n      <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"ReadWriteOnce\"</span><span class=\"token punctuation\">]</span>\n        <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> local<span class=\"token punctuation\">-</span>path\n        <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 100Mi</code></pre></div><p>Apply file trên và kiểm tra pod đã chạy:</p><div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl get po\n  NAME                                READY   STATUS    RESTARTS   AGE\n  postgres-ss-0                       <span class=\"token number\">1</span>/1     Running   <span class=\"token number\">0</span>          65s</code></pre></div><p>Giờ chúng ta có thể apply job sau sử dụng image trên:</p><div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> batch/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Job\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> backup\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> backup\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> jakousa/simple<span class=\"token punctuation\">-</span>backup<span class=\"token punctuation\">-</span>example\n          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> URL\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"postgres://postgres:example@postgres-svc:5432/postgres\"</span>\n      <span class=\"token key atrule\">restartPolicy</span><span class=\"token punctuation\">:</span> Never <span class=\"token comment\"># Lần này chỉ chạy một lần</span></code></pre></div><p>Pod có một số cấu hình sẵn có. Ví dụ, có thể ép nó thử lại nhiều lần bằng cách định nghĩa <code class=\"language-text\">backoffLimit</code>.</p><div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ kubectl get <span class=\"token function\">jobs</span>\n  NAME     COMPLETIONS   DURATION   AGE\n  backup   <span class=\"token number\">1</span>/1           7s         35s\n\n$ kubectl logs backup-wj9r5\n  <span class=\"token punctuation\">..</span>.\n  pg_dump: saving encoding <span class=\"token operator\">=</span> UTF8\n  pg_dump: saving standard_conforming_strings <span class=\"token operator\">=</span> on\n  pg_dump: saving search_path <span class=\"token operator\">=</span>\n  pg_dump: implied data-only restore\n  Not sending the dump actually anywhere</code></pre></div><p><a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/\" target=\"_blank\" rel=\"noopener noreferrer\">CronJob</a> tương tự Job nhưng chạy theo lịch. Có thể bạn đã từng dùng <a href=\"https://vi.wikipedia.org/wiki/Cron\" target=\"_blank\" rel=\"noopener noreferrer\">cron</a> để lên lịch tác vụ trên server, CronJob về cơ bản cũng giống vậy nhưng cho container.</p><exercise name='Exercise 2.09: Todo hàng ngày'><p>Tạo một CronJob tạo một todo mới mỗi giờ để nhắc bạn \"Read &#x3C; URL >\".</p><p>Trong đó &#x3C; URL > là một bài viết Wikipedia được job chọn ngẫu nhiên. Không cần phải là hyperlink, người dùng có thể copy-paste URL từ todo.</p><p><a href=\"https://en.wikipedia.org/wiki/Special:Random\" target=\"_blank\" rel=\"noopener noreferrer\">https://en.wikipedia.org/wiki/Special:Random</a> sẽ trả về redirect tới một trang Wikipedia ngẫu nhiên nên bạn có thể dùng nó để lấy một bài viết ngẫu nhiên để đọc. GỢI Ý: Kiểm tra header location</p></exercise></div>","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs-vi","title":"StatefulSet và Job"},"fileAbsolutePath":"/home/runner/work/dwk2024/dwk2024/data/part-2/4-statefulsets-and-jobs-vi.md"},"allPages":{"edges":[{"node":{"id":"7e706a38-3828-5118-bdec-3705a319a1b0","frontmatter":{"path":"/faq-vi","title":"Câu hỏi thường gặp"}}},{"node":{"id":"e1ed6713-5992-5f7f-95a1-17efd97f57d8","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"5225f2a2-20f9-50ce-93ac-7b38f3105103","frontmatter":{"path":"/faq","title":"FAQ"}}},{"node":{"id":"3102d88f-7297-56fb-af03-27d1079fffd1","frontmatter":{"path":"/","title":"Homepage"}}},{"node":{"id":"04c5ddbd-7839-580f-82da-bc9fdbb49f84","frontmatter":{"path":"/known-problems-solutions","title":"Các vấn đề bạn có thể gặp phải"}}},{"node":{"id":"c92ea568-3384-5ff8-8dfa-b9015597780d","frontmatter":{"path":"/known-problems-solutions","title":"Issues you may face"}}},{"node":{"id":"d9c993b6-f6b4-59a1-b119-f3b7218eec6b","frontmatter":{"path":"/sanasto","title":"Sanasto"}}},{"node":{"id":"5e6b6ee0-b381-53f0-b84c-af378792b131","frontmatter":{"path":"/registration-and-completion","title":"Registration and Completion"}}},{"node":{"id":"58688080-4aa8-54e6-8b8b-02de1c4f6410","frontmatter":{"path":"/unity-assignment","title":"Unity Assignment"}}},{"node":{"id":"8a3ee5be-7557-5fcd-954b-2351e74cd585","frontmatter":{"path":"/part-0/1-intro-vi","title":"Giới thiệu khóa học"}}},{"node":{"id":"23082016-7bbd-5215-8485-4ffccbf3ea1a","frontmatter":{"path":"/part-0/1-intro","title":"Course Introduction"}}},{"node":{"id":"771eaa93-2ef2-5e0f-9e1e-55914c67c4ac","frontmatter":{"path":"/part-0","title":"Part 0"}}},{"node":{"id":"fe0342aa-a4c5-5b44-8591-71eb27f1a287","frontmatter":{"path":"/part-1/2-introduction-to-debugging-vi","title":"Giới thiệu về Debugging"}}},{"node":{"id":"1c236933-7ad5-5b61-8c07-07db3822d55a","frontmatter":{"path":"/part-1/2-introduction-to-debugging","title":"Introduction to Debugging"}}},{"node":{"id":"7fc5c062-6b94-53ec-9aaa-adca66ce672e","frontmatter":{"path":"/part-1/5-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"8ed3365b-b788-5806-8ec5-bec3cb0f94c8","frontmatter":{"path":"/part-1","title":"Part 1"}}},{"node":{"id":"46a4a0e4-d131-537d-aa72-5b6726163a7d","frontmatter":{"path":"/part-2/1-networking-between-pods-vi","title":"Kết nối mạng giữa các pod"}}},{"node":{"id":"3c788edf-62db-5e86-9366-17b53eda9244","frontmatter":{"path":"/part-1/5-summary","title":"Summary"}}},{"node":{"id":"fd467661-6b24-545f-904c-52f4a7ade6b7","frontmatter":{"path":"/part-2/1-networking-between-pods","title":"Networking between pods"}}},{"node":{"id":"56110eda-875d-5bd9-a400-5bd5a009df7f","frontmatter":{"path":"/part-2/5-monitoring-vi","title":"Giám sát"}}},{"node":{"id":"79f1cddb-6995-51c2-bf98-2adc13de9b13","frontmatter":{"path":"/part-2/6-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"8f3387b0-ec6e-5a86-982a-e52780d911f9","frontmatter":{"path":"/part-2/5-monitoring","title":"Monitoring"}}},{"node":{"id":"06173ac4-c2f8-57df-8dc8-450b5c2bb695","frontmatter":{"path":"/part-2/6-summary","title":"Summary"}}},{"node":{"id":"8c3d747d-4f87-5a46-99ac-dfd0af5a893b","frontmatter":{"path":"/part-2","title":"Part 2"}}},{"node":{"id":"8d9fd774-9dbe-5cca-8395-9226fcf82c4a","frontmatter":{"path":"/part-3/4-summary","title":"Tóm tắt"}}},{"node":{"id":"b98b2895-6c9d-5234-939d-2f547cbf8a06","frontmatter":{"path":"/part-3/4-summary","title":"Summary"}}},{"node":{"id":"29bec4f5-8a0b-580d-ac84-9dbbd1d7152e","frontmatter":{"path":"/part-3","title":"Part 3"}}},{"node":{"id":"781bd207-902e-59a2-a752-4958c2c93fb0","frontmatter":{"path":"/part-5/5-summary-vi","title":"Tóm tắt và kết thúc"}}},{"node":{"id":"2318c18f-86e6-5a4e-958a-d1c38f8615cd","frontmatter":{"path":"/part-5/4-beyond-kubernetes","title":"Beyond Kubernetes"}}},{"node":{"id":"eb339401-26c8-594c-98fd-2f30a95275cd","frontmatter":{"path":"/part-5/4-beyond-kubernetes-vi","title":"Vượt ra ngoài Kubernetes"}}},{"node":{"id":"1d8ff75c-065b-565d-9ceb-01b9a276ae7a","frontmatter":{"path":"/part-5/5-summary","title":"Summary and end"}}},{"node":{"id":"306c87f3-9adb-5d8b-a3ce-072f8e6cfa43","frontmatter":{"path":"/part-5","title":"Part 5"}}},{"node":{"id":"4dd8302d-d170-5d38-8198-4d0947322bbc","frontmatter":{"path":"/part-4/4-summary-vi","title":"Tóm tắt"}}},{"node":{"id":"0045695d-e541-5acc-b4b8-551023d01733","frontmatter":{"path":"/part-4/4-summary","title":"Summary"}}},{"node":{"id":"829fd216-f995-5a77-b201-bb971aec73b4","frontmatter":{"path":"/part-0/2-kubernetes-in-three-diagrams-vi","title":"Kubernetes qua ba sơ đồ"}}},{"node":{"id":"98132cca-4dc3-5942-a6f4-1da87bc81a23","frontmatter":{"path":"/part-0/2-kubernetes-in-three-diagrams","title":"Kubernetes in three diagrams"}}},{"node":{"id":"90b8e83a-9d55-550a-908a-316708ce7f8c","frontmatter":{"path":"/part-1/3-introduction-to-networking","title":"Introduction to Networking"}}},{"node":{"id":"8931bcb7-c40e-5d57-aa80-c4333972fbb8","frontmatter":{"path":"/part-1/3-introduction-to-networking-vi","title":"Giới thiệu về Mạng"}}},{"node":{"id":"4fe00c0a-bb17-5d4c-8202-750493a755c9","frontmatter":{"path":"/part-1/4-introduction-to-storage-vi","title":"Giới thiệu về Lưu trữ"}}},{"node":{"id":"6cc3be66-6091-58fc-bcbd-1f27f9473f85","frontmatter":{"path":"/part-1/4-introduction-to-storage","title":"Introduction to Storage"}}},{"node":{"id":"b53df746-c24f-57e3-a9f3-d6d621697689","frontmatter":{"path":"/part-2/2-organizing-a-cluster-vi","title":"Tổ chức một cụm"}}},{"node":{"id":"02389078-a12f-561a-8a54-fa99a6950b92","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs-vi","title":"StatefulSet và Job"}}},{"node":{"id":"15be3d7c-b0b7-5bce-b3bf-8cec39d54630","frontmatter":{"path":"/part-2/3-configuring-applications-vi","title":"Cấu hình ứng dụng"}}},{"node":{"id":"e4534a9d-fb84-5d1f-83f0-35055feb0da7","frontmatter":{"path":"/part-2/3-configuring-applications","title":"Configuring applications"}}},{"node":{"id":"d5206d16-d2fe-51fd-8acd-d85ecf0be257","frontmatter":{"path":"/part-2/2-organizing-a-cluster","title":"Organizing a cluster"}}},{"node":{"id":"466aa711-527b-55a0-871b-13468e65d344","frontmatter":{"path":"/part-2/4-statefulsets-and-jobs","title":"StatefulSets and Jobs"}}},{"node":{"id":"bea18f34-dcdc-59b8-ba24-3011680a0c58","frontmatter":{"path":"/part-3/1-introduction-to-gke-vi","title":"Giới thiệu về Google Kubernetes Engine"}}},{"node":{"id":"84db9628-b3df-5ca1-9d3d-5924e02ae549","frontmatter":{"path":"/part-3/1-introduction-to-gke","title":"Introduction to Google Kubernetes Engine"}}},{"node":{"id":"0049e57f-0bc7-5689-9169-43848a972877","frontmatter":{"path":"/part-3/2-deployment-pipeline-vi","title":"Quy trình Triển khai (Deployment Pipeline)"}}},{"node":{"id":"7dfec8c7-8ccb-50da-949d-ebd1de395dc4","frontmatter":{"path":"/part-3/3-gke-features-vi","title":"Các tính năng của GKE"}}},{"node":{"id":"61f18dc7-1abf-5c75-9b54-0cee11c76a40","frontmatter":{"path":"/part-3/2-deployment-pipeline","title":"Deployment Pipeline"}}},{"node":{"id":"0e981ec1-99e0-5005-ba9f-4f626a81b7ce","frontmatter":{"path":"/part-5/1-kubernetes-internals-vi","title":"Bên trong Kubernetes"}}},{"node":{"id":"31927db3-2182-55c7-b680-663754461d14","frontmatter":{"path":"/part-5/1-kubernetes-internals","title":"Kubernetes Internals"}}},{"node":{"id":"da1f8069-17bc-5c8e-9310-117bcedf5acf","frontmatter":{"path":"/part-5/2-custom-resource-definitions-vi","title":"Định nghĩa Tài nguyên Tùy chỉnh (Custom Resource Definitions)"}}},{"node":{"id":"20ceed4e-761d-54d4-9acf-2669eac533c6","frontmatter":{"path":"/part-5/3-service-mesh","title":"Service Mesh"}}},{"node":{"id":"ccefb04a-5790-57f6-869b-d255b2203667","frontmatter":{"path":"/part-5/2-custom-resource-definitions","title":"Custom Resource Definitions"}}},{"node":{"id":"423cbc46-2dfa-57e6-9dc5-761a93729600","frontmatter":{"path":"/part-3/3-gke-features","title":"GKE features"}}},{"node":{"id":"68c64f9f-c9a5-544b-bafb-b061665cacd0","frontmatter":{"path":"/part-5/3-service-mesh-vi","title":"Service Mesh"}}},{"node":{"id":"6df9c7be-f930-5827-a39c-0c1698b23600","frontmatter":{"path":"/part-4/3-gitops","title":"GitOps"}}},{"node":{"id":"46f9ce68-5ccd-5787-bd59-03852ad6fdcb","frontmatter":{"path":"/part-4/3-gitops","title":"GitOps"}}},{"node":{"id":"a917b24d-df2b-5199-ac98-cd0f7560c63f","frontmatter":{"path":"/part-4","title":"Part 4"}}},{"node":{"id":"97ead58a-8493-5fdd-808e-d4a56de573b0","frontmatter":{"path":"/part-1/1-first-deploy","title":"First Deploy"}}},{"node":{"id":"c179c521-bb62-52bd-808b-d4869df5302a","frontmatter":{"path":"/part-4/1-update-strategies-and-prometheus","title":"Chiến lược cập nhật và Prometheus"}}},{"node":{"id":"6f4f18ce-5aa9-5bb5-9d74-0a631a78e6b3","frontmatter":{"path":"/part-4/2-messaging-systems","title":"Hệ thống nhắn tin"}}},{"node":{"id":"898b0354-f1a2-5664-97de-d84b16018395","frontmatter":{"path":"/part-4/1-update-strategies-and-prometheus","title":"Update Strategies and Prometheus"}}},{"node":{"id":"6981a9d7-619d-51a9-9490-74bc77c0f55b","frontmatter":{"path":"/part-4/2-messaging-systems","title":"Messaging Systems"}}},{"node":{"id":"a17c4c44-7396-543f-b6b4-7adf57808aa8","frontmatter":{"path":"/part-1/1-first-deploy-vi","title":"Triển khai đầu tiên"}}}]}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}